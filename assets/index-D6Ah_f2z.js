(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))c(d);new MutationObserver(d=>{for(const v of d)if(v.type==="childList")for(const y of v.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&c(y)}).observe(document,{childList:!0,subtree:!0});function o(d){const v={};return d.integrity&&(v.integrity=d.integrity),d.referrerPolicy&&(v.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?v.credentials="include":d.crossOrigin==="anonymous"?v.credentials="omit":v.credentials="same-origin",v}function c(d){if(d.ep)return;d.ep=!0;const v=o(d);fetch(d.href,v)}})();/**
* @vue/shared v3.5.12
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function lS(e){const t=Object.create(null);for(const o of e.split(","))t[o]=1;return o=>o in t}const eo={},hp=[],fc=()=>{},rN=()=>!1,T0=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&(e.charCodeAt(2)>122||e.charCodeAt(2)<97),cS=e=>e.startsWith("onUpdate:"),Xo=Object.assign,uS=(e,t)=>{const o=e.indexOf(t);o>-1&&e.splice(o,1)},oN=Object.prototype.hasOwnProperty,Br=(e,t)=>oN.call(e,t),wi=Array.isArray,dp=e=>E0(e)==="[object Map]",Ok=e=>E0(e)==="[object Set]",Pi=e=>typeof e=="function",Do=e=>typeof e=="string",ch=e=>typeof e=="symbol",lo=e=>e!==null&&typeof e=="object",Lk=e=>(lo(e)||Pi(e))&&Pi(e.then)&&Pi(e.catch),zk=Object.prototype.toString,E0=e=>zk.call(e),sN=e=>E0(e).slice(8,-1),Bk=e=>E0(e)==="[object Object]",hS=e=>Do(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,Mg=lS(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),I0=e=>{const t=Object.create(null);return o=>t[o]||(t[o]=e(o))},aN=/-(\w)/g,Ba=I0(e=>e.replace(aN,(t,o)=>o?o.toUpperCase():"")),lN=/\B([A-Z])/g,Ad=I0(e=>e.replace(lN,"-$1").toLowerCase()),yc=I0(e=>e.charAt(0).toUpperCase()+e.slice(1)),s1=I0(e=>e?`on${yc(e)}`:""),th=(e,t)=>!Object.is(e,t),Oy=(e,...t)=>{for(let o=0;o<e.length;o++)e[o](...t)},Fk=(e,t,o,c=!1)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:c,value:o})},Z1=e=>{const t=parseFloat(e);return isNaN(t)?e:t},Vk=e=>{const t=Do(e)?Number(e):NaN;return isNaN(t)?e:t};let CA;const C0=()=>CA||(CA=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function dS(e){if(wi(e)){const t={};for(let o=0;o<e.length;o++){const c=e[o],d=Do(c)?dN(c):dS(c);if(d)for(const v in d)t[v]=d[v]}return t}else if(Do(e)||lo(e))return e}const cN=/;(?![^(]*\))/g,uN=/:([^]+)/,hN=/\/\*[^]*?\*\//g;function dN(e){const t={};return e.replace(hN,"").split(cN).forEach(o=>{if(o){const c=o.split(uN);c.length>1&&(t[c[0].trim()]=c[1].trim())}}),t}function d_(e){let t="";if(Do(e))t=e;else if(wi(e))for(let o=0;o<e.length;o++){const c=d_(e[o]);c&&(t+=c+" ")}else if(lo(e))for(const o in e)e[o]&&(t+=o+" ");return t.trim()}const fN="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",pN=lS(fN);function Nk(e){return!!e||e===""}const Uk=e=>!!(e&&e.__v_isRef===!0),_c=e=>Do(e)?e:e==null?"":wi(e)||lo(e)&&(e.toString===zk||!Pi(e.toString))?Uk(e)?_c(e.value):JSON.stringify(e,jk,2):String(e),jk=(e,t)=>Uk(t)?jk(e,t.value):dp(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((o,[c,d],v)=>(o[a1(c,v)+" =>"]=d,o),{})}:Ok(t)?{[`Set(${t.size})`]:[...t.values()].map(o=>a1(o))}:ch(t)?a1(t):lo(t)&&!wi(t)&&!Bk(t)?String(t):t,a1=(e,t="")=>{var o;return ch(e)?`Symbol(${(o=e.description)!=null?o:t})`:e};/**
* @vue/reactivity v3.5.12
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let _a;class $k{constructor(t=!1){this.detached=t,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=_a,!t&&_a&&(this.index=(_a.scopes||(_a.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let t,o;if(this.scopes)for(t=0,o=this.scopes.length;t<o;t++)this.scopes[t].pause();for(t=0,o=this.effects.length;t<o;t++)this.effects[t].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let t,o;if(this.scopes)for(t=0,o=this.scopes.length;t<o;t++)this.scopes[t].resume();for(t=0,o=this.effects.length;t<o;t++)this.effects[t].resume()}}run(t){if(this._active){const o=_a;try{return _a=this,t()}finally{_a=o}}}on(){_a=this}off(){_a=this.parent}stop(t){if(this._active){let o,c;for(o=0,c=this.effects.length;o<c;o++)this.effects[o].stop();for(o=0,c=this.cleanups.length;o<c;o++)this.cleanups[o]();if(this.scopes)for(o=0,c=this.scopes.length;o<c;o++)this.scopes[o].stop(!0);if(!this.detached&&this.parent&&!t){const d=this.parent.scopes.pop();d&&d!==this&&(this.parent.scopes[this.index]=d,d.index=this.index)}this.parent=void 0,this._active=!1}}}function A0(e){return new $k(e)}function mN(){return _a}function Ys(e,t=!1){_a&&_a.cleanups.push(e)}let so;const l1=new WeakSet;class Gk{constructor(t){this.fn=t,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,_a&&_a.active&&_a.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,l1.has(this)&&(l1.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||qk(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,AA(this),Wk(this);const t=so,o=Fl;so=this,Fl=!0;try{return this.fn()}finally{Zk(this),so=t,Fl=o,this.flags&=-3}}stop(){if(this.flags&1){for(let t=this.deps;t;t=t.nextDep)mS(t);this.deps=this.depsTail=void 0,AA(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?l1.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){X1(this)&&this.run()}get dirty(){return X1(this)}}let Hk=0,kg,Rg;function qk(e,t=!1){if(e.flags|=8,t){e.next=Rg,Rg=e;return}e.next=kg,kg=e}function fS(){Hk++}function pS(){if(--Hk>0)return;if(Rg){let t=Rg;for(Rg=void 0;t;){const o=t.next;t.next=void 0,t.flags&=-9,t=o}}let e;for(;kg;){let t=kg;for(kg=void 0;t;){const o=t.next;if(t.next=void 0,t.flags&=-9,t.flags&1)try{t.trigger()}catch(c){e||(e=c)}t=o}}if(e)throw e}function Wk(e){for(let t=e.deps;t;t=t.nextDep)t.version=-1,t.prevActiveLink=t.dep.activeLink,t.dep.activeLink=t}function Zk(e){let t,o=e.depsTail,c=o;for(;c;){const d=c.prevDep;c.version===-1?(c===o&&(o=d),mS(c),gN(c)):t=c,c.dep.activeLink=c.prevActiveLink,c.prevActiveLink=void 0,c=d}e.deps=t,e.depsTail=o}function X1(e){for(let t=e.deps;t;t=t.nextDep)if(t.dep.version!==t.version||t.dep.computed&&(Xk(t.dep.computed)||t.dep.version!==t.version))return!0;return!!e._dirty}function Xk(e){if(e.flags&4&&!(e.flags&16)||(e.flags&=-17,e.globalVersion===jg))return;e.globalVersion=jg;const t=e.dep;if(e.flags|=2,t.version>0&&!e.isSSR&&e.deps&&!X1(e)){e.flags&=-3;return}const o=so,c=Fl;so=e,Fl=!0;try{Wk(e);const d=e.fn(e._value);(t.version===0||th(d,e._value))&&(e._value=d,t.version++)}catch(d){throw t.version++,d}finally{so=o,Fl=c,Zk(e),e.flags&=-3}}function mS(e,t=!1){const{dep:o,prevSub:c,nextSub:d}=e;if(c&&(c.nextSub=d,e.prevSub=void 0),d&&(d.prevSub=c,e.nextSub=void 0),o.subs===e&&(o.subs=c,!c&&o.computed)){o.computed.flags&=-5;for(let v=o.computed.deps;v;v=v.nextDep)mS(v,!0)}!t&&!--o.sc&&o.map&&o.map.delete(o.key)}function gN(e){const{prevDep:t,nextDep:o}=e;t&&(t.nextDep=o,e.prevDep=void 0),o&&(o.prevDep=t,e.nextDep=void 0)}let Fl=!0;const Yk=[];function uh(){Yk.push(Fl),Fl=!1}function hh(){const e=Yk.pop();Fl=e===void 0?!0:e}function AA(e){const{cleanup:t}=e;if(e.cleanup=void 0,t){const o=so;so=void 0;try{t()}finally{so=o}}}let jg=0;class _N{constructor(t,o){this.sub=t,this.dep=o,this.version=o.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class gS{constructor(t){this.computed=t,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(t){if(!so||!Fl||so===this.computed)return;let o=this.activeLink;if(o===void 0||o.sub!==so)o=this.activeLink=new _N(so,this),so.deps?(o.prevDep=so.depsTail,so.depsTail.nextDep=o,so.depsTail=o):so.deps=so.depsTail=o,Kk(o);else if(o.version===-1&&(o.version=this.version,o.nextDep)){const c=o.nextDep;c.prevDep=o.prevDep,o.prevDep&&(o.prevDep.nextDep=c),o.prevDep=so.depsTail,o.nextDep=void 0,so.depsTail.nextDep=o,so.depsTail=o,so.deps===o&&(so.deps=c)}return o}trigger(t){this.version++,jg++,this.notify(t)}notify(t){fS();try{for(let o=this.subs;o;o=o.prevSub)o.sub.notify()&&o.sub.dep.notify()}finally{pS()}}}function Kk(e){if(e.dep.sc++,e.sub.flags&4){const t=e.dep.computed;if(t&&!e.dep.subs){t.flags|=20;for(let c=t.deps;c;c=c.nextDep)Kk(c)}const o=e.dep.subs;o!==e&&(e.prevSub=o,o&&(o.nextSub=e)),e.dep.subs=e}}const qy=new WeakMap,hd=Symbol(""),Y1=Symbol(""),$g=Symbol("");function qs(e,t,o){if(Fl&&so){let c=qy.get(e);c||qy.set(e,c=new Map);let d=c.get(o);d||(c.set(o,d=new gS),d.map=c,d.key=o),d.track()}}function jc(e,t,o,c,d,v){const y=qy.get(e);if(!y){jg++;return}const T=r=>{r&&r.trigger()};if(fS(),t==="clear")y.forEach(T);else{const r=wi(e),D=r&&hS(o);if(r&&o==="length"){const L=Number(c);y.forEach((B,U)=>{(U==="length"||U===$g||!ch(U)&&U>=L)&&T(B)})}else switch((o!==void 0||y.has(void 0))&&T(y.get(o)),D&&T(y.get($g)),t){case"add":r?D&&T(y.get("length")):(T(y.get(hd)),dp(e)&&T(y.get(Y1)));break;case"delete":r||(T(y.get(hd)),dp(e)&&T(y.get(Y1)));break;case"set":dp(e)&&T(y.get(hd));break}}pS()}function vN(e,t){const o=qy.get(e);return o&&o.get(t)}function Kf(e){const t=ui(e);return t===e?t:(qs(t,"iterate",$g),fl(e)?t:t.map(Ws))}function P0(e){return qs(e=ui(e),"iterate",$g),e}const yN={__proto__:null,[Symbol.iterator](){return c1(this,Symbol.iterator,Ws)},concat(...e){return Kf(this).concat(...e.map(t=>wi(t)?Kf(t):t))},entries(){return c1(this,"entries",e=>(e[1]=Ws(e[1]),e))},every(e,t){return Fc(this,"every",e,t,void 0,arguments)},filter(e,t){return Fc(this,"filter",e,t,o=>o.map(Ws),arguments)},find(e,t){return Fc(this,"find",e,t,Ws,arguments)},findIndex(e,t){return Fc(this,"findIndex",e,t,void 0,arguments)},findLast(e,t){return Fc(this,"findLast",e,t,Ws,arguments)},findLastIndex(e,t){return Fc(this,"findLastIndex",e,t,void 0,arguments)},forEach(e,t){return Fc(this,"forEach",e,t,void 0,arguments)},includes(...e){return u1(this,"includes",e)},indexOf(...e){return u1(this,"indexOf",e)},join(e){return Kf(this).join(e)},lastIndexOf(...e){return u1(this,"lastIndexOf",e)},map(e,t){return Fc(this,"map",e,t,void 0,arguments)},pop(){return xg(this,"pop")},push(...e){return xg(this,"push",e)},reduce(e,...t){return PA(this,"reduce",e,t)},reduceRight(e,...t){return PA(this,"reduceRight",e,t)},shift(){return xg(this,"shift")},some(e,t){return Fc(this,"some",e,t,void 0,arguments)},splice(...e){return xg(this,"splice",e)},toReversed(){return Kf(this).toReversed()},toSorted(e){return Kf(this).toSorted(e)},toSpliced(...e){return Kf(this).toSpliced(...e)},unshift(...e){return xg(this,"unshift",e)},values(){return c1(this,"values",Ws)}};function c1(e,t,o){const c=P0(e),d=c[t]();return c!==e&&!fl(e)&&(d._next=d.next,d.next=()=>{const v=d._next();return v.value&&(v.value=o(v.value)),v}),d}const bN=Array.prototype;function Fc(e,t,o,c,d,v){const y=P0(e),T=y!==e&&!fl(e),r=y[t];if(r!==bN[t]){const B=r.apply(e,v);return T?Ws(B):B}let D=o;y!==e&&(T?D=function(B,U){return o.call(this,Ws(B),U,e)}:o.length>2&&(D=function(B,U){return o.call(this,B,U,e)}));const L=r.call(y,D,c);return T&&d?d(L):L}function PA(e,t,o,c){const d=P0(e);let v=o;return d!==e&&(fl(e)?o.length>3&&(v=function(y,T,r){return o.call(this,y,T,r,e)}):v=function(y,T,r){return o.call(this,y,Ws(T),r,e)}),d[t](v,...c)}function u1(e,t,o){const c=ui(e);qs(c,"iterate",$g);const d=c[t](...o);return(d===-1||d===!1)&&yS(o[0])?(o[0]=ui(o[0]),c[t](...o)):d}function xg(e,t,o=[]){uh(),fS();const c=ui(e)[t].apply(e,o);return pS(),hh(),c}const xN=lS("__proto__,__v_isRef,__isVue"),Jk=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(ch));function wN(e){ch(e)||(e=String(e));const t=ui(this);return qs(t,"has",e),t.hasOwnProperty(e)}class Qk{constructor(t=!1,o=!1){this._isReadonly=t,this._isShallow=o}get(t,o,c){const d=this._isReadonly,v=this._isShallow;if(o==="__v_isReactive")return!d;if(o==="__v_isReadonly")return d;if(o==="__v_isShallow")return v;if(o==="__v_raw")return c===(d?v?RN:iR:v?nR:tR).get(t)||Object.getPrototypeOf(t)===Object.getPrototypeOf(c)?t:void 0;const y=wi(t);if(!d){let r;if(y&&(r=yN[o]))return r;if(o==="hasOwnProperty")return wN}const T=Reflect.get(t,o,xo(t)?t:c);return(ch(o)?Jk.has(o):xN(o))||(d||qs(t,"get",o),v)?T:xo(T)?y&&hS(o)?T:T.value:lo(T)?d?zp(T):Ls(T):T}}class eR extends Qk{constructor(t=!1){super(!1,t)}set(t,o,c,d){let v=t[o];if(!this._isShallow){const r=md(v);if(!fl(c)&&!md(c)&&(v=ui(v),c=ui(c)),!wi(t)&&xo(v)&&!xo(c))return r?!1:(v.value=c,!0)}const y=wi(t)&&hS(o)?Number(o)<t.length:Br(t,o),T=Reflect.set(t,o,c,xo(t)?t:d);return t===ui(d)&&(y?th(c,v)&&jc(t,"set",o,c):jc(t,"add",o,c)),T}deleteProperty(t,o){const c=Br(t,o);t[o];const d=Reflect.deleteProperty(t,o);return d&&c&&jc(t,"delete",o,void 0),d}has(t,o){const c=Reflect.has(t,o);return(!ch(o)||!Jk.has(o))&&qs(t,"has",o),c}ownKeys(t){return qs(t,"iterate",wi(t)?"length":hd),Reflect.ownKeys(t)}}class SN extends Qk{constructor(t=!1){super(!0,t)}set(t,o){return!0}deleteProperty(t,o){return!0}}const TN=new eR,EN=new SN,IN=new eR(!0);const K1=e=>e,yy=e=>Reflect.getPrototypeOf(e);function CN(e,t,o){return function(...c){const d=this.__v_raw,v=ui(d),y=dp(v),T=e==="entries"||e===Symbol.iterator&&y,r=e==="keys"&&y,D=d[e](...c),L=o?K1:t?J1:Ws;return!t&&qs(v,"iterate",r?Y1:hd),{next(){const{value:B,done:U}=D.next();return U?{value:B,done:U}:{value:T?[L(B[0]),L(B[1])]:L(B),done:U}},[Symbol.iterator](){return this}}}}function by(e){return function(...t){return e==="delete"?!1:e==="clear"?void 0:this}}function AN(e,t){const o={get(d){const v=this.__v_raw,y=ui(v),T=ui(d);e||(th(d,T)&&qs(y,"get",d),qs(y,"get",T));const{has:r}=yy(y),D=t?K1:e?J1:Ws;if(r.call(y,d))return D(v.get(d));if(r.call(y,T))return D(v.get(T));v!==y&&v.get(d)},get size(){const d=this.__v_raw;return!e&&qs(ui(d),"iterate",hd),Reflect.get(d,"size",d)},has(d){const v=this.__v_raw,y=ui(v),T=ui(d);return e||(th(d,T)&&qs(y,"has",d),qs(y,"has",T)),d===T?v.has(d):v.has(d)||v.has(T)},forEach(d,v){const y=this,T=y.__v_raw,r=ui(T),D=t?K1:e?J1:Ws;return!e&&qs(r,"iterate",hd),T.forEach((L,B)=>d.call(v,D(L),D(B),y))}};return Xo(o,e?{add:by("add"),set:by("set"),delete:by("delete"),clear:by("clear")}:{add(d){!t&&!fl(d)&&!md(d)&&(d=ui(d));const v=ui(this);return yy(v).has.call(v,d)||(v.add(d),jc(v,"add",d,d)),this},set(d,v){!t&&!fl(v)&&!md(v)&&(v=ui(v));const y=ui(this),{has:T,get:r}=yy(y);let D=T.call(y,d);D||(d=ui(d),D=T.call(y,d));const L=r.call(y,d);return y.set(d,v),D?th(v,L)&&jc(y,"set",d,v):jc(y,"add",d,v),this},delete(d){const v=ui(this),{has:y,get:T}=yy(v);let r=y.call(v,d);r||(d=ui(d),r=y.call(v,d)),T&&T.call(v,d);const D=v.delete(d);return r&&jc(v,"delete",d,void 0),D},clear(){const d=ui(this),v=d.size!==0,y=d.clear();return v&&jc(d,"clear",void 0,void 0),y}}),["keys","values","entries",Symbol.iterator].forEach(d=>{o[d]=CN(d,e,t)}),o}function _S(e,t){const o=AN(e,t);return(c,d,v)=>d==="__v_isReactive"?!e:d==="__v_isReadonly"?e:d==="__v_raw"?c:Reflect.get(Br(o,d)&&d in c?o:c,d,v)}const PN={get:_S(!1,!1)},MN={get:_S(!1,!0)},kN={get:_S(!0,!1)};const tR=new WeakMap,nR=new WeakMap,iR=new WeakMap,RN=new WeakMap;function DN(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function ON(e){return e.__v_skip||!Object.isExtensible(e)?0:DN(sN(e))}function Ls(e){return md(e)?e:vS(e,!1,TN,PN,tR)}function rR(e){return vS(e,!1,IN,MN,nR)}function zp(e){return vS(e,!0,EN,kN,iR)}function vS(e,t,o,c,d){if(!lo(e)||e.__v_raw&&!(t&&e.__v_isReactive))return e;const v=d.get(e);if(v)return v;const y=ON(e);if(y===0)return e;const T=new Proxy(e,y===2?c:o);return d.set(e,T),T}function fp(e){return md(e)?fp(e.__v_raw):!!(e&&e.__v_isReactive)}function md(e){return!!(e&&e.__v_isReadonly)}function fl(e){return!!(e&&e.__v_isShallow)}function yS(e){return e?!!e.__v_raw:!1}function ui(e){const t=e&&e.__v_raw;return t?ui(t):e}function oR(e){return!Br(e,"__v_skip")&&Object.isExtensible(e)&&Fk(e,"__v_skip",!0),e}const Ws=e=>lo(e)?Ls(e):e,J1=e=>lo(e)?zp(e):e;function xo(e){return e?e.__v_isRef===!0:!1}function rn(e){return sR(e,!1)}function kn(e){return sR(e,!0)}function sR(e,t){return xo(e)?e:new LN(e,t)}class LN{constructor(t,o){this.dep=new gS,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=o?t:ui(t),this._value=o?t:Ws(t),this.__v_isShallow=o}get value(){return this.dep.track(),this._value}set value(t){const o=this._rawValue,c=this.__v_isShallow||fl(t)||md(t);t=c?t:ui(t),th(t,o)&&(this._rawValue=t,this._value=c?t:Ws(t),this.dep.trigger())}}function Zo(e){return xo(e)?e.value:e}const zN={get:(e,t,o)=>t==="__v_raw"?e:Zo(Reflect.get(e,t,o)),set:(e,t,o,c)=>{const d=e[t];return xo(d)&&!xo(o)?(d.value=o,!0):Reflect.set(e,t,o,c)}};function aR(e){return fp(e)?e:new Proxy(e,zN)}function Pd(e){const t=wi(e)?new Array(e.length):{};for(const o in e)t[o]=lR(e,o);return t}class BN{constructor(t,o,c){this._object=t,this._key=o,this._defaultValue=c,this.__v_isRef=!0,this._value=void 0}get value(){const t=this._object[this._key];return this._value=t===void 0?this._defaultValue:t}set value(t){this._object[this._key]=t}get dep(){return vN(ui(this._object),this._key)}}class FN{constructor(t){this._getter=t,this.__v_isRef=!0,this.__v_isReadonly=!0,this._value=void 0}get value(){return this._value=this._getter()}}function Ht(e,t,o){return xo(e)?e:Pi(e)?new FN(e):lo(e)&&arguments.length>1?lR(e,t,o):rn(e)}function lR(e,t,o){const c=e[t];return xo(c)?c:new BN(e,t,o)}class VN{constructor(t,o,c){this.fn=t,this.setter=o,this._value=void 0,this.dep=new gS(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=jg-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!o,this.isSSR=c}notify(){if(this.flags|=16,!(this.flags&8)&&so!==this)return qk(this,!0),!0}get value(){const t=this.dep.track();return Xk(this),t&&(t.version=this.dep.version),this._value}set value(t){this.setter&&this.setter(t)}}function NN(e,t,o=!1){let c,d;return Pi(e)?c=e:(c=e.get,d=e.set),new VN(c,d,o)}const xy={},Wy=new WeakMap;let sd;function UN(e,t=!1,o=sd){if(o){let c=Wy.get(o);c||Wy.set(o,c=[]),c.push(e)}}function jN(e,t,o=eo){const{immediate:c,deep:d,once:v,scheduler:y,augmentJob:T,call:r}=o,D=be=>d?be:fl(be)||d===!1||d===0?$c(be,1):$c(be);let L,B,U,$,W=!1,q=!1;if(xo(e)?(B=()=>e.value,W=fl(e)):fp(e)?(B=()=>D(e),W=!0):wi(e)?(q=!0,W=e.some(be=>fp(be)||fl(be)),B=()=>e.map(be=>{if(xo(be))return be.value;if(fp(be))return D(be);if(Pi(be))return r?r(be,2):be()})):Pi(e)?t?B=r?()=>r(e,2):e:B=()=>{if(U){uh();try{U()}finally{hh()}}const be=sd;sd=L;try{return r?r(e,3,[$]):e($)}finally{sd=be}}:B=fc,t&&d){const be=B,ge=d===!0?1/0:d;B=()=>$c(be(),ge)}const ne=mN(),ce=()=>{L.stop(),ne&&uS(ne.effects,L)};if(v&&t){const be=t;t=(...ge)=>{be(...ge),ce()}}let oe=q?new Array(e.length).fill(xy):xy;const fe=be=>{if(!(!(L.flags&1)||!L.dirty&&!be))if(t){const ge=L.run();if(d||W||(q?ge.some((Ee,de)=>th(Ee,oe[de])):th(ge,oe))){U&&U();const Ee=sd;sd=L;try{const de=[ge,oe===xy?void 0:q&&oe[0]===xy?[]:oe,$];r?r(t,3,de):t(...de),oe=ge}finally{sd=Ee}}}else L.run()};return T&&T(fe),L=new Gk(B),L.scheduler=y?()=>y(fe,!1):fe,$=be=>UN(be,!1,L),U=L.onStop=()=>{const be=Wy.get(L);if(be){if(r)r(be,4);else for(const ge of be)ge();Wy.delete(L)}},t?c?fe(!0):oe=L.run():y?y(fe.bind(null,!0),!0):L.run(),ce.pause=L.pause.bind(L),ce.resume=L.resume.bind(L),ce.stop=ce,ce}function $c(e,t=1/0,o){if(t<=0||!lo(e)||e.__v_skip||(o=o||new Set,o.has(e)))return e;if(o.add(e),t--,xo(e))$c(e.value,t,o);else if(wi(e))for(let c=0;c<e.length;c++)$c(e[c],t,o);else if(Ok(e)||dp(e))e.forEach(c=>{$c(c,t,o)});else if(Bk(e)){for(const c in e)$c(e[c],t,o);for(const c of Object.getOwnPropertySymbols(e))Object.prototype.propertyIsEnumerable.call(e,c)&&$c(e[c],t,o)}return e}/**
* @vue/runtime-core v3.5.12
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function f_(e,t,o,c){try{return c?e(...c):e()}catch(d){p_(d,t,o)}}function Vl(e,t,o,c){if(Pi(e)){const d=f_(e,t,o,c);return d&&Lk(d)&&d.catch(v=>{p_(v,t,o)}),d}if(wi(e)){const d=[];for(let v=0;v<e.length;v++)d.push(Vl(e[v],t,o,c));return d}}function p_(e,t,o,c=!0){const d=t?t.vnode:null,{errorHandler:v,throwUnhandledErrorInProduction:y}=t&&t.appContext.config||eo;if(t){let T=t.parent;const r=t.proxy,D=`https://vuejs.org/error-reference/#runtime-${o}`;for(;T;){const L=T.ec;if(L){for(let B=0;B<L.length;B++)if(L[B](e,r,D)===!1)return}T=T.parent}if(v){uh(),f_(v,null,10,[e,r,D]),hh();return}}$N(e,o,d,c,y)}function $N(e,t,o,c=!0,d=!1){if(d)throw e;console.error(e)}const ya=[];let lc=-1;const pp=[];let qu=null,rp=0;const cR=Promise.resolve();let Zy=null;function Ki(e){const t=Zy||cR;return e?t.then(this?e.bind(this):e):t}function GN(e){let t=lc+1,o=ya.length;for(;t<o;){const c=t+o>>>1,d=ya[c],v=Gg(d);v<e||v===e&&d.flags&2?t=c+1:o=c}return t}function bS(e){if(!(e.flags&1)){const t=Gg(e),o=ya[ya.length-1];!o||!(e.flags&2)&&t>=Gg(o)?ya.push(e):ya.splice(GN(t),0,e),e.flags|=1,uR()}}function uR(){Zy||(Zy=cR.then(dR))}function Q1(e){wi(e)?pp.push(...e):qu&&e.id===-1?qu.splice(rp+1,0,e):e.flags&1||(pp.push(e),e.flags|=1),uR()}function MA(e,t,o=lc+1){for(;o<ya.length;o++){const c=ya[o];if(c&&c.flags&2){if(e&&c.id!==e.uid)continue;ya.splice(o,1),o--,c.flags&4&&(c.flags&=-2),c(),c.flags&4||(c.flags&=-2)}}}function hR(e){if(pp.length){const t=[...new Set(pp)].sort((o,c)=>Gg(o)-Gg(c));if(pp.length=0,qu){qu.push(...t);return}for(qu=t,rp=0;rp<qu.length;rp++){const o=qu[rp];o.flags&4&&(o.flags&=-2),o.flags&8||o(),o.flags&=-2}qu=null,rp=0}}const Gg=e=>e.id==null?e.flags&2?-1:1/0:e.id;function dR(e){try{for(lc=0;lc<ya.length;lc++){const t=ya[lc];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),f_(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;lc<ya.length;lc++){const t=ya[lc];t&&(t.flags&=-2)}lc=-1,ya.length=0,hR(),Zy=null,(ya.length||pp.length)&&dR()}}let Oa=null,fR=null;function Xy(e){const t=Oa;return Oa=e,fR=e&&e.type.__scopeId||null,t}function bo(e,t=Oa,o){if(!t||e._n)return e;const c=(...d)=>{c._d&&$A(-1);const v=Xy(t);let y;try{y=e(...d)}finally{Xy(v),c._d&&$A(1)}return y};return c._n=!0,c._c=!0,c._d=!0,c}function lr(e,t){if(Oa===null)return e;const o=D0(Oa),c=e.dirs||(e.dirs=[]);for(let d=0;d<t.length;d++){let[v,y,T,r=eo]=t[d];v&&(Pi(v)&&(v={mounted:v,updated:v}),v.deep&&$c(y),c.push({dir:v,instance:o,value:y,oldValue:void 0,arg:T,modifiers:r}))}return e}function Qh(e,t,o,c){const d=e.dirs,v=t&&t.dirs;for(let y=0;y<d.length;y++){const T=d[y];v&&(T.oldValue=v[y].value);let r=T.dir[c];r&&(uh(),Vl(r,o,8,[e.el,T,e,t]),hh())}}const pR=Symbol("_vte"),mR=e=>e.__isTeleport,Dg=e=>e&&(e.disabled||e.disabled===""),HN=e=>e&&(e.defer||e.defer===""),kA=e=>typeof SVGElement<"u"&&e instanceof SVGElement,RA=e=>typeof MathMLElement=="function"&&e instanceof MathMLElement,ew=(e,t)=>{const o=e&&e.to;return Do(o)?t?t(o):null:o},qN={name:"Teleport",__isTeleport:!0,process(e,t,o,c,d,v,y,T,r,D){const{mc:L,pc:B,pbc:U,o:{insert:$,querySelector:W,createText:q,createComment:ne}}=D,ce=Dg(t.props);let{shapeFlag:oe,children:fe,dynamicChildren:be}=t;if(e==null){const ge=t.el=q(""),Ee=t.anchor=q("");$(ge,o,c),$(Ee,o,c);const de=(Y,ie)=>{oe&16&&(d&&d.isCE&&(d.ce._teleportTarget=Y),L(fe,Y,ie,d,v,y,T,r))},re=()=>{const Y=t.target=ew(t.props,W),ie=gR(Y,t,q,$);Y&&(y!=="svg"&&kA(Y)?y="svg":y!=="mathml"&&RA(Y)&&(y="mathml"),ce||(de(Y,ie),Ly(t,!1)))};ce&&(de(o,Ee),Ly(t,!0)),HN(t.props)?ka(re,v):re()}else{t.el=e.el,t.targetStart=e.targetStart;const ge=t.anchor=e.anchor,Ee=t.target=e.target,de=t.targetAnchor=e.targetAnchor,re=Dg(e.props),Y=re?o:Ee,ie=re?ge:de;if(y==="svg"||kA(Ee)?y="svg":(y==="mathml"||RA(Ee))&&(y="mathml"),be?(U(e.dynamicChildren,be,Y,d,v,y,T),kS(e,t,!0)):r||B(e,t,Y,ie,d,v,y,T,!1),ce)re?t.props&&e.props&&t.props.to!==e.props.to&&(t.props.to=e.props.to):wy(t,o,ge,D,1);else if((t.props&&t.props.to)!==(e.props&&e.props.to)){const te=t.target=ew(t.props,W);te&&wy(t,te,null,D,0)}else re&&wy(t,Ee,de,D,1);Ly(t,ce)}},remove(e,t,o,{um:c,o:{remove:d}},v){const{shapeFlag:y,children:T,anchor:r,targetStart:D,targetAnchor:L,target:B,props:U}=e;if(B&&(d(D),d(L)),v&&d(r),y&16){const $=v||!Dg(U);for(let W=0;W<T.length;W++){const q=T[W];c(q,t,o,$,!!q.dynamicChildren)}}},move:wy,hydrate:WN};function wy(e,t,o,{o:{insert:c},m:d},v=2){v===0&&c(e.targetAnchor,t,o);const{el:y,anchor:T,shapeFlag:r,children:D,props:L}=e,B=v===2;if(B&&c(y,t,o),(!B||Dg(L))&&r&16)for(let U=0;U<D.length;U++)d(D[U],t,o,2);B&&c(T,t,o)}function WN(e,t,o,c,d,v,{o:{nextSibling:y,parentNode:T,querySelector:r,insert:D,createText:L}},B){const U=t.target=ew(t.props,r);if(U){const $=Dg(t.props),W=U._lpa||U.firstChild;if(t.shapeFlag&16)if($)t.anchor=B(y(e),t,T(e),o,c,d,v),t.targetStart=W,t.targetAnchor=W&&y(W);else{t.anchor=y(e);let q=W;for(;q;){if(q&&q.nodeType===8){if(q.data==="teleport start anchor")t.targetStart=q;else if(q.data==="teleport anchor"){t.targetAnchor=q,U._lpa=t.targetAnchor&&y(t.targetAnchor);break}}q=y(q)}t.targetAnchor||gR(U,t,L,D),B(W&&y(W),t,U,o,c,d,v)}Ly(t,$)}return t.anchor&&y(t.anchor)}const ZN=qN;function Ly(e,t){const o=e.ctx;if(o&&o.ut){let c,d;for(t?(c=e.el,d=e.anchor):(c=e.targetStart,d=e.targetAnchor);c&&c!==d;)c.nodeType===1&&c.setAttribute("data-v-owner",o.uid),c=c.nextSibling;o.ut()}}function gR(e,t,o,c){const d=t.targetStart=o(""),v=t.targetAnchor=o("");return d[pR]=v,e&&(c(d,e),c(v,e)),v}const Wu=Symbol("_leaveCb"),Sy=Symbol("_enterCb");function _R(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return ms(()=>{e.isMounted=!0}),Ts(()=>{e.isUnmounting=!0}),e}const hl=[Function,Array],vR={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:hl,onEnter:hl,onAfterEnter:hl,onEnterCancelled:hl,onBeforeLeave:hl,onLeave:hl,onAfterLeave:hl,onLeaveCancelled:hl,onBeforeAppear:hl,onAppear:hl,onAfterAppear:hl,onAppearCancelled:hl},yR=e=>{const t=e.subTree;return t.component?yR(t.component):t},XN={name:"BaseTransition",props:vR,setup(e,{slots:t}){const o=LS(),c=_R();return()=>{const d=t.default&&xS(t.default(),!0);if(!d||!d.length)return;const v=bR(d),y=ui(e),{mode:T}=y;if(c.isLeaving)return h1(v);const r=DA(v);if(!r)return h1(v);let D=Hg(r,y,c,o,U=>D=U);r.type!==zs&&gd(r,D);const L=o.subTree,B=L&&DA(L);if(B&&B.type!==zs&&!uc(r,B)&&yR(o).type!==zs){const U=Hg(B,y,c,o);if(gd(B,U),T==="out-in"&&r.type!==zs)return c.isLeaving=!0,U.afterLeave=()=>{c.isLeaving=!1,o.job.flags&8||o.update(),delete U.afterLeave},h1(v);T==="in-out"&&r.type!==zs&&(U.delayLeave=($,W,q)=>{const ne=xR(c,B);ne[String(B.key)]=B,$[Wu]=()=>{W(),$[Wu]=void 0,delete D.delayedLeave},D.delayedLeave=q})}return v}}};function bR(e){let t=e[0];if(e.length>1){for(const o of e)if(o.type!==zs){t=o;break}}return t}const YN=XN;function xR(e,t){const{leavingVNodes:o}=e;let c=o.get(t.type);return c||(c=Object.create(null),o.set(t.type,c)),c}function Hg(e,t,o,c,d){const{appear:v,mode:y,persisted:T=!1,onBeforeEnter:r,onEnter:D,onAfterEnter:L,onEnterCancelled:B,onBeforeLeave:U,onLeave:$,onAfterLeave:W,onLeaveCancelled:q,onBeforeAppear:ne,onAppear:ce,onAfterAppear:oe,onAppearCancelled:fe}=t,be=String(e.key),ge=xR(o,e),Ee=(Y,ie)=>{Y&&Vl(Y,c,9,ie)},de=(Y,ie)=>{const te=ie[1];Ee(Y,ie),wi(Y)?Y.every(ae=>ae.length<=1)&&te():Y.length<=1&&te()},re={mode:y,persisted:T,beforeEnter(Y){let ie=r;if(!o.isMounted)if(v)ie=ne||r;else return;Y[Wu]&&Y[Wu](!0);const te=ge[be];te&&uc(e,te)&&te.el[Wu]&&te.el[Wu](),Ee(ie,[Y])},enter(Y){let ie=D,te=L,ae=B;if(!o.isMounted)if(v)ie=ce||D,te=oe||L,ae=fe||B;else return;let pe=!1;const Le=Y[Sy]=tt=>{pe||(pe=!0,tt?Ee(ae,[Y]):Ee(te,[Y]),re.delayedLeave&&re.delayedLeave(),Y[Sy]=void 0)};ie?de(ie,[Y,Le]):Le()},leave(Y,ie){const te=String(e.key);if(Y[Sy]&&Y[Sy](!0),o.isUnmounting)return ie();Ee(U,[Y]);let ae=!1;const pe=Y[Wu]=Le=>{ae||(ae=!0,ie(),Le?Ee(q,[Y]):Ee(W,[Y]),Y[Wu]=void 0,ge[te]===e&&delete ge[te])};ge[te]=e,$?de($,[Y,pe]):pe()},clone(Y){const ie=Hg(Y,t,o,c,d);return d&&d(ie),ie}};return re}function h1(e){if(M0(e))return e=Xc(e),e.children=null,e}function DA(e){if(!M0(e))return mR(e.type)&&e.children?bR(e.children):e;const{shapeFlag:t,children:o}=e;if(o){if(t&16)return o[0];if(t&32&&Pi(o.default))return o.default()}}function gd(e,t){e.shapeFlag&6&&e.component?(e.transition=t,gd(e.component.subTree,t)):e.shapeFlag&128?(e.ssContent.transition=t.clone(e.ssContent),e.ssFallback.transition=t.clone(e.ssFallback)):e.transition=t}function xS(e,t=!1,o){let c=[],d=0;for(let v=0;v<e.length;v++){let y=e[v];const T=o==null?y.key:String(o)+String(y.key!=null?y.key:v);y.type===Gn?(y.patchFlag&128&&d++,c=c.concat(xS(y.children,t,T))):(t||y.type!==zs)&&c.push(T!=null?Xc(y,{key:T}):y)}if(d>1)for(let v=0;v<c.length;v++)c[v].patchFlag=-2;return c}/*! #__NO_SIDE_EFFECTS__ */function wS(e,t){return Pi(e)?Xo({name:e.name},t,{setup:e}):e}function wR(e){e.ids=[e.ids[0]+e.ids[2]+++"-",0,0]}function tw(e,t,o,c,d=!1){if(wi(e)){e.forEach((W,q)=>tw(W,t&&(wi(t)?t[q]:t),o,c,d));return}if(Og(c)&&!d)return;const v=c.shapeFlag&4?D0(c.component):c.el,y=d?null:v,{i:T,r}=e,D=t&&t.r,L=T.refs===eo?T.refs={}:T.refs,B=T.setupState,U=ui(B),$=B===eo?()=>!1:W=>Br(U,W);if(D!=null&&D!==r&&(Do(D)?(L[D]=null,$(D)&&(B[D]=null)):xo(D)&&(D.value=null)),Pi(r))f_(r,T,12,[y,L]);else{const W=Do(r),q=xo(r);if(W||q){const ne=()=>{if(e.f){const ce=W?$(r)?B[r]:L[r]:r.value;d?wi(ce)&&uS(ce,v):wi(ce)?ce.includes(v)||ce.push(v):W?(L[r]=[v],$(r)&&(B[r]=L[r])):(r.value=[v],e.k&&(L[e.k]=r.value))}else W?(L[r]=y,$(r)&&(B[r]=y)):q&&(r.value=y,e.k&&(L[e.k]=y))};y?(ne.id=-1,ka(ne,o)):ne()}}}C0().requestIdleCallback;C0().cancelIdleCallback;const Og=e=>!!e.type.__asyncLoader,M0=e=>e.type.__isKeepAlive;function SR(e,t){TR(e,"a",t)}function SS(e,t){TR(e,"da",t)}function TR(e,t,o=Bs){const c=e.__wdc||(e.__wdc=()=>{let d=o;for(;d;){if(d.isDeactivated)return;d=d.parent}return e()});if(k0(t,c,o),o){let d=o.parent;for(;d&&d.parent;)M0(d.parent.vnode)&&KN(c,t,o,d),d=d.parent}}function KN(e,t,o,c){const d=k0(t,e,c,!0);IS(()=>{uS(c[t],d)},o)}function k0(e,t,o=Bs,c=!1){if(o){const d=o[e]||(o[e]=[]),v=t.__weh||(t.__weh=(...y)=>{uh();const T=g_(o),r=Vl(t,o,e,y);return T(),hh(),r});return c?d.unshift(v):d.push(v),v}}const nu=e=>(t,o=Bs)=>{(!Wg||e==="sp")&&k0(e,(...c)=>t(...c),o)},TS=nu("bm"),ms=nu("m"),ER=nu("bu"),ES=nu("u"),Ts=nu("bum"),IS=nu("um"),JN=nu("sp"),QN=nu("rtg"),e5=nu("rtc");function t5(e,t=Bs){k0("ec",e,t)}const CS="components",n5="directives";function cc(e,t){return AS(CS,e,!0,t)||e}const i5=Symbol.for("v-ndc");function r5(e){return Do(e)&&AS(CS,e,!1)||e}function Ya(e){return AS(n5,e)}function AS(e,t,o=!0,c=!1){const d=Oa||Bs;if(d){const v=d.type;if(e===CS){const T=Z5(v,!1);if(T&&(T===t||T===Ba(t)||T===yc(Ba(t))))return v}const y=OA(d[e]||v[e],t)||OA(d.appContext[e],t);return!y&&c?v:y}}function OA(e,t){return e&&(e[t]||e[Ba(t)]||e[yc(Ba(t))])}function op(e,t,o,c){let d;const v=o,y=wi(e);if(y||Do(e)){const T=y&&fp(e);let r=!1;T&&(r=!fl(e),e=P0(e)),d=new Array(e.length);for(let D=0,L=e.length;D<L;D++)d[D]=t(r?Ws(e[D]):e[D],D,void 0,v)}else if(typeof e=="number"){d=new Array(e);for(let T=0;T<e;T++)d[T]=t(T+1,T,void 0,v)}else if(lo(e))if(e[Symbol.iterator])d=Array.from(e,(T,r)=>t(T,r,void 0,v));else{const T=Object.keys(e);d=new Array(T.length);for(let r=0,D=T.length;r<D;r++){const L=T[r];d[r]=t(e[L],L,r,v)}}else d=[];return d}const nw=e=>e?WR(e)?D0(e):nw(e.parent):null,Lg=Xo(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>nw(e.parent),$root:e=>nw(e.root),$host:e=>e.ce,$emit:e=>e.emit,$options:e=>PS(e),$forceUpdate:e=>e.f||(e.f=()=>{bS(e.update)}),$nextTick:e=>e.n||(e.n=Ki.bind(e.proxy)),$watch:e=>E5.bind(e)}),d1=(e,t)=>e!==eo&&!e.__isScriptSetup&&Br(e,t),o5={get({_:e},t){if(t==="__v_skip")return!0;const{ctx:o,setupState:c,data:d,props:v,accessCache:y,type:T,appContext:r}=e;let D;if(t[0]!=="$"){const $=y[t];if($!==void 0)switch($){case 1:return c[t];case 2:return d[t];case 4:return o[t];case 3:return v[t]}else{if(d1(c,t))return y[t]=1,c[t];if(d!==eo&&Br(d,t))return y[t]=2,d[t];if((D=e.propsOptions[0])&&Br(D,t))return y[t]=3,v[t];if(o!==eo&&Br(o,t))return y[t]=4,o[t];iw&&(y[t]=0)}}const L=Lg[t];let B,U;if(L)return t==="$attrs"&&qs(e.attrs,"get",""),L(e);if((B=T.__cssModules)&&(B=B[t]))return B;if(o!==eo&&Br(o,t))return y[t]=4,o[t];if(U=r.config.globalProperties,Br(U,t))return U[t]},set({_:e},t,o){const{data:c,setupState:d,ctx:v}=e;return d1(d,t)?(d[t]=o,!0):c!==eo&&Br(c,t)?(c[t]=o,!0):Br(e.props,t)||t[0]==="$"&&t.slice(1)in e?!1:(v[t]=o,!0)},has({_:{data:e,setupState:t,accessCache:o,ctx:c,appContext:d,propsOptions:v}},y){let T;return!!o[y]||e!==eo&&Br(e,y)||d1(t,y)||(T=v[0])&&Br(T,y)||Br(c,y)||Br(Lg,y)||Br(d.config.globalProperties,y)},defineProperty(e,t,o){return o.get!=null?e._.accessCache[t]=0:Br(o,"value")&&this.set(e,t,o.value,null),Reflect.defineProperty(e,t,o)}};function LA(e){return wi(e)?e.reduce((t,o)=>(t[o]=null,t),{}):e}let iw=!0;function s5(e){const t=PS(e),o=e.proxy,c=e.ctx;iw=!1,t.beforeCreate&&zA(t.beforeCreate,e,"bc");const{data:d,computed:v,methods:y,watch:T,provide:r,inject:D,created:L,beforeMount:B,mounted:U,beforeUpdate:$,updated:W,activated:q,deactivated:ne,beforeDestroy:ce,beforeUnmount:oe,destroyed:fe,unmounted:be,render:ge,renderTracked:Ee,renderTriggered:de,errorCaptured:re,serverPrefetch:Y,expose:ie,inheritAttrs:te,components:ae,directives:pe,filters:Le}=t;if(D&&a5(D,c,null),y)for(const Mt in y){const Lt=y[Mt];Pi(Lt)&&(c[Mt]=Lt.bind(o))}if(d){const Mt=d.call(o,o);lo(Mt)&&(e.data=Ls(Mt))}if(iw=!0,v)for(const Mt in v){const Lt=v[Mt],yt=Pi(Lt)?Lt.bind(o,o):Pi(Lt.get)?Lt.get.bind(o,o):fc,rt=!Pi(Lt)&&Pi(Lt.set)?Lt.set.bind(o):fc,mt=Se({get:yt,set:rt});Object.defineProperty(c,Mt,{enumerable:!0,configurable:!0,get:()=>mt.value,set:Ft=>mt.value=Ft})}if(T)for(const Mt in T)IR(T[Mt],c,o,Mt);if(r){const Mt=Pi(r)?r.call(o):r;Reflect.ownKeys(Mt).forEach(Lt=>{Vr(Lt,Mt[Lt])})}L&&zA(L,e,"c");function Je(Mt,Lt){wi(Lt)?Lt.forEach(yt=>Mt(yt.bind(o))):Lt&&Mt(Lt.bind(o))}if(Je(TS,B),Je(ms,U),Je(ER,$),Je(ES,W),Je(SR,q),Je(SS,ne),Je(t5,re),Je(e5,Ee),Je(QN,de),Je(Ts,oe),Je(IS,be),Je(JN,Y),wi(ie))if(ie.length){const Mt=e.exposed||(e.exposed={});ie.forEach(Lt=>{Object.defineProperty(Mt,Lt,{get:()=>o[Lt],set:yt=>o[Lt]=yt})})}else e.exposed||(e.exposed={});ge&&e.render===fc&&(e.render=ge),te!=null&&(e.inheritAttrs=te),ae&&(e.components=ae),pe&&(e.directives=pe),Y&&wR(e)}function a5(e,t,o=fc){wi(e)&&(e=rw(e));for(const c in e){const d=e[c];let v;lo(d)?"default"in d?v=Mi(d.from||c,d.default,!0):v=Mi(d.from||c):v=Mi(d),xo(v)?Object.defineProperty(t,c,{enumerable:!0,configurable:!0,get:()=>v.value,set:y=>v.value=y}):t[c]=v}}function zA(e,t,o){Vl(wi(e)?e.map(c=>c.bind(t.proxy)):e.bind(t.proxy),t,o)}function IR(e,t,o,c){let d=c.includes(".")?FR(o,c):()=>o[c];if(Do(e)){const v=t[e];Pi(v)&&On(d,v)}else if(Pi(e))On(d,e.bind(o));else if(lo(e))if(wi(e))e.forEach(v=>IR(v,t,o,c));else{const v=Pi(e.handler)?e.handler.bind(o):t[e.handler];Pi(v)&&On(d,v,e)}}function PS(e){const t=e.type,{mixins:o,extends:c}=t,{mixins:d,optionsCache:v,config:{optionMergeStrategies:y}}=e.appContext,T=v.get(t);let r;return T?r=T:!d.length&&!o&&!c?r=t:(r={},d.length&&d.forEach(D=>Yy(r,D,y,!0)),Yy(r,t,y)),lo(t)&&v.set(t,r),r}function Yy(e,t,o,c=!1){const{mixins:d,extends:v}=t;v&&Yy(e,v,o,!0),d&&d.forEach(y=>Yy(e,y,o,!0));for(const y in t)if(!(c&&y==="expose")){const T=l5[y]||o&&o[y];e[y]=T?T(e[y],t[y]):t[y]}return e}const l5={data:BA,props:FA,emits:FA,methods:Ig,computed:Ig,beforeCreate:ga,created:ga,beforeMount:ga,mounted:ga,beforeUpdate:ga,updated:ga,beforeDestroy:ga,beforeUnmount:ga,destroyed:ga,unmounted:ga,activated:ga,deactivated:ga,errorCaptured:ga,serverPrefetch:ga,components:Ig,directives:Ig,watch:u5,provide:BA,inject:c5};function BA(e,t){return t?e?function(){return Xo(Pi(e)?e.call(this,this):e,Pi(t)?t.call(this,this):t)}:t:e}function c5(e,t){return Ig(rw(e),rw(t))}function rw(e){if(wi(e)){const t={};for(let o=0;o<e.length;o++)t[e[o]]=e[o];return t}return e}function ga(e,t){return e?[...new Set([].concat(e,t))]:t}function Ig(e,t){return e?Xo(Object.create(null),e,t):t}function FA(e,t){return e?wi(e)&&wi(t)?[...new Set([...e,...t])]:Xo(Object.create(null),LA(e),LA(t??{})):t}function u5(e,t){if(!e)return t;if(!t)return e;const o=Xo(Object.create(null),e);for(const c in t)o[c]=ga(e[c],t[c]);return o}function CR(){return{app:null,config:{isNativeTag:rN,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let h5=0;function d5(e,t){return function(c,d=null){Pi(c)||(c=Xo({},c)),d!=null&&!lo(d)&&(d=null);const v=CR(),y=new WeakSet,T=[];let r=!1;const D=v.app={_uid:h5++,_component:c,_props:d,_container:null,_context:v,_instance:null,version:Y5,get config(){return v.config},set config(L){},use(L,...B){return y.has(L)||(L&&Pi(L.install)?(y.add(L),L.install(D,...B)):Pi(L)&&(y.add(L),L(D,...B))),D},mixin(L){return v.mixins.includes(L)||v.mixins.push(L),D},component(L,B){return B?(v.components[L]=B,D):v.components[L]},directive(L,B){return B?(v.directives[L]=B,D):v.directives[L]},mount(L,B,U){if(!r){const $=D._ceVNode||Z(c,d);return $.appContext=v,U===!0?U="svg":U===!1&&(U=void 0),B&&t?t($,L):e($,L,U),r=!0,D._container=L,L.__vue_app__=D,D0($.component)}},onUnmount(L){T.push(L)},unmount(){r&&(Vl(T,D._instance,16),e(null,D._container),delete D._container.__vue_app__)},provide(L,B){return v.provides[L]=B,D},runWithContext(L){const B=mp;mp=D;try{return L()}finally{mp=B}}};return D}}let mp=null;function Vr(e,t){if(Bs){let o=Bs.provides;const c=Bs.parent&&Bs.parent.provides;c===o&&(o=Bs.provides=Object.create(c)),o[e]=t}}function Mi(e,t,o=!1){const c=Bs||Oa;if(c||mp){const d=mp?mp._context.provides:c?c.parent==null?c.vnode.appContext&&c.vnode.appContext.provides:c.parent.provides:void 0;if(d&&e in d)return d[e];if(arguments.length>1)return o&&Pi(t)?t.call(c&&c.proxy):t}}const AR={},PR=()=>Object.create(AR),MR=e=>Object.getPrototypeOf(e)===AR;function f5(e,t,o,c=!1){const d={},v=PR();e.propsDefaults=Object.create(null),kR(e,t,d,v);for(const y in e.propsOptions[0])y in d||(d[y]=void 0);o?e.props=c?d:rR(d):e.type.props?e.props=d:e.props=v,e.attrs=v}function p5(e,t,o,c){const{props:d,attrs:v,vnode:{patchFlag:y}}=e,T=ui(d),[r]=e.propsOptions;let D=!1;if((c||y>0)&&!(y&16)){if(y&8){const L=e.vnode.dynamicProps;for(let B=0;B<L.length;B++){let U=L[B];if(R0(e.emitsOptions,U))continue;const $=t[U];if(r)if(Br(v,U))$!==v[U]&&(v[U]=$,D=!0);else{const W=Ba(U);d[W]=ow(r,T,W,$,e,!1)}else $!==v[U]&&(v[U]=$,D=!0)}}}else{kR(e,t,d,v)&&(D=!0);let L;for(const B in T)(!t||!Br(t,B)&&((L=Ad(B))===B||!Br(t,L)))&&(r?o&&(o[B]!==void 0||o[L]!==void 0)&&(d[B]=ow(r,T,B,void 0,e,!0)):delete d[B]);if(v!==T)for(const B in v)(!t||!Br(t,B))&&(delete v[B],D=!0)}D&&jc(e.attrs,"set","")}function kR(e,t,o,c){const[d,v]=e.propsOptions;let y=!1,T;if(t)for(let r in t){if(Mg(r))continue;const D=t[r];let L;d&&Br(d,L=Ba(r))?!v||!v.includes(L)?o[L]=D:(T||(T={}))[L]=D:R0(e.emitsOptions,r)||(!(r in c)||D!==c[r])&&(c[r]=D,y=!0)}if(v){const r=ui(o),D=T||eo;for(let L=0;L<v.length;L++){const B=v[L];o[B]=ow(d,r,B,D[B],e,!Br(D,B))}}return y}function ow(e,t,o,c,d,v){const y=e[o];if(y!=null){const T=Br(y,"default");if(T&&c===void 0){const r=y.default;if(y.type!==Function&&!y.skipFactory&&Pi(r)){const{propsDefaults:D}=d;if(o in D)c=D[o];else{const L=g_(d);c=D[o]=r.call(null,t),L()}}else c=r;d.ce&&d.ce._setProp(o,c)}y[0]&&(v&&!T?c=!1:y[1]&&(c===""||c===Ad(o))&&(c=!0))}return c}const m5=new WeakMap;function RR(e,t,o=!1){const c=o?m5:t.propsCache,d=c.get(e);if(d)return d;const v=e.props,y={},T=[];let r=!1;if(!Pi(e)){const L=B=>{r=!0;const[U,$]=RR(B,t,!0);Xo(y,U),$&&T.push(...$)};!o&&t.mixins.length&&t.mixins.forEach(L),e.extends&&L(e.extends),e.mixins&&e.mixins.forEach(L)}if(!v&&!r)return lo(e)&&c.set(e,hp),hp;if(wi(v))for(let L=0;L<v.length;L++){const B=Ba(v[L]);VA(B)&&(y[B]=eo)}else if(v)for(const L in v){const B=Ba(L);if(VA(B)){const U=v[L],$=y[B]=wi(U)||Pi(U)?{type:U}:Xo({},U),W=$.type;let q=!1,ne=!0;if(wi(W))for(let ce=0;ce<W.length;++ce){const oe=W[ce],fe=Pi(oe)&&oe.name;if(fe==="Boolean"){q=!0;break}else fe==="String"&&(ne=!1)}else q=Pi(W)&&W.name==="Boolean";$[0]=q,$[1]=ne,(q||Br($,"default"))&&T.push(B)}}const D=[y,T];return lo(e)&&c.set(e,D),D}function VA(e){return e[0]!=="$"&&!Mg(e)}const DR=e=>e[0]==="_"||e==="$stable",MS=e=>wi(e)?e.map(zl):[zl(e)],g5=(e,t,o)=>{if(t._n)return t;const c=bo((...d)=>MS(t(...d)),o);return c._c=!1,c},OR=(e,t,o)=>{const c=e._ctx;for(const d in e){if(DR(d))continue;const v=e[d];if(Pi(v))t[d]=g5(d,v,c);else if(v!=null){const y=MS(v);t[d]=()=>y}}},LR=(e,t)=>{const o=MS(t);e.slots.default=()=>o},zR=(e,t,o)=>{for(const c in t)(o||c!=="_")&&(e[c]=t[c])},_5=(e,t,o)=>{const c=e.slots=PR();if(e.vnode.shapeFlag&32){const d=t._;d?(zR(c,t,o),o&&Fk(c,"_",d,!0)):OR(t,c)}else t&&LR(e,t)},v5=(e,t,o)=>{const{vnode:c,slots:d}=e;let v=!0,y=eo;if(c.shapeFlag&32){const T=t._;T?o&&T===1?v=!1:zR(d,t,o):(v=!t.$stable,OR(t,d)),y=t}else t&&(LR(e,t),y={default:1});if(v)for(const T in d)!DR(T)&&y[T]==null&&delete d[T]},ka=B5;function y5(e){return b5(e)}function b5(e,t){const o=C0();o.__VUE__=!0;const{insert:c,remove:d,patchProp:v,createElement:y,createText:T,createComment:r,setText:D,setElementText:L,parentNode:B,nextSibling:U,setScopeId:$=fc,insertStaticContent:W}=e,q=(Ae,Ne,Ue,Et=null,Ct=null,Qt=null,Gt=void 0,Yt=null,vn=!!Ne.dynamicChildren)=>{if(Ae===Ne)return;Ae&&!uc(Ae,Ne)&&(Et=et(Ae),Ft(Ae,Ct,Qt,!0),Ae=null),Ne.patchFlag===-2&&(vn=!1,Ne.dynamicChildren=null);const{type:dn,ref:Wn,shapeFlag:Rn}=Ne;switch(dn){case m_:ne(Ae,Ne,Ue,Et);break;case zs:ce(Ae,Ne,Ue,Et);break;case m1:Ae==null&&oe(Ne,Ue,Et,Gt);break;case Gn:ae(Ae,Ne,Ue,Et,Ct,Qt,Gt,Yt,vn);break;default:Rn&1?ge(Ae,Ne,Ue,Et,Ct,Qt,Gt,Yt,vn):Rn&6?pe(Ae,Ne,Ue,Et,Ct,Qt,Gt,Yt,vn):(Rn&64||Rn&128)&&dn.process(Ae,Ne,Ue,Et,Ct,Qt,Gt,Yt,vn,Xt)}Wn!=null&&Ct&&tw(Wn,Ae&&Ae.ref,Qt,Ne||Ae,!Ne)},ne=(Ae,Ne,Ue,Et)=>{if(Ae==null)c(Ne.el=T(Ne.children),Ue,Et);else{const Ct=Ne.el=Ae.el;Ne.children!==Ae.children&&D(Ct,Ne.children)}},ce=(Ae,Ne,Ue,Et)=>{Ae==null?c(Ne.el=r(Ne.children||""),Ue,Et):Ne.el=Ae.el},oe=(Ae,Ne,Ue,Et)=>{[Ae.el,Ae.anchor]=W(Ae.children,Ne,Ue,Et,Ae.el,Ae.anchor)},fe=({el:Ae,anchor:Ne},Ue,Et)=>{let Ct;for(;Ae&&Ae!==Ne;)Ct=U(Ae),c(Ae,Ue,Et),Ae=Ct;c(Ne,Ue,Et)},be=({el:Ae,anchor:Ne})=>{let Ue;for(;Ae&&Ae!==Ne;)Ue=U(Ae),d(Ae),Ae=Ue;d(Ne)},ge=(Ae,Ne,Ue,Et,Ct,Qt,Gt,Yt,vn)=>{Ne.type==="svg"?Gt="svg":Ne.type==="math"&&(Gt="mathml"),Ae==null?Ee(Ne,Ue,Et,Ct,Qt,Gt,Yt,vn):Y(Ae,Ne,Ct,Qt,Gt,Yt,vn)},Ee=(Ae,Ne,Ue,Et,Ct,Qt,Gt,Yt)=>{let vn,dn;const{props:Wn,shapeFlag:Rn,transition:hn,dirs:jn}=Ae;if(vn=Ae.el=y(Ae.type,Qt,Wn&&Wn.is,Wn),Rn&8?L(vn,Ae.children):Rn&16&&re(Ae.children,vn,null,Et,Ct,f1(Ae,Qt),Gt,Yt),jn&&Qh(Ae,null,Et,"created"),de(vn,Ae,Ae.scopeId,Gt,Et),Wn){for(const ki in Wn)ki!=="value"&&!Mg(ki)&&v(vn,ki,null,Wn[ki],Qt,Et);"value"in Wn&&v(vn,"value",null,Wn.value,Qt),(dn=Wn.onVnodeBeforeMount)&&ac(dn,Et,Ae)}jn&&Qh(Ae,null,Et,"beforeMount");const ti=x5(Ct,hn);ti&&hn.beforeEnter(vn),c(vn,Ne,Ue),((dn=Wn&&Wn.onVnodeMounted)||ti||jn)&&ka(()=>{dn&&ac(dn,Et,Ae),ti&&hn.enter(vn),jn&&Qh(Ae,null,Et,"mounted")},Ct)},de=(Ae,Ne,Ue,Et,Ct)=>{if(Ue&&$(Ae,Ue),Et)for(let Qt=0;Qt<Et.length;Qt++)$(Ae,Et[Qt]);if(Ct){let Qt=Ct.subTree;if(Ne===Qt||NR(Qt.type)&&(Qt.ssContent===Ne||Qt.ssFallback===Ne)){const Gt=Ct.vnode;de(Ae,Gt,Gt.scopeId,Gt.slotScopeIds,Ct.parent)}}},re=(Ae,Ne,Ue,Et,Ct,Qt,Gt,Yt,vn=0)=>{for(let dn=vn;dn<Ae.length;dn++){const Wn=Ae[dn]=Yt?Zu(Ae[dn]):zl(Ae[dn]);q(null,Wn,Ne,Ue,Et,Ct,Qt,Gt,Yt)}},Y=(Ae,Ne,Ue,Et,Ct,Qt,Gt)=>{const Yt=Ne.el=Ae.el;let{patchFlag:vn,dynamicChildren:dn,dirs:Wn}=Ne;vn|=Ae.patchFlag&16;const Rn=Ae.props||eo,hn=Ne.props||eo;let jn;if(Ue&&ed(Ue,!1),(jn=hn.onVnodeBeforeUpdate)&&ac(jn,Ue,Ne,Ae),Wn&&Qh(Ne,Ae,Ue,"beforeUpdate"),Ue&&ed(Ue,!0),(Rn.innerHTML&&hn.innerHTML==null||Rn.textContent&&hn.textContent==null)&&L(Yt,""),dn?ie(Ae.dynamicChildren,dn,Yt,Ue,Et,f1(Ne,Ct),Qt):Gt||Lt(Ae,Ne,Yt,null,Ue,Et,f1(Ne,Ct),Qt,!1),vn>0){if(vn&16)te(Yt,Rn,hn,Ue,Ct);else if(vn&2&&Rn.class!==hn.class&&v(Yt,"class",null,hn.class,Ct),vn&4&&v(Yt,"style",Rn.style,hn.style,Ct),vn&8){const ti=Ne.dynamicProps;for(let ki=0;ki<ti.length;ki++){const gi=ti[ki],or=Rn[gi],wr=hn[gi];(wr!==or||gi==="value")&&v(Yt,gi,or,wr,Ct,Ue)}}vn&1&&Ae.children!==Ne.children&&L(Yt,Ne.children)}else!Gt&&dn==null&&te(Yt,Rn,hn,Ue,Ct);((jn=hn.onVnodeUpdated)||Wn)&&ka(()=>{jn&&ac(jn,Ue,Ne,Ae),Wn&&Qh(Ne,Ae,Ue,"updated")},Et)},ie=(Ae,Ne,Ue,Et,Ct,Qt,Gt)=>{for(let Yt=0;Yt<Ne.length;Yt++){const vn=Ae[Yt],dn=Ne[Yt],Wn=vn.el&&(vn.type===Gn||!uc(vn,dn)||vn.shapeFlag&70)?B(vn.el):Ue;q(vn,dn,Wn,null,Et,Ct,Qt,Gt,!0)}},te=(Ae,Ne,Ue,Et,Ct)=>{if(Ne!==Ue){if(Ne!==eo)for(const Qt in Ne)!Mg(Qt)&&!(Qt in Ue)&&v(Ae,Qt,Ne[Qt],null,Ct,Et);for(const Qt in Ue){if(Mg(Qt))continue;const Gt=Ue[Qt],Yt=Ne[Qt];Gt!==Yt&&Qt!=="value"&&v(Ae,Qt,Yt,Gt,Ct,Et)}"value"in Ue&&v(Ae,"value",Ne.value,Ue.value,Ct)}},ae=(Ae,Ne,Ue,Et,Ct,Qt,Gt,Yt,vn)=>{const dn=Ne.el=Ae?Ae.el:T(""),Wn=Ne.anchor=Ae?Ae.anchor:T("");let{patchFlag:Rn,dynamicChildren:hn,slotScopeIds:jn}=Ne;jn&&(Yt=Yt?Yt.concat(jn):jn),Ae==null?(c(dn,Ue,Et),c(Wn,Ue,Et),re(Ne.children||[],Ue,Wn,Ct,Qt,Gt,Yt,vn)):Rn>0&&Rn&64&&hn&&Ae.dynamicChildren?(ie(Ae.dynamicChildren,hn,Ue,Ct,Qt,Gt,Yt),(Ne.key!=null||Ct&&Ne===Ct.subTree)&&kS(Ae,Ne,!0)):Lt(Ae,Ne,Ue,Wn,Ct,Qt,Gt,Yt,vn)},pe=(Ae,Ne,Ue,Et,Ct,Qt,Gt,Yt,vn)=>{Ne.slotScopeIds=Yt,Ae==null?Ne.shapeFlag&512?Ct.ctx.activate(Ne,Ue,Et,Gt,vn):Le(Ne,Ue,Et,Ct,Qt,Gt,vn):tt(Ae,Ne,vn)},Le=(Ae,Ne,Ue,Et,Ct,Qt,Gt)=>{const Yt=Ae.component=$5(Ae,Et,Ct);if(M0(Ae)&&(Yt.ctx.renderer=Xt),G5(Yt,!1,Gt),Yt.asyncDep){if(Ct&&Ct.registerDep(Yt,Je,Gt),!Ae.el){const vn=Yt.subTree=Z(zs);ce(null,vn,Ne,Ue)}}else Je(Yt,Ae,Ne,Ue,Ct,Qt,Gt)},tt=(Ae,Ne,Ue)=>{const Et=Ne.component=Ae.component;if(k5(Ae,Ne,Ue))if(Et.asyncDep&&!Et.asyncResolved){Mt(Et,Ne,Ue);return}else Et.next=Ne,Et.update();else Ne.el=Ae.el,Et.vnode=Ne},Je=(Ae,Ne,Ue,Et,Ct,Qt,Gt)=>{const Yt=()=>{if(Ae.isMounted){let{next:Rn,bu:hn,u:jn,parent:ti,vnode:ki}=Ae;{const zr=BR(Ae);if(zr){Rn&&(Rn.el=ki.el,Mt(Ae,Rn,Gt)),zr.asyncDep.then(()=>{Ae.isUnmounted||Yt()});return}}let gi=Rn,or;ed(Ae,!1),Rn?(Rn.el=ki.el,Mt(Ae,Rn,Gt)):Rn=ki,hn&&Oy(hn),(or=Rn.props&&Rn.props.onVnodeBeforeUpdate)&&ac(or,ti,Rn,ki),ed(Ae,!0);const wr=p1(Ae),Rr=Ae.subTree;Ae.subTree=wr,q(Rr,wr,B(Rr.el),et(Rr),Ae,Ct,Qt),Rn.el=wr.el,gi===null&&DS(Ae,wr.el),jn&&ka(jn,Ct),(or=Rn.props&&Rn.props.onVnodeUpdated)&&ka(()=>ac(or,ti,Rn,ki),Ct)}else{let Rn;const{el:hn,props:jn}=Ne,{bm:ti,m:ki,parent:gi,root:or,type:wr}=Ae,Rr=Og(Ne);if(ed(Ae,!1),ti&&Oy(ti),!Rr&&(Rn=jn&&jn.onVnodeBeforeMount)&&ac(Rn,gi,Ne),ed(Ae,!0),hn&&gn){const zr=()=>{Ae.subTree=p1(Ae),gn(hn,Ae.subTree,Ae,Ct,null)};Rr&&wr.__asyncHydrate?wr.__asyncHydrate(hn,Ae,zr):zr()}else{or.ce&&or.ce._injectChildStyle(wr);const zr=Ae.subTree=p1(Ae);q(null,zr,Ue,Et,Ae,Ct,Qt),Ne.el=zr.el}if(ki&&ka(ki,Ct),!Rr&&(Rn=jn&&jn.onVnodeMounted)){const zr=Ne;ka(()=>ac(Rn,gi,zr),Ct)}(Ne.shapeFlag&256||gi&&Og(gi.vnode)&&gi.vnode.shapeFlag&256)&&Ae.a&&ka(Ae.a,Ct),Ae.isMounted=!0,Ne=Ue=Et=null}};Ae.scope.on();const vn=Ae.effect=new Gk(Yt);Ae.scope.off();const dn=Ae.update=vn.run.bind(vn),Wn=Ae.job=vn.runIfDirty.bind(vn);Wn.i=Ae,Wn.id=Ae.uid,vn.scheduler=()=>bS(Wn),ed(Ae,!0),dn()},Mt=(Ae,Ne,Ue)=>{Ne.component=Ae;const Et=Ae.vnode.props;Ae.vnode=Ne,Ae.next=null,p5(Ae,Ne.props,Et,Ue),v5(Ae,Ne.children,Ue),uh(),MA(Ae),hh()},Lt=(Ae,Ne,Ue,Et,Ct,Qt,Gt,Yt,vn=!1)=>{const dn=Ae&&Ae.children,Wn=Ae?Ae.shapeFlag:0,Rn=Ne.children,{patchFlag:hn,shapeFlag:jn}=Ne;if(hn>0){if(hn&128){rt(dn,Rn,Ue,Et,Ct,Qt,Gt,Yt,vn);return}else if(hn&256){yt(dn,Rn,Ue,Et,Ct,Qt,Gt,Yt,vn);return}}jn&8?(Wn&16&&gt(dn,Ct,Qt),Rn!==dn&&L(Ue,Rn)):Wn&16?jn&16?rt(dn,Rn,Ue,Et,Ct,Qt,Gt,Yt,vn):gt(dn,Ct,Qt,!0):(Wn&8&&L(Ue,""),jn&16&&re(Rn,Ue,Et,Ct,Qt,Gt,Yt,vn))},yt=(Ae,Ne,Ue,Et,Ct,Qt,Gt,Yt,vn)=>{Ae=Ae||hp,Ne=Ne||hp;const dn=Ae.length,Wn=Ne.length,Rn=Math.min(dn,Wn);let hn;for(hn=0;hn<Rn;hn++){const jn=Ne[hn]=vn?Zu(Ne[hn]):zl(Ne[hn]);q(Ae[hn],jn,Ue,null,Ct,Qt,Gt,Yt,vn)}dn>Wn?gt(Ae,Ct,Qt,!0,!1,Rn):re(Ne,Ue,Et,Ct,Qt,Gt,Yt,vn,Rn)},rt=(Ae,Ne,Ue,Et,Ct,Qt,Gt,Yt,vn)=>{let dn=0;const Wn=Ne.length;let Rn=Ae.length-1,hn=Wn-1;for(;dn<=Rn&&dn<=hn;){const jn=Ae[dn],ti=Ne[dn]=vn?Zu(Ne[dn]):zl(Ne[dn]);if(uc(jn,ti))q(jn,ti,Ue,null,Ct,Qt,Gt,Yt,vn);else break;dn++}for(;dn<=Rn&&dn<=hn;){const jn=Ae[Rn],ti=Ne[hn]=vn?Zu(Ne[hn]):zl(Ne[hn]);if(uc(jn,ti))q(jn,ti,Ue,null,Ct,Qt,Gt,Yt,vn);else break;Rn--,hn--}if(dn>Rn){if(dn<=hn){const jn=hn+1,ti=jn<Wn?Ne[jn].el:Et;for(;dn<=hn;)q(null,Ne[dn]=vn?Zu(Ne[dn]):zl(Ne[dn]),Ue,ti,Ct,Qt,Gt,Yt,vn),dn++}}else if(dn>hn)for(;dn<=Rn;)Ft(Ae[dn],Ct,Qt,!0),dn++;else{const jn=dn,ti=dn,ki=new Map;for(dn=ti;dn<=hn;dn++){const Sr=Ne[dn]=vn?Zu(Ne[dn]):zl(Ne[dn]);Sr.key!=null&&ki.set(Sr.key,dn)}let gi,or=0;const wr=hn-ti+1;let Rr=!1,zr=0;const dr=new Array(wr);for(dn=0;dn<wr;dn++)dr[dn]=0;for(dn=jn;dn<=Rn;dn++){const Sr=Ae[dn];if(or>=wr){Ft(Sr,Ct,Qt,!0);continue}let Tr;if(Sr.key!=null)Tr=ki.get(Sr.key);else for(gi=ti;gi<=hn;gi++)if(dr[gi-ti]===0&&uc(Sr,Ne[gi])){Tr=gi;break}Tr===void 0?Ft(Sr,Ct,Qt,!0):(dr[Tr-ti]=dn+1,Tr>=zr?zr=Tr:Rr=!0,q(Sr,Ne[Tr],Ue,null,Ct,Qt,Gt,Yt,vn),or++)}const Ho=Rr?w5(dr):hp;for(gi=Ho.length-1,dn=wr-1;dn>=0;dn--){const Sr=ti+dn,Tr=Ne[Sr],Bo=Sr+1<Wn?Ne[Sr+1].el:Et;dr[dn]===0?q(null,Tr,Ue,Bo,Ct,Qt,Gt,Yt,vn):Rr&&(gi<0||dn!==Ho[gi]?mt(Tr,Ue,Bo,2):gi--)}}},mt=(Ae,Ne,Ue,Et,Ct=null)=>{const{el:Qt,type:Gt,transition:Yt,children:vn,shapeFlag:dn}=Ae;if(dn&6){mt(Ae.component.subTree,Ne,Ue,Et);return}if(dn&128){Ae.suspense.move(Ne,Ue,Et);return}if(dn&64){Gt.move(Ae,Ne,Ue,Xt);return}if(Gt===Gn){c(Qt,Ne,Ue);for(let Rn=0;Rn<vn.length;Rn++)mt(vn[Rn],Ne,Ue,Et);c(Ae.anchor,Ne,Ue);return}if(Gt===m1){fe(Ae,Ne,Ue);return}if(Et!==2&&dn&1&&Yt)if(Et===0)Yt.beforeEnter(Qt),c(Qt,Ne,Ue),ka(()=>Yt.enter(Qt),Ct);else{const{leave:Rn,delayLeave:hn,afterLeave:jn}=Yt,ti=()=>c(Qt,Ne,Ue),ki=()=>{Rn(Qt,()=>{ti(),jn&&jn()})};hn?hn(Qt,ti,ki):ki()}else c(Qt,Ne,Ue)},Ft=(Ae,Ne,Ue,Et=!1,Ct=!1)=>{const{type:Qt,props:Gt,ref:Yt,children:vn,dynamicChildren:dn,shapeFlag:Wn,patchFlag:Rn,dirs:hn,cacheIndex:jn}=Ae;if(Rn===-2&&(Ct=!1),Yt!=null&&tw(Yt,null,Ue,Ae,!0),jn!=null&&(Ne.renderCache[jn]=void 0),Wn&256){Ne.ctx.deactivate(Ae);return}const ti=Wn&1&&hn,ki=!Og(Ae);let gi;if(ki&&(gi=Gt&&Gt.onVnodeBeforeUnmount)&&ac(gi,Ne,Ae),Wn&6)ht(Ae.component,Ue,Et);else{if(Wn&128){Ae.suspense.unmount(Ue,Et);return}ti&&Qh(Ae,null,Ne,"beforeUnmount"),Wn&64?Ae.type.remove(Ae,Ne,Ue,Xt,Et):dn&&!dn.hasOnce&&(Qt!==Gn||Rn>0&&Rn&64)?gt(dn,Ne,Ue,!1,!0):(Qt===Gn&&Rn&384||!Ct&&Wn&16)&&gt(vn,Ne,Ue),Et&&bn(Ae)}(ki&&(gi=Gt&&Gt.onVnodeUnmounted)||ti)&&ka(()=>{gi&&ac(gi,Ne,Ae),ti&&Qh(Ae,null,Ne,"unmounted")},Ue)},bn=Ae=>{const{type:Ne,el:Ue,anchor:Et,transition:Ct}=Ae;if(Ne===Gn){Bt(Ue,Et);return}if(Ne===m1){be(Ae);return}const Qt=()=>{d(Ue),Ct&&!Ct.persisted&&Ct.afterLeave&&Ct.afterLeave()};if(Ae.shapeFlag&1&&Ct&&!Ct.persisted){const{leave:Gt,delayLeave:Yt}=Ct,vn=()=>Gt(Ue,Qt);Yt?Yt(Ae.el,Qt,vn):vn()}else Qt()},Bt=(Ae,Ne)=>{let Ue;for(;Ae!==Ne;)Ue=U(Ae),d(Ae),Ae=Ue;d(Ne)},ht=(Ae,Ne,Ue)=>{const{bum:Et,scope:Ct,job:Qt,subTree:Gt,um:Yt,m:vn,a:dn}=Ae;NA(vn),NA(dn),Et&&Oy(Et),Ct.stop(),Qt&&(Qt.flags|=8,Ft(Gt,Ae,Ne,Ue)),Yt&&ka(Yt,Ne),ka(()=>{Ae.isUnmounted=!0},Ne),Ne&&Ne.pendingBranch&&!Ne.isUnmounted&&Ae.asyncDep&&!Ae.asyncResolved&&Ae.suspenseId===Ne.pendingId&&(Ne.deps--,Ne.deps===0&&Ne.resolve())},gt=(Ae,Ne,Ue,Et=!1,Ct=!1,Qt=0)=>{for(let Gt=Qt;Gt<Ae.length;Gt++)Ft(Ae[Gt],Ne,Ue,Et,Ct)},et=Ae=>{if(Ae.shapeFlag&6)return et(Ae.component.subTree);if(Ae.shapeFlag&128)return Ae.suspense.next();const Ne=U(Ae.anchor||Ae.el),Ue=Ne&&Ne[pR];return Ue?U(Ue):Ne};let Nt=!1;const St=(Ae,Ne,Ue)=>{Ae==null?Ne._vnode&&Ft(Ne._vnode,null,null,!0):q(Ne._vnode||null,Ae,Ne,null,null,null,Ue),Ne._vnode=Ae,Nt||(Nt=!0,MA(),hR(),Nt=!1)},Xt={p:q,um:Ft,m:mt,r:bn,mt:Le,mc:re,pc:Lt,pbc:ie,n:et,o:e};let Ie,gn;return{render:St,hydrate:Ie,createApp:d5(St,Ie)}}function f1({type:e,props:t},o){return o==="svg"&&e==="foreignObject"||o==="mathml"&&e==="annotation-xml"&&t&&t.encoding&&t.encoding.includes("html")?void 0:o}function ed({effect:e,job:t},o){o?(e.flags|=32,t.flags|=4):(e.flags&=-33,t.flags&=-5)}function x5(e,t){return(!e||e&&!e.pendingBranch)&&t&&!t.persisted}function kS(e,t,o=!1){const c=e.children,d=t.children;if(wi(c)&&wi(d))for(let v=0;v<c.length;v++){const y=c[v];let T=d[v];T.shapeFlag&1&&!T.dynamicChildren&&((T.patchFlag<=0||T.patchFlag===32)&&(T=d[v]=Zu(d[v]),T.el=y.el),!o&&T.patchFlag!==-2&&kS(y,T)),T.type===m_&&(T.el=y.el)}}function w5(e){const t=e.slice(),o=[0];let c,d,v,y,T;const r=e.length;for(c=0;c<r;c++){const D=e[c];if(D!==0){if(d=o[o.length-1],e[d]<D){t[c]=d,o.push(c);continue}for(v=0,y=o.length-1;v<y;)T=v+y>>1,e[o[T]]<D?v=T+1:y=T;D<e[o[v]]&&(v>0&&(t[c]=o[v-1]),o[v]=c)}}for(v=o.length,y=o[v-1];v-- >0;)o[v]=y,y=t[y];return o}function BR(e){const t=e.subTree.component;if(t)return t.asyncDep&&!t.asyncResolved?t:BR(t)}function NA(e){if(e)for(let t=0;t<e.length;t++)e[t].flags|=8}const S5=Symbol.for("v-scx"),T5=()=>Mi(S5);function Oo(e,t){return RS(e,null,t)}function On(e,t,o){return RS(e,t,o)}function RS(e,t,o=eo){const{immediate:c,deep:d,flush:v,once:y}=o,T=Xo({},o),r=t&&c||!t&&v!=="post";let D;if(Wg){if(v==="sync"){const $=T5();D=$.__watcherHandles||($.__watcherHandles=[])}else if(!r){const $=()=>{};return $.stop=fc,$.resume=fc,$.pause=fc,$}}const L=Bs;T.call=($,W,q)=>Vl($,L,W,q);let B=!1;v==="post"?T.scheduler=$=>{ka($,L&&L.suspense)}:v!=="sync"&&(B=!0,T.scheduler=($,W)=>{W?$():bS($)}),T.augmentJob=$=>{t&&($.flags|=4),B&&($.flags|=2,L&&($.id=L.uid,$.i=L))};const U=jN(e,t,T);return Wg&&(D?D.push(U):r&&U()),U}function E5(e,t,o){const c=this.proxy,d=Do(e)?e.includes(".")?FR(c,e):()=>c[e]:e.bind(c,c);let v;Pi(t)?v=t:(v=t.handler,o=t);const y=g_(this),T=RS(d,v.bind(c),o);return y(),T}function FR(e,t){const o=t.split(".");return()=>{let c=e;for(let d=0;d<o.length&&c;d++)c=c[o[d]];return c}}const I5=(e,t)=>t==="modelValue"||t==="model-value"?e.modelModifiers:e[`${t}Modifiers`]||e[`${Ba(t)}Modifiers`]||e[`${Ad(t)}Modifiers`];function C5(e,t,...o){if(e.isUnmounted)return;const c=e.vnode.props||eo;let d=o;const v=t.startsWith("update:"),y=v&&I5(c,t.slice(7));y&&(y.trim&&(d=o.map(L=>Do(L)?L.trim():L)),y.number&&(d=o.map(Z1)));let T,r=c[T=s1(t)]||c[T=s1(Ba(t))];!r&&v&&(r=c[T=s1(Ad(t))]),r&&Vl(r,e,6,d);const D=c[T+"Once"];if(D){if(!e.emitted)e.emitted={};else if(e.emitted[T])return;e.emitted[T]=!0,Vl(D,e,6,d)}}function VR(e,t,o=!1){const c=t.emitsCache,d=c.get(e);if(d!==void 0)return d;const v=e.emits;let y={},T=!1;if(!Pi(e)){const r=D=>{const L=VR(D,t,!0);L&&(T=!0,Xo(y,L))};!o&&t.mixins.length&&t.mixins.forEach(r),e.extends&&r(e.extends),e.mixins&&e.mixins.forEach(r)}return!v&&!T?(lo(e)&&c.set(e,null),null):(wi(v)?v.forEach(r=>y[r]=null):Xo(y,v),lo(e)&&c.set(e,y),y)}function R0(e,t){return!e||!T0(t)?!1:(t=t.slice(2).replace(/Once$/,""),Br(e,t[0].toLowerCase()+t.slice(1))||Br(e,Ad(t))||Br(e,t))}function p1(e){const{type:t,vnode:o,proxy:c,withProxy:d,propsOptions:[v],slots:y,attrs:T,emit:r,render:D,renderCache:L,props:B,data:U,setupState:$,ctx:W,inheritAttrs:q}=e,ne=Xy(e);let ce,oe;try{if(o.shapeFlag&4){const be=d||c,ge=be;ce=zl(D.call(ge,be,L,B,$,U,W)),oe=T}else{const be=t;ce=zl(be.length>1?be(B,{attrs:T,slots:y,emit:r}):be(B,null)),oe=t.props?T:P5(T)}}catch(be){zg.length=0,p_(be,e,1),ce=Z(zs)}let fe=ce;if(oe&&q!==!1){const be=Object.keys(oe),{shapeFlag:ge}=fe;be.length&&ge&7&&(v&&be.some(cS)&&(oe=M5(oe,v)),fe=Xc(fe,oe,!1,!0))}return o.dirs&&(fe=Xc(fe,null,!1,!0),fe.dirs=fe.dirs?fe.dirs.concat(o.dirs):o.dirs),o.transition&&gd(fe,o.transition),ce=fe,Xy(ne),ce}function A5(e,t=!0){let o;for(let c=0;c<e.length;c++){const d=e[c];if(Tp(d)){if(d.type!==zs||d.children==="v-if"){if(o)return;o=d}}else return}return o}const P5=e=>{let t;for(const o in e)(o==="class"||o==="style"||T0(o))&&((t||(t={}))[o]=e[o]);return t},M5=(e,t)=>{const o={};for(const c in e)(!cS(c)||!(c.slice(9)in t))&&(o[c]=e[c]);return o};function k5(e,t,o){const{props:c,children:d,component:v}=e,{props:y,children:T,patchFlag:r}=t,D=v.emitsOptions;if(t.dirs||t.transition)return!0;if(o&&r>=0){if(r&1024)return!0;if(r&16)return c?UA(c,y,D):!!y;if(r&8){const L=t.dynamicProps;for(let B=0;B<L.length;B++){const U=L[B];if(y[U]!==c[U]&&!R0(D,U))return!0}}}else return(d||T)&&(!T||!T.$stable)?!0:c===y?!1:c?y?UA(c,y,D):!0:!!y;return!1}function UA(e,t,o){const c=Object.keys(t);if(c.length!==Object.keys(e).length)return!0;for(let d=0;d<c.length;d++){const v=c[d];if(t[v]!==e[v]&&!R0(o,v))return!0}return!1}function DS({vnode:e,parent:t},o){for(;t;){const c=t.subTree;if(c.suspense&&c.suspense.activeBranch===e&&(c.el=e.el),c===e)(e=t.vnode).el=o,t=t.parent;else break}}const NR=e=>e.__isSuspense;let sw=0;const R5={name:"Suspense",__isSuspense:!0,process(e,t,o,c,d,v,y,T,r,D){if(e==null)D5(t,o,c,d,v,y,T,r,D);else{if(v&&v.deps>0&&!e.suspense.isInFallback){t.suspense=e.suspense,t.suspense.vnode=t,t.el=e.el;return}O5(e,t,o,c,d,y,T,r,D)}},hydrate:L5,normalize:z5},UR=R5;function qg(e,t){const o=e.props&&e.props[t];Pi(o)&&o()}function D5(e,t,o,c,d,v,y,T,r){const{p:D,o:{createElement:L}}=r,B=L("div"),U=e.suspense=jR(e,d,c,t,B,o,v,y,T,r);D(null,U.pendingBranch=e.ssContent,B,null,c,U,v,y),U.deps>0?(qg(e,"onPending"),qg(e,"onFallback"),D(null,e.ssFallback,t,o,c,null,v,y),gp(U,e.ssFallback)):U.resolve(!1,!0)}function O5(e,t,o,c,d,v,y,T,{p:r,um:D,o:{createElement:L}}){const B=t.suspense=e.suspense;B.vnode=t,t.el=e.el;const U=t.ssContent,$=t.ssFallback,{activeBranch:W,pendingBranch:q,isInFallback:ne,isHydrating:ce}=B;if(q)B.pendingBranch=U,uc(U,q)?(r(q,U,B.hiddenContainer,null,d,B,v,y,T),B.deps<=0?B.resolve():ne&&(ce||(r(W,$,o,c,d,null,v,y,T),gp(B,$)))):(B.pendingId=sw++,ce?(B.isHydrating=!1,B.activeBranch=q):D(q,d,B),B.deps=0,B.effects.length=0,B.hiddenContainer=L("div"),ne?(r(null,U,B.hiddenContainer,null,d,B,v,y,T),B.deps<=0?B.resolve():(r(W,$,o,c,d,null,v,y,T),gp(B,$))):W&&uc(U,W)?(r(W,U,o,c,d,B,v,y,T),B.resolve(!0)):(r(null,U,B.hiddenContainer,null,d,B,v,y,T),B.deps<=0&&B.resolve()));else if(W&&uc(U,W))r(W,U,o,c,d,B,v,y,T),gp(B,U);else if(qg(t,"onPending"),B.pendingBranch=U,U.shapeFlag&512?B.pendingId=U.component.suspenseId:B.pendingId=sw++,r(null,U,B.hiddenContainer,null,d,B,v,y,T),B.deps<=0)B.resolve();else{const{timeout:oe,pendingId:fe}=B;oe>0?setTimeout(()=>{B.pendingId===fe&&B.fallback($)},oe):oe===0&&B.fallback($)}}function jR(e,t,o,c,d,v,y,T,r,D,L=!1){const{p:B,m:U,um:$,n:W,o:{parentNode:q,remove:ne}}=D;let ce;const oe=F5(e);oe&&t&&t.pendingBranch&&(ce=t.pendingId,t.deps++);const fe=e.props?Vk(e.props.timeout):void 0,be=v,ge={vnode:e,parent:t,parentComponent:o,namespace:y,container:c,hiddenContainer:d,deps:0,pendingId:sw++,timeout:typeof fe=="number"?fe:-1,activeBranch:null,pendingBranch:null,isInFallback:!L,isHydrating:L,isUnmounted:!1,effects:[],resolve(Ee=!1,de=!1){const{vnode:re,activeBranch:Y,pendingBranch:ie,pendingId:te,effects:ae,parentComponent:pe,container:Le}=ge;let tt=!1;ge.isHydrating?ge.isHydrating=!1:Ee||(tt=Y&&ie.transition&&ie.transition.mode==="out-in",tt&&(Y.transition.afterLeave=()=>{te===ge.pendingId&&(U(ie,Le,v===be?W(Y):v,0),Q1(ae))}),Y&&(q(Y.el)===Le&&(v=W(Y)),$(Y,pe,ge,!0)),tt||U(ie,Le,v,0)),gp(ge,ie),ge.pendingBranch=null,ge.isInFallback=!1;let Je=ge.parent,Mt=!1;for(;Je;){if(Je.pendingBranch){Je.effects.push(...ae),Mt=!0;break}Je=Je.parent}!Mt&&!tt&&Q1(ae),ge.effects=[],oe&&t&&t.pendingBranch&&ce===t.pendingId&&(t.deps--,t.deps===0&&!de&&t.resolve()),qg(re,"onResolve")},fallback(Ee){if(!ge.pendingBranch)return;const{vnode:de,activeBranch:re,parentComponent:Y,container:ie,namespace:te}=ge;qg(de,"onFallback");const ae=W(re),pe=()=>{ge.isInFallback&&(B(null,Ee,ie,ae,Y,null,te,T,r),gp(ge,Ee))},Le=Ee.transition&&Ee.transition.mode==="out-in";Le&&(re.transition.afterLeave=pe),ge.isInFallback=!0,$(re,Y,null,!0),Le||pe()},move(Ee,de,re){ge.activeBranch&&U(ge.activeBranch,Ee,de,re),ge.container=Ee},next(){return ge.activeBranch&&W(ge.activeBranch)},registerDep(Ee,de,re){const Y=!!ge.pendingBranch;Y&&ge.deps++;const ie=Ee.vnode.el;Ee.asyncDep.catch(te=>{p_(te,Ee,0)}).then(te=>{if(Ee.isUnmounted||ge.isUnmounted||ge.pendingId!==Ee.suspenseId)return;Ee.asyncResolved=!0;const{vnode:ae}=Ee;lw(Ee,te,!1),ie&&(ae.el=ie);const pe=!ie&&Ee.subTree.el;de(Ee,ae,q(ie||Ee.subTree.el),ie?null:W(Ee.subTree),ge,y,re),pe&&ne(pe),DS(Ee,ae.el),Y&&--ge.deps===0&&ge.resolve()})},unmount(Ee,de){ge.isUnmounted=!0,ge.activeBranch&&$(ge.activeBranch,o,Ee,de),ge.pendingBranch&&$(ge.pendingBranch,o,Ee,de)}};return ge}function L5(e,t,o,c,d,v,y,T,r){const D=t.suspense=jR(t,c,o,e.parentNode,document.createElement("div"),null,d,v,y,T,!0),L=r(e,D.pendingBranch=t.ssContent,o,D,v,y);return D.deps===0&&D.resolve(!1,!0),L}function z5(e){const{shapeFlag:t,children:o}=e,c=t&32;e.ssContent=jA(c?o.default:o),e.ssFallback=c?jA(o.fallback):Z(zs)}function jA(e){let t;if(Pi(e)){const o=Sp&&e._c;o&&(e._d=!1,Vi()),e=e(),o&&(e._d=!0,t=La,$R())}return wi(e)&&(e=A5(e)),e=zl(e),t&&!e.dynamicChildren&&(e.dynamicChildren=t.filter(o=>o!==e)),e}function B5(e,t){t&&t.pendingBranch?wi(e)?t.effects.push(...e):t.effects.push(e):Q1(e)}function gp(e,t){e.activeBranch=t;const{vnode:o,parentComponent:c}=e;let d=t.el;for(;!d&&t.component;)t=t.component.subTree,d=t.el;o.el=d,c&&c.subTree===o&&(c.vnode.el=d,DS(c,d))}function F5(e){const t=e.props&&e.props.suspensible;return t!=null&&t!==!1}const Gn=Symbol.for("v-fgt"),m_=Symbol.for("v-txt"),zs=Symbol.for("v-cmt"),m1=Symbol.for("v-stc"),zg=[];let La=null;function Vi(e=!1){zg.push(La=e?null:[])}function $R(){zg.pop(),La=zg[zg.length-1]||null}let Sp=1;function $A(e){Sp+=e,e<0&&La&&(La.hasOnce=!0)}function GR(e){return e.dynamicChildren=Sp>0?La||hp:null,$R(),Sp>0&&La&&La.push(e),e}function Xi(e,t,o,c,d,v){return GR(Qn(e,t,o,c,d,v,!0))}function HR(e,t,o,c,d){return GR(Z(e,t,o,c,d,!0))}function Tp(e){return e?e.__v_isVNode===!0:!1}function uc(e,t){return e.type===t.type&&e.key===t.key}const qR=({key:e})=>e??null,zy=({ref:e,ref_key:t,ref_for:o})=>(typeof e=="number"&&(e=""+e),e!=null?Do(e)||xo(e)||Pi(e)?{i:Oa,r:e,k:t,f:!!o}:e:null);function Qn(e,t=null,o=null,c=0,d=null,v=e===Gn?0:1,y=!1,T=!1){const r={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&qR(t),ref:t&&zy(t),scopeId:fR,slotScopeIds:null,children:o,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:v,patchFlag:c,dynamicProps:d,dynamicChildren:null,appContext:null,ctx:Oa};return T?(OS(r,o),v&128&&e.normalize(r)):o&&(r.shapeFlag|=Do(o)?8:16),Sp>0&&!y&&La&&(r.patchFlag>0||v&6)&&r.patchFlag!==32&&La.push(r),r}const Z=V5;function V5(e,t=null,o=null,c=0,d=null,v=!1){if((!e||e===i5)&&(e=zs),Tp(e)){const T=Xc(e,t,!0);return o&&OS(T,o),Sp>0&&!v&&La&&(T.shapeFlag&6?La[La.indexOf(e)]=T:La.push(T)),T.patchFlag=-2,T}if(X5(e)&&(e=e.__vccOpts),t){t=N5(t);let{class:T,style:r}=t;T&&!Do(T)&&(t.class=d_(T)),lo(r)&&(yS(r)&&!wi(r)&&(r=Xo({},r)),t.style=dS(r))}const y=Do(e)?1:NR(e)?128:mR(e)?64:lo(e)?4:Pi(e)?2:0;return Qn(e,t,o,c,d,y,v,!0)}function N5(e){return e?yS(e)||MR(e)?Xo({},e):e:null}function Xc(e,t,o=!1,c=!1){const{props:d,ref:v,patchFlag:y,children:T,transition:r}=e,D=t?fn(d||{},t):d,L={__v_isVNode:!0,__v_skip:!0,type:e.type,props:D,key:D&&qR(D),ref:t&&t.ref?o&&v?wi(v)?v.concat(zy(t)):[v,zy(t)]:zy(t):v,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:T,target:e.target,targetStart:e.targetStart,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==Gn?y===-1?16:y|16:y,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:r,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&Xc(e.ssContent),ssFallback:e.ssFallback&&Xc(e.ssFallback),el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce};return r&&c&&gd(L,r.clone(L)),L}function $o(e=" ",t=0){return Z(m_,null,e,t)}function Os(e="",t=!1){return t?(Vi(),HR(zs,null,e)):Z(zs,null,e)}function zl(e){return e==null||typeof e=="boolean"?Z(zs):wi(e)?Z(Gn,null,e.slice()):Tp(e)?Zu(e):Z(m_,null,String(e))}function Zu(e){return e.el===null&&e.patchFlag!==-1||e.memo?e:Xc(e)}function OS(e,t){let o=0;const{shapeFlag:c}=e;if(t==null)t=null;else if(wi(t))o=16;else if(typeof t=="object")if(c&65){const d=t.default;d&&(d._c&&(d._d=!1),OS(e,d()),d._c&&(d._d=!0));return}else{o=32;const d=t._;!d&&!MR(t)?t._ctx=Oa:d===3&&Oa&&(Oa.slots._===1?t._=1:(t._=2,e.patchFlag|=1024))}else Pi(t)?(t={default:t,_ctx:Oa},o=32):(t=String(t),c&64?(o=16,t=[$o(t)]):o=8);e.children=t,e.shapeFlag|=o}function fn(...e){const t={};for(let o=0;o<e.length;o++){const c=e[o];for(const d in c)if(d==="class")t.class!==c.class&&(t.class=d_([t.class,c.class]));else if(d==="style")t.style=dS([t.style,c.style]);else if(T0(d)){const v=t[d],y=c[d];y&&v!==y&&!(wi(v)&&v.includes(y))&&(t[d]=v?[].concat(v,y):y)}else d!==""&&(t[d]=c[d])}return t}function ac(e,t,o,c=null){Vl(e,t,7,[o,c])}const U5=CR();let j5=0;function $5(e,t,o){const c=e.type,d=(t?t.appContext:e.appContext)||U5,v={uid:j5++,vnode:e,type:c,parent:t,appContext:d,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new $k(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(d.provides),ids:t?t.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:RR(c,d),emitsOptions:VR(c,d),emit:null,emitted:null,propsDefaults:eo,inheritAttrs:c.inheritAttrs,ctx:eo,data:eo,props:eo,attrs:eo,slots:eo,refs:eo,setupState:eo,setupContext:null,suspense:o,suspenseId:o?o.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return v.ctx={_:v},v.root=t?t.root:v,v.emit=C5.bind(null,v),e.ce&&e.ce(v),v}let Bs=null;const LS=()=>Bs||Oa;let Ky,aw;{const e=C0(),t=(o,c)=>{let d;return(d=e[o])||(d=e[o]=[]),d.push(c),v=>{d.length>1?d.forEach(y=>y(v)):d[0](v)}};Ky=t("__VUE_INSTANCE_SETTERS__",o=>Bs=o),aw=t("__VUE_SSR_SETTERS__",o=>Wg=o)}const g_=e=>{const t=Bs;return Ky(e),e.scope.on(),()=>{e.scope.off(),Ky(t)}},GA=()=>{Bs&&Bs.scope.off(),Ky(null)};function WR(e){return e.vnode.shapeFlag&4}let Wg=!1;function G5(e,t=!1,o=!1){t&&aw(t);const{props:c,children:d}=e.vnode,v=WR(e);f5(e,c,v,t),_5(e,d,o);const y=v?H5(e,t):void 0;return t&&aw(!1),y}function H5(e,t){const o=e.type;e.accessCache=Object.create(null),e.proxy=new Proxy(e.ctx,o5);const{setup:c}=o;if(c){uh();const d=e.setupContext=c.length>1?W5(e):null,v=g_(e),y=f_(c,e,0,[e.props,d]),T=Lk(y);if(hh(),v(),(T||e.sp)&&!Og(e)&&wR(e),T){if(y.then(GA,GA),t)return y.then(r=>{lw(e,r,t)}).catch(r=>{p_(r,e,0)});e.asyncDep=y}else lw(e,y,t)}else ZR(e,t)}function lw(e,t,o){Pi(t)?e.type.__ssrInlineRender?e.ssrRender=t:e.render=t:lo(t)&&(e.setupState=aR(t)),ZR(e,o)}let HA;function ZR(e,t,o){const c=e.type;if(!e.render){if(!t&&HA&&!c.render){const d=c.template||PS(e).template;if(d){const{isCustomElement:v,compilerOptions:y}=e.appContext.config,{delimiters:T,compilerOptions:r}=c,D=Xo(Xo({isCustomElement:v,delimiters:T},y),r);c.render=HA(d,D)}}e.render=c.render||fc}{const d=g_(e);uh();try{s5(e)}finally{hh(),d()}}}const q5={get(e,t){return qs(e,"get",""),e[t]}};function W5(e){const t=o=>{e.exposed=o||{}};return{attrs:new Proxy(e.attrs,q5),slots:e.slots,emit:e.emit,expose:t}}function D0(e){return e.exposed?e.exposeProxy||(e.exposeProxy=new Proxy(aR(oR(e.exposed)),{get(t,o){if(o in t)return t[o];if(o in Lg)return Lg[o](e)},has(t,o){return o in t||o in Lg}})):e.proxy}function Z5(e,t=!0){return Pi(e)?e.displayName||e.name:e.name||t&&e.__name}function X5(e){return Pi(e)&&"__vccOpts"in e}const Se=(e,t)=>NN(e,t,Wg);function Gl(e,t,o){const c=arguments.length;return c===2?lo(t)&&!wi(t)?Tp(t)?Z(e,null,[t]):Z(e,t):Z(e,null,t):(c>3?o=Array.prototype.slice.call(arguments,2):c===3&&Tp(o)&&(o=[o]),Z(e,t,o))}const Y5="3.5.12";/**
* @vue/runtime-dom v3.5.12
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let cw;const qA=typeof window<"u"&&window.trustedTypes;if(qA)try{cw=qA.createPolicy("vue",{createHTML:e=>e})}catch{}const XR=cw?e=>cw.createHTML(e):e=>e,K5="http://www.w3.org/2000/svg",J5="http://www.w3.org/1998/Math/MathML",Uc=typeof document<"u"?document:null,WA=Uc&&Uc.createElement("template"),Q5={insert:(e,t,o)=>{t.insertBefore(e,o||null)},remove:e=>{const t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,o,c)=>{const d=t==="svg"?Uc.createElementNS(K5,e):t==="mathml"?Uc.createElementNS(J5,e):o?Uc.createElement(e,{is:o}):Uc.createElement(e);return e==="select"&&c&&c.multiple!=null&&d.setAttribute("multiple",c.multiple),d},createText:e=>Uc.createTextNode(e),createComment:e=>Uc.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>Uc.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},insertStaticContent(e,t,o,c,d,v){const y=o?o.previousSibling:t.lastChild;if(d&&(d===v||d.nextSibling))for(;t.insertBefore(d.cloneNode(!0),o),!(d===v||!(d=d.nextSibling)););else{WA.innerHTML=XR(c==="svg"?`<svg>${e}</svg>`:c==="mathml"?`<math>${e}</math>`:e);const T=WA.content;if(c==="svg"||c==="mathml"){const r=T.firstChild;for(;r.firstChild;)T.appendChild(r.firstChild);T.removeChild(r)}t.insertBefore(T,o)}return[y?y.nextSibling:t.firstChild,o?o.previousSibling:t.lastChild]}},Uu="transition",wg="animation",Ep=Symbol("_vtc"),YR={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},KR=Xo({},vR,YR),e2=e=>(e.displayName="Transition",e.props=KR,e),Nl=e2((e,{slots:t})=>Gl(YN,JR(e),t)),td=(e,t=[])=>{wi(e)?e.forEach(o=>o(...t)):e&&e(...t)},ZA=e=>e?wi(e)?e.some(t=>t.length>1):e.length>1:!1;function JR(e){const t={};for(const ae in e)ae in YR||(t[ae]=e[ae]);if(e.css===!1)return t;const{name:o="v",type:c,duration:d,enterFromClass:v=`${o}-enter-from`,enterActiveClass:y=`${o}-enter-active`,enterToClass:T=`${o}-enter-to`,appearFromClass:r=v,appearActiveClass:D=y,appearToClass:L=T,leaveFromClass:B=`${o}-leave-from`,leaveActiveClass:U=`${o}-leave-active`,leaveToClass:$=`${o}-leave-to`}=e,W=t2(d),q=W&&W[0],ne=W&&W[1],{onBeforeEnter:ce,onEnter:oe,onEnterCancelled:fe,onLeave:be,onLeaveCancelled:ge,onBeforeAppear:Ee=ce,onAppear:de=oe,onAppearCancelled:re=fe}=t,Y=(ae,pe,Le)=>{Hu(ae,pe?L:T),Hu(ae,pe?D:y),Le&&Le()},ie=(ae,pe)=>{ae._isLeaving=!1,Hu(ae,B),Hu(ae,$),Hu(ae,U),pe&&pe()},te=ae=>(pe,Le)=>{const tt=ae?de:oe,Je=()=>Y(pe,ae,Le);td(tt,[pe,Je]),XA(()=>{Hu(pe,ae?r:v),Nc(pe,ae?L:T),ZA(tt)||YA(pe,c,q,Je)})};return Xo(t,{onBeforeEnter(ae){td(ce,[ae]),Nc(ae,v),Nc(ae,y)},onBeforeAppear(ae){td(Ee,[ae]),Nc(ae,r),Nc(ae,D)},onEnter:te(!1),onAppear:te(!0),onLeave(ae,pe){ae._isLeaving=!0;const Le=()=>ie(ae,pe);Nc(ae,B),Nc(ae,U),eD(),XA(()=>{ae._isLeaving&&(Hu(ae,B),Nc(ae,$),ZA(be)||YA(ae,c,ne,Le))}),td(be,[ae,Le])},onEnterCancelled(ae){Y(ae,!1),td(fe,[ae])},onAppearCancelled(ae){Y(ae,!0),td(re,[ae])},onLeaveCancelled(ae){ie(ae),td(ge,[ae])}})}function t2(e){if(e==null)return null;if(lo(e))return[g1(e.enter),g1(e.leave)];{const t=g1(e);return[t,t]}}function g1(e){return Vk(e)}function Nc(e,t){t.split(/\s+/).forEach(o=>o&&e.classList.add(o)),(e[Ep]||(e[Ep]=new Set)).add(t)}function Hu(e,t){t.split(/\s+/).forEach(c=>c&&e.classList.remove(c));const o=e[Ep];o&&(o.delete(t),o.size||(e[Ep]=void 0))}function XA(e){requestAnimationFrame(()=>{requestAnimationFrame(e)})}let n2=0;function YA(e,t,o,c){const d=e._endId=++n2,v=()=>{d===e._endId&&c()};if(o!=null)return setTimeout(v,o);const{type:y,timeout:T,propCount:r}=QR(e,t);if(!y)return c();const D=y+"end";let L=0;const B=()=>{e.removeEventListener(D,U),v()},U=$=>{$.target===e&&++L>=r&&B()};setTimeout(()=>{L<r&&B()},T+1),e.addEventListener(D,U)}function QR(e,t){const o=window.getComputedStyle(e),c=W=>(o[W]||"").split(", "),d=c(`${Uu}Delay`),v=c(`${Uu}Duration`),y=KA(d,v),T=c(`${wg}Delay`),r=c(`${wg}Duration`),D=KA(T,r);let L=null,B=0,U=0;t===Uu?y>0&&(L=Uu,B=y,U=v.length):t===wg?D>0&&(L=wg,B=D,U=r.length):(B=Math.max(y,D),L=B>0?y>D?Uu:wg:null,U=L?L===Uu?v.length:r.length:0);const $=L===Uu&&/\b(transform|all)(,|$)/.test(c(`${Uu}Property`).toString());return{type:L,timeout:B,propCount:U,hasTransform:$}}function KA(e,t){for(;e.length<t.length;)e=e.concat(e);return Math.max(...t.map((o,c)=>JA(o)+JA(e[c])))}function JA(e){return e==="auto"?0:Number(e.slice(0,-1).replace(",","."))*1e3}function eD(){return document.body.offsetHeight}function i2(e,t,o){const c=e[Ep];c&&(t=(t?[t,...c]:[...c]).join(" ")),t==null?e.removeAttribute("class"):o?e.setAttribute("class",t):e.className=t}const Jy=Symbol("_vod"),tD=Symbol("_vsh"),Hl={beforeMount(e,{value:t},{transition:o}){e[Jy]=e.style.display==="none"?"":e.style.display,o&&t?o.beforeEnter(e):Sg(e,t)},mounted(e,{value:t},{transition:o}){o&&t&&o.enter(e)},updated(e,{value:t,oldValue:o},{transition:c}){!t!=!o&&(c?t?(c.beforeEnter(e),Sg(e,!0),c.enter(e)):c.leave(e,()=>{Sg(e,!1)}):Sg(e,t))},beforeUnmount(e,{value:t}){Sg(e,t)}};function Sg(e,t){e.style.display=t?e[Jy]:"none",e[tD]=!t}const r2=Symbol(""),o2=/(^|;)\s*display\s*:/;function s2(e,t,o){const c=e.style,d=Do(o);let v=!1;if(o&&!d){if(t)if(Do(t))for(const y of t.split(";")){const T=y.slice(0,y.indexOf(":")).trim();o[T]==null&&By(c,T,"")}else for(const y in t)o[y]==null&&By(c,y,"");for(const y in o)y==="display"&&(v=!0),By(c,y,o[y])}else if(d){if(t!==o){const y=c[r2];y&&(o+=";"+y),c.cssText=o,v=o2.test(o)}}else t&&e.removeAttribute("style");Jy in e&&(e[Jy]=v?c.display:"",e[tD]&&(c.display="none"))}const QA=/\s*!important$/;function By(e,t,o){if(wi(o))o.forEach(c=>By(e,t,c));else if(o==null&&(o=""),t.startsWith("--"))e.setProperty(t,o);else{const c=a2(e,t);QA.test(o)?e.setProperty(Ad(c),o.replace(QA,""),"important"):e[c]=o}}const eP=["Webkit","Moz","ms"],_1={};function a2(e,t){const o=_1[t];if(o)return o;let c=Ba(t);if(c!=="filter"&&c in e)return _1[t]=c;c=yc(c);for(let d=0;d<eP.length;d++){const v=eP[d]+c;if(v in e)return _1[t]=v}return t}const tP="http://www.w3.org/1999/xlink";function nP(e,t,o,c,d,v=pN(t)){c&&t.startsWith("xlink:")?o==null?e.removeAttributeNS(tP,t.slice(6,t.length)):e.setAttributeNS(tP,t,o):o==null||v&&!Nk(o)?e.removeAttribute(t):e.setAttribute(t,v?"":ch(o)?String(o):o)}function iP(e,t,o,c,d){if(t==="innerHTML"||t==="textContent"){o!=null&&(e[t]=t==="innerHTML"?XR(o):o);return}const v=e.tagName;if(t==="value"&&v!=="PROGRESS"&&!v.includes("-")){const T=v==="OPTION"?e.getAttribute("value")||"":e.value,r=o==null?e.type==="checkbox"?"on":"":String(o);(T!==r||!("_value"in e))&&(e.value=r),o==null&&e.removeAttribute(t),e._value=o;return}let y=!1;if(o===""||o==null){const T=typeof e[t];T==="boolean"?o=Nk(o):o==null&&T==="string"?(o="",y=!0):T==="number"&&(o=0,y=!0)}try{e[t]=o}catch{}y&&e.removeAttribute(d||t)}function sp(e,t,o,c){e.addEventListener(t,o,c)}function l2(e,t,o,c){e.removeEventListener(t,o,c)}const rP=Symbol("_vei");function c2(e,t,o,c,d=null){const v=e[rP]||(e[rP]={}),y=v[t];if(c&&y)y.value=c;else{const[T,r]=u2(t);if(c){const D=v[t]=f2(c,d);sp(e,T,D,r)}else y&&(l2(e,T,y,r),v[t]=void 0)}}const oP=/(?:Once|Passive|Capture)$/;function u2(e){let t;if(oP.test(e)){t={};let c;for(;c=e.match(oP);)e=e.slice(0,e.length-c[0].length),t[c[0].toLowerCase()]=!0}return[e[2]===":"?e.slice(3):Ad(e.slice(2)),t]}let v1=0;const h2=Promise.resolve(),d2=()=>v1||(h2.then(()=>v1=0),v1=Date.now());function f2(e,t){const o=c=>{if(!c._vts)c._vts=Date.now();else if(c._vts<=o.attached)return;Vl(p2(c,o.value),t,5,[c])};return o.value=e,o.attached=d2(),o}function p2(e,t){if(wi(t)){const o=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{o.call(e),e._stopped=!0},t.map(c=>d=>!d._stopped&&c&&c(d))}else return t}const sP=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&e.charCodeAt(2)>96&&e.charCodeAt(2)<123,m2=(e,t,o,c,d,v)=>{const y=d==="svg";t==="class"?i2(e,c,y):t==="style"?s2(e,o,c):T0(t)?cS(t)||c2(e,t,o,c,v):(t[0]==="."?(t=t.slice(1),!0):t[0]==="^"?(t=t.slice(1),!1):g2(e,t,c,y))?(iP(e,t,c),!e.tagName.includes("-")&&(t==="value"||t==="checked"||t==="selected")&&nP(e,t,c,y,v,t!=="value")):e._isVueCE&&(/[A-Z]/.test(t)||!Do(c))?iP(e,Ba(t),c,v,t):(t==="true-value"?e._trueValue=c:t==="false-value"&&(e._falseValue=c),nP(e,t,c,y))};function g2(e,t,o,c){if(c)return!!(t==="innerHTML"||t==="textContent"||t in e&&sP(t)&&Pi(o));if(t==="spellcheck"||t==="draggable"||t==="translate"||t==="form"||t==="list"&&e.tagName==="INPUT"||t==="type"&&e.tagName==="TEXTAREA")return!1;if(t==="width"||t==="height"){const d=e.tagName;if(d==="IMG"||d==="VIDEO"||d==="CANVAS"||d==="SOURCE")return!1}return sP(t)&&Do(o)?!1:t in e}const nD=new WeakMap,iD=new WeakMap,Qy=Symbol("_moveCb"),aP=Symbol("_enterCb"),_2=e=>(delete e.props.mode,e),v2=_2({name:"TransitionGroup",props:Xo({},KR,{tag:String,moveClass:String}),setup(e,{slots:t}){const o=LS(),c=_R();let d,v;return ES(()=>{if(!d.length)return;const y=e.moveClass||`${e.name||"v"}-move`;if(!w2(d[0].el,o.vnode.el,y))return;d.forEach(y2),d.forEach(b2);const T=d.filter(x2);eD(),T.forEach(r=>{const D=r.el,L=D.style;Nc(D,y),L.transform=L.webkitTransform=L.transitionDuration="";const B=D[Qy]=U=>{U&&U.target!==D||(!U||/transform$/.test(U.propertyName))&&(D.removeEventListener("transitionend",B),D[Qy]=null,Hu(D,y))};D.addEventListener("transitionend",B)})}),()=>{const y=ui(e),T=JR(y);let r=y.tag||Gn;if(d=[],v)for(let D=0;D<v.length;D++){const L=v[D];L.el&&L.el instanceof Element&&(d.push(L),gd(L,Hg(L,T,c,o)),nD.set(L,L.el.getBoundingClientRect()))}v=t.default?xS(t.default()):[];for(let D=0;D<v.length;D++){const L=v[D];L.key!=null&&gd(L,Hg(L,T,c,o))}return Z(r,null,v)}}}),zS=v2;function y2(e){const t=e.el;t[Qy]&&t[Qy](),t[aP]&&t[aP]()}function b2(e){iD.set(e,e.el.getBoundingClientRect())}function x2(e){const t=nD.get(e),o=iD.get(e),c=t.left-o.left,d=t.top-o.top;if(c||d){const v=e.el.style;return v.transform=v.webkitTransform=`translate(${c}px,${d}px)`,v.transitionDuration="0s",e}}function w2(e,t,o){const c=e.cloneNode(),d=e[Ep];d&&d.forEach(T=>{T.split(/\s+/).forEach(r=>r&&c.classList.remove(r))}),o.split(/\s+/).forEach(T=>T&&c.classList.add(T)),c.style.display="none";const v=t.nodeType===1?t:t.parentNode;v.appendChild(c);const{hasTransform:y}=QR(c);return v.removeChild(c),y}const lP=e=>{const t=e.props["onUpdate:modelValue"]||!1;return wi(t)?o=>Oy(t,o):t};function S2(e){e.target.composing=!0}function cP(e){const t=e.target;t.composing&&(t.composing=!1,t.dispatchEvent(new Event("input")))}const y1=Symbol("_assign"),pl={created(e,{modifiers:{lazy:t,trim:o,number:c}},d){e[y1]=lP(d);const v=c||d.props&&d.props.type==="number";sp(e,t?"change":"input",y=>{if(y.target.composing)return;let T=e.value;o&&(T=T.trim()),v&&(T=Z1(T)),e[y1](T)}),o&&sp(e,"change",()=>{e.value=e.value.trim()}),t||(sp(e,"compositionstart",S2),sp(e,"compositionend",cP),sp(e,"change",cP))},mounted(e,{value:t}){e.value=t??""},beforeUpdate(e,{value:t,oldValue:o,modifiers:{lazy:c,trim:d,number:v}},y){if(e[y1]=lP(y),e.composing)return;const T=(v||e.type==="number")&&!/^0\d/.test(e.value)?Z1(e.value):e.value,r=t??"";T!==r&&(document.activeElement===e&&e.type!=="range"&&(c&&t===o||d&&e.value.trim()===r)||(e.value=r))}},T2=["ctrl","shift","alt","meta"],E2={stop:e=>e.stopPropagation(),prevent:e=>e.preventDefault(),self:e=>e.target!==e.currentTarget,ctrl:e=>!e.ctrlKey,shift:e=>!e.shiftKey,alt:e=>!e.altKey,meta:e=>!e.metaKey,left:e=>"button"in e&&e.button!==0,middle:e=>"button"in e&&e.button!==1,right:e=>"button"in e&&e.button!==2,exact:(e,t)=>T2.some(o=>e[`${o}Key`]&&!t.includes(o))},nh=(e,t)=>{const o=e._withMods||(e._withMods={}),c=t.join(".");return o[c]||(o[c]=(d,...v)=>{for(let y=0;y<t.length;y++){const T=E2[t[y]];if(T&&T(d,t))return}return e(d,...v)})},I2=Xo({patchProp:m2},Q5);let uP;function rD(){return uP||(uP=y5(I2))}const oD=(...e)=>{rD().render(...e)},C2=(...e)=>{const t=rD().createApp(...e),{mount:o}=t;return t.mount=c=>{const d=P2(c);if(!d)return;const v=t._component;!Pi(v)&&!v.render&&!v.template&&(v.template=d.innerHTML),d.nodeType===1&&(d.textContent="");const y=o(d,!1,A2(d));return d instanceof Element&&(d.removeAttribute("v-cloak"),d.setAttribute("data-v-app","")),y},t};function A2(e){if(e instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&e instanceof MathMLElement)return"mathml"}function P2(e){return Do(e)?document.querySelector(e):e}var hP={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sD=function(e){const t=[];let o=0;for(let c=0;c<e.length;c++){let d=e.charCodeAt(c);d<128?t[o++]=d:d<2048?(t[o++]=d>>6|192,t[o++]=d&63|128):(d&64512)===55296&&c+1<e.length&&(e.charCodeAt(c+1)&64512)===56320?(d=65536+((d&1023)<<10)+(e.charCodeAt(++c)&1023),t[o++]=d>>18|240,t[o++]=d>>12&63|128,t[o++]=d>>6&63|128,t[o++]=d&63|128):(t[o++]=d>>12|224,t[o++]=d>>6&63|128,t[o++]=d&63|128)}return t},M2=function(e){const t=[];let o=0,c=0;for(;o<e.length;){const d=e[o++];if(d<128)t[c++]=String.fromCharCode(d);else if(d>191&&d<224){const v=e[o++];t[c++]=String.fromCharCode((d&31)<<6|v&63)}else if(d>239&&d<365){const v=e[o++],y=e[o++],T=e[o++],r=((d&7)<<18|(v&63)<<12|(y&63)<<6|T&63)-65536;t[c++]=String.fromCharCode(55296+(r>>10)),t[c++]=String.fromCharCode(56320+(r&1023))}else{const v=e[o++],y=e[o++];t[c++]=String.fromCharCode((d&15)<<12|(v&63)<<6|y&63)}}return t.join("")},aD={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const o=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,c=[];for(let d=0;d<e.length;d+=3){const v=e[d],y=d+1<e.length,T=y?e[d+1]:0,r=d+2<e.length,D=r?e[d+2]:0,L=v>>2,B=(v&3)<<4|T>>4;let U=(T&15)<<2|D>>6,$=D&63;r||($=64,y||(U=64)),c.push(o[L],o[B],o[U],o[$])}return c.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(sD(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):M2(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const o=t?this.charToByteMapWebSafe_:this.charToByteMap_,c=[];for(let d=0;d<e.length;){const v=o[e.charAt(d++)],T=d<e.length?o[e.charAt(d)]:0;++d;const D=d<e.length?o[e.charAt(d)]:64;++d;const B=d<e.length?o[e.charAt(d)]:64;if(++d,v==null||T==null||D==null||B==null)throw new k2;const U=v<<2|T>>4;if(c.push(U),D!==64){const $=T<<4&240|D>>2;if(c.push($),B!==64){const W=D<<6&192|B;c.push(W)}}}return c},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class k2 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const R2=function(e){const t=sD(e);return aD.encodeByteArray(t,!0)},e0=function(e){return R2(e).replace(/\./g,"")},lD=function(e){try{return aD.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D2(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O2=()=>D2().__FIREBASE_DEFAULTS__,L2=()=>{if(typeof process>"u"||typeof hP>"u")return;const e=hP.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},z2=()=>{if(typeof document>"u")return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=e&&lD(e[1]);return t&&JSON.parse(t)},BS=()=>{try{return O2()||L2()||z2()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},cD=e=>{var t,o;return(o=(t=BS())===null||t===void 0?void 0:t.emulatorHosts)===null||o===void 0?void 0:o[e]},uD=e=>{const t=cD(e);if(!t)return;const o=t.lastIndexOf(":");if(o<=0||o+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const c=parseInt(t.substring(o+1),10);return t[0]==="["?[t.substring(1,o-1),c]:[t.substring(0,o),c]},hD=()=>{var e;return(e=BS())===null||e===void 0?void 0:e.config},dD=e=>{var t;return(t=BS())===null||t===void 0?void 0:t[`_${e}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B2{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,o)=>{this.resolve=t,this.reject=o})}wrapCallback(t){return(o,c)=>{o?this.reject(o):this.resolve(c),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(o):t(o,c))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F2(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const o={alg:"none",type:"JWT"},c=t||"demo-project",d=e.iat||0,v=e.sub||e.user_id;if(!v)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const y=Object.assign({iss:`https://securetoken.google.com/${c}`,aud:c,iat:d,exp:d+3600,auth_time:d,sub:v,user_id:v,firebase:{sign_in_provider:"custom",identities:{}}},e);return[e0(JSON.stringify(o)),e0(JSON.stringify(y)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ba(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function V2(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ba())}function N2(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function U2(){const e=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof e=="object"&&e.id!==void 0}function j2(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function $2(){const e=ba();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function G2(){try{return typeof indexedDB=="object"}catch{return!1}}function H2(){return new Promise((e,t)=>{try{let o=!0;const c="validate-browser-context-for-indexeddb-analytics-module",d=self.indexedDB.open(c);d.onsuccess=()=>{d.result.close(),o||self.indexedDB.deleteDatabase(c),e(!0)},d.onupgradeneeded=()=>{o=!1},d.onerror=()=>{var v;t(((v=d.error)===null||v===void 0?void 0:v.message)||"")}}catch(o){t(o)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q2="FirebaseError";class bc extends Error{constructor(t,o,c){super(o),this.code=t,this.customData=c,this.name=q2,Object.setPrototypeOf(this,bc.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,__.prototype.create)}}class __{constructor(t,o,c){this.service=t,this.serviceName=o,this.errors=c}create(t,...o){const c=o[0]||{},d=`${this.service}/${t}`,v=this.errors[t],y=v?W2(v,c):"Error",T=`${this.serviceName}: ${y} (${d}).`;return new bc(d,T,c)}}function W2(e,t){return e.replace(Z2,(o,c)=>{const d=t[c];return d!=null?String(d):`<${c}?>`})}const Z2=/\{\$([^}]+)}/g;function X2(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function t0(e,t){if(e===t)return!0;const o=Object.keys(e),c=Object.keys(t);for(const d of o){if(!c.includes(d))return!1;const v=e[d],y=t[d];if(dP(v)&&dP(y)){if(!t0(v,y))return!1}else if(v!==y)return!1}for(const d of c)if(!o.includes(d))return!1;return!0}function dP(e){return e!==null&&typeof e=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function v_(e){const t=[];for(const[o,c]of Object.entries(e))Array.isArray(c)?c.forEach(d=>{t.push(encodeURIComponent(o)+"="+encodeURIComponent(d))}):t.push(encodeURIComponent(o)+"="+encodeURIComponent(c));return t.length?"&"+t.join("&"):""}function Cg(e){const t={};return e.replace(/^\?/,"").split("&").forEach(c=>{if(c){const[d,v]=c.split("=");t[decodeURIComponent(d)]=decodeURIComponent(v)}}),t}function Ag(e){const t=e.indexOf("?");if(!t)return"";const o=e.indexOf("#",t);return e.substring(t,o>0?o:void 0)}function Y2(e,t){const o=new K2(e,t);return o.subscribe.bind(o)}class K2{constructor(t,o){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=o,this.task.then(()=>{t(this)}).catch(c=>{this.error(c)})}next(t){this.forEachObserver(o=>{o.next(t)})}error(t){this.forEachObserver(o=>{o.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,o,c){let d;if(t===void 0&&o===void 0&&c===void 0)throw new Error("Missing Observer.");J2(t,["next","error","complete"])?d=t:d={next:t,error:o,complete:c},d.next===void 0&&(d.next=b1),d.error===void 0&&(d.error=b1),d.complete===void 0&&(d.complete=b1);const v=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?d.error(this.finalError):d.complete()}catch{}}),this.observers.push(d),v}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let o=0;o<this.observers.length;o++)this.sendOne(o,t)}sendOne(t,o){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{o(this.observers[t])}catch(c){typeof console<"u"&&console.error&&console.error(c)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function J2(e,t){if(typeof e!="object"||e===null)return!1;for(const o of t)if(o in e&&typeof e[o]=="function")return!0;return!1}function b1(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gl(e){return e&&e._delegate?e._delegate:e}class oh{constructor(t,o,c){this.name=t,this.instanceFactory=o,this.type=c,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ad="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q2{constructor(t,o){this.name=t,this.container=o,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const o=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(o)){const c=new B2;if(this.instancesDeferred.set(o,c),this.isInitialized(o)||this.shouldAutoInitialize())try{const d=this.getOrInitializeService({instanceIdentifier:o});d&&c.resolve(d)}catch{}}return this.instancesDeferred.get(o).promise}getImmediate(t){var o;const c=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),d=(o=t==null?void 0:t.optional)!==null&&o!==void 0?o:!1;if(this.isInitialized(c)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:c})}catch(v){if(d)return null;throw v}else{if(d)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(t6(t))try{this.getOrInitializeService({instanceIdentifier:ad})}catch{}for(const[o,c]of this.instancesDeferred.entries()){const d=this.normalizeInstanceIdentifier(o);try{const v=this.getOrInitializeService({instanceIdentifier:d});c.resolve(v)}catch{}}}}clearInstance(t=ad){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(o=>"INTERNAL"in o).map(o=>o.INTERNAL.delete()),...t.filter(o=>"_delete"in o).map(o=>o._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=ad){return this.instances.has(t)}getOptions(t=ad){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:o={}}=t,c=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(c))throw Error(`${this.name}(${c}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const d=this.getOrInitializeService({instanceIdentifier:c,options:o});for(const[v,y]of this.instancesDeferred.entries()){const T=this.normalizeInstanceIdentifier(v);c===T&&y.resolve(d)}return d}onInit(t,o){var c;const d=this.normalizeInstanceIdentifier(o),v=(c=this.onInitCallbacks.get(d))!==null&&c!==void 0?c:new Set;v.add(t),this.onInitCallbacks.set(d,v);const y=this.instances.get(d);return y&&t(y,d),()=>{v.delete(t)}}invokeOnInitCallbacks(t,o){const c=this.onInitCallbacks.get(o);if(c)for(const d of c)try{d(t,o)}catch{}}getOrInitializeService({instanceIdentifier:t,options:o={}}){let c=this.instances.get(t);if(!c&&this.component&&(c=this.component.instanceFactory(this.container,{instanceIdentifier:e6(t),options:o}),this.instances.set(t,c),this.instancesOptions.set(t,o),this.invokeOnInitCallbacks(c,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,c)}catch{}return c||null}normalizeInstanceIdentifier(t=ad){return this.component?this.component.multipleInstances?t:ad:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function e6(e){return e===ad?void 0:e}function t6(e){return e.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n6{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const o=this.getProvider(t.name);if(o.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);o.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const o=new Q2(t,this);return this.providers.set(t,o),o}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Fr;(function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"})(Fr||(Fr={}));const i6={debug:Fr.DEBUG,verbose:Fr.VERBOSE,info:Fr.INFO,warn:Fr.WARN,error:Fr.ERROR,silent:Fr.SILENT},r6=Fr.INFO,o6={[Fr.DEBUG]:"log",[Fr.VERBOSE]:"log",[Fr.INFO]:"info",[Fr.WARN]:"warn",[Fr.ERROR]:"error"},s6=(e,t,...o)=>{if(t<e.logLevel)return;const c=new Date().toISOString(),d=o6[t];if(d)console[d](`[${c}]  ${e.name}:`,...o);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class FS{constructor(t){this.name=t,this._logLevel=r6,this._logHandler=s6,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in Fr))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?i6[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,Fr.DEBUG,...t),this._logHandler(this,Fr.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,Fr.VERBOSE,...t),this._logHandler(this,Fr.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,Fr.INFO,...t),this._logHandler(this,Fr.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,Fr.WARN,...t),this._logHandler(this,Fr.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,Fr.ERROR,...t),this._logHandler(this,Fr.ERROR,...t)}}const a6=(e,t)=>t.some(o=>e instanceof o);let fP,pP;function l6(){return fP||(fP=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function c6(){return pP||(pP=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const fD=new WeakMap,uw=new WeakMap,pD=new WeakMap,x1=new WeakMap,VS=new WeakMap;function u6(e){const t=new Promise((o,c)=>{const d=()=>{e.removeEventListener("success",v),e.removeEventListener("error",y)},v=()=>{o(ih(e.result)),d()},y=()=>{c(e.error),d()};e.addEventListener("success",v),e.addEventListener("error",y)});return t.then(o=>{o instanceof IDBCursor&&fD.set(o,e)}).catch(()=>{}),VS.set(t,e),t}function h6(e){if(uw.has(e))return;const t=new Promise((o,c)=>{const d=()=>{e.removeEventListener("complete",v),e.removeEventListener("error",y),e.removeEventListener("abort",y)},v=()=>{o(),d()},y=()=>{c(e.error||new DOMException("AbortError","AbortError")),d()};e.addEventListener("complete",v),e.addEventListener("error",y),e.addEventListener("abort",y)});uw.set(e,t)}let hw={get(e,t,o){if(e instanceof IDBTransaction){if(t==="done")return uw.get(e);if(t==="objectStoreNames")return e.objectStoreNames||pD.get(e);if(t==="store")return o.objectStoreNames[1]?void 0:o.objectStore(o.objectStoreNames[0])}return ih(e[t])},set(e,t,o){return e[t]=o,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function d6(e){hw=e(hw)}function f6(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...o){const c=e.call(w1(this),t,...o);return pD.set(c,t.sort?t.sort():[t]),ih(c)}:c6().includes(e)?function(...t){return e.apply(w1(this),t),ih(fD.get(this))}:function(...t){return ih(e.apply(w1(this),t))}}function p6(e){return typeof e=="function"?f6(e):(e instanceof IDBTransaction&&h6(e),a6(e,l6())?new Proxy(e,hw):e)}function ih(e){if(e instanceof IDBRequest)return u6(e);if(x1.has(e))return x1.get(e);const t=p6(e);return t!==e&&(x1.set(e,t),VS.set(t,e)),t}const w1=e=>VS.get(e);function m6(e,t,{blocked:o,upgrade:c,blocking:d,terminated:v}={}){const y=indexedDB.open(e,t),T=ih(y);return c&&y.addEventListener("upgradeneeded",r=>{c(ih(y.result),r.oldVersion,r.newVersion,ih(y.transaction),r)}),o&&y.addEventListener("blocked",r=>o(r.oldVersion,r.newVersion,r)),T.then(r=>{v&&r.addEventListener("close",()=>v()),d&&r.addEventListener("versionchange",D=>d(D.oldVersion,D.newVersion,D))}).catch(()=>{}),T}const g6=["get","getKey","getAll","getAllKeys","count"],_6=["put","add","delete","clear"],S1=new Map;function mP(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(S1.get(t))return S1.get(t);const o=t.replace(/FromIndex$/,""),c=t!==o,d=_6.includes(o);if(!(o in(c?IDBIndex:IDBObjectStore).prototype)||!(d||g6.includes(o)))return;const v=async function(y,...T){const r=this.transaction(y,d?"readwrite":"readonly");let D=r.store;return c&&(D=D.index(T.shift())),(await Promise.all([D[o](...T),d&&r.done]))[0]};return S1.set(t,v),v}d6(e=>({...e,get:(t,o,c)=>mP(t,o)||e.get(t,o,c),has:(t,o)=>!!mP(t,o)||e.has(t,o)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v6{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(o=>{if(y6(o)){const c=o.getImmediate();return`${c.library}/${c.version}`}else return null}).filter(o=>o).join(" ")}}function y6(e){const t=e.getComponent();return(t==null?void 0:t.type)==="VERSION"}const dw="@firebase/app",gP="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yc=new FS("@firebase/app"),b6="@firebase/app-compat",x6="@firebase/analytics-compat",w6="@firebase/analytics",S6="@firebase/app-check-compat",T6="@firebase/app-check",E6="@firebase/auth",I6="@firebase/auth-compat",C6="@firebase/database",A6="@firebase/data-connect",P6="@firebase/database-compat",M6="@firebase/functions",k6="@firebase/functions-compat",R6="@firebase/installations",D6="@firebase/installations-compat",O6="@firebase/messaging",L6="@firebase/messaging-compat",z6="@firebase/performance",B6="@firebase/performance-compat",F6="@firebase/remote-config",V6="@firebase/remote-config-compat",N6="@firebase/storage",U6="@firebase/storage-compat",j6="@firebase/firestore",$6="@firebase/vertexai-preview",G6="@firebase/firestore-compat",H6="firebase",q6="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fw="[DEFAULT]",W6={[dw]:"fire-core",[b6]:"fire-core-compat",[w6]:"fire-analytics",[x6]:"fire-analytics-compat",[T6]:"fire-app-check",[S6]:"fire-app-check-compat",[E6]:"fire-auth",[I6]:"fire-auth-compat",[C6]:"fire-rtdb",[A6]:"fire-data-connect",[P6]:"fire-rtdb-compat",[M6]:"fire-fn",[k6]:"fire-fn-compat",[R6]:"fire-iid",[D6]:"fire-iid-compat",[O6]:"fire-fcm",[L6]:"fire-fcm-compat",[z6]:"fire-perf",[B6]:"fire-perf-compat",[F6]:"fire-rc",[V6]:"fire-rc-compat",[N6]:"fire-gcs",[U6]:"fire-gcs-compat",[j6]:"fire-fst",[G6]:"fire-fst-compat",[$6]:"fire-vertex","fire-js":"fire-js",[H6]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n0=new Map,Z6=new Map,pw=new Map;function _P(e,t){try{e.container.addComponent(t)}catch(o){Yc.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,o)}}function _d(e){const t=e.name;if(pw.has(t))return Yc.debug(`There were multiple attempts to register component ${t}.`),!1;pw.set(t,e);for(const o of n0.values())_P(o,e);for(const o of Z6.values())_P(o,e);return!0}function O0(e,t){const o=e.container.getProvider("heartbeat").getImmediate({optional:!0});return o&&o.triggerHeartbeat(),e.container.getProvider(t)}function hc(e){return e.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X6={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},rh=new __("app","Firebase",X6);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y6{constructor(t,o,c){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},o),this._name=o.name,this._automaticDataCollectionEnabled=o.automaticDataCollectionEnabled,this._container=c,this.container.addComponent(new oh("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw rh.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bp=q6;function mD(e,t={}){let o=e;typeof t!="object"&&(t={name:t});const c=Object.assign({name:fw,automaticDataCollectionEnabled:!1},t),d=c.name;if(typeof d!="string"||!d)throw rh.create("bad-app-name",{appName:String(d)});if(o||(o=hD()),!o)throw rh.create("no-options");const v=n0.get(d);if(v){if(t0(o,v.options)&&t0(c,v.config))return v;throw rh.create("duplicate-app",{appName:d})}const y=new n6(d);for(const r of pw.values())y.addComponent(r);const T=new Y6(o,c,y);return n0.set(d,T),T}function NS(e=fw){const t=n0.get(e);if(!t&&e===fw&&hD())return mD();if(!t)throw rh.create("no-app",{appName:e});return t}function pc(e,t,o){var c;let d=(c=W6[e])!==null&&c!==void 0?c:e;o&&(d+=`-${o}`);const v=d.match(/\s|\//),y=t.match(/\s|\//);if(v||y){const T=[`Unable to register library "${d}" with version "${t}":`];v&&T.push(`library name "${d}" contains illegal characters (whitespace or "/")`),v&&y&&T.push("and"),y&&T.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Yc.warn(T.join(" "));return}_d(new oh(`${d}-version`,()=>({library:d,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K6="firebase-heartbeat-database",J6=1,Zg="firebase-heartbeat-store";let T1=null;function gD(){return T1||(T1=m6(K6,J6,{upgrade:(e,t)=>{switch(t){case 0:try{e.createObjectStore(Zg)}catch(o){console.warn(o)}}}}).catch(e=>{throw rh.create("idb-open",{originalErrorMessage:e.message})})),T1}async function Q6(e){try{const o=(await gD()).transaction(Zg),c=await o.objectStore(Zg).get(_D(e));return await o.done,c}catch(t){if(t instanceof bc)Yc.warn(t.message);else{const o=rh.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});Yc.warn(o.message)}}}async function vP(e,t){try{const c=(await gD()).transaction(Zg,"readwrite");await c.objectStore(Zg).put(t,_D(e)),await c.done}catch(o){if(o instanceof bc)Yc.warn(o.message);else{const c=rh.create("idb-set",{originalErrorMessage:o==null?void 0:o.message});Yc.warn(c.message)}}}function _D(e){return`${e.name}!${e.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eU=1024,tU=30*24*60*60*1e3;class nU{constructor(t){this.container=t,this._heartbeatsCache=null;const o=this.container.getProvider("app").getImmediate();this._storage=new rU(o),this._heartbeatsCachePromise=this._storage.read().then(c=>(this._heartbeatsCache=c,c))}async triggerHeartbeat(){var t,o;try{const d=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),v=yP();return((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((o=this._heartbeatsCache)===null||o===void 0?void 0:o.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===v||this._heartbeatsCache.heartbeats.some(y=>y.date===v)?void 0:(this._heartbeatsCache.heartbeats.push({date:v,agent:d}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(y=>{const T=new Date(y.date).valueOf();return Date.now()-T<=tU}),this._storage.overwrite(this._heartbeatsCache))}catch(c){Yc.warn(c)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const o=yP(),{heartbeatsToSend:c,unsentEntries:d}=iU(this._heartbeatsCache.heartbeats),v=e0(JSON.stringify({version:2,heartbeats:c}));return this._heartbeatsCache.lastSentHeartbeatDate=o,d.length>0?(this._heartbeatsCache.heartbeats=d,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),v}catch(o){return Yc.warn(o),""}}}function yP(){return new Date().toISOString().substring(0,10)}function iU(e,t=eU){const o=[];let c=e.slice();for(const d of e){const v=o.find(y=>y.agent===d.agent);if(v){if(v.dates.push(d.date),bP(o)>t){v.dates.pop();break}}else if(o.push({agent:d.agent,dates:[d.date]}),bP(o)>t){o.pop();break}c=c.slice(1)}return{heartbeatsToSend:o,unsentEntries:c}}class rU{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return G2()?H2().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const o=await Q6(this.app);return o!=null&&o.heartbeats?o:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){var o;if(await this._canUseIndexedDBPromise){const d=await this.read();return vP(this.app,{lastSentHeartbeatDate:(o=t.lastSentHeartbeatDate)!==null&&o!==void 0?o:d.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var o;if(await this._canUseIndexedDBPromise){const d=await this.read();return vP(this.app,{lastSentHeartbeatDate:(o=t.lastSentHeartbeatDate)!==null&&o!==void 0?o:d.lastSentHeartbeatDate,heartbeats:[...d.heartbeats,...t.heartbeats]})}else return}}function bP(e){return e0(JSON.stringify({version:2,heartbeats:e})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oU(e){_d(new oh("platform-logger",t=>new v6(t),"PRIVATE")),_d(new oh("heartbeat",t=>new nU(t),"PRIVATE")),pc(dw,gP,e),pc(dw,gP,"esm2017"),pc("fire-js","")}oU("");function US(e,t){var o={};for(var c in e)Object.prototype.hasOwnProperty.call(e,c)&&t.indexOf(c)<0&&(o[c]=e[c]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,c=Object.getOwnPropertySymbols(e);d<c.length;d++)t.indexOf(c[d])<0&&Object.prototype.propertyIsEnumerable.call(e,c[d])&&(o[c[d]]=e[c[d]]);return o}function vD(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const sU=vD,yD=new __("auth","Firebase",vD());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i0=new FS("@firebase/auth");function aU(e,...t){i0.logLevel<=Fr.WARN&&i0.warn(`Auth (${Bp}): ${e}`,...t)}function Fy(e,...t){i0.logLevel<=Fr.ERROR&&i0.error(`Auth (${Bp}): ${e}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ul(e,...t){throw jS(e,...t)}function mc(e,...t){return jS(e,...t)}function bD(e,t,o){const c=Object.assign(Object.assign({},sU()),{[t]:o});return new __("auth","Firebase",c).create(t,{appName:e.name})}function Wc(e){return bD(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function jS(e,...t){if(typeof e!="string"){const o=t[0],c=[...t.slice(1)];return c[0]&&(c[0].appName=e.name),e._errorFactory.create(o,...c)}return yD.create(e,...t)}function Ci(e,t,...o){if(!e)throw jS(t,...o)}function Gc(e){const t="INTERNAL ASSERTION FAILED: "+e;throw Fy(t),new Error(t)}function Kc(e,t){e||Gc(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mw(){var e;return typeof self<"u"&&((e=self.location)===null||e===void 0?void 0:e.href)||""}function lU(){return xP()==="http:"||xP()==="https:"}function xP(){var e;return typeof self<"u"&&((e=self.location)===null||e===void 0?void 0:e.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cU(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(lU()||U2()||"connection"in navigator)?navigator.onLine:!0}function uU(){if(typeof navigator>"u")return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y_{constructor(t,o){this.shortDelay=t,this.longDelay=o,Kc(o>t,"Short delay should be less than long delay!"),this.isMobile=V2()||j2()}get(){return cU()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $S(e,t){Kc(e.emulator,"Emulator should always be set here");const{url:o}=e.emulator;return t?`${o}${t.startsWith("/")?t.slice(1):t}`:o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xD{static initialize(t,o,c){this.fetchImpl=t,o&&(this.headersImpl=o),c&&(this.responseImpl=c)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Gc("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Gc("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Gc("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hU={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dU=new y_(3e4,6e4);function dh(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function fh(e,t,o,c,d={}){return wD(e,d,async()=>{let v={},y={};c&&(t==="GET"?y=c:v={body:JSON.stringify(c)});const T=v_(Object.assign({key:e.config.apiKey},y)).slice(1),r=await e._getAdditionalHeaders();r["Content-Type"]="application/json",e.languageCode&&(r["X-Firebase-Locale"]=e.languageCode);const D=Object.assign({method:t,headers:r},v);return N2()||(D.referrerPolicy="no-referrer"),xD.fetch()(SD(e,e.config.apiHost,o,T),D)})}async function wD(e,t,o){e._canInitEmulator=!1;const c=Object.assign(Object.assign({},hU),t);try{const d=new pU(e),v=await Promise.race([o(),d.promise]);d.clearNetworkTimeout();const y=await v.json();if("needConfirmation"in y)throw Ty(e,"account-exists-with-different-credential",y);if(v.ok&&!("errorMessage"in y))return y;{const T=v.ok?y.errorMessage:y.error.message,[r,D]=T.split(" : ");if(r==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ty(e,"credential-already-in-use",y);if(r==="EMAIL_EXISTS")throw Ty(e,"email-already-in-use",y);if(r==="USER_DISABLED")throw Ty(e,"user-disabled",y);const L=c[r]||r.toLowerCase().replace(/[_\s]+/g,"-");if(D)throw bD(e,L,D);Ul(e,L)}}catch(d){if(d instanceof bc)throw d;Ul(e,"network-request-failed",{message:String(d)})}}async function b_(e,t,o,c,d={}){const v=await fh(e,t,o,c,d);return"mfaPendingCredential"in v&&Ul(e,"multi-factor-auth-required",{_serverResponse:v}),v}function SD(e,t,o,c){const d=`${t}${o}?${c}`;return e.config.emulator?$S(e.config,d):`${e.config.apiScheme}://${d}`}function fU(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class pU{constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((o,c)=>{this.timer=setTimeout(()=>c(mc(this.auth,"network-request-failed")),dU.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Ty(e,t,o){const c={appName:e.name};o.email&&(c.email=o.email),o.phoneNumber&&(c.phoneNumber=o.phoneNumber);const d=mc(e,t,c);return d.customData._tokenResponse=o,d}function wP(e){return e!==void 0&&e.enterprise!==void 0}class mU{constructor(t){if(this.siteKey="",this.recaptchaEnforcementState=[],t.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=t.recaptchaEnforcementState}getProviderEnforcementState(t){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const o of this.recaptchaEnforcementState)if(o.provider&&o.provider===t)return fU(o.enforcementState);return null}isProviderEnabled(t){return this.getProviderEnforcementState(t)==="ENFORCE"||this.getProviderEnforcementState(t)==="AUDIT"}}async function gU(e,t){return fh(e,"GET","/v2/recaptchaConfig",dh(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _U(e,t){return fh(e,"POST","/v1/accounts:delete",t)}async function TD(e,t){return fh(e,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bg(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function vU(e,t=!1){const o=gl(e),c=await o.getIdToken(t),d=GS(c);Ci(d&&d.exp&&d.auth_time&&d.iat,o.auth,"internal-error");const v=typeof d.firebase=="object"?d.firebase:void 0,y=v==null?void 0:v.sign_in_provider;return{claims:d,token:c,authTime:Bg(E1(d.auth_time)),issuedAtTime:Bg(E1(d.iat)),expirationTime:Bg(E1(d.exp)),signInProvider:y||null,signInSecondFactor:(v==null?void 0:v.sign_in_second_factor)||null}}function E1(e){return Number(e)*1e3}function GS(e){const[t,o,c]=e.split(".");if(t===void 0||o===void 0||c===void 0)return Fy("JWT malformed, contained fewer than 3 sections"),null;try{const d=lD(o);return d?JSON.parse(d):(Fy("Failed to decode base64 JWT payload"),null)}catch(d){return Fy("Caught error parsing JWT payload as JSON",d==null?void 0:d.toString()),null}}function SP(e){const t=GS(e);return Ci(t,"internal-error"),Ci(typeof t.exp<"u","internal-error"),Ci(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xg(e,t,o=!1){if(o)return t;try{return await t}catch(c){throw c instanceof bc&&yU(c)&&e.auth.currentUser===e&&await e.auth.signOut(),c}}function yU({code:e}){return e==="auth/user-disabled"||e==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bU{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){var o;if(t){const c=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),c}else{this.errorBackoff=3e4;const d=((o=this.user.stsTokenManager.expirationTime)!==null&&o!==void 0?o:0)-Date.now()-3e5;return Math.max(0,d)}}schedule(t=!1){if(!this.isRunning)return;const o=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},o)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){(t==null?void 0:t.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gw{constructor(t,o){this.createdAt=t,this.lastLoginAt=o,this._initializeTime()}_initializeTime(){this.lastSignInTime=Bg(this.lastLoginAt),this.creationTime=Bg(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function r0(e){var t;const o=e.auth,c=await e.getIdToken(),d=await Xg(e,TD(o,{idToken:c}));Ci(d==null?void 0:d.users.length,o,"internal-error");const v=d.users[0];e._notifyReloadListener(v);const y=!((t=v.providerUserInfo)===null||t===void 0)&&t.length?ED(v.providerUserInfo):[],T=wU(e.providerData,y),r=e.isAnonymous,D=!(e.email&&v.passwordHash)&&!(T!=null&&T.length),L=r?D:!1,B={uid:v.localId,displayName:v.displayName||null,photoURL:v.photoUrl||null,email:v.email||null,emailVerified:v.emailVerified||!1,phoneNumber:v.phoneNumber||null,tenantId:v.tenantId||null,providerData:T,metadata:new gw(v.createdAt,v.lastLoginAt),isAnonymous:L};Object.assign(e,B)}async function xU(e){const t=gl(e);await r0(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function wU(e,t){return[...e.filter(c=>!t.some(d=>d.providerId===c.providerId)),...t]}function ED(e){return e.map(t=>{var{providerId:o}=t,c=US(t,["providerId"]);return{providerId:o,uid:c.rawId||"",displayName:c.displayName||null,email:c.email||null,phoneNumber:c.phoneNumber||null,photoURL:c.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SU(e,t){const o=await wD(e,{},async()=>{const c=v_({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:d,apiKey:v}=e.config,y=SD(e,d,"/v1/token",`key=${v}`),T=await e._getAdditionalHeaders();return T["Content-Type"]="application/x-www-form-urlencoded",xD.fetch()(y,{method:"POST",headers:T,body:c})});return{accessToken:o.access_token,expiresIn:o.expires_in,refreshToken:o.refresh_token}}async function TU(e,t){return fh(e,"POST","/v2/accounts:revokeToken",dh(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _p{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){Ci(t.idToken,"internal-error"),Ci(typeof t.idToken<"u","internal-error"),Ci(typeof t.refreshToken<"u","internal-error");const o="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):SP(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,o)}updateFromIdToken(t){Ci(t.length!==0,"internal-error");const o=SP(t);this.updateTokensAndExpiration(t,null,o)}async getToken(t,o=!1){return!o&&this.accessToken&&!this.isExpired?this.accessToken:(Ci(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,o){const{accessToken:c,refreshToken:d,expiresIn:v}=await SU(t,o);this.updateTokensAndExpiration(c,d,Number(v))}updateTokensAndExpiration(t,o,c){this.refreshToken=o||null,this.accessToken=t||null,this.expirationTime=Date.now()+c*1e3}static fromJSON(t,o){const{refreshToken:c,accessToken:d,expirationTime:v}=o,y=new _p;return c&&(Ci(typeof c=="string","internal-error",{appName:t}),y.refreshToken=c),d&&(Ci(typeof d=="string","internal-error",{appName:t}),y.accessToken=d),v&&(Ci(typeof v=="number","internal-error",{appName:t}),y.expirationTime=v),y}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new _p,this.toJSON())}_performRefresh(){return Gc("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ju(e,t){Ci(typeof e=="string"||typeof e>"u","internal-error",{appName:t})}class Hc{constructor(t){var{uid:o,auth:c,stsTokenManager:d}=t,v=US(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new bU(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=o,this.auth=c,this.stsTokenManager=d,this.accessToken=d.accessToken,this.displayName=v.displayName||null,this.email=v.email||null,this.emailVerified=v.emailVerified||!1,this.phoneNumber=v.phoneNumber||null,this.photoURL=v.photoURL||null,this.isAnonymous=v.isAnonymous||!1,this.tenantId=v.tenantId||null,this.providerData=v.providerData?[...v.providerData]:[],this.metadata=new gw(v.createdAt||void 0,v.lastLoginAt||void 0)}async getIdToken(t){const o=await Xg(this,this.stsTokenManager.getToken(this.auth,t));return Ci(o,this.auth,"internal-error"),this.accessToken!==o&&(this.accessToken=o,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),o}getIdTokenResult(t){return vU(this,t)}reload(){return xU(this)}_assign(t){this!==t&&(Ci(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(o=>Object.assign({},o)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const o=new Hc(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return o.metadata._copy(this.metadata),o}_onReload(t){Ci(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,o=!1){let c=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),c=!0),o&&await r0(this),await this.auth._persistUserIfCurrent(this),c&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(hc(this.auth.app))return Promise.reject(Wc(this.auth));const t=await this.getIdToken();return await Xg(this,_U(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>Object.assign({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,o){var c,d,v,y,T,r,D,L;const B=(c=o.displayName)!==null&&c!==void 0?c:void 0,U=(d=o.email)!==null&&d!==void 0?d:void 0,$=(v=o.phoneNumber)!==null&&v!==void 0?v:void 0,W=(y=o.photoURL)!==null&&y!==void 0?y:void 0,q=(T=o.tenantId)!==null&&T!==void 0?T:void 0,ne=(r=o._redirectEventId)!==null&&r!==void 0?r:void 0,ce=(D=o.createdAt)!==null&&D!==void 0?D:void 0,oe=(L=o.lastLoginAt)!==null&&L!==void 0?L:void 0,{uid:fe,emailVerified:be,isAnonymous:ge,providerData:Ee,stsTokenManager:de}=o;Ci(fe&&de,t,"internal-error");const re=_p.fromJSON(this.name,de);Ci(typeof fe=="string",t,"internal-error"),ju(B,t.name),ju(U,t.name),Ci(typeof be=="boolean",t,"internal-error"),Ci(typeof ge=="boolean",t,"internal-error"),ju($,t.name),ju(W,t.name),ju(q,t.name),ju(ne,t.name),ju(ce,t.name),ju(oe,t.name);const Y=new Hc({uid:fe,auth:t,email:U,emailVerified:be,displayName:B,isAnonymous:ge,photoURL:W,phoneNumber:$,tenantId:q,stsTokenManager:re,createdAt:ce,lastLoginAt:oe});return Ee&&Array.isArray(Ee)&&(Y.providerData=Ee.map(ie=>Object.assign({},ie))),ne&&(Y._redirectEventId=ne),Y}static async _fromIdTokenResponse(t,o,c=!1){const d=new _p;d.updateFromServerResponse(o);const v=new Hc({uid:o.localId,auth:t,stsTokenManager:d,isAnonymous:c});return await r0(v),v}static async _fromGetAccountInfoResponse(t,o,c){const d=o.users[0];Ci(d.localId!==void 0,"internal-error");const v=d.providerUserInfo!==void 0?ED(d.providerUserInfo):[],y=!(d.email&&d.passwordHash)&&!(v!=null&&v.length),T=new _p;T.updateFromIdToken(c);const r=new Hc({uid:d.localId,auth:t,stsTokenManager:T,isAnonymous:y}),D={uid:d.localId,displayName:d.displayName||null,photoURL:d.photoUrl||null,email:d.email||null,emailVerified:d.emailVerified||!1,phoneNumber:d.phoneNumber||null,tenantId:d.tenantId||null,providerData:v,metadata:new gw(d.createdAt,d.lastLoginAt),isAnonymous:!(d.email&&d.passwordHash)&&!(v!=null&&v.length)};return Object.assign(r,D),r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TP=new Map;function qc(e){Kc(e instanceof Function,"Expected a class definition");let t=TP.get(e);return t?(Kc(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,TP.set(e,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ID{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,o){this.storage[t]=o}async _get(t){const o=this.storage[t];return o===void 0?null:o}async _remove(t){delete this.storage[t]}_addListener(t,o){}_removeListener(t,o){}}ID.type="NONE";const EP=ID;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vy(e,t,o){return`firebase:${e}:${t}:${o}`}class vp{constructor(t,o,c){this.persistence=t,this.auth=o,this.userKey=c;const{config:d,name:v}=this.auth;this.fullUserKey=Vy(this.userKey,d.apiKey,v),this.fullPersistenceKey=Vy("persistence",d.apiKey,v),this.boundEventHandler=o._onStorageEvent.bind(o),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?Hc._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const o=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,o)return this.setCurrentUser(o)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,o,c="authUser"){if(!o.length)return new vp(qc(EP),t,c);const d=(await Promise.all(o.map(async D=>{if(await D._isAvailable())return D}))).filter(D=>D);let v=d[0]||qc(EP);const y=Vy(c,t.config.apiKey,t.name);let T=null;for(const D of o)try{const L=await D._get(y);if(L){const B=Hc._fromJSON(t,L);D!==v&&(T=B),v=D;break}}catch{}const r=d.filter(D=>D._shouldAllowMigration);return!v._shouldAllowMigration||!r.length?new vp(v,t,c):(v=r[0],T&&await v._set(y,T.toJSON()),await Promise.all(o.map(async D=>{if(D!==v)try{await D._remove(y)}catch{}})),new vp(v,t,c))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IP(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(MD(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(CD(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(RD(t))return"Blackberry";if(DD(t))return"Webos";if(AD(t))return"Safari";if((t.includes("chrome/")||PD(t))&&!t.includes("edge/"))return"Chrome";if(kD(t))return"Android";{const o=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,c=e.match(o);if((c==null?void 0:c.length)===2)return c[1]}return"Other"}function CD(e=ba()){return/firefox\//i.test(e)}function AD(e=ba()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function PD(e=ba()){return/crios\//i.test(e)}function MD(e=ba()){return/iemobile/i.test(e)}function kD(e=ba()){return/android/i.test(e)}function RD(e=ba()){return/blackberry/i.test(e)}function DD(e=ba()){return/webos/i.test(e)}function HS(e=ba()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function EU(e=ba()){var t;return HS(e)&&!!(!((t=window.navigator)===null||t===void 0)&&t.standalone)}function IU(){return $2()&&document.documentMode===10}function OD(e=ba()){return HS(e)||kD(e)||DD(e)||RD(e)||/windows phone/i.test(e)||MD(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LD(e,t=[]){let o;switch(e){case"Browser":o=IP(ba());break;case"Worker":o=`${IP(ba())}-${e}`;break;default:o=e}const c=t.length?t.join(","):"FirebaseCore-web";return`${o}/JsCore/${Bp}/${c}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CU{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,o){const c=v=>new Promise((y,T)=>{try{const r=t(v);y(r)}catch(r){T(r)}});c.onAbort=o,this.queue.push(c);const d=this.queue.length-1;return()=>{this.queue[d]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const o=[];try{for(const c of this.queue)await c(t),c.onAbort&&o.push(c.onAbort)}catch(c){o.reverse();for(const d of o)try{d()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:c==null?void 0:c.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function AU(e,t={}){return fh(e,"GET","/v2/passwordPolicy",dh(e,t))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PU=6;class MU{constructor(t){var o,c,d,v;const y=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(o=y.minPasswordLength)!==null&&o!==void 0?o:PU,y.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=y.maxPasswordLength),y.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=y.containsLowercaseCharacter),y.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=y.containsUppercaseCharacter),y.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=y.containsNumericCharacter),y.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=y.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(d=(c=t.allowedNonAlphanumericCharacters)===null||c===void 0?void 0:c.join(""))!==null&&d!==void 0?d:"",this.forceUpgradeOnSignin=(v=t.forceUpgradeOnSignin)!==null&&v!==void 0?v:!1,this.schemaVersion=t.schemaVersion}validatePassword(t){var o,c,d,v,y,T;const r={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,r),this.validatePasswordCharacterOptions(t,r),r.isValid&&(r.isValid=(o=r.meetsMinPasswordLength)!==null&&o!==void 0?o:!0),r.isValid&&(r.isValid=(c=r.meetsMaxPasswordLength)!==null&&c!==void 0?c:!0),r.isValid&&(r.isValid=(d=r.containsLowercaseLetter)!==null&&d!==void 0?d:!0),r.isValid&&(r.isValid=(v=r.containsUppercaseLetter)!==null&&v!==void 0?v:!0),r.isValid&&(r.isValid=(y=r.containsNumericCharacter)!==null&&y!==void 0?y:!0),r.isValid&&(r.isValid=(T=r.containsNonAlphanumericCharacter)!==null&&T!==void 0?T:!0),r}validatePasswordLengthOptions(t,o){const c=this.customStrengthOptions.minPasswordLength,d=this.customStrengthOptions.maxPasswordLength;c&&(o.meetsMinPasswordLength=t.length>=c),d&&(o.meetsMaxPasswordLength=t.length<=d)}validatePasswordCharacterOptions(t,o){this.updatePasswordCharacterOptionsStatuses(o,!1,!1,!1,!1);let c;for(let d=0;d<t.length;d++)c=t.charAt(d),this.updatePasswordCharacterOptionsStatuses(o,c>="a"&&c<="z",c>="A"&&c<="Z",c>="0"&&c<="9",this.allowedNonAlphanumericCharacters.includes(c))}updatePasswordCharacterOptionsStatuses(t,o,c,d,v){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=o)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=c)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=d)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=v))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kU{constructor(t,o,c,d){this.app=t,this.heartbeatServiceProvider=o,this.appCheckServiceProvider=c,this.config=d,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new CP(this),this.idTokenSubscription=new CP(this),this.beforeStateQueue=new CU(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=yD,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=d.sdkClientVersion}_initializeWithPersistence(t,o){return o&&(this._popupRedirectResolver=qc(o)),this._initializationPromise=this.queue(async()=>{var c,d;if(!this._deleted&&(this.persistenceManager=await vp.create(this,t),!this._deleted)){if(!((c=this._popupRedirectResolver)===null||c===void 0)&&c._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(o),this.lastNotifiedUid=((d=this.currentUser)===null||d===void 0?void 0:d.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const o=await TD(this,{idToken:t}),c=await Hc._fromGetAccountInfoResponse(this,o,t);await this.directlySetCurrentUser(c)}catch(o){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",o),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){var o;if(hc(this.app)){const y=this.app.settings.authIdToken;return y?new Promise(T=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(y).then(T,T))}):this.directlySetCurrentUser(null)}const c=await this.assertedPersistence.getCurrentUser();let d=c,v=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const y=(o=this.redirectUser)===null||o===void 0?void 0:o._redirectEventId,T=d==null?void 0:d._redirectEventId,r=await this.tryRedirectSignIn(t);(!y||y===T)&&(r!=null&&r.user)&&(d=r.user,v=!0)}if(!d)return this.directlySetCurrentUser(null);if(!d._redirectEventId){if(v)try{await this.beforeStateQueue.runMiddleware(d)}catch(y){d=c,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(y))}return d?this.reloadAndSetCurrentUserOrClear(d):this.directlySetCurrentUser(null)}return Ci(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===d._redirectEventId?this.directlySetCurrentUser(d):this.reloadAndSetCurrentUserOrClear(d)}async tryRedirectSignIn(t){let o=null;try{o=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return o}async reloadAndSetCurrentUserOrClear(t){try{await r0(t)}catch(o){if((o==null?void 0:o.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=uU()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(hc(this.app))return Promise.reject(Wc(this));const o=t?gl(t):null;return o&&Ci(o.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(o&&o._clone(this))}async _updateCurrentUser(t,o=!1){if(!this._deleted)return t&&Ci(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),o||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return hc(this.app)?Promise.reject(Wc(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return hc(this.app)?Promise.reject(Wc(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(qc(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const o=this._getPasswordPolicyInternal();return o.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):o.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await AU(this),o=new MU(t);this.tenantId===null?this._projectPasswordPolicy=o:this._tenantPasswordPolicies[this.tenantId]=o}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new __("auth","Firebase",t())}onAuthStateChanged(t,o,c){return this.registerStateListener(this.authStateSubscription,t,o,c)}beforeAuthStateChanged(t,o){return this.beforeStateQueue.pushCallback(t,o)}onIdTokenChanged(t,o,c){return this.registerStateListener(this.idTokenSubscription,t,o,c)}authStateReady(){return new Promise((t,o)=>{if(this.currentUser)t();else{const c=this.onAuthStateChanged(()=>{c(),t()},o)}})}async revokeAccessToken(t){if(this.currentUser){const o=await this.currentUser.getIdToken(),c={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:o};this.tenantId!=null&&(c.tenantId=this.tenantId),await TU(this,c)}}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)===null||t===void 0?void 0:t.toJSON()}}async _setRedirectUser(t,o){const c=await this.getOrInitRedirectPersistenceManager(o);return t===null?c.removeCurrentUser():c.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const o=t&&qc(t)||this._popupRedirectResolver;Ci(o,this,"argument-error"),this.redirectPersistenceManager=await vp.create(this,[qc(o._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var o,c;return this._isInitialized&&await this.queue(async()=>{}),((o=this._currentUser)===null||o===void 0?void 0:o._redirectEventId)===t?this._currentUser:((c=this.redirectUser)===null||c===void 0?void 0:c._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,o;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const c=(o=(t=this.currentUser)===null||t===void 0?void 0:t.uid)!==null&&o!==void 0?o:null;this.lastNotifiedUid!==c&&(this.lastNotifiedUid=c,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,o,c,d){if(this._deleted)return()=>{};const v=typeof o=="function"?o:o.next.bind(o);let y=!1;const T=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ci(T,this,"internal-error"),T.then(()=>{y||v(this.currentUser)}),typeof o=="function"){const r=t.addObserver(o,c,d);return()=>{y=!0,r()}}else{const r=t.addObserver(o);return()=>{y=!0,r()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return Ci(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=LD(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const o={"X-Client-Version":this.clientVersion};this.app.options.appId&&(o["X-Firebase-gmpid"]=this.app.options.appId);const c=await((t=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getHeartbeatsHeader());c&&(o["X-Firebase-Client"]=c);const d=await this._getAppCheckToken();return d&&(o["X-Firebase-AppCheck"]=d),o}async _getAppCheckToken(){var t;const o=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getToken());return o!=null&&o.error&&aU(`Error while retrieving App Check token: ${o.error}`),o==null?void 0:o.token}}function Md(e){return gl(e)}class CP{constructor(t){this.auth=t,this.observer=null,this.addObserver=Y2(o=>this.observer=o)}get next(){return Ci(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let L0={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function RU(e){L0=e}function zD(e){return L0.loadJS(e)}function DU(){return L0.recaptchaEnterpriseScript}function OU(){return L0.gapiScript}function LU(e){return`__${e}${Math.floor(Math.random()*1e6)}`}const zU="recaptcha-enterprise",BU="NO_RECAPTCHA";class FU{constructor(t){this.type=zU,this.auth=Md(t)}async verify(t="verify",o=!1){async function c(v){if(!o){if(v.tenantId==null&&v._agentRecaptchaConfig!=null)return v._agentRecaptchaConfig.siteKey;if(v.tenantId!=null&&v._tenantRecaptchaConfigs[v.tenantId]!==void 0)return v._tenantRecaptchaConfigs[v.tenantId].siteKey}return new Promise(async(y,T)=>{gU(v,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(r=>{if(r.recaptchaKey===void 0)T(new Error("recaptcha Enterprise site key undefined"));else{const D=new mU(r);return v.tenantId==null?v._agentRecaptchaConfig=D:v._tenantRecaptchaConfigs[v.tenantId]=D,y(D.siteKey)}}).catch(r=>{T(r)})})}function d(v,y,T){const r=window.grecaptcha;wP(r)?r.enterprise.ready(()=>{r.enterprise.execute(v,{action:t}).then(D=>{y(D)}).catch(()=>{y(BU)})}):T(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((v,y)=>{c(this.auth).then(T=>{if(!o&&wP(window.grecaptcha))d(T,v,y);else{if(typeof window>"u"){y(new Error("RecaptchaVerifier is only supported in browser"));return}let r=DU();r.length!==0&&(r+=T),zD(r).then(()=>{d(T,v,y)}).catch(D=>{y(D)})}}).catch(T=>{y(T)})})}}async function AP(e,t,o,c=!1){const d=new FU(e);let v;try{v=await d.verify(o)}catch{v=await d.verify(o,!0)}const y=Object.assign({},t);return c?Object.assign(y,{captchaResp:v}):Object.assign(y,{captchaResponse:v}),Object.assign(y,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(y,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),y}async function _w(e,t,o,c){var d;if(!((d=e._getRecaptchaConfig())===null||d===void 0)&&d.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const v=await AP(e,t,o,o==="getOobCode");return c(e,v)}else return c(e,t).catch(async v=>{if(v.code==="auth/missing-recaptcha-token"){console.log(`${o} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const y=await AP(e,t,o,o==="getOobCode");return c(e,y)}else return Promise.reject(v)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VU(e,t){const o=O0(e,"auth");if(o.isInitialized()){const d=o.getImmediate(),v=o.getOptions();if(t0(v,t??{}))return d;Ul(d,"already-initialized")}return o.initialize({options:t})}function NU(e,t){const o=(t==null?void 0:t.persistence)||[],c=(Array.isArray(o)?o:[o]).map(qc);t!=null&&t.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(c,t==null?void 0:t.popupRedirectResolver)}function UU(e,t,o){const c=Md(e);Ci(c._canInitEmulator,c,"emulator-config-failed"),Ci(/^https?:\/\//.test(t),c,"invalid-emulator-scheme");const d=!1,v=BD(t),{host:y,port:T}=jU(t),r=T===null?"":`:${T}`;c.config.emulator={url:`${v}//${y}${r}/`},c.settings.appVerificationDisabledForTesting=!0,c.emulatorConfig=Object.freeze({host:y,port:T,protocol:v.replace(":",""),options:Object.freeze({disableWarnings:d})}),$U()}function BD(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function jU(e){const t=BD(e),o=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!o)return{host:"",port:null};const c=o[2].split("@").pop()||"",d=/^(\[[^\]]+\])(:|$)/.exec(c);if(d){const v=d[1];return{host:v,port:PP(c.substr(v.length+1))}}else{const[v,y]=c.split(":");return{host:v,port:PP(y)}}}function PP(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}function $U(){function e(){const t=document.createElement("p"),o=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",o.position="fixed",o.width="100%",o.backgroundColor="#ffffff",o.border=".1em solid #000000",o.color="#b50000",o.bottom="0px",o.left="0px",o.margin="0px",o.zIndex="10000",o.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",e):e())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qS{constructor(t,o){this.providerId=t,this.signInMethod=o}toJSON(){return Gc("not implemented")}_getIdTokenResponse(t){return Gc("not implemented")}_linkToIdToken(t,o){return Gc("not implemented")}_getReauthenticationResolver(t){return Gc("not implemented")}}async function GU(e,t){return fh(e,"POST","/v1/accounts:signUp",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HU(e,t){return b_(e,"POST","/v1/accounts:signInWithPassword",dh(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qU(e,t){return b_(e,"POST","/v1/accounts:signInWithEmailLink",dh(e,t))}async function WU(e,t){return b_(e,"POST","/v1/accounts:signInWithEmailLink",dh(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yg extends qS{constructor(t,o,c,d=null){super("password",c),this._email=t,this._password=o,this._tenantId=d}static _fromEmailAndPassword(t,o){return new Yg(t,o,"password")}static _fromEmailAndCode(t,o,c=null){return new Yg(t,o,"emailLink",c)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const o=typeof t=="string"?JSON.parse(t):t;if(o!=null&&o.email&&(o!=null&&o.password)){if(o.signInMethod==="password")return this._fromEmailAndPassword(o.email,o.password);if(o.signInMethod==="emailLink")return this._fromEmailAndCode(o.email,o.password,o.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":const o={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return _w(t,o,"signInWithPassword",HU);case"emailLink":return qU(t,{email:this._email,oobCode:this._password});default:Ul(t,"internal-error")}}async _linkToIdToken(t,o){switch(this.signInMethod){case"password":const c={idToken:o,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return _w(t,c,"signUpPassword",GU);case"emailLink":return WU(t,{idToken:o,email:this._email,oobCode:this._password});default:Ul(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yp(e,t){return b_(e,"POST","/v1/accounts:signInWithIdp",dh(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZU="http://localhost";class vd extends qS{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const o=new vd(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(o.idToken=t.idToken),t.accessToken&&(o.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(o.nonce=t.nonce),t.pendingToken&&(o.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(o.accessToken=t.oauthToken,o.secret=t.oauthTokenSecret):Ul("argument-error"),o}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const o=typeof t=="string"?JSON.parse(t):t,{providerId:c,signInMethod:d}=o,v=US(o,["providerId","signInMethod"]);if(!c||!d)return null;const y=new vd(c,d);return y.idToken=v.idToken||void 0,y.accessToken=v.accessToken||void 0,y.secret=v.secret,y.nonce=v.nonce,y.pendingToken=v.pendingToken||null,y}_getIdTokenResponse(t){const o=this.buildRequest();return yp(t,o)}_linkToIdToken(t,o){const c=this.buildRequest();return c.idToken=o,yp(t,c)}_getReauthenticationResolver(t){const o=this.buildRequest();return o.autoCreate=!1,yp(t,o)}buildRequest(){const t={requestUri:ZU,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const o={};this.idToken&&(o.id_token=this.idToken),this.accessToken&&(o.access_token=this.accessToken),this.secret&&(o.oauth_token_secret=this.secret),o.providerId=this.providerId,this.nonce&&!this.pendingToken&&(o.nonce=this.nonce),t.postBody=v_(o)}return t}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XU(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function YU(e){const t=Cg(Ag(e)).link,o=t?Cg(Ag(t)).deep_link_id:null,c=Cg(Ag(e)).deep_link_id;return(c?Cg(Ag(c)).link:null)||c||o||t||e}class WS{constructor(t){var o,c,d,v,y,T;const r=Cg(Ag(t)),D=(o=r.apiKey)!==null&&o!==void 0?o:null,L=(c=r.oobCode)!==null&&c!==void 0?c:null,B=XU((d=r.mode)!==null&&d!==void 0?d:null);Ci(D&&L&&B,"argument-error"),this.apiKey=D,this.operation=B,this.code=L,this.continueUrl=(v=r.continueUrl)!==null&&v!==void 0?v:null,this.languageCode=(y=r.languageCode)!==null&&y!==void 0?y:null,this.tenantId=(T=r.tenantId)!==null&&T!==void 0?T:null}static parseLink(t){const o=YU(t);try{return new WS(o)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fp{constructor(){this.providerId=Fp.PROVIDER_ID}static credential(t,o){return Yg._fromEmailAndPassword(t,o)}static credentialWithLink(t,o){const c=WS.parseLink(o);return Ci(c,"argument-error"),Yg._fromEmailAndCode(t,c.code,c.tenantId)}}Fp.PROVIDER_ID="password";Fp.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Fp.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FD{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class x_ extends FD{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yu extends x_{constructor(){super("facebook.com")}static credential(t){return vd._fromParams({providerId:Yu.PROVIDER_ID,signInMethod:Yu.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Yu.credentialFromTaggedObject(t)}static credentialFromError(t){return Yu.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return Yu.credential(t.oauthAccessToken)}catch{return null}}}Yu.FACEBOOK_SIGN_IN_METHOD="facebook.com";Yu.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ku extends x_{constructor(){super("google.com"),this.addScope("profile")}static credential(t,o){return vd._fromParams({providerId:Ku.PROVIDER_ID,signInMethod:Ku.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:o})}static credentialFromResult(t){return Ku.credentialFromTaggedObject(t)}static credentialFromError(t){return Ku.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:o,oauthAccessToken:c}=t;if(!o&&!c)return null;try{return Ku.credential(o,c)}catch{return null}}}Ku.GOOGLE_SIGN_IN_METHOD="google.com";Ku.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ju extends x_{constructor(){super("github.com")}static credential(t){return vd._fromParams({providerId:Ju.PROVIDER_ID,signInMethod:Ju.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Ju.credentialFromTaggedObject(t)}static credentialFromError(t){return Ju.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return Ju.credential(t.oauthAccessToken)}catch{return null}}}Ju.GITHUB_SIGN_IN_METHOD="github.com";Ju.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qu extends x_{constructor(){super("twitter.com")}static credential(t,o){return vd._fromParams({providerId:Qu.PROVIDER_ID,signInMethod:Qu.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:o})}static credentialFromResult(t){return Qu.credentialFromTaggedObject(t)}static credentialFromError(t){return Qu.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:o,oauthTokenSecret:c}=t;if(!o||!c)return null;try{return Qu.credential(o,c)}catch{return null}}}Qu.TWITTER_SIGN_IN_METHOD="twitter.com";Qu.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KU(e,t){return b_(e,"POST","/v1/accounts:signUp",dh(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yd{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,o,c,d=!1){const v=await Hc._fromIdTokenResponse(t,c,d),y=MP(c);return new yd({user:v,providerId:y,_tokenResponse:c,operationType:o})}static async _forOperation(t,o,c){await t._updateTokensIfNecessary(c,!0);const d=MP(c);return new yd({user:t,providerId:d,_tokenResponse:c,operationType:o})}}function MP(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o0 extends bc{constructor(t,o,c,d){var v;super(o.code,o.message),this.operationType=c,this.user=d,Object.setPrototypeOf(this,o0.prototype),this.customData={appName:t.name,tenantId:(v=t.tenantId)!==null&&v!==void 0?v:void 0,_serverResponse:o.customData._serverResponse,operationType:c}}static _fromErrorAndOperation(t,o,c,d){return new o0(t,o,c,d)}}function VD(e,t,o,c){return(t==="reauthenticate"?o._getReauthenticationResolver(e):o._getIdTokenResponse(e)).catch(v=>{throw v.code==="auth/multi-factor-auth-required"?o0._fromErrorAndOperation(e,v,t,c):v})}async function JU(e,t,o=!1){const c=await Xg(e,t._linkToIdToken(e.auth,await e.getIdToken()),o);return yd._forOperation(e,"link",c)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function QU(e,t,o=!1){const{auth:c}=e;if(hc(c.app))return Promise.reject(Wc(c));const d="reauthenticate";try{const v=await Xg(e,VD(c,d,t,e),o);Ci(v.idToken,c,"internal-error");const y=GS(v.idToken);Ci(y,c,"internal-error");const{sub:T}=y;return Ci(e.uid===T,c,"user-mismatch"),yd._forOperation(e,d,v)}catch(v){throw(v==null?void 0:v.code)==="auth/user-not-found"&&Ul(c,"user-mismatch"),v}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ND(e,t,o=!1){if(hc(e.app))return Promise.reject(Wc(e));const c="signIn",d=await VD(e,c,t),v=await yd._fromIdTokenResponse(e,c,d);return o||await e._updateCurrentUser(v.user),v}async function ej(e,t){return ND(Md(e),t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function UD(e){const t=Md(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function tj(e,t,o){if(hc(e.app))return Promise.reject(Wc(e));const c=Md(e),y=await _w(c,{returnSecureToken:!0,email:t,password:o,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",KU).catch(r=>{throw r.code==="auth/password-does-not-meet-requirements"&&UD(e),r}),T=await yd._fromIdTokenResponse(c,"signIn",y);return await c._updateCurrentUser(T.user),T}function jD(e,t,o){return hc(e.app)?Promise.reject(Wc(e)):ej(gl(e),Fp.credential(t,o)).catch(async c=>{throw c.code==="auth/password-does-not-meet-requirements"&&UD(e),c})}function nj(e,t,o,c){return gl(e).onIdTokenChanged(t,o,c)}function ij(e,t,o){return gl(e).beforeAuthStateChanged(t,o)}function $D(e,t,o,c){return gl(e).onAuthStateChanged(t,o,c)}function rj(e){return gl(e).signOut()}const s0="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GD{constructor(t,o){this.storageRetriever=t,this.type=o}_isAvailable(){try{return this.storage?(this.storage.setItem(s0,"1"),this.storage.removeItem(s0),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,o){return this.storage.setItem(t,JSON.stringify(o)),Promise.resolve()}_get(t){const o=this.storage.getItem(t);return Promise.resolve(o?JSON.parse(o):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oj=1e3,sj=10;class HD extends GD{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,o)=>this.onStorageEvent(t,o),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=OD(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const o of Object.keys(this.listeners)){const c=this.storage.getItem(o),d=this.localCache[o];c!==d&&t(o,d,c)}}onStorageEvent(t,o=!1){if(!t.key){this.forAllChangedKeys((y,T,r)=>{this.notifyListeners(y,r)});return}const c=t.key;o?this.detachListener():this.stopPolling();const d=()=>{const y=this.storage.getItem(c);!o&&this.localCache[c]===y||this.notifyListeners(c,y)},v=this.storage.getItem(c);IU()&&v!==t.newValue&&t.newValue!==t.oldValue?setTimeout(d,sj):d()}notifyListeners(t,o){this.localCache[t]=o;const c=this.listeners[t];if(c)for(const d of Array.from(c))d(o&&JSON.parse(o))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,o,c)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:o,newValue:c}),!0)})},oj)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,o){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(o)}_removeListener(t,o){this.listeners[t]&&(this.listeners[t].delete(o),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,o){await super._set(t,o),this.localCache[t]=JSON.stringify(o)}async _get(t){const o=await super._get(t);return this.localCache[t]=JSON.stringify(o),o}async _remove(t){await super._remove(t),delete this.localCache[t]}}HD.type="LOCAL";const aj=HD;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qD extends GD{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,o){}_removeListener(t,o){}}qD.type="SESSION";const WD=qD;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lj(e){return Promise.all(e.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(o){return{fulfilled:!1,reason:o}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z0{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const o=this.receivers.find(d=>d.isListeningto(t));if(o)return o;const c=new z0(t);return this.receivers.push(c),c}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const o=t,{eventId:c,eventType:d,data:v}=o.data,y=this.handlersMap[d];if(!(y!=null&&y.size))return;o.ports[0].postMessage({status:"ack",eventId:c,eventType:d});const T=Array.from(y).map(async D=>D(o.origin,v)),r=await lj(T);o.ports[0].postMessage({status:"done",eventId:c,eventType:d,response:r})}_subscribe(t,o){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(o)}_unsubscribe(t,o){this.handlersMap[t]&&o&&this.handlersMap[t].delete(o),(!o||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}z0.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZS(e="",t=10){let o="";for(let c=0;c<t;c++)o+=Math.floor(Math.random()*10);return e+o}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cj{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,o,c=50){const d=typeof MessageChannel<"u"?new MessageChannel:null;if(!d)throw new Error("connection_unavailable");let v,y;return new Promise((T,r)=>{const D=ZS("",20);d.port1.start();const L=setTimeout(()=>{r(new Error("unsupported_event"))},c);y={messageChannel:d,onMessage(B){const U=B;if(U.data.eventId===D)switch(U.data.status){case"ack":clearTimeout(L),v=setTimeout(()=>{r(new Error("timeout"))},3e3);break;case"done":clearTimeout(v),T(U.data.response);break;default:clearTimeout(L),clearTimeout(v),r(new Error("invalid_response"));break}}},this.handlers.add(y),d.port1.addEventListener("message",y.onMessage),this.target.postMessage({eventType:t,eventId:D,data:o},[d.port2])}).finally(()=>{y&&this.removeMessageHandler(y)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gc(){return window}function uj(e){gc().location.href=e}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZD(){return typeof gc().WorkerGlobalScope<"u"&&typeof gc().importScripts=="function"}async function hj(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function dj(){var e;return((e=navigator==null?void 0:navigator.serviceWorker)===null||e===void 0?void 0:e.controller)||null}function fj(){return ZD()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XD="firebaseLocalStorageDb",pj=1,a0="firebaseLocalStorage",YD="fbase_key";class w_{constructor(t){this.request=t}toPromise(){return new Promise((t,o)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{o(this.request.error)})})}}function B0(e,t){return e.transaction([a0],t?"readwrite":"readonly").objectStore(a0)}function mj(){const e=indexedDB.deleteDatabase(XD);return new w_(e).toPromise()}function vw(){const e=indexedDB.open(XD,pj);return new Promise((t,o)=>{e.addEventListener("error",()=>{o(e.error)}),e.addEventListener("upgradeneeded",()=>{const c=e.result;try{c.createObjectStore(a0,{keyPath:YD})}catch(d){o(d)}}),e.addEventListener("success",async()=>{const c=e.result;c.objectStoreNames.contains(a0)?t(c):(c.close(),await mj(),t(await vw()))})})}async function kP(e,t,o){const c=B0(e,!0).put({[YD]:t,value:o});return new w_(c).toPromise()}async function gj(e,t){const o=B0(e,!1).get(t),c=await new w_(o).toPromise();return c===void 0?null:c.value}function RP(e,t){const o=B0(e,!0).delete(t);return new w_(o).toPromise()}const _j=800,vj=3;class KD{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await vw(),this.db)}async _withRetries(t){let o=0;for(;;)try{const c=await this._openDb();return await t(c)}catch(c){if(o++>vj)throw c;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return ZD()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=z0._getInstance(fj()),this.receiver._subscribe("keyChanged",async(t,o)=>({keyProcessed:(await this._poll()).includes(o.key)})),this.receiver._subscribe("ping",async(t,o)=>["keyChanged"])}async initializeSender(){var t,o;if(this.activeServiceWorker=await hj(),!this.activeServiceWorker)return;this.sender=new cj(this.activeServiceWorker);const c=await this.sender._send("ping",{},800);c&&!((t=c[0])===null||t===void 0)&&t.fulfilled&&!((o=c[0])===null||o===void 0)&&o.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||dj()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await vw();return await kP(t,s0,"1"),await RP(t,s0),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,o){return this._withPendingWrite(async()=>(await this._withRetries(c=>kP(c,t,o)),this.localCache[t]=o,this.notifyServiceWorker(t)))}async _get(t){const o=await this._withRetries(c=>gj(c,t));return this.localCache[t]=o,o}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(o=>RP(o,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(d=>{const v=B0(d,!1).getAll();return new w_(v).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const o=[],c=new Set;if(t.length!==0)for(const{fbase_key:d,value:v}of t)c.add(d),JSON.stringify(this.localCache[d])!==JSON.stringify(v)&&(this.notifyListeners(d,v),o.push(d));for(const d of Object.keys(this.localCache))this.localCache[d]&&!c.has(d)&&(this.notifyListeners(d,null),o.push(d));return o}notifyListeners(t,o){this.localCache[t]=o;const c=this.listeners[t];if(c)for(const d of Array.from(c))d(o)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),_j)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,o){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(o)}_removeListener(t,o){this.listeners[t]&&(this.listeners[t].delete(o),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}KD.type="LOCAL";const yj=KD;new y_(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bj(e,t){return t?qc(t):(Ci(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XS extends qS{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return yp(t,this._buildIdpRequest())}_linkToIdToken(t,o){return yp(t,this._buildIdpRequest(o))}_getReauthenticationResolver(t){return yp(t,this._buildIdpRequest())}_buildIdpRequest(t){const o={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(o.idToken=t),o}}function xj(e){return ND(e.auth,new XS(e),e.bypassAuthState)}function wj(e){const{auth:t,user:o}=e;return Ci(o,t,"internal-error"),QU(o,new XS(e),e.bypassAuthState)}async function Sj(e){const{auth:t,user:o}=e;return Ci(o,t,"internal-error"),JU(o,new XS(e),e.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JD{constructor(t,o,c,d,v=!1){this.auth=t,this.resolver=c,this.user=d,this.bypassAuthState=v,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(o)?o:[o]}execute(){return new Promise(async(t,o)=>{this.pendingPromise={resolve:t,reject:o};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(c){this.reject(c)}})}async onAuthEvent(t){const{urlResponse:o,sessionId:c,postBody:d,tenantId:v,error:y,type:T}=t;if(y){this.reject(y);return}const r={auth:this.auth,requestUri:o,sessionId:c,tenantId:v||void 0,postBody:d||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(T)(r))}catch(D){this.reject(D)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return xj;case"linkViaPopup":case"linkViaRedirect":return Sj;case"reauthViaPopup":case"reauthViaRedirect":return wj;default:Ul(this.auth,"internal-error")}}resolve(t){Kc(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){Kc(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tj=new y_(2e3,1e4);class lp extends JD{constructor(t,o,c,d,v){super(t,o,d,v),this.provider=c,this.authWindow=null,this.pollId=null,lp.currentPopupAction&&lp.currentPopupAction.cancel(),lp.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return Ci(t,this.auth,"internal-error"),t}async onExecution(){Kc(this.filter.length===1,"Popup operations only handle one event");const t=ZS();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(o=>{this.reject(o)}),this.resolver._isIframeWebStorageSupported(this.auth,o=>{o||this.reject(mc(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var t;return((t=this.authWindow)===null||t===void 0?void 0:t.associatedEvent)||null}cancel(){this.reject(mc(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,lp.currentPopupAction=null}pollUserCancellation(){const t=()=>{var o,c;if(!((c=(o=this.authWindow)===null||o===void 0?void 0:o.window)===null||c===void 0)&&c.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(mc(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,Tj.get())};t()}}lp.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ej="pendingRedirect",Ny=new Map;class Ij extends JD{constructor(t,o,c=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],o,void 0,c),this.eventId=null}async execute(){let t=Ny.get(this.auth._key());if(!t){try{const c=await Cj(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(c)}catch(o){t=()=>Promise.reject(o)}Ny.set(this.auth._key(),t)}return this.bypassAuthState||Ny.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if(t.type==="signInViaRedirect")return super.onAuthEvent(t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const o=await this.auth._redirectUserForId(t.eventId);if(o)return this.user=o,super.onAuthEvent(t);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Cj(e,t){const o=Mj(t),c=Pj(e);if(!await c._isAvailable())return!1;const d=await c._get(o)==="true";return await c._remove(o),d}function Aj(e,t){Ny.set(e._key(),t)}function Pj(e){return qc(e._redirectPersistence)}function Mj(e){return Vy(Ej,e.config.apiKey,e.name)}async function kj(e,t,o=!1){if(hc(e.app))return Promise.reject(Wc(e));const c=Md(e),d=bj(c,t),y=await new Ij(c,d,o).execute();return y&&!o&&(delete y.user._redirectEventId,await c._persistUserIfCurrent(y.user),await c._setRedirectUser(null,t)),y}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rj=10*60*1e3;class Dj{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let o=!1;return this.consumers.forEach(c=>{this.isEventForConsumer(t,c)&&(o=!0,this.sendToConsumer(t,c),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!Oj(t)||(this.hasHandledPotentialRedirect=!0,o||(this.queuedRedirectEvent=t,o=!0)),o}sendToConsumer(t,o){var c;if(t.error&&!QD(t)){const d=((c=t.error.code)===null||c===void 0?void 0:c.split("auth/")[1])||"internal-error";o.onError(mc(this.auth,d))}else o.onAuthEvent(t)}isEventForConsumer(t,o){const c=o.eventId===null||!!t.eventId&&t.eventId===o.eventId;return o.filter.includes(t.type)&&c}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=Rj&&this.cachedEventUids.clear(),this.cachedEventUids.has(DP(t))}saveEventToCache(t){this.cachedEventUids.add(DP(t)),this.lastProcessedEventTime=Date.now()}}function DP(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(t=>t).join("-")}function QD({type:e,error:t}){return e==="unknown"&&(t==null?void 0:t.code)==="auth/no-auth-event"}function Oj(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return QD(e);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Lj(e,t={}){return fh(e,"GET","/v1/projects",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zj=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Bj=/^https?/;async function Fj(e){if(e.config.emulator)return;const{authorizedDomains:t}=await Lj(e);for(const o of t)try{if(Vj(o))return}catch{}Ul(e,"unauthorized-domain")}function Vj(e){const t=mw(),{protocol:o,hostname:c}=new URL(t);if(e.startsWith("chrome-extension://")){const y=new URL(e);return y.hostname===""&&c===""?o==="chrome-extension:"&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):o==="chrome-extension:"&&y.hostname===c}if(!Bj.test(o))return!1;if(zj.test(e))return c===e;const d=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+d+"|"+d+")$","i").test(c)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nj=new y_(3e4,6e4);function OP(){const e=gc().___jsl;if(e!=null&&e.H){for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let o=0;o<e.CP.length;o++)e.CP[o]=null}}function Uj(e){return new Promise((t,o)=>{var c,d,v;function y(){OP(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{OP(),o(mc(e,"network-request-failed"))},timeout:Nj.get()})}if(!((d=(c=gc().gapi)===null||c===void 0?void 0:c.iframes)===null||d===void 0)&&d.Iframe)t(gapi.iframes.getContext());else if(!((v=gc().gapi)===null||v===void 0)&&v.load)y();else{const T=LU("iframefcb");return gc()[T]=()=>{gapi.load?y():o(mc(e,"network-request-failed"))},zD(`${OU()}?onload=${T}`).catch(r=>o(r))}}).catch(t=>{throw Uy=null,t})}let Uy=null;function jj(e){return Uy=Uy||Uj(e),Uy}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $j=new y_(5e3,15e3),Gj="__/auth/iframe",Hj="emulator/auth/iframe",qj={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Wj=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Zj(e){const t=e.config;Ci(t.authDomain,e,"auth-domain-config-required");const o=t.emulator?$S(t,Hj):`https://${e.config.authDomain}/${Gj}`,c={apiKey:t.apiKey,appName:e.name,v:Bp},d=Wj.get(e.config.apiHost);d&&(c.eid=d);const v=e._getFrameworks();return v.length&&(c.fw=v.join(",")),`${o}?${v_(c).slice(1)}`}async function Xj(e){const t=await jj(e),o=gc().gapi;return Ci(o,e,"internal-error"),t.open({where:document.body,url:Zj(e),messageHandlersFilter:o.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:qj,dontclear:!0},c=>new Promise(async(d,v)=>{await c.restyle({setHideOnLeave:!1});const y=mc(e,"network-request-failed"),T=gc().setTimeout(()=>{v(y)},$j.get());function r(){gc().clearTimeout(T),d(c)}c.ping(r).then(r,()=>{v(y)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yj={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Kj=500,Jj=600,Qj="_blank",e$="http://localhost";class LP{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function t$(e,t,o,c=Kj,d=Jj){const v=Math.max((window.screen.availHeight-d)/2,0).toString(),y=Math.max((window.screen.availWidth-c)/2,0).toString();let T="";const r=Object.assign(Object.assign({},Yj),{width:c.toString(),height:d.toString(),top:v,left:y}),D=ba().toLowerCase();o&&(T=PD(D)?Qj:o),CD(D)&&(t=t||e$,r.scrollbars="yes");const L=Object.entries(r).reduce((U,[$,W])=>`${U}${$}=${W},`,"");if(EU(D)&&T!=="_self")return n$(t||"",T),new LP(null);const B=window.open(t||"",T,L);Ci(B,e,"popup-blocked");try{B.focus()}catch{}return new LP(B)}function n$(e,t){const o=document.createElement("a");o.href=e,o.target=t;const c=document.createEvent("MouseEvent");c.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),o.dispatchEvent(c)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i$="__/auth/handler",r$="emulator/auth/handler",o$=encodeURIComponent("fac");async function zP(e,t,o,c,d,v){Ci(e.config.authDomain,e,"auth-domain-config-required"),Ci(e.config.apiKey,e,"invalid-api-key");const y={apiKey:e.config.apiKey,appName:e.name,authType:o,redirectUrl:c,v:Bp,eventId:d};if(t instanceof FD){t.setDefaultLanguage(e.languageCode),y.providerId=t.providerId||"",X2(t.getCustomParameters())||(y.customParameters=JSON.stringify(t.getCustomParameters()));for(const[L,B]of Object.entries({}))y[L]=B}if(t instanceof x_){const L=t.getScopes().filter(B=>B!=="");L.length>0&&(y.scopes=L.join(","))}e.tenantId&&(y.tid=e.tenantId);const T=y;for(const L of Object.keys(T))T[L]===void 0&&delete T[L];const r=await e._getAppCheckToken(),D=r?`#${o$}=${encodeURIComponent(r)}`:"";return`${s$(e)}?${v_(T).slice(1)}${D}`}function s$({config:e}){return e.emulator?$S(e,r$):`https://${e.authDomain}/${i$}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I1="webStorageSupport";class a${constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=WD,this._completeRedirectFn=kj,this._overrideRedirectResult=Aj}async _openPopup(t,o,c,d){var v;Kc((v=this.eventManagers[t._key()])===null||v===void 0?void 0:v.manager,"_initialize() not called before _openPopup()");const y=await zP(t,o,c,mw(),d);return t$(t,y,ZS())}async _openRedirect(t,o,c,d){await this._originValidation(t);const v=await zP(t,o,c,mw(),d);return uj(v),new Promise(()=>{})}_initialize(t){const o=t._key();if(this.eventManagers[o]){const{manager:d,promise:v}=this.eventManagers[o];return d?Promise.resolve(d):(Kc(v,"If manager is not set, promise should be"),v)}const c=this.initAndGetManager(t);return this.eventManagers[o]={promise:c},c.catch(()=>{delete this.eventManagers[o]}),c}async initAndGetManager(t){const o=await Xj(t),c=new Dj(t);return o.register("authEvent",d=>(Ci(d==null?void 0:d.authEvent,t,"invalid-auth-event"),{status:c.onEvent(d.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:c},this.iframes[t._key()]=o,c}_isIframeWebStorageSupported(t,o){this.iframes[t._key()].send(I1,{type:I1},d=>{var v;const y=(v=d==null?void 0:d[0])===null||v===void 0?void 0:v[I1];y!==void 0&&o(!!y),Ul(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const o=t._key();return this.originValidationPromises[o]||(this.originValidationPromises[o]=Fj(t)),this.originValidationPromises[o]}get _shouldInitProactively(){return OD()||AD()||HS()}}const l$=a$;var BP="@firebase/auth",FP="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c${constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)===null||t===void 0?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const o=this.auth.onIdTokenChanged(c=>{t((c==null?void 0:c.stsTokenManager.accessToken)||null)});this.internalListeners.set(t,o),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const o=this.internalListeners.get(t);o&&(this.internalListeners.delete(t),o(),this.updateProactiveRefresh())}assertAuthConfigured(){Ci(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u$(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function h$(e){_d(new oh("auth",(t,{options:o})=>{const c=t.getProvider("app").getImmediate(),d=t.getProvider("heartbeat"),v=t.getProvider("app-check-internal"),{apiKey:y,authDomain:T}=c.options;Ci(y&&!y.includes(":"),"invalid-api-key",{appName:c.name});const r={apiKey:y,authDomain:T,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:LD(e)},D=new kU(c,d,v,r);return NU(D,o),D},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,o,c)=>{t.getProvider("auth-internal").initialize()})),_d(new oh("auth-internal",t=>{const o=Md(t.getProvider("auth").getImmediate());return(c=>new c$(c))(o)},"PRIVATE").setInstantiationMode("EXPLICIT")),pc(BP,FP,u$(e)),pc(BP,FP,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const d$=5*60,f$=dD("authIdTokenMaxAge")||d$;let VP=null;const p$=e=>async t=>{const o=t&&await t.getIdTokenResult(),c=o&&(new Date().getTime()-Date.parse(o.issuedAtTime))/1e3;if(c&&c>f$)return;const d=o==null?void 0:o.token;VP!==d&&(VP=d,await fetch(e,{method:d?"POST":"DELETE",headers:d?{Authorization:`Bearer ${d}`}:{}}))};function m$(e=NS()){const t=O0(e,"auth");if(t.isInitialized())return t.getImmediate();const o=VU(e,{popupRedirectResolver:l$,persistence:[yj,aj,WD]}),c=dD("authTokenSyncURL");if(c&&typeof isSecureContext=="boolean"&&isSecureContext){const v=new URL(c,location.origin);if(location.origin===v.origin){const y=p$(v.toString());ij(o,y,()=>y(o.currentUser)),nj(o,T=>y(T))}}const d=cD("auth");return d&&UU(o,`http://${d}`),o}function g$(){var e,t;return(t=(e=document.getElementsByTagName("head"))===null||e===void 0?void 0:e[0])!==null&&t!==void 0?t:document}RU({loadJS(e){return new Promise((t,o)=>{const c=document.createElement("script");c.setAttribute("src",e),c.onload=t,c.onerror=d=>{const v=mc("internal-error");v.customData=d,o(v)},c.type="text/javascript",c.charset="UTF-8",g$().appendChild(c)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});h$("Browser");var _$="firebase",v$="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */pc(_$,v$,"app");var NP=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var eO;(function(){var e;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function t(de,re){function Y(){}Y.prototype=re.prototype,de.D=re.prototype,de.prototype=new Y,de.prototype.constructor=de,de.C=function(ie,te,ae){for(var pe=Array(arguments.length-2),Le=2;Le<arguments.length;Le++)pe[Le-2]=arguments[Le];return re.prototype[te].apply(ie,pe)}}function o(){this.blockSize=-1}function c(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(c,o),c.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function d(de,re,Y){Y||(Y=0);var ie=Array(16);if(typeof re=="string")for(var te=0;16>te;++te)ie[te]=re.charCodeAt(Y++)|re.charCodeAt(Y++)<<8|re.charCodeAt(Y++)<<16|re.charCodeAt(Y++)<<24;else for(te=0;16>te;++te)ie[te]=re[Y++]|re[Y++]<<8|re[Y++]<<16|re[Y++]<<24;re=de.g[0],Y=de.g[1],te=de.g[2];var ae=de.g[3],pe=re+(ae^Y&(te^ae))+ie[0]+3614090360&4294967295;re=Y+(pe<<7&4294967295|pe>>>25),pe=ae+(te^re&(Y^te))+ie[1]+3905402710&4294967295,ae=re+(pe<<12&4294967295|pe>>>20),pe=te+(Y^ae&(re^Y))+ie[2]+606105819&4294967295,te=ae+(pe<<17&4294967295|pe>>>15),pe=Y+(re^te&(ae^re))+ie[3]+3250441966&4294967295,Y=te+(pe<<22&4294967295|pe>>>10),pe=re+(ae^Y&(te^ae))+ie[4]+4118548399&4294967295,re=Y+(pe<<7&4294967295|pe>>>25),pe=ae+(te^re&(Y^te))+ie[5]+1200080426&4294967295,ae=re+(pe<<12&4294967295|pe>>>20),pe=te+(Y^ae&(re^Y))+ie[6]+2821735955&4294967295,te=ae+(pe<<17&4294967295|pe>>>15),pe=Y+(re^te&(ae^re))+ie[7]+4249261313&4294967295,Y=te+(pe<<22&4294967295|pe>>>10),pe=re+(ae^Y&(te^ae))+ie[8]+1770035416&4294967295,re=Y+(pe<<7&4294967295|pe>>>25),pe=ae+(te^re&(Y^te))+ie[9]+2336552879&4294967295,ae=re+(pe<<12&4294967295|pe>>>20),pe=te+(Y^ae&(re^Y))+ie[10]+4294925233&4294967295,te=ae+(pe<<17&4294967295|pe>>>15),pe=Y+(re^te&(ae^re))+ie[11]+2304563134&4294967295,Y=te+(pe<<22&4294967295|pe>>>10),pe=re+(ae^Y&(te^ae))+ie[12]+1804603682&4294967295,re=Y+(pe<<7&4294967295|pe>>>25),pe=ae+(te^re&(Y^te))+ie[13]+4254626195&4294967295,ae=re+(pe<<12&4294967295|pe>>>20),pe=te+(Y^ae&(re^Y))+ie[14]+2792965006&4294967295,te=ae+(pe<<17&4294967295|pe>>>15),pe=Y+(re^te&(ae^re))+ie[15]+1236535329&4294967295,Y=te+(pe<<22&4294967295|pe>>>10),pe=re+(te^ae&(Y^te))+ie[1]+4129170786&4294967295,re=Y+(pe<<5&4294967295|pe>>>27),pe=ae+(Y^te&(re^Y))+ie[6]+3225465664&4294967295,ae=re+(pe<<9&4294967295|pe>>>23),pe=te+(re^Y&(ae^re))+ie[11]+643717713&4294967295,te=ae+(pe<<14&4294967295|pe>>>18),pe=Y+(ae^re&(te^ae))+ie[0]+3921069994&4294967295,Y=te+(pe<<20&4294967295|pe>>>12),pe=re+(te^ae&(Y^te))+ie[5]+3593408605&4294967295,re=Y+(pe<<5&4294967295|pe>>>27),pe=ae+(Y^te&(re^Y))+ie[10]+38016083&4294967295,ae=re+(pe<<9&4294967295|pe>>>23),pe=te+(re^Y&(ae^re))+ie[15]+3634488961&4294967295,te=ae+(pe<<14&4294967295|pe>>>18),pe=Y+(ae^re&(te^ae))+ie[4]+3889429448&4294967295,Y=te+(pe<<20&4294967295|pe>>>12),pe=re+(te^ae&(Y^te))+ie[9]+568446438&4294967295,re=Y+(pe<<5&4294967295|pe>>>27),pe=ae+(Y^te&(re^Y))+ie[14]+3275163606&4294967295,ae=re+(pe<<9&4294967295|pe>>>23),pe=te+(re^Y&(ae^re))+ie[3]+4107603335&4294967295,te=ae+(pe<<14&4294967295|pe>>>18),pe=Y+(ae^re&(te^ae))+ie[8]+1163531501&4294967295,Y=te+(pe<<20&4294967295|pe>>>12),pe=re+(te^ae&(Y^te))+ie[13]+2850285829&4294967295,re=Y+(pe<<5&4294967295|pe>>>27),pe=ae+(Y^te&(re^Y))+ie[2]+4243563512&4294967295,ae=re+(pe<<9&4294967295|pe>>>23),pe=te+(re^Y&(ae^re))+ie[7]+1735328473&4294967295,te=ae+(pe<<14&4294967295|pe>>>18),pe=Y+(ae^re&(te^ae))+ie[12]+2368359562&4294967295,Y=te+(pe<<20&4294967295|pe>>>12),pe=re+(Y^te^ae)+ie[5]+4294588738&4294967295,re=Y+(pe<<4&4294967295|pe>>>28),pe=ae+(re^Y^te)+ie[8]+2272392833&4294967295,ae=re+(pe<<11&4294967295|pe>>>21),pe=te+(ae^re^Y)+ie[11]+1839030562&4294967295,te=ae+(pe<<16&4294967295|pe>>>16),pe=Y+(te^ae^re)+ie[14]+4259657740&4294967295,Y=te+(pe<<23&4294967295|pe>>>9),pe=re+(Y^te^ae)+ie[1]+2763975236&4294967295,re=Y+(pe<<4&4294967295|pe>>>28),pe=ae+(re^Y^te)+ie[4]+1272893353&4294967295,ae=re+(pe<<11&4294967295|pe>>>21),pe=te+(ae^re^Y)+ie[7]+4139469664&4294967295,te=ae+(pe<<16&4294967295|pe>>>16),pe=Y+(te^ae^re)+ie[10]+3200236656&4294967295,Y=te+(pe<<23&4294967295|pe>>>9),pe=re+(Y^te^ae)+ie[13]+681279174&4294967295,re=Y+(pe<<4&4294967295|pe>>>28),pe=ae+(re^Y^te)+ie[0]+3936430074&4294967295,ae=re+(pe<<11&4294967295|pe>>>21),pe=te+(ae^re^Y)+ie[3]+3572445317&4294967295,te=ae+(pe<<16&4294967295|pe>>>16),pe=Y+(te^ae^re)+ie[6]+76029189&4294967295,Y=te+(pe<<23&4294967295|pe>>>9),pe=re+(Y^te^ae)+ie[9]+3654602809&4294967295,re=Y+(pe<<4&4294967295|pe>>>28),pe=ae+(re^Y^te)+ie[12]+3873151461&4294967295,ae=re+(pe<<11&4294967295|pe>>>21),pe=te+(ae^re^Y)+ie[15]+530742520&4294967295,te=ae+(pe<<16&4294967295|pe>>>16),pe=Y+(te^ae^re)+ie[2]+3299628645&4294967295,Y=te+(pe<<23&4294967295|pe>>>9),pe=re+(te^(Y|~ae))+ie[0]+4096336452&4294967295,re=Y+(pe<<6&4294967295|pe>>>26),pe=ae+(Y^(re|~te))+ie[7]+1126891415&4294967295,ae=re+(pe<<10&4294967295|pe>>>22),pe=te+(re^(ae|~Y))+ie[14]+2878612391&4294967295,te=ae+(pe<<15&4294967295|pe>>>17),pe=Y+(ae^(te|~re))+ie[5]+4237533241&4294967295,Y=te+(pe<<21&4294967295|pe>>>11),pe=re+(te^(Y|~ae))+ie[12]+1700485571&4294967295,re=Y+(pe<<6&4294967295|pe>>>26),pe=ae+(Y^(re|~te))+ie[3]+2399980690&4294967295,ae=re+(pe<<10&4294967295|pe>>>22),pe=te+(re^(ae|~Y))+ie[10]+4293915773&4294967295,te=ae+(pe<<15&4294967295|pe>>>17),pe=Y+(ae^(te|~re))+ie[1]+2240044497&4294967295,Y=te+(pe<<21&4294967295|pe>>>11),pe=re+(te^(Y|~ae))+ie[8]+1873313359&4294967295,re=Y+(pe<<6&4294967295|pe>>>26),pe=ae+(Y^(re|~te))+ie[15]+4264355552&4294967295,ae=re+(pe<<10&4294967295|pe>>>22),pe=te+(re^(ae|~Y))+ie[6]+2734768916&4294967295,te=ae+(pe<<15&4294967295|pe>>>17),pe=Y+(ae^(te|~re))+ie[13]+1309151649&4294967295,Y=te+(pe<<21&4294967295|pe>>>11),pe=re+(te^(Y|~ae))+ie[4]+4149444226&4294967295,re=Y+(pe<<6&4294967295|pe>>>26),pe=ae+(Y^(re|~te))+ie[11]+3174756917&4294967295,ae=re+(pe<<10&4294967295|pe>>>22),pe=te+(re^(ae|~Y))+ie[2]+718787259&4294967295,te=ae+(pe<<15&4294967295|pe>>>17),pe=Y+(ae^(te|~re))+ie[9]+3951481745&4294967295,de.g[0]=de.g[0]+re&4294967295,de.g[1]=de.g[1]+(te+(pe<<21&4294967295|pe>>>11))&4294967295,de.g[2]=de.g[2]+te&4294967295,de.g[3]=de.g[3]+ae&4294967295}c.prototype.u=function(de,re){re===void 0&&(re=de.length);for(var Y=re-this.blockSize,ie=this.B,te=this.h,ae=0;ae<re;){if(te==0)for(;ae<=Y;)d(this,de,ae),ae+=this.blockSize;if(typeof de=="string"){for(;ae<re;)if(ie[te++]=de.charCodeAt(ae++),te==this.blockSize){d(this,ie),te=0;break}}else for(;ae<re;)if(ie[te++]=de[ae++],te==this.blockSize){d(this,ie),te=0;break}}this.h=te,this.o+=re},c.prototype.v=function(){var de=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);de[0]=128;for(var re=1;re<de.length-8;++re)de[re]=0;var Y=8*this.o;for(re=de.length-8;re<de.length;++re)de[re]=Y&255,Y/=256;for(this.u(de),de=Array(16),re=Y=0;4>re;++re)for(var ie=0;32>ie;ie+=8)de[Y++]=this.g[re]>>>ie&255;return de};function v(de,re){var Y=T;return Object.prototype.hasOwnProperty.call(Y,de)?Y[de]:Y[de]=re(de)}function y(de,re){this.h=re;for(var Y=[],ie=!0,te=de.length-1;0<=te;te--){var ae=de[te]|0;ie&&ae==re||(Y[te]=ae,ie=!1)}this.g=Y}var T={};function r(de){return-128<=de&&128>de?v(de,function(re){return new y([re|0],0>re?-1:0)}):new y([de|0],0>de?-1:0)}function D(de){if(isNaN(de)||!isFinite(de))return B;if(0>de)return ne(D(-de));for(var re=[],Y=1,ie=0;de>=Y;ie++)re[ie]=de/Y|0,Y*=4294967296;return new y(re,0)}function L(de,re){if(de.length==0)throw Error("number format error: empty string");if(re=re||10,2>re||36<re)throw Error("radix out of range: "+re);if(de.charAt(0)=="-")return ne(L(de.substring(1),re));if(0<=de.indexOf("-"))throw Error('number format error: interior "-" character');for(var Y=D(Math.pow(re,8)),ie=B,te=0;te<de.length;te+=8){var ae=Math.min(8,de.length-te),pe=parseInt(de.substring(te,te+ae),re);8>ae?(ae=D(Math.pow(re,ae)),ie=ie.j(ae).add(D(pe))):(ie=ie.j(Y),ie=ie.add(D(pe)))}return ie}var B=r(0),U=r(1),$=r(16777216);e=y.prototype,e.m=function(){if(q(this))return-ne(this).m();for(var de=0,re=1,Y=0;Y<this.g.length;Y++){var ie=this.i(Y);de+=(0<=ie?ie:4294967296+ie)*re,re*=4294967296}return de},e.toString=function(de){if(de=de||10,2>de||36<de)throw Error("radix out of range: "+de);if(W(this))return"0";if(q(this))return"-"+ne(this).toString(de);for(var re=D(Math.pow(de,6)),Y=this,ie="";;){var te=be(Y,re).g;Y=ce(Y,te.j(re));var ae=((0<Y.g.length?Y.g[0]:Y.h)>>>0).toString(de);if(Y=te,W(Y))return ae+ie;for(;6>ae.length;)ae="0"+ae;ie=ae+ie}},e.i=function(de){return 0>de?0:de<this.g.length?this.g[de]:this.h};function W(de){if(de.h!=0)return!1;for(var re=0;re<de.g.length;re++)if(de.g[re]!=0)return!1;return!0}function q(de){return de.h==-1}e.l=function(de){return de=ce(this,de),q(de)?-1:W(de)?0:1};function ne(de){for(var re=de.g.length,Y=[],ie=0;ie<re;ie++)Y[ie]=~de.g[ie];return new y(Y,~de.h).add(U)}e.abs=function(){return q(this)?ne(this):this},e.add=function(de){for(var re=Math.max(this.g.length,de.g.length),Y=[],ie=0,te=0;te<=re;te++){var ae=ie+(this.i(te)&65535)+(de.i(te)&65535),pe=(ae>>>16)+(this.i(te)>>>16)+(de.i(te)>>>16);ie=pe>>>16,ae&=65535,pe&=65535,Y[te]=pe<<16|ae}return new y(Y,Y[Y.length-1]&-2147483648?-1:0)};function ce(de,re){return de.add(ne(re))}e.j=function(de){if(W(this)||W(de))return B;if(q(this))return q(de)?ne(this).j(ne(de)):ne(ne(this).j(de));if(q(de))return ne(this.j(ne(de)));if(0>this.l($)&&0>de.l($))return D(this.m()*de.m());for(var re=this.g.length+de.g.length,Y=[],ie=0;ie<2*re;ie++)Y[ie]=0;for(ie=0;ie<this.g.length;ie++)for(var te=0;te<de.g.length;te++){var ae=this.i(ie)>>>16,pe=this.i(ie)&65535,Le=de.i(te)>>>16,tt=de.i(te)&65535;Y[2*ie+2*te]+=pe*tt,oe(Y,2*ie+2*te),Y[2*ie+2*te+1]+=ae*tt,oe(Y,2*ie+2*te+1),Y[2*ie+2*te+1]+=pe*Le,oe(Y,2*ie+2*te+1),Y[2*ie+2*te+2]+=ae*Le,oe(Y,2*ie+2*te+2)}for(ie=0;ie<re;ie++)Y[ie]=Y[2*ie+1]<<16|Y[2*ie];for(ie=re;ie<2*re;ie++)Y[ie]=0;return new y(Y,0)};function oe(de,re){for(;(de[re]&65535)!=de[re];)de[re+1]+=de[re]>>>16,de[re]&=65535,re++}function fe(de,re){this.g=de,this.h=re}function be(de,re){if(W(re))throw Error("division by zero");if(W(de))return new fe(B,B);if(q(de))return re=be(ne(de),re),new fe(ne(re.g),ne(re.h));if(q(re))return re=be(de,ne(re)),new fe(ne(re.g),re.h);if(30<de.g.length){if(q(de)||q(re))throw Error("slowDivide_ only works with positive integers.");for(var Y=U,ie=re;0>=ie.l(de);)Y=ge(Y),ie=ge(ie);var te=Ee(Y,1),ae=Ee(ie,1);for(ie=Ee(ie,2),Y=Ee(Y,2);!W(ie);){var pe=ae.add(ie);0>=pe.l(de)&&(te=te.add(Y),ae=pe),ie=Ee(ie,1),Y=Ee(Y,1)}return re=ce(de,te.j(re)),new fe(te,re)}for(te=B;0<=de.l(re);){for(Y=Math.max(1,Math.floor(de.m()/re.m())),ie=Math.ceil(Math.log(Y)/Math.LN2),ie=48>=ie?1:Math.pow(2,ie-48),ae=D(Y),pe=ae.j(re);q(pe)||0<pe.l(de);)Y-=ie,ae=D(Y),pe=ae.j(re);W(ae)&&(ae=U),te=te.add(ae),de=ce(de,pe)}return new fe(te,de)}e.A=function(de){return be(this,de).h},e.and=function(de){for(var re=Math.max(this.g.length,de.g.length),Y=[],ie=0;ie<re;ie++)Y[ie]=this.i(ie)&de.i(ie);return new y(Y,this.h&de.h)},e.or=function(de){for(var re=Math.max(this.g.length,de.g.length),Y=[],ie=0;ie<re;ie++)Y[ie]=this.i(ie)|de.i(ie);return new y(Y,this.h|de.h)},e.xor=function(de){for(var re=Math.max(this.g.length,de.g.length),Y=[],ie=0;ie<re;ie++)Y[ie]=this.i(ie)^de.i(ie);return new y(Y,this.h^de.h)};function ge(de){for(var re=de.g.length+1,Y=[],ie=0;ie<re;ie++)Y[ie]=de.i(ie)<<1|de.i(ie-1)>>>31;return new y(Y,de.h)}function Ee(de,re){var Y=re>>5;re%=32;for(var ie=de.g.length-Y,te=[],ae=0;ae<ie;ae++)te[ae]=0<re?de.i(ae+Y)>>>re|de.i(ae+Y+1)<<32-re:de.i(ae+Y);return new y(te,de.h)}c.prototype.digest=c.prototype.v,c.prototype.reset=c.prototype.s,c.prototype.update=c.prototype.u,y.prototype.add=y.prototype.add,y.prototype.multiply=y.prototype.j,y.prototype.modulo=y.prototype.A,y.prototype.compare=y.prototype.l,y.prototype.toNumber=y.prototype.m,y.prototype.toString=y.prototype.toString,y.prototype.getBits=y.prototype.i,y.fromNumber=D,y.fromString=L,eO=y}).apply(typeof NP<"u"?NP:typeof self<"u"?self:typeof window<"u"?window:{});var Ey=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};(function(){var e,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(F,le,xe){return F==Array.prototype||F==Object.prototype||(F[le]=xe.value),F};function o(F){F=[typeof globalThis=="object"&&globalThis,F,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ey=="object"&&Ey];for(var le=0;le<F.length;++le){var xe=F[le];if(xe&&xe.Math==Math)return xe}throw Error("Cannot find global object")}var c=o(this);function d(F,le){if(le)e:{var xe=c;F=F.split(".");for(var Be=0;Be<F.length-1;Be++){var dt=F[Be];if(!(dt in xe))break e;xe=xe[dt]}F=F[F.length-1],Be=xe[F],le=le(Be),le!=Be&&le!=null&&t(xe,F,{configurable:!0,writable:!0,value:le})}}function v(F,le){F instanceof String&&(F+="");var xe=0,Be=!1,dt={next:function(){if(!Be&&xe<F.length){var on=xe++;return{value:le(on,F[on]),done:!1}}return Be=!0,{done:!0,value:void 0}}};return dt[Symbol.iterator]=function(){return dt},dt}d("Array.prototype.values",function(F){return F||function(){return v(this,function(le,xe){return xe})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var y=y||{},T=this||self;function r(F){var le=typeof F;return le=le!="object"?le:F?Array.isArray(F)?"array":le:"null",le=="array"||le=="object"&&typeof F.length=="number"}function D(F){var le=typeof F;return le=="object"&&F!=null||le=="function"}function L(F,le,xe){return F.call.apply(F.bind,arguments)}function B(F,le,xe){if(!F)throw Error();if(2<arguments.length){var Be=Array.prototype.slice.call(arguments,2);return function(){var dt=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(dt,Be),F.apply(le,dt)}}return function(){return F.apply(le,arguments)}}function U(F,le,xe){return U=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?L:B,U.apply(null,arguments)}function $(F,le){var xe=Array.prototype.slice.call(arguments,1);return function(){var Be=xe.slice();return Be.push.apply(Be,arguments),F.apply(this,Be)}}function W(F,le){function xe(){}xe.prototype=le.prototype,F.aa=le.prototype,F.prototype=new xe,F.prototype.constructor=F,F.Qb=function(Be,dt,on){for(var Kt=Array(arguments.length-2),Ir=2;Ir<arguments.length;Ir++)Kt[Ir-2]=arguments[Ir];return le.prototype[dt].apply(Be,Kt)}}function q(F){const le=F.length;if(0<le){const xe=Array(le);for(let Be=0;Be<le;Be++)xe[Be]=F[Be];return xe}return[]}function ne(F,le){for(let xe=1;xe<arguments.length;xe++){const Be=arguments[xe];if(r(Be)){const dt=F.length||0,on=Be.length||0;F.length=dt+on;for(let Kt=0;Kt<on;Kt++)F[dt+Kt]=Be[Kt]}else F.push(Be)}}class ce{constructor(le,xe){this.i=le,this.j=xe,this.h=0,this.g=null}get(){let le;return 0<this.h?(this.h--,le=this.g,this.g=le.next,le.next=null):le=this.i(),le}}function oe(F){return/^[\s\xa0]*$/.test(F)}function fe(){var F=T.navigator;return F&&(F=F.userAgent)?F:""}function be(F){return be[" "](F),F}be[" "]=function(){};var ge=fe().indexOf("Gecko")!=-1&&!(fe().toLowerCase().indexOf("webkit")!=-1&&fe().indexOf("Edge")==-1)&&!(fe().indexOf("Trident")!=-1||fe().indexOf("MSIE")!=-1)&&fe().indexOf("Edge")==-1;function Ee(F,le,xe){for(const Be in F)le.call(xe,F[Be],Be,F)}function de(F,le){for(const xe in F)le.call(void 0,F[xe],xe,F)}function re(F){const le={};for(const xe in F)le[xe]=F[xe];return le}const Y="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ie(F,le){let xe,Be;for(let dt=1;dt<arguments.length;dt++){Be=arguments[dt];for(xe in Be)F[xe]=Be[xe];for(let on=0;on<Y.length;on++)xe=Y[on],Object.prototype.hasOwnProperty.call(Be,xe)&&(F[xe]=Be[xe])}}function te(F){var le=1;F=F.split(":");const xe=[];for(;0<le&&F.length;)xe.push(F.shift()),le--;return F.length&&xe.push(F.join(":")),xe}function ae(F){T.setTimeout(()=>{throw F},0)}function pe(){var F=yt;let le=null;return F.g&&(le=F.g,F.g=F.g.next,F.g||(F.h=null),le.next=null),le}class Le{constructor(){this.h=this.g=null}add(le,xe){const Be=tt.get();Be.set(le,xe),this.h?this.h.next=Be:this.g=Be,this.h=Be}}var tt=new ce(()=>new Je,F=>F.reset());class Je{constructor(){this.next=this.g=this.h=null}set(le,xe){this.h=le,this.g=xe,this.next=null}reset(){this.next=this.g=this.h=null}}let Mt,Lt=!1,yt=new Le,rt=()=>{const F=T.Promise.resolve(void 0);Mt=()=>{F.then(mt)}};var mt=()=>{for(var F;F=pe();){try{F.h.call(F.g)}catch(xe){ae(xe)}var le=tt;le.j(F),100>le.h&&(le.h++,F.next=le.g,le.g=F)}Lt=!1};function Ft(){this.s=this.s,this.C=this.C}Ft.prototype.s=!1,Ft.prototype.ma=function(){this.s||(this.s=!0,this.N())},Ft.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function bn(F,le){this.type=F,this.g=this.target=le,this.defaultPrevented=!1}bn.prototype.h=function(){this.defaultPrevented=!0};var Bt=function(){if(!T.addEventListener||!Object.defineProperty)return!1;var F=!1,le=Object.defineProperty({},"passive",{get:function(){F=!0}});try{const xe=()=>{};T.addEventListener("test",xe,le),T.removeEventListener("test",xe,le)}catch{}return F}();function ht(F,le){if(bn.call(this,F?F.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,F){var xe=this.type=F.type,Be=F.changedTouches&&F.changedTouches.length?F.changedTouches[0]:null;if(this.target=F.target||F.srcElement,this.g=le,le=F.relatedTarget){if(ge){e:{try{be(le.nodeName);var dt=!0;break e}catch{}dt=!1}dt||(le=null)}}else xe=="mouseover"?le=F.fromElement:xe=="mouseout"&&(le=F.toElement);this.relatedTarget=le,Be?(this.clientX=Be.clientX!==void 0?Be.clientX:Be.pageX,this.clientY=Be.clientY!==void 0?Be.clientY:Be.pageY,this.screenX=Be.screenX||0,this.screenY=Be.screenY||0):(this.clientX=F.clientX!==void 0?F.clientX:F.pageX,this.clientY=F.clientY!==void 0?F.clientY:F.pageY,this.screenX=F.screenX||0,this.screenY=F.screenY||0),this.button=F.button,this.key=F.key||"",this.ctrlKey=F.ctrlKey,this.altKey=F.altKey,this.shiftKey=F.shiftKey,this.metaKey=F.metaKey,this.pointerId=F.pointerId||0,this.pointerType=typeof F.pointerType=="string"?F.pointerType:gt[F.pointerType]||"",this.state=F.state,this.i=F,F.defaultPrevented&&ht.aa.h.call(this)}}W(ht,bn);var gt={2:"touch",3:"pen",4:"mouse"};ht.prototype.h=function(){ht.aa.h.call(this);var F=this.i;F.preventDefault?F.preventDefault():F.returnValue=!1};var et="closure_listenable_"+(1e6*Math.random()|0),Nt=0;function St(F,le,xe,Be,dt){this.listener=F,this.proxy=null,this.src=le,this.type=xe,this.capture=!!Be,this.ha=dt,this.key=++Nt,this.da=this.fa=!1}function Xt(F){F.da=!0,F.listener=null,F.proxy=null,F.src=null,F.ha=null}function Ie(F){this.src=F,this.g={},this.h=0}Ie.prototype.add=function(F,le,xe,Be,dt){var on=F.toString();F=this.g[on],F||(F=this.g[on]=[],this.h++);var Kt=Ae(F,le,Be,dt);return-1<Kt?(le=F[Kt],xe||(le.fa=!1)):(le=new St(le,this.src,on,!!Be,dt),le.fa=xe,F.push(le)),le};function gn(F,le){var xe=le.type;if(xe in F.g){var Be=F.g[xe],dt=Array.prototype.indexOf.call(Be,le,void 0),on;(on=0<=dt)&&Array.prototype.splice.call(Be,dt,1),on&&(Xt(le),F.g[xe].length==0&&(delete F.g[xe],F.h--))}}function Ae(F,le,xe,Be){for(var dt=0;dt<F.length;++dt){var on=F[dt];if(!on.da&&on.listener==le&&on.capture==!!xe&&on.ha==Be)return dt}return-1}var Ne="closure_lm_"+(1e6*Math.random()|0),Ue={};function Et(F,le,xe,Be,dt){if(Array.isArray(le)){for(var on=0;on<le.length;on++)Et(F,le[on],xe,Be,dt);return null}return xe=hn(xe),F&&F[et]?F.K(le,xe,D(Be)?!!Be.capture:!!Be,dt):Ct(F,le,xe,!1,Be,dt)}function Ct(F,le,xe,Be,dt,on){if(!le)throw Error("Invalid event type");var Kt=D(dt)?!!dt.capture:!!dt,Ir=Wn(F);if(Ir||(F[Ne]=Ir=new Ie(F)),xe=Ir.add(le,xe,Be,Kt,on),xe.proxy)return xe;if(Be=Qt(),xe.proxy=Be,Be.src=F,Be.listener=xe,F.addEventListener)Bt||(dt=Kt),dt===void 0&&(dt=!1),F.addEventListener(le.toString(),Be,dt);else if(F.attachEvent)F.attachEvent(vn(le.toString()),Be);else if(F.addListener&&F.removeListener)F.addListener(Be);else throw Error("addEventListener and attachEvent are unavailable.");return xe}function Qt(){function F(xe){return le.call(F.src,F.listener,xe)}const le=dn;return F}function Gt(F,le,xe,Be,dt){if(Array.isArray(le))for(var on=0;on<le.length;on++)Gt(F,le[on],xe,Be,dt);else Be=D(Be)?!!Be.capture:!!Be,xe=hn(xe),F&&F[et]?(F=F.i,le=String(le).toString(),le in F.g&&(on=F.g[le],xe=Ae(on,xe,Be,dt),-1<xe&&(Xt(on[xe]),Array.prototype.splice.call(on,xe,1),on.length==0&&(delete F.g[le],F.h--)))):F&&(F=Wn(F))&&(le=F.g[le.toString()],F=-1,le&&(F=Ae(le,xe,Be,dt)),(xe=-1<F?le[F]:null)&&Yt(xe))}function Yt(F){if(typeof F!="number"&&F&&!F.da){var le=F.src;if(le&&le[et])gn(le.i,F);else{var xe=F.type,Be=F.proxy;le.removeEventListener?le.removeEventListener(xe,Be,F.capture):le.detachEvent?le.detachEvent(vn(xe),Be):le.addListener&&le.removeListener&&le.removeListener(Be),(xe=Wn(le))?(gn(xe,F),xe.h==0&&(xe.src=null,le[Ne]=null)):Xt(F)}}}function vn(F){return F in Ue?Ue[F]:Ue[F]="on"+F}function dn(F,le){if(F.da)F=!0;else{le=new ht(le,this);var xe=F.listener,Be=F.ha||F.src;F.fa&&Yt(F),F=xe.call(Be,le)}return F}function Wn(F){return F=F[Ne],F instanceof Ie?F:null}var Rn="__closure_events_fn_"+(1e9*Math.random()>>>0);function hn(F){return typeof F=="function"?F:(F[Rn]||(F[Rn]=function(le){return F.handleEvent(le)}),F[Rn])}function jn(){Ft.call(this),this.i=new Ie(this),this.M=this,this.F=null}W(jn,Ft),jn.prototype[et]=!0,jn.prototype.removeEventListener=function(F,le,xe,Be){Gt(this,F,le,xe,Be)};function ti(F,le){var xe,Be=F.F;if(Be)for(xe=[];Be;Be=Be.F)xe.push(Be);if(F=F.M,Be=le.type||le,typeof le=="string")le=new bn(le,F);else if(le instanceof bn)le.target=le.target||F;else{var dt=le;le=new bn(Be,F),ie(le,dt)}if(dt=!0,xe)for(var on=xe.length-1;0<=on;on--){var Kt=le.g=xe[on];dt=ki(Kt,Be,!0,le)&&dt}if(Kt=le.g=F,dt=ki(Kt,Be,!0,le)&&dt,dt=ki(Kt,Be,!1,le)&&dt,xe)for(on=0;on<xe.length;on++)Kt=le.g=xe[on],dt=ki(Kt,Be,!1,le)&&dt}jn.prototype.N=function(){if(jn.aa.N.call(this),this.i){var F=this.i,le;for(le in F.g){for(var xe=F.g[le],Be=0;Be<xe.length;Be++)Xt(xe[Be]);delete F.g[le],F.h--}}this.F=null},jn.prototype.K=function(F,le,xe,Be){return this.i.add(String(F),le,!1,xe,Be)},jn.prototype.L=function(F,le,xe,Be){return this.i.add(String(F),le,!0,xe,Be)};function ki(F,le,xe,Be){if(le=F.i.g[String(le)],!le)return!0;le=le.concat();for(var dt=!0,on=0;on<le.length;++on){var Kt=le[on];if(Kt&&!Kt.da&&Kt.capture==xe){var Ir=Kt.listener,fo=Kt.ha||Kt.src;Kt.fa&&gn(F.i,Kt),dt=Ir.call(fo,Be)!==!1&&dt}}return dt&&!Be.defaultPrevented}function gi(F,le,xe){if(typeof F=="function")xe&&(F=U(F,xe));else if(F&&typeof F.handleEvent=="function")F=U(F.handleEvent,F);else throw Error("Invalid listener argument");return 2147483647<Number(le)?-1:T.setTimeout(F,le||0)}function or(F){F.g=gi(()=>{F.g=null,F.i&&(F.i=!1,or(F))},F.l);const le=F.h;F.h=null,F.m.apply(null,le)}class wr extends Ft{constructor(le,xe){super(),this.m=le,this.l=xe,this.h=null,this.i=!1,this.g=null}j(le){this.h=arguments,this.g?this.i=!0:or(this)}N(){super.N(),this.g&&(T.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Rr(F){Ft.call(this),this.h=F,this.g={}}W(Rr,Ft);var zr=[];function dr(F){Ee(F.g,function(le,xe){this.g.hasOwnProperty(xe)&&Yt(le)},F),F.g={}}Rr.prototype.N=function(){Rr.aa.N.call(this),dr(this)},Rr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ho=T.JSON.stringify,Sr=T.JSON.parse,Tr=class{stringify(F){return T.JSON.stringify(F,void 0)}parse(F){return T.JSON.parse(F,void 0)}};function Bo(){}Bo.prototype.h=null;function ii(F){return F.h||(F.h=F.i())}function Qo(){}var vs={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function To(){bn.call(this,"d")}W(To,bn);function Eo(){bn.call(this,"c")}W(Eo,bn);var es={},ys=null;function Qs(){return ys=ys||new jn}es.La="serverreachability";function bs(F){bn.call(this,es.La,F)}W(bs,bn);function vt(F){const le=Qs();ti(le,new bs(le))}es.STAT_EVENT="statevent";function ye(F,le){bn.call(this,es.STAT_EVENT,F),this.stat=le}W(ye,bn);function Te(F){const le=Qs();ti(le,new ye(le,F))}es.Ma="timingevent";function Ve(F,le){bn.call(this,es.Ma,F),this.size=le}W(Ve,bn);function Ze(F,le){if(typeof F!="function")throw Error("Fn must not be null and must be a function");return T.setTimeout(function(){F()},le)}function Ge(){this.g=!0}Ge.prototype.xa=function(){this.g=!1};function at(F,le,xe,Be,dt,on){F.info(function(){if(F.g)if(on)for(var Kt="",Ir=on.split("&"),fo=0;fo<Ir.length;fo++){var Mn=Ir[fo].split("=");if(1<Mn.length){var No=Mn[0];Mn=Mn[1];var Ao=No.split("_");Kt=2<=Ao.length&&Ao[1]=="type"?Kt+(No+"="+Mn+"&"):Kt+(No+"=redacted&")}}else Kt=null;else Kt=on;return"XMLHTTP REQ ("+Be+") [attempt "+dt+"]: "+le+`
`+xe+`
`+Kt})}function xt(F,le,xe,Be,dt,on,Kt){F.info(function(){return"XMLHTTP RESP ("+Be+") [ attempt "+dt+"]: "+le+`
`+xe+`
`+on+" "+Kt})}function lt(F,le,xe,Be){F.info(function(){return"XMLHTTP TEXT ("+le+"): "+Rt(F,xe)+(Be?" "+Be:"")})}function wt(F,le){F.info(function(){return"TIMEOUT: "+le})}Ge.prototype.info=function(){};function Rt(F,le){if(!F.g)return le;if(!le)return null;try{var xe=JSON.parse(le);if(xe){for(F=0;F<xe.length;F++)if(Array.isArray(xe[F])){var Be=xe[F];if(!(2>Be.length)){var dt=Be[1];if(Array.isArray(dt)&&!(1>dt.length)){var on=dt[0];if(on!="noop"&&on!="stop"&&on!="close")for(var Kt=1;Kt<dt.length;Kt++)dt[Kt]=""}}}}return Ho(xe)}catch{return le}}var Tt={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Zt={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},xn;function wn(){}W(wn,Bo),wn.prototype.g=function(){return new XMLHttpRequest},wn.prototype.i=function(){return{}},xn=new wn;function $n(F,le,xe,Be){this.j=F,this.i=le,this.l=xe,this.R=Be||1,this.U=new Rr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Zn}function Zn(){this.i=null,this.g="",this.h=!1}var Xn={},Un={};function bi(F,le,xe){F.L=1,F.v=$a(ho(le)),F.m=xe,F.P=!0,Ri(F,null)}function Ri(F,le){F.F=Date.now(),qi(F),F.A=ho(F.v);var xe=F.A,Be=F.R;Array.isArray(Be)||(Be=[String(Be)]),In(xe.i,"t",Be),F.C=0,xe=F.j.J,F.h=new Zn,F.g=wl(F.j,xe?le:null,!F.m),0<F.O&&(F.M=new wr(U(F.Y,F,F.g),F.O)),le=F.U,xe=F.g,Be=F.ca;var dt="readystatechange";Array.isArray(dt)||(dt&&(zr[0]=dt.toString()),dt=zr);for(var on=0;on<dt.length;on++){var Kt=Et(xe,dt[on],Be||le.handleEvent,!1,le.h||le);if(!Kt)break;le.g[Kt.key]=Kt}le=F.H?re(F.H):{},F.m?(F.u||(F.u="POST"),le["Content-Type"]="application/x-www-form-urlencoded",F.g.ea(F.A,F.u,F.m,le)):(F.u="GET",F.g.ea(F.A,F.u,null,le)),vt(),at(F.i,F.u,F.A,F.l,F.R,F.m)}$n.prototype.ca=function(F){F=F.target;const le=this.M;le&&Ti(F)==3?le.j():this.Y(F)},$n.prototype.Y=function(F){try{if(F==this.g)e:{const Ao=Ti(this.g);var le=this.g.Ba();const nl=this.g.Z();if(!(3>Ao)&&(Ao!=3||this.g&&(this.h.h||this.g.oa()||$i(this.g)))){this.J||Ao!=4||le==7||(le==8||0>=nl?vt(3):vt(2)),Pr(this);var xe=this.g.Z();this.X=xe;t:if(ni(this)){var Be=$i(this.g);F="";var dt=Be.length,on=Ti(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){uo(this),Dr(this);var Kt="";break t}this.h.i=new T.TextDecoder}for(le=0;le<dt;le++)this.h.h=!0,F+=this.h.i.decode(Be[le],{stream:!(on&&le==dt-1)});Be.length=0,this.h.g+=F,this.C=0,Kt=this.h.g}else Kt=this.g.oa();if(this.o=xe==200,xt(this.i,this.u,this.A,this.l,this.R,Ao,xe),this.o){if(this.T&&!this.K){t:{if(this.g){var Ir,fo=this.g;if((Ir=fo.g?fo.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!oe(Ir)){var Mn=Ir;break t}}Mn=null}if(xe=Mn)lt(this.i,this.l,xe,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ts(this,xe);else{this.o=!1,this.s=3,Te(12),uo(this),Dr(this);break e}}if(this.P){xe=!0;let Uo;for(;!this.J&&this.C<Kt.length;)if(Uo=Ai(this,Kt),Uo==Un){Ao==4&&(this.s=4,Te(14),xe=!1),lt(this.i,this.l,null,"[Incomplete Response]");break}else if(Uo==Xn){this.s=4,Te(15),lt(this.i,this.l,Kt,"[Invalid Chunk]"),xe=!1;break}else lt(this.i,this.l,Uo,null),ts(this,Uo);if(ni(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ao!=4||Kt.length!=0||this.h.h||(this.s=1,Te(16),xe=!1),this.o=this.o&&xe,!xe)lt(this.i,this.l,Kt,"[Invalid Chunked Response]"),uo(this),Dr(this);else if(0<Kt.length&&!this.W){this.W=!0;var No=this.j;No.g==this&&No.ba&&!No.M&&(No.j.info("Great, no buffering proxy detected. Bytes received: "+Kt.length),la(No),No.M=!0,Te(11))}}else lt(this.i,this.l,Kt,null),ts(this,Kt);Ao==4&&uo(this),this.o&&!this.J&&(Ao==4?hs(this.j,this):(this.o=!1,qi(this)))}else er(this.g),xe==400&&0<Kt.indexOf("Unknown SID")?(this.s=3,Te(12)):(this.s=0,Te(13)),uo(this),Dr(this)}}}catch{}finally{}};function ni(F){return F.g?F.u=="GET"&&F.L!=2&&F.j.Ca:!1}function Ai(F,le){var xe=F.C,Be=le.indexOf(`
`,xe);return Be==-1?Un:(xe=Number(le.substring(xe,Be)),isNaN(xe)?Xn:(Be+=1,Be+xe>le.length?Un:(le=le.slice(Be,Be+xe),F.C=Be+xe,le)))}$n.prototype.cancel=function(){this.J=!0,uo(this)};function qi(F){F.S=Date.now()+F.I,Qi(F,F.I)}function Qi(F,le){if(F.B!=null)throw Error("WatchDog timer not null");F.B=Ze(U(F.ba,F),le)}function Pr(F){F.B&&(T.clearTimeout(F.B),F.B=null)}$n.prototype.ba=function(){this.B=null;const F=Date.now();0<=F-this.S?(wt(this.i,this.A),this.L!=2&&(vt(),Te(17)),uo(this),this.s=2,Dr(this)):Qi(this,this.S-F)};function Dr(F){F.j.G==0||F.J||hs(F.j,F)}function uo(F){Pr(F);var le=F.M;le&&typeof le.ma=="function"&&le.ma(),F.M=null,dr(F.U),F.g&&(le=F.g,F.g=null,le.abort(),le.ma())}function ts(F,le){try{var xe=F.j;if(xe.G!=0&&(xe.g==F||Io(xe.h,F))){if(!F.K&&Io(xe.h,F)&&xe.G==3){try{var Be=xe.Da.g.parse(le)}catch{Be=null}if(Array.isArray(Be)&&Be.length==3){var dt=Be;if(dt[0]==0){e:if(!xe.u){if(xe.g)if(xe.g.F+3e3<F.F)Ic(xe),Wi(xe);else break e;aa(xe),Te(18)}}else xe.za=dt[1],0<xe.za-xe.T&&37500>dt[2]&&xe.F&&xe.v==0&&!xe.C&&(xe.C=Ze(U(xe.Za,xe),6e3));if(1>=Ua(xe.h)&&xe.ca){try{xe.ca()}catch{}xe.ca=void 0}}else Ta(xe,11)}else if((F.K||xe.g==F)&&Ic(xe),!oe(le))for(dt=xe.Da.g.parse(le),le=0;le<dt.length;le++){let Mn=dt[le];if(xe.T=Mn[0],Mn=Mn[1],xe.G==2)if(Mn[0]=="c"){xe.K=Mn[1],xe.ia=Mn[2];const No=Mn[3];No!=null&&(xe.la=No,xe.j.info("VER="+xe.la));const Ao=Mn[4];Ao!=null&&(xe.Aa=Ao,xe.j.info("SVER="+xe.Aa));const nl=Mn[5];nl!=null&&typeof nl=="number"&&0<nl&&(Be=1.5*nl,xe.L=Be,xe.j.info("backChannelRequestTimeoutMs_="+Be)),Be=xe;const Uo=F.g;if(Uo){const Ea=Uo.g?Uo.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Ea){var on=Be.h;on.g||Ea.indexOf("spdy")==-1&&Ea.indexOf("quic")==-1&&Ea.indexOf("h2")==-1||(on.j=on.l,on.g=new Set,on.h&&(ja(on,on.h),on.h=null))}if(Be.D){const Po=Uo.g?Uo.g.getResponseHeader("X-HTTP-Session-Id"):null;Po&&(Be.ya=Po,sr(Be.I,Be.D,Po))}}xe.G=3,xe.l&&xe.l.ua(),xe.ba&&(xe.R=Date.now()-F.F,xe.j.info("Handshake RTT: "+xe.R+"ms")),Be=xe;var Kt=F;if(Be.qa=xl(Be,Be.J?Be.ia:null,Be.W),Kt.K){xa(Be.h,Kt);var Ir=Kt,fo=Be.L;fo&&(Ir.I=fo),Ir.B&&(Pr(Ir),qi(Ir)),Be.g=Kt}else Ps(Be);0<xe.i.length&&Gi(xe)}else Mn[0]!="stop"&&Mn[0]!="close"||Ta(xe,7);else xe.G==3&&(Mn[0]=="stop"||Mn[0]=="close"?Mn[0]=="stop"?Ta(xe,7):Ni(xe):Mn[0]!="noop"&&xe.l&&xe.l.ta(Mn),xe.v=0)}}vt(4)}catch{}}var el=class{constructor(F,le){this.g=F,this.map=le}};function Cs(F){this.l=F||10,T.PerformanceNavigationTiming?(F=T.performance.getEntriesByType("navigation"),F=0<F.length&&(F[0].nextHopProtocol=="hq"||F[0].nextHopProtocol=="h2")):F=!!(T.chrome&&T.chrome.loadTimes&&T.chrome.loadTimes()&&T.chrome.loadTimes().wasFetchedViaSpdy),this.j=F?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ea(F){return F.h?!0:F.g?F.g.size>=F.j:!1}function Ua(F){return F.h?1:F.g?F.g.size:0}function Io(F,le){return F.h?F.h==le:F.g?F.g.has(le):!1}function ja(F,le){F.g?F.g.add(le):F.h=le}function xa(F,le){F.h&&F.h==le?F.h=null:F.g&&F.g.has(le)&&F.g.delete(le)}Cs.prototype.cancel=function(){if(this.i=wa(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const F of this.g.values())F.cancel();this.g.clear()}};function wa(F){if(F.h!=null)return F.i.concat(F.h.D);if(F.g!=null&&F.g.size!==0){let le=F.i;for(const xe of F.g.values())le=le.concat(xe.D);return le}return q(F.i)}function ta(F){if(F.V&&typeof F.V=="function")return F.V();if(typeof Map<"u"&&F instanceof Map||typeof Set<"u"&&F instanceof Set)return Array.from(F.values());if(typeof F=="string")return F.split("");if(r(F)){for(var le=[],xe=F.length,Be=0;Be<xe;Be++)le.push(F[Be]);return le}le=[],xe=0;for(Be in F)le[xe++]=F[Be];return le}function Fo(F){if(F.na&&typeof F.na=="function")return F.na();if(!F.V||typeof F.V!="function"){if(typeof Map<"u"&&F instanceof Map)return Array.from(F.keys());if(!(typeof Set<"u"&&F instanceof Set)){if(r(F)||typeof F=="string"){var le=[];F=F.length;for(var xe=0;xe<F;xe++)le.push(xe);return le}le=[],xe=0;for(const Be in F)le[xe++]=Be;return le}}}function ns(F,le){if(F.forEach&&typeof F.forEach=="function")F.forEach(le,void 0);else if(r(F)||typeof F=="string")Array.prototype.forEach.call(F,le,void 0);else for(var xe=Fo(F),Be=ta(F),dt=Be.length,on=0;on<dt;on++)le.call(void 0,Be[on],xe&&xe[on],F)}var _o=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Co(F,le){if(F){F=F.split("&");for(var xe=0;xe<F.length;xe++){var Be=F[xe].indexOf("="),dt=null;if(0<=Be){var on=F[xe].substring(0,Be);dt=F[xe].substring(Be+1)}else on=F[xe];le(on,dt?decodeURIComponent(dt.replace(/\+/g," ")):"")}}}function Ur(F){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,F instanceof Ur){this.h=F.h,is(this,F.j),this.o=F.o,this.g=F.g,Sa(this,F.s),this.l=F.l;var le=F.i,xe=new st;xe.i=le.i,le.g&&(xe.g=new Map(le.g),xe.h=le.h),cs(this,xe),this.m=F.m}else F&&(le=String(F).match(_o))?(this.h=!1,is(this,le[1]||"",!0),this.o=na(le[2]||""),this.g=na(le[3]||"",!0),Sa(this,le[4]),this.l=na(le[5]||"",!0),cs(this,le[6]||"",!0),this.m=na(le[7]||"")):(this.h=!1,this.i=new st(null,this.h))}Ur.prototype.toString=function(){var F=[],le=this.j;le&&F.push(to(le,ia,!0),":");var xe=this.g;return(xe||le=="file")&&(F.push("//"),(le=this.o)&&F.push(to(le,ia,!0),"@"),F.push(encodeURIComponent(String(xe)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),xe=this.s,xe!=null&&F.push(":",String(xe))),(xe=this.l)&&(this.g&&xe.charAt(0)!="/"&&F.push("/"),F.push(to(xe,xe.charAt(0)=="/"?Us:As,!0))),(xe=this.i.toString())&&F.push("?",xe),(xe=this.m)&&F.push("#",to(xe,bl)),F.join("")};function ho(F){return new Ur(F)}function is(F,le,xe){F.j=xe?na(le,!0):le,F.j&&(F.j=F.j.replace(/:$/,""))}function Sa(F,le){if(le){if(le=Number(le),isNaN(le)||0>le)throw Error("Bad port number "+le);F.s=le}else F.s=null}function cs(F,le,xe){le instanceof st?(F.i=le,Mr(F.i,F.h)):(xe||(le=to(le,ra)),F.i=new st(le,F.h))}function sr(F,le,xe){F.i.set(le,xe)}function $a(F){return sr(F,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),F}function na(F,le){return F?le?decodeURI(F.replace(/%25/g,"%2525")):decodeURIComponent(F):""}function to(F,le,xe){return typeof F=="string"?(F=encodeURI(F).replace(le,Ns),xe&&(F=F.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),F):null}function Ns(F){return F=F.charCodeAt(0),"%"+(F>>4&15).toString(16)+(F&15).toString(16)}var ia=/[#\/\?@]/g,As=/[#\?:]/g,Us=/[#\?]/g,ra=/[#\?@]/g,bl=/#/g;function st(F,le){this.h=this.g=null,this.i=F||null,this.j=!!le}function en(F){F.g||(F.g=new Map,F.h=0,F.i&&Co(F.i,function(le,xe){F.add(decodeURIComponent(le.replace(/\+/g," ")),xe)}))}e=st.prototype,e.add=function(F,le){en(this),this.i=null,F=ar(this,F);var xe=this.g.get(F);return xe||this.g.set(F,xe=[]),xe.push(le),this.h+=1,this};function tn(F,le){en(F),le=ar(F,le),F.g.has(le)&&(F.i=null,F.h-=F.g.get(le).length,F.g.delete(le))}function xi(F,le){return en(F),le=ar(F,le),F.g.has(le)}e.forEach=function(F,le){en(this),this.g.forEach(function(xe,Be){xe.forEach(function(dt){F.call(le,dt,Be,this)},this)},this)},e.na=function(){en(this);const F=Array.from(this.g.values()),le=Array.from(this.g.keys()),xe=[];for(let Be=0;Be<le.length;Be++){const dt=F[Be];for(let on=0;on<dt.length;on++)xe.push(le[Be])}return xe},e.V=function(F){en(this);let le=[];if(typeof F=="string")xi(this,F)&&(le=le.concat(this.g.get(ar(this,F))));else{F=Array.from(this.g.values());for(let xe=0;xe<F.length;xe++)le=le.concat(F[xe])}return le},e.set=function(F,le){return en(this),this.i=null,F=ar(this,F),xi(this,F)&&(this.h-=this.g.get(F).length),this.g.set(F,[le]),this.h+=1,this},e.get=function(F,le){return F?(F=this.V(F),0<F.length?String(F[0]):le):le};function In(F,le,xe){tn(F,le),0<xe.length&&(F.i=null,F.g.set(ar(F,le),q(xe)),F.h+=xe.length)}e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const F=[],le=Array.from(this.g.keys());for(var xe=0;xe<le.length;xe++){var Be=le[xe];const on=encodeURIComponent(String(Be)),Kt=this.V(Be);for(Be=0;Be<Kt.length;Be++){var dt=on;Kt[Be]!==""&&(dt+="="+encodeURIComponent(String(Kt[Be]))),F.push(dt)}}return this.i=F.join("&")};function ar(F,le){return le=String(le),F.j&&(le=le.toLowerCase()),le}function Mr(F,le){le&&!F.j&&(en(F),F.i=null,F.g.forEach(function(xe,Be){var dt=Be.toLowerCase();Be!=dt&&(tn(this,Be),In(this,dt,xe))},F)),F.j=le}function fr(F,le){const xe=new Ge;if(T.Image){const Be=new Image;Be.onload=$(Er,xe,"TestLoadImage: loaded",!0,le,Be),Be.onerror=$(Er,xe,"TestLoadImage: error",!1,le,Be),Be.onabort=$(Er,xe,"TestLoadImage: abort",!1,le,Be),Be.ontimeout=$(Er,xe,"TestLoadImage: timeout",!1,le,Be),T.setTimeout(function(){Be.ontimeout&&Be.ontimeout()},1e4),Be.src=F}else le(!1)}function Yr(F,le){const xe=new Ge,Be=new AbortController,dt=setTimeout(()=>{Be.abort(),Er(xe,"TestPingServer: timeout",!1,le)},1e4);fetch(F,{signal:Be.signal}).then(on=>{clearTimeout(dt),on.ok?Er(xe,"TestPingServer: ok",!0,le):Er(xe,"TestPingServer: server error",!1,le)}).catch(()=>{clearTimeout(dt),Er(xe,"TestPingServer: error",!1,le)})}function Er(F,le,xe,Be,dt){try{dt&&(dt.onload=null,dt.onerror=null,dt.onabort=null,dt.ontimeout=null),Be(xe)}catch{}}function rs(){this.g=new Tr}function yn(F,le,xe){const Be=xe||"";try{ns(F,function(dt,on){let Kt=dt;D(dt)&&(Kt=Ho(dt)),le.push(Be+on+"="+encodeURIComponent(Kt))})}catch(dt){throw le.push(Be+"type="+encodeURIComponent("_badmap")),dt}}function fi(F){this.l=F.Ub||null,this.j=F.eb||!1}W(fi,Bo),fi.prototype.g=function(){return new hi(this.l,this.j)},fi.prototype.i=function(F){return function(){return F}}({});function hi(F,le){jn.call(this),this.D=F,this.o=le,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}W(hi,jn),e=hi.prototype,e.open=function(F,le){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=F,this.A=le,this.readyState=1,ri(this)},e.send=function(F){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const le={headers:this.u,method:this.B,credentials:this.m,cache:void 0};F&&(le.body=F),(this.D||T).fetch(new Request(this.A,le)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,kr(this)),this.readyState=0},e.Sa=function(F){if(this.g&&(this.l=F,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=F.headers,this.readyState=2,ri(this)),this.g&&(this.readyState=3,ri(this),this.g)))if(this.responseType==="arraybuffer")F.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof T.ReadableStream<"u"&&"body"in F){if(this.j=F.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;no(this)}else F.text().then(this.Ra.bind(this),this.ga.bind(this))};function no(F){F.j.read().then(F.Pa.bind(F)).catch(F.ga.bind(F))}e.Pa=function(F){if(this.g){if(this.o&&F.value)this.response.push(F.value);else if(!this.o){var le=F.value?F.value:new Uint8Array(0);(le=this.v.decode(le,{stream:!F.done}))&&(this.response=this.responseText+=le)}F.done?kr(this):ri(this),this.readyState==3&&no(this)}},e.Ra=function(F){this.g&&(this.response=this.responseText=F,kr(this))},e.Qa=function(F){this.g&&(this.response=F,kr(this))},e.ga=function(){this.g&&kr(this)};function kr(F){F.readyState=4,F.l=null,F.j=null,F.v=null,ri(F)}e.setRequestHeader=function(F,le){this.u.append(F,le)},e.getResponseHeader=function(F){return this.h&&this.h.get(F.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const F=[],le=this.h.entries();for(var xe=le.next();!xe.done;)xe=xe.value,F.push(xe[0]+": "+xe[1]),xe=le.next();return F.join(`\r
`)};function ri(F){F.onreadystatechange&&F.onreadystatechange.call(F)}Object.defineProperty(hi.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(F){this.m=F?"include":"same-origin"}});function oa(F){let le="";return Ee(F,function(xe,Be){le+=Be,le+=":",le+=xe,le+=`\r
`}),le}function us(F,le,xe){e:{for(Be in xe){var Be=!1;break e}Be=!0}Be||(xe=oa(xe),typeof F=="string"?xe!=null&&encodeURIComponent(String(xe)):sr(F,le,xe))}function pr(F){jn.call(this),this.headers=new Map,this.o=F||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}W(pr,jn);var vo=/^https?$/i,Xe=["POST","PUT"];e=pr.prototype,e.Ha=function(F){this.J=F},e.ea=function(F,le,xe,Be){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+F);le=le?le.toUpperCase():"GET",this.D=F,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():xn.g(),this.v=this.o?ii(this.o):ii(xn),this.g.onreadystatechange=U(this.Ea,this);try{this.B=!0,this.g.open(le,String(F),!0),this.B=!1}catch(on){Dt(this,on);return}if(F=xe||"",xe=new Map(this.headers),Be)if(Object.getPrototypeOf(Be)===Object.prototype)for(var dt in Be)xe.set(dt,Be[dt]);else if(typeof Be.keys=="function"&&typeof Be.get=="function")for(const on of Be.keys())xe.set(on,Be.get(on));else throw Error("Unknown input type for opt_headers: "+String(Be));Be=Array.from(xe.keys()).find(on=>on.toLowerCase()=="content-type"),dt=T.FormData&&F instanceof T.FormData,!(0<=Array.prototype.indexOf.call(Xe,le,void 0))||Be||dt||xe.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[on,Kt]of xe)this.g.setRequestHeader(on,Kt);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{yi(this),this.u=!0,this.g.send(F),this.u=!1}catch(on){Dt(this,on)}};function Dt(F,le){F.h=!1,F.g&&(F.j=!0,F.g.abort(),F.j=!1),F.l=le,F.m=5,Sn(F),zi(F)}function Sn(F){F.A||(F.A=!0,ti(F,"complete"),ti(F,"error"))}e.abort=function(F){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=F||7,ti(this,"complete"),ti(this,"abort"),zi(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),zi(this,!0)),pr.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?Hn(this):this.bb())},e.bb=function(){Hn(this)};function Hn(F){if(F.h&&typeof y<"u"&&(!F.v[1]||Ti(F)!=4||F.Z()!=2)){if(F.u&&Ti(F)==4)gi(F.Ea,0,F);else if(ti(F,"readystatechange"),Ti(F)==4){F.h=!1;try{const Kt=F.Z();e:switch(Kt){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var le=!0;break e;default:le=!1}var xe;if(!(xe=le)){var Be;if(Be=Kt===0){var dt=String(F.D).match(_o)[1]||null;!dt&&T.self&&T.self.location&&(dt=T.self.location.protocol.slice(0,-1)),Be=!vo.test(dt?dt.toLowerCase():"")}xe=Be}if(xe)ti(F,"complete"),ti(F,"success");else{F.m=6;try{var on=2<Ti(F)?F.g.statusText:""}catch{on=""}F.l=on+" ["+F.Z()+"]",Sn(F)}}finally{zi(F)}}}}function zi(F,le){if(F.g){yi(F);const xe=F.g,Be=F.v[0]?()=>{}:null;F.g=null,F.v=null,le||ti(F,"ready");try{xe.onreadystatechange=Be}catch{}}}function yi(F){F.I&&(T.clearTimeout(F.I),F.I=null)}e.isActive=function(){return!!this.g};function Ti(F){return F.g?F.g.readyState:0}e.Z=function(){try{return 2<Ti(this)?this.g.status:-1}catch{return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},e.Oa=function(F){if(this.g){var le=this.g.responseText;return F&&le.indexOf(F)==0&&(le=le.substring(F.length)),Sr(le)}};function $i(F){try{if(!F.g)return null;if("response"in F.g)return F.g.response;switch(F.H){case"":case"text":return F.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in F.g)return F.g.mozResponseArrayBuffer}return null}catch{return null}}function er(F){const le={};F=(F.g&&2<=Ti(F)&&F.g.getAllResponseHeaders()||"").split(`\r
`);for(let Be=0;Be<F.length;Be++){if(oe(F[Be]))continue;var xe=te(F[Be]);const dt=xe[0];if(xe=xe[1],typeof xe!="string")continue;xe=xe.trim();const on=le[dt]||[];le[dt]=on,on.push(xe)}de(le,function(Be){return Be.join(", ")})}e.Ba=function(){return this.m},e.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function mr(F,le,xe){return xe&&xe.internalChannelParams&&xe.internalChannelParams[F]||le}function Kr(F){this.Aa=0,this.i=[],this.j=new Ge,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=mr("failFast",!1,F),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=mr("baseRetryDelayMs",5e3,F),this.cb=mr("retryDelaySeedMs",1e4,F),this.Wa=mr("forwardChannelMaxRetries",2,F),this.wa=mr("forwardChannelRequestTimeoutMs",2e4,F),this.pa=F&&F.xmlHttpFactory||void 0,this.Xa=F&&F.Tb||void 0,this.Ca=F&&F.useFetchStreams||!1,this.L=void 0,this.J=F&&F.supportsCrossDomainXhr||!1,this.K="",this.h=new Cs(F&&F.concurrentRequestLimit),this.Da=new rs,this.P=F&&F.fastHandshake||!1,this.O=F&&F.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=F&&F.Rb||!1,F&&F.xa&&this.j.xa(),F&&F.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&F&&F.detectBufferingProxy||!1,this.ja=void 0,F&&F.longPollingTimeout&&0<F.longPollingTimeout&&(this.ja=F.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}e=Kr.prototype,e.la=8,e.G=1,e.connect=function(F,le,xe,Be){Te(0),this.W=F,this.H=le||{},xe&&Be!==void 0&&(this.H.OSID=xe,this.H.OAID=Be),this.F=this.X,this.I=xl(this,null,this.W),Gi(this)};function Ni(F){if(jr(F),F.G==3){var le=F.U++,xe=ho(F.I);if(sr(xe,"SID",F.K),sr(xe,"RID",le),sr(xe,"TYPE","terminate"),Vo(F,xe),le=new $n(F,F.j,le),le.L=2,le.v=$a(ho(xe)),xe=!1,T.navigator&&T.navigator.sendBeacon)try{xe=T.navigator.sendBeacon(le.v.toString(),"")}catch{}!xe&&T.Image&&(new Image().src=le.v,xe=!0),xe||(le.g=wl(le.j,null),le.g.ea(le.v)),le.F=Date.now(),qi(le)}_h(F)}function Wi(F){F.g&&(la(F),F.g.cancel(),F.g=null)}function jr(F){Wi(F),F.u&&(T.clearTimeout(F.u),F.u=null),Ic(F),F.h.cancel(),F.s&&(typeof F.s=="number"&&T.clearTimeout(F.s),F.s=null)}function Gi(F){if(!ea(F.h)&&!F.s){F.s=!0;var le=F.Ga;Mt||rt(),Lt||(Mt(),Lt=!0),yt.add(le,F),F.B=0}}function js(F,le){return Ua(F.h)>=F.h.j-(F.s?1:0)?!1:F.s?(F.i=le.D.concat(F.i),!0):F.G==1||F.G==2||F.B>=(F.Va?0:F.Wa)?!1:(F.s=Ze(U(F.Ga,F,le),$d(F,F.B)),F.B++,!0)}e.Ga=function(F){if(this.s)if(this.s=null,this.G==1){if(!F){this.U=Math.floor(1e5*Math.random()),F=this.U++;const dt=new $n(this,this.j,F);let on=this.o;if(this.S&&(on?(on=re(on),ie(on,this.S)):on=this.S),this.m!==null||this.O||(dt.H=on,on=null),this.P)e:{for(var le=0,xe=0;xe<this.i.length;xe++){t:{var Be=this.i[xe];if("__data__"in Be.map&&(Be=Be.map.__data__,typeof Be=="string")){Be=Be.length;break t}Be=void 0}if(Be===void 0)break;if(le+=Be,4096<le){le=xe;break e}if(le===4096||xe===this.i.length-1){le=xe+1;break e}}le=1e3}else le=1e3;le=sa(this,dt,le),xe=ho(this.I),sr(xe,"RID",F),sr(xe,"CVER",22),this.D&&sr(xe,"X-HTTP-Session-Id",this.D),Vo(this,xe),on&&(this.O?le="headers="+encodeURIComponent(String(oa(on)))+"&"+le:this.m&&us(xe,this.m,on)),ja(this.h,dt),this.Ua&&sr(xe,"TYPE","init"),this.P?(sr(xe,"$req",le),sr(xe,"SID","null"),dt.T=!0,bi(dt,xe,null)):bi(dt,xe,le),this.G=2}}else this.G==3&&(F?io(this,F):this.i.length==0||ea(this.h)||io(this))};function io(F,le){var xe;le?xe=le.l:xe=F.U++;const Be=ho(F.I);sr(Be,"SID",F.K),sr(Be,"RID",xe),sr(Be,"AID",F.T),Vo(F,Be),F.m&&F.o&&us(Be,F.m,F.o),xe=new $n(F,F.j,xe,F.B+1),F.m===null&&(xe.H=F.o),le&&(F.i=le.D.concat(F.i)),le=sa(F,xe,1e3),xe.I=Math.round(.5*F.wa)+Math.round(.5*F.wa*Math.random()),ja(F.h,xe),bi(xe,Be,le)}function Vo(F,le){F.H&&Ee(F.H,function(xe,Be){sr(le,Be,xe)}),F.l&&ns({},function(xe,Be){sr(le,Be,xe)})}function sa(F,le,xe){xe=Math.min(F.i.length,xe);var Be=F.l?U(F.l.Na,F.l,F):null;e:{var dt=F.i;let on=-1;for(;;){const Kt=["count="+xe];on==-1?0<xe?(on=dt[0].g,Kt.push("ofs="+on)):on=0:Kt.push("ofs="+on);let Ir=!0;for(let fo=0;fo<xe;fo++){let Mn=dt[fo].g;const No=dt[fo].map;if(Mn-=on,0>Mn)on=Math.max(0,dt[fo].g-100),Ir=!1;else try{yn(No,Kt,"req"+Mn+"_")}catch{Be&&Be(No)}}if(Ir){Be=Kt.join("&");break e}}}return F=F.i.splice(0,xe),le.D=F,Be}function Ps(F){if(!F.g&&!F.u){F.Y=1;var le=F.Fa;Mt||rt(),Lt||(Mt(),Lt=!0),yt.add(le,F),F.v=0}}function aa(F){return F.g||F.u||3<=F.v?!1:(F.Y++,F.u=Ze(U(F.Fa,F),$d(F,F.v)),F.v++,!0)}e.Fa=function(){if(this.u=null,jd(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var F=2*this.R;this.j.info("BP detection timer enabled: "+F),this.A=Ze(U(this.ab,this),F)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Te(10),Wi(this),jd(this))};function la(F){F.A!=null&&(T.clearTimeout(F.A),F.A=null)}function jd(F){F.g=new $n(F,F.j,"rpc",F.Y),F.m===null&&(F.g.H=F.o),F.g.O=0;var le=ho(F.qa);sr(le,"RID","rpc"),sr(le,"SID",F.K),sr(le,"AID",F.T),sr(le,"CI",F.F?"0":"1"),!F.F&&F.ja&&sr(le,"TO",F.ja),sr(le,"TYPE","xmlhttp"),Vo(F,le),F.m&&F.o&&us(le,F.m,F.o),F.L&&(F.g.I=F.L);var xe=F.g;F=F.ia,xe.L=1,xe.v=$a(ho(le)),xe.m=null,xe.P=!0,Ri(xe,F)}e.Za=function(){this.C!=null&&(this.C=null,Wi(this),aa(this),Te(19))};function Ic(F){F.C!=null&&(T.clearTimeout(F.C),F.C=null)}function hs(F,le){var xe=null;if(F.g==le){Ic(F),la(F),F.g=null;var Be=2}else if(Io(F.h,le))xe=le.D,xa(F.h,le),Be=1;else return;if(F.G!=0){if(le.o)if(Be==1){xe=le.m?le.m.length:0,le=Date.now()-le.F;var dt=F.B;Be=Qs(),ti(Be,new Ve(Be,xe)),Gi(F)}else Ps(F);else if(dt=le.s,dt==3||dt==0&&0<le.X||!(Be==1&&js(F,le)||Be==2&&aa(F)))switch(xe&&0<xe.length&&(le=F.h,le.i=le.i.concat(xe)),dt){case 1:Ta(F,5);break;case 4:Ta(F,10);break;case 3:Ta(F,6);break;default:Ta(F,2)}}}function $d(F,le){let xe=F.Ta+Math.floor(Math.random()*F.cb);return F.isActive()||(xe*=2),xe*le}function Ta(F,le){if(F.j.info("Error code "+le),le==2){var xe=U(F.fb,F),Be=F.Xa;const dt=!Be;Be=new Ur(Be||"//www.google.com/images/cleardot.gif"),T.location&&T.location.protocol=="http"||is(Be,"https"),$a(Be),dt?fr(Be.toString(),xe):Yr(Be.toString(),xe)}else Te(2);F.G=0,F.l&&F.l.sa(le),_h(F),jr(F)}e.fb=function(F){F?(this.j.info("Successfully pinged google.com"),Te(2)):(this.j.info("Failed to ping google.com"),Te(1))};function _h(F){if(F.G=0,F.ka=[],F.l){const le=wa(F.h);(le.length!=0||F.i.length!=0)&&(ne(F.ka,le),ne(F.ka,F.i),F.h.i.length=0,q(F.i),F.i.length=0),F.l.ra()}}function xl(F,le,xe){var Be=xe instanceof Ur?ho(xe):new Ur(xe);if(Be.g!="")le&&(Be.g=le+"."+Be.g),Sa(Be,Be.s);else{var dt=T.location;Be=dt.protocol,le=le?le+"."+dt.hostname:dt.hostname,dt=+dt.port;var on=new Ur(null);Be&&is(on,Be),le&&(on.g=le),dt&&Sa(on,dt),xe&&(on.l=xe),Be=on}return xe=F.D,le=F.ya,xe&&le&&sr(Be,xe,le),sr(Be,"VER",F.la),Vo(F,Be),Be}function wl(F,le,xe){if(le&&!F.J)throw Error("Can't create secondary domain capable XhrIo object.");return le=F.Ca&&!F.pa?new pr(new fi({eb:xe})):new pr(F.pa),le.Ha(F.J),le}e.isActive=function(){return!!this.l&&this.l.isActive(this)};function Gd(){}e=Gd.prototype,e.ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){};function os(F,le){jn.call(this),this.g=new Kr(le),this.l=F,this.h=le&&le.messageUrlParams||null,F=le&&le.messageHeaders||null,le&&le.clientProtocolHeaderRequired&&(F?F["X-Client-Protocol"]="webchannel":F={"X-Client-Protocol":"webchannel"}),this.g.o=F,F=le&&le.initMessageHeaders||null,le&&le.messageContentType&&(F?F["X-WebChannel-Content-Type"]=le.messageContentType:F={"X-WebChannel-Content-Type":le.messageContentType}),le&&le.va&&(F?F["X-WebChannel-Client-Profile"]=le.va:F={"X-WebChannel-Client-Profile":le.va}),this.g.S=F,(F=le&&le.Sb)&&!oe(F)&&(this.g.m=F),this.v=le&&le.supportsCrossDomainXhr||!1,this.u=le&&le.sendRawJson||!1,(le=le&&le.httpSessionIdParam)&&!oe(le)&&(this.g.D=le,F=this.h,F!==null&&le in F&&(F=this.h,le in F&&delete F[le])),this.j=new ca(this)}W(os,jn),os.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},os.prototype.close=function(){Ni(this.g)},os.prototype.o=function(F){var le=this.g;if(typeof F=="string"){var xe={};xe.__data__=F,F=xe}else this.u&&(xe={},xe.__data__=Ho(F),F=xe);le.i.push(new el(le.Ya++,F)),le.G==3&&Gi(le)},os.prototype.N=function(){this.g.l=null,delete this.j,Ni(this.g),delete this.g,os.aa.N.call(this)};function tl(F){To.call(this),F.__headers__&&(this.headers=F.__headers__,this.statusCode=F.__status__,delete F.__headers__,delete F.__status__);var le=F.__sm__;if(le){e:{for(const xe in le){F=xe;break e}F=void 0}(this.i=F)&&(F=this.i,le=le!==null&&F in le?le[F]:void 0),this.data=le}else this.data=F}W(tl,To);function Hd(){Eo.call(this),this.status=1}W(Hd,Eo);function ca(F){this.g=F}W(ca,Gd),ca.prototype.ua=function(){ti(this.g,"a")},ca.prototype.ta=function(F){ti(this.g,new tl(F))},ca.prototype.sa=function(F){ti(this.g,new Hd)},ca.prototype.ra=function(){ti(this.g,"b")},os.prototype.send=os.prototype.o,os.prototype.open=os.prototype.m,os.prototype.close=os.prototype.close,Tt.NO_ERROR=0,Tt.TIMEOUT=8,Tt.HTTP_ERROR=6,Zt.COMPLETE="complete",Qo.EventType=vs,vs.OPEN="a",vs.CLOSE="b",vs.ERROR="c",vs.MESSAGE="d",jn.prototype.listen=jn.prototype.K,pr.prototype.listenOnce=pr.prototype.L,pr.prototype.getLastError=pr.prototype.Ka,pr.prototype.getLastErrorCode=pr.prototype.Ba,pr.prototype.getStatus=pr.prototype.Z,pr.prototype.getResponseJson=pr.prototype.Oa,pr.prototype.getResponseText=pr.prototype.oa,pr.prototype.send=pr.prototype.ea,pr.prototype.setWithCredentials=pr.prototype.Ha}).apply(typeof Ey<"u"?Ey:typeof self<"u"?self:typeof window<"u"?window:{});const UP="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class va{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}va.UNAUTHENTICATED=new va(null),va.GOOGLE_CREDENTIALS=new va("google-credentials-uid"),va.FIRST_PARTY=new va("first-party-uid"),va.MOCK_USER=new va("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let S_="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ip=new FS("@firebase/firestore");function Bl(e,...t){if(Ip.logLevel<=Fr.DEBUG){const o=t.map(YS);Ip.debug(`Firestore (${S_}): ${e}`,...o)}}function tO(e,...t){if(Ip.logLevel<=Fr.ERROR){const o=t.map(YS);Ip.error(`Firestore (${S_}): ${e}`,...o)}}function y$(e,...t){if(Ip.logLevel<=Fr.WARN){const o=t.map(YS);Ip.warn(`Firestore (${S_}): ${e}`,...o)}}function YS(e){if(typeof e=="string")return e;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(o){return JSON.stringify(o)}(e)}catch{return e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KS(e="Unexpected state"){const t=`FIRESTORE (${S_}) INTERNAL ASSERTION FAILED: `+e;throw tO(t),new Error(t)}function Fg(e,t){e||KS()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ra={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Da extends bc{constructor(t,o){super(t,o),this.code=t,this.message=o,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vg{constructor(){this.promise=new Promise((t,o)=>{this.resolve=t,this.reject=o})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nO{constructor(t,o){this.user=o,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class b${getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,o){t.enqueueRetryable(()=>o(va.UNAUTHENTICATED))}shutdown(){}}class x${constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,o){this.changeListener=o,t.enqueueRetryable(()=>o(this.token.user))}shutdown(){this.changeListener=null}}class w${constructor(t){this.t=t,this.currentUser=va.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,o){Fg(this.o===void 0);let c=this.i;const d=r=>this.i!==c?(c=this.i,o(r)):Promise.resolve();let v=new Vg;this.o=()=>{this.i++,this.currentUser=this.u(),v.resolve(),v=new Vg,t.enqueueRetryable(()=>d(this.currentUser))};const y=()=>{const r=v;t.enqueueRetryable(async()=>{await r.promise,await d(this.currentUser)})},T=r=>{Bl("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=r,this.o&&(this.auth.addAuthTokenListener(this.o),y())};this.t.onInit(r=>T(r)),setTimeout(()=>{if(!this.auth){const r=this.t.getImmediate({optional:!0});r?T(r):(Bl("FirebaseAuthCredentialsProvider","Auth not yet detected"),v.resolve(),v=new Vg)}},0),y()}getToken(){const t=this.i,o=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(o).then(c=>this.i!==t?(Bl("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):c?(Fg(typeof c.accessToken=="string"),new nO(c.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return Fg(t===null||typeof t=="string"),new va(t)}}class S${constructor(t,o,c){this.l=t,this.h=o,this.P=c,this.type="FirstParty",this.user=va.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class T${constructor(t,o,c){this.l=t,this.h=o,this.P=c}getToken(){return Promise.resolve(new S$(this.l,this.h,this.P))}start(t,o){t.enqueueRetryable(()=>o(va.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class E${constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class I${constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,o){Fg(this.o===void 0);const c=v=>{v.error!=null&&Bl("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${v.error.message}`);const y=v.token!==this.R;return this.R=v.token,Bl("FirebaseAppCheckTokenProvider",`Received ${y?"new":"existing"} token.`),y?o(v.token):Promise.resolve()};this.o=v=>{t.enqueueRetryable(()=>c(v))};const d=v=>{Bl("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=v,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(v=>d(v)),setTimeout(()=>{if(!this.appCheck){const v=this.A.getImmediate({optional:!0});v?d(v):Bl("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(o=>o?(Fg(typeof o.token=="string"),this.R=o.token,new E$(o.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function C$(e){return e.name==="IndexedDbTransactionError"}class l0{constructor(t,o){this.projectId=t,this.database=o||"(default)"}static empty(){return new l0("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(t){return t instanceof l0&&t.projectId===this.projectId&&t.database===this.database}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var jP,vr;(vr=jP||(jP={}))[vr.OK=0]="OK",vr[vr.CANCELLED=1]="CANCELLED",vr[vr.UNKNOWN=2]="UNKNOWN",vr[vr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",vr[vr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",vr[vr.NOT_FOUND=5]="NOT_FOUND",vr[vr.ALREADY_EXISTS=6]="ALREADY_EXISTS",vr[vr.PERMISSION_DENIED=7]="PERMISSION_DENIED",vr[vr.UNAUTHENTICATED=16]="UNAUTHENTICATED",vr[vr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",vr[vr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",vr[vr.ABORTED=10]="ABORTED",vr[vr.OUT_OF_RANGE=11]="OUT_OF_RANGE",vr[vr.UNIMPLEMENTED=12]="UNIMPLEMENTED",vr[vr.INTERNAL=13]="INTERNAL",vr[vr.UNAVAILABLE=14]="UNAVAILABLE",vr[vr.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */new eO([4294967295,4294967295],0);function C1(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A${constructor(t,o,c=1e3,d=1.5,v=6e4){this.ui=t,this.timerId=o,this.ko=c,this.qo=d,this.Qo=v,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(t){this.cancel();const o=Math.floor(this.Ko+this.zo()),c=Math.max(0,Date.now()-this.Uo),d=Math.max(0,o-c);d>0&&Bl("ExponentialBackoff",`Backing off for ${d} ms (base delay: ${this.Ko} ms, delay with jitter: ${o} ms, last attempt: ${c} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,d,()=>(this.Uo=Date.now(),t())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JS{constructor(t,o,c,d,v){this.asyncQueue=t,this.timerId=o,this.targetTimeMs=c,this.op=d,this.removalCallback=v,this.deferred=new Vg,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(y=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,o,c,d,v){const y=Date.now()+c,T=new JS(t,o,y,d,v);return T.start(c),T}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Da(Ra.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}var $P,GP;(GP=$P||($P={})).ea="default",GP.Cache="cache";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P$(e){const t={};return e.timeoutSeconds!==void 0&&(t.timeoutSeconds=e.timeoutSeconds),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HP=new Map;function M$(e,t,o,c){if(t===!0&&c===!0)throw new Da(Ra.INVALID_ARGUMENT,`${e} and ${o} cannot be used together.`)}function k$(e){if(e===void 0)return"undefined";if(e===null)return"null";if(typeof e=="string")return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if(typeof e=="number"||typeof e=="boolean")return""+e;if(typeof e=="object"){if(e instanceof Array)return"an array";{const t=function(c){return c.constructor?c.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return typeof e=="function"?"a function":KS()}function R$(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Da(Ra.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const o=k$(e);throw new Da(Ra.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${o}`)}}return e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qP{constructor(t){var o,c;if(t.host===void 0){if(t.ssl!==void 0)throw new Da(Ra.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(o=t.ssl)===null||o===void 0||o;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new Da(Ra.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}M$("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=P$((c=t.experimentalLongPollingOptions)!==null&&c!==void 0?c:{}),function(v){if(v.timeoutSeconds!==void 0){if(isNaN(v.timeoutSeconds))throw new Da(Ra.INVALID_ARGUMENT,`invalid long polling timeout: ${v.timeoutSeconds} (must not be NaN)`);if(v.timeoutSeconds<5)throw new Da(Ra.INVALID_ARGUMENT,`invalid long polling timeout: ${v.timeoutSeconds} (minimum allowed value is 5)`);if(v.timeoutSeconds>30)throw new Da(Ra.INVALID_ARGUMENT,`invalid long polling timeout: ${v.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(c,d){return c.timeoutSeconds===d.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class iO{constructor(t,o,c,d){this._authCredentials=t,this._appCheckCredentials=o,this._databaseId=c,this._app=d,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new qP({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Da(Ra.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new Da(Ra.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new qP(t),t.credentials!==void 0&&(this._authCredentials=function(c){if(!c)return new b$;switch(c.type){case"firstParty":return new T$(c.sessionIndex||"0",c.iamToken||null,c.authTokenFactory||null);case"provider":return c.client;default:throw new Da(Ra.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(o){const c=HP.get(o);c&&(Bl("ComponentProvider","Removing Datastore"),HP.delete(o),c.terminate())}(this),Promise.resolve()}}function D$(e,t,o,c={}){var d;const v=(e=R$(e,iO))._getSettings(),y=`${t}:${o}`;if(v.host!=="firestore.googleapis.com"&&v.host!==y&&y$("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},v),{host:y,ssl:!1})),c.mockUserToken){let T,r;if(typeof c.mockUserToken=="string")T=c.mockUserToken,r=va.MOCK_USER;else{T=F2(c.mockUserToken,(d=e._app)===null||d===void 0?void 0:d.options.projectId);const D=c.mockUserToken.sub||c.mockUserToken.user_id;if(!D)throw new Da(Ra.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");r=new va(D)}e._authCredentials=new x$(new nO(T,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WP{constructor(t=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new A$(this,"async_queue_retry"),this.Vu=()=>{const c=C1();c&&Bl("AsyncQueue","Visibility state changed to "+c.visibilityState),this.t_.jo()},this.mu=t;const o=C1();o&&typeof o.addEventListener=="function"&&o.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.fu(),this.gu(t)}enterRestrictedMode(t){if(!this.Iu){this.Iu=!0,this.Au=t||!1;const o=C1();o&&typeof o.removeEventListener=="function"&&o.removeEventListener("visibilitychange",this.Vu)}}enqueue(t){if(this.fu(),this.Iu)return new Promise(()=>{});const o=new Vg;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(t().then(o.resolve,o.reject),o.promise)).then(()=>o.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Pu.push(t),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(t){if(!C$(t))throw t;Bl("AsyncQueue","Operation failed with retryable error: "+t)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(t){const o=this.mu.then(()=>(this.du=!0,t().catch(c=>{this.Eu=c,this.du=!1;const d=function(y){let T=y.message||"";return y.stack&&(T=y.stack.includes(y.message)?y.stack:y.message+`
`+y.stack),T}(c);throw tO("INTERNAL UNHANDLED ERROR: ",d),c}).then(c=>(this.du=!1,c))));return this.mu=o,o}enqueueAfterDelay(t,o,c){this.fu(),this.Ru.indexOf(t)>-1&&(o=0);const d=JS.createAndSchedule(this,t,o,c,v=>this.yu(v));return this.Tu.push(d),d}fu(){this.Eu&&KS()}verifyOperationInProgress(){}async wu(){let t;do t=this.mu,await t;while(t!==this.mu)}Su(t){for(const o of this.Tu)if(o.timerId===t)return!0;return!1}bu(t){return this.wu().then(()=>{this.Tu.sort((o,c)=>o.targetTimeMs-c.targetTimeMs);for(const o of this.Tu)if(o.skipDelay(),t!=="all"&&o.timerId===t)break;return this.wu()})}Du(t){this.Ru.push(t)}yu(t){const o=this.Tu.indexOf(t);this.Tu.splice(o,1)}}class O$ extends iO{constructor(t,o,c,d){super(t,o,c,d),this.type="firestore",this._queue=new WP,this._persistenceKey=(d==null?void 0:d.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new WP(t),this._firestoreClient=void 0,await t}}}function L$(e,t){const o=typeof e=="object"?e:NS(),c=typeof e=="string"?e:"(default)",d=O0(o,"firestore").getImmediate({identifier:c});if(!d._initialized){const v=uD("firestore");v&&D$(d,...v)}return d}(function(t,o=!0){(function(d){S_=d})(Bp),_d(new oh("firestore",(c,{instanceIdentifier:d,options:v})=>{const y=c.getProvider("app").getImmediate(),T=new O$(new w$(c.getProvider("auth-internal")),new I$(c.getProvider("app-check-internal")),function(D,L){if(!Object.prototype.hasOwnProperty.apply(D.options,["projectId"]))throw new Da(Ra.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new l0(D.options.projectId,L)}(y,d),y);return v=Object.assign({useFetchStreams:o},v),T._setSettings(v),T},"PUBLIC").setMultipleInstances(!0)),pc(UP,"4.7.3",t),pc(UP,"4.7.3","esm2017")})();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z$="type.googleapis.com/google.protobuf.Int64Value",B$="type.googleapis.com/google.protobuf.UInt64Value";function rO(e,t){const o={};for(const c in e)e.hasOwnProperty(c)&&(o[c]=t(e[c]));return o}function yw(e){if(e==null)return null;if(e instanceof Number&&(e=e.valueOf()),typeof e=="number"&&isFinite(e)||e===!0||e===!1||Object.prototype.toString.call(e)==="[object String]")return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(t=>yw(t));if(typeof e=="function"||typeof e=="object")return rO(e,t=>yw(t));throw new Error("Data cannot be encoded in JSON: "+e)}function c0(e){if(e==null)return e;if(e["@type"])switch(e["@type"]){case z$:case B$:{const t=Number(e.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+e);return t}default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(t=>c0(t)):typeof e=="function"||typeof e=="object"?rO(e,t=>c0(t)):e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QS="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZP={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class bp extends bc{constructor(t,o,c){super(`${QS}/${t}`,o||""),this.details=c}}function F$(e){if(e>=200&&e<300)return"ok";switch(e){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function V$(e,t){let o=F$(e),c=o,d;try{const v=t&&t.error;if(v){const y=v.status;if(typeof y=="string"){if(!ZP[y])return new bp("internal","internal");o=ZP[y],c=y}const T=v.message;typeof T=="string"&&(c=T),d=v.details,d!==void 0&&(d=c0(d))}}catch{}return o==="ok"?null:new bp(o,c,d)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N${constructor(t,o,c){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=t.getImmediate({optional:!0}),this.messaging=o.getImmediate({optional:!0}),this.auth||t.get().then(d=>this.auth=d,()=>{}),this.messaging||o.get().then(d=>this.messaging=d,()=>{}),this.appCheck||c.get().then(d=>this.appCheck=d,()=>{})}async getAuthToken(){if(this.auth)try{const t=await this.auth.getToken();return t==null?void 0:t.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(t){if(this.appCheck){const o=t?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return o.error?null:o.token}return null}async getContext(t){const o=await this.getAuthToken(),c=await this.getMessagingToken(),d=await this.getAppCheckToken(t);return{authToken:o,messagingToken:c,appCheckToken:d}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bw="us-central1";function U$(e){let t=null;return{promise:new Promise((o,c)=>{t=setTimeout(()=>{c(new bp("deadline-exceeded","deadline-exceeded"))},e)}),cancel:()=>{t&&clearTimeout(t)}}}class j${constructor(t,o,c,d,v=bw,y){this.app=t,this.fetchImpl=y,this.emulatorOrigin=null,this.contextProvider=new N$(o,c,d),this.cancelAllRequests=new Promise(T=>{this.deleteService=()=>Promise.resolve(T())});try{const T=new URL(v);this.customDomain=T.origin+(T.pathname==="/"?"":T.pathname),this.region=bw}catch{this.customDomain=null,this.region=v}}_delete(){return this.deleteService()}_url(t){const o=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${o}/${this.region}/${t}`:this.customDomain!==null?`${this.customDomain}/${t}`:`https://${this.region}-${o}.cloudfunctions.net/${t}`}}function $$(e,t,o){e.emulatorOrigin=`http://${t}:${o}`}function G$(e,t,o){return c=>q$(e,t,c,{})}async function H$(e,t,o,c){o["Content-Type"]="application/json";let d;try{d=await c(e,{method:"POST",body:JSON.stringify(t),headers:o})}catch{return{status:0,json:null}}let v=null;try{v=await d.json()}catch{}return{status:d.status,json:v}}function q$(e,t,o,c){const d=e._url(t);return W$(e,d,o,c)}async function W$(e,t,o,c){o=yw(o);const d={data:o},v={},y=await e.contextProvider.getContext(c.limitedUseAppCheckTokens);y.authToken&&(v.Authorization="Bearer "+y.authToken),y.messagingToken&&(v["Firebase-Instance-ID-Token"]=y.messagingToken),y.appCheckToken!==null&&(v["X-Firebase-AppCheck"]=y.appCheckToken);const T=c.timeout||7e4,r=U$(T),D=await Promise.race([H$(t,d,v,e.fetchImpl),r.promise,e.cancelAllRequests]);if(r.cancel(),!D)throw new bp("cancelled","Firebase Functions instance was deleted.");const L=V$(D.status,D.json);if(L)throw L;if(!D.json)throw new bp("internal","Response is not valid JSON object.");let B=D.json.data;if(typeof B>"u"&&(B=D.json.result),typeof B>"u")throw new bp("internal","Response is missing data field.");return{data:c0(B)}}const XP="@firebase/functions",YP="0.11.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Z$="auth-internal",X$="app-check-internal",Y$="messaging-internal";function K$(e,t){const o=(c,{instanceIdentifier:d})=>{const v=c.getProvider("app").getImmediate(),y=c.getProvider(Z$),T=c.getProvider(Y$),r=c.getProvider(X$);return new j$(v,y,T,r,d,e)};_d(new oh(QS,o,"PUBLIC").setMultipleInstances(!0)),pc(XP,YP,t),pc(XP,YP,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F0(e=NS(),t=bw){const c=O0(gl(e),QS).getImmediate({identifier:t}),d=uD("functions");return d&&oO(c,...d),c}function oO(e,t,o){$$(gl(e),t,o)}function u0(e,t,o){return G$(gl(e),t)}K$(fetch.bind(self));const J$={apiKey:"AIzaSyAjCdr63ChlPY4_Fwj9zMPo67KSqoZh_JY",authDomain:"week7-xiao.firebaseapp.com",projectId:"week7-xiao",storageBucket:"week7-xiao.appspot.com",messagingSenderId:"1016133987190",appId:"1:1016133987190:web:7bad046f1aa27c9ea3e857"},eT=mD(J$),Zc=m$(eT);L$(eT);const Q$=F0(eT);oO(Q$,"127.0.0.1",5001);const xc=(e,t)=>{const o=e.__vccOpts||e;for(const[c,d]of t)o[c]=d;return o},e3={data(){return{isLoggedIn:!1,isAdmin:!1,userEmail:null}},created(){$D(Zc,e=>{e?(this.isLoggedIn=!0,this.isAdmin=e.email==="admin@123.com",this.userEmail=e.email):(this.isLoggedIn=!1,this.isAdmin=!1,this.userEmail=null)})},methods:{logout(){window.confirm("Are you sure you want to log out?")&&rj(Zc).then(()=>{this.isLoggedIn=!1,this.isAdmin=!1,this.userEmail=null,this.$router.push("/")}).catch(t=>{console.error("Error during sign out:",t)})}}},t3={class:"container"},n3={class:"d-flex justify-content-between py-3"},i3={key:0,class:"user-email"},r3={class:"nav nav-pills"},o3={key:0,class:"nav-item"},s3={key:1,class:"nav-item"},a3={key:2,class:"nav-item"},l3={key:3,class:"nav-item"},c3={key:4,class:"nav-item"},u3={key:5,class:"nav-item"},h3={key:6,class:"nav-item"},d3={key:7,class:"nav-item"},f3={key:8,class:"nav-item"};function p3(e,t,o,c,d,v){const y=cc("router-link");return Vi(),Xi("div",t3,[Qn("header",n3,[d.userEmail?(Vi(),Xi("div",i3,_c(d.userEmail),1)):Os("",!0),Qn("ul",r3,[!d.isAdmin||!d.isLoggedIn?(Vi(),Xi("li",o3,[Z(y,{to:"/",class:"nav-link","active-class":"active","aria-current":"page"},{default:bo(()=>t[1]||(t[1]=[$o("Home")])),_:1})])):Os("",!0),d.isLoggedIn?Os("",!0):(Vi(),Xi("li",s3,[Z(y,{to:"/FireLogin",class:"nav-link","active-class":"active"},{default:bo(()=>t[2]||(t[2]=[$o("Firebase Login")])),_:1})])),d.isLoggedIn?Os("",!0):(Vi(),Xi("li",a3,[Z(y,{to:"/FireRegister",class:"nav-link","active-class":"active"},{default:bo(()=>t[3]||(t[3]=[$o("Firebase Register")])),_:1})])),d.isLoggedIn?(Vi(),Xi("li",l3,[Z(y,{to:"/email",class:"nav-link","active-class":"active"},{default:bo(()=>t[4]||(t[4]=[$o("Email Us")])),_:1})])):Os("",!0),d.isLoggedIn?(Vi(),Xi("li",c3,[Z(y,{to:"/table",class:"nav-link","active-class":"active"},{default:bo(()=>t[5]||(t[5]=[$o("Table")])),_:1})])):Os("",!0),d.isLoggedIn?(Vi(),Xi("li",u3,[Z(y,{to:"/map",class:"nav-link","active-class":"active"},{default:bo(()=>t[6]||(t[6]=[$o("Map")])),_:1})])):Os("",!0),d.isLoggedIn?(Vi(),Xi("li",h3,[Z(y,{to:"/csv",class:"nav-link","active-class":"active"},{default:bo(()=>t[7]||(t[7]=[$o("CSV Exporter")])),_:1})])):Os("",!0),d.isLoggedIn?(Vi(),Xi("li",d3,[Z(y,{to:"/chat",class:"nav-link","active-class":"active"},{default:bo(()=>t[8]||(t[8]=[$o("Chat Bot")])),_:1})])):Os("",!0),d.isLoggedIn?(Vi(),Xi("li",f3,[Qn("a",{href:"#",class:"nav-link",onClick:t[0]||(t[0]=nh((...T)=>v.logout&&v.logout(...T),["prevent"]))},"Logout")])):Os("",!0)])])])}const m3=xc(e3,[["render",p3],["__scopeId","data-v-25a9b2ca"]]),g3={__name:"App",setup(e){return(t,o)=>{const c=cc("router-view");return Vi(),Xi(Gn,null,[Qn("header",null,[Z(m3)]),Qn("main",null,[Z(c)])],64)}}},_3=xc(g3,[["__scopeId","data-v-a12f962e"]]);function v3(){return sO().__VUE_DEVTOOLS_GLOBAL_HOOK__}function sO(){return typeof navigator<"u"&&typeof window<"u"?window:typeof globalThis<"u"?globalThis:{}}const y3=typeof Proxy=="function",b3="devtools-plugin:setup",x3="plugin:settings:set";let Jf,xw;function w3(){var e;return Jf!==void 0||(typeof window<"u"&&window.performance?(Jf=!0,xw=window.performance):typeof globalThis<"u"&&(!((e=globalThis.perf_hooks)===null||e===void 0)&&e.performance)?(Jf=!0,xw=globalThis.perf_hooks.performance):Jf=!1),Jf}function S3(){return w3()?xw.now():Date.now()}class T3{constructor(t,o){this.target=null,this.targetQueue=[],this.onQueue=[],this.plugin=t,this.hook=o;const c={};if(t.settings)for(const y in t.settings){const T=t.settings[y];c[y]=T.defaultValue}const d=`__vue-devtools-plugin-settings__${t.id}`;let v=Object.assign({},c);try{const y=localStorage.getItem(d),T=JSON.parse(y);Object.assign(v,T)}catch{}this.fallbacks={getSettings(){return v},setSettings(y){try{localStorage.setItem(d,JSON.stringify(y))}catch{}v=y},now(){return S3()}},o&&o.on(x3,(y,T)=>{y===this.plugin.id&&this.fallbacks.setSettings(T)}),this.proxiedOn=new Proxy({},{get:(y,T)=>this.target?this.target.on[T]:(...r)=>{this.onQueue.push({method:T,args:r})}}),this.proxiedTarget=new Proxy({},{get:(y,T)=>this.target?this.target[T]:T==="on"?this.proxiedOn:Object.keys(this.fallbacks).includes(T)?(...r)=>(this.targetQueue.push({method:T,args:r,resolve:()=>{}}),this.fallbacks[T](...r)):(...r)=>new Promise(D=>{this.targetQueue.push({method:T,args:r,resolve:D})})})}async setRealTarget(t){this.target=t;for(const o of this.onQueue)this.target.on[o.method](...o.args);for(const o of this.targetQueue)o.resolve(await this.target[o.method](...o.args))}}function E3(e,t){const o=e,c=sO(),d=v3(),v=y3&&o.enableEarlyProxy;if(d&&(c.__VUE_DEVTOOLS_PLUGIN_API_AVAILABLE__||!v))d.emit(b3,e,t);else{const y=v?new T3(o,d):null;(c.__VUE_DEVTOOLS_PLUGINS__=c.__VUE_DEVTOOLS_PLUGINS__||[]).push({pluginDescriptor:o,setupFn:t,proxy:y}),y&&t(y.proxiedTarget)}}/*!
  * vue-router v4.4.5
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const ap=typeof document<"u";function aO(e){return typeof e=="object"||"displayName"in e||"props"in e||"__vccOpts"in e}function I3(e){return e.__esModule||e[Symbol.toStringTag]==="Module"||e.default&&aO(e.default)}const Hr=Object.assign;function A1(e,t){const o={};for(const c in t){const d=t[c];o[c]=jl(d)?d.map(e):e(d)}return o}const Ng=()=>{},jl=Array.isArray,lO=/#/g,C3=/&/g,A3=/\//g,P3=/=/g,M3=/\?/g,cO=/\+/g,k3=/%5B/g,R3=/%5D/g,uO=/%5E/g,D3=/%60/g,hO=/%7B/g,O3=/%7C/g,dO=/%7D/g,L3=/%20/g;function tT(e){return encodeURI(""+e).replace(O3,"|").replace(k3,"[").replace(R3,"]")}function z3(e){return tT(e).replace(hO,"{").replace(dO,"}").replace(uO,"^")}function ww(e){return tT(e).replace(cO,"%2B").replace(L3,"+").replace(lO,"%23").replace(C3,"%26").replace(D3,"`").replace(hO,"{").replace(dO,"}").replace(uO,"^")}function B3(e){return ww(e).replace(P3,"%3D")}function F3(e){return tT(e).replace(lO,"%23").replace(M3,"%3F")}function V3(e){return e==null?"":F3(e).replace(A3,"%2F")}function Kg(e){try{return decodeURIComponent(""+e)}catch{}return""+e}const N3=/\/$/,U3=e=>e.replace(N3,"");function P1(e,t,o="/"){let c,d={},v="",y="";const T=t.indexOf("#");let r=t.indexOf("?");return T<r&&T>=0&&(r=-1),r>-1&&(c=t.slice(0,r),v=t.slice(r+1,T>-1?T:t.length),d=e(v)),T>-1&&(c=c||t.slice(0,T),y=t.slice(T,t.length)),c=H3(c??t,o),{fullPath:c+(v&&"?")+v+y,path:c,query:d,hash:Kg(y)}}function j3(e,t){const o=t.query?e(t.query):"";return t.path+(o&&"?")+o+(t.hash||"")}function KP(e,t){return!t||!e.toLowerCase().startsWith(t.toLowerCase())?e:e.slice(t.length)||"/"}function $3(e,t,o){const c=t.matched.length-1,d=o.matched.length-1;return c>-1&&c===d&&Cp(t.matched[c],o.matched[d])&&fO(t.params,o.params)&&e(t.query)===e(o.query)&&t.hash===o.hash}function Cp(e,t){return(e.aliasOf||e)===(t.aliasOf||t)}function fO(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const o in e)if(!G3(e[o],t[o]))return!1;return!0}function G3(e,t){return jl(e)?JP(e,t):jl(t)?JP(t,e):e===t}function JP(e,t){return jl(t)?e.length===t.length&&e.every((o,c)=>o===t[c]):e.length===1&&e[0]===t}function H3(e,t){if(e.startsWith("/"))return e;if(!e)return t;const o=t.split("/"),c=e.split("/"),d=c[c.length-1];(d===".."||d===".")&&c.push("");let v=o.length-1,y,T;for(y=0;y<c.length;y++)if(T=c[y],T!==".")if(T==="..")v>1&&v--;else break;return o.slice(0,v).join("/")+"/"+c.slice(y).join("/")}const $u={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var Jg;(function(e){e.pop="pop",e.push="push"})(Jg||(Jg={}));var Ug;(function(e){e.back="back",e.forward="forward",e.unknown=""})(Ug||(Ug={}));function q3(e){if(!e)if(ap){const t=document.querySelector("base");e=t&&t.getAttribute("href")||"/",e=e.replace(/^\w+:\/\/[^\/]+/,"")}else e="/";return e[0]!=="/"&&e[0]!=="#"&&(e="/"+e),U3(e)}const W3=/^[^#]+#/;function Z3(e,t){return e.replace(W3,"#")+t}function X3(e,t){const o=document.documentElement.getBoundingClientRect(),c=e.getBoundingClientRect();return{behavior:t.behavior,left:c.left-o.left-(t.left||0),top:c.top-o.top-(t.top||0)}}const V0=()=>({left:window.scrollX,top:window.scrollY});function Y3(e){let t;if("el"in e){const o=e.el,c=typeof o=="string"&&o.startsWith("#"),d=typeof o=="string"?c?document.getElementById(o.slice(1)):document.querySelector(o):o;if(!d)return;t=X3(d,e)}else t=e;"scrollBehavior"in document.documentElement.style?window.scrollTo(t):window.scrollTo(t.left!=null?t.left:window.scrollX,t.top!=null?t.top:window.scrollY)}function QP(e,t){return(history.state?history.state.position-t:-1)+e}const Sw=new Map;function K3(e,t){Sw.set(e,t)}function J3(e){const t=Sw.get(e);return Sw.delete(e),t}let Q3=()=>location.protocol+"//"+location.host;function pO(e,t){const{pathname:o,search:c,hash:d}=t,v=e.indexOf("#");if(v>-1){let T=d.includes(e.slice(v))?e.slice(v).length:1,r=d.slice(T);return r[0]!=="/"&&(r="/"+r),KP(r,"")}return KP(o,e)+c+d}function eG(e,t,o,c){let d=[],v=[],y=null;const T=({state:U})=>{const $=pO(e,location),W=o.value,q=t.value;let ne=0;if(U){if(o.value=$,t.value=U,y&&y===W){y=null;return}ne=q?U.position-q.position:0}else c($);d.forEach(ce=>{ce(o.value,W,{delta:ne,type:Jg.pop,direction:ne?ne>0?Ug.forward:Ug.back:Ug.unknown})})};function r(){y=o.value}function D(U){d.push(U);const $=()=>{const W=d.indexOf(U);W>-1&&d.splice(W,1)};return v.push($),$}function L(){const{history:U}=window;U.state&&U.replaceState(Hr({},U.state,{scroll:V0()}),"")}function B(){for(const U of v)U();v=[],window.removeEventListener("popstate",T),window.removeEventListener("beforeunload",L)}return window.addEventListener("popstate",T),window.addEventListener("beforeunload",L,{passive:!0}),{pauseListeners:r,listen:D,destroy:B}}function eM(e,t,o,c=!1,d=!1){return{back:e,current:t,forward:o,replaced:c,position:window.history.length,scroll:d?V0():null}}function tG(e){const{history:t,location:o}=window,c={value:pO(e,o)},d={value:t.state};d.value||v(c.value,{back:null,current:c.value,forward:null,position:t.length-1,replaced:!0,scroll:null},!0);function v(r,D,L){const B=e.indexOf("#"),U=B>-1?(o.host&&document.querySelector("base")?e:e.slice(B))+r:Q3()+e+r;try{t[L?"replaceState":"pushState"](D,"",U),d.value=D}catch($){console.error($),o[L?"replace":"assign"](U)}}function y(r,D){const L=Hr({},t.state,eM(d.value.back,r,d.value.forward,!0),D,{position:d.value.position});v(r,L,!0),c.value=r}function T(r,D){const L=Hr({},d.value,t.state,{forward:r,scroll:V0()});v(L.current,L,!0);const B=Hr({},eM(c.value,r,null),{position:L.position+1},D);v(r,B,!1),c.value=r}return{location:c,state:d,push:T,replace:y}}function nG(e){e=q3(e);const t=tG(e),o=eG(e,t.state,t.location,t.replace);function c(v,y=!0){y||o.pauseListeners(),history.go(v)}const d=Hr({location:"",base:e,go:c,createHref:Z3.bind(null,e)},t,o);return Object.defineProperty(d,"location",{enumerable:!0,get:()=>t.location.value}),Object.defineProperty(d,"state",{enumerable:!0,get:()=>t.state.value}),d}function iG(e){return typeof e=="string"||e&&typeof e=="object"}function mO(e){return typeof e=="string"||typeof e=="symbol"}const gO=Symbol("");var tM;(function(e){e[e.aborted=4]="aborted",e[e.cancelled=8]="cancelled",e[e.duplicated=16]="duplicated"})(tM||(tM={}));function Ap(e,t){return Hr(new Error,{type:e,[gO]:!0},t)}function Vc(e,t){return e instanceof Error&&gO in e&&(t==null||!!(e.type&t))}const nM="[^/]+?",rG={sensitive:!1,strict:!1,start:!0,end:!0},oG=/[.+*?^${}()[\]/\\]/g;function sG(e,t){const o=Hr({},rG,t),c=[];let d=o.start?"^":"";const v=[];for(const D of e){const L=D.length?[]:[90];o.strict&&!D.length&&(d+="/");for(let B=0;B<D.length;B++){const U=D[B];let $=40+(o.sensitive?.25:0);if(U.type===0)B||(d+="/"),d+=U.value.replace(oG,"\\$&"),$+=40;else if(U.type===1){const{value:W,repeatable:q,optional:ne,regexp:ce}=U;v.push({name:W,repeatable:q,optional:ne});const oe=ce||nM;if(oe!==nM){$+=10;try{new RegExp(`(${oe})`)}catch(be){throw new Error(`Invalid custom RegExp for param "${W}" (${oe}): `+be.message)}}let fe=q?`((?:${oe})(?:/(?:${oe}))*)`:`(${oe})`;B||(fe=ne&&D.length<2?`(?:/${fe})`:"/"+fe),ne&&(fe+="?"),d+=fe,$+=20,ne&&($+=-8),q&&($+=-20),oe===".*"&&($+=-50)}L.push($)}c.push(L)}if(o.strict&&o.end){const D=c.length-1;c[D][c[D].length-1]+=.7000000000000001}o.strict||(d+="/?"),o.end?d+="$":o.strict&&(d+="(?:/|$)");const y=new RegExp(d,o.sensitive?"":"i");function T(D){const L=D.match(y),B={};if(!L)return null;for(let U=1;U<L.length;U++){const $=L[U]||"",W=v[U-1];B[W.name]=$&&W.repeatable?$.split("/"):$}return B}function r(D){let L="",B=!1;for(const U of e){(!B||!L.endsWith("/"))&&(L+="/"),B=!1;for(const $ of U)if($.type===0)L+=$.value;else if($.type===1){const{value:W,repeatable:q,optional:ne}=$,ce=W in D?D[W]:"";if(jl(ce)&&!q)throw new Error(`Provided param "${W}" is an array but it is not repeatable (* or + modifiers)`);const oe=jl(ce)?ce.join("/"):ce;if(!oe)if(ne)U.length<2&&(L.endsWith("/")?L=L.slice(0,-1):B=!0);else throw new Error(`Missing required param "${W}"`);L+=oe}}return L||"/"}return{re:y,score:c,keys:v,parse:T,stringify:r}}function aG(e,t){let o=0;for(;o<e.length&&o<t.length;){const c=t[o]-e[o];if(c)return c;o++}return e.length<t.length?e.length===1&&e[0]===80?-1:1:e.length>t.length?t.length===1&&t[0]===80?1:-1:0}function _O(e,t){let o=0;const c=e.score,d=t.score;for(;o<c.length&&o<d.length;){const v=aG(c[o],d[o]);if(v)return v;o++}if(Math.abs(d.length-c.length)===1){if(iM(c))return 1;if(iM(d))return-1}return d.length-c.length}function iM(e){const t=e[e.length-1];return e.length>0&&t[t.length-1]<0}const lG={type:0,value:""},cG=/[a-zA-Z0-9_]/;function uG(e){if(!e)return[[]];if(e==="/")return[[lG]];if(!e.startsWith("/"))throw new Error(`Invalid path "${e}"`);function t($){throw new Error(`ERR (${o})/"${D}": ${$}`)}let o=0,c=o;const d=[];let v;function y(){v&&d.push(v),v=[]}let T=0,r,D="",L="";function B(){D&&(o===0?v.push({type:0,value:D}):o===1||o===2||o===3?(v.length>1&&(r==="*"||r==="+")&&t(`A repeatable param (${D}) must be alone in its segment. eg: '/:ids+.`),v.push({type:1,value:D,regexp:L,repeatable:r==="*"||r==="+",optional:r==="*"||r==="?"})):t("Invalid state to consume buffer"),D="")}function U(){D+=r}for(;T<e.length;){if(r=e[T++],r==="\\"&&o!==2){c=o,o=4;continue}switch(o){case 0:r==="/"?(D&&B(),y()):r===":"?(B(),o=1):U();break;case 4:U(),o=c;break;case 1:r==="("?o=2:cG.test(r)?U():(B(),o=0,r!=="*"&&r!=="?"&&r!=="+"&&T--);break;case 2:r===")"?L[L.length-1]=="\\"?L=L.slice(0,-1)+r:o=3:L+=r;break;case 3:B(),o=0,r!=="*"&&r!=="?"&&r!=="+"&&T--,L="";break;default:t("Unknown state");break}}return o===2&&t(`Unfinished custom RegExp for param "${D}"`),B(),y(),d}function hG(e,t,o){const c=sG(uG(e.path),o),d=Hr(c,{record:e,parent:t,children:[],alias:[]});return t&&!d.record.aliasOf==!t.record.aliasOf&&t.children.push(d),d}function dG(e,t){const o=[],c=new Map;t=aM({strict:!1,end:!0,sensitive:!1},t);function d(B){return c.get(B)}function v(B,U,$){const W=!$,q=oM(B);q.aliasOf=$&&$.record;const ne=aM(t,B),ce=[q];if("alias"in B){const be=typeof B.alias=="string"?[B.alias]:B.alias;for(const ge of be)ce.push(oM(Hr({},q,{components:$?$.record.components:q.components,path:ge,aliasOf:$?$.record:q})))}let oe,fe;for(const be of ce){const{path:ge}=be;if(U&&ge[0]!=="/"){const Ee=U.record.path,de=Ee[Ee.length-1]==="/"?"":"/";be.path=U.record.path+(ge&&de+ge)}if(oe=hG(be,U,ne),$?$.alias.push(oe):(fe=fe||oe,fe!==oe&&fe.alias.push(oe),W&&B.name&&!sM(oe)&&y(B.name)),vO(oe)&&r(oe),q.children){const Ee=q.children;for(let de=0;de<Ee.length;de++)v(Ee[de],oe,$&&$.children[de])}$=$||oe}return fe?()=>{y(fe)}:Ng}function y(B){if(mO(B)){const U=c.get(B);U&&(c.delete(B),o.splice(o.indexOf(U),1),U.children.forEach(y),U.alias.forEach(y))}else{const U=o.indexOf(B);U>-1&&(o.splice(U,1),B.record.name&&c.delete(B.record.name),B.children.forEach(y),B.alias.forEach(y))}}function T(){return o}function r(B){const U=mG(B,o);o.splice(U,0,B),B.record.name&&!sM(B)&&c.set(B.record.name,B)}function D(B,U){let $,W={},q,ne;if("name"in B&&B.name){if($=c.get(B.name),!$)throw Ap(1,{location:B});ne=$.record.name,W=Hr(rM(U.params,$.keys.filter(fe=>!fe.optional).concat($.parent?$.parent.keys.filter(fe=>fe.optional):[]).map(fe=>fe.name)),B.params&&rM(B.params,$.keys.map(fe=>fe.name))),q=$.stringify(W)}else if(B.path!=null)q=B.path,$=o.find(fe=>fe.re.test(q)),$&&(W=$.parse(q),ne=$.record.name);else{if($=U.name?c.get(U.name):o.find(fe=>fe.re.test(U.path)),!$)throw Ap(1,{location:B,currentLocation:U});ne=$.record.name,W=Hr({},U.params,B.params),q=$.stringify(W)}const ce=[];let oe=$;for(;oe;)ce.unshift(oe.record),oe=oe.parent;return{name:ne,path:q,params:W,matched:ce,meta:pG(ce)}}e.forEach(B=>v(B));function L(){o.length=0,c.clear()}return{addRoute:v,resolve:D,removeRoute:y,clearRoutes:L,getRoutes:T,getRecordMatcher:d}}function rM(e,t){const o={};for(const c of t)c in e&&(o[c]=e[c]);return o}function oM(e){const t={path:e.path,redirect:e.redirect,name:e.name,meta:e.meta||{},aliasOf:e.aliasOf,beforeEnter:e.beforeEnter,props:fG(e),children:e.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in e?e.components||null:e.component&&{default:e.component}};return Object.defineProperty(t,"mods",{value:{}}),t}function fG(e){const t={},o=e.props||!1;if("component"in e)t.default=o;else for(const c in e.components)t[c]=typeof o=="object"?o[c]:o;return t}function sM(e){for(;e;){if(e.record.aliasOf)return!0;e=e.parent}return!1}function pG(e){return e.reduce((t,o)=>Hr(t,o.meta),{})}function aM(e,t){const o={};for(const c in e)o[c]=c in t?t[c]:e[c];return o}function mG(e,t){let o=0,c=t.length;for(;o!==c;){const v=o+c>>1;_O(e,t[v])<0?c=v:o=v+1}const d=gG(e);return d&&(c=t.lastIndexOf(d,c-1)),c}function gG(e){let t=e;for(;t=t.parent;)if(vO(t)&&_O(e,t)===0)return t}function vO({record:e}){return!!(e.name||e.components&&Object.keys(e.components).length||e.redirect)}function _G(e){const t={};if(e===""||e==="?")return t;const c=(e[0]==="?"?e.slice(1):e).split("&");for(let d=0;d<c.length;++d){const v=c[d].replace(cO," "),y=v.indexOf("="),T=Kg(y<0?v:v.slice(0,y)),r=y<0?null:Kg(v.slice(y+1));if(T in t){let D=t[T];jl(D)||(D=t[T]=[D]),D.push(r)}else t[T]=r}return t}function lM(e){let t="";for(let o in e){const c=e[o];if(o=B3(o),c==null){c!==void 0&&(t+=(t.length?"&":"")+o);continue}(jl(c)?c.map(v=>v&&ww(v)):[c&&ww(c)]).forEach(v=>{v!==void 0&&(t+=(t.length?"&":"")+o,v!=null&&(t+="="+v))})}return t}function vG(e){const t={};for(const o in e){const c=e[o];c!==void 0&&(t[o]=jl(c)?c.map(d=>d==null?null:""+d):c==null?c:""+c)}return t}const yG=Symbol(""),cM=Symbol(""),N0=Symbol(""),yO=Symbol(""),Tw=Symbol("");function Tg(){let e=[];function t(c){return e.push(c),()=>{const d=e.indexOf(c);d>-1&&e.splice(d,1)}}function o(){e=[]}return{add:t,list:()=>e.slice(),reset:o}}function Xu(e,t,o,c,d,v=y=>y()){const y=c&&(c.enterCallbacks[d]=c.enterCallbacks[d]||[]);return()=>new Promise((T,r)=>{const D=U=>{U===!1?r(Ap(4,{from:o,to:t})):U instanceof Error?r(U):iG(U)?r(Ap(2,{from:t,to:U})):(y&&c.enterCallbacks[d]===y&&typeof U=="function"&&y.push(U),T())},L=v(()=>e.call(c&&c.instances[d],t,o,D));let B=Promise.resolve(L);e.length<3&&(B=B.then(D)),B.catch(U=>r(U))})}function M1(e,t,o,c,d=v=>v()){const v=[];for(const y of e)for(const T in y.components){let r=y.components[T];if(!(t!=="beforeRouteEnter"&&!y.instances[T]))if(aO(r)){const L=(r.__vccOpts||r)[t];L&&v.push(Xu(L,o,c,y,T,d))}else{let D=r();v.push(()=>D.then(L=>{if(!L)throw new Error(`Couldn't resolve component "${T}" at "${y.path}"`);const B=I3(L)?L.default:L;y.mods[T]=L,y.components[T]=B;const $=(B.__vccOpts||B)[t];return $&&Xu($,o,c,y,T,d)()}))}}return v}function uM(e){const t=Mi(N0),o=Mi(yO),c=Se(()=>{const r=Zo(e.to);return t.resolve(r)}),d=Se(()=>{const{matched:r}=c.value,{length:D}=r,L=r[D-1],B=o.matched;if(!L||!B.length)return-1;const U=B.findIndex(Cp.bind(null,L));if(U>-1)return U;const $=hM(r[D-2]);return D>1&&hM(L)===$&&B[B.length-1].path!==$?B.findIndex(Cp.bind(null,r[D-2])):U}),v=Se(()=>d.value>-1&&SG(o.params,c.value.params)),y=Se(()=>d.value>-1&&d.value===o.matched.length-1&&fO(o.params,c.value.params));function T(r={}){return wG(r)?t[Zo(e.replace)?"replace":"push"](Zo(e.to)).catch(Ng):Promise.resolve()}return{route:c,href:Se(()=>c.value.href),isActive:v,isExactActive:y,navigate:T}}const bG=wS({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:uM,setup(e,{slots:t}){const o=Ls(uM(e)),{options:c}=Mi(N0),d=Se(()=>({[dM(e.activeClass,c.linkActiveClass,"router-link-active")]:o.isActive,[dM(e.exactActiveClass,c.linkExactActiveClass,"router-link-exact-active")]:o.isExactActive}));return()=>{const v=t.default&&t.default(o);return e.custom?v:Gl("a",{"aria-current":o.isExactActive?e.ariaCurrentValue:null,href:o.href,onClick:o.navigate,class:d.value},v)}}}),xG=bG;function wG(e){if(!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)&&!e.defaultPrevented&&!(e.button!==void 0&&e.button!==0)){if(e.currentTarget&&e.currentTarget.getAttribute){const t=e.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(t))return}return e.preventDefault&&e.preventDefault(),!0}}function SG(e,t){for(const o in t){const c=t[o],d=e[o];if(typeof c=="string"){if(c!==d)return!1}else if(!jl(d)||d.length!==c.length||c.some((v,y)=>v!==d[y]))return!1}return!0}function hM(e){return e?e.aliasOf?e.aliasOf.path:e.path:""}const dM=(e,t,o)=>e??t??o,TG=wS({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(e,{attrs:t,slots:o}){const c=Mi(Tw),d=Se(()=>e.route||c.value),v=Mi(cM,0),y=Se(()=>{let D=Zo(v);const{matched:L}=d.value;let B;for(;(B=L[D])&&!B.components;)D++;return D}),T=Se(()=>d.value.matched[y.value]);Vr(cM,Se(()=>y.value+1)),Vr(yG,T),Vr(Tw,d);const r=rn();return On(()=>[r.value,T.value,e.name],([D,L,B],[U,$,W])=>{L&&(L.instances[B]=D,$&&$!==L&&D&&D===U&&(L.leaveGuards.size||(L.leaveGuards=$.leaveGuards),L.updateGuards.size||(L.updateGuards=$.updateGuards))),D&&L&&(!$||!Cp(L,$)||!U)&&(L.enterCallbacks[B]||[]).forEach(q=>q(D))},{flush:"post"}),()=>{const D=d.value,L=e.name,B=T.value,U=B&&B.components[L];if(!U)return fM(o.default,{Component:U,route:D});const $=B.props[L],W=$?$===!0?D.params:typeof $=="function"?$(D):$:null,ne=Gl(U,Hr({},W,t,{onVnodeUnmounted:ce=>{ce.component.isUnmounted&&(B.instances[L]=null)},ref:r}));return fM(o.default,{Component:ne,route:D})||ne}}});function fM(e,t){if(!e)return null;const o=e(t);return o.length===1?o[0]:o}const EG=TG;function IG(e){const t=dG(e.routes,e),o=e.parseQuery||_G,c=e.stringifyQuery||lM,d=e.history,v=Tg(),y=Tg(),T=Tg(),r=kn($u);let D=$u;ap&&e.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const L=A1.bind(null,et=>""+et),B=A1.bind(null,V3),U=A1.bind(null,Kg);function $(et,Nt){let St,Xt;return mO(et)?(St=t.getRecordMatcher(et),Xt=Nt):Xt=et,t.addRoute(Xt,St)}function W(et){const Nt=t.getRecordMatcher(et);Nt&&t.removeRoute(Nt)}function q(){return t.getRoutes().map(et=>et.record)}function ne(et){return!!t.getRecordMatcher(et)}function ce(et,Nt){if(Nt=Hr({},Nt||r.value),typeof et=="string"){const Ne=P1(o,et,Nt.path),Ue=t.resolve({path:Ne.path},Nt),Et=d.createHref(Ne.fullPath);return Hr(Ne,Ue,{params:U(Ue.params),hash:Kg(Ne.hash),redirectedFrom:void 0,href:Et})}let St;if(et.path!=null)St=Hr({},et,{path:P1(o,et.path,Nt.path).path});else{const Ne=Hr({},et.params);for(const Ue in Ne)Ne[Ue]==null&&delete Ne[Ue];St=Hr({},et,{params:B(Ne)}),Nt.params=B(Nt.params)}const Xt=t.resolve(St,Nt),Ie=et.hash||"";Xt.params=L(U(Xt.params));const gn=j3(c,Hr({},et,{hash:z3(Ie),path:Xt.path})),Ae=d.createHref(gn);return Hr({fullPath:gn,hash:Ie,query:c===lM?vG(et.query):et.query||{}},Xt,{redirectedFrom:void 0,href:Ae})}function oe(et){return typeof et=="string"?P1(o,et,r.value.path):Hr({},et)}function fe(et,Nt){if(D!==et)return Ap(8,{from:Nt,to:et})}function be(et){return de(et)}function ge(et){return be(Hr(oe(et),{replace:!0}))}function Ee(et){const Nt=et.matched[et.matched.length-1];if(Nt&&Nt.redirect){const{redirect:St}=Nt;let Xt=typeof St=="function"?St(et):St;return typeof Xt=="string"&&(Xt=Xt.includes("?")||Xt.includes("#")?Xt=oe(Xt):{path:Xt},Xt.params={}),Hr({query:et.query,hash:et.hash,params:Xt.path!=null?{}:et.params},Xt)}}function de(et,Nt){const St=D=ce(et),Xt=r.value,Ie=et.state,gn=et.force,Ae=et.replace===!0,Ne=Ee(St);if(Ne)return de(Hr(oe(Ne),{state:typeof Ne=="object"?Hr({},Ie,Ne.state):Ie,force:gn,replace:Ae}),Nt||St);const Ue=St;Ue.redirectedFrom=Nt;let Et;return!gn&&$3(c,Xt,St)&&(Et=Ap(16,{to:Ue,from:Xt}),mt(Xt,Xt,!0,!1)),(Et?Promise.resolve(Et):ie(Ue,Xt)).catch(Ct=>Vc(Ct)?Vc(Ct,2)?Ct:rt(Ct):Lt(Ct,Ue,Xt)).then(Ct=>{if(Ct){if(Vc(Ct,2))return de(Hr({replace:Ae},oe(Ct.to),{state:typeof Ct.to=="object"?Hr({},Ie,Ct.to.state):Ie,force:gn}),Nt||Ue)}else Ct=ae(Ue,Xt,!0,Ae,Ie);return te(Ue,Xt,Ct),Ct})}function re(et,Nt){const St=fe(et,Nt);return St?Promise.reject(St):Promise.resolve()}function Y(et){const Nt=Bt.values().next().value;return Nt&&typeof Nt.runWithContext=="function"?Nt.runWithContext(et):et()}function ie(et,Nt){let St;const[Xt,Ie,gn]=CG(et,Nt);St=M1(Xt.reverse(),"beforeRouteLeave",et,Nt);for(const Ne of Xt)Ne.leaveGuards.forEach(Ue=>{St.push(Xu(Ue,et,Nt))});const Ae=re.bind(null,et,Nt);return St.push(Ae),gt(St).then(()=>{St=[];for(const Ne of v.list())St.push(Xu(Ne,et,Nt));return St.push(Ae),gt(St)}).then(()=>{St=M1(Ie,"beforeRouteUpdate",et,Nt);for(const Ne of Ie)Ne.updateGuards.forEach(Ue=>{St.push(Xu(Ue,et,Nt))});return St.push(Ae),gt(St)}).then(()=>{St=[];for(const Ne of gn)if(Ne.beforeEnter)if(jl(Ne.beforeEnter))for(const Ue of Ne.beforeEnter)St.push(Xu(Ue,et,Nt));else St.push(Xu(Ne.beforeEnter,et,Nt));return St.push(Ae),gt(St)}).then(()=>(et.matched.forEach(Ne=>Ne.enterCallbacks={}),St=M1(gn,"beforeRouteEnter",et,Nt,Y),St.push(Ae),gt(St))).then(()=>{St=[];for(const Ne of y.list())St.push(Xu(Ne,et,Nt));return St.push(Ae),gt(St)}).catch(Ne=>Vc(Ne,8)?Ne:Promise.reject(Ne))}function te(et,Nt,St){T.list().forEach(Xt=>Y(()=>Xt(et,Nt,St)))}function ae(et,Nt,St,Xt,Ie){const gn=fe(et,Nt);if(gn)return gn;const Ae=Nt===$u,Ne=ap?history.state:{};St&&(Xt||Ae?d.replace(et.fullPath,Hr({scroll:Ae&&Ne&&Ne.scroll},Ie)):d.push(et.fullPath,Ie)),r.value=et,mt(et,Nt,St,Ae),rt()}let pe;function Le(){pe||(pe=d.listen((et,Nt,St)=>{if(!ht.listening)return;const Xt=ce(et),Ie=Ee(Xt);if(Ie){de(Hr(Ie,{replace:!0}),Xt).catch(Ng);return}D=Xt;const gn=r.value;ap&&K3(QP(gn.fullPath,St.delta),V0()),ie(Xt,gn).catch(Ae=>Vc(Ae,12)?Ae:Vc(Ae,2)?(de(Ae.to,Xt).then(Ne=>{Vc(Ne,20)&&!St.delta&&St.type===Jg.pop&&d.go(-1,!1)}).catch(Ng),Promise.reject()):(St.delta&&d.go(-St.delta,!1),Lt(Ae,Xt,gn))).then(Ae=>{Ae=Ae||ae(Xt,gn,!1),Ae&&(St.delta&&!Vc(Ae,8)?d.go(-St.delta,!1):St.type===Jg.pop&&Vc(Ae,20)&&d.go(-1,!1)),te(Xt,gn,Ae)}).catch(Ng)}))}let tt=Tg(),Je=Tg(),Mt;function Lt(et,Nt,St){rt(et);const Xt=Je.list();return Xt.length?Xt.forEach(Ie=>Ie(et,Nt,St)):console.error(et),Promise.reject(et)}function yt(){return Mt&&r.value!==$u?Promise.resolve():new Promise((et,Nt)=>{tt.add([et,Nt])})}function rt(et){return Mt||(Mt=!et,Le(),tt.list().forEach(([Nt,St])=>et?St(et):Nt()),tt.reset()),et}function mt(et,Nt,St,Xt){const{scrollBehavior:Ie}=e;if(!ap||!Ie)return Promise.resolve();const gn=!St&&J3(QP(et.fullPath,0))||(Xt||!St)&&history.state&&history.state.scroll||null;return Ki().then(()=>Ie(et,Nt,gn)).then(Ae=>Ae&&Y3(Ae)).catch(Ae=>Lt(Ae,et,Nt))}const Ft=et=>d.go(et);let bn;const Bt=new Set,ht={currentRoute:r,listening:!0,addRoute:$,removeRoute:W,clearRoutes:t.clearRoutes,hasRoute:ne,getRoutes:q,resolve:ce,options:e,push:be,replace:ge,go:Ft,back:()=>Ft(-1),forward:()=>Ft(1),beforeEach:v.add,beforeResolve:y.add,afterEach:T.add,onError:Je.add,isReady:yt,install(et){const Nt=this;et.component("RouterLink",xG),et.component("RouterView",EG),et.config.globalProperties.$router=Nt,Object.defineProperty(et.config.globalProperties,"$route",{enumerable:!0,get:()=>Zo(r)}),ap&&!bn&&r.value===$u&&(bn=!0,be(d.location).catch(Ie=>{}));const St={};for(const Ie in $u)Object.defineProperty(St,Ie,{get:()=>r.value[Ie],enumerable:!0});et.provide(N0,Nt),et.provide(yO,rR(St)),et.provide(Tw,r);const Xt=et.unmount;Bt.add(et),et.unmount=function(){Bt.delete(et),Bt.size<1&&(D=$u,pe&&pe(),pe=null,r.value=$u,bn=!1,Mt=!1),Xt()}}};function gt(et){return et.reduce((Nt,St)=>Nt.then(()=>Y(St)),Promise.resolve())}return ht}function CG(e,t){const o=[],c=[],d=[],v=Math.max(t.matched.length,e.matched.length);for(let y=0;y<v;y++){const T=t.matched[y];T&&(e.matched.find(D=>Cp(D,T))?c.push(T):o.push(T));const r=e.matched[y];r&&(t.matched.find(D=>Cp(D,r))||d.push(r))}return[o,c,d]}function bO(){return Mi(N0)}const AG={},PG={class:"container"};function MG(e,t){return Vi(),Xi("div",PG,t[0]||(t[0]=[Qn("h1",{class:"custom-font"},"Welcome to the Elder Home",-1)]))}const kG=xc(AG,[["render",MG],["__scopeId","data-v-900c7888"]]),RG={name:"AdminHomeView"},DG={class:"admin-home"},OG={class:"admin-content"},LG={class:"admin-option"},zG={class:"admin-option"},BG={class:"admin-option"};function FG(e,t,o,c,d,v){const y=cc("router-link");return Vi(),Xi("div",DG,[t[3]||(t[3]=Qn("h1",null,"Welcome to the Admin Dashboard",-1)),Qn("div",OG,[Qn("div",LG,[Z(y,{to:"/user-management",class:"option-card"},{default:bo(()=>t[0]||(t[0]=[Qn("h2",null,"Manage Users",-1),Qn("p",null,"View and manage user accounts.",-1)])),_:1})]),Qn("div",zG,[Z(y,{to:"/reports",class:"option-card"},{default:bo(()=>t[1]||(t[1]=[Qn("h2",null,"View Reports",-1),Qn("p",null,"Analyze reports and insights.",-1)])),_:1})]),Qn("div",BG,[Z(y,{to:"/settings",class:"option-card"},{default:bo(()=>t[2]||(t[2]=[Qn("h2",null,"Settings",-1),Qn("p",null,"Adjust application settings.",-1)])),_:1})])])])}const VG=xc(RG,[["render",FG],["__scopeId","data-v-7dbe1510"]]),NG={class:"auth-container"},UG={key:0,class:"error"},jG={__name:"FirebaseSignInView",setup(e){const t=rn(""),o=rn(""),c=bO(),d=rn(""),v=()=>{d.value="",jD(Zc,t.value,o.value).then(async()=>{(await Zc.currentUser.getIdTokenResult()).claims.admin?await c.push("/admin"):await c.push("/")}).catch(T=>{d.value=y(T.code)})},y=T=>{switch(T){case"auth/user-not-found":return"No user found with this email.";case"auth/wrong-password":return"The password is incorrect.";case"auth/invalid-email":return"The email address is invalid.";case"auth/user-disabled":return"This user account has been disabled.";case"auth/too-many-requests":return"Too many failed attempts. Please try again later.";default:return"An error occurred. Please try again."}};return(T,r)=>(Vi(),Xi("div",NG,[r[2]||(r[2]=Qn("h1",null,"Sign in",-1)),Qn("p",null,[lr(Qn("input",{type:"text",placeholder:"Email","onUpdate:modelValue":r[0]||(r[0]=D=>t.value=D)},null,512),[[pl,t.value]])]),Qn("p",null,[lr(Qn("input",{type:"password",placeholder:"Password","onUpdate:modelValue":r[1]||(r[1]=D=>o.value=D)},null,512),[[pl,o.value]])]),Qn("p",null,[Qn("button",{onClick:v},"Sign in via Firebase")]),Z(Nl,{name:"fade"},{default:bo(()=>[d.value?(Vi(),Xi("p",UG,_c(d.value),1)):Os("",!0)]),_:1})]))}},$G=xc(jG,[["__scopeId","data-v-9f63571d"]]),GG={class:"auth-container"},HG=["disabled"],qG={key:0,class:"error"},WG={__name:"FirebaseRegisterView",setup(e){const t=rn(""),o=rn(""),c=bO(),d=rn(""),v=rn(!1),y=()=>{d.value="",v.value=!0,tj(Zc,t.value,o.value).then(()=>(console.log("Firebase Register Successful!"),jD(Zc,t.value,o.value))).then(async()=>{console.log("User automatically logged in after registration"),(await Zc.currentUser.getIdTokenResult()).claims.admin?await c.push("/admin"):await c.push("/")}).catch(r=>{d.value=T(r.code)}).finally(()=>{v.value=!1})},T=r=>{switch(r){case"auth/email-already-in-use":return"This email is already in use.";case"auth/invalid-email":return"The email address is not valid.";case"auth/weak-password":return"The password is too weak.";default:return"An error occurred. Please try again."}};return(r,D)=>(Vi(),Xi("div",GG,[D[2]||(D[2]=Qn("h1",null,"Create an Account",-1)),Qn("p",null,[lr(Qn("input",{type:"text",placeholder:"Email","onUpdate:modelValue":D[0]||(D[0]=L=>t.value=L)},null,512),[[pl,t.value]])]),Qn("p",null,[lr(Qn("input",{type:"password",placeholder:"Password","onUpdate:modelValue":D[1]||(D[1]=L=>o.value=L)},null,512),[[pl,o.value]])]),Qn("p",null,[Qn("button",{disabled:v.value,onClick:y},"Register & Login",8,HG)]),Z(Nl,{name:"fade"},{default:bo(()=>[d.value?(Vi(),Xi("p",qG,_c(d.value),1)):Os("",!0)]),_:1})]))}},ZG=xc(WG,[["__scopeId","data-v-2cff5fd8"]]),XG={class:"email-form-container"},YG={__name:"SendEmail",setup(e){const t=rn(""),o=rn(""),c=rn(""),d=rn(""),v=rn(!1),y=rn(null),T=rn(""),r=F0(),D=$=>{const W=$.target.files[0];if(W){const q=new FileReader;q.readAsDataURL(W),q.onload=()=>{T.value=q.result.split(",")[1],y.value=W},q.onerror=ne=>{console.error("Error reading file:",ne)}}},L=()=>{t.value="",o.value="",c.value="",y.value=null,T.value="",document.querySelector('input[type="file"]').value=""},B=()=>{setTimeout(()=>{d.value="",v.value=!1},5e3)},U=async()=>{let $=null;try{$=t.value.split(";").map(W=>W.trim())}catch{d.value="Invalid Email list(Must be separated by semicolon.",v.value=!1;return}try{const W=u0(r,"sendEmail");for(const q of $)if(!(await W({toEmail:q,subject:o.value,message:c.value,attachment:T.value,attachmentName:y.value?y.value.name:""})).data.success)throw new Error(`Failed to send to ${q}`);d.value="Emails sent successfully!",v.value=!0,L(),B()}catch(W){d.value=`Failed to send email: ${W.message}`,v.value=!1,B()}};return($,W)=>(Vi(),Xi("div",XG,[W[4]||(W[4]=Qn("h1",null,"Send Email",-1)),Qn("form",{onSubmit:nh(U,["prevent"])},[Qn("p",null,[lr(Qn("input",{type:"text","onUpdate:modelValue":W[0]||(W[0]=q=>t.value=q),placeholder:"Recipient Emails (semicolon separated)",required:""},null,512),[[pl,t.value]])]),Qn("p",null,[lr(Qn("input",{type:"text","onUpdate:modelValue":W[1]||(W[1]=q=>o.value=q),placeholder:"Subject",required:""},null,512),[[pl,o.value]])]),Qn("p",null,[lr(Qn("textarea",{"onUpdate:modelValue":W[2]||(W[2]=q=>c.value=q),placeholder:"Message",required:""},null,512),[[pl,c.value]])]),Qn("p",null,[Qn("input",{type:"file",onChange:D},null,32)]),W[3]||(W[3]=Qn("p",null,[Qn("button",{type:"submit"},"Send Email")],-1)),Z(Nl,{name:"fade"},{default:bo(()=>[d.value?(Vi(),Xi("p",{key:0,class:d_({success:v.value,error:!v.value})},_c(d.value),3)):Os("",!0)]),_:1})],32)]))}},KG=xc(YG,[["__scopeId","data-v-11fa37f8"]]);var JG=function(e,t,o){var c=new RegExp('["'.concat(o,`\r
]`));return t.map(function(d){var v=typeof d=="string"?d:d.key,y=e[v];return typeof y=="number"||typeof y=="boolean"?"".concat(y):y?(typeof y!="string"&&(y=String(y)),c.test(y)?'"'.concat(y.replace(/"/g,'""'),'"'):y):""}).join(o)},QG=function(e){for(var t=new Set,o=0,c=e;o<c.length;o++){var d=c[o];for(var v in d)d.hasOwnProperty(v)&&t.add(v)}return Array.from(t)},e8=function(e,t,o){var c=t??QG(e),d=c.map(function(y){return typeof y=="string"?y:y.label}),v=e.map(function(y){return JG(y,c,o)});return v.unshift(d.join(o)),v.join(`\r
`)},t8="text/csv;charset=utf-8;",pM=function(e){var t=e.data,o=e.filename,c=o===void 0?"export.csv":o,d=e.delimiter,v=d===void 0?",":d,y=e.headers,T=n8(c);if(t.length===0){mM(y?y.map(function(D){return typeof D=="string"?D:D.label}).join(v):"",T);return}var r=e8(t,y,v);mM(r,T)},mM=function(e,t){var o="\uFEFF",c=new Blob([o,e],{type:t8}),d=document.createElement("a");d.href=URL.createObjectURL(c),d.download=t,d.style.display="none",document.body.appendChild(d),d.click(),document.body.removeChild(d)},n8=function(e){return/csv$/i.test(e)?e:"".concat(e,".csv")};const i8={__name:"InteractiveTable",setup(e){const t=[{text:"ID",value:"id",sortable:!0},{text:"Name",value:"name",sortable:!0},{text:"Email",value:"email",sortable:!0},{text:"Gender",value:"gender",sortable:!0}],o=[{text:"ID",value:"id",sortable:!0},{text:"Product Name",value:"product_name",sortable:!0},{text:"Category",value:"category",sortable:!0},{text:"Release Year",value:"release_year",sortable:!0}],c=rn(""),d=rn(""),v=rn([]),y=rn([]),T=rn(!1),r=rn(!1),D=F0(),L=async()=>{T.value=!0;try{const q=await u0(D,"getUsers")();v.value=q.data}catch(W){console.error("Error fetching users:",W)}finally{T.value=!1}},B=async()=>{r.value=!0;try{const q=await u0(D,"getProducts")();y.value=q.data}catch(W){console.error("Error fetching products:",W)}finally{r.value=!1}};ms(()=>{L(),B()});const U=()=>{pM({data:v.value,filename:"users.csv",headers:[{label:"ID",key:"id"},{label:"Name",key:"name"},{label:"Email",key:"email"},{label:"Age",key:"age"}]})},$=()=>{pM({data:y.value,filename:"products.csv",headers:[{label:"ID",key:"id"},{label:"Product Name",key:"product_name"},{label:"Category",key:"category"},{label:"Release Year",key:"release_year"}]})};return(W,q)=>{const ne=cc("v-btn"),ce=cc("v-card-title"),oe=cc("v-text-field"),fe=cc("v-data-table"),be=cc("v-card"),ge=cc("v-container");return Vi(),HR(ge,null,{default:bo(()=>[q[6]||(q[6]=Qn("h1",null,"Interactive Tables",-1)),Z(be,null,{default:bo(()=>[Z(ce,null,{default:bo(()=>[q[3]||(q[3]=$o(" Users Table ")),Z(ne,{onClick:U,class:"ml-auto",color:"primary"},{default:bo(()=>q[2]||(q[2]=[$o(" Export Users to CSV ")])),_:1})]),_:1}),Z(fe,{headers:t,items:v.value,"items-per-page":10,search:c.value,class:"elevation-1",loading:T.value},{top:bo(()=>[Z(oe,{modelValue:c.value,"onUpdate:modelValue":q[0]||(q[0]=Ee=>c.value=Ee),label:"Search Users",class:"mx-4","append-icon":"mdi-magnify"},null,8,["modelValue"])]),_:1},8,["items","search","loading"])]),_:1}),Z(be,{class:"mt-4"},{default:bo(()=>[Z(ce,null,{default:bo(()=>[q[5]||(q[5]=$o(" Products Table ")),Z(ne,{onClick:$,class:"ml-auto",color:"primary"},{default:bo(()=>q[4]||(q[4]=[$o(" Export Products to CSV ")])),_:1})]),_:1}),Z(fe,{headers:o,items:y.value,"items-per-page":10,search:d.value,class:"elevation-1",loading:r.value},{top:bo(()=>[Z(oe,{modelValue:d.value,"onUpdate:modelValue":q[1]||(q[1]=Ee=>d.value=Ee),label:"Search Products",class:"mx-4","append-icon":"mdi-magnify"},null,8,["modelValue"])]),_:1},8,["items","search","loading"])]),_:1})]),_:1})}}};var ps=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function nT(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function r8(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var o=function c(){return this instanceof c?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};o.prototype=t.prototype}else o={};return Object.defineProperty(o,"__esModule",{value:!0}),Object.keys(e).forEach(function(c){var d=Object.getOwnPropertyDescriptor(e,c);Object.defineProperty(o,c,d.get?d:{enumerable:!0,get:function(){return e[c]}})}),o}var xO={exports:{}};(function(e,t){var o={};(function(c,d){e.exports=d()})(ps,function(){var c,d,v;function y(r,D){if(!c)c=D;else if(!d)d=D;else{var L="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+c+")(sharedChunk); ("+d+")(sharedChunk); self.onerror = null;",B={};c(B),v=D(B),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(v.workerUrl=window.URL.createObjectURL(new Blob([L],{type:"text/javascript"})))}}y(["exports"],function(r){function D(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var L,B={},U={};function $(){if(L)return U;L=1,Object.defineProperty(U,"__esModule",{value:!0}),U.setMatrixArrayType=function(g){U.ARRAY_TYPE=n=g},U.toRadian=function(g){return g*h},U.equals=function(g,f){return Math.abs(g-f)<=u*Math.max(1,Math.abs(g),Math.abs(f))},U.RANDOM=U.ARRAY_TYPE=U.EPSILON=void 0;var u=1e-6;U.EPSILON=u;var n=typeof Float32Array<"u"?Float32Array:Array;U.ARRAY_TYPE=n;var s=Math.random;U.RANDOM=s;var h=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var g=0,f=arguments.length;f--;)g+=arguments[f]*arguments[f];return Math.sqrt(g)}),U}var W,q={};function ne(){if(W)return q;function u(f){return u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(_){return typeof _}:function(_){return _&&typeof Symbol=="function"&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _},u(f)}W=1,Object.defineProperty(q,"__esModule",{value:!0}),q.create=function(){var f=new n.ARRAY_TYPE(4);return n.ARRAY_TYPE!=Float32Array&&(f[1]=0,f[2]=0),f[0]=1,f[3]=1,f},q.clone=function(f){var _=new n.ARRAY_TYPE(4);return _[0]=f[0],_[1]=f[1],_[2]=f[2],_[3]=f[3],_},q.copy=function(f,_){return f[0]=_[0],f[1]=_[1],f[2]=_[2],f[3]=_[3],f},q.identity=function(f){return f[0]=1,f[1]=0,f[2]=0,f[3]=1,f},q.fromValues=function(f,_,S,A){var k=new n.ARRAY_TYPE(4);return k[0]=f,k[1]=_,k[2]=S,k[3]=A,k},q.set=function(f,_,S,A,k){return f[0]=_,f[1]=S,f[2]=A,f[3]=k,f},q.transpose=function(f,_){if(f===_){var S=_[1];f[1]=_[2],f[2]=S}else f[0]=_[0],f[1]=_[2],f[2]=_[1],f[3]=_[3];return f},q.invert=function(f,_){var S=_[0],A=_[1],k=_[2],x=_[3],I=S*x-k*A;return I?(f[0]=x*(I=1/I),f[1]=-A*I,f[2]=-k*I,f[3]=S*I,f):null},q.adjoint=function(f,_){var S=_[0];return f[0]=_[3],f[1]=-_[1],f[2]=-_[2],f[3]=S,f},q.determinant=function(f){return f[0]*f[3]-f[2]*f[1]},q.multiply=h,q.rotate=function(f,_,S){var A=_[0],k=_[1],x=_[2],I=_[3],M=Math.sin(S),C=Math.cos(S);return f[0]=A*C+x*M,f[1]=k*C+I*M,f[2]=A*-M+x*C,f[3]=k*-M+I*C,f},q.scale=function(f,_,S){var A=_[1],k=_[2],x=_[3],I=S[0],M=S[1];return f[0]=_[0]*I,f[1]=A*I,f[2]=k*M,f[3]=x*M,f},q.fromRotation=function(f,_){var S=Math.sin(_),A=Math.cos(_);return f[0]=A,f[1]=S,f[2]=-S,f[3]=A,f},q.fromScaling=function(f,_){return f[0]=_[0],f[1]=0,f[2]=0,f[3]=_[1],f},q.str=function(f){return"mat2("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+")"},q.frob=function(f){return Math.hypot(f[0],f[1],f[2],f[3])},q.LDU=function(f,_,S,A){return f[2]=A[2]/A[0],S[0]=A[0],S[1]=A[1],S[3]=A[3]-f[2]*S[1],[f,_,S]},q.add=function(f,_,S){return f[0]=_[0]+S[0],f[1]=_[1]+S[1],f[2]=_[2]+S[2],f[3]=_[3]+S[3],f},q.subtract=g,q.exactEquals=function(f,_){return f[0]===_[0]&&f[1]===_[1]&&f[2]===_[2]&&f[3]===_[3]},q.equals=function(f,_){var S=f[0],A=f[1],k=f[2],x=f[3],I=_[0],M=_[1],C=_[2],P=_[3];return Math.abs(S-I)<=n.EPSILON*Math.max(1,Math.abs(S),Math.abs(I))&&Math.abs(A-M)<=n.EPSILON*Math.max(1,Math.abs(A),Math.abs(M))&&Math.abs(k-C)<=n.EPSILON*Math.max(1,Math.abs(k),Math.abs(C))&&Math.abs(x-P)<=n.EPSILON*Math.max(1,Math.abs(x),Math.abs(P))},q.multiplyScalar=function(f,_,S){return f[0]=_[0]*S,f[1]=_[1]*S,f[2]=_[2]*S,f[3]=_[3]*S,f},q.multiplyScalarAndAdd=function(f,_,S,A){return f[0]=_[0]+S[0]*A,f[1]=_[1]+S[1]*A,f[2]=_[2]+S[2]*A,f[3]=_[3]+S[3]*A,f},q.sub=q.mul=void 0;var n=function(f,_){if(f&&f.__esModule)return f;if(f===null||u(f)!=="object"&&typeof f!="function")return{default:f};var S=s(void 0);if(S&&S.has(f))return S.get(f);var A={},k=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in f)if(x!=="default"&&Object.prototype.hasOwnProperty.call(f,x)){var I=k?Object.getOwnPropertyDescriptor(f,x):null;I&&(I.get||I.set)?Object.defineProperty(A,x,I):A[x]=f[x]}return A.default=f,S&&S.set(f,A),A}($());function s(f){if(typeof WeakMap!="function")return null;var _=new WeakMap,S=new WeakMap;return(s=function(A){return A?S:_})(f)}function h(f,_,S){var A=_[0],k=_[1],x=_[2],I=_[3],M=S[0],C=S[1],P=S[2],O=S[3];return f[0]=A*M+x*C,f[1]=k*M+I*C,f[2]=A*P+x*O,f[3]=k*P+I*O,f}function g(f,_,S){return f[0]=_[0]-S[0],f[1]=_[1]-S[1],f[2]=_[2]-S[2],f[3]=_[3]-S[3],f}return q.mul=h,q.sub=g,q}var ce,oe={};function fe(){if(ce)return oe;function u(f){return u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(_){return typeof _}:function(_){return _&&typeof Symbol=="function"&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _},u(f)}ce=1,Object.defineProperty(oe,"__esModule",{value:!0}),oe.create=function(){var f=new n.ARRAY_TYPE(6);return n.ARRAY_TYPE!=Float32Array&&(f[1]=0,f[2]=0,f[4]=0,f[5]=0),f[0]=1,f[3]=1,f},oe.clone=function(f){var _=new n.ARRAY_TYPE(6);return _[0]=f[0],_[1]=f[1],_[2]=f[2],_[3]=f[3],_[4]=f[4],_[5]=f[5],_},oe.copy=function(f,_){return f[0]=_[0],f[1]=_[1],f[2]=_[2],f[3]=_[3],f[4]=_[4],f[5]=_[5],f},oe.identity=function(f){return f[0]=1,f[1]=0,f[2]=0,f[3]=1,f[4]=0,f[5]=0,f},oe.fromValues=function(f,_,S,A,k,x){var I=new n.ARRAY_TYPE(6);return I[0]=f,I[1]=_,I[2]=S,I[3]=A,I[4]=k,I[5]=x,I},oe.set=function(f,_,S,A,k,x,I){return f[0]=_,f[1]=S,f[2]=A,f[3]=k,f[4]=x,f[5]=I,f},oe.invert=function(f,_){var S=_[0],A=_[1],k=_[2],x=_[3],I=_[4],M=_[5],C=S*x-A*k;return C?(f[0]=x*(C=1/C),f[1]=-A*C,f[2]=-k*C,f[3]=S*C,f[4]=(k*M-x*I)*C,f[5]=(A*I-S*M)*C,f):null},oe.determinant=function(f){return f[0]*f[3]-f[1]*f[2]},oe.multiply=h,oe.rotate=function(f,_,S){var A=_[0],k=_[1],x=_[2],I=_[3],M=_[4],C=_[5],P=Math.sin(S),O=Math.cos(S);return f[0]=A*O+x*P,f[1]=k*O+I*P,f[2]=A*-P+x*O,f[3]=k*-P+I*O,f[4]=M,f[5]=C,f},oe.scale=function(f,_,S){var A=_[1],k=_[2],x=_[3],I=_[4],M=_[5],C=S[0],P=S[1];return f[0]=_[0]*C,f[1]=A*C,f[2]=k*P,f[3]=x*P,f[4]=I,f[5]=M,f},oe.translate=function(f,_,S){var A=_[0],k=_[1],x=_[2],I=_[3],M=_[4],C=_[5],P=S[0],O=S[1];return f[0]=A,f[1]=k,f[2]=x,f[3]=I,f[4]=A*P+x*O+M,f[5]=k*P+I*O+C,f},oe.fromRotation=function(f,_){var S=Math.sin(_),A=Math.cos(_);return f[0]=A,f[1]=S,f[2]=-S,f[3]=A,f[4]=0,f[5]=0,f},oe.fromScaling=function(f,_){return f[0]=_[0],f[1]=0,f[2]=0,f[3]=_[1],f[4]=0,f[5]=0,f},oe.fromTranslation=function(f,_){return f[0]=1,f[1]=0,f[2]=0,f[3]=1,f[4]=_[0],f[5]=_[1],f},oe.str=function(f){return"mat2d("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+", "+f[4]+", "+f[5]+")"},oe.frob=function(f){return Math.hypot(f[0],f[1],f[2],f[3],f[4],f[5],1)},oe.add=function(f,_,S){return f[0]=_[0]+S[0],f[1]=_[1]+S[1],f[2]=_[2]+S[2],f[3]=_[3]+S[3],f[4]=_[4]+S[4],f[5]=_[5]+S[5],f},oe.subtract=g,oe.multiplyScalar=function(f,_,S){return f[0]=_[0]*S,f[1]=_[1]*S,f[2]=_[2]*S,f[3]=_[3]*S,f[4]=_[4]*S,f[5]=_[5]*S,f},oe.multiplyScalarAndAdd=function(f,_,S,A){return f[0]=_[0]+S[0]*A,f[1]=_[1]+S[1]*A,f[2]=_[2]+S[2]*A,f[3]=_[3]+S[3]*A,f[4]=_[4]+S[4]*A,f[5]=_[5]+S[5]*A,f},oe.exactEquals=function(f,_){return f[0]===_[0]&&f[1]===_[1]&&f[2]===_[2]&&f[3]===_[3]&&f[4]===_[4]&&f[5]===_[5]},oe.equals=function(f,_){var S=f[0],A=f[1],k=f[2],x=f[3],I=f[4],M=f[5],C=_[0],P=_[1],O=_[2],V=_[3],G=_[4],J=_[5];return Math.abs(S-C)<=n.EPSILON*Math.max(1,Math.abs(S),Math.abs(C))&&Math.abs(A-P)<=n.EPSILON*Math.max(1,Math.abs(A),Math.abs(P))&&Math.abs(k-O)<=n.EPSILON*Math.max(1,Math.abs(k),Math.abs(O))&&Math.abs(x-V)<=n.EPSILON*Math.max(1,Math.abs(x),Math.abs(V))&&Math.abs(I-G)<=n.EPSILON*Math.max(1,Math.abs(I),Math.abs(G))&&Math.abs(M-J)<=n.EPSILON*Math.max(1,Math.abs(M),Math.abs(J))},oe.sub=oe.mul=void 0;var n=function(f,_){if(f&&f.__esModule)return f;if(f===null||u(f)!=="object"&&typeof f!="function")return{default:f};var S=s(void 0);if(S&&S.has(f))return S.get(f);var A={},k=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in f)if(x!=="default"&&Object.prototype.hasOwnProperty.call(f,x)){var I=k?Object.getOwnPropertyDescriptor(f,x):null;I&&(I.get||I.set)?Object.defineProperty(A,x,I):A[x]=f[x]}return A.default=f,S&&S.set(f,A),A}($());function s(f){if(typeof WeakMap!="function")return null;var _=new WeakMap,S=new WeakMap;return(s=function(A){return A?S:_})(f)}function h(f,_,S){var A=_[0],k=_[1],x=_[2],I=_[3],M=_[4],C=_[5],P=S[0],O=S[1],V=S[2],G=S[3],J=S[4],ee=S[5];return f[0]=A*P+x*O,f[1]=k*P+I*O,f[2]=A*V+x*G,f[3]=k*V+I*G,f[4]=A*J+x*ee+M,f[5]=k*J+I*ee+C,f}function g(f,_,S){return f[0]=_[0]-S[0],f[1]=_[1]-S[1],f[2]=_[2]-S[2],f[3]=_[3]-S[3],f[4]=_[4]-S[4],f[5]=_[5]-S[5],f}return oe.mul=h,oe.sub=g,oe}var be,ge={};function Ee(){if(be)return ge;function u(f){return u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(_){return typeof _}:function(_){return _&&typeof Symbol=="function"&&_.constructor===Symbol&&_!==Symbol.prototype?"symbol":typeof _},u(f)}be=1,Object.defineProperty(ge,"__esModule",{value:!0}),ge.create=function(){var f=new n.ARRAY_TYPE(9);return n.ARRAY_TYPE!=Float32Array&&(f[1]=0,f[2]=0,f[3]=0,f[5]=0,f[6]=0,f[7]=0),f[0]=1,f[4]=1,f[8]=1,f},ge.fromMat4=function(f,_){return f[0]=_[0],f[1]=_[1],f[2]=_[2],f[3]=_[4],f[4]=_[5],f[5]=_[6],f[6]=_[8],f[7]=_[9],f[8]=_[10],f},ge.clone=function(f){var _=new n.ARRAY_TYPE(9);return _[0]=f[0],_[1]=f[1],_[2]=f[2],_[3]=f[3],_[4]=f[4],_[5]=f[5],_[6]=f[6],_[7]=f[7],_[8]=f[8],_},ge.copy=function(f,_){return f[0]=_[0],f[1]=_[1],f[2]=_[2],f[3]=_[3],f[4]=_[4],f[5]=_[5],f[6]=_[6],f[7]=_[7],f[8]=_[8],f},ge.fromValues=function(f,_,S,A,k,x,I,M,C){var P=new n.ARRAY_TYPE(9);return P[0]=f,P[1]=_,P[2]=S,P[3]=A,P[4]=k,P[5]=x,P[6]=I,P[7]=M,P[8]=C,P},ge.set=function(f,_,S,A,k,x,I,M,C,P){return f[0]=_,f[1]=S,f[2]=A,f[3]=k,f[4]=x,f[5]=I,f[6]=M,f[7]=C,f[8]=P,f},ge.identity=function(f){return f[0]=1,f[1]=0,f[2]=0,f[3]=0,f[4]=1,f[5]=0,f[6]=0,f[7]=0,f[8]=1,f},ge.transpose=function(f,_){if(f===_){var S=_[1],A=_[2],k=_[5];f[1]=_[3],f[2]=_[6],f[3]=S,f[5]=_[7],f[6]=A,f[7]=k}else f[0]=_[0],f[1]=_[3],f[2]=_[6],f[3]=_[1],f[4]=_[4],f[5]=_[7],f[6]=_[2],f[7]=_[5],f[8]=_[8];return f},ge.invert=function(f,_){var S=_[0],A=_[1],k=_[2],x=_[3],I=_[4],M=_[5],C=_[6],P=_[7],O=_[8],V=O*I-M*P,G=-O*x+M*C,J=P*x-I*C,ee=S*V+A*G+k*J;return ee?(f[0]=V*(ee=1/ee),f[1]=(-O*A+k*P)*ee,f[2]=(M*A-k*I)*ee,f[3]=G*ee,f[4]=(O*S-k*C)*ee,f[5]=(-M*S+k*x)*ee,f[6]=J*ee,f[7]=(-P*S+A*C)*ee,f[8]=(I*S-A*x)*ee,f):null},ge.adjoint=function(f,_){var S=_[0],A=_[1],k=_[2],x=_[3],I=_[4],M=_[5],C=_[6],P=_[7],O=_[8];return f[0]=I*O-M*P,f[1]=k*P-A*O,f[2]=A*M-k*I,f[3]=M*C-x*O,f[4]=S*O-k*C,f[5]=k*x-S*M,f[6]=x*P-I*C,f[7]=A*C-S*P,f[8]=S*I-A*x,f},ge.determinant=function(f){var _=f[3],S=f[4],A=f[5],k=f[6],x=f[7],I=f[8];return f[0]*(I*S-A*x)+f[1]*(-I*_+A*k)+f[2]*(x*_-S*k)},ge.multiply=h,ge.translate=function(f,_,S){var A=_[0],k=_[1],x=_[2],I=_[3],M=_[4],C=_[5],P=_[6],O=_[7],V=_[8],G=S[0],J=S[1];return f[0]=A,f[1]=k,f[2]=x,f[3]=I,f[4]=M,f[5]=C,f[6]=G*A+J*I+P,f[7]=G*k+J*M+O,f[8]=G*x+J*C+V,f},ge.rotate=function(f,_,S){var A=_[0],k=_[1],x=_[2],I=_[3],M=_[4],C=_[5],P=_[6],O=_[7],V=_[8],G=Math.sin(S),J=Math.cos(S);return f[0]=J*A+G*I,f[1]=J*k+G*M,f[2]=J*x+G*C,f[3]=J*I-G*A,f[4]=J*M-G*k,f[5]=J*C-G*x,f[6]=P,f[7]=O,f[8]=V,f},ge.scale=function(f,_,S){var A=S[0],k=S[1];return f[0]=A*_[0],f[1]=A*_[1],f[2]=A*_[2],f[3]=k*_[3],f[4]=k*_[4],f[5]=k*_[5],f[6]=_[6],f[7]=_[7],f[8]=_[8],f},ge.fromTranslation=function(f,_){return f[0]=1,f[1]=0,f[2]=0,f[3]=0,f[4]=1,f[5]=0,f[6]=_[0],f[7]=_[1],f[8]=1,f},ge.fromRotation=function(f,_){var S=Math.sin(_),A=Math.cos(_);return f[0]=A,f[1]=S,f[2]=0,f[3]=-S,f[4]=A,f[5]=0,f[6]=0,f[7]=0,f[8]=1,f},ge.fromScaling=function(f,_){return f[0]=_[0],f[1]=0,f[2]=0,f[3]=0,f[4]=_[1],f[5]=0,f[6]=0,f[7]=0,f[8]=1,f},ge.fromMat2d=function(f,_){return f[0]=_[0],f[1]=_[1],f[2]=0,f[3]=_[2],f[4]=_[3],f[5]=0,f[6]=_[4],f[7]=_[5],f[8]=1,f},ge.fromQuat=function(f,_){var S=_[0],A=_[1],k=_[2],x=_[3],I=S+S,M=A+A,C=k+k,P=S*I,O=A*I,V=A*M,G=k*I,J=k*M,ee=k*C,H=x*I,se=x*M,ue=x*C;return f[0]=1-V-ee,f[3]=O-ue,f[6]=G+se,f[1]=O+ue,f[4]=1-P-ee,f[7]=J-H,f[2]=G-se,f[5]=J+H,f[8]=1-P-V,f},ge.normalFromMat4=function(f,_){var S=_[0],A=_[1],k=_[2],x=_[3],I=_[4],M=_[5],C=_[6],P=_[7],O=_[8],V=_[9],G=_[10],J=_[11],ee=_[12],H=_[13],se=_[14],ue=_[15],we=S*M-A*I,Me=S*C-k*I,Re=S*P-x*I,Ce=A*C-k*M,je=A*P-x*M,Oe=k*P-x*C,He=O*H-V*ee,Qe=O*se-G*ee,it=O*ue-J*ee,ot=V*se-G*H,ct=V*ue-J*H,bt=G*ue-J*se,ut=we*bt-Me*ct+Re*ot+Ce*it-je*Qe+Oe*He;return ut?(f[0]=(M*bt-C*ct+P*ot)*(ut=1/ut),f[1]=(C*it-I*bt-P*Qe)*ut,f[2]=(I*ct-M*it+P*He)*ut,f[3]=(k*ct-A*bt-x*ot)*ut,f[4]=(S*bt-k*it+x*Qe)*ut,f[5]=(A*it-S*ct-x*He)*ut,f[6]=(H*Oe-se*je+ue*Ce)*ut,f[7]=(se*Re-ee*Oe-ue*Me)*ut,f[8]=(ee*je-H*Re+ue*we)*ut,f):null},ge.projection=function(f,_,S){return f[0]=2/_,f[1]=0,f[2]=0,f[3]=0,f[4]=-2/S,f[5]=0,f[6]=-1,f[7]=1,f[8]=1,f},ge.str=function(f){return"mat3("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+", "+f[4]+", "+f[5]+", "+f[6]+", "+f[7]+", "+f[8]+")"},ge.frob=function(f){return Math.hypot(f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8])},ge.add=function(f,_,S){return f[0]=_[0]+S[0],f[1]=_[1]+S[1],f[2]=_[2]+S[2],f[3]=_[3]+S[3],f[4]=_[4]+S[4],f[5]=_[5]+S[5],f[6]=_[6]+S[6],f[7]=_[7]+S[7],f[8]=_[8]+S[8],f},ge.subtract=g,ge.multiplyScalar=function(f,_,S){return f[0]=_[0]*S,f[1]=_[1]*S,f[2]=_[2]*S,f[3]=_[3]*S,f[4]=_[4]*S,f[5]=_[5]*S,f[6]=_[6]*S,f[7]=_[7]*S,f[8]=_[8]*S,f},ge.multiplyScalarAndAdd=function(f,_,S,A){return f[0]=_[0]+S[0]*A,f[1]=_[1]+S[1]*A,f[2]=_[2]+S[2]*A,f[3]=_[3]+S[3]*A,f[4]=_[4]+S[4]*A,f[5]=_[5]+S[5]*A,f[6]=_[6]+S[6]*A,f[7]=_[7]+S[7]*A,f[8]=_[8]+S[8]*A,f},ge.exactEquals=function(f,_){return f[0]===_[0]&&f[1]===_[1]&&f[2]===_[2]&&f[3]===_[3]&&f[4]===_[4]&&f[5]===_[5]&&f[6]===_[6]&&f[7]===_[7]&&f[8]===_[8]},ge.equals=function(f,_){var S=f[0],A=f[1],k=f[2],x=f[3],I=f[4],M=f[5],C=f[6],P=f[7],O=f[8],V=_[0],G=_[1],J=_[2],ee=_[3],H=_[4],se=_[5],ue=_[6],we=_[7],Me=_[8];return Math.abs(S-V)<=n.EPSILON*Math.max(1,Math.abs(S),Math.abs(V))&&Math.abs(A-G)<=n.EPSILON*Math.max(1,Math.abs(A),Math.abs(G))&&Math.abs(k-J)<=n.EPSILON*Math.max(1,Math.abs(k),Math.abs(J))&&Math.abs(x-ee)<=n.EPSILON*Math.max(1,Math.abs(x),Math.abs(ee))&&Math.abs(I-H)<=n.EPSILON*Math.max(1,Math.abs(I),Math.abs(H))&&Math.abs(M-se)<=n.EPSILON*Math.max(1,Math.abs(M),Math.abs(se))&&Math.abs(C-ue)<=n.EPSILON*Math.max(1,Math.abs(C),Math.abs(ue))&&Math.abs(P-we)<=n.EPSILON*Math.max(1,Math.abs(P),Math.abs(we))&&Math.abs(O-Me)<=n.EPSILON*Math.max(1,Math.abs(O),Math.abs(Me))},ge.sub=ge.mul=void 0;var n=function(f,_){if(f&&f.__esModule)return f;if(f===null||u(f)!=="object"&&typeof f!="function")return{default:f};var S=s(void 0);if(S&&S.has(f))return S.get(f);var A={},k=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var x in f)if(x!=="default"&&Object.prototype.hasOwnProperty.call(f,x)){var I=k?Object.getOwnPropertyDescriptor(f,x):null;I&&(I.get||I.set)?Object.defineProperty(A,x,I):A[x]=f[x]}return A.default=f,S&&S.set(f,A),A}($());function s(f){if(typeof WeakMap!="function")return null;var _=new WeakMap,S=new WeakMap;return(s=function(A){return A?S:_})(f)}function h(f,_,S){var A=_[0],k=_[1],x=_[2],I=_[3],M=_[4],C=_[5],P=_[6],O=_[7],V=_[8],G=S[0],J=S[1],ee=S[2],H=S[3],se=S[4],ue=S[5],we=S[6],Me=S[7],Re=S[8];return f[0]=G*A+J*I+ee*P,f[1]=G*k+J*M+ee*O,f[2]=G*x+J*C+ee*V,f[3]=H*A+se*I+ue*P,f[4]=H*k+se*M+ue*O,f[5]=H*x+se*C+ue*V,f[6]=we*A+Me*I+Re*P,f[7]=we*k+Me*M+Re*O,f[8]=we*x+Me*C+Re*V,f}function g(f,_,S){return f[0]=_[0]-S[0],f[1]=_[1]-S[1],f[2]=_[2]-S[2],f[3]=_[3]-S[3],f[4]=_[4]-S[4],f[5]=_[5]-S[5],f[6]=_[6]-S[6],f[7]=_[7]-S[7],f[8]=_[8]-S[8],f}return ge.mul=h,ge.sub=g,ge}var de,re={};function Y(){if(de)return re;function u(x){return u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(I){return typeof I}:function(I){return I&&typeof Symbol=="function"&&I.constructor===Symbol&&I!==Symbol.prototype?"symbol":typeof I},u(x)}de=1,Object.defineProperty(re,"__esModule",{value:!0}),re.create=function(){var x=new n.ARRAY_TYPE(16);return n.ARRAY_TYPE!=Float32Array&&(x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=0,x[12]=0,x[13]=0,x[14]=0),x[0]=1,x[5]=1,x[10]=1,x[15]=1,x},re.clone=function(x){var I=new n.ARRAY_TYPE(16);return I[0]=x[0],I[1]=x[1],I[2]=x[2],I[3]=x[3],I[4]=x[4],I[5]=x[5],I[6]=x[6],I[7]=x[7],I[8]=x[8],I[9]=x[9],I[10]=x[10],I[11]=x[11],I[12]=x[12],I[13]=x[13],I[14]=x[14],I[15]=x[15],I},re.copy=function(x,I){return x[0]=I[0],x[1]=I[1],x[2]=I[2],x[3]=I[3],x[4]=I[4],x[5]=I[5],x[6]=I[6],x[7]=I[7],x[8]=I[8],x[9]=I[9],x[10]=I[10],x[11]=I[11],x[12]=I[12],x[13]=I[13],x[14]=I[14],x[15]=I[15],x},re.fromValues=function(x,I,M,C,P,O,V,G,J,ee,H,se,ue,we,Me,Re){var Ce=new n.ARRAY_TYPE(16);return Ce[0]=x,Ce[1]=I,Ce[2]=M,Ce[3]=C,Ce[4]=P,Ce[5]=O,Ce[6]=V,Ce[7]=G,Ce[8]=J,Ce[9]=ee,Ce[10]=H,Ce[11]=se,Ce[12]=ue,Ce[13]=we,Ce[14]=Me,Ce[15]=Re,Ce},re.set=function(x,I,M,C,P,O,V,G,J,ee,H,se,ue,we,Me,Re,Ce){return x[0]=I,x[1]=M,x[2]=C,x[3]=P,x[4]=O,x[5]=V,x[6]=G,x[7]=J,x[8]=ee,x[9]=H,x[10]=se,x[11]=ue,x[12]=we,x[13]=Me,x[14]=Re,x[15]=Ce,x},re.identity=h,re.transpose=function(x,I){if(x===I){var M=I[1],C=I[2],P=I[3],O=I[6],V=I[7],G=I[11];x[1]=I[4],x[2]=I[8],x[3]=I[12],x[4]=M,x[6]=I[9],x[7]=I[13],x[8]=C,x[9]=O,x[11]=I[14],x[12]=P,x[13]=V,x[14]=G}else x[0]=I[0],x[1]=I[4],x[2]=I[8],x[3]=I[12],x[4]=I[1],x[5]=I[5],x[6]=I[9],x[7]=I[13],x[8]=I[2],x[9]=I[6],x[10]=I[10],x[11]=I[14],x[12]=I[3],x[13]=I[7],x[14]=I[11],x[15]=I[15];return x},re.invert=function(x,I){var M=I[0],C=I[1],P=I[2],O=I[3],V=I[4],G=I[5],J=I[6],ee=I[7],H=I[8],se=I[9],ue=I[10],we=I[11],Me=I[12],Re=I[13],Ce=I[14],je=I[15],Oe=M*G-C*V,He=M*J-P*V,Qe=M*ee-O*V,it=C*J-P*G,ot=C*ee-O*G,ct=P*ee-O*J,bt=H*Re-se*Me,ut=H*Ce-ue*Me,Ot=H*je-we*Me,$t=se*Ce-ue*Re,It=se*je-we*Re,En=ue*je-we*Ce,mn=Oe*En-He*It+Qe*$t+it*Ot-ot*ut+ct*bt;return mn?(x[0]=(G*En-J*It+ee*$t)*(mn=1/mn),x[1]=(P*It-C*En-O*$t)*mn,x[2]=(Re*ct-Ce*ot+je*it)*mn,x[3]=(ue*ot-se*ct-we*it)*mn,x[4]=(J*Ot-V*En-ee*ut)*mn,x[5]=(M*En-P*Ot+O*ut)*mn,x[6]=(Ce*Qe-Me*ct-je*He)*mn,x[7]=(H*ct-ue*Qe+we*He)*mn,x[8]=(V*It-G*Ot+ee*bt)*mn,x[9]=(C*Ot-M*It-O*bt)*mn,x[10]=(Me*ot-Re*Qe+je*Oe)*mn,x[11]=(se*Qe-H*ot-we*Oe)*mn,x[12]=(G*ut-V*$t-J*bt)*mn,x[13]=(M*$t-C*ut+P*bt)*mn,x[14]=(Re*He-Me*it-Ce*Oe)*mn,x[15]=(H*it-se*He+ue*Oe)*mn,x):null},re.adjoint=function(x,I){var M=I[0],C=I[1],P=I[2],O=I[3],V=I[4],G=I[5],J=I[6],ee=I[7],H=I[8],se=I[9],ue=I[10],we=I[11],Me=I[12],Re=I[13],Ce=I[14],je=I[15];return x[0]=G*(ue*je-we*Ce)-se*(J*je-ee*Ce)+Re*(J*we-ee*ue),x[1]=-(C*(ue*je-we*Ce)-se*(P*je-O*Ce)+Re*(P*we-O*ue)),x[2]=C*(J*je-ee*Ce)-G*(P*je-O*Ce)+Re*(P*ee-O*J),x[3]=-(C*(J*we-ee*ue)-G*(P*we-O*ue)+se*(P*ee-O*J)),x[4]=-(V*(ue*je-we*Ce)-H*(J*je-ee*Ce)+Me*(J*we-ee*ue)),x[5]=M*(ue*je-we*Ce)-H*(P*je-O*Ce)+Me*(P*we-O*ue),x[6]=-(M*(J*je-ee*Ce)-V*(P*je-O*Ce)+Me*(P*ee-O*J)),x[7]=M*(J*we-ee*ue)-V*(P*we-O*ue)+H*(P*ee-O*J),x[8]=V*(se*je-we*Re)-H*(G*je-ee*Re)+Me*(G*we-ee*se),x[9]=-(M*(se*je-we*Re)-H*(C*je-O*Re)+Me*(C*we-O*se)),x[10]=M*(G*je-ee*Re)-V*(C*je-O*Re)+Me*(C*ee-O*G),x[11]=-(M*(G*we-ee*se)-V*(C*we-O*se)+H*(C*ee-O*G)),x[12]=-(V*(se*Ce-ue*Re)-H*(G*Ce-J*Re)+Me*(G*ue-J*se)),x[13]=M*(se*Ce-ue*Re)-H*(C*Ce-P*Re)+Me*(C*ue-P*se),x[14]=-(M*(G*Ce-J*Re)-V*(C*Ce-P*Re)+Me*(C*J-P*G)),x[15]=M*(G*ue-J*se)-V*(C*ue-P*se)+H*(C*J-P*G),x},re.determinant=function(x){var I=x[0],M=x[1],C=x[2],P=x[3],O=x[4],V=x[5],G=x[6],J=x[7],ee=x[8],H=x[9],se=x[10],ue=x[11],we=x[12],Me=x[13],Re=x[14],Ce=x[15];return(I*V-M*O)*(se*Ce-ue*Re)-(I*G-C*O)*(H*Ce-ue*Me)+(I*J-P*O)*(H*Re-se*Me)+(M*G-C*V)*(ee*Ce-ue*we)-(M*J-P*V)*(ee*Re-se*we)+(C*J-P*G)*(ee*Me-H*we)},re.multiply=g,re.translate=function(x,I,M){var C,P,O,V,G,J,ee,H,se,ue,we,Me,Re=M[0],Ce=M[1],je=M[2];return I===x?(x[12]=I[0]*Re+I[4]*Ce+I[8]*je+I[12],x[13]=I[1]*Re+I[5]*Ce+I[9]*je+I[13],x[14]=I[2]*Re+I[6]*Ce+I[10]*je+I[14],x[15]=I[3]*Re+I[7]*Ce+I[11]*je+I[15]):(P=I[1],O=I[2],V=I[3],G=I[4],J=I[5],ee=I[6],H=I[7],se=I[8],ue=I[9],we=I[10],Me=I[11],x[0]=C=I[0],x[1]=P,x[2]=O,x[3]=V,x[4]=G,x[5]=J,x[6]=ee,x[7]=H,x[8]=se,x[9]=ue,x[10]=we,x[11]=Me,x[12]=C*Re+G*Ce+se*je+I[12],x[13]=P*Re+J*Ce+ue*je+I[13],x[14]=O*Re+ee*Ce+we*je+I[14],x[15]=V*Re+H*Ce+Me*je+I[15]),x},re.scale=function(x,I,M){var C=M[0],P=M[1],O=M[2];return x[0]=I[0]*C,x[1]=I[1]*C,x[2]=I[2]*C,x[3]=I[3]*C,x[4]=I[4]*P,x[5]=I[5]*P,x[6]=I[6]*P,x[7]=I[7]*P,x[8]=I[8]*O,x[9]=I[9]*O,x[10]=I[10]*O,x[11]=I[11]*O,x[12]=I[12],x[13]=I[13],x[14]=I[14],x[15]=I[15],x},re.rotate=function(x,I,M,C){var P,O,V,G,J,ee,H,se,ue,we,Me,Re,Ce,je,Oe,He,Qe,it,ot,ct,bt,ut,Ot,$t,It=C[0],En=C[1],mn=C[2],an=Math.hypot(It,En,mn);return an<n.EPSILON?null:(It*=an=1/an,En*=an,mn*=an,P=Math.sin(M),O=Math.cos(M),J=I[1],ee=I[2],H=I[3],ue=I[5],we=I[6],Me=I[7],Ce=I[9],je=I[10],Oe=I[11],He=It*It*(V=1-O)+O,ot=It*En*V-mn*P,ct=En*En*V+O,bt=mn*En*V+It*P,ut=It*mn*V+En*P,Ot=En*mn*V-It*P,$t=mn*mn*V+O,x[0]=(G=I[0])*He+(se=I[4])*(Qe=En*It*V+mn*P)+(Re=I[8])*(it=mn*It*V-En*P),x[1]=J*He+ue*Qe+Ce*it,x[2]=ee*He+we*Qe+je*it,x[3]=H*He+Me*Qe+Oe*it,x[4]=G*ot+se*ct+Re*bt,x[5]=J*ot+ue*ct+Ce*bt,x[6]=ee*ot+we*ct+je*bt,x[7]=H*ot+Me*ct+Oe*bt,x[8]=G*ut+se*Ot+Re*$t,x[9]=J*ut+ue*Ot+Ce*$t,x[10]=ee*ut+we*Ot+je*$t,x[11]=H*ut+Me*Ot+Oe*$t,I!==x&&(x[12]=I[12],x[13]=I[13],x[14]=I[14],x[15]=I[15]),x)},re.rotateX=function(x,I,M){var C=Math.sin(M),P=Math.cos(M),O=I[4],V=I[5],G=I[6],J=I[7],ee=I[8],H=I[9],se=I[10],ue=I[11];return I!==x&&(x[0]=I[0],x[1]=I[1],x[2]=I[2],x[3]=I[3],x[12]=I[12],x[13]=I[13],x[14]=I[14],x[15]=I[15]),x[4]=O*P+ee*C,x[5]=V*P+H*C,x[6]=G*P+se*C,x[7]=J*P+ue*C,x[8]=ee*P-O*C,x[9]=H*P-V*C,x[10]=se*P-G*C,x[11]=ue*P-J*C,x},re.rotateY=function(x,I,M){var C=Math.sin(M),P=Math.cos(M),O=I[0],V=I[1],G=I[2],J=I[3],ee=I[8],H=I[9],se=I[10],ue=I[11];return I!==x&&(x[4]=I[4],x[5]=I[5],x[6]=I[6],x[7]=I[7],x[12]=I[12],x[13]=I[13],x[14]=I[14],x[15]=I[15]),x[0]=O*P-ee*C,x[1]=V*P-H*C,x[2]=G*P-se*C,x[3]=J*P-ue*C,x[8]=O*C+ee*P,x[9]=V*C+H*P,x[10]=G*C+se*P,x[11]=J*C+ue*P,x},re.rotateZ=function(x,I,M){var C=Math.sin(M),P=Math.cos(M),O=I[0],V=I[1],G=I[2],J=I[3],ee=I[4],H=I[5],se=I[6],ue=I[7];return I!==x&&(x[8]=I[8],x[9]=I[9],x[10]=I[10],x[11]=I[11],x[12]=I[12],x[13]=I[13],x[14]=I[14],x[15]=I[15]),x[0]=O*P+ee*C,x[1]=V*P+H*C,x[2]=G*P+se*C,x[3]=J*P+ue*C,x[4]=ee*P-O*C,x[5]=H*P-V*C,x[6]=se*P-G*C,x[7]=ue*P-J*C,x},re.fromTranslation=function(x,I){return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=I[0],x[13]=I[1],x[14]=I[2],x[15]=1,x},re.fromScaling=function(x,I){return x[0]=I[0],x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=I[1],x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=I[2],x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},re.fromRotation=function(x,I,M){var C,P,O,V=M[0],G=M[1],J=M[2],ee=Math.hypot(V,G,J);return ee<n.EPSILON?null:(V*=ee=1/ee,G*=ee,J*=ee,C=Math.sin(I),P=Math.cos(I),x[0]=V*V*(O=1-P)+P,x[1]=G*V*O+J*C,x[2]=J*V*O-G*C,x[3]=0,x[4]=V*G*O-J*C,x[5]=G*G*O+P,x[6]=J*G*O+V*C,x[7]=0,x[8]=V*J*O+G*C,x[9]=G*J*O-V*C,x[10]=J*J*O+P,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x)},re.fromXRotation=function(x,I){var M=Math.sin(I),C=Math.cos(I);return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=C,x[6]=M,x[7]=0,x[8]=0,x[9]=-M,x[10]=C,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},re.fromYRotation=function(x,I){var M=Math.sin(I),C=Math.cos(I);return x[0]=C,x[1]=0,x[2]=-M,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=M,x[9]=0,x[10]=C,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},re.fromZRotation=function(x,I){var M=Math.sin(I),C=Math.cos(I);return x[0]=C,x[1]=M,x[2]=0,x[3]=0,x[4]=-M,x[5]=C,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},re.fromRotationTranslation=f,re.fromQuat2=function(x,I){var M=new n.ARRAY_TYPE(3),C=-I[0],P=-I[1],O=-I[2],V=I[3],G=I[4],J=I[5],ee=I[6],H=I[7],se=C*C+P*P+O*O+V*V;return se>0?(M[0]=2*(G*V+H*C+J*O-ee*P)/se,M[1]=2*(J*V+H*P+ee*C-G*O)/se,M[2]=2*(ee*V+H*O+G*P-J*C)/se):(M[0]=2*(G*V+H*C+J*O-ee*P),M[1]=2*(J*V+H*P+ee*C-G*O),M[2]=2*(ee*V+H*O+G*P-J*C)),f(x,I,M),x},re.getTranslation=function(x,I){return x[0]=I[12],x[1]=I[13],x[2]=I[14],x},re.getScaling=_,re.getRotation=function(x,I){var M=new n.ARRAY_TYPE(3);_(M,I);var C=1/M[0],P=1/M[1],O=1/M[2],V=I[0]*C,G=I[1]*P,J=I[2]*O,ee=I[4]*C,H=I[5]*P,se=I[6]*O,ue=I[8]*C,we=I[9]*P,Me=I[10]*O,Re=V+H+Me,Ce=0;return Re>0?(Ce=2*Math.sqrt(Re+1),x[3]=.25*Ce,x[0]=(se-we)/Ce,x[1]=(ue-J)/Ce,x[2]=(G-ee)/Ce):V>H&&V>Me?(Ce=2*Math.sqrt(1+V-H-Me),x[3]=(se-we)/Ce,x[0]=.25*Ce,x[1]=(G+ee)/Ce,x[2]=(ue+J)/Ce):H>Me?(Ce=2*Math.sqrt(1+H-V-Me),x[3]=(ue-J)/Ce,x[0]=(G+ee)/Ce,x[1]=.25*Ce,x[2]=(se+we)/Ce):(Ce=2*Math.sqrt(1+Me-V-H),x[3]=(G-ee)/Ce,x[0]=(ue+J)/Ce,x[1]=(se+we)/Ce,x[2]=.25*Ce),x},re.fromRotationTranslationScale=function(x,I,M,C){var P=I[0],O=I[1],V=I[2],G=I[3],J=P+P,ee=O+O,H=V+V,se=P*J,ue=P*ee,we=P*H,Me=O*ee,Re=O*H,Ce=V*H,je=G*J,Oe=G*ee,He=G*H,Qe=C[0],it=C[1],ot=C[2];return x[0]=(1-(Me+Ce))*Qe,x[1]=(ue+He)*Qe,x[2]=(we-Oe)*Qe,x[3]=0,x[4]=(ue-He)*it,x[5]=(1-(se+Ce))*it,x[6]=(Re+je)*it,x[7]=0,x[8]=(we+Oe)*ot,x[9]=(Re-je)*ot,x[10]=(1-(se+Me))*ot,x[11]=0,x[12]=M[0],x[13]=M[1],x[14]=M[2],x[15]=1,x},re.fromRotationTranslationScaleOrigin=function(x,I,M,C,P){var O=I[0],V=I[1],G=I[2],J=I[3],ee=O+O,H=V+V,se=G+G,ue=O*ee,we=O*H,Me=O*se,Re=V*H,Ce=V*se,je=G*se,Oe=J*ee,He=J*H,Qe=J*se,it=C[0],ot=C[1],ct=C[2],bt=P[0],ut=P[1],Ot=P[2],$t=(1-(Re+je))*it,It=(we+Qe)*it,En=(Me-He)*it,mn=(we-Qe)*ot,an=(1-(ue+je))*ot,Wt=(Ce+Oe)*ot,Vn=(Me+He)*ct,Tn=(Ce-Oe)*ct,An=(1-(ue+Re))*ct;return x[0]=$t,x[1]=It,x[2]=En,x[3]=0,x[4]=mn,x[5]=an,x[6]=Wt,x[7]=0,x[8]=Vn,x[9]=Tn,x[10]=An,x[11]=0,x[12]=M[0]+bt-($t*bt+mn*ut+Vn*Ot),x[13]=M[1]+ut-(It*bt+an*ut+Tn*Ot),x[14]=M[2]+Ot-(En*bt+Wt*ut+An*Ot),x[15]=1,x},re.fromQuat=function(x,I){var M=I[0],C=I[1],P=I[2],O=I[3],V=M+M,G=C+C,J=P+P,ee=M*V,H=C*V,se=C*G,ue=P*V,we=P*G,Me=P*J,Re=O*V,Ce=O*G,je=O*J;return x[0]=1-se-Me,x[1]=H+je,x[2]=ue-Ce,x[3]=0,x[4]=H-je,x[5]=1-ee-Me,x[6]=we+Re,x[7]=0,x[8]=ue+Ce,x[9]=we-Re,x[10]=1-ee-se,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x},re.frustum=function(x,I,M,C,P,O,V){var G=1/(M-I),J=1/(P-C),ee=1/(O-V);return x[0]=2*O*G,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=2*O*J,x[6]=0,x[7]=0,x[8]=(M+I)*G,x[9]=(P+C)*J,x[10]=(V+O)*ee,x[11]=-1,x[12]=0,x[13]=0,x[14]=V*O*2*ee,x[15]=0,x},re.perspectiveNO=S,re.perspectiveZO=function(x,I,M,C,P){var O,V=1/Math.tan(I/2);return x[0]=V/M,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=V,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=-1,x[12]=0,x[13]=0,x[15]=0,P!=null&&P!==1/0?(x[10]=P*(O=1/(C-P)),x[14]=P*C*O):(x[10]=-1,x[14]=-C),x},re.perspectiveFromFieldOfView=function(x,I,M,C){var P=Math.tan(I.upDegrees*Math.PI/180),O=Math.tan(I.downDegrees*Math.PI/180),V=Math.tan(I.leftDegrees*Math.PI/180),G=Math.tan(I.rightDegrees*Math.PI/180),J=2/(V+G),ee=2/(P+O);return x[0]=J,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=ee,x[6]=0,x[7]=0,x[8]=-(V-G)*J*.5,x[9]=(P-O)*ee*.5,x[10]=C/(M-C),x[11]=-1,x[12]=0,x[13]=0,x[14]=C*M/(M-C),x[15]=0,x},re.orthoNO=A,re.orthoZO=function(x,I,M,C,P,O,V){var G=1/(I-M),J=1/(C-P),ee=1/(O-V);return x[0]=-2*G,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=-2*J,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=ee,x[11]=0,x[12]=(I+M)*G,x[13]=(P+C)*J,x[14]=O*ee,x[15]=1,x},re.lookAt=function(x,I,M,C){var P,O,V,G,J,ee,H,se,ue,we,Me=I[0],Re=I[1],Ce=I[2],je=C[0],Oe=C[1],He=C[2],Qe=M[0],it=M[1],ot=M[2];return Math.abs(Me-Qe)<n.EPSILON&&Math.abs(Re-it)<n.EPSILON&&Math.abs(Ce-ot)<n.EPSILON?h(x):(H=Me-Qe,se=Re-it,ue=Ce-ot,P=Oe*(ue*=we=1/Math.hypot(H,se,ue))-He*(se*=we),O=He*(H*=we)-je*ue,V=je*se-Oe*H,(we=Math.hypot(P,O,V))?(P*=we=1/we,O*=we,V*=we):(P=0,O=0,V=0),G=se*V-ue*O,J=ue*P-H*V,ee=H*O-se*P,(we=Math.hypot(G,J,ee))?(G*=we=1/we,J*=we,ee*=we):(G=0,J=0,ee=0),x[0]=P,x[1]=G,x[2]=H,x[3]=0,x[4]=O,x[5]=J,x[6]=se,x[7]=0,x[8]=V,x[9]=ee,x[10]=ue,x[11]=0,x[12]=-(P*Me+O*Re+V*Ce),x[13]=-(G*Me+J*Re+ee*Ce),x[14]=-(H*Me+se*Re+ue*Ce),x[15]=1,x)},re.targetTo=function(x,I,M,C){var P=I[0],O=I[1],V=I[2],G=C[0],J=C[1],ee=C[2],H=P-M[0],se=O-M[1],ue=V-M[2],we=H*H+se*se+ue*ue;we>0&&(H*=we=1/Math.sqrt(we),se*=we,ue*=we);var Me=J*ue-ee*se,Re=ee*H-G*ue,Ce=G*se-J*H;return(we=Me*Me+Re*Re+Ce*Ce)>0&&(Me*=we=1/Math.sqrt(we),Re*=we,Ce*=we),x[0]=Me,x[1]=Re,x[2]=Ce,x[3]=0,x[4]=se*Ce-ue*Re,x[5]=ue*Me-H*Ce,x[6]=H*Re-se*Me,x[7]=0,x[8]=H,x[9]=se,x[10]=ue,x[11]=0,x[12]=P,x[13]=O,x[14]=V,x[15]=1,x},re.str=function(x){return"mat4("+x[0]+", "+x[1]+", "+x[2]+", "+x[3]+", "+x[4]+", "+x[5]+", "+x[6]+", "+x[7]+", "+x[8]+", "+x[9]+", "+x[10]+", "+x[11]+", "+x[12]+", "+x[13]+", "+x[14]+", "+x[15]+")"},re.frob=function(x){return Math.hypot(x[0],x[1],x[2],x[3],x[4],x[5],x[6],x[7],x[8],x[9],x[10],x[11],x[12],x[13],x[14],x[15])},re.add=function(x,I,M){return x[0]=I[0]+M[0],x[1]=I[1]+M[1],x[2]=I[2]+M[2],x[3]=I[3]+M[3],x[4]=I[4]+M[4],x[5]=I[5]+M[5],x[6]=I[6]+M[6],x[7]=I[7]+M[7],x[8]=I[8]+M[8],x[9]=I[9]+M[9],x[10]=I[10]+M[10],x[11]=I[11]+M[11],x[12]=I[12]+M[12],x[13]=I[13]+M[13],x[14]=I[14]+M[14],x[15]=I[15]+M[15],x},re.subtract=k,re.multiplyScalar=function(x,I,M){return x[0]=I[0]*M,x[1]=I[1]*M,x[2]=I[2]*M,x[3]=I[3]*M,x[4]=I[4]*M,x[5]=I[5]*M,x[6]=I[6]*M,x[7]=I[7]*M,x[8]=I[8]*M,x[9]=I[9]*M,x[10]=I[10]*M,x[11]=I[11]*M,x[12]=I[12]*M,x[13]=I[13]*M,x[14]=I[14]*M,x[15]=I[15]*M,x},re.multiplyScalarAndAdd=function(x,I,M,C){return x[0]=I[0]+M[0]*C,x[1]=I[1]+M[1]*C,x[2]=I[2]+M[2]*C,x[3]=I[3]+M[3]*C,x[4]=I[4]+M[4]*C,x[5]=I[5]+M[5]*C,x[6]=I[6]+M[6]*C,x[7]=I[7]+M[7]*C,x[8]=I[8]+M[8]*C,x[9]=I[9]+M[9]*C,x[10]=I[10]+M[10]*C,x[11]=I[11]+M[11]*C,x[12]=I[12]+M[12]*C,x[13]=I[13]+M[13]*C,x[14]=I[14]+M[14]*C,x[15]=I[15]+M[15]*C,x},re.exactEquals=function(x,I){return x[0]===I[0]&&x[1]===I[1]&&x[2]===I[2]&&x[3]===I[3]&&x[4]===I[4]&&x[5]===I[5]&&x[6]===I[6]&&x[7]===I[7]&&x[8]===I[8]&&x[9]===I[9]&&x[10]===I[10]&&x[11]===I[11]&&x[12]===I[12]&&x[13]===I[13]&&x[14]===I[14]&&x[15]===I[15]},re.equals=function(x,I){var M=x[0],C=x[1],P=x[2],O=x[3],V=x[4],G=x[5],J=x[6],ee=x[7],H=x[8],se=x[9],ue=x[10],we=x[11],Me=x[12],Re=x[13],Ce=x[14],je=x[15],Oe=I[0],He=I[1],Qe=I[2],it=I[3],ot=I[4],ct=I[5],bt=I[6],ut=I[7],Ot=I[8],$t=I[9],It=I[10],En=I[11],mn=I[12],an=I[13],Wt=I[14],Vn=I[15];return Math.abs(M-Oe)<=n.EPSILON*Math.max(1,Math.abs(M),Math.abs(Oe))&&Math.abs(C-He)<=n.EPSILON*Math.max(1,Math.abs(C),Math.abs(He))&&Math.abs(P-Qe)<=n.EPSILON*Math.max(1,Math.abs(P),Math.abs(Qe))&&Math.abs(O-it)<=n.EPSILON*Math.max(1,Math.abs(O),Math.abs(it))&&Math.abs(V-ot)<=n.EPSILON*Math.max(1,Math.abs(V),Math.abs(ot))&&Math.abs(G-ct)<=n.EPSILON*Math.max(1,Math.abs(G),Math.abs(ct))&&Math.abs(J-bt)<=n.EPSILON*Math.max(1,Math.abs(J),Math.abs(bt))&&Math.abs(ee-ut)<=n.EPSILON*Math.max(1,Math.abs(ee),Math.abs(ut))&&Math.abs(H-Ot)<=n.EPSILON*Math.max(1,Math.abs(H),Math.abs(Ot))&&Math.abs(se-$t)<=n.EPSILON*Math.max(1,Math.abs(se),Math.abs($t))&&Math.abs(ue-It)<=n.EPSILON*Math.max(1,Math.abs(ue),Math.abs(It))&&Math.abs(we-En)<=n.EPSILON*Math.max(1,Math.abs(we),Math.abs(En))&&Math.abs(Me-mn)<=n.EPSILON*Math.max(1,Math.abs(Me),Math.abs(mn))&&Math.abs(Re-an)<=n.EPSILON*Math.max(1,Math.abs(Re),Math.abs(an))&&Math.abs(Ce-Wt)<=n.EPSILON*Math.max(1,Math.abs(Ce),Math.abs(Wt))&&Math.abs(je-Vn)<=n.EPSILON*Math.max(1,Math.abs(je),Math.abs(Vn))},re.sub=re.mul=re.ortho=re.perspective=void 0;var n=function(x,I){if(x&&x.__esModule)return x;if(x===null||u(x)!=="object"&&typeof x!="function")return{default:x};var M=s(void 0);if(M&&M.has(x))return M.get(x);var C={},P=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var O in x)if(O!=="default"&&Object.prototype.hasOwnProperty.call(x,O)){var V=P?Object.getOwnPropertyDescriptor(x,O):null;V&&(V.get||V.set)?Object.defineProperty(C,O,V):C[O]=x[O]}return C.default=x,M&&M.set(x,C),C}($());function s(x){if(typeof WeakMap!="function")return null;var I=new WeakMap,M=new WeakMap;return(s=function(C){return C?M:I})(x)}function h(x){return x[0]=1,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=1,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=1,x[11]=0,x[12]=0,x[13]=0,x[14]=0,x[15]=1,x}function g(x,I,M){var C=I[0],P=I[1],O=I[2],V=I[3],G=I[4],J=I[5],ee=I[6],H=I[7],se=I[8],ue=I[9],we=I[10],Me=I[11],Re=I[12],Ce=I[13],je=I[14],Oe=I[15],He=M[0],Qe=M[1],it=M[2],ot=M[3];return x[0]=He*C+Qe*G+it*se+ot*Re,x[1]=He*P+Qe*J+it*ue+ot*Ce,x[2]=He*O+Qe*ee+it*we+ot*je,x[3]=He*V+Qe*H+it*Me+ot*Oe,x[4]=(He=M[4])*C+(Qe=M[5])*G+(it=M[6])*se+(ot=M[7])*Re,x[5]=He*P+Qe*J+it*ue+ot*Ce,x[6]=He*O+Qe*ee+it*we+ot*je,x[7]=He*V+Qe*H+it*Me+ot*Oe,x[8]=(He=M[8])*C+(Qe=M[9])*G+(it=M[10])*se+(ot=M[11])*Re,x[9]=He*P+Qe*J+it*ue+ot*Ce,x[10]=He*O+Qe*ee+it*we+ot*je,x[11]=He*V+Qe*H+it*Me+ot*Oe,x[12]=(He=M[12])*C+(Qe=M[13])*G+(it=M[14])*se+(ot=M[15])*Re,x[13]=He*P+Qe*J+it*ue+ot*Ce,x[14]=He*O+Qe*ee+it*we+ot*je,x[15]=He*V+Qe*H+it*Me+ot*Oe,x}function f(x,I,M){var C=I[0],P=I[1],O=I[2],V=I[3],G=C+C,J=P+P,ee=O+O,H=C*G,se=C*J,ue=C*ee,we=P*J,Me=P*ee,Re=O*ee,Ce=V*G,je=V*J,Oe=V*ee;return x[0]=1-(we+Re),x[1]=se+Oe,x[2]=ue-je,x[3]=0,x[4]=se-Oe,x[5]=1-(H+Re),x[6]=Me+Ce,x[7]=0,x[8]=ue+je,x[9]=Me-Ce,x[10]=1-(H+we),x[11]=0,x[12]=M[0],x[13]=M[1],x[14]=M[2],x[15]=1,x}function _(x,I){var M=I[4],C=I[5],P=I[6],O=I[8],V=I[9],G=I[10];return x[0]=Math.hypot(I[0],I[1],I[2]),x[1]=Math.hypot(M,C,P),x[2]=Math.hypot(O,V,G),x}function S(x,I,M,C,P){var O,V=1/Math.tan(I/2);return x[0]=V/M,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=V,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[11]=-1,x[12]=0,x[13]=0,x[15]=0,P!=null&&P!==1/0?(x[10]=(P+C)*(O=1/(C-P)),x[14]=2*P*C*O):(x[10]=-1,x[14]=-2*C),x}function A(x,I,M,C,P,O,V){var G=1/(I-M),J=1/(C-P),ee=1/(O-V);return x[0]=-2*G,x[1]=0,x[2]=0,x[3]=0,x[4]=0,x[5]=-2*J,x[6]=0,x[7]=0,x[8]=0,x[9]=0,x[10]=2*ee,x[11]=0,x[12]=(I+M)*G,x[13]=(P+C)*J,x[14]=(V+O)*ee,x[15]=1,x}function k(x,I,M){return x[0]=I[0]-M[0],x[1]=I[1]-M[1],x[2]=I[2]-M[2],x[3]=I[3]-M[3],x[4]=I[4]-M[4],x[5]=I[5]-M[5],x[6]=I[6]-M[6],x[7]=I[7]-M[7],x[8]=I[8]-M[8],x[9]=I[9]-M[9],x[10]=I[10]-M[10],x[11]=I[11]-M[11],x[12]=I[12]-M[12],x[13]=I[13]-M[13],x[14]=I[14]-M[14],x[15]=I[15]-M[15],x}return re.perspective=S,re.ortho=A,re.mul=g,re.sub=k,re}var ie,te={},ae={};function pe(){if(ie)return ae;function u(P){return u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(O){return typeof O}:function(O){return O&&typeof Symbol=="function"&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O},u(P)}ie=1,Object.defineProperty(ae,"__esModule",{value:!0}),ae.create=h,ae.clone=function(P){var O=new n.ARRAY_TYPE(3);return O[0]=P[0],O[1]=P[1],O[2]=P[2],O},ae.length=g,ae.fromValues=function(P,O,V){var G=new n.ARRAY_TYPE(3);return G[0]=P,G[1]=O,G[2]=V,G},ae.copy=function(P,O){return P[0]=O[0],P[1]=O[1],P[2]=O[2],P},ae.set=function(P,O,V,G){return P[0]=O,P[1]=V,P[2]=G,P},ae.add=function(P,O,V){return P[0]=O[0]+V[0],P[1]=O[1]+V[1],P[2]=O[2]+V[2],P},ae.subtract=f,ae.multiply=_,ae.divide=S,ae.ceil=function(P,O){return P[0]=Math.ceil(O[0]),P[1]=Math.ceil(O[1]),P[2]=Math.ceil(O[2]),P},ae.floor=function(P,O){return P[0]=Math.floor(O[0]),P[1]=Math.floor(O[1]),P[2]=Math.floor(O[2]),P},ae.min=function(P,O,V){return P[0]=Math.min(O[0],V[0]),P[1]=Math.min(O[1],V[1]),P[2]=Math.min(O[2],V[2]),P},ae.max=function(P,O,V){return P[0]=Math.max(O[0],V[0]),P[1]=Math.max(O[1],V[1]),P[2]=Math.max(O[2],V[2]),P},ae.round=function(P,O){return P[0]=Math.round(O[0]),P[1]=Math.round(O[1]),P[2]=Math.round(O[2]),P},ae.scale=function(P,O,V){return P[0]=O[0]*V,P[1]=O[1]*V,P[2]=O[2]*V,P},ae.scaleAndAdd=function(P,O,V,G){return P[0]=O[0]+V[0]*G,P[1]=O[1]+V[1]*G,P[2]=O[2]+V[2]*G,P},ae.distance=A,ae.squaredDistance=k,ae.squaredLength=x,ae.negate=function(P,O){return P[0]=-O[0],P[1]=-O[1],P[2]=-O[2],P},ae.inverse=function(P,O){return P[0]=1/O[0],P[1]=1/O[1],P[2]=1/O[2],P},ae.normalize=function(P,O){var V=O[0],G=O[1],J=O[2],ee=V*V+G*G+J*J;return ee>0&&(ee=1/Math.sqrt(ee)),P[0]=O[0]*ee,P[1]=O[1]*ee,P[2]=O[2]*ee,P},ae.dot=I,ae.cross=function(P,O,V){var G=O[0],J=O[1],ee=O[2],H=V[0],se=V[1],ue=V[2];return P[0]=J*ue-ee*se,P[1]=ee*H-G*ue,P[2]=G*se-J*H,P},ae.lerp=function(P,O,V,G){var J=O[0],ee=O[1],H=O[2];return P[0]=J+G*(V[0]-J),P[1]=ee+G*(V[1]-ee),P[2]=H+G*(V[2]-H),P},ae.hermite=function(P,O,V,G,J,ee){var H=ee*ee,se=H*(2*ee-3)+1,ue=H*(ee-2)+ee,we=H*(ee-1),Me=H*(3-2*ee);return P[0]=O[0]*se+V[0]*ue+G[0]*we+J[0]*Me,P[1]=O[1]*se+V[1]*ue+G[1]*we+J[1]*Me,P[2]=O[2]*se+V[2]*ue+G[2]*we+J[2]*Me,P},ae.bezier=function(P,O,V,G,J,ee){var H=1-ee,se=H*H,ue=ee*ee,we=se*H,Me=3*ee*se,Re=3*ue*H,Ce=ue*ee;return P[0]=O[0]*we+V[0]*Me+G[0]*Re+J[0]*Ce,P[1]=O[1]*we+V[1]*Me+G[1]*Re+J[1]*Ce,P[2]=O[2]*we+V[2]*Me+G[2]*Re+J[2]*Ce,P},ae.random=function(P,O){O=O||1;var V=2*n.RANDOM()*Math.PI,G=2*n.RANDOM()-1,J=Math.sqrt(1-G*G)*O;return P[0]=Math.cos(V)*J,P[1]=Math.sin(V)*J,P[2]=G*O,P},ae.transformMat4=function(P,O,V){var G=O[0],J=O[1],ee=O[2],H=V[3]*G+V[7]*J+V[11]*ee+V[15];return P[0]=(V[0]*G+V[4]*J+V[8]*ee+V[12])/(H=H||1),P[1]=(V[1]*G+V[5]*J+V[9]*ee+V[13])/H,P[2]=(V[2]*G+V[6]*J+V[10]*ee+V[14])/H,P},ae.transformMat3=function(P,O,V){var G=O[0],J=O[1],ee=O[2];return P[0]=G*V[0]+J*V[3]+ee*V[6],P[1]=G*V[1]+J*V[4]+ee*V[7],P[2]=G*V[2]+J*V[5]+ee*V[8],P},ae.transformQuat=function(P,O,V){var G=V[0],J=V[1],ee=V[2],H=O[0],se=O[1],ue=O[2],we=J*ue-ee*se,Me=ee*H-G*ue,Re=G*se-J*H,Ce=J*Re-ee*Me,je=ee*we-G*Re,Oe=G*Me-J*we,He=2*V[3];return Me*=He,Re*=He,je*=2,Oe*=2,P[0]=H+(we*=He)+(Ce*=2),P[1]=se+Me+je,P[2]=ue+Re+Oe,P},ae.rotateX=function(P,O,V,G){var J=[],ee=[];return J[0]=O[0]-V[0],J[1]=O[1]-V[1],J[2]=O[2]-V[2],ee[0]=J[0],ee[1]=J[1]*Math.cos(G)-J[2]*Math.sin(G),ee[2]=J[1]*Math.sin(G)+J[2]*Math.cos(G),P[0]=ee[0]+V[0],P[1]=ee[1]+V[1],P[2]=ee[2]+V[2],P},ae.rotateY=function(P,O,V,G){var J=[],ee=[];return J[0]=O[0]-V[0],J[1]=O[1]-V[1],J[2]=O[2]-V[2],ee[0]=J[2]*Math.sin(G)+J[0]*Math.cos(G),ee[1]=J[1],ee[2]=J[2]*Math.cos(G)-J[0]*Math.sin(G),P[0]=ee[0]+V[0],P[1]=ee[1]+V[1],P[2]=ee[2]+V[2],P},ae.rotateZ=function(P,O,V,G){var J=[],ee=[];return J[0]=O[0]-V[0],J[1]=O[1]-V[1],J[2]=O[2]-V[2],ee[0]=J[0]*Math.cos(G)-J[1]*Math.sin(G),ee[1]=J[0]*Math.sin(G)+J[1]*Math.cos(G),ee[2]=J[2],P[0]=ee[0]+V[0],P[1]=ee[1]+V[1],P[2]=ee[2]+V[2],P},ae.angle=function(P,O){var V=P[0],G=P[1],J=P[2],ee=O[0],H=O[1],se=O[2],ue=Math.sqrt(V*V+G*G+J*J)*Math.sqrt(ee*ee+H*H+se*se),we=ue&&I(P,O)/ue;return Math.acos(Math.min(Math.max(we,-1),1))},ae.zero=function(P){return P[0]=0,P[1]=0,P[2]=0,P},ae.str=function(P){return"vec3("+P[0]+", "+P[1]+", "+P[2]+")"},ae.exactEquals=function(P,O){return P[0]===O[0]&&P[1]===O[1]&&P[2]===O[2]},ae.equals=function(P,O){var V=P[0],G=P[1],J=P[2],ee=O[0],H=O[1],se=O[2];return Math.abs(V-ee)<=n.EPSILON*Math.max(1,Math.abs(V),Math.abs(ee))&&Math.abs(G-H)<=n.EPSILON*Math.max(1,Math.abs(G),Math.abs(H))&&Math.abs(J-se)<=n.EPSILON*Math.max(1,Math.abs(J),Math.abs(se))},ae.forEach=ae.sqrLen=ae.len=ae.sqrDist=ae.dist=ae.div=ae.mul=ae.sub=void 0;var n=function(P,O){if(P&&P.__esModule)return P;if(P===null||u(P)!=="object"&&typeof P!="function")return{default:P};var V=s(void 0);if(V&&V.has(P))return V.get(P);var G={},J=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ee in P)if(ee!=="default"&&Object.prototype.hasOwnProperty.call(P,ee)){var H=J?Object.getOwnPropertyDescriptor(P,ee):null;H&&(H.get||H.set)?Object.defineProperty(G,ee,H):G[ee]=P[ee]}return G.default=P,V&&V.set(P,G),G}($());function s(P){if(typeof WeakMap!="function")return null;var O=new WeakMap,V=new WeakMap;return(s=function(G){return G?V:O})(P)}function h(){var P=new n.ARRAY_TYPE(3);return n.ARRAY_TYPE!=Float32Array&&(P[0]=0,P[1]=0,P[2]=0),P}function g(P){return Math.hypot(P[0],P[1],P[2])}function f(P,O,V){return P[0]=O[0]-V[0],P[1]=O[1]-V[1],P[2]=O[2]-V[2],P}function _(P,O,V){return P[0]=O[0]*V[0],P[1]=O[1]*V[1],P[2]=O[2]*V[2],P}function S(P,O,V){return P[0]=O[0]/V[0],P[1]=O[1]/V[1],P[2]=O[2]/V[2],P}function A(P,O){return Math.hypot(O[0]-P[0],O[1]-P[1],O[2]-P[2])}function k(P,O){var V=O[0]-P[0],G=O[1]-P[1],J=O[2]-P[2];return V*V+G*G+J*J}function x(P){var O=P[0],V=P[1],G=P[2];return O*O+V*V+G*G}function I(P,O){return P[0]*O[0]+P[1]*O[1]+P[2]*O[2]}ae.sub=f,ae.mul=_,ae.div=S,ae.dist=A,ae.sqrDist=k,ae.len=g,ae.sqrLen=x;var M,C=(M=h(),function(P,O,V,G,J,ee){var H,se;for(O||(O=3),V||(V=0),se=G?Math.min(G*O+V,P.length):P.length,H=V;H<se;H+=O)M[0]=P[H],M[1]=P[H+1],M[2]=P[H+2],J(M,M,ee),P[H]=M[0],P[H+1]=M[1],P[H+2]=M[2];return P});return ae.forEach=C,ae}var Le,tt,Je={};function Mt(){if(Le)return Je;function u(C){return u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(P){return typeof P}:function(P){return P&&typeof Symbol=="function"&&P.constructor===Symbol&&P!==Symbol.prototype?"symbol":typeof P},u(C)}Le=1,Object.defineProperty(Je,"__esModule",{value:!0}),Je.create=h,Je.clone=function(C){var P=new n.ARRAY_TYPE(4);return P[0]=C[0],P[1]=C[1],P[2]=C[2],P[3]=C[3],P},Je.fromValues=function(C,P,O,V){var G=new n.ARRAY_TYPE(4);return G[0]=C,G[1]=P,G[2]=O,G[3]=V,G},Je.copy=function(C,P){return C[0]=P[0],C[1]=P[1],C[2]=P[2],C[3]=P[3],C},Je.set=function(C,P,O,V,G){return C[0]=P,C[1]=O,C[2]=V,C[3]=G,C},Je.add=function(C,P,O){return C[0]=P[0]+O[0],C[1]=P[1]+O[1],C[2]=P[2]+O[2],C[3]=P[3]+O[3],C},Je.subtract=g,Je.multiply=f,Je.divide=_,Je.ceil=function(C,P){return C[0]=Math.ceil(P[0]),C[1]=Math.ceil(P[1]),C[2]=Math.ceil(P[2]),C[3]=Math.ceil(P[3]),C},Je.floor=function(C,P){return C[0]=Math.floor(P[0]),C[1]=Math.floor(P[1]),C[2]=Math.floor(P[2]),C[3]=Math.floor(P[3]),C},Je.min=function(C,P,O){return C[0]=Math.min(P[0],O[0]),C[1]=Math.min(P[1],O[1]),C[2]=Math.min(P[2],O[2]),C[3]=Math.min(P[3],O[3]),C},Je.max=function(C,P,O){return C[0]=Math.max(P[0],O[0]),C[1]=Math.max(P[1],O[1]),C[2]=Math.max(P[2],O[2]),C[3]=Math.max(P[3],O[3]),C},Je.round=function(C,P){return C[0]=Math.round(P[0]),C[1]=Math.round(P[1]),C[2]=Math.round(P[2]),C[3]=Math.round(P[3]),C},Je.scale=function(C,P,O){return C[0]=P[0]*O,C[1]=P[1]*O,C[2]=P[2]*O,C[3]=P[3]*O,C},Je.scaleAndAdd=function(C,P,O,V){return C[0]=P[0]+O[0]*V,C[1]=P[1]+O[1]*V,C[2]=P[2]+O[2]*V,C[3]=P[3]+O[3]*V,C},Je.distance=S,Je.squaredDistance=A,Je.length=k,Je.squaredLength=x,Je.negate=function(C,P){return C[0]=-P[0],C[1]=-P[1],C[2]=-P[2],C[3]=-P[3],C},Je.inverse=function(C,P){return C[0]=1/P[0],C[1]=1/P[1],C[2]=1/P[2],C[3]=1/P[3],C},Je.normalize=function(C,P){var O=P[0],V=P[1],G=P[2],J=P[3],ee=O*O+V*V+G*G+J*J;return ee>0&&(ee=1/Math.sqrt(ee)),C[0]=O*ee,C[1]=V*ee,C[2]=G*ee,C[3]=J*ee,C},Je.dot=function(C,P){return C[0]*P[0]+C[1]*P[1]+C[2]*P[2]+C[3]*P[3]},Je.cross=function(C,P,O,V){var G=O[0]*V[1]-O[1]*V[0],J=O[0]*V[2]-O[2]*V[0],ee=O[0]*V[3]-O[3]*V[0],H=O[1]*V[2]-O[2]*V[1],se=O[1]*V[3]-O[3]*V[1],ue=O[2]*V[3]-O[3]*V[2],we=P[0],Me=P[1],Re=P[2],Ce=P[3];return C[0]=Me*ue-Re*se+Ce*H,C[1]=-we*ue+Re*ee-Ce*J,C[2]=we*se-Me*ee+Ce*G,C[3]=-we*H+Me*J-Re*G,C},Je.lerp=function(C,P,O,V){var G=P[0],J=P[1],ee=P[2],H=P[3];return C[0]=G+V*(O[0]-G),C[1]=J+V*(O[1]-J),C[2]=ee+V*(O[2]-ee),C[3]=H+V*(O[3]-H),C},Je.random=function(C,P){var O,V,G,J,ee,H;P=P||1;do ee=(O=2*n.RANDOM()-1)*O+(V=2*n.RANDOM()-1)*V;while(ee>=1);do H=(G=2*n.RANDOM()-1)*G+(J=2*n.RANDOM()-1)*J;while(H>=1);var se=Math.sqrt((1-ee)/H);return C[0]=P*O,C[1]=P*V,C[2]=P*G*se,C[3]=P*J*se,C},Je.transformMat4=function(C,P,O){var V=P[0],G=P[1],J=P[2],ee=P[3];return C[0]=O[0]*V+O[4]*G+O[8]*J+O[12]*ee,C[1]=O[1]*V+O[5]*G+O[9]*J+O[13]*ee,C[2]=O[2]*V+O[6]*G+O[10]*J+O[14]*ee,C[3]=O[3]*V+O[7]*G+O[11]*J+O[15]*ee,C},Je.transformQuat=function(C,P,O){var V=P[0],G=P[1],J=P[2],ee=O[0],H=O[1],se=O[2],ue=O[3],we=ue*V+H*J-se*G,Me=ue*G+se*V-ee*J,Re=ue*J+ee*G-H*V,Ce=-ee*V-H*G-se*J;return C[0]=we*ue+Ce*-ee+Me*-se-Re*-H,C[1]=Me*ue+Ce*-H+Re*-ee-we*-se,C[2]=Re*ue+Ce*-se+we*-H-Me*-ee,C[3]=P[3],C},Je.zero=function(C){return C[0]=0,C[1]=0,C[2]=0,C[3]=0,C},Je.str=function(C){return"vec4("+C[0]+", "+C[1]+", "+C[2]+", "+C[3]+")"},Je.exactEquals=function(C,P){return C[0]===P[0]&&C[1]===P[1]&&C[2]===P[2]&&C[3]===P[3]},Je.equals=function(C,P){var O=C[0],V=C[1],G=C[2],J=C[3],ee=P[0],H=P[1],se=P[2],ue=P[3];return Math.abs(O-ee)<=n.EPSILON*Math.max(1,Math.abs(O),Math.abs(ee))&&Math.abs(V-H)<=n.EPSILON*Math.max(1,Math.abs(V),Math.abs(H))&&Math.abs(G-se)<=n.EPSILON*Math.max(1,Math.abs(G),Math.abs(se))&&Math.abs(J-ue)<=n.EPSILON*Math.max(1,Math.abs(J),Math.abs(ue))},Je.forEach=Je.sqrLen=Je.len=Je.sqrDist=Je.dist=Je.div=Je.mul=Je.sub=void 0;var n=function(C,P){if(C&&C.__esModule)return C;if(C===null||u(C)!=="object"&&typeof C!="function")return{default:C};var O=s(void 0);if(O&&O.has(C))return O.get(C);var V={},G=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var J in C)if(J!=="default"&&Object.prototype.hasOwnProperty.call(C,J)){var ee=G?Object.getOwnPropertyDescriptor(C,J):null;ee&&(ee.get||ee.set)?Object.defineProperty(V,J,ee):V[J]=C[J]}return V.default=C,O&&O.set(C,V),V}($());function s(C){if(typeof WeakMap!="function")return null;var P=new WeakMap,O=new WeakMap;return(s=function(V){return V?O:P})(C)}function h(){var C=new n.ARRAY_TYPE(4);return n.ARRAY_TYPE!=Float32Array&&(C[0]=0,C[1]=0,C[2]=0,C[3]=0),C}function g(C,P,O){return C[0]=P[0]-O[0],C[1]=P[1]-O[1],C[2]=P[2]-O[2],C[3]=P[3]-O[3],C}function f(C,P,O){return C[0]=P[0]*O[0],C[1]=P[1]*O[1],C[2]=P[2]*O[2],C[3]=P[3]*O[3],C}function _(C,P,O){return C[0]=P[0]/O[0],C[1]=P[1]/O[1],C[2]=P[2]/O[2],C[3]=P[3]/O[3],C}function S(C,P){return Math.hypot(P[0]-C[0],P[1]-C[1],P[2]-C[2],P[3]-C[3])}function A(C,P){var O=P[0]-C[0],V=P[1]-C[1],G=P[2]-C[2],J=P[3]-C[3];return O*O+V*V+G*G+J*J}function k(C){return Math.hypot(C[0],C[1],C[2],C[3])}function x(C){var P=C[0],O=C[1],V=C[2],G=C[3];return P*P+O*O+V*V+G*G}Je.sub=g,Je.mul=f,Je.div=_,Je.dist=S,Je.sqrDist=A,Je.len=k,Je.sqrLen=x;var I,M=(I=h(),function(C,P,O,V,G,J){var ee,H;for(P||(P=4),O||(O=0),H=V?Math.min(V*P+O,C.length):C.length,ee=O;ee<H;ee+=P)I[0]=C[ee],I[1]=C[ee+1],I[2]=C[ee+2],I[3]=C[ee+3],G(I,I,J),C[ee]=I[0],C[ee+1]=I[1],C[ee+2]=I[2],C[ee+3]=I[3];return C});return Je.forEach=M,Je}function Lt(){if(tt)return te;function u(Oe){return u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(He){return typeof He}:function(He){return He&&typeof Symbol=="function"&&He.constructor===Symbol&&He!==Symbol.prototype?"symbol":typeof He},u(Oe)}tt=1,Object.defineProperty(te,"__esModule",{value:!0}),te.create=S,te.identity=function(Oe){return Oe[0]=0,Oe[1]=0,Oe[2]=0,Oe[3]=1,Oe},te.setAxisAngle=A,te.getAxisAngle=function(Oe,He){var Qe=2*Math.acos(He[3]),it=Math.sin(Qe/2);return it>n.EPSILON?(Oe[0]=He[0]/it,Oe[1]=He[1]/it,Oe[2]=He[2]/it):(Oe[0]=1,Oe[1]=0,Oe[2]=0),Qe},te.getAngle=function(Oe,He){var Qe=O(Oe,He);return Math.acos(2*Qe*Qe-1)},te.multiply=k,te.rotateX=function(Oe,He,Qe){Qe*=.5;var it=He[0],ot=He[1],ct=He[2],bt=He[3],ut=Math.sin(Qe),Ot=Math.cos(Qe);return Oe[0]=it*Ot+bt*ut,Oe[1]=ot*Ot+ct*ut,Oe[2]=ct*Ot-ot*ut,Oe[3]=bt*Ot-it*ut,Oe},te.rotateY=function(Oe,He,Qe){Qe*=.5;var it=He[0],ot=He[1],ct=He[2],bt=He[3],ut=Math.sin(Qe),Ot=Math.cos(Qe);return Oe[0]=it*Ot-ct*ut,Oe[1]=ot*Ot+bt*ut,Oe[2]=ct*Ot+it*ut,Oe[3]=bt*Ot-ot*ut,Oe},te.rotateZ=function(Oe,He,Qe){Qe*=.5;var it=He[0],ot=He[1],ct=He[2],bt=He[3],ut=Math.sin(Qe),Ot=Math.cos(Qe);return Oe[0]=it*Ot+ot*ut,Oe[1]=ot*Ot-it*ut,Oe[2]=ct*Ot+bt*ut,Oe[3]=bt*Ot-ct*ut,Oe},te.calculateW=function(Oe,He){var Qe=He[0],it=He[1],ot=He[2];return Oe[0]=Qe,Oe[1]=it,Oe[2]=ot,Oe[3]=Math.sqrt(Math.abs(1-Qe*Qe-it*it-ot*ot)),Oe},te.exp=x,te.ln=I,te.pow=function(Oe,He,Qe){return I(Oe,He),P(Oe,Oe,Qe),x(Oe,Oe),Oe},te.slerp=M,te.random=function(Oe){var He=n.RANDOM(),Qe=n.RANDOM(),it=n.RANDOM(),ot=Math.sqrt(1-He),ct=Math.sqrt(He);return Oe[0]=ot*Math.sin(2*Math.PI*Qe),Oe[1]=ot*Math.cos(2*Math.PI*Qe),Oe[2]=ct*Math.sin(2*Math.PI*it),Oe[3]=ct*Math.cos(2*Math.PI*it),Oe},te.invert=function(Oe,He){var Qe=He[0],it=He[1],ot=He[2],ct=He[3],bt=Qe*Qe+it*it+ot*ot+ct*ct,ut=bt?1/bt:0;return Oe[0]=-Qe*ut,Oe[1]=-it*ut,Oe[2]=-ot*ut,Oe[3]=ct*ut,Oe},te.conjugate=function(Oe,He){return Oe[0]=-He[0],Oe[1]=-He[1],Oe[2]=-He[2],Oe[3]=He[3],Oe},te.fromMat3=C,te.fromEuler=function(Oe,He,Qe,it){var ot=.5*Math.PI/180;He*=ot,Qe*=ot,it*=ot;var ct=Math.sin(He),bt=Math.cos(He),ut=Math.sin(Qe),Ot=Math.cos(Qe),$t=Math.sin(it),It=Math.cos(it);return Oe[0]=ct*Ot*It-bt*ut*$t,Oe[1]=bt*ut*It+ct*Ot*$t,Oe[2]=bt*Ot*$t-ct*ut*It,Oe[3]=bt*Ot*It+ct*ut*$t,Oe},te.str=function(Oe){return"quat("+Oe[0]+", "+Oe[1]+", "+Oe[2]+", "+Oe[3]+")"},te.setAxes=te.sqlerp=te.rotationTo=te.equals=te.exactEquals=te.normalize=te.sqrLen=te.squaredLength=te.len=te.length=te.lerp=te.dot=te.scale=te.mul=te.add=te.set=te.copy=te.fromValues=te.clone=void 0;var n=_($()),s=_(Ee()),h=_(pe()),g=_(Mt());function f(Oe){if(typeof WeakMap!="function")return null;var He=new WeakMap,Qe=new WeakMap;return(f=function(it){return it?Qe:He})(Oe)}function _(Oe,He){if(Oe&&Oe.__esModule)return Oe;if(Oe===null||u(Oe)!=="object"&&typeof Oe!="function")return{default:Oe};var Qe=f(He);if(Qe&&Qe.has(Oe))return Qe.get(Oe);var it={},ot=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ct in Oe)if(ct!=="default"&&Object.prototype.hasOwnProperty.call(Oe,ct)){var bt=ot?Object.getOwnPropertyDescriptor(Oe,ct):null;bt&&(bt.get||bt.set)?Object.defineProperty(it,ct,bt):it[ct]=Oe[ct]}return it.default=Oe,Qe&&Qe.set(Oe,it),it}function S(){var Oe=new n.ARRAY_TYPE(4);return n.ARRAY_TYPE!=Float32Array&&(Oe[0]=0,Oe[1]=0,Oe[2]=0),Oe[3]=1,Oe}function A(Oe,He,Qe){Qe*=.5;var it=Math.sin(Qe);return Oe[0]=it*He[0],Oe[1]=it*He[1],Oe[2]=it*He[2],Oe[3]=Math.cos(Qe),Oe}function k(Oe,He,Qe){var it=He[0],ot=He[1],ct=He[2],bt=He[3],ut=Qe[0],Ot=Qe[1],$t=Qe[2],It=Qe[3];return Oe[0]=it*It+bt*ut+ot*$t-ct*Ot,Oe[1]=ot*It+bt*Ot+ct*ut-it*$t,Oe[2]=ct*It+bt*$t+it*Ot-ot*ut,Oe[3]=bt*It-it*ut-ot*Ot-ct*$t,Oe}function x(Oe,He){var Qe=He[0],it=He[1],ot=He[2],ct=He[3],bt=Math.sqrt(Qe*Qe+it*it+ot*ot),ut=Math.exp(ct),Ot=bt>0?ut*Math.sin(bt)/bt:0;return Oe[0]=Qe*Ot,Oe[1]=it*Ot,Oe[2]=ot*Ot,Oe[3]=ut*Math.cos(bt),Oe}function I(Oe,He){var Qe=He[0],it=He[1],ot=He[2],ct=He[3],bt=Math.sqrt(Qe*Qe+it*it+ot*ot),ut=bt>0?Math.atan2(bt,ct)/bt:0;return Oe[0]=Qe*ut,Oe[1]=it*ut,Oe[2]=ot*ut,Oe[3]=.5*Math.log(Qe*Qe+it*it+ot*ot+ct*ct),Oe}function M(Oe,He,Qe,it){var ot,ct,bt,ut,Ot,$t=He[0],It=He[1],En=He[2],mn=He[3],an=Qe[0],Wt=Qe[1],Vn=Qe[2],Tn=Qe[3];return(ct=$t*an+It*Wt+En*Vn+mn*Tn)<0&&(ct=-ct,an=-an,Wt=-Wt,Vn=-Vn,Tn=-Tn),1-ct>n.EPSILON?(ot=Math.acos(ct),bt=Math.sin(ot),ut=Math.sin((1-it)*ot)/bt,Ot=Math.sin(it*ot)/bt):(ut=1-it,Ot=it),Oe[0]=ut*$t+Ot*an,Oe[1]=ut*It+Ot*Wt,Oe[2]=ut*En+Ot*Vn,Oe[3]=ut*mn+Ot*Tn,Oe}function C(Oe,He){var Qe,it=He[0]+He[4]+He[8];if(it>0)Qe=Math.sqrt(it+1),Oe[3]=.5*Qe,Oe[0]=(He[5]-He[7])*(Qe=.5/Qe),Oe[1]=(He[6]-He[2])*Qe,Oe[2]=(He[1]-He[3])*Qe;else{var ot=0;He[4]>He[0]&&(ot=1),He[8]>He[3*ot+ot]&&(ot=2);var ct=(ot+1)%3,bt=(ot+2)%3;Qe=Math.sqrt(He[3*ot+ot]-He[3*ct+ct]-He[3*bt+bt]+1),Oe[ot]=.5*Qe,Oe[3]=(He[3*ct+bt]-He[3*bt+ct])*(Qe=.5/Qe),Oe[ct]=(He[3*ct+ot]+He[3*ot+ct])*Qe,Oe[bt]=(He[3*bt+ot]+He[3*ot+bt])*Qe}return Oe}te.clone=g.clone,te.fromValues=g.fromValues,te.copy=g.copy,te.set=g.set,te.add=g.add,te.mul=k;var P=g.scale;te.scale=P;var O=g.dot;te.dot=O,te.lerp=g.lerp;var V=g.length;te.length=V,te.len=V;var G=g.squaredLength;te.squaredLength=G,te.sqrLen=G;var J=g.normalize;te.normalize=J,te.exactEquals=g.exactEquals,te.equals=g.equals;var ee,H,se,ue=(ee=h.create(),H=h.fromValues(1,0,0),se=h.fromValues(0,1,0),function(Oe,He,Qe){var it=h.dot(He,Qe);return it<-.999999?(h.cross(ee,H,He),h.len(ee)<1e-6&&h.cross(ee,se,He),h.normalize(ee,ee),A(Oe,ee,Math.PI),Oe):it>.999999?(Oe[0]=0,Oe[1]=0,Oe[2]=0,Oe[3]=1,Oe):(h.cross(ee,He,Qe),Oe[0]=ee[0],Oe[1]=ee[1],Oe[2]=ee[2],Oe[3]=1+it,J(Oe,Oe))});te.rotationTo=ue;var we,Me,Re=(we=S(),Me=S(),function(Oe,He,Qe,it,ot,ct){return M(we,He,ot,ct),M(Me,Qe,it,ct),M(Oe,we,Me,2*ct*(1-ct)),Oe});te.sqlerp=Re;var Ce,je=(Ce=s.create(),function(Oe,He,Qe,it){return Ce[0]=Qe[0],Ce[3]=Qe[1],Ce[6]=Qe[2],Ce[1]=it[0],Ce[4]=it[1],Ce[7]=it[2],Ce[2]=-He[0],Ce[5]=-He[1],Ce[8]=-He[2],J(Oe,C(Oe,Ce))});return te.setAxes=je,te}var yt,rt={};function mt(){if(yt)return rt;function u(M){return u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},u(M)}yt=1,Object.defineProperty(rt,"__esModule",{value:!0}),rt.create=function(){var M=new n.ARRAY_TYPE(8);return n.ARRAY_TYPE!=Float32Array&&(M[0]=0,M[1]=0,M[2]=0,M[4]=0,M[5]=0,M[6]=0,M[7]=0),M[3]=1,M},rt.clone=function(M){var C=new n.ARRAY_TYPE(8);return C[0]=M[0],C[1]=M[1],C[2]=M[2],C[3]=M[3],C[4]=M[4],C[5]=M[5],C[6]=M[6],C[7]=M[7],C},rt.fromValues=function(M,C,P,O,V,G,J,ee){var H=new n.ARRAY_TYPE(8);return H[0]=M,H[1]=C,H[2]=P,H[3]=O,H[4]=V,H[5]=G,H[6]=J,H[7]=ee,H},rt.fromRotationTranslationValues=function(M,C,P,O,V,G,J){var ee=new n.ARRAY_TYPE(8);ee[0]=M,ee[1]=C,ee[2]=P,ee[3]=O;var H=.5*V,se=.5*G,ue=.5*J;return ee[4]=H*O+se*P-ue*C,ee[5]=se*O+ue*M-H*P,ee[6]=ue*O+H*C-se*M,ee[7]=-H*M-se*C-ue*P,ee},rt.fromRotationTranslation=_,rt.fromTranslation=function(M,C){return M[0]=0,M[1]=0,M[2]=0,M[3]=1,M[4]=.5*C[0],M[5]=.5*C[1],M[6]=.5*C[2],M[7]=0,M},rt.fromRotation=function(M,C){return M[0]=C[0],M[1]=C[1],M[2]=C[2],M[3]=C[3],M[4]=0,M[5]=0,M[6]=0,M[7]=0,M},rt.fromMat4=function(M,C){var P=s.create();h.getRotation(P,C);var O=new n.ARRAY_TYPE(3);return h.getTranslation(O,C),_(M,P,O),M},rt.copy=S,rt.identity=function(M){return M[0]=0,M[1]=0,M[2]=0,M[3]=1,M[4]=0,M[5]=0,M[6]=0,M[7]=0,M},rt.set=function(M,C,P,O,V,G,J,ee,H){return M[0]=C,M[1]=P,M[2]=O,M[3]=V,M[4]=G,M[5]=J,M[6]=ee,M[7]=H,M},rt.getDual=function(M,C){return M[0]=C[4],M[1]=C[5],M[2]=C[6],M[3]=C[7],M},rt.setDual=function(M,C){return M[4]=C[0],M[5]=C[1],M[6]=C[2],M[7]=C[3],M},rt.getTranslation=function(M,C){var P=C[4],O=C[5],V=C[6],G=C[7],J=-C[0],ee=-C[1],H=-C[2],se=C[3];return M[0]=2*(P*se+G*J+O*H-V*ee),M[1]=2*(O*se+G*ee+V*J-P*H),M[2]=2*(V*se+G*H+P*ee-O*J),M},rt.translate=function(M,C,P){var O=C[0],V=C[1],G=C[2],J=C[3],ee=.5*P[0],H=.5*P[1],se=.5*P[2],ue=C[4],we=C[5],Me=C[6],Re=C[7];return M[0]=O,M[1]=V,M[2]=G,M[3]=J,M[4]=J*ee+V*se-G*H+ue,M[5]=J*H+G*ee-O*se+we,M[6]=J*se+O*H-V*ee+Me,M[7]=-O*ee-V*H-G*se+Re,M},rt.rotateX=function(M,C,P){var O=-C[0],V=-C[1],G=-C[2],J=C[3],ee=C[4],H=C[5],se=C[6],ue=C[7],we=ee*J+ue*O+H*G-se*V,Me=H*J+ue*V+se*O-ee*G,Re=se*J+ue*G+ee*V-H*O,Ce=ue*J-ee*O-H*V-se*G;return s.rotateX(M,C,P),M[4]=we*(J=M[3])+Ce*(O=M[0])+Me*(G=M[2])-Re*(V=M[1]),M[5]=Me*J+Ce*V+Re*O-we*G,M[6]=Re*J+Ce*G+we*V-Me*O,M[7]=Ce*J-we*O-Me*V-Re*G,M},rt.rotateY=function(M,C,P){var O=-C[0],V=-C[1],G=-C[2],J=C[3],ee=C[4],H=C[5],se=C[6],ue=C[7],we=ee*J+ue*O+H*G-se*V,Me=H*J+ue*V+se*O-ee*G,Re=se*J+ue*G+ee*V-H*O,Ce=ue*J-ee*O-H*V-se*G;return s.rotateY(M,C,P),M[4]=we*(J=M[3])+Ce*(O=M[0])+Me*(G=M[2])-Re*(V=M[1]),M[5]=Me*J+Ce*V+Re*O-we*G,M[6]=Re*J+Ce*G+we*V-Me*O,M[7]=Ce*J-we*O-Me*V-Re*G,M},rt.rotateZ=function(M,C,P){var O=-C[0],V=-C[1],G=-C[2],J=C[3],ee=C[4],H=C[5],se=C[6],ue=C[7],we=ee*J+ue*O+H*G-se*V,Me=H*J+ue*V+se*O-ee*G,Re=se*J+ue*G+ee*V-H*O,Ce=ue*J-ee*O-H*V-se*G;return s.rotateZ(M,C,P),M[4]=we*(J=M[3])+Ce*(O=M[0])+Me*(G=M[2])-Re*(V=M[1]),M[5]=Me*J+Ce*V+Re*O-we*G,M[6]=Re*J+Ce*G+we*V-Me*O,M[7]=Ce*J-we*O-Me*V-Re*G,M},rt.rotateByQuatAppend=function(M,C,P){var O=P[0],V=P[1],G=P[2],J=P[3],ee=C[0],H=C[1],se=C[2],ue=C[3];return M[0]=ee*J+ue*O+H*G-se*V,M[1]=H*J+ue*V+se*O-ee*G,M[2]=se*J+ue*G+ee*V-H*O,M[3]=ue*J-ee*O-H*V-se*G,M[4]=(ee=C[4])*J+(ue=C[7])*O+(H=C[5])*G-(se=C[6])*V,M[5]=H*J+ue*V+se*O-ee*G,M[6]=se*J+ue*G+ee*V-H*O,M[7]=ue*J-ee*O-H*V-se*G,M},rt.rotateByQuatPrepend=function(M,C,P){var O=C[0],V=C[1],G=C[2],J=C[3],ee=P[0],H=P[1],se=P[2],ue=P[3];return M[0]=O*ue+J*ee+V*se-G*H,M[1]=V*ue+J*H+G*ee-O*se,M[2]=G*ue+J*se+O*H-V*ee,M[3]=J*ue-O*ee-V*H-G*se,M[4]=O*(ue=P[7])+J*(ee=P[4])+V*(se=P[6])-G*(H=P[5]),M[5]=V*ue+J*H+G*ee-O*se,M[6]=G*ue+J*se+O*H-V*ee,M[7]=J*ue-O*ee-V*H-G*se,M},rt.rotateAroundAxis=function(M,C,P,O){if(Math.abs(O)<n.EPSILON)return S(M,C);var V=Math.hypot(P[0],P[1],P[2]);O*=.5;var G=Math.sin(O),J=G*P[0]/V,ee=G*P[1]/V,H=G*P[2]/V,se=Math.cos(O),ue=C[0],we=C[1],Me=C[2],Re=C[3];M[0]=ue*se+Re*J+we*H-Me*ee,M[1]=we*se+Re*ee+Me*J-ue*H,M[2]=Me*se+Re*H+ue*ee-we*J,M[3]=Re*se-ue*J-we*ee-Me*H;var Ce=C[4],je=C[5],Oe=C[6],He=C[7];return M[4]=Ce*se+He*J+je*H-Oe*ee,M[5]=je*se+He*ee+Oe*J-Ce*H,M[6]=Oe*se+He*H+Ce*ee-je*J,M[7]=He*se-Ce*J-je*ee-Oe*H,M},rt.add=function(M,C,P){return M[0]=C[0]+P[0],M[1]=C[1]+P[1],M[2]=C[2]+P[2],M[3]=C[3]+P[3],M[4]=C[4]+P[4],M[5]=C[5]+P[5],M[6]=C[6]+P[6],M[7]=C[7]+P[7],M},rt.multiply=A,rt.scale=function(M,C,P){return M[0]=C[0]*P,M[1]=C[1]*P,M[2]=C[2]*P,M[3]=C[3]*P,M[4]=C[4]*P,M[5]=C[5]*P,M[6]=C[6]*P,M[7]=C[7]*P,M},rt.lerp=function(M,C,P,O){var V=1-O;return k(C,P)<0&&(O=-O),M[0]=C[0]*V+P[0]*O,M[1]=C[1]*V+P[1]*O,M[2]=C[2]*V+P[2]*O,M[3]=C[3]*V+P[3]*O,M[4]=C[4]*V+P[4]*O,M[5]=C[5]*V+P[5]*O,M[6]=C[6]*V+P[6]*O,M[7]=C[7]*V+P[7]*O,M},rt.invert=function(M,C){var P=I(C);return M[0]=-C[0]/P,M[1]=-C[1]/P,M[2]=-C[2]/P,M[3]=C[3]/P,M[4]=-C[4]/P,M[5]=-C[5]/P,M[6]=-C[6]/P,M[7]=C[7]/P,M},rt.conjugate=function(M,C){return M[0]=-C[0],M[1]=-C[1],M[2]=-C[2],M[3]=C[3],M[4]=-C[4],M[5]=-C[5],M[6]=-C[6],M[7]=C[7],M},rt.normalize=function(M,C){var P=I(C);if(P>0){P=Math.sqrt(P);var O=C[0]/P,V=C[1]/P,G=C[2]/P,J=C[3]/P,ee=C[4],H=C[5],se=C[6],ue=C[7],we=O*ee+V*H+G*se+J*ue;M[0]=O,M[1]=V,M[2]=G,M[3]=J,M[4]=(ee-O*we)/P,M[5]=(H-V*we)/P,M[6]=(se-G*we)/P,M[7]=(ue-J*we)/P}return M},rt.str=function(M){return"quat2("+M[0]+", "+M[1]+", "+M[2]+", "+M[3]+", "+M[4]+", "+M[5]+", "+M[6]+", "+M[7]+")"},rt.exactEquals=function(M,C){return M[0]===C[0]&&M[1]===C[1]&&M[2]===C[2]&&M[3]===C[3]&&M[4]===C[4]&&M[5]===C[5]&&M[6]===C[6]&&M[7]===C[7]},rt.equals=function(M,C){var P=M[0],O=M[1],V=M[2],G=M[3],J=M[4],ee=M[5],H=M[6],se=M[7],ue=C[0],we=C[1],Me=C[2],Re=C[3],Ce=C[4],je=C[5],Oe=C[6],He=C[7];return Math.abs(P-ue)<=n.EPSILON*Math.max(1,Math.abs(P),Math.abs(ue))&&Math.abs(O-we)<=n.EPSILON*Math.max(1,Math.abs(O),Math.abs(we))&&Math.abs(V-Me)<=n.EPSILON*Math.max(1,Math.abs(V),Math.abs(Me))&&Math.abs(G-Re)<=n.EPSILON*Math.max(1,Math.abs(G),Math.abs(Re))&&Math.abs(J-Ce)<=n.EPSILON*Math.max(1,Math.abs(J),Math.abs(Ce))&&Math.abs(ee-je)<=n.EPSILON*Math.max(1,Math.abs(ee),Math.abs(je))&&Math.abs(H-Oe)<=n.EPSILON*Math.max(1,Math.abs(H),Math.abs(Oe))&&Math.abs(se-He)<=n.EPSILON*Math.max(1,Math.abs(se),Math.abs(He))},rt.sqrLen=rt.squaredLength=rt.len=rt.length=rt.dot=rt.mul=rt.setReal=rt.getReal=void 0;var n=f($()),s=f(Lt()),h=f(Y());function g(M){if(typeof WeakMap!="function")return null;var C=new WeakMap,P=new WeakMap;return(g=function(O){return O?P:C})(M)}function f(M,C){if(M&&M.__esModule)return M;if(M===null||u(M)!=="object"&&typeof M!="function")return{default:M};var P=g(C);if(P&&P.has(M))return P.get(M);var O={},V=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var G in M)if(G!=="default"&&Object.prototype.hasOwnProperty.call(M,G)){var J=V?Object.getOwnPropertyDescriptor(M,G):null;J&&(J.get||J.set)?Object.defineProperty(O,G,J):O[G]=M[G]}return O.default=M,P&&P.set(M,O),O}function _(M,C,P){var O=.5*P[0],V=.5*P[1],G=.5*P[2],J=C[0],ee=C[1],H=C[2],se=C[3];return M[0]=J,M[1]=ee,M[2]=H,M[3]=se,M[4]=O*se+V*H-G*ee,M[5]=V*se+G*J-O*H,M[6]=G*se+O*ee-V*J,M[7]=-O*J-V*ee-G*H,M}function S(M,C){return M[0]=C[0],M[1]=C[1],M[2]=C[2],M[3]=C[3],M[4]=C[4],M[5]=C[5],M[6]=C[6],M[7]=C[7],M}function A(M,C,P){var O=C[0],V=C[1],G=C[2],J=C[3],ee=P[4],H=P[5],se=P[6],ue=P[7],we=C[4],Me=C[5],Re=C[6],Ce=C[7],je=P[0],Oe=P[1],He=P[2],Qe=P[3];return M[0]=O*Qe+J*je+V*He-G*Oe,M[1]=V*Qe+J*Oe+G*je-O*He,M[2]=G*Qe+J*He+O*Oe-V*je,M[3]=J*Qe-O*je-V*Oe-G*He,M[4]=O*ue+J*ee+V*se-G*H+we*Qe+Ce*je+Me*He-Re*Oe,M[5]=V*ue+J*H+G*ee-O*se+Me*Qe+Ce*Oe+Re*je-we*He,M[6]=G*ue+J*se+O*H-V*ee+Re*Qe+Ce*He+we*Oe-Me*je,M[7]=J*ue-O*ee-V*H-G*se+Ce*Qe-we*je-Me*Oe-Re*He,M}rt.getReal=s.copy,rt.setReal=s.copy,rt.mul=A;var k=s.dot;rt.dot=k;var x=s.length;rt.length=x,rt.len=x;var I=s.squaredLength;return rt.squaredLength=I,rt.sqrLen=I,rt}var Ft,bn,Bt={};function ht(){if(Ft)return Bt;function u(C){return u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(P){return typeof P}:function(P){return P&&typeof Symbol=="function"&&P.constructor===Symbol&&P!==Symbol.prototype?"symbol":typeof P},u(C)}Ft=1,Object.defineProperty(Bt,"__esModule",{value:!0}),Bt.create=h,Bt.clone=function(C){var P=new n.ARRAY_TYPE(2);return P[0]=C[0],P[1]=C[1],P},Bt.fromValues=function(C,P){var O=new n.ARRAY_TYPE(2);return O[0]=C,O[1]=P,O},Bt.copy=function(C,P){return C[0]=P[0],C[1]=P[1],C},Bt.set=function(C,P,O){return C[0]=P,C[1]=O,C},Bt.add=function(C,P,O){return C[0]=P[0]+O[0],C[1]=P[1]+O[1],C},Bt.subtract=g,Bt.multiply=f,Bt.divide=_,Bt.ceil=function(C,P){return C[0]=Math.ceil(P[0]),C[1]=Math.ceil(P[1]),C},Bt.floor=function(C,P){return C[0]=Math.floor(P[0]),C[1]=Math.floor(P[1]),C},Bt.min=function(C,P,O){return C[0]=Math.min(P[0],O[0]),C[1]=Math.min(P[1],O[1]),C},Bt.max=function(C,P,O){return C[0]=Math.max(P[0],O[0]),C[1]=Math.max(P[1],O[1]),C},Bt.round=function(C,P){return C[0]=Math.round(P[0]),C[1]=Math.round(P[1]),C},Bt.scale=function(C,P,O){return C[0]=P[0]*O,C[1]=P[1]*O,C},Bt.scaleAndAdd=function(C,P,O,V){return C[0]=P[0]+O[0]*V,C[1]=P[1]+O[1]*V,C},Bt.distance=S,Bt.squaredDistance=A,Bt.length=k,Bt.squaredLength=x,Bt.negate=function(C,P){return C[0]=-P[0],C[1]=-P[1],C},Bt.inverse=function(C,P){return C[0]=1/P[0],C[1]=1/P[1],C},Bt.normalize=function(C,P){var O=P[0],V=P[1],G=O*O+V*V;return G>0&&(G=1/Math.sqrt(G)),C[0]=P[0]*G,C[1]=P[1]*G,C},Bt.dot=function(C,P){return C[0]*P[0]+C[1]*P[1]},Bt.cross=function(C,P,O){var V=P[0]*O[1]-P[1]*O[0];return C[0]=C[1]=0,C[2]=V,C},Bt.lerp=function(C,P,O,V){var G=P[0],J=P[1];return C[0]=G+V*(O[0]-G),C[1]=J+V*(O[1]-J),C},Bt.random=function(C,P){P=P||1;var O=2*n.RANDOM()*Math.PI;return C[0]=Math.cos(O)*P,C[1]=Math.sin(O)*P,C},Bt.transformMat2=function(C,P,O){var V=P[0],G=P[1];return C[0]=O[0]*V+O[2]*G,C[1]=O[1]*V+O[3]*G,C},Bt.transformMat2d=function(C,P,O){var V=P[0],G=P[1];return C[0]=O[0]*V+O[2]*G+O[4],C[1]=O[1]*V+O[3]*G+O[5],C},Bt.transformMat3=function(C,P,O){var V=P[0],G=P[1];return C[0]=O[0]*V+O[3]*G+O[6],C[1]=O[1]*V+O[4]*G+O[7],C},Bt.transformMat4=function(C,P,O){var V=P[0],G=P[1];return C[0]=O[0]*V+O[4]*G+O[12],C[1]=O[1]*V+O[5]*G+O[13],C},Bt.rotate=function(C,P,O,V){var G=P[0]-O[0],J=P[1]-O[1],ee=Math.sin(V),H=Math.cos(V);return C[0]=G*H-J*ee+O[0],C[1]=G*ee+J*H+O[1],C},Bt.angle=function(C,P){var O=C[0],V=C[1],G=P[0],J=P[1],ee=Math.sqrt(O*O+V*V)*Math.sqrt(G*G+J*J);return Math.acos(Math.min(Math.max(ee&&(O*G+V*J)/ee,-1),1))},Bt.zero=function(C){return C[0]=0,C[1]=0,C},Bt.str=function(C){return"vec2("+C[0]+", "+C[1]+")"},Bt.exactEquals=function(C,P){return C[0]===P[0]&&C[1]===P[1]},Bt.equals=function(C,P){var O=C[0],V=C[1],G=P[0],J=P[1];return Math.abs(O-G)<=n.EPSILON*Math.max(1,Math.abs(O),Math.abs(G))&&Math.abs(V-J)<=n.EPSILON*Math.max(1,Math.abs(V),Math.abs(J))},Bt.forEach=Bt.sqrLen=Bt.sqrDist=Bt.dist=Bt.div=Bt.mul=Bt.sub=Bt.len=void 0;var n=function(C,P){if(C&&C.__esModule)return C;if(C===null||u(C)!=="object"&&typeof C!="function")return{default:C};var O=s(void 0);if(O&&O.has(C))return O.get(C);var V={},G=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var J in C)if(J!=="default"&&Object.prototype.hasOwnProperty.call(C,J)){var ee=G?Object.getOwnPropertyDescriptor(C,J):null;ee&&(ee.get||ee.set)?Object.defineProperty(V,J,ee):V[J]=C[J]}return V.default=C,O&&O.set(C,V),V}($());function s(C){if(typeof WeakMap!="function")return null;var P=new WeakMap,O=new WeakMap;return(s=function(V){return V?O:P})(C)}function h(){var C=new n.ARRAY_TYPE(2);return n.ARRAY_TYPE!=Float32Array&&(C[0]=0,C[1]=0),C}function g(C,P,O){return C[0]=P[0]-O[0],C[1]=P[1]-O[1],C}function f(C,P,O){return C[0]=P[0]*O[0],C[1]=P[1]*O[1],C}function _(C,P,O){return C[0]=P[0]/O[0],C[1]=P[1]/O[1],C}function S(C,P){return Math.hypot(P[0]-C[0],P[1]-C[1])}function A(C,P){var O=P[0]-C[0],V=P[1]-C[1];return O*O+V*V}function k(C){return Math.hypot(C[0],C[1])}function x(C){var P=C[0],O=C[1];return P*P+O*O}Bt.len=k,Bt.sub=g,Bt.mul=f,Bt.div=_,Bt.dist=S,Bt.sqrDist=A,Bt.sqrLen=x;var I,M=(I=h(),function(C,P,O,V,G,J){var ee,H;for(P||(P=2),O||(O=0),H=V?Math.min(V*P+O,C.length):C.length,ee=O;ee<H;ee+=P)I[0]=C[ee],I[1]=C[ee+1],G(I,I,J),C[ee]=I[0],C[ee+1]=I[1];return C});return Bt.forEach=M,Bt}function gt(){if(bn)return B;function u(C){return u=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(P){return typeof P}:function(P){return P&&typeof Symbol=="function"&&P.constructor===Symbol&&P!==Symbol.prototype?"symbol":typeof P},u(C)}bn=1,Object.defineProperty(B,"__esModule",{value:!0}),B.vec4=B.vec3=B.vec2=B.quat2=B.quat=B.mat4=B.mat3=B.mat2d=B.mat2=B.glMatrix=void 0;var n=M($());B.glMatrix=n;var s=M(ne());B.mat2=s;var h=M(fe());B.mat2d=h;var g=M(Ee());B.mat3=g;var f=M(Y());B.mat4=f;var _=M(Lt());B.quat=_;var S=M(mt());B.quat2=S;var A=M(ht());B.vec2=A;var k=M(pe());B.vec3=k;var x=M(Mt());function I(C){if(typeof WeakMap!="function")return null;var P=new WeakMap,O=new WeakMap;return(I=function(V){return V?O:P})(C)}function M(C,P){if(C&&C.__esModule)return C;if(C===null||u(C)!=="object"&&typeof C!="function")return{default:C};var O=I(P);if(O&&O.has(C))return O.get(C);var V={},G=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var J in C)if(J!=="default"&&Object.prototype.hasOwnProperty.call(C,J)){var ee=G?Object.getOwnPropertyDescriptor(C,J):null;ee&&(ee.get||ee.set)?Object.defineProperty(V,J,ee):V[J]=C[J]}return V.default=C,O&&O.set(C,V),V}return B.vec4=x,B}var et,Nt,St,Xt,Ie=gt(),gn=function(){if(Nt)return et;function u(n,s,h,g){this.cx=3*n,this.bx=3*(h-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(g-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=s,this.p2x=h,this.p2y=g}return Nt=1,et=u,u.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,s){if(s===void 0&&(s=1e-6),n<0)return 0;if(n>1)return 1;for(var h=n,g=0;g<8;g++){var f=this.sampleCurveX(h)-n;if(Math.abs(f)<s)return h;var _=this.sampleCurveDerivativeX(h);if(Math.abs(_)<1e-6)break;h-=f/_}var S=0,A=1;for(h=n,g=0;g<20&&(f=this.sampleCurveX(h),!(Math.abs(f-n)<s));g++)n>f?S=h:A=h,h=.5*(A-S)+S;return h},solve:function(n,s){return this.sampleCurveY(this.solveCurveX(n,s))}},et}(),Ae=D(gn);function Ne(){if(Xt)return St;function u(n,s){this.x=n,this.y=s}return Xt=1,St=u,u.prototype={clone:function(){return new u(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,s){return this.clone()._rotateAround(n,s)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var s=n.x-this.x,h=n.y-this.y;return s*s+h*h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,s){return Math.atan2(this.x*s-this.y*n,this.x*n+this.y*s)},_matMult:function(n){var s=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=s,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var s=Math.cos(n),h=Math.sin(n),g=h*this.x+s*this.y;return this.x=s*this.x-h*this.y,this.y=g,this},_rotateAround:function(n,s){var h=Math.cos(n),g=Math.sin(n),f=s.y+g*(this.x-s.x)+h*(this.y-s.y);return this.x=s.x+h*(this.x-s.x)-g*(this.y-s.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},u.convert=function(n){return n instanceof u?n:Array.isArray(n)?new u(n[0],n[1]):n},St}var Ue=D(Ne());function Et(u,n){if(Array.isArray(u)){if(!Array.isArray(n)||u.length!==n.length)return!1;for(let s=0;s<u.length;s++)if(!Et(u[s],n[s]))return!1;return!0}if(typeof u=="object"&&u!==null&&n!==null){if(typeof n!="object"||Object.keys(u).length!==Object.keys(n).length)return!1;for(const s in u)if(!Et(u[s],n[s]))return!1;return!0}return u===n}const Ct=Math.PI/180,Qt=180/Math.PI;function Gt(u){return u*Ct}function Yt(u){return u*Qt}const vn=[[0,0],[1,0],[1,1],[0,1]];function dn(u){if(u<=0)return 0;if(u>=1)return 1;const n=u*u,s=n*u;return 4*(u<.5?s:3*(u-n)+s-.75)}function Wn(u,n,s,h){const g=new Ae(u,n,s,h);return function(f){return g.solve(f)}}const Rn=Wn(.25,.1,.25,1);function hn(u,n,s){return Math.min(s,Math.max(n,u))}function jn(u,n,s){return(s=hn((s-u)/(n-u),0,1))*s*(3-2*s)}function ti(u,n,s){const h=s-n,g=((u-n)%h+h)%h+n;return g===n?s:g}function ki(u,n,s){if(!u.length)return s(null,[]);let h=u.length;const g=new Array(u.length);let f=null;u.forEach((_,S)=>{n(_,(A,k)=>{A&&(f=A),g[S]=k,--h==0&&s(f,g)})})}function gi(u,...n){for(const s of n)for(const h in s)u[h]=s[h];return u}let or=1;function wr(){return or++}function Rr(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log(u)/Math.LN2))}function zr(u,n){u.forEach(s=>{n[s]&&(n[s]=n[s].bind(n))})}function dr(u,n){return u.indexOf(n,u.length-n.length)!==-1}function Ho(u,n,s){const h={};for(const g in u)h[g]=n.call(this,u[g],g,u);return h}function Sr(u,n,s){const h={};for(const g in u)n.call(this,u[g],g,u)&&(h[g]=u[g]);return h}function Tr(u){return Array.isArray(u)?u.map(Tr):typeof u=="object"&&u?Ho(u,Tr):u}const Bo={};function ii(u){Bo[u]||(typeof console<"u"&&console.warn(u),Bo[u]=!0)}function Qo(u,n,s){return(s.y-u.y)*(n.x-u.x)>(n.y-u.y)*(s.x-u.x)}function vs(u){let n=0;for(let s,h,g=0,f=u.length,_=f-1;g<f;_=g++)s=u[g],h=u[_],n+=(h.x-s.x)*(s.y+h.y);return n}function To([u,n,s]){const h=Gt(n+90),g=Gt(s);return{x:u*Math.cos(h)*Math.sin(g),y:u*Math.sin(h)*Math.sin(g),z:u*Math.cos(g),azimuthal:n,polar:s}}function Eo(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function es(u){const n={};if(u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,h,g,f)=>{const _=g||f;return n[h]=!_||_.toLowerCase(),""}),n["max-age"]){const s=parseInt(n["max-age"],10);isNaN(s)?delete n["max-age"]:n["max-age"]=s}return n}let ys,Qs=null;function bs(u,n){return[u[4*n],u[4*n+1],u[4*n+2],u[4*n+3]]}function vt(u,n,s,h){for(;n<s;){const g=n+s>>1;u[g]<h?n=g+1:s=g}return n}function ye(u,n,s,h){for(;n<s;){const g=n+s>>1;u[g]<=h?n=g+1:s=g}return n}function Te(u){return u>0?1/(1.001-u):1+u}function Ve(u){return u>0?1-1/(1.001-u):-u}const Ze={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(ys==null){const u=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{ys=o.API_URL_REGEX!=null?new RegExp(o.API_URL_REGEX):u}catch{ys=u}}return ys},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Ze.API_URL)return null;try{const u=new URL(Ze.API_URL);return u.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":u.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Ge(u){return Ze.API_URL_REGEX.test(u)}function at(u){return Ze.API_SPRITE_REGEX.test(u)}let xt,lt,wt,Rt,Tt,Zt;function xn(){return xt==null&&(xt=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),xt}const wn={now:()=>Rt!==void 0?Rt:performance.now(),setNow(u){Rt=u},restoreNow(){Rt=void 0},frame(u){const n=requestAnimationFrame(u);return{cancel:()=>cancelAnimationFrame(n)}},getImageData(u,n=0){const{width:s,height:h}=u;Tt||(Tt=document.createElement("canvas"));const g=Tt.getContext("2d",{willReadFrequently:!0});if(!g)throw new Error("failed to create canvas 2d context");return(s>Tt.width||h>Tt.height)&&(Tt.width=s,Tt.height=h),g.clearRect(-n,-n,s+2*n,h+2*n),g.drawImage(u,0,0,s,h),g.getImageData(-n,-n,s+2*n,h+2*n)},resolveURL:u=>(lt||(lt=document.createElement("a")),lt.href=u,lt.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(wt==null&&(wt=window.matchMedia("(prefers-reduced-motion: reduce)")),wt.matches)},hasCanvasFingerprintNoise(){if(Zt!==void 0)return Zt;if(!xn())return Zt=!1,!1;const u=new OffscreenCanvas(85,1),n=u.getContext("2d",{willReadFrequently:!0});let s=0;for(let g=0;g<u.width;++g)n.fillStyle=`rgba(${s++},${s++},${s++}, 255)`,n.fillRect(g,0,1,1);const h=n.getImageData(0,0,u.width,u.height);s=0;for(let g=0;g<h.data.length;++g)if(g%4!=3&&s++!==h.data[g])return Zt=!0,!0;return Zt=!1,!1}};function $n(u,n){const s=u.indexOf("?");if(s<0)return`${u}?${new URLSearchParams(n).toString()}`;const h=new URLSearchParams(u.slice(s));for(const g in n)h.set(g,n[g]);return`${u.slice(0,s)}?${h.toString()}`}function Zn(u,n={persistentParams:[]}){const s=u.indexOf("?");if(s<0)return u;const h=new URLSearchParams,g=new URLSearchParams(u.slice(s));for(const _ of n.persistentParams){const S=g.get(_);S&&h.set(_,S)}const f=h.toString();return`${u.slice(0,s)}${f.length>0?`?${f}`:""}`}const Xn="mapbox-tiles";let Un=500,bi=50;const Ri=["language","worldview","jobid"];let ni,Ai;function qi(){try{return caches}catch{}}function Qi(){const u=qi();u&&ni==null&&(ni=u.open(Xn))}let Pr=1/0;const Dr={supported:!1,testSupport:function(u){!el&&ts&&(Cs?Ua(u):uo=u)}};let uo,ts,el=!1,Cs=!1;const ea=typeof self<"u"?self:{};function Ua(u){const n=u.createTexture();u.bindTexture(u.TEXTURE_2D,n);try{if(u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,ts),u.isContextLost())return;Dr.supported=!0}catch{}u.deleteTexture(n),el=!0}ea.document&&(ts=ea.document.createElement("img"),ts.onload=function(){uo&&Ua(uo),uo=null,Cs=!0},ts.onerror=function(){el=!0,uo=null},ts.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Io={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Io);class ja extends Error{constructor(n,s,h){s===401&&Ge(h)&&(n+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(n),this.status=s,this.url=h}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const xa=Eo()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,wa=function(u,n){if(!(/^file:/.test(s=u.url)||/^file:/.test(xa())&&!/^\w+:/.test(s))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(h,g){const f=new AbortController,_=new Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:xa(),referrerPolicy:h.referrerPolicy,signal:f.signal});let S=!1,A=!1;const k=(x=_.url).indexOf("sku=")>0&&Ge(x);var x;h.type==="json"&&_.headers.set("Accept","application/json");const I=(C,P,O)=>{if(A)return;if(C&&C.message!=="SecurityError"&&ii(C.toString()),P&&O)return M(P);const V=Date.now();fetch(_).then(G=>{if(G.ok){const J=k?G.clone():null;return M(G,J,V)}return g(new ja(G.statusText,G.status,h.url))}).catch(G=>{G.name!=="AbortError"&&g(new Error(`${G.message} ${h.url}`))})},M=(C,P,O)=>{(h.type==="arrayBuffer"?C.arrayBuffer():h.type==="json"?C.json():C.text()).then(V=>{A||(P&&O&&function(G,J,ee){if(Qi(),ni==null)return;const H=es(J.headers.get("Cache-Control")||"");if(H["no-store"])return;const se={status:J.status,statusText:J.statusText,headers:new Headers};J.headers.forEach((Me,Re)=>se.headers.set(Re,Me)),H["max-age"]&&se.headers.set("Expires",new Date(ee+1e3*H["max-age"]).toUTCString());const ue=se.headers.get("Expires");if(!ue||new Date(ue).getTime()-ee<42e4)return;let we=Zn(G.url,{persistentParams:Ri});if(J.status===206){const Me=G.headers.get("Range");if(!Me)return;se.status=200,we=$n(we,{range:Me})}(function(Me,Re){if(Ai===void 0)try{new Response(new ReadableStream),Ai=!0}catch{Ai=!1}Ai?Re(Me.body):Me.blob().then(Re)})(J,Me=>{const Re=new Response((Ce=J.status)!==200&&Ce!==404&&[101,103,204,205,304].includes(Ce)?null:Me,se);var Ce;Qi(),ni!=null&&ni.then(je=>je.put(we,Re)).catch(je=>ii(je.message))})}(_,P,O),S=!0,g(null,V,C.headers.get("Cache-Control"),C.headers.get("Expires")))}).catch(V=>{A||g(new Error(V.message))})};return k?function(C,P){if(Qi(),ni==null)return P(null);ni.then(O=>{let V=Zn(C.url,{persistentParams:Ri});const G=C.headers.get("Range");G&&(V=$n(V,{range:G})),O.match(V).then(J=>{const ee=function(H){if(!H)return!1;const se=new Date(H.headers.get("Expires")||0),ue=es(H.headers.get("Cache-Control")||"");return se>Date.now()&&!ue["no-cache"]}(J);O.delete(V),ee&&O.put(V,J.clone()),P(null,J,ee)}).catch(P)}).catch(P)}(_,I):I(null,null),{cancel:()=>{A=!0,S||f.abort()}}}(u,n);if(Eo()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",u,n,void 0,!0)}var s;return function(h,g){const f=new XMLHttpRequest;f.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(f.responseType="arraybuffer");for(const _ in h.headers)f.setRequestHeader(_,h.headers[_]);return h.type==="json"&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials=h.credentials==="include",f.onerror=()=>{g(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||f.status===0)&&f.response!==null){let _=f.response;if(h.type==="json")try{_=JSON.parse(f.response)}catch(S){return g(S)}g(null,_,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else g(new ja(f.statusText,f.status,h.url))},f.send(h.body),{cancel:()=>f.abort()}}(u,n)},ta=function(u,n){return wa(gi(u,{type:"arrayBuffer"}),n)};function Fo(u){const n=document.createElement("a");return n.href=u,n.protocol===location.protocol&&n.host===location.host}const ns="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let _o,Co;_o=[],Co=0;const Ur=function(u,n){if(Dr.supported&&(u.headers||(u.headers={}),u.headers.accept="image/webp,*/*"),Co>=Ze.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:u,callback:n,cancelled:!1,cancel(){this.cancelled=!0}};return _o.push(f),f}Co++;let s=!1;const h=()=>{if(!s)for(s=!0,Co--;_o.length&&Co<Ze.MAX_PARALLEL_IMAGE_REQUESTS;){const f=_o.shift(),{requestParameters:_,callback:S,cancelled:A}=f;A||(f.cancel=Ur(_,S).cancel)}},g=ta(u,(f,_,S,A)=>{h(),f?n(f):_&&(self.createImageBitmap?function(k,x){const I=new Blob([new Uint8Array(k)],{type:"image/png"});createImageBitmap(I).then(M=>{x(null,M)}).catch(M=>{x(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(k,x)=>n(k,x,S,A)):function(k,x){const I=new Image;I.onload=()=>{x(null,I),URL.revokeObjectURL(I.src),I.onload=null,requestAnimationFrame(()=>{I.src=ns})},I.onerror=()=>x(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const M=new Blob([new Uint8Array(k)],{type:"image/png"});I.src=k.byteLength?URL.createObjectURL(M):ns}(_,(k,x)=>n(k,x,S,A)))});return{cancel:()=>{g.cancel(),h()}}};var ho,is,Sa,cs={exports:{}},sr={exports:{}},$a={exports:{}},na=function(){if(Sa)return cs.exports;Sa=1;var u=(ho||(ho=1,sr.exports=function(s,h){var g,f,_,S,A,k,x,I;for(f=s.length-(g=3&s.length),_=h,A=3432918353,k=461845907,I=0;I<f;)x=255&s.charCodeAt(I)|(255&s.charCodeAt(++I))<<8|(255&s.charCodeAt(++I))<<16|(255&s.charCodeAt(++I))<<24,++I,_=27492+(65535&(S=5*(65535&(_=(_^=x=(65535&(x=(x=(65535&x)*A+(((x>>>16)*A&65535)<<16)&4294967295)<<15|x>>>17))*k+(((x>>>16)*k&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(x=0,g){case 3:x^=(255&s.charCodeAt(I+2))<<16;case 2:x^=(255&s.charCodeAt(I+1))<<8;case 1:_^=x=(65535&(x=(x=(65535&(x^=255&s.charCodeAt(I)))*A+(((x>>>16)*A&65535)<<16)&4294967295)<<15|x>>>17))*k+(((x>>>16)*k&65535)<<16)&4294967295}return _^=s.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),sr.exports),n=(is||(is=1,$a.exports=function(s,h){for(var g,f=s.length,_=h^f,S=0;f>=4;)g=1540483477*(65535&(g=255&s.charCodeAt(S)|(255&s.charCodeAt(++S))<<8|(255&s.charCodeAt(++S))<<16|(255&s.charCodeAt(++S))<<24))+((1540483477*(g>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(g=1540483477*(65535&(g^=g>>>24))+((1540483477*(g>>>16)&65535)<<16)),f-=4,++S;switch(f){case 3:_^=(255&s.charCodeAt(S+2))<<16;case 2:_^=(255&s.charCodeAt(S+1))<<8;case 1:_=1540483477*(65535&(_^=255&s.charCodeAt(S)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),$a.exports);return cs.exports=u,cs.exports.murmur3=u,cs.exports.murmur2=n,cs.exports}(),to=D(na);class Ns{constructor(n,...s){gi(this,s[0]||{}),this.type=n}}class ia extends Ns{constructor(n,s={}){super("error",gi({error:n},s))}}function As(u,n,s){s[u]&&s[u].indexOf(n)!==-1||(s[u]=s[u]||[],s[u].push(n))}function Us(u,n,s){if(s&&s[u]){const h=s[u].indexOf(n);h!==-1&&s[u].splice(h,1)}}class ra{on(n,s){return this._listeners=this._listeners||{},As(n,s,this._listeners),this}off(n,s){return Us(n,s,this._listeners),Us(n,s,this._oneTimeListeners),this}once(n,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},As(n,s,this._oneTimeListeners),this):new Promise(h=>this.once(n,h))}fire(n,s){const h=typeof n=="string"?new Ns(n,s):n,g=h.type;if(this.listens(g)){h.target=this;const f=this._listeners&&this._listeners[g]?this._listeners[g].slice():[];for(const A of f)A.call(this,h);const _=this._oneTimeListeners&&this._oneTimeListeners[g]?this._oneTimeListeners[g].slice():[];for(const A of _)Us(g,A,this._oneTimeListeners),A.call(this,h);const S=this._eventedParent;S&&(gi(h,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),S.fire(h))}else h instanceof ia&&console.error(h.error);return this}listens(n){return!!(this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n))}setEventedParent(n,s){return this._eventedParent=n,this._eventedParentData=s,this}}var bl,st={},en=function(){if(bl)return st;bl=1;var u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(f){return(f=Math.round(f))<0?0:f>255?255:f}function s(f){return n(f[f.length-1]==="%"?parseFloat(f)/100*255:parseInt(f))}function h(f){return(_=f[f.length-1]==="%"?parseFloat(f)/100:parseFloat(f))<0?0:_>1?1:_;var _}function g(f,_,S){return S<0?S+=1:S>1&&(S-=1),6*S<1?f+(_-f)*S*6:2*S<1?_:3*S<2?f+(_-f)*(2/3-S)*6:f}try{st.parseCSSColor=function(f){var _,S=f.replace(/ /g,"").toLowerCase();if(S in u)return u[S].slice();if(S[0]==="#")return S.length===4?(_=parseInt(S.substr(1),16))>=0&&_<=4095?[(3840&_)>>4|(3840&_)>>8,240&_|(240&_)>>4,15&_|(15&_)<<4,1]:null:S.length===7&&(_=parseInt(S.substr(1),16))>=0&&_<=16777215?[(16711680&_)>>16,(65280&_)>>8,255&_,1]:null;var A=S.indexOf("("),k=S.indexOf(")");if(A!==-1&&k+1===S.length){var x=S.substr(0,A),I=S.substr(A+1,k-(A+1)).split(","),M=1;switch(x){case"rgba":if(I.length!==4)return null;M=h(I.pop());case"rgb":return I.length!==3?null:[s(I[0]),s(I[1]),s(I[2]),M];case"hsla":if(I.length!==4)return null;M=h(I.pop());case"hsl":if(I.length!==3)return null;var C=(parseFloat(I[0])%360+360)%360/360,P=h(I[1]),O=h(I[2]),V=O<=.5?O*(P+1):O+P-O*P,G=2*O-V;return[n(255*g(G,V,C+1/3)),n(255*g(G,V,C)),n(255*g(G,V,C-1/3)),M];default:return null}}return null}}catch{}return st}();class tn{constructor(n,s,h,g=1){this.r=n,this.g=s,this.b=h,this.a=g}static parse(n){if(!n)return;if(n instanceof tn)return n;if(typeof n!="string")return;const s=en.parseCSSColor(n);return s?new tn(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3]):void 0}toString(){const[n,s,h,g]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(n)},${Math.round(s)},${Math.round(h)},${g})`}toRenderColor(n){const{r:s,g:h,b:g,a:f}=this;return new xi(n,s,h,g,f)}}class xi{constructor(n,s,h,g,f){if(n){const _=n.image.height,S=_*_;s=f===0?0:s/f*(_-1),h=f===0?0:h/f*(_-1),g=f===0?0:g/f*(_-1);const A=Math.floor(s),k=Math.floor(h),x=Math.floor(g),I=Math.ceil(s),M=Math.ceil(h),C=Math.ceil(g),P=s-A,O=h-k,V=g-x,G=n.image.data,J=4*(A+k*S+x*_),ee=4*(A+k*S+C*_),H=4*(A+M*S+x*_),se=4*(A+M*S+C*_),ue=4*(I+k*S+x*_),we=4*(I+k*S+C*_),Me=4*(I+M*S+x*_),Re=4*(I+M*S+C*_);if(J<0||Re>=G.length)throw new Error("out of range");this.r=In(In(In(G[J],G[ee],V),In(G[H],G[se],V),O),In(In(G[ue],G[we],V),In(G[Me],G[Re],V),O),P)/255*f,this.g=In(In(In(G[J+1],G[ee+1],V),In(G[H+1],G[se+1],V),O),In(In(G[ue+1],G[we+1],V),In(G[Me+1],G[Re+1],V),O),P)/255*f,this.b=In(In(In(G[J+2],G[ee+2],V),In(G[H+2],G[se+2],V),O),In(In(G[ue+2],G[we+2],V),In(G[Me+2],G[Re+2],V),O),P)/255*f,this.a=f}else this.r=s,this.g=h,this.b=g,this.a=f}toArray(){const{r:n,g:s,b:h,a:g}=this;return g===0?[0,0,0,0]:[255*n/g,255*s/g,255*h/g,g]}toArray01(){const{r:n,g:s,b:h,a:g}=this;return g===0?[0,0,0,0]:[n/g,s/g,h/g,g]}toArray01Scaled(n){const{r:s,g:h,b:g,a:f}=this;return f===0?[0,0,0]:[s/f*n,h/f*n,g/f*n]}toArray01PremultipliedAlpha(){const{r:n,g:s,b:h,a:g}=this;return[n,s,h,g]}toArray01Linear(){const{r:n,g:s,b:h,a:g}=this;return g===0?[0,0,0,0]:[Math.pow(n/g,2.2),Math.pow(s/g,2.2),Math.pow(h/g,2.2),g]}}function In(u,n,s){return u*(1-s)+n*s}function ar(u,n,s){return u.map((h,g)=>In(h,n[g],s))}tn.black=new tn(0,0,0,1),tn.white=new tn(1,1,1,1),tn.transparent=new tn(0,0,0,0),tn.red=new tn(1,0,0,1),tn.blue=new tn(0,0,1,1);var Mr=Object.freeze({__proto__:null,array:ar,color:function(u,n,s){return new tn(In(u.r,n.r,s),In(u.g,n.g,s),In(u.b,n.b,s),In(u.a,n.a,s))},number:In});function fr(u,...n){for(const s of n)for(const h in s)u[h]=s[h];return u}class Yr extends Error{constructor(n,s){super(s),this.message=s,this.key=n}}class Er{constructor(n,s=[]){this.parent=n,this.bindings={};for(const[h,g]of s)this.bindings[h]=g}concat(n){return new Er(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const rs={kind:"null"},yn={kind:"number"},fi={kind:"string"},hi={kind:"boolean"},no={kind:"color"},kr={kind:"object"},ri={kind:"value"},oa={kind:"collator"},us={kind:"formatted"},pr={kind:"resolvedImage"};function vo(u,n){return{kind:"array",itemType:u,N:n}}function Xe(u){if(u.kind==="array"){const n=Xe(u.itemType);return typeof u.N=="number"?`array<${n}, ${u.N}>`:u.itemType.kind==="value"?"array":`array<${n}>`}return u.kind}const Dt=[rs,yn,fi,hi,no,us,kr,vo(ri),pr];function Sn(u,n){if(n.kind==="error")return null;if(u.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!Sn(u.itemType,n.itemType))&&(typeof u.N!="number"||u.N===n.N))return null}else{if(u.kind===n.kind)return null;if(u.kind==="value"){for(const s of Dt)if(!Sn(s,n))return null}}return`Expected ${Xe(u)} but found ${Xe(n)} instead.`}function Hn(u,n){return n.some(s=>s.kind===u.kind)}function zi(u,n){return n.some(s=>s==="null"?u===null:s==="array"?Array.isArray(u):s==="object"?u&&!Array.isArray(u)&&typeof u=="object":s===typeof u)}class yi{constructor(n,s,h){this.sensitivity=n?s?"variant":"case":s?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,s){return this.collator.compare(n,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ti{constructor(n,s,h,g,f){this.text=n.normalize?n.normalize():n,this.image=s,this.scale=h,this.fontStack=g,this.textColor=f}}class $i{constructor(n){this.sections=n}static fromString(n){return new $i([new Ti(n,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||n.image&&n.image.namePrimary.length!==0)}static factory(n){return n instanceof $i?n:$i.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}serialize(){const n=["format"];for(const s of this.sections){if(s.image){n.push(["image",s.image.namePrimary]);continue}n.push(s.text);const h={};s.fontStack&&(h["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(h["font-scale"]=s.scale),s.textColor&&(h["text-color"]=["rgba"].concat(s.textColor.toRenderColor(null).toArray())),n.push(h)}return n}}class er{constructor(n){this.namePrimary=n.namePrimary,n.nameSecondary&&(this.nameSecondary=n.nameSecondary),this.available=n.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(n,s){return n?new er({namePrimary:n,nameSecondary:s,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function mr(u,n,s,h){return typeof u=="number"&&u>=0&&u<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof s=="number"&&s>=0&&s<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[u,n,s,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[u,n,s,h]:[u,n,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Kr(u){if(u===null||typeof u=="string"||typeof u=="boolean"||typeof u=="number"||u instanceof tn||u instanceof yi||u instanceof $i||u instanceof er)return!0;if(Array.isArray(u)){for(const n of u)if(!Kr(n))return!1;return!0}if(typeof u=="object"){for(const n in u)if(!Kr(u[n]))return!1;return!0}return!1}function Ni(u){if(u===null)return rs;if(typeof u=="string")return fi;if(typeof u=="boolean")return hi;if(typeof u=="number")return yn;if(u instanceof tn)return no;if(u instanceof yi)return oa;if(u instanceof $i)return us;if(u instanceof er)return pr;if(Array.isArray(u)){const n=u.length;let s;for(const h of u){const g=Ni(h);if(s){if(s===g)continue;s=ri;break}s=g}return vo(s||ri,n)}return kr}function Wi(u){const n=typeof u;return u===null?"":n==="string"||n==="number"||n==="boolean"?String(u):u instanceof tn||u instanceof $i||u instanceof er?u.toString():JSON.stringify(u)}class jr{constructor(n,s){this.type=n,this.value=s}static parse(n,s){if(n.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!Kr(n[1]))return s.error("invalid value");const h=n[1];let g=Ni(h);const f=s.expectedType;return g.kind!=="array"||g.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(g=f),new jr(g,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof tn?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof $i?this.value.serialize():this.value}}class Gi{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}}const js={string:fi,number:yn,boolean:hi,object:kr};class io{constructor(n,s){this.type=n,this.args=s}static parse(n,s){if(n.length<2)return s.error("Expected at least one argument.");let h,g=1;const f=n[0];if(f==="array"){let S,A;if(n.length>2){const k=n[1];if(typeof k!="string"||!(k in js)||k==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);S=js[k],g++}else S=ri;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return s.error('The length argument to "array" must be a positive integer literal',2);A=n[2],g++}h=vo(S,A)}else h=js[f];const _=[];for(;g<n.length;g++){const S=s.parse(n[g],g,ri);if(!S)return null;_.push(S)}return new io(h,_)}evaluate(n){for(let s=0;s<this.args.length;s++){const h=this.args[s].evaluate(n);if(!Sn(this.type,Ni(h)))return h;if(s===this.args.length-1)throw new Gi(`The expression ${JSON.stringify(this.args[s].serialize())} evaluated to ${Xe(Ni(h))} but was expected to be of type ${Xe(this.type)}.`)}return null}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=this.type,s=[n.kind];if(n.kind==="array"){const h=n.itemType;if(h.kind==="string"||h.kind==="number"||h.kind==="boolean"){s.push(h.kind);const g=n.N;(typeof g=="number"||this.args.length>1)&&s.push(g)}}return s.concat(this.args.map(h=>h.serialize()))}}class Vo{constructor(n){this.type=us,this.sections=n}static parse(n,s){if(n.length<2)return s.error("Expected at least one argument.");const h=n[1];if(!Array.isArray(h)&&typeof h=="object")return s.error("First argument must be an image or text section.");const g=[];let f=!1;for(let _=1;_<=n.length-1;++_){const S=n[_];if(f&&typeof S=="object"&&!Array.isArray(S)){f=!1;let A=null;if(S["font-scale"]&&(A=s.parseObjectValue(S["font-scale"],_,"font-scale",yn),!A))return null;let k=null;if(S["text-font"]&&(k=s.parseObjectValue(S["text-font"],_,"text-font",vo(fi)),!k))return null;let x=null;if(S["text-color"]&&(x=s.parseObjectValue(S["text-color"],_,"text-color",no),!x))return null;const I=g[g.length-1];I.scale=A,I.font=k,I.textColor=x}else{const A=s.parse(n[_],_,ri);if(!A)return null;const k=A.type.kind;if(k!=="string"&&k!=="value"&&k!=="null"&&k!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,g.push({content:A,scale:null,font:null,textColor:null})}}return new Vo(g)}evaluate(n){return new $i(this.sections.map(s=>{const h=s.content.evaluate(n);return Ni(h)===pr?new Ti("",h,null,null,null):new Ti(Wi(h),null,s.scale?s.scale.evaluate(n):null,s.font?s.font.evaluate(n).join(","):null,s.textColor?s.textColor.evaluate(n):null)}))}eachChild(n){for(const s of this.sections)n(s.content),s.scale&&n(s.scale),s.font&&n(s.font),s.textColor&&n(s.textColor)}outputDefined(){return!1}serialize(){const n=["format"];for(const s of this.sections){n.push(s.content.serialize());const h={};s.scale&&(h["font-scale"]=s.scale.serialize()),s.font&&(h["text-font"]=s.font.serialize()),s.textColor&&(h["text-color"]=s.textColor.serialize()),n.push(h)}return n}}class sa{constructor(n,s){this.type=pr,this.inputPrimary=n,this.inputSecondary=s}static parse(n,s){if(n.length<2)return s.error("Expected two or more arguments.");const h=s.parse(n[1],1,fi);if(!h)return s.error("No image name provided.");if(n.length===2)return new sa(h);const g=s.parse(n[2],1,fi);return g?new sa(h,g):s.error("Secondary image variant is not a string.")}evaluate(n){const s=er.fromString(this.inputPrimary.evaluate(n),this.inputSecondary?this.inputSecondary.evaluate(n):void 0);return s&&n.availableImages&&(s.available=n.availableImages.indexOf(s.namePrimary)>-1,s.nameSecondary&&s.available&&n.availableImages&&(s.available=n.availableImages.indexOf(s.nameSecondary)>-1)),s}eachChild(n){n(this.inputPrimary),this.inputSecondary&&n(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function Ps(u){return u instanceof Number?"number":u instanceof String?"string":u instanceof Boolean?"boolean":Array.isArray(u)?"array":u===null?"null":typeof u}const aa={"to-boolean":hi,"to-color":no,"to-number":yn,"to-string":fi};class la{constructor(n,s){this.type=n,this.args=s}static parse(n,s){if(n.length<2)return s.error("Expected at least one argument.");const h=n[0],g=[];let f=rs;if(h==="to-array"){if(!Array.isArray(n[1]))return null;const _=n[1].length;if(s.expectedType){if(s.expectedType.kind!=="array")return s.error(`Expected ${s.expectedType.kind} but found array.`);f=vo(s.expectedType.itemType,_)}else{if(!(_>0&&Kr(n[1][0])))return null;f=vo(Ni(n[1][0]),_)}for(let S=0;S<_;S++){const A=n[1][S];let k;if(Ps(A)==="array")k=s.parse(A,void 0,f.itemType);else{const x=Ps(A);if(x!==f.itemType.kind)return s.error(`Expected ${f.itemType.kind} but found ${x}.`);k=s.registry.literal.parse(["literal",A===void 0?null:A],s)}if(!k)return null;g.push(k)}}else{if((h==="to-boolean"||h==="to-string")&&n.length!==2)return s.error("Expected one argument.");f=aa[h];for(let _=1;_<n.length;_++){const S=s.parse(n[_],_,ri);if(!S)return null;g.push(S)}}return new la(f,g)}evaluate(n){if(this.type.kind==="boolean")return!!this.args[0].evaluate(n);if(this.type.kind==="color"){let s,h;for(const g of this.args){if(s=g.evaluate(n),h=null,s instanceof tn)return s;if(typeof s=="string"){const f=n.parseColor(s);if(f)return f}else if(Array.isArray(s)&&(h=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:mr(s[0],s[1],s[2],s[3]),!h))return new tn(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Gi(h||`Could not parse color from value '${typeof s=="string"?s:String(JSON.stringify(s))}'`)}if(this.type.kind==="number"){let s=null;for(const h of this.args){if(s=h.evaluate(n),s===null)return 0;const g=Number(s);if(!isNaN(g))return g}throw new Gi(`Could not convert ${JSON.stringify(s)} to number.`)}return this.type.kind==="formatted"?$i.fromString(Wi(this.args[0].evaluate(n))):this.type.kind==="resolvedImage"?er.fromString(Wi(this.args[0].evaluate(n))):this.type.kind==="array"?this.args.map(s=>s.evaluate(n)):Wi(this.args[0].evaluate(n))}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Vo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new sa(this.args[0]).serialize();const n=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(s=>{n.push(s.serialize())}),n}}const jd=["Unknown","Point","LineString","Polygon"];class Ic{constructor(n,s){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=n,this.options=s}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?jd[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(n){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,s=this.featureDistanceData.scale,{x:h,y:g}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(h*s-n[0])+this.featureDistanceData.bearing[1]*(g*s-n[1])}return 0}parseColor(n){let s=this._parseColorCache[n];return s||(s=this._parseColorCache[n]=tn.parse(n)),s}getConfig(n){return this.options?this.options.get(n):null}}class hs{constructor(n,s,h,g,f){this.name=n,this.type=s,this._evaluate=h,this.args=g,this._overloadIndex=f}evaluate(n){if(!this._evaluate){const s=hs.definitions[this.name];this._evaluate=Array.isArray(s)?s[2]:s.overloads[this._overloadIndex][1]}return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(n=>n.serialize()))}static parse(n,s){const h=n[0],g=hs.definitions[h];if(!g)return s.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(g)?g[0]:g.type,_=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,S=[];let A=null,k=-1;for(const[x,I]of _){if(Array.isArray(x)&&x.length!==n.length-1)continue;S.push(x),k++,A=new H_(s.registry,s.path,null,s.scope,void 0,s._scope,s.options);const M=[];let C=!1;for(let P=1;P<n.length;P++){const O=n[P],V=Array.isArray(x)?x[P-1]:x.type,G=A.parse(O,1+M.length,V);if(!G){C=!0;break}M.push(G)}if(!C)if(Array.isArray(x)&&x.length!==M.length)A.error(`Expected ${x.length} arguments, but found ${M.length} instead.`);else{for(let P=0;P<M.length;P++){const O=Array.isArray(x)?x[P]:x.type,V=M[P];A.concat(P+1).checkSubtype(O,V.type)}if(A.errors.length===0)return new hs(h,f,I,M,k)}}if(S.length===1)s.errors.push(...A.errors);else{const x=(S.length?S:_.map(([M])=>M)).map($d).join(" | "),I=[];for(let M=1;M<n.length;M++){const C=s.parse(n[M],1+I.length);if(!C)return null;I.push(Xe(C.type))}s.error(`Expected arguments of type ${x}, but found (${I.join(", ")}) instead.`)}return null}static register(n,s){hs.definitions=s;for(const h in s)n[h]=hs}}function $d(u){return Array.isArray(u)?`(${u.map(Xe).join(", ")})`:`(${Xe(u.type)}...)`}class Ta{constructor(n,s,h){this.type=oa,this.locale=h,this.caseSensitive=n,this.diacriticSensitive=s}static parse(n,s){if(n.length!==2)return s.error("Expected one argument.");const h=n[1];if(typeof h!="object"||Array.isArray(h))return s.error("Collator options argument must be an object.");const g=h["case-sensitive"]===void 0?s.parse(!1,1,hi):s.parseObjectValue(h["case-sensitive"],1,"case-sensitive",hi);if(!g)return null;const f=h["diacritic-sensitive"]===void 0?s.parse(!1,1,hi):s.parseObjectValue(h["diacritic-sensitive"],1,"diacritic-sensitive",hi);if(!f)return null;let _=null;return h.locale&&(_=s.parseObjectValue(h.locale,1,"locale",fi),!_)?null:new Ta(g,f,_)}evaluate(n){return new yi(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}serialize(){const n={};return n["case-sensitive"]=this.caseSensitive.serialize(),n["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(n.locale=this.locale.serialize()),["collator",n]}}function _h(u,n,s=0,h=u.length-1,g=wl){for(;h>s;){if(h-s>600){const A=h-s+1,k=n-s+1,x=Math.log(A),I=.5*Math.exp(2*x/3),M=.5*Math.sqrt(x*I*(A-I)/A)*(k-A/2<0?-1:1);_h(u,n,Math.max(s,Math.floor(n-k*I/A+M)),Math.min(h,Math.floor(n+(A-k)*I/A+M)),g)}const f=u[n];let _=s,S=h;for(xl(u,s,n),g(u[h],f)>0&&xl(u,s,h);_<S;){for(xl(u,_,S),_++,S--;g(u[_],f)<0;)_++;for(;g(u[S],f)>0;)S--}g(u[s],f)===0?xl(u,s,S):(S++,xl(u,S,h)),S<=n&&(s=S+1),n<=S&&(h=S-1)}}function xl(u,n,s){const h=u[n];u[n]=u[s],u[s]=h}function wl(u,n){return u<n?-1:u>n?1:0}function Gd(u){let n=0;for(let s,h,g=0,f=u.length,_=f-1;g<f;_=g++)s=u[g],h=u[_],n+=(h.x-s.x)*(s.y+h.y);return n}function os(u,n){u[0]=Math.min(u[0],n[0]),u[1]=Math.min(u[1],n[1]),u[2]=Math.max(u[2],n[0]),u[3]=Math.max(u[3],n[1])}function tl(u,n){return!(u[0]<=n[0]||u[2]>=n[2]||u[1]<=n[1]||u[3]>=n[3])}function Hd(u,n,s){const h=u[0]-n[0],g=u[1]-n[1],f=u[0]-s[0],_=u[1]-s[1];return h*_-f*g==0&&h*f<=0&&g*_<=0}function ca(u,n,s=!1){let h=!1;for(let S=0,A=n.length;S<A;S++){const k=n[S];for(let x=0,I=k.length,M=I-1;x<I;M=x++){const C=k[M],P=k[x];if(Hd(u,C,P))return s;(f=C)[1]>(g=u)[1]!=(_=P)[1]>g[1]&&g[0]<(_[0]-f[0])*(g[1]-f[1])/(_[1]-f[1])+f[0]&&(h=!h)}}var g,f,_;return h}function F(u,n,s,h){const g=h[0]-s[0],f=h[1]-s[1],_=(u[0]-s[0])*f-g*(u[1]-s[1]),S=(n[0]-s[0])*f-g*(n[1]-s[1]);return _>0&&S<0||_<0&&S>0}function le(u,n,s,h){return(g=[h[0]-s[0],h[1]-s[1]])[0]*(f=[n[0]-u[0],n[1]-u[1]])[1]-g[1]*f[0]!=0&&!(!F(u,n,s,h)||!F(s,h,u,n));var g,f}const xe=8192;function Be(u,n){const s=(180+u[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u[1]*Math.PI/360)))/360,g=Math.pow(2,n.z);return[Math.round(s*g*xe),Math.round(h*g*xe)]}function dt(u,n){for(let s=0;s<n.length;s++)if(ca(u,n[s]))return!0;return!1}function on(u,n,s){for(const h of s)for(let g=0,f=h.length,_=f-1;g<f;_=g++)if(le(u,n,h[_],h[g]))return!0;return!1}function Kt(u,n){for(let s=0;s<u.length;++s)if(!ca(u[s],n))return!1;for(let s=0;s<u.length-1;++s)if(on(u[s],u[s+1],n))return!1;return!0}function Ir(u,n){for(let s=0;s<n.length;s++)if(Kt(u,n[s]))return!0;return!1}function fo(u,n,s){const h=[];for(let g=0;g<u.length;g++){const f=[];for(let _=0;_<u[g].length;_++){const S=Be(u[g][_],s);os(n,S),f.push(S)}h.push(f)}return h}function Mn(u,n,s){const h=[];for(let g=0;g<u.length;g++){const f=fo(u[g],n,s);h.push(f)}return h}function No(u,n,s,h){if(u[0]<s[0]||u[0]>s[2]){const g=.5*h;let f=u[0]-s[0]>g?-h:s[0]-u[0]>g?h:0;f===0&&(f=u[0]-s[2]>g?-h:s[2]-u[0]>g?h:0),u[0]+=f}os(n,u)}function Ao(u,n,s,h){const g=Math.pow(2,h.z)*xe,f=[h.x*xe,h.y*xe],_=[];if(!u)return _;for(const S of u)for(const A of S){const k=[A.x+f[0],A.y+f[1]];No(k,n,s,g),_.push(k)}return _}function nl(u,n,s,h){const g=Math.pow(2,h.z)*xe,f=[h.x*xe,h.y*xe],_=[];if(!u)return _;for(const A of u){const k=[];for(const x of A){const I=[x.x+f[0],x.y+f[1]];os(n,I),k.push(I)}_.push(k)}if(n[2]-n[0]<=g/2){(S=n)[0]=S[1]=1/0,S[2]=S[3]=-1/0;for(const A of _)for(const k of A)No(k,n,s,g)}var S;return _}class Uo{constructor(n,s){this.type=hi,this.geojson=n,this.geometries=s}static parse(n,s){if(n.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(Kr(n[1])){const h=n[1];if(h.type==="FeatureCollection")for(let g=0;g<h.features.length;++g){const f=h.features[g].geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new Uo(h,h.features[g].geometry)}else if(h.type==="Feature"){const g=h.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Uo(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new Uo(h,h)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(s,h){const g=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],_=s.canonicalID();if(!_)return!1;if(h.type==="Polygon"){const S=fo(h.coordinates,f,_),A=Ao(s.geometry(),g,f,_);if(!tl(g,f))return!1;for(const k of A)if(!ca(k,S))return!1}if(h.type==="MultiPolygon"){const S=Mn(h.coordinates,f,_),A=Ao(s.geometry(),g,f,_);if(!tl(g,f))return!1;for(const k of A)if(!dt(k,S))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(s,h){const g=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],_=s.canonicalID();if(!_)return!1;if(h.type==="Polygon"){const S=fo(h.coordinates,f,_),A=nl(s.geometry(),g,f,_);if(!tl(g,f))return!1;for(const k of A)if(!Kt(k,S))return!1}if(h.type==="MultiPolygon"){const S=Mn(h.coordinates,f,_),A=nl(s.geometry(),g,f,_);if(!tl(g,f))return!1;for(const k of A)if(!Ir(k,S))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Ea={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Po=1/298.257223563,qd=Po*(2-Po),au=Math.PI/180;class lu{static fromTile(n,s,h){const g=Math.PI*(1-2*(n+.5)/Math.pow(2,s)),f=Math.atan(.5*(Math.exp(g)-Math.exp(-g)))/au;return new lu(f,h)}static get units(){return Ea}constructor(n,s){if(n===void 0)throw new Error("No latitude given.");if(s&&!Ea[s])throw new Error(`Unknown unit ${s}. Use one of: ${Object.keys(Ea).join(", ")}`);const h=6378.137*au*(s?Ea[s]:1),g=Math.cos(n*au),f=1/(1-qd*(1-g*g)),_=Math.sqrt(f);this.kx=h*_*g,this.ky=h*_*f*(1-qd)}distance(n,s){const h=$r(n[0]-s[0])*this.kx,g=(n[1]-s[1])*this.ky;return Math.sqrt(h*h+g*g)}bearing(n,s){const h=$r(s[0]-n[0])*this.kx;return Math.atan2(h,(s[1]-n[1])*this.ky)/au}destination(n,s,h){const g=h*au;return this.offset(n,Math.sin(g)*s,Math.cos(g)*s)}offset(n,s,h){return[n[0]+s/this.kx,n[1]+h/this.ky]}lineDistance(n){let s=0;for(let h=0;h<n.length-1;h++)s+=this.distance(n[h],n[h+1]);return s}area(n){let s=0;for(let h=0;h<n.length;h++){const g=n[h];for(let f=0,_=g.length,S=_-1;f<_;S=f++)s+=$r(g[f][0]-g[S][0])*(g[f][1]+g[S][1])*(h?-1:1)}return Math.abs(s)/2*this.kx*this.ky}along(n,s){let h=0;if(s<=0)return n[0];for(let g=0;g<n.length-1;g++){const f=n[g],_=n[g+1],S=this.distance(f,_);if(h+=S,h>s)return Sl(f,_,(s-(h-S))/S)}return n[n.length-1]}pointToSegmentDistance(n,s,h){let[g,f]=s,_=$r(h[0]-g)*this.kx,S=(h[1]-f)*this.ky;if(_!==0||S!==0){const A=($r(n[0]-g)*this.kx*_+(n[1]-f)*this.ky*S)/(_*_+S*S);A>1?(g=h[0],f=h[1]):A>0&&(g+=_/this.kx*A,f+=S/this.ky*A)}return _=$r(n[0]-g)*this.kx,S=(n[1]-f)*this.ky,Math.sqrt(_*_+S*S)}pointOnLine(n,s){let h=1/0,g=n[0][0],f=n[0][1],_=0,S=0;for(let A=0;A<n.length-1;A++){let k=n[A][0],x=n[A][1],I=$r(n[A+1][0]-k)*this.kx,M=(n[A+1][1]-x)*this.ky,C=0;I===0&&M===0||(C=($r(s[0]-k)*this.kx*I+(s[1]-x)*this.ky*M)/(I*I+M*M),C>1?(k=n[A+1][0],x=n[A+1][1]):C>0&&(k+=I/this.kx*C,x+=M/this.ky*C)),I=$r(s[0]-k)*this.kx,M=(s[1]-x)*this.ky;const P=I*I+M*M;P<h&&(h=P,g=k,f=x,_=A,S=C)}return{point:[g,f],index:_,t:Math.max(0,Math.min(1,S))}}lineSlice(n,s,h){let g=this.pointOnLine(h,n),f=this.pointOnLine(h,s);if(g.index>f.index||g.index===f.index&&g.t>f.t){const k=g;g=f,f=k}const _=[g.point],S=g.index+1,A=f.index;!Wd(h[S],_[0])&&S<=A&&_.push(h[S]);for(let k=S+1;k<=A;k++)_.push(h[k]);return Wd(h[A],f.point)||_.push(f.point),_}lineSliceAlong(n,s,h){let g=0;const f=[];for(let _=0;_<h.length-1;_++){const S=h[_],A=h[_+1],k=this.distance(S,A);if(g+=k,g>n&&f.length===0&&f.push(Sl(S,A,(n-(g-k))/k)),g>=s)return f.push(Sl(S,A,(s-(g-k))/k)),f;g>n&&f.push(A)}return f}bufferPoint(n,s){const h=s/this.ky,g=s/this.kx;return[n[0]-g,n[1]-h,n[0]+g,n[1]+h]}bufferBBox(n,s){const h=s/this.ky,g=s/this.kx;return[n[0]-g,n[1]-h,n[2]+g,n[3]+h]}insideBBox(n,s){return $r(n[0]-s[0])>=0&&$r(n[0]-s[2])<=0&&n[1]>=s[1]&&n[1]<=s[3]}}function Wd(u,n){return u[0]===n[0]&&u[1]===n[1]}function Sl(u,n,s){const h=$r(n[0]-u[0]);return[u[0]+h*s,u[1]+(n[1]-u[1])*s]}function $r(u){for(;u<-180;)u+=360;for(;u>180;)u-=360;return u}class Wp{constructor(n=[],s=(h,g)=>h<g?-1:h>g?1:0){if(this.data=n,this.length=this.data.length,this.compare=s,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],s=this.data.pop();return--this.length>0&&(this.data[0]=s,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:s,compare:h}=this,g=s[n];for(;n>0;){const f=n-1>>1,_=s[f];if(h(g,_)>=0)break;s[n]=_,n=f}s[n]=g}_down(n){const{data:s,compare:h}=this,g=this.length>>1,f=s[n];for(;n<g;){let _=1+(n<<1);const S=_+1;if(S<this.length&&h(s[S],s[_])<0&&(_=S),h(s[_],f)>=0)break;s[n]=s[_],n=_}s[n]=f}}var _n=8192;function z_(u,n){return n.dist-u.dist}const cu=100,Zd=50;function Xd(u){const n=[1/0,1/0,-1/0,-1/0];if(n.length!==u.length)return!1;for(let s=0;s<n.length;s++)if(n[s]!==u[s])return!1;return!0}function Yd(u){return u[1]-u[0]+1}function Tl(u,n){const s=u[1]>=u[0]&&u[1]<n;return s||console.warn("Distance Expression: Index is out of range"),s}function Zp(u,n){if(u[0]>u[1])return[null,null];const s=Yd(u);if(n){if(s===2)return[u,null];const h=Math.floor(s/2);return[[u[0],u[0]+h],[u[0]+h,u[1]]]}{if(s===1)return[u,null];const h=Math.floor(s/2)-1;return[[u[0],u[0]+h],[u[0]+h+1,u[1]]]}}function ua(u,n){const s=[1/0,1/0,-1/0,-1/0];if(!Tl(n,u.length))return s;for(let h=n[0];h<=n[1];++h)os(s,u[h]);return s}function Kd(u){const n=[1/0,1/0,-1/0,-1/0];for(let s=0;s<u.length;++s)for(let h=0;h<u[s].length;++h)os(n,u[s][h]);return n}function uu(u,n,s){if(Xd(u)||Xd(n))return NaN;let h=0,g=0;return u[2]<n[0]&&(h=n[0]-u[2]),u[0]>n[2]&&(h=u[0]-n[2]),u[1]>n[3]&&(g=u[1]-n[3]),u[3]<n[1]&&(g=n[1]-u[3]),s.distance([0,0],[h,g])}function B_(u){return 360*u-180}function F_(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function ha(u,n){const s=Math.pow(2,n.z),h=(u.y/_n+n.y)/s;return[B_((u.x/_n+n.x)/s),F_(h)]}function V_(u,n){const s=[];for(let h=0;h<u.length;++h)s.push(ha(u[h],n));return s}function Xp(u,n,s){const h=s.pointOnLine(n,u).point;return s.distance(u,h)}function Yp(u,n,s,h,g){const f=s.slice(h[0],h[1]+1);let _=1/0;for(let S=n[0];S<=n[1];++S)if((_=Math.min(_,Xp(u[S],f,g)))===0)return 0;return _}function Jd(u,n,s,h,g){const f=Math.min(g.pointToSegmentDistance(u,s,h),g.pointToSegmentDistance(n,s,h)),_=Math.min(g.pointToSegmentDistance(s,u,n),g.pointToSegmentDistance(h,u,n));return Math.min(f,_)}function N_(u,n,s,h,g){if(!Tl(n,u.length)||!Tl(h,s.length))return NaN;let f=1/0;for(let _=n[0];_<n[1];++_)for(let S=h[0];S<h[1];++S){if(le(u[_],u[_+1],s[S],s[S+1]))return 0;f=Math.min(f,Jd(u[_],u[_+1],s[S],s[S+1],g))}return f}function U_(u,n,s,h,g){if(!Tl(n,u.length)||!Tl(h,s.length))return NaN;let f=1/0;for(let _=n[0];_<=n[1];++_)for(let S=h[0];S<=h[1];++S)if((f=Math.min(f,g.distance(u[_],s[S])))===0)return f;return f}function j_(u,n,s){if(ca(u,n,!0))return 0;let h=1/0;for(const g of n){const f=g.length;if(f<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(g[0]!==g[f-1]&&(h=Math.min(h,s.pointToSegmentDistance(u,g[f-1],g[0])))===0||(h=Math.min(h,Xp(u,g,s)))===0)return h}return h}function $_(u,n,s,h){if(!Tl(n,u.length))return NaN;for(let f=n[0];f<=n[1];++f)if(ca(u[f],s,!0))return 0;let g=1/0;for(let f=n[0];f<n[1];++f)for(const _ of s)for(let S=0,A=_.length,k=A-1;S<A;k=S++){if(le(u[f],u[f+1],_[k],_[S]))return 0;g=Math.min(g,Jd(u[f],u[f+1],_[k],_[S],h))}return g}function Kp(u,n){for(const s of u)for(let h=0;h<=s.length-1;++h)if(ca(s[h],n,!0))return!0;return!1}function G_(u,n,s,h=1/0){const g=Kd(u),f=Kd(n);if(h!==1/0&&uu(g,f,s)>=h)return h;if(tl(g,f)){if(Kp(u,n))return 0}else if(Kp(n,u))return 0;let _=h;for(const S of u)for(let A=0,k=S.length,x=k-1;A<k;x=A++)for(const I of n)for(let M=0,C=I.length,P=C-1;M<C;P=M++){if(le(S[x],S[A],I[P],I[M]))return 0;_=Math.min(_,Jd(S[x],S[A],I[P],I[M],s))}return _}function vh(u,n,s,h,g,f,_){if(f===null||_===null)return;const S=uu(ua(h,f),ua(g,_),s);S<n&&u.push({dist:S,range1:f,range2:_})}function Qd(u,n,s,h,g=1/0){let f=Math.min(h.distance(u[0],s[0][0]),g);if(f===0)return f;const _=new Wp([{dist:0,range1:[0,u.length-1],range2:[0,0]}],z_),S=n?Zd:cu,A=Kd(s);for(;_.length;){const k=_.pop();if(k.dist>=f)continue;const x=k.range1;if(Yd(x)<=S){if(!Tl(x,u.length))return NaN;if(n){const I=$_(u,x,s,h);if((f=Math.min(f,I))===0)return f}else for(let I=x[0];I<=x[1];++I){const M=j_(u[I],s,h);if((f=Math.min(f,M))===0)return f}}else{const I=Zp(x,n);if(I[0]!==null){const M=uu(ua(u,I[0]),A,h);M<f&&_.push({dist:M,range1:I[0],range2:[0,0]})}if(I[1]!==null){const M=uu(ua(u,I[1]),A,h);M<f&&_.push({dist:M,range1:I[1],range2:[0,0]})}}}return f}function yh(u,n,s,h,g,f=1/0){let _=Math.min(f,g.distance(u[0],s[0]));if(_===0)return _;const S=new Wp([{dist:0,range1:[0,u.length-1],range2:[0,s.length-1]}],z_),A=n?Zd:cu,k=h?Zd:cu;for(;S.length;){const x=S.pop();if(x.dist>=_)continue;const I=x.range1,M=x.range2;if(Yd(I)<=A&&Yd(M)<=k){if(!Tl(I,u.length)||!Tl(M,s.length))return NaN;if(n&&h?_=Math.min(_,N_(u,I,s,M,g)):n||h?n&&!h?_=Math.min(_,Yp(s,M,u,I,g)):!n&&h&&(_=Math.min(_,Yp(u,I,s,M,g))):_=Math.min(_,U_(u,I,s,M,g)),_===0)return _}else{const C=Zp(I,n),P=Zp(M,h);vh(S,_,g,u,s,C[0],P[0]),vh(S,_,g,u,s,C[0],P[1]),vh(S,_,g,u,s,C[1],P[0]),vh(S,_,g,u,s,C[1],P[1])}}return _}function hu(u,n,s,h,g=1/0){let f=g;const _=ua(u,[0,u.length-1]);for(const S of s)if(!(f!==1/0&&uu(_,ua(S,[0,S.length-1]),h)>=f)&&(f=Math.min(f,yh(u,n,S,!0,h,f)),f===0))return f;return f}function bh(u,n,s,h,g=1/0){let f=g;const _=ua(u,[0,u.length-1]);for(const S of s){if(f!==1/0&&uu(_,Kd(S),h)>=f)continue;const A=Qd(u,n,S,h,f);if(isNaN(A))return A;if((f=Math.min(f,A))===0)return f}return f}function ef(u){return u==="Point"||u==="MultiPoint"||u==="LineString"||u==="MultiLineString"||u==="Polygon"||u==="MultiPolygon"}class Zl{constructor(n,s){this.type=yn,this.geojson=n,this.geometries=s}static parse(n,s){if(n.length!==2)return s.error(`'distance' expression requires either one argument, but found ' ${n.length-1} instead.`);if(Kr(n[1])){const h=n[1];if(h.type==="FeatureCollection"){for(let g=0;g<h.features.length;++g)if(ef(h.features[g].geometry.type))return new Zl(h,h.features[g].geometry)}else if(h.type==="Feature"){if(ef(h.geometry.type))return new Zl(h,h.geometry)}else if(ef(h.type))return new Zl(h,h)}return s.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(n){const s=n.geometry(),h=n.canonicalID();if(s!=null&&h!=null){if(n.geometryType()==="Point")return function(g,f,_){const S=[];for(const k of g)for(const x of k)S.push(ha(x,f));const A=new lu(S[0][1],"meters");return _.type==="Point"||_.type==="MultiPoint"||_.type==="LineString"?yh(S,!1,_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",A):_.type==="MultiLineString"?hu(S,!1,_.coordinates,A):_.type==="Polygon"||_.type==="MultiPolygon"?bh(S,!1,_.type==="Polygon"?[_.coordinates]:_.coordinates,A):null}(s,h,this.geometries);if(n.geometryType()==="LineString")return function(g,f,_){const S=[];for(const k of g){const x=[];for(const I of k)x.push(ha(I,f));S.push(x)}const A=new lu(S[0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return hu(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",S,A);if(_.type==="MultiLineString"){let k=1/0;for(let x=0;x<_.coordinates.length;x++){const I=hu(_.coordinates[x],!0,S,A,k);if(isNaN(I))return I;if((k=Math.min(k,I))===0)return k}return k}if(_.type==="Polygon"||_.type==="MultiPolygon"){let k=1/0;for(let x=0;x<S.length;x++){const I=bh(S[x],!0,_.type==="Polygon"?[_.coordinates]:_.coordinates,A,k);if(isNaN(I))return I;if((k=Math.min(k,I))===0)return k}return k}return null}(s,h,this.geometries);if(n.geometryType()==="Polygon")return function(g,f,_){const S=[];for(const k of function(x,I){const M=x.length;if(M<=1)return[x];const C=[];let P,O;for(let V=0;V<M;V++){const G=Gd(x[V]);G!==0&&(x[V].area=Math.abs(G),O===void 0&&(O=G<0),O===G<0?(P&&C.push(P),P=[x[V]]):P.push(x[V]))}return P&&C.push(P),C}(g)){const x=[];for(let I=0;I<k.length;++I)x.push(V_(k[I],f));S.push(x)}const A=new lu(S[0][0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return bh(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",S,A);if(_.type==="MultiLineString"){let k=1/0;for(let x=0;x<_.coordinates.length;x++){const I=bh(_.coordinates[x],!0,S,A,k);if(isNaN(I))return I;if((k=Math.min(k,I))===0)return k}return k}return _.type==="Polygon"||_.type==="MultiPolygon"?function(k,x,I){let M=1/0;for(const C of k)for(const P of x){const O=G_(C,P,I,M);if(isNaN(O))return O;if((M=Math.min(M,O))===0)return M}return M}(_.type==="Polygon"?[_.coordinates]:_.coordinates,S,A):null}(s,h,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Xl(u,n){switch(u){case"string":return Wi(n);case"number":return+n;case"boolean":return!!n;case"color":return tn.parse(n);case"formatted":return $i.fromString(Wi(n));case"resolvedImage":return er.fromString(Wi(n))}return n}function Ei(u,n,s,h){return h!==void 0&&(u=h*Math.round(u/h)),n!==void 0&&u<n&&(u=n),s!==void 0&&u>s&&(u=s),u}class du{constructor(n,s,h){this.type=n,this.key=s,this.scope=h}static parse(n,s){let h=s.expectedType;if(h==null&&(h=ri),n.length<2||n.length>3)return s.error("Invalid number of arguments for 'config' expression.");const g=s.parse(n[1],1);if(!(g instanceof jr))return s.error("Key name of 'config' expression must be a string literal.");if(n.length>=3){const f=s.parse(n[2],2);return f instanceof jr?new du(h,Wi(g.value),Wi(f.value)):s.error("Scope of 'config' expression must be a string literal.")}return new du(h,Wi(g.value))}evaluate(n){const s=[this.key,this.scope,n.scope].filter(Boolean).join(""),h=n.getConfig(s);if(!h)return null;const{type:g,value:f,values:_,minValue:S,maxValue:A,stepValue:k}=h,x=h.default.evaluate(n);let I=x;if(f){const M=n.scope;n.scope=(M||"").split("").slice(1).join(""),I=f.evaluate(n),n.scope=M}return g&&(I=Xl(g,I)),I===void 0||S===void 0&&A===void 0&&k===void 0||(typeof I=="number"?I=Ei(I,S,A,k):Array.isArray(I)&&(I=I.map(M=>typeof M=="number"?Ei(M,S,A,k):M))),f!==void 0&&I!==void 0&&_&&!_.includes(I)&&(I=x,g&&(I=Xl(g,I))),(g&&g!==this.type||I!==void 0&&Ni(I)!==this.type)&&(I=Xl(this.type.kind,I)),I}eachChild(){}outputDefined(){return!1}serialize(){const n=["config",this.key];return this.scope&&n.concat(this.key),n}}function xh(u){if(u instanceof hs&&(u.name==="get"&&u.args.length===1||u.name==="feature-state"||u.name==="has"&&u.args.length===1||u.name==="properties"||u.name==="geometry-type"||u.name==="id"||/^filter-/.test(u.name))||u instanceof Uo||u instanceof Zl)return!1;let n=!0;return u.eachChild(s=>{n&&!xh(s)&&(n=!1)}),n}function tf(u){if(u instanceof hs&&u.name==="feature-state")return!1;let n=!0;return u.eachChild(s=>{n&&!tf(s)&&(n=!1)}),n}function nf(u){if(u instanceof du)return new Set([u.key]);let n=new Set;return u.eachChild(s=>{n=new Set([...n,...nf(s)])}),n}function wh(u,n){if(u instanceof hs&&n.indexOf(u.name)>=0)return!1;let s=!0;return u.eachChild(h=>{s&&!wh(h,n)&&(s=!1)}),s}class tr{constructor(n,s){this.type=s.type,this.name=n,this.boundExpression=s}static parse(n,s){if(n.length!==2||typeof n[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const h=n[1];return s.scope.has(h)?new tr(h,s.scope.get(h)):s.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Jp{constructor(n,s=[],h,g=new Er,f=[],_,S){this.registry=n,this.path=s,this.key=s.map(A=>typeof A=="string"?`['${A}']`:`[${A}]`).join(""),this.scope=g,this.errors=f,this.expectedType=h,this._scope=_,this.options=S}parse(n,s,h,g,f={}){return s||h?this.concat(s,null,h,g)._parse(n,f):this._parse(n,f)}parseObjectValue(n,s,h,g,f,_={}){return this.concat(s,h,g,f)._parse(n,_)}_parse(n,s){function h(g,f,_){return _==="assert"?new io(f,[g]):_==="coerce"?new la(f,[g]):g}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=typeof n[0]=="string"?this.registry[n[0]]:void 0;if(g){let f=g.parse(n,this);if(!f)return null;if(this.expectedType){const _=this.expectedType,S=f.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||S.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||S.kind!=="value"&&S.kind!=="string"){if(this.checkSubtype(_,S))return null}else f=h(f,_,s.typeAnnotation||"coerce");else f=h(f,_,s.typeAnnotation||"assert")}if(!(f instanceof jr)&&f.type.kind!=="resolvedImage"&&Qp(f)){const _=new Ic(this._scope,this.options);try{f=new jr(f.type,f.evaluate(_))}catch(S){return this.error(S.message),null}}return f}return la.parse(["to-array",n],this)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,s,h,g){let f=typeof n=="number"?this.path.concat(n):this.path;f=typeof s=="string"?f.concat(s):f;const _=g?this.scope.concat(g):this.scope;return new Jp(this.registry,f,h||null,_,this.errors,this._scope,this.options)}error(n,...s){const h=`${this.key}${s.map(g=>`[${g}]`).join("")}`;this.errors.push(new Yr(h,n))}checkSubtype(n,s){const h=Sn(n,s);return h&&this.error(h),h}}var H_=Jp;function Qp(u){if(u instanceof tr)return Qp(u.boundExpression);if(u instanceof hs&&u.name==="error"||u instanceof Ta||u instanceof Uo||u instanceof Zl||u instanceof du)return!1;const n=u instanceof la||u instanceof io;let s=!0;return u.eachChild(h=>{s=n?s&&Qp(h):s&&h instanceof jr}),!!s&&xh(u)&&wh(u,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function rf(u,n){const s=u.length-1;let h,g,f=0,_=s,S=0;for(;f<=_;)if(S=Math.floor((f+_)/2),h=u[S],g=u[S+1],h<=n){if(S===s||n<g)return S;f=S+1}else{if(!(h>n))throw new Gi("Input is not a number.");_=S-1}return 0}class Sh{constructor(n,s,h){this.type=n,this.input=s,this.labels=[],this.outputs=[];for(const[g,f]of h)this.labels.push(g),this.outputs.push(f)}static parse(n,s){if(n.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return s.error("Expected an even number of arguments.");const h=s.parse(n[1],1,yn);if(!h)return null;const g=[];let f=null;s.expectedType&&s.expectedType.kind!=="value"&&(f=s.expectedType);for(let _=1;_<n.length;_+=2){const S=_===1?-1/0:n[_],A=n[_+1],k=_,x=_+1;if(typeof S!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(g.length&&g[g.length-1][0]>=S)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);const I=s.parse(A,x,f);if(!I)return null;f=f||I.type,g.push([S,I])}return new Sh(f,h,g)}evaluate(n){const s=this.labels,h=this.outputs;if(s.length===1)return h[0].evaluate(n);const g=this.input.evaluate(n);if(g<=s[0])return h[0].evaluate(n);const f=s.length;return g>=s[f-1]?h[f-1].evaluate(n):h[rf(s,g)].evaluate(n)}eachChild(n){n(this.input);for(const s of this.outputs)n(s)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){const n=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&n.push(this.labels[s]),n.push(this.outputs[s].serialize());return n}}const q_=.95047,W_=1.08883,Z_=4/29,fu=6/29,X_=3*fu*fu,Sb=fu*fu*fu,Tb=Math.PI/180,Eb=180/Math.PI;function em(u){return u>Sb?Math.pow(u,1/3):u/X_+Z_}function tm(u){return u>fu?u*u*u:X_*(u-Z_)}function nm(u){return 255*(u<=.0031308?12.92*u:1.055*Math.pow(u,1/2.4)-.055)}function im(u){return(u/=255)<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function Y_(u){const n=im(u.r),s=im(u.g),h=im(u.b),g=em((.4124564*n+.3575761*s+.1804375*h)/q_),f=em((.2126729*n+.7151522*s+.072175*h)/1);return{l:116*f-16,a:500*(g-f),b:200*(f-em((.0193339*n+.119192*s+.9503041*h)/W_)),alpha:u.a}}function K_(u){let n=(u.l+16)/116,s=isNaN(u.a)?n:n+u.a/500,h=isNaN(u.b)?n:n-u.b/200;return n=1*tm(n),s=q_*tm(s),h=W_*tm(h),new tn(nm(3.2404542*s-1.5371385*n-.4985314*h),nm(-.969266*s+1.8760108*n+.041556*h),nm(.0556434*s-.2040259*n+1.0572252*h),u.alpha)}function Ib(u,n,s){const h=n-u;return u+s*(h>180||h<-180?h-360*Math.round(h/360):h)}const Th={forward:Y_,reverse:K_,interpolate:function(u,n,s){return{l:In(u.l,n.l,s),a:In(u.a,n.a,s),b:In(u.b,n.b,s),alpha:In(u.alpha,n.alpha,s)}}},Eh={forward:function(u){const{l:n,a:s,b:h}=Y_(u),g=Math.atan2(h,s)*Eb;return{h:g<0?g+360:g,c:Math.sqrt(s*s+h*h),l:n,alpha:u.a}},reverse:function(u){const n=u.h*Tb,s=u.c;return K_({l:u.l,a:Math.cos(n)*s,b:Math.sin(n)*s,alpha:u.alpha})},interpolate:function(u,n,s){return{h:Ib(u.h,n.h,s),c:In(u.c,n.c,s),l:In(u.l,n.l,s),alpha:In(u.alpha,n.alpha,s)}}};var J_=Object.freeze({__proto__:null,hcl:Eh,lab:Th});class da{constructor(n,s,h,g,f){this.type=n,this.operator=s,this.interpolation=h,this.input=g,this.labels=[],this.outputs=[];for(const[_,S]of f)this.labels.push(_),this.outputs.push(S)}static interpolationFactor(n,s,h,g){let f=0;if(n.name==="exponential")f=rm(s,n.base,h,g);else if(n.name==="linear")f=rm(s,1,h,g);else if(n.name==="cubic-bezier"){const _=n.controlPoints;f=new Ae(_[0],_[1],_[2],_[3]).solve(rm(s,1,h,g))}return f}static parse(n,s){let[h,g,f,..._]=n;if(!Array.isArray(g)||g.length===0)return s.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const k=g[1];if(typeof k!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:k}}else{if(g[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const k=g.slice(1);if(k.length!==4||k.some(x=>typeof x!="number"||x<0||x>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:k}}}if(n.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(f=s.parse(f,2,yn),!f)return null;const S=[];let A=null;h==="interpolate-hcl"||h==="interpolate-lab"?A=no:s.expectedType&&s.expectedType.kind!=="value"&&(A=s.expectedType);for(let k=0;k<_.length;k+=2){const x=_[k],I=_[k+1],M=k+3,C=k+4;if(typeof x!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(S.length&&S[S.length-1][0]>=x)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);const P=s.parse(I,C,A);if(!P)return null;A=A||P.type,S.push([x,P])}return A.kind==="number"||A.kind==="color"||A.kind==="array"&&A.itemType.kind==="number"&&typeof A.N=="number"?new da(A,h,g,f,S):s.error(`Type ${Xe(A)} is not interpolatable.`)}evaluate(n){const s=this.labels,h=this.outputs;if(s.length===1)return h[0].evaluate(n);const g=this.input.evaluate(n);if(g<=s[0])return h[0].evaluate(n);const f=s.length;if(g>=s[f-1])return h[f-1].evaluate(n);const _=rf(s,g),S=da.interpolationFactor(this.interpolation,g,s[_],s[_+1]),A=h[_].evaluate(n),k=h[_+1].evaluate(n);return this.operator==="interpolate"?Mr[this.type.kind.toLowerCase()](A,k,S):this.operator==="interpolate-hcl"?Eh.reverse(Eh.interpolate(Eh.forward(A),Eh.forward(k),S)):Th.reverse(Th.interpolate(Th.forward(A),Th.forward(k),S))}eachChild(n){n(this.input);for(const s of this.outputs)n(s)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){let n;n=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const s=[this.operator,n,this.input.serialize()];for(let h=0;h<this.labels.length;h++)s.push(this.labels[h],this.outputs[h].serialize());return s}}function rm(u,n,s,h){const g=h-s,f=u-s;return g===0?0:n===1?f/g:(Math.pow(n,f)-1)/(Math.pow(n,g)-1)}class of{constructor(n,s){this.type=n,this.args=s}static parse(n,s){if(n.length<2)return s.error("Expectected at least one argument.");let h=null;const g=s.expectedType;g&&g.kind!=="value"&&(h=g);const f=[];for(const S of n.slice(1)){const A=s.parse(S,1+f.length,h,void 0,{typeAnnotation:"omit"});if(!A)return null;h=h||A.type,f.push(A)}const _=g&&f.some(S=>Sn(g,S.type));return new of(_?ri:h,f)}evaluate(n){let s,h=null,g=0;for(const f of this.args){if(g++,h=f.evaluate(n),h&&h instanceof er&&!h.available&&(s||(s=h),h=null,g===this.args.length))return s;if(h!==null)break}return h}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=["coalesce"];return this.eachChild(s=>{n.push(s.serialize())}),n}}class sf{constructor(n,s){this.type=s.type,this.bindings=[].concat(n),this.result=s}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const s of this.bindings)n(s[1]);n(this.result)}static parse(n,s){if(n.length<4)return s.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const h=[];for(let f=1;f<n.length-1;f+=2){const _=n[f];if(typeof _!="string")return s.error(`Expected string, but found ${typeof _} instead.`,f);if(/[^a-zA-Z0-9_]/.test(_))return s.error("Variable names must contain only alphanumeric characters or '_'.",f);const S=s.parse(n[f+1],f+1);if(!S)return null;h.push([_,S])}const g=s.parse(n[n.length-1],n.length-1,s.expectedType,h);return g?new sf(h,g):null}outputDefined(){return this.result.outputDefined()}serialize(){const n=["let"];for(const[s,h]of this.bindings)n.push(s,h.serialize());return n.push(this.result.serialize()),n}}class om{constructor(n,s,h){this.type=n,this.index=s,this.input=h}static parse(n,s){if(n.length!==3)return s.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const h=s.parse(n[1],1,yn),g=s.parse(n[2],2,vo(s.expectedType||ri));return h&&g?new om(g.type.itemType,h,g):null}evaluate(n){const s=this.index.evaluate(n),h=this.input.evaluate(n);if(s<0)throw new Gi(`Array index out of bounds: ${s} < 0.`);if(s>=h.length)throw new Gi(`Array index out of bounds: ${s} > ${h.length-1}.`);if(s!==Math.floor(s))throw new Gi(`Array index must be an integer, but found ${s} instead.`);return h[s]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class sm{constructor(n,s){this.type=hi,this.needle=n,this.haystack=s}static parse(n,s){if(n.length!==3)return s.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const h=s.parse(n[1],1,ri),g=s.parse(n[2],2,ri);return h&&g?Hn(h.type,[hi,fi,yn,rs,ri])?new sm(h,g):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Xe(h.type)} instead`):null}evaluate(n){const s=this.needle.evaluate(n),h=this.haystack.evaluate(n);if(h==null)return!1;if(!zi(s,["boolean","string","number","null"]))throw new Gi(`Expected first argument to be of type boolean, string, number or null, but found ${Xe(Ni(s))} instead.`);if(!zi(h,["string","array"]))throw new Gi(`Expected second argument to be of type array or string, but found ${Xe(Ni(h))} instead.`);return h.indexOf(s)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class af{constructor(n,s,h){this.type=yn,this.needle=n,this.haystack=s,this.fromIndex=h}static parse(n,s){if(n.length<=2||n.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const h=s.parse(n[1],1,ri),g=s.parse(n[2],2,ri);if(!h||!g)return null;if(!Hn(h.type,[hi,fi,yn,rs,ri]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${Xe(h.type)} instead`);if(n.length===4){const f=s.parse(n[3],3,yn);return f?new af(h,g,f):null}return new af(h,g)}evaluate(n){const s=this.needle.evaluate(n),h=this.haystack.evaluate(n);if(!zi(s,["boolean","string","number","null"]))throw new Gi(`Expected first argument to be of type boolean, string, number or null, but found ${Xe(Ni(s))} instead.`);if(!zi(h,["string","array"]))throw new Gi(`Expected second argument to be of type array or string, but found ${Xe(Ni(h))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(n);return h.indexOf(s,g)}return h.indexOf(s)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const n=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),n]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class am{constructor(n,s,h,g,f,_){this.inputType=n,this.type=s,this.input=h,this.cases=g,this.outputs=f,this.otherwise=_}static parse(n,s){if(n.length<5)return s.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return s.error("Expected an even number of arguments.");let h,g;s.expectedType&&s.expectedType.kind!=="value"&&(g=s.expectedType);const f={},_=[];for(let k=2;k<n.length-1;k+=2){let x=n[k];const I=n[k+1];Array.isArray(x)||(x=[x]);const M=s.concat(k);if(x.length===0)return M.error("Expected at least one branch label.");for(const P of x){if(typeof P!="number"&&typeof P!="string")return M.error("Branch labels must be numbers or strings.");if(typeof P=="number"&&Math.abs(P)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof P=="number"&&Math.floor(P)!==P)return M.error("Numeric branch labels must be integer values.");if(h){if(M.checkSubtype(h,Ni(P)))return null}else h=Ni(P);if(f[String(P)]!==void 0)return M.error("Branch labels must be unique.");f[String(P)]=_.length}const C=s.parse(I,k,g);if(!C)return null;g=g||C.type,_.push(C)}const S=s.parse(n[1],1,ri);if(!S)return null;const A=s.parse(n[n.length-1],n.length-1,g);return A?S.type.kind!=="value"&&s.concat(1).checkSubtype(h,S.type)?null:new am(h,g,S,f,_,A):null}evaluate(n){const s=this.input.evaluate(n);return(Ni(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),h=[],g={};for(const _ of s){const S=g[this.cases[_]];S===void 0?(g[this.cases[_]]=h.length,h.push([this.cases[_],[_]])):h[S][1].push(_)}const f=_=>this.inputType.kind==="number"?Number(_):_;for(const[_,S]of h)n.push(S.length===1?f(S[0]):S.map(f)),n.push(this.outputs[_].serialize());return n.push(this.otherwise.serialize()),n}}class Ih{constructor(n,s,h){this.type=n,this.branches=s,this.otherwise=h}static parse(n,s){if(n.length<4)return s.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return s.error("Expected an odd number of arguments.");let h;s.expectedType&&s.expectedType.kind!=="value"&&(h=s.expectedType);const g=[];for(let _=1;_<n.length-1;_+=2){const S=s.parse(n[_],_,hi);if(!S)return null;const A=s.parse(n[_+1],_+1,h);if(!A)return null;g.push([S,A]),h=h||A.type}const f=s.parse(n[n.length-1],n.length-1,h);return f?new Ih(h,g,f):null}evaluate(n){for(const[s,h]of this.branches)if(s.evaluate(n))return h.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[s,h]of this.branches)n(s),n(h);n(this.otherwise)}outputDefined(){return this.branches.every(([n,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["case"];return this.eachChild(s=>{n.push(s.serialize())}),n}}class lf{constructor(n,s,h,g){this.type=n,this.input=s,this.beginIndex=h,this.endIndex=g}static parse(n,s){if(n.length<=2||n.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const h=s.parse(n[1],1,ri),g=s.parse(n[2],2,yn);if(!h||!g)return null;if(!Hn(h.type,[vo(ri),fi,ri]))return s.error(`Expected first argument to be of type array or string, but found ${Xe(h.type)} instead`);if(n.length===4){const f=s.parse(n[3],3,yn);return f?new lf(h.type,h,g,f):null}return new lf(h.type,h,g)}evaluate(n){const s=this.input.evaluate(n),h=this.beginIndex.evaluate(n);if(!zi(s,["string","array"]))throw new Gi(`Expected first argument to be of type array or string, but found ${Xe(Ni(s))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(n);return s.slice(h,g)}return s.slice(h)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const n=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),n]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function lm(u,n){return u==="=="||u==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function Q_(u,n,s,h){return h.compare(n,s)===0}function pu(u,n,s){const h=u!=="=="&&u!=="!=";return class wO{constructor(f,_,S){this.type=hi,this.lhs=f,this.rhs=_,this.collator=S,this.hasUntypedArgument=f.type.kind==="value"||_.type.kind==="value"}static parse(f,_){if(f.length!==3&&f.length!==4)return _.error("Expected two or three arguments.");const S=f[0];let A=_.parse(f[1],1,ri);if(!A)return null;if(!lm(S,A.type))return _.concat(1).error(`"${S}" comparisons are not supported for type '${Xe(A.type)}'.`);let k=_.parse(f[2],2,ri);if(!k)return null;if(!lm(S,k.type))return _.concat(2).error(`"${S}" comparisons are not supported for type '${Xe(k.type)}'.`);if(A.type.kind!==k.type.kind&&A.type.kind!=="value"&&k.type.kind!=="value")return _.error(`Cannot compare types '${Xe(A.type)}' and '${Xe(k.type)}'.`);h&&(A.type.kind==="value"&&k.type.kind!=="value"?A=new io(k.type,[A]):A.type.kind!=="value"&&k.type.kind==="value"&&(k=new io(A.type,[k])));let x=null;if(f.length===4){if(A.type.kind!=="string"&&k.type.kind!=="string"&&A.type.kind!=="value"&&k.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(x=_.parse(f[3],3,oa),!x)return null}return new wO(A,k,x)}evaluate(f){const _=this.lhs.evaluate(f),S=this.rhs.evaluate(f);if(h&&this.hasUntypedArgument){const A=Ni(_),k=Ni(S);if(A.kind!==k.kind||A.kind!=="string"&&A.kind!=="number")throw new Gi(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${A.kind}, ${k.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const A=Ni(_),k=Ni(S);if(A.kind!=="string"||k.kind!=="string")return n(f,_,S)}return this.collator?s(f,_,S,this.collator.evaluate(f)):n(f,_,S)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[u];return this.eachChild(_=>{f.push(_.serialize())}),f}}}const Cb=pu("==",function(u,n,s){return n===s},Q_),ev=pu("!=",function(u,n,s){return n!==s},function(u,n,s,h){return!Q_(0,n,s,h)}),tv=pu("<",function(u,n,s){return n<s},function(u,n,s,h){return h.compare(n,s)<0}),mu=pu(">",function(u,n,s){return n>s},function(u,n,s,h){return h.compare(n,s)>0}),nv=pu("<=",function(u,n,s){return n<=s},function(u,n,s,h){return h.compare(n,s)<=0}),iv=pu(">=",function(u,n,s){return n>=s},function(u,n,s,h){return h.compare(n,s)>=0});class cm{constructor(n,s,h,g,f,_){this.type=fi,this.number=n,this.locale=s,this.currency=h,this.unit=g,this.minFractionDigits=f,this.maxFractionDigits=_}static parse(n,s){if(n.length!==3)return s.error("Expected two arguments.");const h=s.parse(n[1],1,yn);if(!h)return null;const g=n[2];if(typeof g!="object"||Array.isArray(g))return s.error("NumberFormat options argument must be an object.");let f=null;if(g.locale&&(f=s.parseObjectValue(g.locale,2,"locale",fi),!f))return null;let _=null;if(g.currency&&(_=s.parseObjectValue(g.currency,2,"currency",fi),!_))return null;let S=null;if(g.unit&&(S=s.parseObjectValue(g.unit,2,"unit",fi),!S))return null;let A=null;if(g["min-fraction-digits"]&&(A=s.parseObjectValue(g["min-fraction-digits"],2,"min-fraction-digits",yn),!A))return null;let k=null;return g["max-fraction-digits"]&&(k=s.parseObjectValue(g["max-fraction-digits"],2,"max-fraction-digits",yn),!k)?null:new cm(h,f,_,S,A,k)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(n):void 0,unit:this.unit?this.unit.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.unit&&n(this.unit),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const n={};return this.locale&&(n.locale=this.locale.serialize()),this.currency&&(n.currency=this.currency.serialize()),this.unit&&(n.unit=this.unit.serialize()),this.minFractionDigits&&(n["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(n["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),n]}}class Ch{constructor(n){this.type=yn,this.input=n}static parse(n,s){if(n.length!==2)return s.error(`Expected 1 argument, but found ${n.length-1} instead.`);const h=s.parse(n[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${Xe(h.type)} instead.`):new Ch(h):null}evaluate(n){const s=this.input.evaluate(n);if(typeof s=="string"||Array.isArray(s))return s.length;throw new Gi(`Expected value to be of type string or array, but found ${Xe(Ni(s))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}serialize(){const n=["length"];return this.eachChild(s=>{n.push(s.serialize())}),n}}function cf(u){return function(){u=1831565813+(u|=0)|0;let n=Math.imul(u^u>>>15,1|u);return n=n+Math.imul(n^n>>>7,61|n)^n,((n^n>>>14)>>>0)/4294967296}}const gu={"==":Cb,"!=":ev,">":mu,"<":tv,">=":iv,"<=":nv,array:io,at:om,boolean:io,case:Ih,coalesce:of,collator:Ta,format:Vo,image:sa,in:sm,"index-of":af,interpolate:da,"interpolate-hcl":da,"interpolate-lab":da,length:Ch,let:sf,literal:jr,match:am,number:io,"number-format":cm,object:io,slice:lf,step:Sh,string:io,"to-boolean":la,"to-color":la,"to-number":la,"to-string":la,var:tr,within:Uo,distance:Zl,config:du};function rv(u,[n,s,h,g]){n=n.evaluate(u),s=s.evaluate(u),h=h.evaluate(u);const f=g?g.evaluate(u):1,_=mr(n,s,h,f);if(_)throw new Gi(_);return new tn(n/255*f,s/255*f,h/255*f,f)}function um(u,[n,s,h,g]){n=n.evaluate(u),s=s.evaluate(u),h=h.evaluate(u);const f=g?g.evaluate(u):1,_=function(k,x,I,M){return typeof k=="number"&&k>=0&&k<=360?typeof x=="number"&&x>=0&&x<=100&&typeof I=="number"&&I>=0&&I<=100?M===void 0||typeof M=="number"&&M>=0&&M<=1?null:`Invalid hsla value [${[k,x,I,M].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof M=="number"?[k,x,I,M]:[k,x,I]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof M=="number"?[k,x,I,M]:[k,x,I]).join(", ")}]: 'h' must be between 0 and 360.`}(n,s,h,f);if(_)throw new Gi(_);const S=`hsla(${n}, ${s}%, ${h}%, ${f})`,A=tn.parse(S);if(!A)throw new Gi(`Failed to parse HSLA color: ${S}`);return A}function hm(u,n){return u in n}function dm(u,n){const s=n[u];return s===void 0?null:s}function Cc(u){return{type:u}}function ov(u){return{result:"success",value:u}}function Yl(u){return{result:"error",value:u}}function fm(u,n){return!!u&&!!u.parameters&&u.parameters.indexOf(n)>-1}function uf(u){return u["property-type"]==="data-driven"}function pm(u){return fm(u.expression,"measure-light")}function sv(u){return fm(u.expression,"zoom")}function mm(u){return!!u.expression&&u.expression.interpolated}function hf(u){return typeof u=="object"&&u!==null&&!Array.isArray(u)}function av(u){return u}function lv(u,n){const s=n.type==="color",h=u.stops&&typeof u.stops[0][0]=="object",g=h||!(h||u.property!==void 0),f=u.type||(mm(n)?"exponential":"interval");if(s&&((u=fr({},u)).stops&&(u.stops=u.stops.map(k=>[k[0],tn.parse(k[1])])),u.default=tn.parse(u.default?u.default:n.default)),u.colorSpace&&u.colorSpace!=="rgb"&&!J_[u.colorSpace])throw new Error(`Unknown color space: ${u.colorSpace}`);let _,S,A;if(f==="exponential")_=uv;else if(f==="interval")_=cv;else if(f==="categorical"){_=Ab,S=Object.create(null);for(const k of u.stops)S[k[0]]=k[1];A=typeof u.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);_=Pb}if(h){const k={},x=[];for(let C=0;C<u.stops.length;C++){const P=u.stops[C],O=P[0].zoom;k[O]===void 0&&(k[O]={zoom:O,type:u.type,property:u.property,default:u.default,stops:[]},x.push(O)),k[O].stops.push([P[0].value,P[1]])}const I=[];for(const C of x)I.push([k[C].zoom,lv(k[C],n)]);const M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:da.interpolationFactor.bind(void 0,M),zoomStops:I.map(C=>C[0]),evaluate:({zoom:C},P)=>uv({stops:I,base:u.base},n,C).evaluate(C,P)}}if(g){const k=f==="exponential"?{name:"exponential",base:u.base!==void 0?u.base:1}:null;return{kind:"camera",interpolationType:k,interpolationFactor:da.interpolationFactor.bind(void 0,k),zoomStops:u.stops.map(x=>x[0]),evaluate:({zoom:x})=>_(u,n,x,S,A)}}return{kind:"source",evaluate(k,x){const I=x&&x.properties?x.properties[u.property]:void 0;return I===void 0?Ah(u.default,n.default):_(u,n,I,S,A)}}}function Ah(u,n,s){return u!==void 0?u:n!==void 0?n:s!==void 0?s:void 0}function Ab(u,n,s,h,g){return Ah(typeof s===g?h[s]:void 0,u.default,n.default)}function cv(u,n,s){if(Ps(s)!=="number")return Ah(u.default,n.default);const h=u.stops.length;if(h===1||s<=u.stops[0][0])return u.stops[0][1];if(s>=u.stops[h-1][0])return u.stops[h-1][1];const g=rf(u.stops.map(f=>f[0]),s);return u.stops[g][1]}function uv(u,n,s){const h=u.base!==void 0?u.base:1;if(Ps(s)!=="number")return Ah(u.default,n.default);const g=u.stops.length;if(g===1||s<=u.stops[0][0])return u.stops[0][1];if(s>=u.stops[g-1][0])return u.stops[g-1][1];const f=rf(u.stops.map(x=>x[0]),s),_=function(x,I,M,C){const P=C-M,O=x-M;return P===0?0:I===1?O/P:(Math.pow(I,O)-1)/(Math.pow(I,P)-1)}(s,h,u.stops[f][0],u.stops[f+1][0]),S=u.stops[f][1],A=u.stops[f+1][1];let k=Mr[n.type]||av;if(u.colorSpace&&u.colorSpace!=="rgb"){const x=J_[u.colorSpace];k=(I,M)=>x.reverse(x.interpolate(x.forward(I),x.forward(M),_))}return typeof S.evaluate=="function"?{evaluate(...x){const I=S.evaluate.apply(void 0,x),M=A.evaluate.apply(void 0,x);if(I!==void 0&&M!==void 0)return k(I,M,_)}}:k(S,A,_)}function Pb(u,n,s){return n.type==="color"?s=tn.parse(s):n.type==="formatted"?s=$i.fromString(s.toString()):n.type==="resolvedImage"?s=er.fromString(s.toString()):Ps(s)===n.type||n.type==="enum"&&n.values[s]||(s=void 0),Ah(s,u.default,n.default)}hs.register(gu,{error:[{kind:"error"},[fi],(u,[n])=>{throw new Gi(n.evaluate(u))}],typeof:[fi,[ri],(u,[n])=>Xe(Ni(n.evaluate(u)))],"to-rgba":[vo(yn,4),[no],(u,[n])=>n.evaluate(u).toRenderColor(null).toArray()],rgb:[no,[yn,yn,yn],rv],rgba:[no,[yn,yn,yn,yn],rv],hsl:[no,[yn,yn,yn],um],hsla:[no,[yn,yn,yn,yn],um],has:{type:hi,overloads:[[[fi],(u,[n])=>hm(n.evaluate(u),u.properties())],[[fi,kr],(u,[n,s])=>hm(n.evaluate(u),s.evaluate(u))]]},get:{type:ri,overloads:[[[fi],(u,[n])=>dm(n.evaluate(u),u.properties())],[[fi,kr],(u,[n,s])=>dm(n.evaluate(u),s.evaluate(u))]]},"feature-state":[ri,[fi],(u,[n])=>dm(n.evaluate(u),u.featureState||{})],properties:[kr,[],u=>u.properties()],"geometry-type":[fi,[],u=>u.geometryType()],id:[ri,[],u=>u.id()],zoom:[yn,[],u=>u.globals.zoom],pitch:[yn,[],u=>u.globals.pitch||0],"distance-from-center":[yn,[],u=>u.distanceFromCenter()],"measure-light":[yn,[fi],(u,[n])=>u.measureLight(n.evaluate(u))],"heatmap-density":[yn,[],u=>u.globals.heatmapDensity||0],"line-progress":[yn,[],u=>u.globals.lineProgress||0],"raster-value":[yn,[],u=>u.globals.rasterValue||0],"raster-particle-speed":[yn,[],u=>u.globals.rasterParticleSpeed||0],"sky-radial-progress":[yn,[],u=>u.globals.skyRadialProgress||0],accumulated:[ri,[],u=>u.globals.accumulated===void 0?null:u.globals.accumulated],"+":[yn,Cc(yn),(u,n)=>{let s=0;for(const h of n)s+=h.evaluate(u);return s}],"*":[yn,Cc(yn),(u,n)=>{let s=1;for(const h of n)s*=h.evaluate(u);return s}],"-":{type:yn,overloads:[[[yn,yn],(u,[n,s])=>n.evaluate(u)-s.evaluate(u)],[[yn],(u,[n])=>-n.evaluate(u)]]},"/":[yn,[yn,yn],(u,[n,s])=>n.evaluate(u)/s.evaluate(u)],"%":[yn,[yn,yn],(u,[n,s])=>n.evaluate(u)%s.evaluate(u)],ln2:[yn,[],()=>Math.LN2],pi:[yn,[],()=>Math.PI],e:[yn,[],()=>Math.E],"^":[yn,[yn,yn],(u,[n,s])=>Math.pow(n.evaluate(u),s.evaluate(u))],sqrt:[yn,[yn],(u,[n])=>Math.sqrt(n.evaluate(u))],log10:[yn,[yn],(u,[n])=>Math.log(n.evaluate(u))/Math.LN10],ln:[yn,[yn],(u,[n])=>Math.log(n.evaluate(u))],log2:[yn,[yn],(u,[n])=>Math.log(n.evaluate(u))/Math.LN2],sin:[yn,[yn],(u,[n])=>Math.sin(n.evaluate(u))],cos:[yn,[yn],(u,[n])=>Math.cos(n.evaluate(u))],tan:[yn,[yn],(u,[n])=>Math.tan(n.evaluate(u))],asin:[yn,[yn],(u,[n])=>Math.asin(n.evaluate(u))],acos:[yn,[yn],(u,[n])=>Math.acos(n.evaluate(u))],atan:[yn,[yn],(u,[n])=>Math.atan(n.evaluate(u))],min:[yn,Cc(yn),(u,n)=>Math.min(...n.map(s=>s.evaluate(u)))],max:[yn,Cc(yn),(u,n)=>Math.max(...n.map(s=>s.evaluate(u)))],abs:[yn,[yn],(u,[n])=>Math.abs(n.evaluate(u))],round:[yn,[yn],(u,[n])=>{const s=n.evaluate(u);return s<0?-Math.round(-s):Math.round(s)}],floor:[yn,[yn],(u,[n])=>Math.floor(n.evaluate(u))],ceil:[yn,[yn],(u,[n])=>Math.ceil(n.evaluate(u))],"filter-==":[hi,[fi,ri],(u,[n,s])=>u.properties()[n.value]===s.value],"filter-id-==":[hi,[ri],(u,[n])=>u.id()===n.value],"filter-type-==":[hi,[fi],(u,[n])=>u.geometryType()===n.value],"filter-<":[hi,[fi,ri],(u,[n,s])=>{const h=u.properties()[n.value],g=s.value;return typeof h==typeof g&&h<g}],"filter-id-<":[hi,[ri],(u,[n])=>{const s=u.id(),h=n.value;return typeof s==typeof h&&s<h}],"filter->":[hi,[fi,ri],(u,[n,s])=>{const h=u.properties()[n.value],g=s.value;return typeof h==typeof g&&h>g}],"filter-id->":[hi,[ri],(u,[n])=>{const s=u.id(),h=n.value;return typeof s==typeof h&&s>h}],"filter-<=":[hi,[fi,ri],(u,[n,s])=>{const h=u.properties()[n.value],g=s.value;return typeof h==typeof g&&h<=g}],"filter-id-<=":[hi,[ri],(u,[n])=>{const s=u.id(),h=n.value;return typeof s==typeof h&&s<=h}],"filter->=":[hi,[fi,ri],(u,[n,s])=>{const h=u.properties()[n.value],g=s.value;return typeof h==typeof g&&h>=g}],"filter-id->=":[hi,[ri],(u,[n])=>{const s=u.id(),h=n.value;return typeof s==typeof h&&s>=h}],"filter-has":[hi,[ri],(u,[n])=>n.value in u.properties()],"filter-has-id":[hi,[],u=>u.id()!==null&&u.id()!==void 0],"filter-type-in":[hi,[vo(fi)],(u,[n])=>n.value.indexOf(u.geometryType())>=0],"filter-id-in":[hi,[vo(ri)],(u,[n])=>n.value.indexOf(u.id())>=0],"filter-in-small":[hi,[fi,vo(ri)],(u,[n,s])=>s.value.indexOf(u.properties()[n.value])>=0],"filter-in-large":[hi,[fi,vo(ri)],(u,[n,s])=>function(h,g,f,_){for(;f<=_;){const S=f+_>>1;if(g[S]===h)return!0;g[S]>h?_=S-1:f=S+1}return!1}(u.properties()[n.value],s.value,0,s.value.length-1)],all:{type:hi,overloads:[[[hi,hi],(u,[n,s])=>n.evaluate(u)&&s.evaluate(u)],[Cc(hi),(u,n)=>{for(const s of n)if(!s.evaluate(u))return!1;return!0}]]},any:{type:hi,overloads:[[[hi,hi],(u,[n,s])=>n.evaluate(u)||s.evaluate(u)],[Cc(hi),(u,n)=>{for(const s of n)if(s.evaluate(u))return!0;return!1}]]},"!":[hi,[hi],(u,[n])=>!n.evaluate(u)],"is-supported-script":[hi,[fi],(u,[n])=>{const s=u.globals&&u.globals.isSupportedScript;return!s||s(n.evaluate(u))}],upcase:[fi,[fi],(u,[n])=>n.evaluate(u).toUpperCase()],downcase:[fi,[fi],(u,[n])=>n.evaluate(u).toLowerCase()],concat:[fi,Cc(ri),(u,n)=>n.map(s=>Wi(s.evaluate(u))).join("")],"resolved-locale":[fi,[oa],(u,[n])=>n.evaluate(u).resolvedLocale()],random:[yn,[yn,yn,ri],(u,n)=>{const[s,h,g]=n.map(_=>_.evaluate(u));if(s>h||s===h)return s;let f;if(typeof g=="string")f=function(_){let S=0;if(_.length===0)return S;for(let A=0;A<_.length;A++)S=(S<<5)-S+_.charCodeAt(A),S|=0;return S}(g);else{if(typeof g!="number")throw new Gi(`Invalid seed input: ${g}`);f=g}return s+cf(f)()*(h-s)}]});class df{constructor(n,s,h,g){this.expression=n,this._warningHistory={},this._evaluator=new Ic(h,g),this._defaultValue=s?function(f){return f.type==="color"&&(hf(f.default)||Array.isArray(f.default))?new tn(0,0,0,0):f.type==="color"?tn.parse(f.default)||null:f.default===void 0?null:f.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(n,s,h,g,f,_,S,A){return this._evaluator.globals=n,this._evaluator.feature=s,this._evaluator.featureState=h,this._evaluator.canonical=g||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=A||null,this.expression.evaluate(this._evaluator)}evaluate(n,s,h,g,f,_,S,A){this._evaluator.globals=n,this._evaluator.feature=s||null,this._evaluator.featureState=h||null,this._evaluator.canonical=g||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=A||null;try{const k=this.expression.evaluate(this._evaluator);if(k==null||typeof k=="number"&&k!=k)return this._defaultValue;if(this._enumValues&&!(k in this._enumValues))throw new Gi(`Expected value to be one of ${Object.keys(this._enumValues).map(x=>JSON.stringify(x)).join(", ")}, but found ${JSON.stringify(k)} instead.`);return k}catch(k){return this._warningHistory[k.message]||(this._warningHistory[k.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${k.message}`)),this._defaultValue}}}function ff(u){return Array.isArray(u)&&u.length>0&&typeof u[0]=="string"&&u[0]in gu}function Ph(u,n,s,h){const g=new H_(gu,[],n?function(_){const S={color:no,string:fi,number:yn,enum:fi,boolean:hi,formatted:us,resolvedImage:pr};return _.type==="array"?vo(S[_.value]||ri,_.length):S[_.type]}(n):void 0,void 0,void 0,s,h),f=g.parse(u,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?ov(new df(f,n,s,h)):Yl(g.errors)}class gm{constructor(n,s,h){this.kind=n,this._styleExpression=s,this.isLightConstant=h,this.isStateDependent=n!=="constant"&&!tf(s.expression),this.configDependencies=nf(s.expression)}evaluateWithoutErrorHandling(n,s,h,g,f,_){return this._styleExpression.evaluateWithoutErrorHandling(n,s,h,g,f,_)}evaluate(n,s,h,g,f,_){return this._styleExpression.evaluate(n,s,h,g,f,_)}}class il{constructor(n,s,h,g,f){this.kind=n,this.zoomStops=h,this._styleExpression=s,this.isStateDependent=n!=="camera"&&!tf(s.expression),this.isLightConstant=f,this.configDependencies=nf(s.expression),this.interpolationType=g}evaluateWithoutErrorHandling(n,s,h,g,f,_){return this._styleExpression.evaluateWithoutErrorHandling(n,s,h,g,f,_)}evaluate(n,s,h,g,f,_){return this._styleExpression.evaluate(n,s,h,g,f,_)}interpolationFactor(n,s,h){return this.interpolationType?da.interpolationFactor(this.interpolationType,n,s,h):0}}function hv(u,n,s,h){if((u=Ph(u,n,s,h)).result==="error")return u;const g=u.value.expression,f=xh(g);if(!f&&!uf(n))return Yl([new Yr("","data expressions not supported")]);const _=wh(g,["zoom","pitch","distance-from-center"]);if(!_&&!sv(n))return Yl([new Yr("","zoom expressions not supported")]);const S=wh(g,["measure-light"]);if(!S&&!pm(n))return Yl([new Yr("","measure-light expression not supported")]);const A=n.expression&&n.expression.relaxZoomRestriction,k=mf(g);return k||_||A?k instanceof Yr?Yl([k]):k instanceof da&&!mm(n)?Yl([new Yr("",'"interpolate" expressions cannot be used with this property')]):ov(k?new il(f?"camera":"composite",u.value,k.labels,k instanceof da?k.interpolation:void 0,S):new gm(f?"constant":"source",u.value,S)):Yl([new Yr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class pf{constructor(n,s){this._parameters=n,this._specification=s,fr(this,lv(this._parameters,this._specification))}static deserialize(n){return new pf(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function mf(u){let n=null;if(u instanceof sf)n=mf(u.result);else if(u instanceof of){for(const s of u.args)if(n=mf(s),n)break}else(u instanceof Sh||u instanceof da)&&u.input instanceof hs&&u.input.name==="zoom"&&(n=u);return n instanceof Yr||u.eachChild(s=>{const h=mf(s);h instanceof Yr?n=h:n&&h&&n!==h&&(n=new Yr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}var gf,_m,dv=function(){if(_m)return gf;_m=1,gf=n;var u=3;function n(s,h,g){var f=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var _=new Int32Array(this.arrayBuffer);s=_[0],this.d=(h=_[1])+2*(g=_[2]);for(var S=0;S<this.d*this.d;S++){var A=_[u+S],k=_[u+S+1];f.push(A===k?null:_.subarray(A,k))}var x=_[u+f.length+1];this.keys=_.subarray(_[u+f.length],x),this.bboxes=_.subarray(x),this.insert=this._insertReadonly}else{this.d=h+2*g;for(var I=0;I<this.d*this.d;I++)f.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=s,this.padding=g,this.scale=h/s,this.uid=0;var M=g/h*s;this.min=-M,this.max=s+M}return n.prototype.insert=function(s,h,g,f,_){this._forEachCell(h,g,f,_,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(f),this.bboxes.push(_)},n.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},n.prototype._insertCell=function(s,h,g,f,_,S){this.cells[_].push(S)},n.prototype.query=function(s,h,g,f,_){var S=this.min,A=this.max;if(s<=S&&h<=S&&A<=g&&A<=f&&!_)return Array.prototype.slice.call(this.keys);var k=[];return this._forEachCell(s,h,g,f,this._queryCell,k,{},_),k},n.prototype._queryCell=function(s,h,g,f,_,S,A,k){var x=this.cells[_];if(x!==null)for(var I=this.keys,M=this.bboxes,C=0;C<x.length;C++){var P=x[C];if(A[P]===void 0){var O=4*P;(k?k(M[O+0],M[O+1],M[O+2],M[O+3]):s<=M[O+2]&&h<=M[O+3]&&g>=M[O+0]&&f>=M[O+1])?(A[P]=!0,S.push(I[P])):A[P]=!1}}},n.prototype._forEachCell=function(s,h,g,f,_,S,A,k){for(var x=this._convertToCellCoord(s),I=this._convertToCellCoord(h),M=this._convertToCellCoord(g),C=this._convertToCellCoord(f),P=x;P<=M;P++)for(var O=I;O<=C;O++){var V=this.d*O+P;if((!k||k(this._convertFromCellCoord(P),this._convertFromCellCoord(O),this._convertFromCellCoord(P+1),this._convertFromCellCoord(O+1)))&&_.call(this,s,h,g,f,V,S,A,k))return}},n.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},n.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},n.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,h=u+this.cells.length+1+1,g=0,f=0;f<this.cells.length;f++)g+=this.cells[f].length;var _=new Int32Array(h+g+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var S=h,A=0;A<s.length;A++){var k=s[A];_[u+A]=S,_.set(k,S),S+=k.length}return _[u+s.length]=S,_.set(this.keys,S),_[u+s.length+1]=S+=this.keys.length,_.set(this.bboxes,S),S+=this.bboxes.length,_.buffer},gf}(),Ac=D(dv);const _u={};function Pn(u,n,s={}){Object.defineProperty(u,"_classRegistryKey",{value:n,writable:!1}),_u[n]={klass:u,omit:s.omit||[]}}Pn(Object,"Object"),Ac.serialize=function(u,n){const s=u.toArrayBuffer();return n&&n.add(s),{buffer:s}},Ac.deserialize=function(u){return new Ac(u.buffer)},Object.defineProperty(Ac,"name",{value:"Grid"}),Pn(Ac,"Grid"),Pn(tn,"Color"),Pn(Error,"Error"),Pn($i,"Formatted"),Pn(Ti,"FormattedSection"),Pn(ja,"AJAXError"),Pn(er,"ResolvedImage"),Pn(pf,"StylePropertyFunction"),Pn(df,"StyleExpression",{omit:["_evaluator"]}),Pn(il,"ZoomDependentExpression"),Pn(gm,"ZoomConstantExpression"),Pn(hs,"CompoundExpression",{omit:["_evaluate"]});for(const u in gu)_u[gu[u]._classRegistryKey]||Pn(gu[u],`Expression${u}`);function vm(u){return u&&typeof ArrayBuffer<"u"&&(u instanceof ArrayBuffer||u.constructor&&u.constructor.name==="ArrayBuffer")}function fv(u){return self.ImageBitmap&&u instanceof ImageBitmap}function $s(u,n){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp)return u;if(vm(u)||fv(u))return n&&n.add(u),u;if(ArrayBuffer.isView(u)){const s=u;return n&&n.add(s.buffer),s}if(u instanceof ImageData)return n&&n.add(u.data.buffer),u;if(Array.isArray(u)){const s=[];for(const h of u)s.push($s(h,n));return s}if(u instanceof Map){const s={$name:"Map"};for(const[h,g]of u.entries())s[h]=$s(g);return s}if(u instanceof Set){const s={$name:"Set"};let h=0;for(const g of u.values())s[++h]=$s(g);return s}if(typeof u=="object"){const s=u.constructor,h=s._classRegistryKey;if(!h)throw new Error(`can't serialize object of unregistered class ${h}`);const g=s.serialize?s.serialize(u,n):{};if(!s.serialize){for(const f in u)u.hasOwnProperty(f)&&(_u[h].omit.indexOf(f)>=0||(g[f]=$s(u[f],n)));u instanceof Error&&(g.message=u.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return h!=="Object"&&(g.$name=h),g}throw new Error("can't serialize object of type "+typeof u)}function Pc(u){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||vm(u)||fv(u)||ArrayBuffer.isView(u)||u instanceof ImageData)return u;if(Array.isArray(u))return u.map(Pc);if(typeof u=="object"){const n=u.$name||"Object";if(n==="Map"){const g=new Map;for(const f of Object.keys(u))f!=="$name"&&g.set(f,Pc(u[f]));return g}if(n==="Set"){const g=new Set;for(const f of Object.keys(u))f!=="$name"&&g.add(Pc(u[f]));return g}const{klass:s}=_u[n];if(!s)throw new Error(`can't deserialize unregistered class ${n}`);if(s.deserialize)return s.deserialize(u);const h=Object.create(s.prototype);for(const g of Object.keys(u))g!=="$name"&&(h[g]=Pc(u[g]));return h}throw new Error("can't deserialize object of type "+typeof u)}const Ln={"Latin-1 Supplement":u=>u>=128&&u<=255,Arabic:u=>u>=1536&&u<=1791,"Arabic Supplement":u=>u>=1872&&u<=1919,"Arabic Extended-A":u=>u>=2208&&u<=2303,"Hangul Jamo":u=>u>=4352&&u<=4607,"Unified Canadian Aboriginal Syllabics":u=>u>=5120&&u<=5759,Khmer:u=>u>=6016&&u<=6143,"Unified Canadian Aboriginal Syllabics Extended":u=>u>=6320&&u<=6399,"General Punctuation":u=>u>=8192&&u<=8303,"Letterlike Symbols":u=>u>=8448&&u<=8527,"Number Forms":u=>u>=8528&&u<=8591,"Miscellaneous Technical":u=>u>=8960&&u<=9215,"Control Pictures":u=>u>=9216&&u<=9279,"Optical Character Recognition":u=>u>=9280&&u<=9311,"Enclosed Alphanumerics":u=>u>=9312&&u<=9471,"Geometric Shapes":u=>u>=9632&&u<=9727,"Miscellaneous Symbols":u=>u>=9728&&u<=9983,"Miscellaneous Symbols and Arrows":u=>u>=11008&&u<=11263,"CJK Radicals Supplement":u=>u>=11904&&u<=12031,"Kangxi Radicals":u=>u>=12032&&u<=12255,"Ideographic Description Characters":u=>u>=12272&&u<=12287,"CJK Symbols and Punctuation":u=>u>=12288&&u<=12351,Hiragana:u=>u>=12352&&u<=12447,Katakana:u=>u>=12448&&u<=12543,Bopomofo:u=>u>=12544&&u<=12591,"Hangul Compatibility Jamo":u=>u>=12592&&u<=12687,Kanbun:u=>u>=12688&&u<=12703,"Bopomofo Extended":u=>u>=12704&&u<=12735,"CJK Strokes":u=>u>=12736&&u<=12783,"Katakana Phonetic Extensions":u=>u>=12784&&u<=12799,"Enclosed CJK Letters and Months":u=>u>=12800&&u<=13055,"CJK Compatibility":u=>u>=13056&&u<=13311,"CJK Unified Ideographs Extension A":u=>u>=13312&&u<=19903,"Yijing Hexagram Symbols":u=>u>=19904&&u<=19967,"CJK Unified Ideographs":u=>u>=19968&&u<=40959,"Yi Syllables":u=>u>=40960&&u<=42127,"Yi Radicals":u=>u>=42128&&u<=42191,"Hangul Jamo Extended-A":u=>u>=43360&&u<=43391,"Hangul Syllables":u=>u>=44032&&u<=55215,"Hangul Jamo Extended-B":u=>u>=55216&&u<=55295,"Private Use Area":u=>u>=57344&&u<=63743,"CJK Compatibility Ideographs":u=>u>=63744&&u<=64255,"Arabic Presentation Forms-A":u=>u>=64336&&u<=65023,"Vertical Forms":u=>u>=65040&&u<=65055,"CJK Compatibility Forms":u=>u>=65072&&u<=65103,"Small Form Variants":u=>u>=65104&&u<=65135,"Arabic Presentation Forms-B":u=>u>=65136&&u<=65279,"Halfwidth and Fullwidth Forms":u=>u>=65280&&u<=65519,"CJK Unified Ideographs Extension B":u=>u>=131072&&u<=173791};function _f(u){for(const n of u)if(yf(n.charCodeAt(0)))return!0;return!1}function Mb(u){for(const n of u)if(!vf(n.charCodeAt(0)))return!1;return!0}function vf(u){return!(Ln.Arabic(u)||Ln["Arabic Supplement"](u)||Ln["Arabic Extended-A"](u)||Ln["Arabic Presentation Forms-A"](u)||Ln["Arabic Presentation Forms-B"](u))}function yf(u){return!(u!==746&&u!==747&&(u<4352||!(Ln["Bopomofo Extended"](u)||Ln.Bopomofo(u)||Ln["CJK Compatibility Forms"](u)&&!(u>=65097&&u<=65103)||Ln["CJK Compatibility Ideographs"](u)||Ln["CJK Compatibility"](u)||Ln["CJK Radicals Supplement"](u)||Ln["CJK Strokes"](u)||!(!Ln["CJK Symbols and Punctuation"](u)||u>=12296&&u<=12305||u>=12308&&u<=12319||u===12336)||Ln["CJK Unified Ideographs Extension A"](u)||Ln["CJK Unified Ideographs"](u)||Ln["Enclosed CJK Letters and Months"](u)||Ln["Hangul Compatibility Jamo"](u)||Ln["Hangul Jamo Extended-A"](u)||Ln["Hangul Jamo Extended-B"](u)||Ln["Hangul Jamo"](u)||Ln["Hangul Syllables"](u)||Ln.Hiragana(u)||Ln["Ideographic Description Characters"](u)||Ln.Kanbun(u)||Ln["Kangxi Radicals"](u)||Ln["Katakana Phonetic Extensions"](u)||Ln.Katakana(u)&&u!==12540||!(!Ln["Halfwidth and Fullwidth Forms"](u)||u===65288||u===65289||u===65293||u>=65306&&u<=65310||u===65339||u===65341||u===65343||u>=65371&&u<=65503||u===65507||u>=65512&&u<=65519)||!(!Ln["Small Form Variants"](u)||u>=65112&&u<=65118||u>=65123&&u<=65126)||Ln["Unified Canadian Aboriginal Syllabics"](u)||Ln["Unified Canadian Aboriginal Syllabics Extended"](u)||Ln["Vertical Forms"](u)||Ln["Yijing Hexagram Symbols"](u)||Ln["Yi Syllables"](u)||Ln["Yi Radicals"](u))))}function Mh(u){return!(yf(u)||function(n){return!!(Ln["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||Ln["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||Ln["Letterlike Symbols"](n)||Ln["Number Forms"](n)||Ln["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||Ln["Control Pictures"](n)&&n!==9251||Ln["Optical Character Recognition"](n)||Ln["Enclosed Alphanumerics"](n)||Ln["Geometric Shapes"](n)||Ln["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||Ln["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||Ln["CJK Symbols and Punctuation"](n)||Ln.Katakana(n)||Ln["Private Use Area"](n)||Ln["CJK Compatibility Forms"](n)||Ln["Small Form Variants"](n)||Ln["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(u))}function ym(u){return u>=1424&&u<=2303||Ln["Arabic Presentation Forms-A"](u)||Ln["Arabic Presentation Forms-B"](u)}function kb(u,n){return!(!n&&ym(u)||u>=2304&&u<=3583||u>=3840&&u<=4255||Ln.Khmer(u))}function Rb(u){for(const n of u)if(ym(n.charCodeAt(0)))return!0;return!1}const kh="deferred",Rh="loading",bf="loaded";let vu=null,qo="unavailable",Kl=null;const pv=function(u){u&&typeof u=="string"&&u.indexOf("NetworkError")>-1&&(qo="error"),vu&&vu(u)};function bm(){xm.fire(new Ns("pluginStateChange",{pluginStatus:qo,pluginURL:Kl}))}const xm=new ra,wm=function(){return qo},Sm=function(){if(qo!==kh||!Kl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");qo=Rh,bm(),Kl&&ta({url:Kl},u=>{u?pv(u):(qo=bf,bm())})},Gs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>qo===bf||Gs.applyArabicShaping!=null,isLoading:()=>qo===Rh,setState(u){qo=u.pluginStatus,Kl=u.pluginURL},isParsed:()=>Gs.applyArabicShaping!=null&&Gs.processBidirectionalText!=null&&Gs.processStyledBidirectionalText!=null,getPluginURL:()=>Kl};class qr{constructor(n,s){this.zoom=n,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.transition=s.transition,this.pitch=s.pitch,this.brightness=s.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(n){return function(s,h){for(const g of s)if(!kb(g.charCodeAt(0),h))return!1;return!0}(n,Gs.isLoaded())}}class xf{constructor(n,s,h,g){this.property=n,this.value=s,this.expression=function(f,_,S,A){if(hf(f))return new pf(f,_);if(ff(f)||Array.isArray(f)&&f.length>0){const k=hv(f,_,S,A);if(k.result==="error")throw new Error(k.value.map(x=>`${x.key}: ${x.message}`).join(", "));return k.value}{let k=f;return typeof f=="string"&&_.type==="color"&&(k=tn.parse(f)),{kind:"constant",configDependencies:new Set,evaluate:()=>k}}}(s===void 0?n.specification.default:s,n.specification,h,g)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,s,h){return this.property.possiblyEvaluate(this,n,s,h)}}class Tm{constructor(n,s,h){this.property=n,this.value=new xf(n,void 0,s,h)}transitioned(n,s){return new gv(this.property,this.value,s,gi({},n.transition,this.transition),n.now)}untransitioned(){return new gv(this.property,this.value,null,{},0)}}class mv{constructor(n,s,h){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues),this._scope=s,this._options=h,this.configDependencies=new Set}getValue(n){return Tr(this._values[n].value.value)}setValue(n,s){this._values.hasOwnProperty(n)||(this._values[n]=new Tm(this._values[n].property,this._scope,this._options)),this._values[n].value=new xf(this._values[n].property,s===null?void 0:Tr(s),this._scope,this._options),this._values[n].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[n].value.expression.configDependencies]))}setTransitionOrValue(n,s){s&&(this._options=s);const h=this._properties.properties;if(n)for(const g in n){const f=n[g];if(dr(g,"-transition")){const _=g.slice(0,-11);h[_]&&this.setTransition(_,f)}else h.hasOwnProperty(g)&&this.setValue(g,f)}}getTransition(n){return Tr(this._values[n].transition)}setTransition(n,s){this._values.hasOwnProperty(n)||(this._values[n]=new Tm(this._values[n].property)),this._values[n].transition=Tr(s)||void 0}serialize(){const n={};for(const s of Object.keys(this._values)){const h=this.getValue(s);h!==void 0&&(n[s]=h);const g=this.getTransition(s);g!==void 0&&(n[`${s}-transition`]=g)}return n}transitioned(n,s){const h=new _v(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].transitioned(n,s._values[g]);return h}untransitioned(){const n=new _v(this._properties);for(const s of Object.keys(this._values))n._values[s]=this._values[s].untransitioned();return n}}class gv{constructor(n,s,h,g,f){const _=g.delay||0,S=g.duration||0;f=f||0,this.property=n,this.value=s,this.begin=f+_,this.end=this.begin+S,n.specification.transition&&(g.delay||g.duration)&&(this.prior=h)}possiblyEvaluate(n,s,h){const g=n.now||0,f=this.value.possiblyEvaluate(n,s,h),_=this.prior;if(_){if(g>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(g<this.begin)return _.possiblyEvaluate(n,s,h);{const S=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(n,s,h),f,dn(S))}}return f}}class _v{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,s,h){const g=new bu(this._properties);for(const f of Object.keys(this._values))g._values[f]=this._values[f].possiblyEvaluate(n,s,h);return g}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class Db{constructor(n,s,h){this._properties=n,this._values=Object.create(n.defaultPropertyValues),this._scope=s,this._options=h,this.configDependencies=new Set}getValue(n){return Tr(this._values[n].value)}setValue(n,s){this._values[n]=new xf(this._values[n].property,s===null?void 0:Tr(s),this._scope,this._options),this._values[n].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[n].expression.configDependencies]))}serialize(){const n={};for(const s of Object.keys(this._values)){const h=this.getValue(s);h!==void 0&&(n[s]=h)}return n}possiblyEvaluate(n,s,h){const g=new bu(this._properties);for(const f of Object.keys(this._values))g._values[f]=this._values[f].possiblyEvaluate(n,s,h);return g}}class yu{constructor(n,s,h){this.property=n,this.value=s,this.parameters=h}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,s,h,g){return this.property.evaluate(this.value,this.parameters,n,s,h,g)}}class bu{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class un{constructor(n){this.specification=n}possiblyEvaluate(n,s){return n.expression.evaluate(s)}interpolate(n,s,h){const g=Mr[this.specification.type];return g?g(n,s,h):n}}class zn{constructor(n,s){this.specification=n,this.overrides=s}possiblyEvaluate(n,s,h,g){return new yu(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(s,null,{},h,g)}:n.expression,s)}interpolate(n,s,h){if(n.value.kind!=="constant"||s.value.kind!=="constant")return n;if(n.value.value===void 0||s.value.value===void 0)return new yu(this,{kind:"constant",value:void 0},n.parameters);const g=Mr[this.specification.type];return g?new yu(this,{kind:"constant",value:g(n.value.value,s.value.value,h)},n.parameters):n}evaluate(n,s,h,g,f,_){return n.kind==="constant"?n.value:n.evaluate(s,h,g,f,_)}}class Ga{constructor(n){this.specification=n}possiblyEvaluate(n,s,h,g){return!!n.expression.evaluate(s,null,{},h,g)}interpolate(){return!1}}class Or{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const s=new qr(0,{});for(const h in n){const g=n[h];g.specification.overridable&&this.overridableProperties.push(h);const f=this.defaultPropertyValues[h]=new xf(g,void 0),_=this.defaultTransitionablePropertyValues[h]=new Tm(g);this.defaultTransitioningPropertyValues[h]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=f.possiblyEvaluate(s)}}}Pn(zn,"DataDrivenProperty"),Pn(un,"DataConstantProperty"),Pn(Ga,"ColorRampProperty");var _t=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"selectors":{"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"type":"string","required":true},"properties":{"type":"selectorProperty","required":false},"featureNamespace":{"type":"string","required":false}},"selectorProperty":{"experimental":true,"*":{"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{"experimental":true}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant","experimental":true},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant","experimental":true}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Dh(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function wf(u){if(Array.isArray(u))return u.map(wf);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){const n={};for(const s in u)n[s]=wf(u[s]);return n}return Dh(u)}function Em(u){if(u===!0||u===!1)return!0;if(!Array.isArray(u)||u.length===0)return!1;switch(u[0]){case"has":return u.length>=2&&u[1]!=="$id"&&u[1]!=="$type";case"in":return u.length>=3&&(typeof u[1]!="string"||Array.isArray(u[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return u.length!==3||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const n of u.slice(1))if(!Em(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}function Ha(u,n="",s=null,h="fill"){if(u==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Em(u)||(u=Sf(u));const g=u;let f=!0;try{f=function(I){if(!xu(I))return I;let M=wf(I);return Mc(M),M=Im(M),M}(g)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(g,null,2)}
        `)}const _=_t[`filter_${h}`],S=Ph(f,_,n,s);let A=null;if(S.result==="error")throw new Error(S.value.map(I=>`${I.key}: ${I.message}`).join(", "));A=(I,M,C)=>S.value.evaluate(I,M,{},C);let k=null,x=null;if(f!==g){const I=Ph(g,_,n,s);if(I.result==="error")throw new Error(I.value.map(M=>`${M.key}: ${M.message}`).join(", "));k=(M,C,P,O,V)=>I.value.evaluate(M,C,{},P,void 0,void 0,O,V),x=!xh(I.value.expression)}return{filter:A,dynamicFilter:k||void 0,needGeometry:vv(f),needFeature:!!x}}function Im(u){if(!Array.isArray(u))return u;const n=function(s){if(Ob.has(s[0])){for(let h=1;h<s.length;h++)if(xu(s[h]))return!0}return s}(u);return n===!0?n:n.map(s=>Im(s))}function Mc(u){let n=!1;const s=[];if(u[0]==="case"){for(let h=1;h<u.length-1;h+=2)n=n||xu(u[h]),s.push(u[h+1]);s.push(u[u.length-1])}else if(u[0]==="match"){n=n||xu(u[1]);for(let h=2;h<u.length-1;h+=2)s.push(u[h+1]);s.push(u[u.length-1])}else if(u[0]==="step"){n=n||xu(u[1]);for(let h=1;h<u.length-1;h+=2)s.push(u[h+1])}n&&(u.length=0,u.push("any",...s));for(let h=1;h<u.length;h++)Mc(u[h])}function xu(u){if(!Array.isArray(u))return!1;if((n=u[0])==="pitch"||n==="distance-from-center")return!0;var n;for(let s=1;s<u.length;s++)if(xu(u[s]))return!0;return!1}const Ob=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Lb(u,n){return u<n?-1:u>n?1:0}function vv(u){if(!Array.isArray(u))return!1;if(u[0]==="within"||u[0]==="distance")return!0;for(let n=1;n<u.length;n++)if(vv(u[n]))return!0;return!1}function Sf(u){if(!u)return!0;const n=u[0];return u.length<=1?n!=="any":n==="=="?Tf(u[1],u[2],"=="):n==="!="?Lh(Tf(u[1],u[2],"==")):n==="<"||n===">"||n==="<="||n===">="?Tf(u[1],u[2],n):n==="any"?(s=u.slice(1),["any"].concat(s.map(Sf))):n==="all"?["all"].concat(u.slice(1).map(Sf)):n==="none"?["all"].concat(u.slice(1).map(Sf).map(Lh)):n==="in"?Ef(u[1],u.slice(2)):n==="!in"?Lh(Ef(u[1],u.slice(2))):n==="has"?Oh(u[1]):n!=="!has"||Lh(Oh(u[1]));var s}function Tf(u,n,s){switch(u){case"$type":return[`filter-type-${s}`,n];case"$id":return[`filter-id-${s}`,n];default:return[`filter-${s}`,u,n]}}function Ef(u,n){if(n.length===0)return!1;switch(u){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(s=>typeof s!=typeof n[0])?["filter-in-large",u,["literal",n.sort(Lb)]]:["filter-in-small",u,["literal",n]]}}function Oh(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function Lh(u){return["!",u]}const wu="";function yv(u,n){return n?`${u}${wu}${n}`:u}const qa="-transition",zb=new Set(["fill","line","background","hillshade","raster"]);class xs extends ra{constructor(n,s,h,g,f){if(super(),this.id=n.id,this.fqid=yv(this.id,h),this.type=n.type,this.scope=h,this.lut=g,this.options=f,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,n.type!=="custom"&&(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&n.type!=="sky"&&n.type!=="slot"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter),n.slot&&(this.slot=n.slot),s.layout&&(this._unevaluatedLayout=new Db(s.layout,this.scope,f),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),s.paint)){this._transitionablePaint=new mv(s.paint,this.scope,f);for(const _ in n.paint)this.setPaintProperty(_,n.paint[_]);for(const _ in n.layout)this.setLayoutProperty(_,n.layout[_]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new bu(s.paint)}}onAdd(n){}onRemove(n){}isDraped(n){return!this.is3D()&&zb.has(this.type)}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,s){if(this.type==="custom"&&n==="visibility")return void(this.visibility=s);const h=this._unevaluatedLayout;h._properties.properties[n]&&(h.setValue(n,s),this.configDependencies=new Set([...this.configDependencies,...h.configDependencies]),n==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(n){return dr(n,qa)?this._transitionablePaint.getTransition(n.slice(0,-11)):this._transitionablePaint.getValue(n)}setPaintProperty(n,s){const h=this._transitionablePaint,g=h._properties.properties;if(dr(n,qa)){const I=n.slice(0,-11);return g[I]&&h.setTransition(I,s||void 0),!1}if(!g[n])return!1;const f=h._values[n],_=f.value.isDataDriven(),S=f.value;h.setValue(n,s),this.configDependencies=new Set([...this.configDependencies,...h.configDependencies]),this._handleSpecialPaintPropertyUpdate(n);const A=h._values[n].value,k=A.isDataDriven(),x=dr(n,"pattern")||n==="line-dasharray";return k||_||x||this._handleOverridablePaintPropertyUpdate(n,S,A)}_handleSpecialPaintPropertyUpdate(n){}getProgramIds(){return null}getDefaultProgramParams(n,s,h){return null}_handleOverridablePaintPropertyUpdate(n,s,h){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,s){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,s)}serialize(){return Sr({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(n,s)=>!(n===void 0||s==="layout"&&!Object.keys(n).length||s==="paint"&&!Object.keys(n).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const n in this.paint._values){const s=this.paint.get(n);if(s instanceof yu&&uf(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}compileFilter(n){this._filterCompiled||(this._featureFilter=Ha(this.filter,this.scope,n),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(n){this._stats&&(n.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(n){}queryIntersectsFeature(n,s,h,g,f,_,S,A,k){}queryIntersectsMatchingFeature(n,s,h,g){}}const Bb={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class zh{constructor(n,s){this._structArray=n,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Cr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,s){return n._trim(),s&&(n.isTransferred=!0,s.add(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const s=Object.create(this.prototype);return s.arrayBuffer=n.arrayBuffer,s.length=n.length,s.capacity=n.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...n){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...n){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Di(u,n=1){let s=0,h=0;return{members:u.map(g=>{const f=Bb[g.type].BYTES_PER_ELEMENT,_=s=bv(s,Math.max(n,f)),S=g.components||1;return h=Math.max(h,f),s+=f*S,{name:g.name,type:g.type,components:S,offset:_}}),size:bv(s,Math.max(h,n)),alignment:n}}function bv(u,n){return Math.ceil(u/n)*n}class Jl extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s){const h=this.length;return this.resize(h+1),this.emplace(h,n,s)}emplace(n,s,h){const g=2*n;return this.int16[g+0]=s,this.int16[g+1]=h,n}}Jl.prototype.bytesPerElement=4,Pn(Jl,"StructArrayLayout2i4");class If extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,h){const g=this.length;return this.resize(g+1),this.emplace(g,n,s,h)}emplace(n,s,h,g){const f=3*n;return this.int16[f+0]=s,this.int16[f+1]=h,this.int16[f+2]=g,n}}If.prototype.bytesPerElement=6,Pn(If,"StructArrayLayout3i6");class Ql extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,h,g){const f=this.length;return this.resize(f+1),this.emplace(f,n,s,h,g)}emplace(n,s,h,g,f){const _=4*n;return this.int16[_+0]=s,this.int16[_+1]=h,this.int16[_+2]=g,this.int16[_+3]=f,n}}Ql.prototype.bytesPerElement=8,Pn(Ql,"StructArrayLayout4i8");class Cf extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,h,g,f){const _=this.length;return this.resize(_+1),this.emplace(_,n,s,h,g,f)}emplace(n,s,h,g,f,_){const S=5*n;return this.int16[S+0]=s,this.int16[S+1]=h,this.int16[S+2]=g,this.int16[S+3]=f,this.int16[S+4]=_,n}}Cf.prototype.bytesPerElement=10,Pn(Cf,"StructArrayLayout5i10");class Cm extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,h,g,f,_,S){const A=this.length;return this.resize(A+1),this.emplace(A,n,s,h,g,f,_,S)}emplace(n,s,h,g,f,_,S,A){const k=6*n,x=12*n,I=3*n;return this.int16[k+0]=s,this.int16[k+1]=h,this.uint8[x+4]=g,this.uint8[x+5]=f,this.uint8[x+6]=_,this.uint8[x+7]=S,this.float32[I+2]=A,n}}Cm.prototype.bytesPerElement=12,Pn(Cm,"StructArrayLayout2i4ub1f12");class El extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,h,g){const f=this.length;return this.resize(f+1),this.emplace(f,n,s,h,g)}emplace(n,s,h,g,f){const _=4*n;return this.float32[_+0]=s,this.float32[_+1]=h,this.float32[_+2]=g,this.float32[_+3]=f,n}}El.prototype.bytesPerElement=16,Pn(El,"StructArrayLayout4f16");class ec extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,h){const g=this.length;return this.resize(g+1),this.emplace(g,n,s,h)}emplace(n,s,h,g){const f=3*n;return this.float32[f+0]=s,this.float32[f+1]=h,this.float32[f+2]=g,n}}ec.prototype.bytesPerElement=12,Pn(ec,"StructArrayLayout3f12");class Il extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,h,g,f){const _=this.length;return this.resize(_+1),this.emplace(_,n,s,h,g,f)}emplace(n,s,h,g,f,_){const S=6*n,A=3*n;return this.uint16[S+0]=s,this.uint16[S+1]=h,this.uint16[S+2]=g,this.uint16[S+3]=f,this.float32[A+2]=_,n}}Il.prototype.bytesPerElement=12,Pn(Il,"StructArrayLayout4ui1f12");class kc extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,h,g){const f=this.length;return this.resize(f+1),this.emplace(f,n,s,h,g)}emplace(n,s,h,g,f){const _=4*n;return this.uint16[_+0]=s,this.uint16[_+1]=h,this.uint16[_+2]=g,this.uint16[_+3]=f,n}}kc.prototype.bytesPerElement=8,Pn(kc,"StructArrayLayout4ui8");class Af extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,h,g,f,_){const S=this.length;return this.resize(S+1),this.emplace(S,n,s,h,g,f,_)}emplace(n,s,h,g,f,_,S){const A=6*n;return this.int16[A+0]=s,this.int16[A+1]=h,this.int16[A+2]=g,this.int16[A+3]=f,this.int16[A+4]=_,this.int16[A+5]=S,n}}Af.prototype.bytesPerElement=12,Pn(Af,"StructArrayLayout6i12");class Am extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,h,g,f,_,S,A,k,x,I,M){const C=this.length;return this.resize(C+1),this.emplace(C,n,s,h,g,f,_,S,A,k,x,I,M)}emplace(n,s,h,g,f,_,S,A,k,x,I,M,C){const P=12*n;return this.int16[P+0]=s,this.int16[P+1]=h,this.int16[P+2]=g,this.int16[P+3]=f,this.uint16[P+4]=_,this.uint16[P+5]=S,this.uint16[P+6]=A,this.uint16[P+7]=k,this.int16[P+8]=x,this.int16[P+9]=I,this.int16[P+10]=M,this.int16[P+11]=C,n}}Am.prototype.bytesPerElement=24,Pn(Am,"StructArrayLayout4i4ui4i24");class Pm extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,h,g,f,_){const S=this.length;return this.resize(S+1),this.emplace(S,n,s,h,g,f,_)}emplace(n,s,h,g,f,_,S){const A=10*n,k=5*n;return this.int16[A+0]=s,this.int16[A+1]=h,this.int16[A+2]=g,this.float32[k+2]=f,this.float32[k+3]=_,this.float32[k+4]=S,n}}Pm.prototype.bytesPerElement=20,Pn(Pm,"StructArrayLayout3i3f20");class Mm extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.uint32[1*n+0]=s,n}}Mm.prototype.bytesPerElement=4,Pn(Mm,"StructArrayLayout1ul4");class tc extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s){const h=this.length;return this.resize(h+1),this.emplace(h,n,s)}emplace(n,s,h){const g=2*n;return this.uint16[g+0]=s,this.uint16[g+1]=h,n}}tc.prototype.bytesPerElement=4,Pn(tc,"StructArrayLayout2ui4");class Su extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,h,g,f,_,S,A,k,x,I,M,C){const P=this.length;return this.resize(P+1),this.emplace(P,n,s,h,g,f,_,S,A,k,x,I,M,C)}emplace(n,s,h,g,f,_,S,A,k,x,I,M,C,P){const O=20*n,V=10*n;return this.int16[O+0]=s,this.int16[O+1]=h,this.int16[O+2]=g,this.int16[O+3]=f,this.int16[O+4]=_,this.float32[V+3]=S,this.float32[V+4]=A,this.float32[V+5]=k,this.float32[V+6]=x,this.int16[O+14]=I,this.uint32[V+8]=M,this.uint16[O+18]=C,this.uint16[O+19]=P,n}}Su.prototype.bytesPerElement=40,Pn(Su,"StructArrayLayout5i4f1i1ul2ui40");class Rc extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,h,g,f,_,S){const A=this.length;return this.resize(A+1),this.emplace(A,n,s,h,g,f,_,S)}emplace(n,s,h,g,f,_,S,A){const k=8*n;return this.int16[k+0]=s,this.int16[k+1]=h,this.int16[k+2]=g,this.int16[k+4]=f,this.int16[k+5]=_,this.int16[k+6]=S,this.int16[k+7]=A,n}}Rc.prototype.bytesPerElement=16,Pn(Rc,"StructArrayLayout3i2i2i16");class Ms extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,h,g,f){const _=this.length;return this.resize(_+1),this.emplace(_,n,s,h,g,f)}emplace(n,s,h,g,f,_){const S=4*n,A=8*n;return this.float32[S+0]=s,this.float32[S+1]=h,this.float32[S+2]=g,this.int16[A+6]=f,this.int16[A+7]=_,n}}Ms.prototype.bytesPerElement=16,Pn(Ms,"StructArrayLayout2f1f2i16");class Tu extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,h,g,f,_){const S=this.length;return this.resize(S+1),this.emplace(S,n,s,h,g,f,_)}emplace(n,s,h,g,f,_,S){const A=20*n,k=5*n;return this.uint8[A+0]=s,this.uint8[A+1]=h,this.float32[k+1]=g,this.float32[k+2]=f,this.float32[k+3]=_,this.float32[k+4]=S,n}}Tu.prototype.bytesPerElement=20,Pn(Tu,"StructArrayLayout2ub4f20");class ss extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,h){const g=this.length;return this.resize(g+1),this.emplace(g,n,s,h)}emplace(n,s,h,g){const f=3*n;return this.uint16[f+0]=s,this.uint16[f+1]=h,this.uint16[f+2]=g,n}}ss.prototype.bytesPerElement=6,Pn(ss,"StructArrayLayout3ui6");class km extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,s,h,g,f,_,S,A,k,x,I,M,C,P,O,V,G,J,ee,H,se){const ue=this.length;return this.resize(ue+1),this.emplace(ue,n,s,h,g,f,_,S,A,k,x,I,M,C,P,O,V,G,J,ee,H,se)}emplace(n,s,h,g,f,_,S,A,k,x,I,M,C,P,O,V,G,J,ee,H,se,ue){const we=30*n,Me=15*n,Re=60*n;return this.int16[we+0]=s,this.int16[we+1]=h,this.int16[we+2]=g,this.float32[Me+2]=f,this.float32[Me+3]=_,this.uint16[we+8]=S,this.uint16[we+9]=A,this.uint32[Me+5]=k,this.uint32[Me+6]=x,this.uint32[Me+7]=I,this.uint16[we+16]=M,this.uint16[we+17]=C,this.uint16[we+18]=P,this.float32[Me+10]=O,this.float32[Me+11]=V,this.uint8[Re+48]=G,this.uint8[Re+49]=J,this.uint8[Re+50]=ee,this.uint32[Me+13]=H,this.int16[we+28]=se,this.uint8[Re+58]=ue,n}}km.prototype.bytesPerElement=60,Pn(km,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Rm extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,s,h,g,f,_,S,A,k,x,I,M,C,P,O,V,G,J,ee,H,se,ue,we,Me,Re,Ce,je,Oe,He,Qe,it,ot){const ct=this.length;return this.resize(ct+1),this.emplace(ct,n,s,h,g,f,_,S,A,k,x,I,M,C,P,O,V,G,J,ee,H,se,ue,we,Me,Re,Ce,je,Oe,He,Qe,it,ot)}emplace(n,s,h,g,f,_,S,A,k,x,I,M,C,P,O,V,G,J,ee,H,se,ue,we,Me,Re,Ce,je,Oe,He,Qe,it,ot,ct){const bt=20*n,ut=40*n,Ot=80*n;return this.float32[bt+0]=s,this.float32[bt+1]=h,this.int16[ut+4]=g,this.int16[ut+5]=f,this.int16[ut+6]=_,this.int16[ut+7]=S,this.int16[ut+8]=A,this.int16[ut+9]=k,this.int16[ut+10]=x,this.int16[ut+11]=I,this.int16[ut+12]=M,this.uint16[ut+13]=C,this.uint16[ut+14]=P,this.uint16[ut+15]=O,this.uint16[ut+16]=V,this.uint16[ut+17]=G,this.uint16[ut+18]=J,this.uint16[ut+19]=ee,this.uint16[ut+20]=H,this.uint16[ut+21]=se,this.uint16[ut+22]=ue,this.uint16[ut+23]=we,this.uint16[ut+24]=Me,this.uint16[ut+25]=Re,this.uint16[ut+26]=Ce,this.uint16[ut+27]=je,this.uint32[bt+14]=Oe,this.float32[bt+15]=He,this.float32[bt+16]=Qe,this.float32[bt+17]=it,this.float32[bt+18]=ot,this.uint8[Ot+76]=ct,n}}Rm.prototype.bytesPerElement=80,Pn(Rm,"StructArrayLayout2f9i15ui1ul4f1ub80");class Eu extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.float32[1*n+0]=s,n}}Eu.prototype.bytesPerElement=4,Pn(Eu,"StructArrayLayout1f4");class Cl extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,h,g,f){const _=this.length;return this.resize(_+1),this.emplace(_,n,s,h,g,f)}emplace(n,s,h,g,f,_){const S=5*n;return this.float32[S+0]=s,this.float32[S+1]=h,this.float32[S+2]=g,this.float32[S+3]=f,this.float32[S+4]=_,n}}Cl.prototype.bytesPerElement=20,Pn(Cl,"StructArrayLayout5f20");class Dm extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,h,g,f,_,S){const A=this.length;return this.resize(A+1),this.emplace(A,n,s,h,g,f,_,S)}emplace(n,s,h,g,f,_,S,A){const k=7*n;return this.float32[k+0]=s,this.float32[k+1]=h,this.float32[k+2]=g,this.float32[k+3]=f,this.float32[k+4]=_,this.float32[k+5]=S,this.float32[k+6]=A,n}}Dm.prototype.bytesPerElement=28,Pn(Dm,"StructArrayLayout7f28");class Bh extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,h,g){const f=this.length;return this.resize(f+1),this.emplace(f,n,s,h,g)}emplace(n,s,h,g,f){const _=6*n;return this.uint32[3*n+0]=s,this.uint16[_+2]=h,this.uint16[_+3]=g,this.uint16[_+4]=f,n}}Bh.prototype.bytesPerElement=12,Pn(Bh,"StructArrayLayout1ul3ui12");class Om extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.uint16[1*n+0]=s,n}}Om.prototype.bytesPerElement=2,Pn(Om,"StructArrayLayout1ui2");class Fh extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s){const h=this.length;return this.resize(h+1),this.emplace(h,n,s)}emplace(n,s,h){const g=2*n;return this.float32[g+0]=s,this.float32[g+1]=h,n}}Fh.prototype.bytesPerElement=8,Pn(Fh,"StructArrayLayout2f8");class Vh extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,h,g,f,_,S,A,k,x,I,M,C,P,O,V){const G=this.length;return this.resize(G+1),this.emplace(G,n,s,h,g,f,_,S,A,k,x,I,M,C,P,O,V)}emplace(n,s,h,g,f,_,S,A,k,x,I,M,C,P,O,V,G){const J=16*n;return this.float32[J+0]=s,this.float32[J+1]=h,this.float32[J+2]=g,this.float32[J+3]=f,this.float32[J+4]=_,this.float32[J+5]=S,this.float32[J+6]=A,this.float32[J+7]=k,this.float32[J+8]=x,this.float32[J+9]=I,this.float32[J+10]=M,this.float32[J+11]=C,this.float32[J+12]=P,this.float32[J+13]=O,this.float32[J+14]=V,this.float32[J+15]=G,n}}Vh.prototype.bytesPerElement=64,Pn(Vh,"StructArrayLayout16f64");class Pf extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,h,g,f,_,S){const A=this.length;return this.resize(A+1),this.emplace(A,n,s,h,g,f,_,S)}emplace(n,s,h,g,f,_,S,A){const k=10*n,x=5*n;return this.uint16[k+0]=s,this.uint16[k+1]=h,this.uint16[k+2]=g,this.uint16[k+3]=f,this.float32[x+2]=_,this.float32[x+3]=S,this.float32[x+4]=A,n}}Pf.prototype.bytesPerElement=20,Pn(Pf,"StructArrayLayout4ui3f20");class Mf extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.int16[1*n+0]=s,n}}Mf.prototype.bytesPerElement=2,Pn(Mf,"StructArrayLayout1i2");class kf extends Cr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.uint8[1*n+0]=s,n}}kf.prototype.bytesPerElement=1,Pn(kf,"StructArrayLayout1ub1");class xv extends zh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}xv.prototype.size=40;class Rf extends Su{get(n){return new xv(this,n)}}Pn(Rf,"CollisionBoxArray");class Nh extends zh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(n){this._structArray.uint8[this._pos1+49]=n}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(n){this._structArray.uint8[this._pos1+50]=n}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(n){this._structArray.uint32[this._pos4+13]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(n){this._structArray.uint8[this._pos1+58]=n}}Nh.prototype.size=60;class Lm extends km{get(n){return new Nh(this,n)}}Pn(Lm,"PlacedSymbolArray");class wv extends zh{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(n){this._structArray.uint32[this._pos4+14]=n}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(n){this._structArray.float32[this._pos4+18]=n}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}wv.prototype.size=80;class zm extends Rm{get(n){return new wv(this,n)}}Pn(zm,"SymbolInstanceArray");class Sv extends Eu{getoffsetX(n){return this.float32[1*n+0]}}Pn(Sv,"GlyphOffsetArray");class Df extends Jl{getx(n){return this.int16[2*n+0]}gety(n){return this.int16[2*n+1]}}Pn(Df,"SymbolLineVertexArray");class Tv extends zh{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Tv.prototype.size=12;class Ev extends Bh{get(n){return new Tv(this,n)}}Pn(Ev,"FeatureIndexArray");class Iv extends tc{geta_centroid_pos0(n){return this.uint16[2*n+0]}geta_centroid_pos1(n){return this.uint16[2*n+1]}}Pn(Iv,"FillExtrusionCentroidArray");class Cv extends zh{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Cv.prototype.size=6;class Bm extends If{get(n){return new Cv(this,n)}}Pn(Bm,"FillExtrusionWallArray");const Fb=Di([{name:"a_pos",components:2,type:"Int16"}],4),Vb=Di([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Wr{constructor(n=[]){this.segments=n}_prepareSegment(n,s,h,g){let f=this.segments[this.segments.length-1];return n>Wr.MAX_VERTEX_ARRAY_LENGTH&&ii(`Max vertices per segment is ${Wr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!f||f.vertexLength+n>Wr.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==g)&&(f={vertexOffset:s,primitiveOffset:h,vertexLength:0,primitiveLength:0},g!==void 0&&(f.sortKey=g),this.segments.push(f)),f}prepareSegment(n,s,h,g){return this._prepareSegment(n,s.length,h.length,g)}get(){return this.segments}destroy(){for(const n of this.segments)for(const s in n.vaos)n.vaos[s].destroy()}static simpleSegment(n,s,h,g){return new Wr([{vertexOffset:n,primitiveOffset:s,vertexLength:h,primitiveLength:g,vaos:{},sortKey:0}])}}function Av(u,n){return 256*(u=hn(Math.floor(u),0,255))+hn(Math.floor(n),0,255)}Wr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Pn(Wr,"SegmentVector");const Nb=Di([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Ub=Di([{name:"a_dash",components:4,type:"Uint16"}]);class Uh{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(n,s,h,g){this.ids.push(Pv(n)),this.positions.push(s,h,g)}eachPosition(n,s){const h=Pv(n);let g=0,f=this.ids.length-1;for(;g<f;){const _=g+f>>1;this.ids[_]>=h?f=_:g=_+1}for(;this.ids[g]===h;)s(this.positions[3*g],this.positions[3*g+1],this.positions[3*g+2]),g++}static serialize(n,s){const h=new Float64Array(n.ids),g=new Uint32Array(n.positions);return Iu(h,g,0,h.length-1),s&&(s.add(h.buffer),s.add(g.buffer)),{ids:h,positions:g}}static deserialize(n){const s=new Uh;let h;s.ids=n.ids,s.positions=n.positions;for(const g of s.ids)g!==h&&s.uniqueIds.push(g),h=g;return s.indexed=!0,s}}function Pv(u){const n=+u;return!isNaN(n)&&Number.MIN_SAFE_INTEGER<=n&&n<=Number.MAX_SAFE_INTEGER?n:to(String(u))}function Iu(u,n,s,h){for(;s<h;){const g=u[s+h>>1];let f=s-1,_=h+1;for(;;){do f++;while(u[f]<g);do _--;while(u[_]>g);if(f>=_)break;Of(u,f,_),Of(n,3*f,3*_),Of(n,3*f+1,3*_+1),Of(n,3*f+2,3*_+2)}_-s<h-_?(Iu(u,n,s,_),s=_+1):(Iu(u,n,_+1,h),h=_)}}function Of(u,n,s){const h=u[n];u[n]=u[s],u[s]=h}Pn(Uh,"FeaturePositionMap");class Al{constructor(n){this.gl=n.gl,this.initialized=!1}fetchUniformLocation(n,s){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(n,s),this.initialized=!0),!!this.location}set(n,s,h){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Dc extends Al{constructor(n){super(n),this.current=0}set(n,s,h){this.fetchUniformLocation(n,s)&&this.current!==h&&(this.current=h,this.gl.uniform1i(this.location,h))}}class ws extends Al{constructor(n){super(n),this.current=0}set(n,s,h){this.fetchUniformLocation(n,s)&&this.current!==h&&(this.current=h,this.gl.uniform1f(this.location,h))}}class rl extends Al{constructor(n){super(n),this.current=[0,0]}set(n,s,h){this.fetchUniformLocation(n,s)&&(h[0]===this.current[0]&&h[1]===this.current[1]||(this.current=h,this.gl.uniform2f(this.location,h[0],h[1])))}}class Fm extends Al{constructor(n){super(n),this.current=[0,0,0]}set(n,s,h){this.fetchUniformLocation(n,s)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]||(this.current=h,this.gl.uniform3f(this.location,h[0],h[1],h[2])))}}class Lf extends Al{constructor(n){super(n),this.current=[0,0,0,0]}set(n,s,h){this.fetchUniformLocation(n,s)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]&&h[3]===this.current[3]||(this.current=h,this.gl.uniform4f(this.location,h[0],h[1],h[2],h[3])))}}class Vm extends Al{constructor(n){super(n),this.current=tn.transparent.toRenderColor(null)}set(n,s,h){this.fetchUniformLocation(n,s)&&(h.r===this.current.r&&h.g===this.current.g&&h.b===this.current.b&&h.a===this.current.a||(this.current=h,this.gl.uniform4f(this.location,h.r,h.g,h.b,h.a)))}}const Mv=new Float32Array(16);class jh extends Al{constructor(n){super(n),this.current=Mv}set(n,s,h){if(this.fetchUniformLocation(n,s)){if(h[12]!==this.current[12]||h[0]!==this.current[0])return this.current=h,void this.gl.uniformMatrix4fv(this.location,!1,h);for(let g=1;g<16;g++)if(h[g]!==this.current[g]){this.current=h,this.gl.uniformMatrix4fv(this.location,!1,h);break}}}}const jb=new Float32Array(9),$b=new Float32Array(4);class Nm extends Al{constructor(n){super(n),this.current=$b}set(n,s,h){if(this.fetchUniformLocation(n,s)){for(let g=0;g<4;g++)if(h[g]!==this.current[g]){this.current=h,this.gl.uniformMatrix2fv(this.location,!1,h);break}}}}function Um(u){return[Av(255*u.r,255*u.g),Av(255*u.b,255*u.a)]}class $h{constructor(n,s,h,g){this.value=n,this.uniformNames=s.map(f=>`u_${f}`),this.type=h,this.context=g}setUniform(n,s,h,g,f){const _=g.constantOr(this.value);s.set(n,f,_ instanceof tn?_.toRenderColor(this.context.lut):_)}getBinding(n,s){return this.type==="color"?new Vm(n):new ws(n)}}class Cu{constructor(n,s){this.uniformNames=s.map(h=>`u_${h}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(n){this.pixelRatio=n.pixelRatio||1,this.pattern=n.tl.concat(n.br)}setUniform(n,s,h,g,f){const _=f==="u_pattern"||f==="u_dash"?this.pattern:f==="u_pixel_ratio"?this.pixelRatio:null;_&&s.set(n,f,_)}getBinding(n,s){return s==="u_pattern"||s==="u_dash"?new Lf(n):new ws(n)}}class ol{constructor(n,s,h,g){this.expression=n,this.type=h,this.maxValue=0,this.paintVertexAttributes=s.map(f=>({name:`a_${f}`,type:"Float32",components:h==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(n,s,h,g,f,_,S){const A=this.paintVertexArray.length,k=this.expression.evaluate(new qr(0,{brightness:_}),s,{},f,g,S);this.paintVertexArray.resize(n),this._setPaintValue(A,n,k,this.context)}updatePaintArray(n,s,h,g,f,_,S){const A=this.expression.evaluate({zoom:0,brightness:S},h,g,void 0,f);this._setPaintValue(n,s,A,this.context)}_setPaintValue(n,s,h,g){if(this.type==="color"){const f=Um(h.toRenderColor(g.lut));for(let _=n;_<s;_++)this.paintVertexArray.emplace(_,f[0],f[1])}else{for(let f=n;f<s;f++)this.paintVertexArray.emplace(f,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class fa{constructor(n,s,h,g,f,_){this.expression=n,this.uniformNames=s.map(S=>`u_${S}_t`),this.type=h,this.useIntegerZoom=g,this.context=f,this.maxValue=0,this.paintVertexAttributes=s.map(S=>({name:`a_${S}`,type:"Float32",components:h==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(n,s,h,g,f,_,S){const A=this.expression.evaluate(new qr(this.context.zoom,{brightness:_}),s,{},f,g,S),k=this.expression.evaluate(new qr(this.context.zoom+1,{brightness:_}),s,{},f,g,S),x=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(x,n,A,k,this.context)}updatePaintArray(n,s,h,g,f,_,S){const A=this.expression.evaluate({zoom:this.context.zoom,brightness:S},h,g,void 0,f),k=this.expression.evaluate({zoom:this.context.zoom+1,brightness:S},h,g,void 0,f);this._setPaintValue(n,s,A,k,this.context)}_setPaintValue(n,s,h,g,f){if(this.type==="color"){const _=Um(h.toRenderColor(f.lut)),S=Um(h.toRenderColor(f.lut));for(let A=n;A<s;A++)this.paintVertexArray.emplace(A,_[0],_[1],S[0],S[1])}else{for(let _=n;_<s;_++)this.paintVertexArray.emplace(_,h,g);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(g))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,s,h,g,f){const _=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,S=hn(this.expression.interpolationFactor(_,this.context.zoom,this.context.zoom+1),0,1);s.set(n,f,S)}getBinding(n,s){return new ws(n)}}class sl{constructor(n,s,h,g,f){this.expression=n,this.layerId=f,this.paintVertexAttributes=(h==="array"?Ub:Nb).members;for(let _=0;_<s.length;++_);this.paintVertexArray=new g}populatePaintArray(n,s,h,g){const f=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValues(f,n,s.patterns&&s.patterns[this.layerId],h)}updatePaintArray(n,s,h,g,f,_,S){this._setPaintValues(n,s,h.patterns&&h.patterns[this.layerId],_)}_setPaintValues(n,s,h,g){if(!g||!h)return;const f=g[h];if(!f)return;const{tl:_,br:S,pixelRatio:A}=f;for(let k=n;k<s;k++)this.paintVertexArray.emplace(k,_[0],_[1],S[0],S[1],A)}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Oc{constructor(n,s,h=()=>!0){this.binders={},this._buffers=[],this.context=s;const g=[];for(const f in n.paint._values){const _=n.paint.get(f);if(!h(f)||!(_ instanceof yu&&uf(_.property.specification)))continue;const S=Hb(f,n.type),A=_.value,k=_.property.specification.type,x=!!_.property.useIntegerZoom,I=f==="line-dasharray"||f.endsWith("pattern"),M=f==="line-dasharray"&&n.layout.get("line-cap").value.kind!=="constant";if(A.kind!=="constant"||M)if(A.kind==="source"||M||I){const C=p(f,k,"source");this.binders[f]=I?new sl(A,S,k,C,n.id):new ol(A,S,k,C),g.push(`/a_${f}`)}else{const C=p(f,k,"composite");this.binders[f]=new fa(A,S,k,x,s,C),g.push(`/z_${f}`)}else this.binders[f]=I?new Cu(A.value,S):new $h(A.value,S,k,s),g.push(`/u_${f}`)}this.cacheKey=g.sort().join("")}getMaxValue(n){const s=this.binders[n];return s instanceof ol||s instanceof fa?s.maxValue:0}populatePaintArrays(n,s,h,g,f,_,S){for(const A in this.binders){const k=this.binders[A];k.context=this.context,(k instanceof ol||k instanceof fa||k instanceof sl)&&k.populatePaintArray(n,s,h,g,f,_,S)}}setConstantPatternPositions(n){for(const s in this.binders){const h=this.binders[s];h instanceof Cu&&h.setConstantPatternPositions(n)}}updatePaintArrays(n,s,h,g,f,_,S,A){let k=!1;const x=Object.keys(n),I=x.length!==0,M=I?x:s.uniqueIds;this.context.lut=f.lut;for(const C in this.binders){const P=this.binders[C];if(P.context=this.context,(P instanceof ol||P instanceof fa||P instanceof sl)&&(P.expression.isStateDependent===!0||P.expression.isLightConstant===!1)){const O=f.paint.get(C);P.expression=O.value;for(const V of M){const G=n[V.toString()];s.eachPosition(V,(J,ee,H)=>{const se=g.feature(J);P.updatePaintArray(ee,H,se,G,_,S,A)})}if(!I)for(const V of h.uniqueIds){const G=n[V.toString()];h.eachPosition(V,(J,ee,H)=>{const se=g.feature(J);P.updatePaintArray(ee,H,se,G,_,S,A)})}k=!0}}return k}defines(){const n=[];for(const s in this.binders){const h=this.binders[s];(h instanceof $h||h instanceof Cu)&&n.push(...h.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return n}getBinderAttributes(){const n=[];for(const s in this.binders){const h=this.binders[s];if(h instanceof ol||h instanceof fa||h instanceof sl)for(let g=0;g<h.paintVertexAttributes.length;g++)n.push(h.paintVertexAttributes[g].name)}return n}getBinderUniforms(){const n=[];for(const s in this.binders){const h=this.binders[s];if(h instanceof $h||h instanceof Cu||h instanceof fa)for(const g of h.uniformNames)n.push(g)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n){const s=[];for(const h in this.binders){const g=this.binders[h];if(g instanceof $h||g instanceof Cu||g instanceof fa)for(const f of g.uniformNames)s.push({name:f,property:h,binding:g.getBinding(n,f)})}return s}setUniforms(n,s,h,g,f){for(const{name:_,property:S,binding:A}of h)this.binders[S].setUniform(n,A,f,g.get(S),_)}updatePaintBuffers(){this._buffers=[];for(const n in this.binders){const s=this.binders[n];(s instanceof ol||s instanceof fa||s instanceof sl)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(n){for(const s in this.binders){const h=this.binders[s];(h instanceof ol||h instanceof fa||h instanceof sl)&&h.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const s=this.binders[n];(s instanceof ol||s instanceof fa||s instanceof sl)&&s.destroy()}}}class nc{constructor(n,s,h=()=>!0){this.programConfigurations={};for(const g of n)this.programConfigurations[g.id]=new Oc(g,s,h);this.needsUpload=!1,this._featureMap=new Uh,this._featureMapWithoutIds=new Uh,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(n,s,h,g,f,_,S,A){for(const k in this.programConfigurations)this.programConfigurations[k].populatePaintArrays(n,s,g,f,_,S,A);s.id!==void 0?this._featureMap.add(s.id,h,this._bufferOffset,n):(this._featureMapWithoutIds.add(this._idlessCounter,h,this._bufferOffset,n),this._idlessCounter+=1),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,s,h,g,f,_){for(const S of h)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(n,this._featureMap,this._featureMapWithoutIds,s,S,g,f,_||0)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}const Gb={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Hb(u,n){return Gb[u]||[u.replace(`${n}-`,"").replace(/-/g,"_")]}const qb={"line-pattern":{source:Il,composite:Il},"fill-pattern":{source:Il,composite:Il},"fill-extrusion-pattern":{source:Il,composite:Il},"line-dasharray":{source:kc,composite:kc}},kv={color:{source:Fh,composite:El},number:{source:Eu,composite:Fh}};function p(u,n,s){const h=qb[u];return h&&h[s]||kv[n][s]}Pn($h,"ConstantBinder"),Pn(Cu,"PatternConstantBinder"),Pn(ol,"SourceExpressionBinder"),Pn(sl,"PatternCompositeBinder"),Pn(fa,"CompositeExpressionBinder"),Pn(Oc,"ProgramConfiguration",{omit:["_buffers"]}),Pn(nc,"ProgramConfigurationSet");const i=_n/Math.PI/2,a=5,m=6,b=16383,w=64,E=[w,32,16],R=-i,z=i;function N(u,n,s,h=i){return s=Gt(s),[u*Math.sin(s)*h,-n*h,u*Math.cos(s)*h]}function j(u,n,s){return N(Math.cos(Gt(u)),Math.sin(Gt(u)),n,s)}const X=63710088e-1,K=2*Math.PI*X;class Q{constructor(n,s){if(isNaN(n)||isNaN(s))throw new Error(`Invalid LngLat object: (${n}, ${s})`);if(this.lng=+n,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Q(ti(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const s=Math.PI/180,h=this.lat*s,g=n.lat*s,f=Math.sin(h)*Math.sin(g)+Math.cos(h)*Math.cos(g)*Math.cos((n.lng-this.lng)*s);return X*Math.acos(Math.min(f,1))}toBounds(n=0){const s=360*n/40075017,h=s/Math.cos(Math.PI/180*this.lat);return new he({lng:this.lng-h,lat:this.lat-s},{lng:this.lng+h,lat:this.lat+s})}toEcef(n){return j(this.lat,this.lng,i+n*i/X)}static convert(n){if(n instanceof Q)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new Q(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new Q(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class he{constructor(n,s){if(n)if(s)this.setSouthWest(n).setNorthEast(s);else if(n.length===4){const h=n;this.setSouthWest([h[0],h[1]]).setNorthEast([h[2],h[3]])}else{const h=n;this.setSouthWest(h[0]).setNorthEast(h[1])}}setNorthEast(n){return this._ne=n instanceof Q?new Q(n.lng,n.lat):Q.convert(n),this}setSouthWest(n){return this._sw=n instanceof Q?new Q(n.lng,n.lat):Q.convert(n),this}extend(n){const s=this._sw,h=this._ne;let g,f;if(n instanceof Q)g=n,f=n;else{if(!(n instanceof he))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(he.convert(n)):this.extend(Q.convert(n)):typeof n=="object"&&n!==null&&n.hasOwnProperty("lat")&&(n.hasOwnProperty("lon")||n.hasOwnProperty("lng"))?this.extend(Q.convert(n)):this;if(g=n._sw,f=n._ne,!g||!f)return this}return s||h?(s.lng=Math.min(g.lng,s.lng),s.lat=Math.min(g.lat,s.lat),h.lng=Math.max(f.lng,h.lng),h.lat=Math.max(f.lat,h.lat)):(this._sw=new Q(g.lng,g.lat),this._ne=new Q(f.lng,f.lat)),this}getCenter(){return new Q((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Q(this.getWest(),this.getNorth())}getSouthEast(){return new Q(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:s,lat:h}=Q.convert(n);let g=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&g}static convert(n){if(n)return n instanceof he?n:new he(n)}}const me=0,_e=25.5;function ve(u){return K*Math.cos(u*Math.PI/180)}function ke(u){return(180+u)/360}function De(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function Pe(u,n){return u/ve(n)}function Fe(u){return 360*u-180}function ze(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}function qe(u,n){return u*ve(ze(n))}const $e=85.051129;function We(u){return Math.cos(Gt(hn(u,-$e,$e)))}function nt(u,n){const s=hn(n,me,_e),h=Math.pow(2,s);return We(u)*K/(512*h)}function Ke(u){return 1/Math.cos(u*Math.PI/180)}function Ye(u,n=0){const s=Math.exp(Math.PI*(1-(u.y+n/_n)/(1<<u.z)*2));return 80150034*s/(s*s+1)/_n/(1<<u.z)}class ft{constructor(n,s,h=0){this.x=+n,this.y=+s,this.z=+h}static fromLngLat(n,s=0){const h=Q.convert(n);return new ft(ke(h.lng),De(h.lat),Pe(s,h.lat))}toLngLat(){return new Q(Fe(this.x),ze(this.y))}toAltitude(){return qe(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/K*Ke(ze(this.y))}}function kt(u,n,s,h,g,f,_,S,A){const k=(n+h)/2,x=(s+g)/2,I=new Ue(k,x);S(I),function(M,C,P,O,V,G){const J=P-V,ee=O-G;return Math.abs((O-C)*J-(P-M)*ee)/Math.hypot(J,ee)}(I.x,I.y,f.x,f.y,_.x,_.y)>=A?(kt(u,n,s,k,x,f,I,S,A),kt(u,k,x,h,g,I,_,S,A)):u.push(_)}function jt(u,n,s){let h=u[0],g=h.x,f=h.y;n(h);const _=[h];for(let S=1;S<u.length;S++){const A=u[S],{x:k,y:x}=A;n(A),kt(_,g,f,k,x,h,A,n,s),g=k,f=x,h=A}return _}function Pt(u,n,s,h){if(h(n,s)){const g=n.add(s)._mult(.5);Pt(u,n,g,h),Pt(u,g,s,h)}else u.push(s)}function nn(u,n){let s=u[0];const h=[s];for(let g=1;g<u.length;g++){const f=u[g];Pt(h,s,f,n),s=f}return h}const pt=Math.pow(2,14)-1,Vt=-pt-1;function zt(u,n){const s=Math.round(u.x*n),h=Math.round(u.y*n);return u.x=hn(s,Vt,pt),u.y=hn(h,Vt,pt),(s<u.x||s>u.x+1||h<u.y||h>u.y+1)&&ii("Geometry exceeds allowed extent, reduce your vector tile buffer size"),u}function sn(u,n,s){const h=u.loadGeometry(),g=u.extent,f=_n/g;if(n&&s&&s.projection.isReprojectedInTileSpace){const _=1<<n.z,{scale:S,x:A,y:k,projection:x}=s,I=M=>{const C=Fe((n.x+M.x/g)/_),P=ze((n.y+M.y/g)/_),O=x.project(C,P);M.x=(O.x*S-A)*g,M.y=(O.y*S-k)*g};for(let M=0;M<h.length;M++)if(u.type!==1)h[M]=jt(h[M],I,1);else{const C=[];for(const P of h[M])P.x<0||P.x>=g||P.y<0||P.y>=g||(I(P),C.push(P));h[M]=C}}for(const _ of h)for(const S of _)zt(S,f);return h}function ln(u,n){return{type:u.type,id:u.id,properties:u.properties,geometry:n?sn(u):[]}}function Ut(u,n,s,h,g){u.emplaceBack(2*n+(h+1)/2,2*s+(g+1)/2)}function qt(u,n,s){u.emplaceBack(n.x,n.y,n.z,s[0]*16384,s[1]*16384,s[2]*16384)}class Fn{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=n.index,this.hasPattern=!1,this.projection=n.projection,this.layoutVertexArray=new Jl,this.indexArray=new ss,this.segments=new Wr,this.programConfigurations=new nc(n.layers,{zoom:n.zoom,lut:n.lut}),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}updateFootprints(n,s){}populate(n,s,h,g){const f=this.layers[0],_=[];let S=null;f.type==="circle"&&(S=f.layout.get("circle-sort-key"));for(const{feature:k,id:x,index:I,sourceLayerIndex:M}of n){const C=this.layers[0]._featureFilter.needGeometry,P=ln(k,C);if(!this.layers[0]._featureFilter.filter(new qr(this.zoom),P,h))continue;const O=S?S.evaluate(P,{},h):void 0,V={id:x,properties:k.properties,type:k.type,sourceLayerIndex:M,index:I,geometry:C?P.geometry:sn(k,h,g),patterns:{},sortKey:O};_.push(V)}S&&_.sort((k,x)=>k.sortKey-x.sortKey);let A=null;g.projection.name==="globe"&&(this.globeExtVertexArray=new Af,A=g.projection);for(const k of _){const{geometry:x,index:I,sourceLayerIndex:M}=k,C=n[I].feature;this.addFeature(k,x,I,s.availableImages,h,A,s.brightness),s.featureIndex.insert(C,x,I,M,this.index)}}update(n,s,h,g,f){const _=Object.keys(n).length!==0;_&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(n,s,_?this.stateDependentLayers:this.layers,h,g,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Fb.members),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,Vb.members))),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(n,s,h,g,f,_,S){for(const A of s)for(const k of A){const x=k.x,I=k.y;if(x<0||x>=_n||I<0||I>=_n)continue;if(_){const P=_.projectTilePoint(x,I,f),O=_.upVector(f,x,I),V=this.globeExtVertexArray;qt(V,P,O),qt(V,P,O),qt(V,P,O),qt(V,P,O)}const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),C=M.vertexLength;Ut(this.layoutVertexArray,x,I,-1,-1),Ut(this.layoutVertexArray,x,I,1,-1),Ut(this.layoutVertexArray,x,I,1,1),Ut(this.layoutVertexArray,x,I,-1,1),this.indexArray.emplaceBack(C,C+1,C+2),this.indexArray.emplaceBack(C,C+2,C+3),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,h,{},g,f,S)}}function pn(u,n){for(let s=0;s<u.length;s++)if(gr(n,u[s]))return!0;for(let s=0;s<n.length;s++)if(gr(u,n[s]))return!0;return!!qn(u,n)}function Cn(u,n,s){return!!gr(u,n)||!!ai(n,u,s)}function Yn(u,n){if(u.length===1)return nr(n,u[0]);for(let s=0;s<n.length;s++){const h=n[s];for(let g=0;g<h.length;g++)if(gr(u,h[g]))return!0}for(let s=0;s<u.length;s++)if(nr(n,u[s]))return!0;for(let s=0;s<n.length;s++)if(qn(u,n[s]))return!0;return!1}function Dn(u,n,s){if(u.length>1){if(qn(u,n))return!0;for(let h=0;h<n.length;h++)if(ai(n[h],u,s))return!0}for(let h=0;h<u.length;h++)if(ai(u[h],n,s))return!0;return!1}function qn(u,n){if(u.length===0||n.length===0)return!1;for(let s=0;s<u.length-1;s++){const h=u[s],g=u[s+1];for(let f=0;f<n.length-1;f++)if(di(h,g,n[f],n[f+1]))return!0}return!1}function di(u,n,s,h){return Qo(u,s,h)!==Qo(n,s,h)&&Qo(u,n,s)!==Qo(u,n,h)}function ai(u,n,s){const h=s*s;if(n.length===1)return u.distSqr(n[0])<h;for(let g=1;g<n.length;g++)if(Hi(u,n[g-1],n[g])<h)return!0;return!1}function Hi(u,n,s){const h=n.distSqr(s);if(h===0)return u.distSqr(n);const g=((u.x-n.x)*(s.x-n.x)+(u.y-n.y)*(s.y-n.y))/h;return u.distSqr(g<0?n:g>1?s:s.sub(n)._mult(g)._add(n))}function nr(u,n){let s,h,g,f=!1;for(let _=0;_<u.length;_++){s=u[_];for(let S=0,A=s.length-1;S<s.length;A=S++)h=s[S],g=s[A],h.y>n.y!=g.y>n.y&&n.x<(g.x-h.x)*(n.y-h.y)/(g.y-h.y)+h.x&&(f=!f)}return f}function gr(u,n){let s=!1;for(let h=0,g=u.length-1;h<u.length;g=h++){const f=u[h],_=u[g];f.y>n.y!=_.y>n.y&&n.x<(_.x-f.x)*(n.y-f.y)/(_.y-f.y)+f.x&&(s=!s)}return s}function Ia(u,n,s,h,g){for(const _ of u)if(n<=_.x&&s<=_.y&&h>=_.x&&g>=_.y)return!0;const f=[new Ue(n,s),new Ue(n,g),new Ue(h,g),new Ue(h,s)];if(u.length>2){for(const _ of f)if(gr(u,_))return!0}for(let _=0;_<u.length-1;_++)if(ro(u[_],u[_+1],f))return!0;return!1}function ro(u,n,s){const h=s[0],g=s[2];if(u.x<h.x&&n.x<h.x||u.x>g.x&&n.x>g.x||u.y<h.y&&n.y<h.y||u.y>g.y&&n.y>g.y)return!1;const f=Qo(u,n,s[0]);return f!==Qo(u,n,s[1])||f!==Qo(u,n,s[2])||f!==Qo(u,n,s[3])}function vi(u,n,s,h,g,f){let _=n.y-u.y,S=u.x-n.x;if(f=f||0){const A=_*_+S*S;if(A===0)return!0;const k=Math.sqrt(A);_/=k,S/=k}return!((s.x-u.x)*_+(s.y-u.y)*S-f<0||(h.x-u.x)*_+(h.y-u.y)*S-f<0||(g.x-u.x)*_+(g.y-u.y)*S-f<0)}function Yi(u,n,s,h,g,f,_){return!(vi(u,n,h,g,f,_)||vi(n,s,h,g,f,_)||vi(s,u,h,g,f,_)||vi(h,g,u,n,s,_)||vi(g,f,u,n,s,_)||vi(f,h,u,n,s,_))}function Lr(u,n,s){const h=n.paint.get(u).value;return h.kind==="constant"?h.value:s.programConfigurations.get(n.id).getMaxValue(u)}function Zi(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function li(u,n,s,h,g){if(!n[0]&&!n[1])return u;const f=Ue.convert(n)._mult(g);s==="viewport"&&f._rotate(-h);const _=[];for(let S=0;S<u.length;S++)_.push(u[S].sub(f));return _}function Oi(u,n,s,h){const g=Ue.convert(u)._mult(h);return n==="viewport"&&g._rotate(-s),g}let Ui,Zr;Pn(Fn,"CircleBucket",{omit:["layers"]});var oo,Ii={exports:{}},Mo=(oo||(oo=1,function(u,n){(function(s){function h(f,_,S){var A=g(256*f,256*(_=Math.pow(2,S)-_-1),S),k=g(256*(f+1),256*(_+1),S);return A[0]+","+A[1]+","+k[0]+","+k[1]}function g(f,_,S){var A=2*Math.PI*6378137/256/Math.pow(2,S);return[f*A-2*Math.PI*6378137/2,_*A-2*Math.PI*6378137/2]}s.getURL=function(f,_,S,A,k,x){return x=x||{},f+"?"+["bbox="+h(S,A,k),"format="+(x.format||"image/png"),"service="+(x.service||"WMS"),"version="+(x.version||"1.1.1"),"request="+(x.request||"GetMap"),"srs="+(x.srs||"EPSG:3857"),"width="+(x.width||256),"height="+(x.height||256),"layers="+_].join("&")},s.getTileBBox=h,s.getMercCoords=g,Object.defineProperty(s,"__esModule",{value:!0})})(n)}(0,Ii.exports)),Ii.exports);class jo{constructor(n,s,h){this.z=n,this.x=s,this.y=h,this.key=ks(0,n,n,s,h)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,s){const h=Mo.getTileBBox(this.x,this.y,this.z),g=function(f,_,S){let A,k="";for(let x=f;x>0;x--)A=1<<x-1,k+=(_&A?1:0)+(S&A?2:0);return k}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",g).replace("{bbox-epsg-3857}",h)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ko{constructor(n,s){this.wrap=n,this.canonical=s,this.key=ks(n,s.z,s.z,s.x,s.y)}}class cr{constructor(n,s,h,g,f){this.overscaledZ=n,this.wrap=s,this.canonical=new jo(h,+g,+f),this.key=s===0&&n===h?this.canonical.key:ks(s,n,h,g,f)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){const s=this.canonical.z-n;return n>this.canonical.z?new cr(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new cr(n,this.wrap,n,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(n,s=!0){if(this.overscaledZ===n&&s)return this.key;if(n>this.canonical.z)return ks(this.wrap*+s,n,this.canonical.z,this.canonical.x,this.canonical.y);{const h=this.canonical.z-n;return ks(this.wrap*+s,n,n,this.canonical.x>>h,this.canonical.y>>h)}}isChildOf(n){if(n.wrap!==this.wrap)return!1;const s=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.z<this.canonical.z&&n.canonical.x===this.canonical.x>>s&&n.canonical.y===this.canonical.y>>s}children(n){if(this.overscaledZ>=n)return[new cr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,h=2*this.canonical.x,g=2*this.canonical.y;return[new cr(s,this.wrap,s,h,g),new cr(s,this.wrap,s,h+1,g),new cr(s,this.wrap,s,h,g+1),new cr(s,this.wrap,s,h+1,g+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new cr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new cr(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ko(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function ks(u,n,s,h,g){const f=1<<Math.min(s,22);let _=f*(g%f)+h%f;return u&&s<22&&(_+=f*f*((u<0?-2*u-1:2*u)%(1<<2*(22-s)))),16*(32*_+s)+(n-s)}const Rs=[u=>{let n=u.canonical.x-1,s=u.wrap;return n<0&&(n=(1<<u.canonical.z)-1,s--),new cr(u.overscaledZ,s,u.canonical.z,n,u.canonical.y)},u=>{let n=u.canonical.x+1,s=u.wrap;return n===1<<u.canonical.z&&(n=0,s++),new cr(u.overscaledZ,s,u.canonical.z,n,u.canonical.y)},u=>new cr(u.overscaledZ,u.wrap,u.canonical.z,u.canonical.x,(u.canonical.y===0?1<<u.canonical.z:u.canonical.y)-1),u=>new cr(u.overscaledZ,u.wrap,u.canonical.z,u.canonical.x,u.canonical.y===(1<<u.canonical.z)-1?0:u.canonical.y+1)];Pn(jo,"CanonicalTileID"),Pn(cr,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Ca=Di([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:pa}=Ca,Hs=Di([{name:"a_pos_3",components:3,type:"Int16"}]);var Aa=Di([{name:"a_pos",type:"Int16",components:2}]);class Pl{constructor(n,s){this.pos=n,this.dir=s}intersectsPlane(n,s,h){const g=Ie.vec3.dot(s,this.dir);if(Math.abs(g)<1e-6)return!1;const f=((n[0]-this.pos[0])*s[0]+(n[1]-this.pos[1])*s[1]+(n[2]-this.pos[2])*s[2])/g;return h[0]=this.pos[0]+this.dir[0]*f,h[1]=this.pos[1]+this.dir[1]*f,h[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(n,s,h){if(Ie.vec3.equals(this.pos,n)||s===0)return h[0]=h[1]=h[2]=0,!1;const[g,f,_]=this.dir,S=this.pos[0]-n[0],A=this.pos[1]-n[1],k=this.pos[2]-n[2],x=g*g+f*f+_*_,I=2*(S*g+A*f+k*_),M=I*I-4*x*(S*S+A*A+k*k-s*s);if(M<0){const C=Math.max(-I/2,0),P=S+g*C,O=A+f*C,V=k+_*C,G=Math.hypot(P,O,V);return h[0]=P*s/G,h[1]=O*s/G,h[2]=V*s/G,!1}{const C=(-I-Math.sqrt(M))/(2*x);if(C<0){const P=Math.hypot(S,A,k);return h[0]=S*s/P,h[1]=A*s/P,h[2]=k*s/P,!1}return h[0]=S+g*C,h[1]=A+f*C,h[2]=k+_*C,!0}}}class ic{constructor(n,s,h,g,f){this.TL=n,this.TR=s,this.BR=h,this.BL=g,this.horizon=f}static fromInvProjectionMatrix(n,s,h){const g=[-1,1,1],f=[1,1,1],_=[1,-1,1],S=[-1,-1,1],A=Ie.vec3.transformMat4(g,g,n),k=Ie.vec3.transformMat4(f,f,n),x=Ie.vec3.transformMat4(_,_,n),I=Ie.vec3.transformMat4(S,S,n);return new ic(A,k,x,I,s/h)}}function al(u,n,s){let h=1/0,g=-1/0;const f=[];for(const _ of u){Ie.vec3.sub(f,_,n);const S=Ie.vec3.dot(f,s);h=Math.min(h,S),g=Math.max(g,S)}return[h,g]}function Au(u,n){let s=!0;for(let h=0;h<u.planes.length;h++){const g=u.planes[h];let f=0;for(let _=0;_<n.length;_++)f+=Ie.vec3.dot(g,n[_])+g[3]>=0;if(f===0)return 0;f!==n.length&&(s=!1)}return s?2:1}function Pu(u,n){for(const s of u.projections){const h=al(n,u.points[0],s.axis);if(s.projection[1]<h[0]||s.projection[0]>h[1])return 0}return 1}function zf(u,n){let s=0;const h=[0,0,0,0];for(let g=0;g<u.length;g++)h[0]=u[g][0],h[1]=u[g][1],h[2]=u[g][2],h[3]=1,Ie.vec4.dot(h,n)>=0&&s++;return s}class Mu{constructor(n,s){this.points=n||new Array(8).fill([0,0,0]),this.planes=s||new Array(6).fill([0,0,0,0]),this.bounds=ur.fromPoints(this.points),this.projections=[],this.frustumEdges=[Ie.vec3.sub([],this.points[2],this.points[3]),Ie.vec3.sub([],this.points[0],this.points[3]),Ie.vec3.sub([],this.points[4],this.points[0]),Ie.vec3.sub([],this.points[5],this.points[1]),Ie.vec3.sub([],this.points[6],this.points[2]),Ie.vec3.sub([],this.points[7],this.points[3])];for(const h of this.frustumEdges){const g=[0,-h[2],h[1]],f=[h[2],0,-h[0]];this.projections.push({axis:g,projection:al(this.points,this.points[0],g)}),this.projections.push({axis:f,projection:al(this.points,this.points[0],f)})}}static fromInvProjectionMatrix(n,s,h,g){const f=Math.pow(2,h),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(k=>{const x=Ie.vec4.transformMat4([],k,n),I=1/x[3]/s*f;return Ie.vec4.mul(x,x,[I,I,g?1/x[3]:I,I])}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(k=>{const x=Ie.vec3.sub([],_[k[0]],_[k[1]]),I=Ie.vec3.sub([],_[k[2]],_[k[1]]),M=Ie.vec3.normalize([],Ie.vec3.cross([],x,I)),C=-Ie.vec3.dot(M,_[k[1]]);return M.concat(C)}),A=[];for(let k=0;k<_.length;k++)A.push([_[k][0],_[k][1],_[k][2]]);return new Mu(A,S)}intersectsPrecise(n,s,h){for(let g=0;g<s.length;g++)if(!zf(n,s[g]))return 0;for(let g=0;g<this.planes.length;g++)if(!zf(n,this.planes[g]))return 0;for(const g of h)for(const f of this.frustumEdges){const _=Ie.vec3.cross([],g,f),S=Ie.vec3.length(_);if(S===0)continue;Ie.vec3.scale(_,_,1/S);const A=al(this.points,this.points[0],_),k=al(n,this.points[0],_);if(A[0]>k[1]||k[0]>A[1])return 0}return 1}containsPoint(n){for(const s of this.planes){const h=s[3];if(Ie.vec3.dot([s[0],s[1],s[2]],n)+h<0)return!1}return!0}}class ur{static fromPoints(n){const s=[1/0,1/0,1/0],h=[-1/0,-1/0,-1/0];for(const g of n)Ie.vec3.min(s,s,g),Ie.vec3.max(h,h,g);return new ur(s,h)}static fromTileIdAndHeight(n,s,h){const g=1<<n.canonical.z,f=n.canonical.x,_=n.canonical.y;return new ur([f/g,_/g,s],[(f+1)/g,(_+1)/g,h])}static applyTransform(n,s){const h=n.getCorners();for(let g=0;g<h.length;++g)Ie.vec3.transformMat4(h[g],h[g],s);return ur.fromPoints(h)}static applyTransformFast(n,s){const h=[s[12],s[13],s[14]],g=[...h];for(let f=0;f<3;f++)for(let _=0;_<3;_++){const S=s[4*_+f],A=S*n.min[_],k=S*n.max[_];h[f]+=Math.min(A,k),g[f]+=Math.max(A,k)}return new ur(h,g)}static projectAabbCorners(n,s){const h=n.getCorners();for(let g=0;g<h.length;++g)Ie.vec3.transformMat4(h[g],h[g],s);return h}constructor(n,s){this.min=n,this.max=s,this.center=Ie.vec3.scale([],Ie.vec3.add([],this.min,this.max),.5)}quadrant(n){const s=[n%2==0,n<2],h=Ie.vec3.clone(this.min),g=Ie.vec3.clone(this.max);for(let f=0;f<s.length;f++)h[f]=s[f]?this.min[f]:this.center[f],g[f]=s[f]?this.center[f]:this.max[f];return g[2]=this.max[2],new ur(h,g)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}distanceZ(n){return Math.max(Math.min(this.max[2],n[2]),this.min[2])-n[2]}getCorners(){const n=this.min,s=this.max;return[[n[0],n[1],n[2]],[s[0],n[1],n[2]],[s[0],s[1],n[2]],[n[0],s[1],n[2]],[n[0],n[1],s[2]],[s[0],n[1],s[2]],[s[0],s[1],s[2]],[n[0],s[1],s[2]]]}intersects(n){return this.intersectsAabb(n.bounds)?Au(n,this.getCorners()):0}intersectsFlat(n){return this.intersectsAabb(n.bounds)?Au(n,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(n,s){return s||this.intersects(n)?Pu(n,this.getCorners()):0}intersectsPreciseFlat(n,s){return s||this.intersectsFlat(n)?Pu(n,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(n){for(let s=0;s<3;++s)if(this.min[s]>n.max[s]||n.min[s]>this.max[s])return!1;return!0}intersectsAabbXY(n){return!(this.min[0]>n.max[0]||n.min[0]>this.max[0]||this.min[1]>n.max[1]||n.min[1]>this.max[1])}encapsulate(n){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],n.min[s]),this.max[s]=Math.max(this.max[s],n.max[s])}encapsulatePoint(n){for(let s=0;s<3;s++)this.min[s]=Math.min(this.min[s],n[s]),this.max[s]=Math.max(this.max[s],n[s])}closestPoint(n){return[Math.max(Math.min(this.max[0],n[0]),this.min[0]),Math.max(Math.min(this.max[1],n[1]),this.min[1]),Math.max(Math.min(this.max[2],n[2]),this.min[2])]}}function Lc(u){return u*i/X}Pn(ur,"Aabb");const Wb=[new ur([R,R,R],[z,z,z]),new ur([R,R,R],[0,0,z]),new ur([0,R,R],[z,0,z]),new ur([R,0,R],[0,z,z]),new ur([0,0,R],[z,z,z])];function Rv(u,n,s,h=!0){const g=Ie.vec3.scale([],u._camera.position,u.worldSize),f=[n,s,1,1];Ie.vec4.transformMat4(f,f,u.pixelMatrixInverse),Ie.vec4.scale(f,f,1/f[3]);const _=Ie.vec3.sub([],f,g),S=Ie.vec3.normalize([],_),A=u.globeMatrix,k=[A[12],A[13],A[14]],x=Ie.vec3.sub([],k,g),I=Ie.vec3.length(x),M=Ie.vec3.normalize([],x),C=u.worldSize/(2*Math.PI),P=Ie.vec3.dot(M,S),O=Math.asin(C/I);if(O<Math.acos(P)){if(!h)return null;const je=[],Oe=[];Ie.vec3.scale(je,S,I/P),Ie.vec3.normalize(Oe,Ie.vec3.sub(Oe,je,x)),Ie.vec3.normalize(S,Ie.vec3.add(S,x,Ie.vec3.scale(S,Oe,Math.tan(O)*I)))}const V=[];new Pl(g,S).closestPointOnSphere(k,C,V);const G=Ie.vec3.normalize([],bs(A,0)),J=Ie.vec3.normalize([],bs(A,1)),ee=Ie.vec3.normalize([],bs(A,2)),H=Ie.vec3.dot(G,V),se=Ie.vec3.dot(J,V),ue=Ie.vec3.dot(ee,V),we=Yt(Math.asin(-se/C));let Me=Yt(Math.atan2(H,ue));Me=u.center.lng+function(je,Oe){const He=(Oe-je+180)%360-180;return He<-180?He+360:He}(u.center.lng,Me);const Re=ke(Me),Ce=hn(De(we),0,1);return new ft(Re,Ce)}class E4{constructor(n,s,h){this.a=Ie.vec3.sub([],n,h),this.b=Ie.vec3.sub([],s,h),this.center=h;const g=Ie.vec3.normalize([],this.a),f=Ie.vec3.normalize([],this.b);this.angle=Math.acos(Ie.vec3.dot(g,f))}}function Zb(u,n){if(u.angle===0)return null;let s;return s=u.a[n]===0?1/u.angle*.5*Math.PI:1/u.angle*Math.atan(u.b[n]/u.a[n]/Math.sin(u.angle)-1/Math.tan(u.angle)),s<0||s>1?null:function(h,g,f,_){const S=Math.sin(f);return h*(Math.sin((1-_)*f)/S)+g*(Math.sin(_*f)/S)}(u.a[n],u.b[n],u.angle,hn(s,0,1))+u.center[n]}function rc(u){if(u.z<=1)return Wb[u.z+2*u.y+u.x];const n=Xb(Dv(u));return ur.fromPoints(n)}function zc(u,n,s){return Ie.vec3.scale(u,u,1-s),Ie.vec3.scaleAndAdd(u,u,n,s)}function lE(u,n,s){for(const h of u)Ie.vec3.transformMat4(h,h,n),Ie.vec3.scale(h,h,s)}function cE(u,n,s,h){const g=n/u.worldSize,f=u.globeMatrix;if(s.z<=1){const Re=rc(s).getCorners();return lE(Re,f,g),ur.fromPoints(Re)}const _=Dv(s,h),S=Xb(_,i+Lc(u._tileCoverLift));lE(S,f,g);const A=Number.MAX_VALUE,k=[-A,-A,-A],x=[A,A,A];if(_.contains(u.center)){for(const je of S)Ie.vec3.min(x,x,je),Ie.vec3.max(k,k,je);k[2]=0;const Re=u.point,Ce=[Re.x*g,Re.y*g,0];return Ie.vec3.min(x,x,Ce),Ie.vec3.max(k,k,Ce),new ur(x,k)}if(u._tileCoverLift>0){for(const Re of S)Ie.vec3.min(x,x,Re),Ie.vec3.max(k,k,Re);return new ur(x,k)}const I=[f[12]*g,f[13]*g,f[14]*g],M=_.getCenter(),C=hn(u.center.lat,-$e,$e),P=hn(M.lat,-$e,$e),O=ke(u.center.lng),V=De(C);let G=O-ke(M.lng);const J=V-De(P);G>.5?G-=1:G<-.5&&(G+=1);let ee=0;if(Math.abs(G)>Math.abs(J))ee=G>=0?1:3;else{ee=J>=0?0:2;const Re=[f[4]*g,f[5]*g,f[6]*g],Ce=-Math.sin(Gt(J>=0?_.getSouth():_.getNorth()))*i;Ie.vec3.scaleAndAdd(I,I,Re,Ce)}const H=S[ee],se=S[(ee+1)%4],ue=new E4(H,se,I),we=[Zb(ue,0)||H[0],Zb(ue,1)||H[1],Zb(ue,2)||H[2]],Me=ku(u.zoom);if(Me>0){const Re=function({x:je,y:Oe,z:He},Qe,it,ot,ct){const bt=1/(1<<He);let ut=je*bt,Ot=ut+bt,$t=Oe*bt,It=$t+bt,En=0;const mn=(ut+Ot)/2-ot;return mn>.5?En=-1:mn<-.5&&(En=1),ut=((ut+En)*Qe-(ot*=Qe))*it+ot,Ot=((Ot+En)*Qe-ot)*it+ot,$t=($t*Qe-(ct*=Qe))*it+ct,It=(It*Qe-ct)*it+ct,[[ut,It,0],[Ot,It,0],[Ot,$t,0],[ut,$t,0]]}(s,n,u._pixelsPerMercatorPixel,O,V);for(let je=0;je<S.length;je++)zc(S[je],Re[je],Me);const Ce=Ie.vec3.add([],Re[ee],Re[(ee+1)%4]);Ie.vec3.scale(Ce,Ce,.5),zc(we,Ce,Me)}for(const Re of S)Ie.vec3.min(x,x,Re),Ie.vec3.max(k,k,Re);return x[2]=Math.min(H[2],se[2]),Ie.vec3.min(x,x,we),Ie.vec3.max(k,k,we),new ur(x,k)}function Dv({x:u,y:n,z:s},h=!1){const g=1/(1<<s),f=new Q(Fe(u*g),n===(1<<s)-1&&h?-90:ze((n+1)*g)),_=new Q(Fe((u+1)*g),n===0&&h?90:ze(n*g));return new he(f,_)}function Xb(u,n=i){const s=Gt(u.getNorth()),h=Gt(u.getSouth()),g=Math.cos(s),f=Math.cos(h),_=Math.sin(s),S=Math.sin(h),A=u.getWest(),k=u.getEast();return[N(f,S,A,n),N(f,S,k,n),N(g,_,k,n),N(g,_,A,n)]}function jm(u,n,s,h){const g=1<<s.z,f=(u/_n+s.x)/g;return j(ze((n/_n+s.y)/g),Fe(f),h)}function Ov({min:u,max:n}){return b/Math.max(n[0]-u[0],n[1]-u[1],n[2]-u[2])}const uE=new Float64Array(16);function Lv(u){const n=Ov(u),s=Ie.mat4.fromScaling(uE,[n,n,n]);return Ie.mat4.translate(s,s,Ie.vec3.negate([],u.min))}function Yb(u){const n=Ie.mat4.fromTranslation(uE,u.min),s=1/Ov(u);return Ie.mat4.scale(n,n,[s,s,s])}function Kb(u){const n=_n/(2*Math.PI);return u/(2*Math.PI)/n}function hE(u,n){return _n/(512*Math.pow(2,u))*Ov(rc(n))}function dE(u,n,s,h,g){const f=Kb(s),_=[u,n,-s/(2*Math.PI)],S=Ie.mat4.identity(new Float64Array(16));return Ie.mat4.translate(S,S,_),Ie.mat4.scale(S,S,[f,f,f]),Ie.mat4.rotateX(S,S,Gt(-g)),Ie.mat4.rotateY(S,S,Gt(-h)),S}function ku(u){return jn(a,m,u)}function fE(u,n){const s=j(n.lat,n.lng),h=function(f){const _=j(f._center.lat,f._center.lng),S=Ie.vec3.fromValues(0,1,0);let A=Ie.vec3.cross([],S,_);const k=Ie.mat4.fromRotation([],-f.angle,_);A=Ie.vec3.transformMat4(A,A,k),Ie.mat4.fromRotation(k,-f._pitch,A);const x=Ie.vec3.normalize([],_);return Ie.vec3.scale(x,x,Lc(f.cameraToCenterDistance/f.pixelsPerMeter)),Ie.vec3.transformMat4(x,x,k),Ie.vec3.add([],_,x)}(u),g=Ie.vec3.subtract([],h,s);return Ie.vec3.angle(g,s)}function Jb(u,n){return fE(u,n)>Math.PI/2*1.01}const pE=Gt(85),I4=Math.cos(pE),C4=Math.sin(pE),A4=Ie.mat4.create(),mE=u=>{const n=[];return u.paint.get("circle-pitch-alignment")==="map"&&n.push("PITCH_WITH_MAP"),u.paint.get("circle-pitch-scale")==="map"&&n.push("SCALE_WITH_MAP"),n};function gE(u,n,s,h,g,f,_,S,A){if(f&&u.queryGeometry.isAboveHorizon)return!1;f&&(A*=u.pixelToTileUnitsFactor);const k=u.tileID.canonical,x=s.projection.upVectorScale(k,s.center.lat,s.worldSize).metersToTile;for(const I of n)for(const M of I){const C=M.add(S),P=g&&s.elevation?s.elevation.exaggeration()*g.getElevationAt(C.x,C.y,!0):0,O=s.projection.projectTilePoint(C.x,C.y,k);if(P>0){const ee=s.projection.upVector(k,C.x,C.y);O.x+=ee[0]*x*P,O.y+=ee[1]*x*P,O.z+=ee[2]*x*P}const V=f?C:P4(O.x,O.y,O.z,h),G=f?u.tilespaceRays.map(ee=>k4(ee,P)):u.queryGeometry.screenGeometry,J=Ie.vec4.transformMat4([],[O.x,O.y,O.z,1],h);if(!_&&f?A*=J[3]/s.cameraToCenterDistance:_&&!f&&(A*=s.cameraToCenterDistance/J[3]),f){const ee=ze((M.y/_n+k.y)/(1<<k.z));A/=s.projection.pixelsPerMeter(ee,1)/Pe(1,ee)}if(Cn(G,V,A))return!0}return!1}function P4(u,n,s,h){const g=Ie.vec4.transformMat4([],[u,n,s,1],h);return new Ue(g[0]/g[3],g[1]/g[3])}const _E=Ie.vec3.fromValues(0,0,0),M4=Ie.vec3.fromValues(0,0,1);function k4(u,n){const s=Ie.vec3.create();return _E[2]=n,u.intersectsPlane(_E,M4,s),new Ue(s[0],s[1])}class vE extends Fn{}let yE,bE,xE,wE;function SE(u,{width:n,height:s},h,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==n*s*h)throw new RangeError("mismatched image size")}else g=new Uint8Array(n*s*h);return u.width=n,u.height=s,u.data=g,u}function TE(u,n,s){const{width:h,height:g}=n;h===u.width&&g===u.height||(Qb(u,n,{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,h),height:Math.min(u.height,g)},s,null),u.width=h,u.height=g,u.data=n.data)}function Qb(u,n,s,h,g,f,_,S){if(g.width===0||g.height===0)return n;if(g.width>u.width||g.height>u.height||s.x>u.width-g.width||s.y>u.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>n.width||g.height>n.height||h.x>n.width-g.width||h.y>n.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const A=u.data,k=n.data,x=f===4&&S;for(let I=0;I<g.height;I++){const M=((s.y+I)*u.width+s.x)*f,C=((h.y+I)*n.width+h.x)*f;if(x)for(let P=0;P<g.width;P++){const O=M+P*f+3,V=C+P*f;k[V+0]=255,k[V+1]=255,k[V+2]=255,k[V+3]=A[O]}else if(_)for(let P=0;P<g.width;P++){const O=M+P*f,V=C+P*f,G=A[O+3],J=new tn(A[O+0]/255*G,A[O+1]/255*G,A[O+2]/255*G,G).toRenderColor(_).toArray();k[V+0]=J[0],k[V+1]=J[1],k[V+2]=J[2],k[V+3]=J[3]}else for(let P=0;P<g.width*f;P++)k[C+P]=A[M+P]}return n}Pn(vE,"HeatmapBucket",{omit:["layers"]});class Ru{constructor(n,s){SE(this,n,1,s)}resize(n){TE(this,new Ru(n),1)}clone(){return new Ru({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,s,h,g,f){Qb(n,s,h,g,f,1,null)}}class Ds{constructor(n,s){SE(this,n,4,s)}resize(n){TE(this,new Ds(n),4)}replace(n,s){s?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new Ds({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,s,h,g,f,_,S){Qb(n,s,h,g,f,4,_,S)}}class EE{constructor(n,s){this.width=n.width,this.height=n.height,this.data=s instanceof Uint8Array?new Float32Array(s.buffer):s}}function $m(u){const n={},s=u.resolution||256,h=u.clips?u.clips.length:1,g=u.image||new Ds({width:s,height:h}),f=(_,S,A)=>{n[u.evaluationKey]=A;const k=u.expression.evaluate(n);k&&(g.data[_+S+0]=Math.floor(255*k.r/k.a),g.data[_+S+1]=Math.floor(255*k.g/k.a),g.data[_+S+2]=Math.floor(255*k.b/k.a),g.data[_+S+3]=Math.floor(255*k.a))};if(u.clips)for(let _=0,S=0;_<h;++_,S+=4*s)for(let A=0,k=0;A<s;A++,k+=4){const x=A/(s-1),{start:I,end:M}=u.clips[_];f(S,k,I*(1-x)+M*x)}else for(let _=0,S=0;_<s;_++,S+=4)f(0,S,_/(s-1));return g}Pn(Ru,"AlphaImage"),Pn(Ds,"RGBAImage");const R4=Di([{name:"a_pos",components:2,type:"Int16"}],4),{members:D4}=R4;function Gm(u,n,s=2){const h=n&&n.length,g=h?n[0]*s:u.length;let f=IE(u,0,g,s,!0);const _=[];if(!f||f.next===f.prev)return _;let S,A,k;if(h&&(f=function(x,I,M,C){const P=[];for(let O=0,V=I.length;O<V;O++){const G=IE(x,I[O]*C,O<V-1?I[O+1]*C:x.length,C,!1);G===G.next&&(G.steiner=!0),P.push(U4(G))}P.sort(F4);for(let O=0;O<P.length;O++)M=V4(P[O],M);return M}(u,n,f,s)),u.length>80*s){S=1/0,A=1/0;let x=-1/0,I=-1/0;for(let M=s;M<g;M+=s){const C=u[M],P=u[M+1];C<S&&(S=C),P<A&&(A=P),C>x&&(x=C),P>I&&(I=P)}k=Math.max(x-S,I-A),k=k!==0?32767/k:0}return Hm(f,_,s,S,A,k,0),_}function IE(u,n,s,h,g){let f;if(g===function(_,S,A,k){let x=0;for(let I=S,M=A-k;I<A;I+=k)x+=(_[M]-_[I])*(_[I+1]+_[M+1]),M=I;return x}(u,n,s,h)>0)for(let _=n;_<s;_+=h)f=PE(_/h|0,u[_],u[_+1],f);else for(let _=s-h;_>=n;_-=h)f=PE(_/h|0,u[_],u[_+1],f);return f&&zv(f,f.next)&&(Wm(f),f=f.next),f}function Gh(u,n){if(!u)return u;n||(n=u);let s,h=u;do if(s=!1,h.steiner||!zv(h,h.next)&&Ro(h.prev,h,h.next)!==0)h=h.next;else{if(Wm(h),h=n=h.prev,h===h.next)break;s=!0}while(s||h!==n);return n}function Hm(u,n,s,h,g,f,_){if(!u)return;!_&&f&&function(A,k,x,I){let M=A;do M.z===0&&(M.z=ex(M.x,M.y,k,x,I)),M.prevZ=M.prev,M.nextZ=M.next,M=M.next;while(M!==A);M.prevZ.nextZ=null,M.prevZ=null,function(C){let P,O=1;do{let V,G=C;C=null;let J=null;for(P=0;G;){P++;let ee=G,H=0;for(let ue=0;ue<O&&(H++,ee=ee.nextZ,ee);ue++);let se=O;for(;H>0||se>0&&ee;)H!==0&&(se===0||!ee||G.z<=ee.z)?(V=G,G=G.nextZ,H--):(V=ee,ee=ee.nextZ,se--),J?J.nextZ=V:C=V,V.prevZ=J,J=V;G=ee}J.nextZ=null,O*=2}while(P>1)}(M)}(u,h,g,f);let S=u;for(;u.prev!==u.next;){const A=u.prev,k=u.next;if(f?L4(u,h,g,f):O4(u))n.push(A.i,u.i,k.i),Wm(u),u=k.next,S=k.next;else if((u=k)===S){_?_===1?Hm(u=z4(Gh(u),n),n,s,h,g,f,2):_===2&&B4(u,n,s,h,g,f):Hm(Gh(u),n,s,h,g,f,1);break}}}function O4(u){const n=u.prev,s=u,h=u.next;if(Ro(n,s,h)>=0)return!1;const g=n.x,f=s.x,_=h.x,S=n.y,A=s.y,k=h.y,x=g<f?g<_?g:_:f<_?f:_,I=S<A?S<k?S:k:A<k?A:k,M=g>f?g>_?g:_:f>_?f:_,C=S>A?S>k?S:k:A>k?A:k;let P=h.next;for(;P!==n;){if(P.x>=x&&P.x<=M&&P.y>=I&&P.y<=C&&Bf(g,S,f,A,_,k,P.x,P.y)&&Ro(P.prev,P,P.next)>=0)return!1;P=P.next}return!0}function L4(u,n,s,h){const g=u.prev,f=u,_=u.next;if(Ro(g,f,_)>=0)return!1;const S=g.x,A=f.x,k=_.x,x=g.y,I=f.y,M=_.y,C=S<A?S<k?S:k:A<k?A:k,P=x<I?x<M?x:M:I<M?I:M,O=S>A?S>k?S:k:A>k?A:k,V=x>I?x>M?x:M:I>M?I:M,G=ex(C,P,n,s,h),J=ex(O,V,n,s,h);let ee=u.prevZ,H=u.nextZ;for(;ee&&ee.z>=G&&H&&H.z<=J;){if(ee.x>=C&&ee.x<=O&&ee.y>=P&&ee.y<=V&&ee!==g&&ee!==_&&Bf(S,x,A,I,k,M,ee.x,ee.y)&&Ro(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,H.x>=C&&H.x<=O&&H.y>=P&&H.y<=V&&H!==g&&H!==_&&Bf(S,x,A,I,k,M,H.x,H.y)&&Ro(H.prev,H,H.next)>=0))return!1;H=H.nextZ}for(;ee&&ee.z>=G;){if(ee.x>=C&&ee.x<=O&&ee.y>=P&&ee.y<=V&&ee!==g&&ee!==_&&Bf(S,x,A,I,k,M,ee.x,ee.y)&&Ro(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;H&&H.z<=J;){if(H.x>=C&&H.x<=O&&H.y>=P&&H.y<=V&&H!==g&&H!==_&&Bf(S,x,A,I,k,M,H.x,H.y)&&Ro(H.prev,H,H.next)>=0)return!1;H=H.nextZ}return!0}function z4(u,n){let s=u;do{const h=s.prev,g=s.next.next;!zv(h,g)&&CE(h,s,s.next,g)&&qm(h,g)&&qm(g,h)&&(n.push(h.i,s.i,g.i),Wm(s),Wm(s.next),s=u=g),s=s.next}while(s!==u);return Gh(s)}function B4(u,n,s,h,g,f){let _=u;do{let S=_.next.next;for(;S!==_.prev;){if(_.i!==S.i&&j4(_,S)){let A=AE(_,S);return _=Gh(_,_.next),A=Gh(A,A.next),Hm(_,n,s,h,g,f,0),void Hm(A,n,s,h,g,f,0)}S=S.next}_=_.next}while(_!==u)}function F4(u,n){return u.x-n.x}function V4(u,n){const s=function(g,f){let _=f;const S=g.x,A=g.y;let k,x=-1/0;do{if(A<=_.y&&A>=_.next.y&&_.next.y!==_.y){const O=_.x+(A-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(O<=S&&O>x&&(x=O,k=_.x<_.next.x?_:_.next,O===S))return k}_=_.next}while(_!==f);if(!k)return null;const I=k,M=k.x,C=k.y;let P=1/0;_=k;do{if(S>=_.x&&_.x>=M&&S!==_.x&&Bf(A<C?S:x,A,M,C,A<C?x:S,A,_.x,_.y)){const O=Math.abs(A-_.y)/(S-_.x);qm(_,g)&&(O<P||O===P&&(_.x>k.x||_.x===k.x&&N4(k,_)))&&(k=_,P=O)}_=_.next}while(_!==I);return k}(u,n);if(!s)return n;const h=AE(s,u);return Gh(h,h.next),Gh(s,s.next)}function N4(u,n){return Ro(u.prev,u,n.prev)<0&&Ro(n.next,u,u.next)<0}function ex(u,n,s,h,g){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-s)*g|0)|u<<8))|u<<4))|u<<2))|u<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-h)*g|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function U4(u){let n=u,s=u;do(n.x<s.x||n.x===s.x&&n.y<s.y)&&(s=n),n=n.next;while(n!==u);return s}function Bf(u,n,s,h,g,f,_,S){return(g-_)*(n-S)>=(u-_)*(f-S)&&(u-_)*(h-S)>=(s-_)*(n-S)&&(s-_)*(f-S)>=(g-_)*(h-S)}function j4(u,n){return u.next.i!==n.i&&u.prev.i!==n.i&&!function(s,h){let g=s;do{if(g.i!==s.i&&g.next.i!==s.i&&g.i!==h.i&&g.next.i!==h.i&&CE(g,g.next,s,h))return!0;g=g.next}while(g!==s);return!1}(u,n)&&(qm(u,n)&&qm(n,u)&&function(s,h){let g=s,f=!1;const _=(s.x+h.x)/2,S=(s.y+h.y)/2;do g.y>S!=g.next.y>S&&g.next.y!==g.y&&_<(g.next.x-g.x)*(S-g.y)/(g.next.y-g.y)+g.x&&(f=!f),g=g.next;while(g!==s);return f}(u,n)&&(Ro(u.prev,u,n.prev)||Ro(u,n.prev,n))||zv(u,n)&&Ro(u.prev,u,u.next)>0&&Ro(n.prev,n,n.next)>0)}function Ro(u,n,s){return(n.y-u.y)*(s.x-n.x)-(n.x-u.x)*(s.y-n.y)}function zv(u,n){return u.x===n.x&&u.y===n.y}function CE(u,n,s,h){const g=Fv(Ro(u,n,s)),f=Fv(Ro(u,n,h)),_=Fv(Ro(s,h,u)),S=Fv(Ro(s,h,n));return g!==f&&_!==S||!(g!==0||!Bv(u,s,n))||!(f!==0||!Bv(u,h,n))||!(_!==0||!Bv(s,u,h))||!(S!==0||!Bv(s,n,h))}function Bv(u,n,s){return n.x<=Math.max(u.x,s.x)&&n.x>=Math.min(u.x,s.x)&&n.y<=Math.max(u.y,s.y)&&n.y>=Math.min(u.y,s.y)}function Fv(u){return u>0?1:u<0?-1:0}function qm(u,n){return Ro(u.prev,u,u.next)<0?Ro(u,n,u.next)>=0&&Ro(u,u.prev,n)>=0:Ro(u,n,u.prev)<0||Ro(u,u.next,n)<0}function AE(u,n){const s=tx(u.i,u.x,u.y),h=tx(n.i,n.x,n.y),g=u.next,f=n.prev;return u.next=n,n.prev=u,s.next=g,g.prev=s,h.next=s,s.prev=h,f.next=h,h.prev=f,h}function PE(u,n,s,h){const g=tx(u,n,s);return h?(g.next=h.next,g.prev=h,h.next.prev=g,h.next=g):(g.prev=g,g.next=g),g}function Wm(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function tx(u,n,s){return{i:u,x:n,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Vv(u,n){const s=u.length;if(s<=1)return[u];const h=[];let g,f;for(let _=0;_<s;_++){const S=vs(u[_]);S!==0&&(u[_].area=Math.abs(S),f===void 0&&(f=S<0),f===S<0?(g&&h.push(g),g=[u[_]]):g.push(u[_]))}if(g&&h.push(g),n>1)for(let _=0;_<h.length;_++)h[_].length<=n||(_h(h[_],n,1,h[_].length-1,$4),h[_]=h[_].slice(0,n));return h}function $4(u,n){return n.area-u.area}function nx(u,n,s){const h=s.patternDependencies;let g=!1;for(const f of n){const _=f.paint.get(`${u}-pattern`);_.isConstant()||(g=!0);const S=_.constantOr(null);S&&(g=!0,h[S]=!0)}return g}function ix(u,n,s,h,g){const f=g.patternDependencies;for(const _ of n){const S=_.paint.get(`${u}-pattern`).value;if(S.kind!=="constant"){let A=S.evaluate({zoom:h},s,{},g.availableImages);A=A&&A.name?A.name:A,f[A]=!0,s.patterns[_.id]=A}}return s}class rx{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Jl,this.indexArray=new ss,this.indexArray2=new tc,this.programConfigurations=new nc(n.layers,{zoom:n.zoom,lut:n.lut}),this.segments=new Wr,this.segments2=new Wr,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=n.projection}updateFootprints(n,s){}populate(n,s,h,g){this.hasPattern=nx("fill",this.layers,s);const f=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:S,id:A,index:k,sourceLayerIndex:x}of n){const I=this.layers[0]._featureFilter.needGeometry,M=ln(S,I);if(!this.layers[0]._featureFilter.filter(new qr(this.zoom),M,h))continue;const C=f?f.evaluate(M,{},h,s.availableImages):void 0,P={id:A,properties:S.properties,type:S.type,sourceLayerIndex:x,index:k,geometry:I?M.geometry:sn(S,h,g),patterns:{},sortKey:C};_.push(P)}f&&_.sort((S,A)=>S.sortKey-A.sortKey);for(const S of _){const{geometry:A,index:k,sourceLayerIndex:x}=S;if(this.hasPattern){const I=ix("fill",this.layers,S,this.zoom,s);this.patternFeatures.push(I)}else this.addFeature(S,A,k,h,{},s.availableImages,s.brightness);s.featureIndex.insert(n[k].feature,A,k,x,this.index)}}update(n,s,h,g,f){const _=Object.keys(n).length!==0;_&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(n,s,_?this.stateDependentLayers:this.layers,h,g,f)}addFeatures(n,s,h,g,f,_){for(const S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,s,h,g,_)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,D4),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,s,h,g,f,_=[],S){for(const A of Vv(s,500)){let k=0;for(const O of A)k+=O.length;const x=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray),I=x.vertexLength,M=[],C=[];for(const O of A){if(O.length===0)continue;O!==A[0]&&C.push(M.length/2);const V=this.segments2.prepareSegment(O.length,this.layoutVertexArray,this.indexArray2),G=V.vertexLength;this.layoutVertexArray.emplaceBack(O[0].x,O[0].y),this.indexArray2.emplaceBack(G+O.length-1,G),M.push(O[0].x),M.push(O[0].y);for(let J=1;J<O.length;J++)this.layoutVertexArray.emplaceBack(O[J].x,O[J].y),this.indexArray2.emplaceBack(G+J-1,G+J),M.push(O[J].x),M.push(O[J].y);V.vertexLength+=O.length,V.primitiveLength+=O.length}const P=Gm(M,C);for(let O=0;O<P.length;O+=3)this.indexArray.emplaceBack(I+P[O],I+P[O+1],I+P[O+2]);x.vertexLength+=k,x.primitiveLength+=P.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,h,f,_,g,S)}}let ME,kE,RE,DE;Pn(rx,"FillBucket",{omit:["layers","patternFeatures"]});class ox{constructor(n,s,h,g){if(this.triangleCount=s.length/3,this.min=new Ue(0,0),this.max=new Ue(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||n.length===0)return;const[f,_]=[n[0].clone(),n[0].clone()];for(let I=1;I<n.length;++I){const M=n[I];f.x=Math.min(f.x,M.x),f.y=Math.min(f.y,M.y),_.x=Math.max(_.x,M.x),_.y=Math.max(_.y,M.y)}if(g){const I=Math.ceil(Math.max(_.x-f.x,_.y-f.y)/g);h=Math.max(h,I)}if(h===0)return;this.min=f,this.max=_;const S=this.max.sub(this.min);S.x=Math.max(S.x,1),S.y=Math.max(S.y,1);const A=Math.max(S.x,S.y)/h;this.cellsX=Math.max(1,Math.ceil(S.x/A)),this.cellsY=Math.max(1,Math.ceil(S.y/A)),this.xScale=1/A,this.yScale=1/A;const k=[];for(let I=0;I<this.triangleCount;I++){const M=n[s[3*I+0]].sub(this.min),C=n[s[3*I+1]].sub(this.min),P=n[s[3*I+2]].sub(this.min),O=oc(Math.floor(Math.min(M.x,C.x,P.x)),this.xScale,this.cellsX),V=oc(Math.floor(Math.max(M.x,C.x,P.x)),this.xScale,this.cellsX),G=oc(Math.floor(Math.min(M.y,C.y,P.y)),this.yScale,this.cellsY),J=oc(Math.floor(Math.max(M.y,C.y,P.y)),this.yScale,this.cellsY),ee=new Ue(0,0),H=new Ue(0,0),se=new Ue(0,0),ue=new Ue(0,0);for(let we=G;we<=J;++we){ee.y=H.y=we*A,se.y=ue.y=(we+1)*A;for(let Me=O;Me<=V;++Me)ee.x=se.x=Me*A,H.x=ue.x=(Me+1)*A,(Yi(M,C,P,ee,H,ue)||Yi(M,C,P,ee,ue,se))&&k.push({cellIdx:we*this.cellsX+Me,triIdx:I})}}if(k.length===0)return;k.sort((I,M)=>I.cellIdx-M.cellIdx||I.triIdx-M.triIdx);let x=0;for(;x<k.length;){const I=k[x].cellIdx,M={start:this.payload.length,len:0};for(;x<k.length&&k[x].cellIdx===I;)++M.len,this.payload.push(k[x++].triIdx);this.cells[I]=M}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(n,s){if(this.triangleCount===0||this.cells.length===0||n.x>this.max.x||this.min.x>n.x||n.y>this.max.y||this.min.y>n.y)return;const h=oc(n.x-this.min.x,this.xScale,this.cellsX),g=oc(n.y-this.min.y,this.yScale,this.cellsY),f=this.cells[g*this.cellsX+h];if(f){this._lazyInitLookup();for(let _=0;_<f.len;_++){const S=this.payload[f.start+_],A=Math.floor(S/8),k=1<<S%8;if(!(this.lookup[A]&k)&&(this.lookup[A]|=k,s.push(S),s.length===this.triangleCount))return}}}query(n,s,h){if(this.triangleCount===0||this.cells.length===0||n.x>this.max.x||this.min.x>s.x||n.y>this.max.y||this.min.y>s.y)return;this._lazyInitLookup();const g=oc(n.x-this.min.x,this.xScale,this.cellsX),f=oc(s.x-this.min.x,this.xScale,this.cellsX),_=oc(n.y-this.min.y,this.yScale,this.cellsY),S=oc(s.y-this.min.y,this.yScale,this.cellsY);for(let A=_;A<=S;A++)for(let k=g;k<=f;k++){const x=this.cells[A*this.cellsX+k];if(x)for(let I=0;I<x.len;I++){const M=this.payload[x.start+I],C=Math.floor(M/8),P=1<<M%8;if(!(this.lookup[C]&P)&&(this.lookup[C]|=P,h.push(M),h.length===this.triangleCount))return}}}}function oc(u,n,s){return Math.max(0,Math.min(s-1,Math.floor(u*n)))}Pn(ox,"TriangleGridIndex");class OE{constructor(n){this.zoom=n.zoom,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=n.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.footprints=[]}updateFootprints(n,s){for(const h of this.footprints)s.push({footprint:h,id:n})}populate(n,s,h,g){const f=[];for(const{feature:_,id:S,index:A,sourceLayerIndex:k}of n){const x=this.layers[0]._featureFilter.needGeometry,I=ln(_,x);if(!this.layers[0]._featureFilter.filter(new qr(this.zoom),I,h))continue;const M={id:S,properties:_.properties,type:_.type,sourceLayerIndex:k,index:A,geometry:x?I.geometry:sn(_,h,g),patterns:{}};f.push(M)}for(const _ of f){const{geometry:S,index:A,sourceLayerIndex:k}=_;this.addFeature(_,S,A,h,{},s.availableImages,s.brightness),s.featureIndex.insert(n[A].feature,S,A,k,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(n){}update(n,s,h,g,f){}destroy(){}addFeature(n,s,h,g,f,_=[],S){for(const A of Vv(s,2)){const k=[],x=[],I=[],M=new Ue(1/0,1/0),C=new Ue(-1/0,-1/0);for(const V of A)if(V.length!==0){V!==A[0]&&I.push(x.length/2);for(let G=0;G<V.length;G++)x.push(V[G].x),x.push(V[G].y),k.push(V[G]),M.x=Math.min(M.x,V[G].x),M.y=Math.min(M.y,V[G].y),C.x=Math.max(C.x,V[G].x),C.y=Math.max(C.y,V[G].y)}const P=Gm(x,I),O=new ox(k,P,8,256);this.footprints.push({vertices:k,indices:P,grid:O,min:M,max:C})}}}Pn(OE,"ClipBucket",{omit:["layers"]});const G4=Di([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),H4=Di([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),q4=Di([{name:"a_centroid_pos",components:2,type:"Uint16"}]),W4=Di([{name:"a_join_normal_inside",components:3,type:"Int16"}]),Z4=Di([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),X4=Di([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Y4}=G4;var sx,LE,ax,zE,lx,BE,FE,Nv={};function VE(){if(LE)return sx;LE=1;var u=Ne();function n(g,f,_,S,A){this.properties={},this.extent=_,this.type=0,this._pbf=g,this._geometry=-1,this._keys=S,this._values=A,g.readFields(s,this,f)}function s(g,f,_){g==1?f.id=_.readVarint():g==2?function(S,A){for(var k=S.readVarint()+S.pos;S.pos<k;){var x=A._keys[S.readVarint()],I=A._values[S.readVarint()];A.properties[x]=I}}(_,f):g==3?f.type=_.readVarint():g==4&&(f._geometry=_.pos)}function h(g){for(var f,_,S=0,A=0,k=g.length,x=k-1;A<k;x=A++)S+=((_=g[x]).x-(f=g[A]).x)*(f.y+_.y);return S}return sx=n,n.types=["Unknown","Point","LineString","Polygon"],n.prototype.loadGeometry=function(){var g=this._pbf;g.pos=this._geometry;for(var f,_=g.readVarint()+g.pos,S=1,A=0,k=0,x=0,I=[];g.pos<_;){if(A<=0){var M=g.readVarint();S=7&M,A=M>>3}if(A--,S===1||S===2)k+=g.readSVarint(),x+=g.readSVarint(),S===1&&(f&&I.push(f),f=[]),f.push(new u(k,x));else{if(S!==7)throw new Error("unknown command "+S);f&&f.push(f[0].clone())}}return f&&I.push(f),I},n.prototype.bbox=function(){var g=this._pbf;g.pos=this._geometry;for(var f=g.readVarint()+g.pos,_=1,S=0,A=0,k=0,x=1/0,I=-1/0,M=1/0,C=-1/0;g.pos<f;){if(S<=0){var P=g.readVarint();_=7&P,S=P>>3}if(S--,_===1||_===2)(A+=g.readSVarint())<x&&(x=A),A>I&&(I=A),(k+=g.readSVarint())<M&&(M=k),k>C&&(C=k);else if(_!==7)throw new Error("unknown command "+_)}return[x,M,I,C]},n.prototype.toGeoJSON=function(g,f,_){var S,A,k=this.extent*Math.pow(2,_),x=this.extent*g,I=this.extent*f,M=this.loadGeometry(),C=n.types[this.type];function P(G){for(var J=0;J<G.length;J++){var ee=G[J];G[J]=[360*(ee.x+x)/k-180,360/Math.PI*Math.atan(Math.exp((180-360*(ee.y+I)/k)*Math.PI/180))-90]}}switch(this.type){case 1:var O=[];for(S=0;S<M.length;S++)O[S]=M[S][0];P(M=O);break;case 2:for(S=0;S<M.length;S++)P(M[S]);break;case 3:for(M=function(G){var J=G.length;if(J<=1)return[G];for(var ee,H,se=[],ue=0;ue<J;ue++){var we=h(G[ue]);we!==0&&(H===void 0&&(H=we<0),H===we<0?(ee&&se.push(ee),ee=[G[ue]]):ee.push(G[ue]))}return ee&&se.push(ee),se}(M),S=0;S<M.length;S++)for(A=0;A<M[S].length;A++)P(M[S][A])}M.length===1?M=M[0]:C="Multi"+C;var V={type:"Feature",geometry:{type:C,coordinates:M},properties:this.properties};return"id"in this&&(V.id=this.id),V},sx}function NE(){if(zE)return ax;zE=1;var u=VE();function n(h,g){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=h,this._keys=[],this._values=[],this._features=[],h.readFields(s,this,g),this.length=this._features.length}function s(h,g,f){h===15?g.version=f.readVarint():h===1?g.name=f.readString():h===5?g.extent=f.readVarint():h===2?g._features.push(f.pos):h===3?g._keys.push(f.readString()):h===4&&g._values.push(function(_){for(var S=null,A=_.readVarint()+_.pos;_.pos<A;){var k=_.readVarint()>>3;S=k===1?_.readString():k===2?_.readFloat():k===3?_.readDouble():k===4?_.readVarint64():k===5?_.readVarint():k===6?_.readSVarint():k===7?_.readBoolean():null}return S}(f))}return ax=n,n.prototype.feature=function(h){if(h<0||h>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[h];var g=this._pbf.readVarint()+this._pbf.pos;return new u(this._pbf,g,this.extent,this._keys,this._values)},ax}function UE(){return FE||(FE=1,Nv.VectorTile=function(){if(BE)return lx;BE=1;var u=NE();function n(s,h,g){if(s===3){var f=new u(g,g.readVarint()+g.pos);f.length&&(h[f.name]=f)}}return lx=function(s,h){this.layers=s.readFields(n,{},h)},lx}(),Nv.VectorTileFeature=VE(),Nv.VectorTileLayer=NE()),Nv}var Ff=UE();class Hh extends Ue{constructor(n,s,h){super(n,s),this.z=h}}class jE extends Hh{constructor(n,s,h,g){super(n,s,h),this.w=g}}function Uv(u,n,s,h){const g=[],f=h===0?(_,S,A,k,x,I)=>{_.push(new Ue(I,A+(I-S)/(k-S)*(x-A)))}:(_,S,A,k,x,I)=>{_.push(new Ue(S+(I-A)/(x-A)*(k-S),I))};for(const _ of u){const S=[];for(const A of _){if(A.length<=2)continue;const k=[];for(let M=0;M<A.length-1;M++){const C=A[M].x,P=A[M].y,O=A[M+1].x,V=A[M+1].y,G=h===0?C:P,J=h===0?O:V;G<n?J>n&&f(k,C,P,O,V,n):G>s?J<s&&f(k,C,P,O,V,s):k.push(A[M]),J<n&&G>=n&&f(k,C,P,O,V,n),J>s&&G<=s&&f(k,C,P,O,V,s)}let x=A[A.length-1];const I=h===0?x.x:x.y;I>=n&&I<=s&&k.push(x),k.length&&(x=k[k.length-1],k[0].x===x.x&&k[0].y===x.y||k.push(k[0]),S.push(k))}S.length&&g.push(S)}return g}function $E(u,n,s,h){const g=s==="x"?"y":"x",f=(h-u[s])/(n[s]-u[s]);u[g]=u[g]+(n[g]-u[g])*f,u[s]=h,u.hasOwnProperty("z")&&(u.z=In(u.z,n.z,f)),u.hasOwnProperty("w")&&(u.w=In(u.w,n.w,f))}function GE(u,n,s,h){const g=s,f=h;for(const _ of["x","y"]){let S=u,A=n;S[_]>=A[_]&&(S=n,A=u),S[_]<g&&A[_]>g&&$E(S,A,_,g),S[_]<f&&A[_]>f&&$E(A,S,_,f)}}const jv=Number.MAX_SAFE_INTEGER;function HE(u,n,s,h){return u.order<n||u.order===jv||!(u.clipMask&s)||function(g,f){return f.length!==0&&f.find(_=>_===g)===void 0}(h,u.clipScope)}function $v(u,n){return u.x-n.x||u.y-n.y}function qE(u,n){return $v(u.min,n.min)===0&&$v(u.max,n.max)===0}function cx(u,n){return!(u.min.x>n.max.x||u.max.x<n.min.x||u.min.y>n.max.y||u.max.y<n.min.y)}function ux(u,n){if(u.length!==n.length)return!1;for(let s=0;s<u.length;s++)if(u[s].sourceId!==n[s].sourceId||!qE(u[s],n[s])||u[s].order!==n[s].order||u[s].clipMask!==n[s].clipMask||!Et(u[s].clipScope,n[s].clipScope))return!1;return!0}function WE(u,n,s){const h=1/_n,g=1/(1<<s.canonical.z),f=(n.x*h+s.canonical.x)*g+s.wrap,_=(n.y*h+s.canonical.y)*g;return{min:new Ue((u.x*h+s.canonical.x)*g+s.wrap,(u.y*h+s.canonical.y)*g),max:new Ue(f,_)}}function K4(u,n,s){const h=1<<s.canonical.z,g=((n.x-s.wrap)*h-s.canonical.x)*_n,f=(n.y*h-s.canonical.y)*_n;return{min:new Ue(((u.x-s.wrap)*h-s.canonical.x)*_n,(u.y*h-s.canonical.y)*_n),max:new Ue(g,f)}}function ZE(u,n,s,h,g,f,_){const S=u.indices,A=u.vertices,k=[];for(let x=h;x<h+g;x+=3){const I=n[s[x+0]+f],M=n[s[x+1]+f],C=n[s[x+2]+f],P=Math.min(I.x,M.x,C.x),O=Math.max(I.x,M.x,C.x),V=Math.min(I.y,M.y,C.y),G=Math.max(I.y,M.y,C.y);k.length=0,u.grid.query(new Ue(P,V),new Ue(O,G),k);for(let J=0;J<k.length;J++){const ee=k[J];if(Yi(A[S[3*ee+0]],A[S[3*ee+1]],A[S[3*ee+2]],I,M,C,_))return!0}}return!1}function XE(u,n,s,h){if(!u||!s)return!1;let g=u.vertices;if(!n.canonical.equals(h.canonical)||n.wrap!==h.wrap){if(s.vertices.length<u.vertices.length)return XE(s,h,u,n);const f=n.canonical,_=h.canonical,S=Math.pow(2,_.z-f.z);g=u.vertices.map(A=>new Ue((A.x+f.x*_n)*S-_.x*_n,(A.y+f.y*_n)*S-_.y*_n))}return ZE(s,g,u.indices,0,u.indices.length,0,0)}function YE(u,n,s,h){const g=Math.pow(2,h.z-s.z);return new Ue((u+s.x*_n)*g-h.x*_n,(n+s.y*_n)*g-h.y*_n)}function KE(u,n){const s=[];n.grid.queryPoint(u,s);const h=n.indices,g=n.vertices;for(let f=0;f<s.length;f++){const _=s[f];if(gr([g[h[3*_+0]],g[h[3*_+1]],g[h[3*_+2]]],u))return!0}return!1}const hx=[new Ue(0,0),new Ue(_n,0),new Ue(_n,_n),new Ue(0,_n)];function JE(u,n){const s=[];let h=[];if(!n||u.length<2)return[u];if(u.length===2)return ro(u[0],u[1],hx)?[u]:[];for(let g=0;g<u.length+2;g++){const f=u[g%u.length],_=u[(g+1)%u.length],S=ro(g===0?u[u.length-1]:u[(g-1)%u.length],f,hx),A=ro(f,_,hx),k=S||A;k&&h.push(f),k&&A||h.length>0&&(h.length>1&&s.push(h),h=[])}return h.length>1&&s.push(h),s}const dx=Ff.VectorTileFeature.types,J4=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],Q4=["fill-extrusion-flood-light-ground-radius"],eF=Math.pow(2,13),tF=Math.pow(2,15)-1,QE=new Ue(0,1),Du=2147483648;function Zm(u,n,s,h,g,f,_,S){u.emplaceBack((n<<1)+_,(s<<1)+f,(Math.floor(h*eF)<<1)+g,Math.round(S))}function Xm(u,n,s){u.emplaceBack(n.x*_n,n.y*_n,s?1:0)}function Gv(u,n,s,h,g,f){u.emplaceBack(n.x,n.y,(s.x<<1)+h,(s.y<<1)+g,f)}function Ym(u,n,s){u.emplaceBack(n.x,n.y,n.z,s[0]*16384,s[1]*16384,s[2]*16384)}class eI{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class tI{constructor(){this.centroidXY=new Ue(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ue(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ue(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Ue(this.max.x-this.min.x,this.max.y-this.min.y)}}class nI{constructor(){this.acc=new Ue(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(n,s){n.min.x===Number.MAX_VALUE&&(n.min.x=n.max.x=s.x,n.min.y=n.max.y=s.y)}appendEdge(n,s,h){this.accCount++,this.acc._add(s);let g=!!this.borders;s.x<n.min.x?(n.min.x=s.x,g=!0):s.x>n.max.x&&(n.max.x=s.x,g=!0),s.y<n.min.y?(n.min.y=s.y,g=!0):s.y>n.max.y&&(n.max.y=s.y,g=!0),((s.x===0||s.x===_n)&&s.x===h.x)!=((s.y===0||s.y===_n)&&s.y===h.y)&&this.processBorderOverlap(s,h),g&&this.checkBorderIntersection(s,h)}checkBorderIntersection(n,s){s.x<0!=n.x<0&&this.addBorderIntersection(0,In(s.y,n.y,(0-s.x)/(n.x-s.x))),s.x>_n!=n.x>_n&&this.addBorderIntersection(1,In(s.y,n.y,(_n-s.x)/(n.x-s.x))),s.y<0!=n.y<0&&this.addBorderIntersection(2,In(s.x,n.x,(0-s.y)/(n.y-s.y))),s.y>_n!=n.y>_n&&this.addBorderIntersection(3,In(s.x,n.x,(_n-s.y)/(n.y-s.y)))}addBorderIntersection(n,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const h=this.borders[n];s<h[0]&&(h[0]=s),s>h[1]&&(h[1]=s)}processBorderOverlap(n,s){if(n.x===s.x){if(n.y===s.y)return;const h=n.x===0?0:1;this.addBorderIntersection(h,s.y),this.addBorderIntersection(h,n.y)}else{const h=n.y===0?2:3;this.addBorderIntersection(h,s.x),this.addBorderIntersection(h,n.x)}}centroid(){return this.accCount===0?new Ue(0,0):new Ue(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((n,s)=>n+ +(s[0]!==Number.MAX_VALUE),0):0}}function iI(u,n){const s=u.add(n)._unit(),h=hn(u.x*s.x+u.y*s.y,-1,1);var g,f,_;return _=Math.acos(h),Math.min(4,Math.max(-4,Math.tan(_)))/4*tF*((g=u).x*(f=n).y-g.y*f.x<0?-1:1)}const nF=[u=>u.x<0,u=>u.x>_n,u=>u.y<0,u=>u.y>_n];function iF(u,n,s,h){const g=[4];if(h===0)return g;s._mult(h);const f=u.sub(s),_=n.sub(s),S=[u,n,f,_];for(let A=0;A<4;A++)for(const k of S)if(nF[A](k)){g.push(A);break}return g}class rI{constructor(n){this.vertexArray=new Cf,this.indexArray=new ss,this.programConfigurations=new nc(n.layers,{zoom:n.zoom,lut:n.lut},s=>Q4.includes(s)),this._segments=new Wr,this.hiddenByLandmarkVertexArray=new kf,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Wr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(n,s,h,g=!1){const f=n.length;if(f>2){let _=Math.max(0,this._segments.get().length-1);const S=this._segments._prepareSegment(4*f,this.vertexArray.length,2*this._segmentToGroundQuads[_].length);let A;_!==this._segments.get().length-1&&(_++,this._segmentToGroundQuads[_]=[],this._segmentToRegionTriCounts[_]=[0,0,0,0,0]);{const k=n[0],x=n[1];A=iI(k.sub(n[f-1])._perp()._unit(),x.sub(k)._perp()._unit())}for(let k=0;k<f;k++){const x=k===f-1?0:k+1,I=n[k],M=n[x],C=n[x===f-1?0:x+1],P=M.sub(I)._perp()._unit(),O=iI(P,C.sub(M)._perp()._unit()),V=A,G=O;if(fx(I,M,s)||g&&aI(I,s)&&aI(M,s)){A=O;continue}const J=S.vertexLength;Gv(this.vertexArray,I,M,1,1,V),Gv(this.vertexArray,I,M,1,0,V),Gv(this.vertexArray,I,M,0,1,G),Gv(this.vertexArray,I,M,0,0,G),S.vertexLength+=4;const ee=iF(I,M,P,h);for(const H of ee)this._segmentToGroundQuads[_].push({id:J,region:H}),this._segmentToRegionTriCounts[_][H]+=2,S.primitiveLength+=2;A=O}}}prepareBorderSegments(){if(!this.hasData())return;const n=this._segments.get(),s=n.length;for(let h=0;h<s;h++)this._segmentToGroundQuads[h].sort((g,f)=>g.region-f.region);for(let h=0;h<s;h++){const g=this._segmentToGroundQuads[h],f=n[h],_=this._segmentToRegionTriCounts[h];_.reduce((A,k)=>A+k,0);let S=0;for(let A=0;A<=4;A++){const k=_[A];if(k!==0){let x=this.regionSegments[A];x||(x=this.regionSegments[A]=new Wr);const I={vertexOffset:f.vertexOffset,primitiveOffset:f.primitiveOffset+S,vertexLength:f.vertexLength,primitiveLength:k};x.get().push(I)}S+=k}for(let A=0;A<g.length;A++){const k=g[A].id;this.indexArray.emplaceBack(k,k+1,k+3),this.indexArray.emplaceBack(k,k+3,k+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(n,s,h,g,f,_){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,n,s,h,g,f,_)}upload(n){this.hasData()&&(this.vertexBuffer=n.createVertexBuffer(this.vertexArray,H4.members),this.indexBuffer=n.createIndexBuffer(this.indexArray))}uploadPaintProperties(n){this.hasData()&&this.programConfigurations.upload(n)}update(n,s,h,g,f,_){this.hasData()&&this.programConfigurations.updatePaintArrays(n,s,h,g,f,_)}updateHiddenByLandmark(n){if(!this.hasData())return;const s=n.groundVertexCount+n.groundVertexArrayOffset;if(n.groundVertexCount===0)return;const h=n.flags&Du?1:0;for(let g=n.groundVertexArrayOffset;g<s;++g)this.hiddenByLandmarkVertexArray.emplace(g,h);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(n){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=n.createVertexBuffer(this.hiddenByLandmarkVertexArray,Z4.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let n=0;n<=4;n++){const s=this.regionSegments[n];s&&s.destroy()}}}}class Hv{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=n.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=n.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new ss,this.footprintVertices=new Jl,this.footprintSegments=[],this.layoutVertexArray=new Ql,this.centroidVertexArray=new Iv,this.wallVertexArray=new Bm,this.indexArray=new ss,this.programConfigurations=new nc(n.layers,{zoom:n.zoom,lut:n.lut},s=>J4.includes(s)),this.segments=new Wr,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.groundEffect=new rI(n),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(n,s){}populate(n,s,h,g){this.features=[],this.hasPattern=nx("fill-extrusion",this.layers,s),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Ye(h),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:f,id:_,index:S,sourceLayerIndex:A}of n){const k=this.layers[0]._featureFilter.needGeometry,x=ln(f,k);if(!this.layers[0]._featureFilter.filter(new qr(this.zoom),x,h))continue;const I={id:_,sourceLayerIndex:A,index:S,geometry:k?x.geometry:sn(f,h,g),properties:f.properties,type:f.type,patterns:{}},M=this.layoutVertexArray.length,C=dx[I.type]==="Polygon";if(this.hasPattern)this.features.push(ix("fill-extrusion",this.layers,I,this.zoom,s));else if(this.wallMode)for(const P of I.geometry)for(const O of JE(P,C))this.addFeature(I,[O],S,h,{},s.availableImages,g,s.brightness);else this.addFeature(I,I.geometry,S,h,{},s.availableImages,g,s.brightness);s.featureIndex.insert(f,I.geometry,S,A,this.index,M)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(n,s,h,g,f,_){for(const S of this.features){const A=dx[S.type]==="Polygon",{geometry:k}=S;if(this.wallMode)for(const x of k)for(const I of JE(x,A))this.addFeature(S,[I],S.index,s,h,g,f,_);else this.addFeature(S,k,S.index,s,h,g,f,_)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(n,s,h,g,f){const _=Object.keys(n).length!==0;if(_&&!this.stateDependentLayers.length)return;const S=_?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(n,s,S,h,g,f),this.groundEffect.update(n,s,S,h,g,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Y4),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.wallVertexBuffer=n.createVertexBuffer(this.wallVertexArray,W4.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=n.createVertexBuffer(this.layoutVertexExtArray,X4.members,!0)),this.groundEffect.upload(n)),this.groundEffect.uploadPaintProperties(n),this.programConfigurations.upload(n),this.uploaded=!0}uploadCentroid(n){this.groundEffect.uploadHiddenByLandmark(n),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,q4.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,s,h,g,f,_,S,A){const k=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(n,{})/this.tileToMeter,x=[new Ue(0,0),new Ue(_n,_n)],I=S.projection,M=I.name==="globe",C=this.wallMode||dx[n.type]==="Polygon",P=new nI;P.centroidDataIndex=this.centroidData.length;const O=new tI,V=this.layers[0].paint.get("fill-extrusion-base").evaluate(n,{},g)<=0,G=this.layers[0].paint.get("fill-extrusion-height").evaluate(n,{},g);let J;if(O.height=G,O.vertexArrayOffset=this.layoutVertexArray.length,O.groundVertexArrayOffset=this.groundEffect.vertexArray.length,M&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Af),this.wallMode){if(M)return void ii("Non zero fill-extrusion-line-width is not yet supported on globe.");if(s.length!==1)return;J=function(Ce){const je=Ce[0].x===Ce[Ce.length-1].x&&Ce[0].y===Ce[Ce.length-1].y;(function(an){let Wt=0;const Vn=an.length;for(let Tn=0;Tn<Vn;Tn++)Wt+=(an[(Tn+1)%Vn].x-an[Tn].x)*(an[(Tn+1)%Vn].y+an[Tn].y);return Wt>=0})(Ce)||(Ce=Ce.reverse());const He={geometry:[],joinNormals:[],indices:[]},Qe=[],it=[],ot=[];let ct=Ce.length;if(ct<(je?3:2))return He;for(;ct>=2&&Ce[ct-1].equals(Ce[ct-2]);)ct--;let bt,ut,Ot,$t,It,En=0;for(;En<ct-1&&Ce[En].equals(Ce[En+1]);)En++;je&&(bt=Ce[ct-2],It=Ce[En].sub(bt)._unit()._perp());for(let an=En;an<ct;an++){if(Ot=an===ct-1?je?Ce[En+1]:void 0:Ce[an+1],Ot&&Ce[an].equals(Ot))continue;It&&($t=It),bt&&(ut=bt),bt=Ce[an],It=Ot?Ot.sub(bt)._unit()._perp():$t,$t=$t||It;let Wt=$t.add(It);Wt.x===0&&Wt.y===0||Wt._unit();const Vn=Wt.x*It.x+Wt.y*It.y,Tn=Vn!==0?1/Vn:1/0,An=$t.x*It.y-$t.y*It.x>0;let Kn="miter";const ci=2;Kn==="miter"&&Tn>ci&&(Kn="bevel"),Kn==="bevel"&&(Tn>100&&(Kn="flipbevel"),Tn<ci&&(Kn="miter"));const oi=(si,pi,_i,ir)=>{const ji=new Ue(si.x,si.y),Jn=new Ue(si.x,si.y);ji.x+=pi.x*ir,ji.y+=pi.y*ir,Jn.x-=pi.x*Math.max(_i,1),Jn.y-=pi.y*Math.max(_i,1),ot.push(pi),Qe.push(ji),it.push(Jn)};if(Kn==="miter")Wt._mult(Tn),oi(bt,Wt,0,0);else if(Kn==="flipbevel")Wt=It.mult(-1),oi(bt,Wt,0,0),oi(bt,Wt.mult(-1),0,0);else{const si=-Math.sqrt(Tn*Tn-1),pi=An?si:0,_i=An?0:si;ut&&oi(bt,$t,pi,_i),Ot&&oi(bt,It,pi,_i)}}He.geometry=[...Qe,...it.reverse(),Qe[0]],He.joinNormals=[...ot,...ot.reverse(),ot[ot.length-1]];const mn=He.geometry.length-1;for(let an=0;an<mn/2;an++)if(an+1<mn/2){let Wt=an,Vn=an+1,Tn=mn-1-an,An=mn-2-an;Wt=Wt===0?mn-1:Wt-1,Vn=Vn===0?mn-1:Vn-1,Tn=Tn===0?mn-1:Tn-1,An=An===0?mn-1:An-1,He.indices.push(Tn),He.indices.push(Vn),He.indices.push(Wt),He.indices.push(Tn),He.indices.push(An),He.indices.push(Vn)}return He}(s[0]),s=[J.geometry]}const ee=(Ce,je)=>Ce<(je.length-1)/2||Ce===je.length-1,H=this.wallMode?[s]:Vv(s,500);for(let Ce=H.length-1;Ce>=0;Ce--){const je=H[Ce];(je.length===0||(se=je[0]).every(Oe=>Oe.x<=0)||se.every(Oe=>Oe.x>=_n)||se.every(Oe=>Oe.y<=0)||se.every(Oe=>Oe.y>=_n))&&H.splice(Ce,1)}var se;let ue;if(M)ue=hI(H,x,g);else{ue=[];for(const Ce of H)ue.push({polygon:Ce,bounds:x})}const we=C?this.edgeRadius:0,Me=we>0&&this.zoom<17,Re=(Ce,je)=>{if(Ce.length===0)return!1;const Oe=Ce[Ce.length-1];return je.x===Oe.x&&je.y===Oe.y};for(const{polygon:Ce,bounds:je}of ue){let Oe=0,He=0;for(const ct of Ce)C&&!ct[0].equals(ct[ct.length-1])&&ct.push(ct[0]),He+=C?ct.length-1:ct.length;const Qe=this.segments.prepareSegment((C?5:4)*He,this.layoutVertexArray,this.indexArray);O.footprintSegIdx<0&&(O.footprintSegIdx=this.footprintSegments.length),O.polygonSegIdx<0&&(O.polygonSegIdx=this.polygonSegments.length);const it={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},ot=new eI;if(ot.vertexOffset=this.footprintVertices.length,ot.indexOffset=3*this.footprintIndices.length,ot.ringIndices=[],C){const ct=[],bt=[];Oe=Qe.vertexLength;for(let Ot=0;Ot<Ce.length;Ot++){const $t=Ce[Ot];$t.length&&Ot!==0&&bt.push(ct.length/2);const It=[];let En,mn;En=$t[1].sub($t[0])._perp()._unit(),ot.ringIndices.push($t.length-1);for(let an=1;an<$t.length;an++){const Wt=$t[an],Vn=$t[an===$t.length-1?1:an+1],Tn=Wt.clone();if(we){mn=Vn.sub(Wt)._perp()._unit();const An=En.add(mn)._unit(),Kn=we*Math.min(4,1/(En.x*An.x+En.y*An.y));Tn.x+=Kn*An.x,Tn.y+=Kn*An.y,Tn.x=Math.round(Tn.x),Tn.y=Math.round(Tn.y),En=mn}if(!V||we!==0&&!Me||Re(It,Tn)||It.push(Tn),Zm(this.layoutVertexArray,Tn.x,Tn.y,0,0,1,1,0),this.wallMode){const An=ee(an,$t);Xm(this.wallVertexArray,J.joinNormals[an],!An)}Qe.vertexLength++,this.footprintVertices.emplaceBack(Wt.x,Wt.y),ct.push(Wt.x,Wt.y),M&&Ym(this.layoutVertexExtArray,I.projectTilePoint(Tn.x,Tn.y,g),I.upVector(g,Tn.x,Tn.y))}V&&(we===0||Me)&&(It.length!==0&&Re(It,It[0])&&It.pop(),this.groundEffect.addData(It,je,k))}const ut=this.wallMode?J.indices:Gm(ct,bt);for(let Ot=0;Ot<ut.length;Ot+=3)this.footprintIndices.emplaceBack(ot.vertexOffset+ut[Ot+0],ot.vertexOffset+ut[Ot+1],ot.vertexOffset+ut[Ot+2]),this.indexArray.emplaceBack(Oe+ut[Ot],Oe+ut[Ot+2],Oe+ut[Ot+1]),Qe.primitiveLength++;ot.indexCount+=ut.length,ot.vertexCount+=this.footprintVertices.length-ot.vertexOffset}for(let ct=0;ct<Ce.length;ct++){const bt=Ce[ct];P.startRing(O,bt[0]);let ut=bt.length>4&&lI(bt[bt.length-2],bt[0],bt[1]),Ot=we?rF(bt[bt.length-2],bt[0],bt[1],we):0;const $t=[];let It,En,mn;En=bt[1].sub(bt[0])._perp()._unit();let an=!0;for(let Wt=1,Vn=0;Wt<bt.length;Wt++){let Tn=bt[Wt-1],An=bt[Wt];const Kn=bt[Wt===bt.length-1?1:Wt+1];if(P.appendEdge(O,An,Tn),fx(An,Tn,je)){we&&(En=Kn.sub(An)._perp()._unit(),an=!an);continue}const ci=An.sub(Tn)._perp(),oi=ci.x/(Math.abs(ci.x)+Math.abs(ci.y)),si=ci.y>0?1:0,pi=Tn.dist(An);if(Vn+pi>32768&&(Vn=0),we){mn=Kn.sub(An)._perp()._unit();let Jn=sI(Tn,An,Kn,oI(En,mn),we);isNaN(Jn)&&(Jn=0);const Bi=An.sub(Tn)._unit();Tn=Tn.add(Bi.mult(Ot))._round(),An=An.add(Bi.mult(-Jn))._round(),Ot=Jn,En=mn,V&&this.zoom>=17&&(Re($t,Tn)||$t.push(Tn),Re($t,An)||$t.push(An))}const _i=Qe.vertexLength,ir=bt.length>4&&lI(Tn,An,Kn);let ji=cI(Vn,ut,an);if(Zm(this.layoutVertexArray,Tn.x,Tn.y,oi,si,0,0,ji),Zm(this.layoutVertexArray,Tn.x,Tn.y,oi,si,0,1,ji),this.wallMode){const Jn=ee(Wt-1,bt),Bi=J.joinNormals[Wt-1];Xm(this.wallVertexArray,Bi,Jn),Xm(this.wallVertexArray,Bi,Jn)}if(Vn+=pi,ji=cI(Vn,ir,!an),ut=ir,Zm(this.layoutVertexArray,An.x,An.y,oi,si,0,0,ji),Zm(this.layoutVertexArray,An.x,An.y,oi,si,0,1,ji),this.wallMode){const Jn=ee(Wt,bt),Bi=J.joinNormals[Wt];Xm(this.wallVertexArray,Bi,Jn),Xm(this.wallVertexArray,Bi,Jn)}if(Qe.vertexLength+=4,this.indexArray.emplaceBack(_i+0,_i+1,_i+2),this.indexArray.emplaceBack(_i+1,_i+3,_i+2),Qe.primitiveLength+=2,we){const Jn=Oe+(Wt===1?bt.length-2:Wt-2),Bi=Wt===1?Oe:Jn+1;if(this.indexArray.emplaceBack(_i+1,Jn,_i+3),this.indexArray.emplaceBack(Jn,Bi,_i+3),Qe.primitiveLength+=2,It===void 0&&(It=_i),!fx(Kn,bt[Wt],je)){const Fi=Wt===bt.length-1?It:Qe.vertexLength;this.indexArray.emplaceBack(_i+2,_i+3,Fi),this.indexArray.emplaceBack(_i+3,Fi+1,Fi),this.indexArray.emplaceBack(_i+3,Bi,Fi+1),Qe.primitiveLength+=3}an=!an}if(M){const Jn=this.layoutVertexExtArray,Bi=I.projectTilePoint(Tn.x,Tn.y,g),Fi=I.projectTilePoint(An.x,An.y,g),_r=I.upVector(g,Tn.x,Tn.y),Jr=I.upVector(g,An.x,An.y);Ym(Jn,Bi,_r),Ym(Jn,Bi,_r),Ym(Jn,Fi,Jr),Ym(Jn,Fi,Jr)}}C&&(Oe+=bt.length-1),V&&we&&this.zoom>=17&&($t.length!==0&&Re($t,$t[0])&&$t.pop(),this.groundEffect.addData($t,je,k,we>0))}this.footprintSegments.push(ot),it.triangleCount=this.indexArray.length-it.triangleArrayOffset,this.polygonSegments.push(it),++O.footprintSegLen,++O.polygonSegLen}if(O.vertexCount=this.layoutVertexArray.length-O.vertexArrayOffset,O.groundVertexCount=this.groundEffect.vertexArray.length-O.groundVertexArrayOffset,O.vertexCount!==0){if(O.centroidXY=P.borders?QE:this.encodeCentroid(P,O),this.centroidData.push(O),P.borders){this.featuresOnBorder.push(P);const Ce=this.featuresOnBorder.length-1;for(let je=0;je<P.borders.length;je++)P.borders[je][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[je].push(Ce)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,h,f,_,g,A),this.groundEffect.addPaintPropertiesData(n,h,f,_,g,A),this.maxHeight=Math.max(this.maxHeight,G)}}sortBorders(){for(let n=0;n<this.borderFeatureIndices.length;n++)this.borderFeatureIndices[n].sort((s,h)=>this.featuresOnBorder[s].borders[n][0]-this.featuresOnBorder[h].borders[n][0])}splitToSubtiles(){const n=[];for(let S=0;S<this.centroidData.length;S++){const A=this.centroidData[S],k=+(A.min.y+A.max.y>_n),x=2*k+(+(A.min.x+A.max.x>_n)^k);for(let I=0;I<A.polygonSegLen;I++){const M=A.polygonSegIdx+I;n.push({centroidIdx:S,subtile:x,polygonSegmentIdx:M,triangleSegmentIdx:this.polygonSegments[M].triangleSegIdx})}}const s=new ss;n.sort((S,A)=>S.triangleSegmentIdx===A.triangleSegmentIdx?S.subtile-A.subtile:S.triangleSegmentIdx-A.triangleSegmentIdx);let h=0,g=0,f=0;for(const S of n){if(S.triangleSegmentIdx!==h)break;f++}const _=n.length;for(;g!==n.length;){h=n[g].triangleSegmentIdx;let S=0,A=g,k=g;for(let x=A;x<f&&n[x].subtile===S;x++)k++;for(;A!==f;){const x=n[A];S=x.subtile;const I=this.centroidData[x.centroidIdx].min.clone(),M=this.centroidData[x.centroidIdx].max.clone(),C={vertexOffset:this.segments.segments[h].vertexOffset,primitiveOffset:s.length,vertexLength:this.segments.segments[h].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let P=A;P<k;P++){const O=n[P],V=this.polygonSegments[O.polygonSegmentIdx],G=this.centroidData[O.centroidIdx].min,J=this.centroidData[O.centroidIdx].max,ee=this.indexArray.uint16;for(let H=V.triangleArrayOffset;H<V.triangleArrayOffset+V.triangleCount;H++)s.emplaceBack(ee[3*H],ee[3*H+1],ee[3*H+2]);C.primitiveLength+=V.triangleCount,I.x=Math.min(I.x,G.x),I.y=Math.min(I.y,G.y),M.x=Math.max(M.x,J.x),M.y=Math.max(M.y,J.y)}C.primitiveLength>0&&this.triangleSubSegments.push({segment:C,min:I,max:M}),A=k;for(let P=A;P<f&&n[P].subtile===n[A].subtile;P++)k++}g=f;for(let x=g;x<_&&n[x].triangleSegmentIdx===n[g].triangleSegmentIdx;x++)f++}s._trim(),this.indexArray=s}getVisibleSegments(n,s,h){const g=new Wr;if(this.wallMode){for(const O of this.triangleSubSegments)g.segments.push(O.segment);return g}let f=0,_=0;const S=1<<n.canonical.z;if(s){const O=s.getMinMaxForTile(n);O&&(f=O.min,_=O.max)}_+=this.maxHeight;const A=n.toUnwrapped();let k;const x=[A.canonical.x/S+A.wrap,A.canonical.y/S],I=[(A.canonical.x+1)/S+A.wrap,(A.canonical.y+1)/S],M=(O,V,G)=>[O[0]*(1-G[0])+V[0]*G[0],O[1]*(1-G[1])+V[1]*G[1]],C=[],P=[];for(const O of this.triangleSubSegments){C[0]=O.min.x/_n,C[1]=O.min.y/_n,P[0]=O.max.x/_n,P[1]=O.max.y/_n;const V=M(x,I,C),G=M(x,I,P);if(new ur([V[0],V[1],f],[G[0],G[1],_]).intersectsPrecise(h)===0){k&&(g.segments.push(k),k=void 0);continue}const J=O.segment;k&&k.vertexOffset!==J.vertexOffset&&(g.segments.push(k),k=void 0),k?(k.vertexLength+=J.vertexLength,k.primitiveLength+=J.primitiveLength):k={vertexOffset:J.vertexOffset,primitiveLength:J.primitiveLength,vertexLength:J.vertexLength,primitiveOffset:J.primitiveOffset,sortKey:void 0,vaos:{}}}return k&&g.segments.push(k),g}encodeCentroid(n,s){const h=n.centroid(),g=s.span(),f=Math.min(7,Math.round(g.x*this.tileToMeter/10)),_=Math.min(7,Math.round(g.y*this.tileToMeter/10));return new Ue(hn(h.x,1,_n-1)<<3|f,hn(h.y,1,_n-1)<<3|_)}encodeBorderCentroid(n){if(!n.borders)return new Ue(0,0);const s=n.borders,h=Number.MAX_VALUE;if(s[0][0]!==h||s[1][0]!==h){const g=s[0][0]!==h?0:1;return new Ue(6|(s[0][0]!==h?0:65528),(s[g][0]+s[g][1])/2<<3|6)}{const g=s[2][0]!==h?2:3;return new Ue((s[g][0]+s[g][1])/2<<3|6,6|(s[2][0]!==h?0:65528))}}showCentroid(n){const s=this.centroidData[n.centroidDataIndex];s.flags&=Du,s.centroidXY.x=0,s.centroidXY.y=0,this.writeCentroidToBuffer(s)}writeCentroidToBuffer(n){this.groundEffect.updateHiddenByLandmark(n);const s=n.vertexArrayOffset,h=n.vertexCount+n.vertexArrayOffset,g=n.flags&Du?QE:n.centroidXY,f=this.centroidVertexArray.geta_centroid_pos0(s);if(this.centroidVertexArray.geta_centroid_pos1(s)!==g.y||f!==g.x){for(let _=s;_<h;++_)this.centroidVertexArray.emplace(_,g.x,g.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const n of this.centroidData)this.writeCentroidToBuffer(n)}updateReplacement(n,s,h){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const g=s.getReplacementRegionsForTile(n.toUnwrapped());if(ux(this.activeReplacements,g))return;if(this.activeReplacements=g,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const _ of this.centroidData)_.flags&=2147483647;const f=[];for(const _ of this.activeReplacements){if(_.order<h)continue;const S=Math.pow(2,_.footprintTileId.canonical.z-n.canonical.z);for(const A of this.centroidData)if(!(A.flags&Du||_.min.x>A.max.x||A.min.x>_.max.x||_.min.y>A.max.y||A.min.y>_.max.y))for(let k=0;k<A.footprintSegLen;k++){const x=this.footprintSegments[A.footprintSegIdx+k];if(f.length=0,oF(this.footprintVertices,x.vertexOffset,x.vertexCount,_.footprintTileId.canonical,n.canonical,f),ZE(_.footprint,f,this.footprintIndices.uint16,x.indexOffset,x.indexCount,-x.vertexOffset,-S)){A.flags|=Du;break}}}for(const _ of this.centroidData)this.writeCentroidToBuffer(_);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(n,s,h){let g=!1;for(let f=0;f<h.footprintSegLen;f++){const _=this.footprintSegments[h.footprintSegIdx+f];let S=0;for(const A of _.ringIndices){for(let k=S,x=A+S-1;k<A+S;x=k++){const I=this.footprintVertices.int16[2*(k+_.vertexOffset)+0],M=this.footprintVertices.int16[2*(k+_.vertexOffset)+1],C=this.footprintVertices.int16[2*(x+_.vertexOffset)+1];M>s!=C>s&&n<(this.footprintVertices.int16[2*(x+_.vertexOffset)+0]-I)*(s-M)/(C-M)+I&&(g=!g)}S=A}}return g}getHeightAtTileCoord(n,s){let h=Number.NEGATIVE_INFINITY,g=!0;const f=4*(n+_n)*_n+(s+_n);if(this.partLookup.hasOwnProperty(f)){const _=this.partLookup[f];return _?{height:_.height,hidden:!!(_.flags&Du)}:void 0}for(const _ of this.centroidData)n>_.max.x||_.min.x>n||s>_.max.y||_.min.y>s||this.footprintContainsPoint(n,s,_)&&_&&_.height>h&&(h=_.height,this.partLookup[f]=_,g=!!(_.flags&Du));if(h!==Number.NEGATIVE_INFINITY)return{height:h,hidden:g};this.partLookup[f]=void 0}}function oI(u,n){const s=u.add(n)._unit();return u.x*s.x+u.y*s.y}function rF(u,n,s,h){const g=n.sub(u)._perp()._unit(),f=s.sub(n)._perp()._unit();return sI(u,n,s,oI(g,f),h)}function sI(u,n,s,h,g){const f=Math.sqrt(1-h*h);return Math.min(u.dist(n)/3,n.dist(s)/3,g*f/h)}function fx(u,n,s){return u.x<s[0].x&&n.x<s[0].x||u.x>s[1].x&&n.x>s[1].x||u.y<s[0].y&&n.y<s[0].y||u.y>s[1].y&&n.y>s[1].y}function aI(u,n){return u.x<n[0].x||u.x>n[1].x||u.y<n[0].y||u.y>n[1].y}function lI(u,n,s){if(u.x<0||u.x>=_n||n.x<0||n.x>=_n||s.x<0||s.x>=_n)return!1;const h=s.sub(n),g=h.perp(),f=u.sub(n);return(h.x*f.x+h.y*f.y)/Math.sqrt((h.x*h.x+h.y*h.y)*(f.x*f.x+f.y*f.y))>-.866&&g.x*f.x+g.y*f.y<0}function cI(u,n,s){const h=n?2|u:-3&u;return s?1|h:-2&h}function uI(){const u=Math.PI/32,n=Math.tan(u),s=X;return s*Math.sqrt(1+2*n*n)-s}function hI(u,n,s){const h=1<<s.z,g=Fe(s.x/h),f=Fe((s.x+1)/h),_=ze(s.y/h),S=ze((s.y+1)/h);return function(A,k,x,I,M=0,C){const P=[];if(!A.length||!x||!I)return P;const O=(ue,we)=>{for(const Me of ue)P.push({polygon:Me,bounds:we})},V=Math.ceil(Math.log2(x)),G=Math.ceil(Math.log2(I)),J=V-G,ee=[];for(let ue=0;ue<Math.abs(J);ue++)ee.push(J>0?0:1);for(let ue=0;ue<Math.min(V,G);ue++)ee.push(0),ee.push(1);let H=A;if(H=Uv(H,k[0].y-M,k[1].y+M,1),H=Uv(H,k[0].x-M,k[1].x+M,0),!H.length)return P;const se=[];for(ee.length?se.push({polygons:H,bounds:k,depth:0}):O(H,k);se.length;){const ue=se.pop(),we=ue.depth,Me=ee[we],Re=ue.bounds[0],Ce=ue.bounds[1],je=Me===0?Re.x:Re.y,Oe=Me===0?Ce.x:Ce.y,He=C?C(Me,je,Oe):.5*(je+Oe),Qe=Uv(ue.polygons,je-M,He+M,Me),it=Uv(ue.polygons,He-M,Oe+M,Me);if(Qe.length){const ot=[Re,new Ue(Me===0?He:Ce.x,Me===1?He:Ce.y)];ee.length>we+1?se.push({polygons:Qe,bounds:ot,depth:we+1}):O(Qe,ot)}if(it.length){const ot=[new Ue(Me===0?He:Re.x,Me===1?He:Re.y),Ce];ee.length>we+1?se.push({polygons:it,bounds:ot,depth:we+1}):O(it,ot)}}return P}(u,n,Math.ceil((f-g)/11.25),Math.ceil((_-S)/11.25),1,(A,k,x)=>{if(A===0)return .5*(k+x);{const I=ze((s.y+k/_n)/h);return(De(.5*(ze((s.y+x/_n)/h)+I))*h-s.y)*_n}})}function oF(u,n,s,h,g,f){const _=Math.pow(2,h.z-g.z);for(let S=0;S<s;S++){let A=u.int16[2*(S+n)+0],k=u.int16[2*(S+n)+1];A=(A+g.x*_n)*_-h.x*_n,k=(k+g.y*_n)*_-h.y*_n,f.push(new Ue(A,k))}}let dI,fI;function Km(u,n){return u.x*n.x+u.y*n.y}function pI(u,n){if(u.length===1){let s=0;const h=n[s++];let g;for(;!g||h.equals(g);)if(g=n[s++],!g)return 1/0;for(;s<n.length;s++){const f=n[s],_=u[0],S=g.sub(h),A=f.sub(h),k=_.sub(h),x=Km(S,S),I=Km(S,A),M=Km(A,A),C=Km(k,S),P=Km(k,A),O=x*M-I*I,V=(M*C-I*P)/O,G=(x*P-I*C)/O,J=h.z*(1-V-G)+g.z*V+f.z*G;if(isFinite(J))return J}return 1/0}{let s=1/0;for(const h of n)s=Math.min(s,h.z);return s}}function mI(u,n,s,h,g,f,_,S){const A=_*g.getElevationAt(u,n,!0,!0),k=f[0]!==0,x=k?f[1]===0?_*(f[0]/7-450):_*function(I,M,C){const P=Math.floor(M[0]/8),O=Math.floor(M[1]/8),V=10*(M[0]-8*P),G=10*(M[1]-8*O),J=I.getElevationAt(P,O,!0,!0),ee=I.getMeterToDEM(C),H=Math.floor(.5*(V*ee-1)),se=Math.floor(.5*(G*ee-1)),ue=I.tileCoordToPixel(P,O),we=2*H+1,Me=2*se+1,Re=function(it,ot,ct,bt,ut){return[it.getElevationAtPixel(ot,ct,!0),it.getElevationAtPixel(ot+ut,ct,!0),it.getElevationAtPixel(ot,ct+ut,!0),it.getElevationAtPixel(ot+bt,ct+ut,!0)]}(I,ue.x-H,ue.y-se,we,Me),Ce=Math.abs(Re[0]-Re[1]),je=Math.abs(Re[2]-Re[3]),Oe=Math.abs(Re[0]-Re[2])+Math.abs(Re[1]-Re[3]),He=Math.min(.25,.5*ee*(Ce+je)/we),Qe=Math.min(.25,.5*ee*Oe/Me);return J+Math.max(He*V,Qe*G)}(g,f,S):A;return{base:A+(s===0)?-1:s,top:k?Math.max(x+h,A+s+2):A+h}}Pn(Hv,"FillExtrusionBucket",{omit:["layers","features"]}),Pn(tI,"PartData"),Pn(eI,"FootprintSegment"),Pn(nI,"BorderCentroidData"),Pn(rI,"GroundEffect");const sF=Di([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),aF=Di([{name:"a_z_offset",components:1,type:"Float32"}],4),{members:lF}=sF,cF=Di([{name:"a_packed",components:4,type:"Float32"}]),{members:uF}=cF,hF=Di([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:dF}=hF;class gI{constructor(n,s){this.width=n,this.height=s,this.nextRow=0,this.image=new Ru({width:n,height:s}),this.positions={},this.uploaded=!1}getDash(n,s){const h=this.getKey(n,s);return this.positions[h]}trim(){const n=this.width,s=this.height=Rr(this.nextRow);this.image.resize({width:n,height:s})}getKey(n,s){return n.join(",")+s}getDashRanges(n,s,h){const g=[];let f=n.length%2==1?-n[n.length-1]*h:0,_=n[0]*h,S=!0;g.push({left:f,right:_,isDash:S,zeroLength:n[0]===0});let A=n[0];for(let k=1;k<n.length;k++){S=!S;const x=n[k];f=A*h,A+=x,_=A*h,g.push({left:f,right:_,isDash:S,zeroLength:x===0})}return g}addRoundDash(n,s,h){const g=s/2;for(let f=-h;f<=h;f++){const _=this.width*(this.nextRow+h+f);let S=0,A=n[S];for(let k=0;k<this.width;k++){k/A.right>1&&(A=n[++S]);const x=Math.abs(k-A.left),I=Math.abs(k-A.right),M=Math.min(x,I);let C;const P=f/h*(g+1);if(A.isDash){const O=g-Math.abs(P);C=Math.sqrt(M*M+O*O)}else C=g-Math.sqrt(M*M+P*P);this.image.data[_+k]=Math.max(0,Math.min(255,C+128))}}}addRegularDash(n,s){for(let A=n.length-1;A>=0;--A){const k=n[A],x=n[A+1];k.zeroLength?n.splice(A,1):x&&x.isDash===k.isDash&&(x.left=k.left,n.splice(A,1))}const h=n[0],g=n[n.length-1];h.isDash===g.isDash&&(h.left=g.left-this.width,g.right=h.right+this.width);const f=this.width*this.nextRow;let _=0,S=n[_];for(let A=0;A<this.width;A++){A/S.right>1&&(S=n[++_]);const k=Math.abs(A-S.left),x=Math.abs(A-S.right),I=Math.min(k,x);this.image.data[f+A]=Math.max(0,Math.min(255,(S.isDash?I:-I)+s+128))}}addDash(n,s){const h=this.getKey(n,s);if(this.positions[h])return this.positions[h];const g=s==="round",f=g?7:0,_=2*f+1;if(this.nextRow+_>this.height)return ii("LineAtlas out of space"),null;n.length===0&&n.push(1);let S=0;for(let x=0;x<n.length;x++)n[x]<0&&(ii("Negative value is found in line dasharray, replacing values with 0"),n[x]=0),S+=n[x];if(S!==0){const x=this.width/S,I=this.getDashRanges(n,this.width,x);g?this.addRoundDash(I,x,f):this.addRegularDash(I,s==="square"?.5*x:0)}const A=this.nextRow+f;this.nextRow+=_;const k={tl:[A,f],br:[S,0]};return this.positions[h]=k,k}}Pn(gI,"LineAtlas");const fF=Ff.VectorTileFeature.types,pF=Math.cos(Math.PI/180*37.5),mF=Math.cos(Math.PI/180*5);class px{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.fqid),this.index=n.index,this.projection=n.projection,this.hasPattern=!1,this.hasZOffset=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new Cm,this.layoutVertexArray2=new El,this.patternVertexArray=new ec,this.indexArray=new ss,this.programConfigurations=new nc(n.layers,{zoom:n.zoom,lut:n.lut}),this.segments=new Wr,this.maxLineLength=0,this.zOffsetVertexArray=new Eu,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.tessellationStep=n.tessellationStep?n.tessellationStep:_n/64}updateFootprints(n,s){}populate(n,s,h,g){this.hasPattern=nx("line",this.layers,s);const f=this.layers[0].layout.get("line-sort-key"),_=this.layers[0].layout.get("line-z-offset");this.hasZOffset=!_.isConstant()||!!_.constantOr(0);const S=[];for(const{feature:I,id:M,index:C,sourceLayerIndex:P}of n){const O=this.layers[0]._featureFilter.needGeometry,V=ln(I,O);if(!this.layers[0]._featureFilter.filter(new qr(this.zoom),V,h))continue;const G=f?f.evaluate(V,{},h):void 0,J={id:M,properties:I.properties,type:I.type,sourceLayerIndex:P,index:C,geometry:O?V.geometry:sn(I,h,g),patterns:{},sortKey:G};S.push(J)}f&&S.sort((I,M)=>I.sortKey-M.sortKey);const{lineAtlas:A,featureIndex:k}=s,x=this.addConstantDashes(A);for(const I of S){const{geometry:M,index:C,sourceLayerIndex:P}=I;if(x&&this.addFeatureDashes(I,A),this.hasPattern){const O=ix("line",this.layers,I,this.zoom,s);this.patternFeatures.push(O)}else this.addFeature(I,M,C,h,A.positions,s.availableImages,s.brightness);k.insert(n[C].feature,M,C,P,this.index)}}addConstantDashes(n){let s=!1;for(const h of this.layers){const g=h.paint.get("line-dasharray").value,f=h.layout.get("line-cap").value;if(g.kind!=="constant"||f.kind!=="constant")s=!0;else{const _=f.value,S=g.value;if(!S)continue;n.addDash(S,_)}}return s}addFeatureDashes(n,s){const h=this.zoom;for(const g of this.layers){const f=g.paint.get("line-dasharray").value,_=g.layout.get("line-cap").value;if(f.kind==="constant"&&_.kind==="constant")continue;let S,A;if(f.kind==="constant"){if(S=f.value,!S)continue}else S=f.evaluate({zoom:h},n);A=_.kind==="constant"?_.value:_.evaluate({zoom:h},n),s.addDash(S,A),n.patterns[g.id]=s.getKey(S,A)}}update(n,s,h,g,f){const _=Object.keys(n).length!==0;_&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(n,s,_?this.stateDependentLayers:this.layers,h,g,f)}addFeatures(n,s,h,g,f,_){for(const S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,s,h,g,_)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,uF)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=n.createVertexBuffer(this.patternVertexArray,dF)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=n.createVertexBuffer(this.zOffsetVertexArray,aF.members,!0)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,lF),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&n.properties.hasOwnProperty("mapbox_clip_start")&&n.properties.hasOwnProperty("mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,s,h,g,f,_,S){const A=this.layers[0].layout,k=A.get("line-join").evaluate(n,{}),x=A.get("line-cap").evaluate(n,{}),I=A.get("line-miter-limit"),M=A.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(const C of s)this.addLine(C,n,g,k,x,I,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,h,f,_,g,S)}addLine(n,s,h,g,f,_,S){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.currentVertex=void 0;const A={zoom:this.zoom,lineProgress:void 0},k=this.layers[0].layout,x=g==="none";if(this.patternJoinNone=this.hasPattern&&x,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ue=0;ue<n.length-1;ue++)this.totalDistance+=n[ue].dist(n[ue+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const I=fF[s.type]==="Polygon";let M=n.length;for(;M>=2&&n[M-1].equals(n[M-2]);)M--;let C=0;for(;C<M-1&&n[C].equals(n[C+1]);)C++;if(M<(I?3:2))return;g==="bevel"&&(_=1.05);const P=this.overscaling<=16?15*_n/(512*this.overscaling):0,O=this.segments.prepareSegment(10*M,this.layoutVertexArray,this.indexArray);let V,G,J,ee,H,se;this.e1=this.e2=-1,I&&(V=n[M-2],H=n[C].sub(V)._unit()._perp());for(let ue=C;ue<M;ue++){if(J=ue===M-1?I?n[C+1]:void 0:n[ue+1],J&&n[ue].equals(J))continue;if(H&&(ee=H),V&&(G=V),V=n[ue],this.hasZOffset){const ot=k.get("line-z-offset").value;if(ot.kind==="constant")se=ot.value;else{if(this.lineClips){const ct=this.totalDistance/(this.lineClips.end-this.lineClips.start);A.lineProgress=(ct*this.lineClips.start+this.distance+(G?G.dist(V):0))/ct}else ii(`line-z-offset evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`),A.lineProgress=0;se=ot.evaluate(A,s)}se=se||0}H=J?J.sub(V)._unit()._perp():ee,ee=ee||H;const we=G&&J;let Me=we?g:I||x?"butt":f;const Re=ee.x*H.x+ee.y*H.y;if(x){const ot=function(ct){if(ct.patternJoinNone){const bt=ct.segmentPoints.length/2,ut=ct.lineSoFar-ct.segmentStart;for(let Ot=0;Ot<bt;++Ot){const $t=ct.segmentPoints[2*Ot+1],It=Math.round(ct.segmentPoints[2*Ot])+.5+.25*$t;ct.patternVertexArray.emplaceBack(It,ut,ct.segmentStart),ct.patternVertexArray.emplaceBack(It,ut,ct.segmentStart)}ct.segmentPoints.length=0}ct.e1=ct.e2=-1};if(we&&Re<mF){this.updateDistance(G,V),this.addCurrentVertex(V,ee,1,1,O,se),ot(this),this.addCurrentVertex(V,H,-1,-1,O,se);continue}if(G){if(!J){this.updateDistance(G,V),this.addCurrentVertex(V,ee,1,1,O,se),ot(this);continue}Me="miter"}}let Ce=ee.add(H);Ce.x===0&&Ce.y===0||Ce._unit();const je=Ce.x*H.x+Ce.y*H.y,Oe=je!==0?1/je:1/0,He=2*Math.sqrt(2-2*je),Qe=je<pF&&G&&J,it=ee.x*H.y-ee.y*H.x>0;if(Qe&&ue>C){const ot=V.dist(G);if(ot>2*P){const ct=V.sub(V.sub(G)._mult(P/ot)._round());this.updateDistance(G,ct),this.addCurrentVertex(ct,ee,0,0,O,se),G=ct}}if(we&&Me==="round"&&(Oe<S?Me="miter":Oe<=2&&(Me="fakeround")),Me==="miter"&&Oe>_&&(Me="bevel"),Me==="bevel"&&(Oe>2&&(Me="flipbevel"),Oe<_&&(Me="miter")),G&&this.updateDistance(G,V),Me==="miter")Ce._mult(Oe),this.addCurrentVertex(V,Ce,0,0,O,se);else if(Me==="flipbevel"){if(Oe>100)Ce=H.mult(-1);else{const ot=Oe*ee.add(H).mag()/ee.sub(H).mag();Ce._perp()._mult(ot*(it?-1:1))}this.addCurrentVertex(V,Ce,0,0,O,se),this.addCurrentVertex(V,Ce.mult(-1),0,0,O,se)}else if(Me==="bevel"||Me==="fakeround"){const ot=-Math.sqrt(Oe*Oe-1),ct=it?ot:0,bt=it?0:ot;if(G&&this.addCurrentVertex(V,ee,ct,bt,O,se),Me==="fakeround"){const ut=Math.round(180*He/Math.PI/20);for(let Ot=1;Ot<ut;Ot++){let $t=Ot/ut;if($t!==.5){const En=$t-.5;$t+=$t*En*($t-1)*((1.0904+Re*(Re*(3.55645-1.43519*Re)-3.2452))*En*En+(.848013+Re*(.215638*Re-1.06021)))}const It=H.sub(ee)._mult($t)._add(ee)._unit()._mult(it?-1:1);this.addHalfVertex(V,It.x,It.y,!1,it,0,O,se)}}J&&this.addCurrentVertex(V,H,-ct,-bt,O,se)}else Me==="butt"?this.addCurrentVertex(V,Ce,0,0,O,se):Me==="square"?(G||this.addCurrentVertex(V,Ce,-1,-1,O,se),this.addCurrentVertex(V,Ce,0,0,O,se),G&&this.addCurrentVertex(V,Ce,1,1,O,se)):Me==="round"&&(G&&(this.addCurrentVertex(V,ee,0,0,O,se),this.addCurrentVertex(V,ee,1,1,O,se,!0)),J&&(this.addCurrentVertex(V,H,-1,-1,O,se,!0),this.addCurrentVertex(V,H,0,0,O,se)));if(Qe&&ue<M-1){const ot=V.dist(J);if(ot>2*P){const ct=V.add(J.sub(V)._mult(P/ot)._round());this.updateDistance(V,ct),this.addCurrentVertex(ct,H,0,0,O,se),V=ct}}}}addVerticesTo(n,s,h,g,f,_,S,A,k,x){const I=(s.w-n.w)/this.tessellationStep|0;if(I>1){this.lineSoFar=n.w;const M=(s.x-n.x)/I,C=(s.y-n.y)/I,P=(s.z-n.z)/I,O=(s.w-n.w)/I;for(let V=1;V<I;++V)n.x+=M,n.y+=C,n.z+=P,this.lineSoFar+=O,this.addHalfVertex(n,h,g,x,!1,S,k,n.z),this.addHalfVertex(n,f,_,x,!0,-A,k,n.z)}this.lineSoFar=s.w,this.addHalfVertex(s,h,g,x,!1,S,k,s.z),this.addHalfVertex(s,f,_,x,!0,-A,k,s.z)}addCurrentVertex(n,s,h,g,f,_,S=!1){const A=s.x+s.y*h,k=s.y-s.x*h,x=s.y*g-s.x,I=-s.y-s.x*g;if(_!=null){const C=_n+10,P=_,O=new jE(n.x,n.y,P,this.lineSoFar),V=_I(n,-10,C),G=this.lineSoFar;if(this.currentVertex)if(V){const J=this.currentVertexIsOutside,ee=this.currentVertex,H=new jE(n.x,n.y,P,this.lineSoFar);GE(ee,H,-10,C),_I(H,-10,C)||(J&&(this.e1=this.e2=-1,this.lineSoFar=ee.w,this.addHalfVertex(ee,A,k,S,!1,h,f,ee.z),this.addHalfVertex(ee,x,I,S,!0,-g,f,ee.z)),this.addVerticesTo(ee,H,A,k,x,I,h,g,f,S))}else{const J=this.currentVertex;this.currentVertexIsOutside&&(GE(J,O,-10,C),this.e1=this.e2=-1,this.lineSoFar=J.w,this.addHalfVertex(J,A,k,S,!1,h,f,J.z),this.addHalfVertex(J,x,I,S,!0,-g,f,J.z)),this.addVerticesTo(J,O,A,k,x,I,h,g,f,S)}else V||(this.addHalfVertex(n,A,k,S,!1,h,f,_),this.addHalfVertex(n,x,I,S,!0,-g,f,_));this.currentVertex=O,this.currentVertexIsOutside=V,this.lineSoFar=G}else this.addHalfVertex(n,A,k,S,!1,h,f,_),this.addHalfVertex(n,x,I,S,!0,-g,f,_)}addHalfVertex({x:n,y:s},h,g,f,_,S,A,k){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),_||this.segmentPoints.push(this.lineSoFar-this.segmentStart,S)),this.layoutVertexArray.emplaceBack((n<<1)+(f?1:0),(s<<1)+(_?1:0),Math.round(63*h)+128,Math.round(63*g)+128,1+(S===0?0:S<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const x=A.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,x),A.primitiveLength++),_?this.e2=x:this.e1=x,k!=null&&this.zOffsetVertexArray.emplaceBack(k)}updateScaledDistance(){if(this.lineClips){const n=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=n*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(n,s){this.distance+=n.dist(s),this.updateScaledDistance()}}function _I(u,n,s){return u.x<n||u.x>s||u.y<n||u.y>s}let vI,yI;function bI(u,n,s){return n*(_n/(u.tileSize*Math.pow(2,s-u.tileID.overscaledZ)))}function xI(u,n){return 1/bI(u,1,n.tileZoom)}function wI(u,n,s,h){return u.translatePosMatrix(h||n.tileID.projMatrix,n,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}Pn(px,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const SI=u=>{const n=[];TI(u)&&n.push("RENDER_LINE_DASH"),u.paint.get("line-gradient")&&n.push("RENDER_LINE_GRADIENT");const s=u.paint.get("line-trim-offset");s[0]===0&&s[1]===0||n.push("RENDER_LINE_TRIM_OFFSET"),u.paint.get("line-border-width").constantOr(1)!==0&&n.push("RENDER_LINE_BORDER");const h=u.layout.get("line-join").constantOr("miter")==="none",g=!!u.paint.get("line-pattern").constantOr(1);return h&&g&&n.push("LINE_JOIN_NONE"),n};function TI(u){const n=u.paint.get("line-dasharray").value;return n.value||n.kind!=="constant"}let mx;const EI=()=>mx||(mx={layout:vI||(vI=new Or({"line-cap":new zn(_t.layout_line["line-cap"]),"line-join":new zn(_t.layout_line["line-join"]),"line-miter-limit":new un(_t.layout_line["line-miter-limit"]),"line-round-limit":new un(_t.layout_line["line-round-limit"]),"line-sort-key":new zn(_t.layout_line["line-sort-key"]),"line-z-offset":new zn(_t.layout_line["line-z-offset"]),visibility:new un(_t.layout_line.visibility)})),paint:yI||(yI=new Or({"line-opacity":new zn(_t.paint_line["line-opacity"]),"line-color":new zn(_t.paint_line["line-color"]),"line-translate":new un(_t.paint_line["line-translate"]),"line-translate-anchor":new un(_t.paint_line["line-translate-anchor"]),"line-width":new zn(_t.paint_line["line-width"]),"line-gap-width":new zn(_t.paint_line["line-gap-width"]),"line-offset":new zn(_t.paint_line["line-offset"]),"line-blur":new zn(_t.paint_line["line-blur"]),"line-dasharray":new zn(_t.paint_line["line-dasharray"]),"line-pattern":new zn(_t.paint_line["line-pattern"]),"line-gradient":new Ga(_t.paint_line["line-gradient"]),"line-trim-offset":new un(_t.paint_line["line-trim-offset"]),"line-trim-fade-range":new un(_t.paint_line["line-trim-fade-range"]),"line-trim-color":new un(_t.paint_line["line-trim-color"]),"line-emissive-strength":new un(_t.paint_line["line-emissive-strength"]),"line-border-width":new zn(_t.paint_line["line-border-width"]),"line-border-color":new zn(_t.paint_line["line-border-color"]),"line-occlusion-opacity":new un(_t.paint_line["line-occlusion-opacity"])}))},mx);class gF extends zn{possiblyEvaluate(n,s){return s=new qr(Math.floor(s.zoom),{now:s.now,fadeDuration:s.fadeDuration,transition:s.transition}),super.possiblyEvaluate(n,s)}evaluate(n,s,h,g){return s=gi({},s,{zoom:Math.floor(s.zoom)}),super.evaluate(n,s,h,g)}}let Jm;function II(u,n){return n>0?n+2*u:u}const _F=Di([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),vF=Di([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),yF=Di([{name:"a_projected_pos",components:4,type:"Float32"}],4);Di([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const bF=Di([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),xF=Di([{name:"a_texb",components:2,type:"Uint16"}]),wF=Di([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),SF=Di([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Di([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const CI=Di([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),TF=Di([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Di([{name:"triangle",components:3,type:"Uint16"}]),Di([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Di([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Di([{type:"Float32",name:"offsetX"}]),Di([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var ds=24;const Ml=128;function gx(u,n){const{expression:s}=n;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new qr(u+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:g}=s;let f=0;for(;f<h.length&&h[f]<=u;)f++;f=Math.max(0,f-1);let _=f;for(;_<h.length&&h[_]<u+1;)_++;_=Math.min(h.length-1,_);const S=h[f],A=h[_];return s.kind==="composite"?{kind:"composite",minZoom:S,maxZoom:A,interpolationType:g}:{kind:"camera",minZoom:S,maxZoom:A,minSize:s.evaluate(new qr(S)),maxSize:s.evaluate(new qr(A)),interpolationType:g}}}function qv(u,{uSize:n,uSizeT:s},{lowerSize:h,upperSize:g}){return u.kind==="source"?h/Ml:u.kind==="composite"?In(h/Ml,g/Ml,s):n}function Vf(u,n){let s=0,h=0;if(u.kind==="constant")h=u.layoutSize;else if(u.kind!=="source"){const{interpolationType:g,minZoom:f,maxZoom:_}=u,S=g?hn(da.interpolationFactor(g,n,f,_),0,1):0;u.kind==="camera"?h=In(u.minSize,u.maxSize,S):s=S}return{uSizeT:s,uSize:h}}var EF=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Ml,evaluateSizeForFeature:qv,evaluateSizeForZoom:Vf,getSizeData:gx});function IF(u,n,s){return u.sections.forEach(h=>{h.text=function(g,f,_){const S=f.layout.get("text-transform").evaluate(_,{});return S==="uppercase"?g=g.toLocaleUpperCase():S==="lowercase"&&(g=g.toLocaleLowerCase()),Gs.applyArabicShaping&&(g=Gs.applyArabicShaping(g)),g}(h.text,n,s)}),u}const Qm={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function CF(u){return u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""}function AF(u){return u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""||u===""}var AI,_x,PI,vx={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function PF(){return AI||(AI=1,vx.read=function(u,n,s,h,g){var f,_,S=8*g-h-1,A=(1<<S)-1,k=A>>1,x=-7,I=s?g-1:0,M=s?-1:1,C=u[n+I];for(I+=M,f=C&(1<<-x)-1,C>>=-x,x+=S;x>0;f=256*f+u[n+I],I+=M,x-=8);for(_=f&(1<<-x)-1,f>>=-x,x+=h;x>0;_=256*_+u[n+I],I+=M,x-=8);if(f===0)f=1-k;else{if(f===A)return _?NaN:1/0*(C?-1:1);_+=Math.pow(2,h),f-=k}return(C?-1:1)*_*Math.pow(2,f-h)},vx.write=function(u,n,s,h,g,f){var _,S,A,k=8*f-g-1,x=(1<<k)-1,I=x>>1,M=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,C=h?0:f-1,P=h?1:-1,O=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(S=isNaN(n)?1:0,_=x):(_=Math.floor(Math.log(n)/Math.LN2),n*(A=Math.pow(2,-_))<1&&(_--,A*=2),(n+=_+I>=1?M/A:M*Math.pow(2,1-I))*A>=2&&(_++,A/=2),_+I>=x?(S=0,_=x):_+I>=1?(S=(n*A-1)*Math.pow(2,g),_+=I):(S=n*Math.pow(2,I-1)*Math.pow(2,g),_=0));g>=8;u[s+C]=255&S,C+=P,S/=256,g-=8);for(_=_<<g|S,k+=g;k>0;u[s+C]=255&_,C+=P,_/=256,k-=8);u[s+C-P]|=128*O}),vx}function MI(){if(PI)return _x;PI=1,_x=n;var u=PF();function n(H){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(H)?H:new Uint8Array(H||0),this.pos=0,this.type=0,this.length=this.buf.length}n.Varint=0,n.Fixed64=1,n.Bytes=2,n.Fixed32=5;var s=4294967296,h=1/s,g=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function f(H){return H.type===n.Bytes?H.readVarint()+H.pos:H.pos+1}function _(H,se,ue){return ue?4294967296*se+(H>>>0):4294967296*(se>>>0)+(H>>>0)}function S(H,se,ue){var we=se<=16383?1:se<=2097151?2:se<=268435455?3:Math.floor(Math.log(se)/(7*Math.LN2));ue.realloc(we);for(var Me=ue.pos-1;Me>=H;Me--)ue.buf[Me+we]=ue.buf[Me]}function A(H,se){for(var ue=0;ue<H.length;ue++)se.writeVarint(H[ue])}function k(H,se){for(var ue=0;ue<H.length;ue++)se.writeSVarint(H[ue])}function x(H,se){for(var ue=0;ue<H.length;ue++)se.writeFloat(H[ue])}function I(H,se){for(var ue=0;ue<H.length;ue++)se.writeDouble(H[ue])}function M(H,se){for(var ue=0;ue<H.length;ue++)se.writeBoolean(H[ue])}function C(H,se){for(var ue=0;ue<H.length;ue++)se.writeFixed32(H[ue])}function P(H,se){for(var ue=0;ue<H.length;ue++)se.writeSFixed32(H[ue])}function O(H,se){for(var ue=0;ue<H.length;ue++)se.writeFixed64(H[ue])}function V(H,se){for(var ue=0;ue<H.length;ue++)se.writeSFixed64(H[ue])}function G(H,se){return(H[se]|H[se+1]<<8|H[se+2]<<16)+16777216*H[se+3]}function J(H,se,ue){H[ue]=se,H[ue+1]=se>>>8,H[ue+2]=se>>>16,H[ue+3]=se>>>24}function ee(H,se){return(H[se]|H[se+1]<<8|H[se+2]<<16)+(H[se+3]<<24)}return n.prototype={destroy:function(){this.buf=null},readFields:function(H,se,ue){for(ue=ue||this.length;this.pos<ue;){var we=this.readVarint(),Me=we>>3,Re=this.pos;this.type=7&we,H(Me,se,this),this.pos===Re&&this.skip(we)}return se},readMessage:function(H,se){return this.readFields(H,se,this.readVarint()+this.pos)},readFixed32:function(){var H=G(this.buf,this.pos);return this.pos+=4,H},readSFixed32:function(){var H=ee(this.buf,this.pos);return this.pos+=4,H},readFixed64:function(){var H=G(this.buf,this.pos)+G(this.buf,this.pos+4)*s;return this.pos+=8,H},readSFixed64:function(){var H=G(this.buf,this.pos)+ee(this.buf,this.pos+4)*s;return this.pos+=8,H},readFloat:function(){var H=u.read(this.buf,this.pos,!0,23,4);return this.pos+=4,H},readDouble:function(){var H=u.read(this.buf,this.pos,!0,52,8);return this.pos+=8,H},readVarint:function(H){var se,ue,we=this.buf;return se=127&(ue=we[this.pos++]),ue<128?se:(se|=(127&(ue=we[this.pos++]))<<7,ue<128?se:(se|=(127&(ue=we[this.pos++]))<<14,ue<128?se:(se|=(127&(ue=we[this.pos++]))<<21,ue<128?se:function(Me,Re,Ce){var je,Oe,He=Ce.buf;if(je=(112&(Oe=He[Ce.pos++]))>>4,Oe<128||(je|=(127&(Oe=He[Ce.pos++]))<<3,Oe<128)||(je|=(127&(Oe=He[Ce.pos++]))<<10,Oe<128)||(je|=(127&(Oe=He[Ce.pos++]))<<17,Oe<128)||(je|=(127&(Oe=He[Ce.pos++]))<<24,Oe<128)||(je|=(1&(Oe=He[Ce.pos++]))<<31,Oe<128))return _(Me,je,Re);throw new Error("Expected varint not more than 10 bytes")}(se|=(15&(ue=we[this.pos]))<<28,H,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var H=this.readVarint();return H%2==1?(H+1)/-2:H/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var H=this.readVarint()+this.pos,se=this.pos;return this.pos=H,H-se>=12&&g?function(ue,we,Me){return g.decode(ue.subarray(we,Me))}(this.buf,se,H):function(ue,we,Me){for(var Re="",Ce=we;Ce<Me;){var je,Oe,He,Qe=ue[Ce],it=null,ot=Qe>239?4:Qe>223?3:Qe>191?2:1;if(Ce+ot>Me)break;ot===1?Qe<128&&(it=Qe):ot===2?(192&(je=ue[Ce+1]))==128&&(it=(31&Qe)<<6|63&je)<=127&&(it=null):ot===3?(Oe=ue[Ce+2],(192&(je=ue[Ce+1]))==128&&(192&Oe)==128&&((it=(15&Qe)<<12|(63&je)<<6|63&Oe)<=2047||it>=55296&&it<=57343)&&(it=null)):ot===4&&(Oe=ue[Ce+2],He=ue[Ce+3],(192&(je=ue[Ce+1]))==128&&(192&Oe)==128&&(192&He)==128&&((it=(15&Qe)<<18|(63&je)<<12|(63&Oe)<<6|63&He)<=65535||it>=1114112)&&(it=null)),it===null?(it=65533,ot=1):it>65535&&(it-=65536,Re+=String.fromCharCode(it>>>10&1023|55296),it=56320|1023&it),Re+=String.fromCharCode(it),Ce+=ot}return Re}(this.buf,se,H)},readBytes:function(){var H=this.readVarint()+this.pos,se=this.buf.subarray(this.pos,H);return this.pos=H,se},readPackedVarint:function(H,se){if(this.type!==n.Bytes)return H.push(this.readVarint(se));var ue=f(this);for(H=H||[];this.pos<ue;)H.push(this.readVarint(se));return H},readPackedSVarint:function(H){if(this.type!==n.Bytes)return H.push(this.readSVarint());var se=f(this);for(H=H||[];this.pos<se;)H.push(this.readSVarint());return H},readPackedBoolean:function(H){if(this.type!==n.Bytes)return H.push(this.readBoolean());var se=f(this);for(H=H||[];this.pos<se;)H.push(this.readBoolean());return H},readPackedFloat:function(H){if(this.type!==n.Bytes)return H.push(this.readFloat());var se=f(this);for(H=H||[];this.pos<se;)H.push(this.readFloat());return H},readPackedDouble:function(H){if(this.type!==n.Bytes)return H.push(this.readDouble());var se=f(this);for(H=H||[];this.pos<se;)H.push(this.readDouble());return H},readPackedFixed32:function(H){if(this.type!==n.Bytes)return H.push(this.readFixed32());var se=f(this);for(H=H||[];this.pos<se;)H.push(this.readFixed32());return H},readPackedSFixed32:function(H){if(this.type!==n.Bytes)return H.push(this.readSFixed32());var se=f(this);for(H=H||[];this.pos<se;)H.push(this.readSFixed32());return H},readPackedFixed64:function(H){if(this.type!==n.Bytes)return H.push(this.readFixed64());var se=f(this);for(H=H||[];this.pos<se;)H.push(this.readFixed64());return H},readPackedSFixed64:function(H){if(this.type!==n.Bytes)return H.push(this.readSFixed64());var se=f(this);for(H=H||[];this.pos<se;)H.push(this.readSFixed64());return H},skip:function(H){var se=7&H;if(se===n.Varint)for(;this.buf[this.pos++]>127;);else if(se===n.Bytes)this.pos=this.readVarint()+this.pos;else if(se===n.Fixed32)this.pos+=4;else{if(se!==n.Fixed64)throw new Error("Unimplemented type: "+se);this.pos+=8}},writeTag:function(H,se){this.writeVarint(H<<3|se)},realloc:function(H){for(var se=this.length||16;se<this.pos+H;)se*=2;if(se!==this.length){var ue=new Uint8Array(se);ue.set(this.buf),this.buf=ue,this.length=se}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(H){this.realloc(4),J(this.buf,H,this.pos),this.pos+=4},writeSFixed32:function(H){this.realloc(4),J(this.buf,H,this.pos),this.pos+=4},writeFixed64:function(H){this.realloc(8),J(this.buf,-1&H,this.pos),J(this.buf,Math.floor(H*h),this.pos+4),this.pos+=8},writeSFixed64:function(H){this.realloc(8),J(this.buf,-1&H,this.pos),J(this.buf,Math.floor(H*h),this.pos+4),this.pos+=8},writeVarint:function(H){(H=+H||0)>268435455||H<0?function(se,ue){var we,Me;if(se>=0?(we=se%4294967296|0,Me=se/4294967296|0):(Me=~(-se/4294967296),4294967295^(we=~(-se%4294967296))?we=we+1|0:(we=0,Me=Me+1|0)),se>=18446744073709552e3||se<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");ue.realloc(10),function(Re,Ce,je){je.buf[je.pos++]=127&Re|128,Re>>>=7,je.buf[je.pos++]=127&Re|128,Re>>>=7,je.buf[je.pos++]=127&Re|128,Re>>>=7,je.buf[je.pos++]=127&Re|128,je.buf[je.pos]=127&(Re>>>=7)}(we,0,ue),function(Re,Ce){var je=(7&Re)<<4;Ce.buf[Ce.pos++]|=je|((Re>>>=3)?128:0),Re&&(Ce.buf[Ce.pos++]=127&Re|((Re>>>=7)?128:0),Re&&(Ce.buf[Ce.pos++]=127&Re|((Re>>>=7)?128:0),Re&&(Ce.buf[Ce.pos++]=127&Re|((Re>>>=7)?128:0),Re&&(Ce.buf[Ce.pos++]=127&Re|((Re>>>=7)?128:0),Re&&(Ce.buf[Ce.pos++]=127&Re)))))}(Me,ue)}(H,this):(this.realloc(4),this.buf[this.pos++]=127&H|(H>127?128:0),H<=127||(this.buf[this.pos++]=127&(H>>>=7)|(H>127?128:0),H<=127||(this.buf[this.pos++]=127&(H>>>=7)|(H>127?128:0),H<=127||(this.buf[this.pos++]=H>>>7&127))))},writeSVarint:function(H){this.writeVarint(H<0?2*-H-1:2*H)},writeBoolean:function(H){this.writeVarint(!!H)},writeString:function(H){H=String(H),this.realloc(4*H.length),this.pos++;var se=this.pos;this.pos=function(we,Me,Re){for(var Ce,je,Oe=0;Oe<Me.length;Oe++){if((Ce=Me.charCodeAt(Oe))>55295&&Ce<57344){if(!je){Ce>56319||Oe+1===Me.length?(we[Re++]=239,we[Re++]=191,we[Re++]=189):je=Ce;continue}if(Ce<56320){we[Re++]=239,we[Re++]=191,we[Re++]=189,je=Ce;continue}Ce=je-55296<<10|Ce-56320|65536,je=null}else je&&(we[Re++]=239,we[Re++]=191,we[Re++]=189,je=null);Ce<128?we[Re++]=Ce:(Ce<2048?we[Re++]=Ce>>6|192:(Ce<65536?we[Re++]=Ce>>12|224:(we[Re++]=Ce>>18|240,we[Re++]=Ce>>12&63|128),we[Re++]=Ce>>6&63|128),we[Re++]=63&Ce|128)}return Re}(this.buf,H,this.pos);var ue=this.pos-se;ue>=128&&S(se,ue,this),this.pos=se-1,this.writeVarint(ue),this.pos+=ue},writeFloat:function(H){this.realloc(4),u.write(this.buf,H,this.pos,!0,23,4),this.pos+=4},writeDouble:function(H){this.realloc(8),u.write(this.buf,H,this.pos,!0,52,8),this.pos+=8},writeBytes:function(H){var se=H.length;this.writeVarint(se),this.realloc(se);for(var ue=0;ue<se;ue++)this.buf[this.pos++]=H[ue]},writeRawMessage:function(H,se){this.pos++;var ue=this.pos;H(se,this);var we=this.pos-ue;we>=128&&S(ue,we,this),this.pos=ue-1,this.writeVarint(we),this.pos+=we},writeMessage:function(H,se,ue){this.writeTag(H,n.Bytes),this.writeRawMessage(se,ue)},writePackedVarint:function(H,se){se.length&&this.writeMessage(H,A,se)},writePackedSVarint:function(H,se){se.length&&this.writeMessage(H,k,se)},writePackedBoolean:function(H,se){se.length&&this.writeMessage(H,M,se)},writePackedFloat:function(H,se){se.length&&this.writeMessage(H,x,se)},writePackedDouble:function(H,se){se.length&&this.writeMessage(H,I,se)},writePackedFixed32:function(H,se){se.length&&this.writeMessage(H,C,se)},writePackedSFixed32:function(H,se){se.length&&this.writeMessage(H,P,se)},writePackedFixed64:function(H,se){se.length&&this.writeMessage(H,O,se)},writePackedSFixed64:function(H,se){se.length&&this.writeMessage(H,V,se)},writeBytesField:function(H,se){this.writeTag(H,n.Bytes),this.writeBytes(se)},writeFixed32Field:function(H,se){this.writeTag(H,n.Fixed32),this.writeFixed32(se)},writeSFixed32Field:function(H,se){this.writeTag(H,n.Fixed32),this.writeSFixed32(se)},writeFixed64Field:function(H,se){this.writeTag(H,n.Fixed64),this.writeFixed64(se)},writeSFixed64Field:function(H,se){this.writeTag(H,n.Fixed64),this.writeSFixed64(se)},writeVarintField:function(H,se){this.writeTag(H,n.Varint),this.writeVarint(se)},writeSVarintField:function(H,se){this.writeTag(H,n.Varint),this.writeSVarint(se)},writeStringField:function(H,se){this.writeTag(H,n.Bytes),this.writeString(se)},writeFloatField:function(H,se){this.writeTag(H,n.Fixed32),this.writeFloat(se)},writeDoubleField:function(H,se){this.writeTag(H,n.Fixed64),this.writeDouble(se)},writeBooleanField:function(H,se){this.writeVarintField(H,!!se)}},_x}var Wv=D(MI());const yx=3;function MF(u,n,s){n.glyphs=[],u===1&&s.readMessage(kF,n)}function kF(u,n,s){if(u===3){const{id:h,bitmap:g,width:f,height:_,left:S,top:A,advance:k}=s.readMessage(RF,{});n.glyphs.push({id:h,bitmap:new Ru({width:f+2*yx,height:_+2*yx},g),metrics:{width:f,height:_,left:S,top:A,advance:k}})}else u===4?n.ascender=s.readSVarint():u===5&&(n.descender=s.readSVarint())}function RF(u,n,s){u===1?n.id=s.readVarint():u===2?n.bitmap=s.readBytes():u===3?n.width=s.readVarint():u===4?n.height=s.readVarint():u===5?n.left=s.readSVarint():u===6?n.top=s.readSVarint():u===7&&(n.advance=s.readVarint())}const kI=yx,Wa={horizontal:1,vertical:2,horizontalOnly:3};class eg{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(n,s){const h=new eg;return h.scale=n||1,h.fontStack=s,h}static forImage(n){const s=new eg;return s.imageName=n,s}}class Nf{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,s){const h=new Nf;for(let g=0;g<n.sections.length;g++){const f=n.sections[g];f.image?h.addImageSection(f):h.addTextSection(f,s)}return h}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSections(){return this.sections}getSectionIndex(n){return this.sectionIndex[n]}getCodePoint(n){return this.text.codePointAt(n)}verticalizePunctuation(n){this.text=function(s,h){let g="";for(let f=0;f<s.length;f++){const _=s.charCodeAt(f+1)||null,S=s.charCodeAt(f-1)||null;g+=!h&&(_&&Mh(_)&&!Qm[s[f+1]]||S&&Mh(S)&&!Qm[s[f-1]])||!Qm[s[f]]?s[f]:Qm[s[f]]}return g}(this.text,n)}trim(){let n=0;for(let h=0;h<this.text.length&&Zv[this.text.charCodeAt(h)];h++)n++;let s=this.text.length;for(let h=this.text.length-1;h>=0&&h>=n&&Zv[this.text.charCodeAt(h)];h--)s--;this.text=this.text.substring(n,s),this.sectionIndex=this.sectionIndex.slice(n,s)}substring(n,s){const h=new Nf;return h.text=this.text.substring(n,s),h.sectionIndex=this.sectionIndex.slice(n,s),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,s)=>Math.max(n,this.sections[s].scale),0)}addTextSection(n,s){this.text+=n.text,this.sections.push(eg.forText(n.scale,n.fontStack||s));const h=this.sections.length-1;for(let g=0;g<n.text.length;++g)this.sectionIndex.push(h)}addImageSection(n){const s=n.image?n.image.namePrimary:"";if(s.length===0)return void ii("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCodePoint(h),this.sections.push(eg.forImage(s)),this.sectionIndex.push(this.sections.length-1)):ii("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function bx(u,n,s,h,g,f,_,S,A,k,x,I,M,C,P){const O=Nf.fromFeature(u,g);I===Wa.vertical&&O.verticalizePunctuation(M);let V=[];const G=function(ue,we,Me,Re,Ce,je){if(!ue)return[];const Oe=[],He=function(ct,bt,ut,Ot,$t,It){let En=0;for(let mn=0;mn<ct.length();mn++){const an=ct.getSection(mn);En+=RI(ct.getCodePoint(mn),an,Ot,$t,bt,It)}return En/Math.max(1,Math.ceil(En/ut))}(ue,we,Me,Re,Ce,je),Qe=ue.text.indexOf("")>=0;let it=0;for(let ct=0;ct<ue.length();ct++){const bt=ue.getSection(ct),ut=ue.getCodePoint(ct);if(Zv[ut]||(it+=RI(ut,bt,Re,Ce,we,je)),ct<ue.length()-1){const Ot=!((ot=ut)<11904||!(Ln["Bopomofo Extended"](ot)||Ln.Bopomofo(ot)||Ln["CJK Compatibility Forms"](ot)||Ln["CJK Compatibility Ideographs"](ot)||Ln["CJK Compatibility"](ot)||Ln["CJK Radicals Supplement"](ot)||Ln["CJK Strokes"](ot)||Ln["CJK Symbols and Punctuation"](ot)||Ln["CJK Unified Ideographs Extension A"](ot)||Ln["CJK Unified Ideographs"](ot)||Ln["Enclosed CJK Letters and Months"](ot)||Ln["Halfwidth and Fullwidth Forms"](ot)||Ln.Hiragana(ot)||Ln["Ideographic Description Characters"](ot)||Ln["Kangxi Radicals"](ot)||Ln["Katakana Phonetic Extensions"](ot)||Ln.Katakana(ot)||Ln["Vertical Forms"](ot)||Ln["Yi Radicals"](ot)||Ln["Yi Syllables"](ot)));(DF[ut]||Ot||bt.imageName)&&Oe.push(OI(ct+1,it,He,Oe,OF(ut,ue.getCodePoint(ct+1),Ot&&Qe),!1))}}var ot;return LI(OI(ue.length(),it,He,Oe,0,!0))}(O,k,f,n,h,C),{processBidirectionalText:J,processStyledBidirectionalText:ee}=Gs;if(J&&O.sections.length===1){const ue=J(O.toString(),G);for(const we of ue){const Me=new Nf;Me.text=we,Me.sections=O.sections;for(let Re=0;Re<we.length;Re++)Me.sectionIndex.push(0);V.push(Me)}}else if(ee){const ue=ee(O.text,O.sectionIndex,G);for(const we of ue){const Me=new Nf;Me.text=we[0],Me.sectionIndex=we[1],Me.sections=O.sections,V.push(Me)}}else V=function(ue,we){const Me=[],Re=ue.text;let Ce=0;for(const je of we)Me.push(ue.substring(Ce,je)),Ce=je;return Ce<Re.length&&Me.push(ue.substring(Ce,Re.length)),Me}(O,G);const H=[],se={positionedLines:H,text:O.toString(),top:x[1],bottom:x[1],left:x[0],right:x[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ue,we,Me,Re,Ce,je,Oe,He,Qe,it,ot,ct){let bt=0,ut=0,Ot=0;const $t=He==="right"?1:He==="left"?0:.5;let It=!1;for(const Tn of Ce){const An=Tn.getSections();for(const Kn of An){if(Kn.imageName)continue;const ci=we[Kn.fontStack];if(ci&&(It=ci.ascender!==void 0&&ci.descender!==void 0,!It))break}if(!It)break}let En=0;for(const Tn of Ce){Tn.trim();const An=Tn.getMaxScale(),Kn=(An-1)*ds,ci={positionedGlyphs:[],lineOffset:0};ue.positionedLines[En]=ci;const oi=ci.positionedGlyphs;let si=0;if(!Tn.length()){ut+=je,++En;continue}let pi=0,_i=0;for(let ji=0;ji<Tn.length();ji++){const Jn=Tn.getSection(ji),Bi=Tn.getSectionIndex(ji),Fi=Tn.getCodePoint(ji);let _r=Jn.scale,Jr=null,mo=null,Qr=null,Gr=ds,Wo=0;const yo=!(Qe===Wa.horizontal||!ot&&!yf(Fi)||ot&&(Zv[Fi]||(mn=Fi,Ln.Arabic(mn)||Ln["Arabic Supplement"](mn)||Ln["Arabic Extended-A"](mn)||Ln["Arabic Presentation Forms-A"](mn)||Ln["Arabic Presentation Forms-B"](mn))));if(Jn.imageName){const fs=Re[Jn.imageName];if(!fs)continue;Qr=Jn.imageName,ue.iconsInText=ue.iconsInText||!0,mo=fs.paddedRect;const hr=fs.displaySize;_r=_r*ds/ct,Jr={width:hr[0],height:hr[1],left:0,top:-kI,advance:yo?hr[1]:hr[0],localGlyph:!1},Wo=It?-Jr.height*_r:An*ds-17-hr[1]*_r,Gr=Jr.advance;const ma=(yo?hr[0]:hr[1])*_r-ds*An;ma>0&&ma>si&&(si=ma)}else{const fs=Me[Jn.fontStack];if(!fs)continue;fs[Fi]&&(mo=fs[Fi]);const hr=we[Jn.fontStack];if(!hr)continue;const ma=hr.glyphs[Fi];if(!ma)continue;if(Jr=ma.metrics,Gr=Fi!==8203?ds:0,It){const Ll=hr.ascender!==void 0?Math.abs(hr.ascender):0,cl=hr.descender!==void 0?Math.abs(hr.descender):0,ul=(Ll+cl)*_r;pi<ul&&(pi=ul,_i=(Ll-cl)/2*_r),Wo=-Ll*_r}else Wo=(An-_r)*ds-17}yo?(ue.verticalizable=!0,oi.push({glyph:Fi,imageName:Qr,x:bt,y:ut+Wo,vertical:yo,scale:_r,localGlyph:Jr.localGlyph,fontStack:Jn.fontStack,sectionIndex:Bi,metrics:Jr,rect:mo}),bt+=Gr*_r+it):(oi.push({glyph:Fi,imageName:Qr,x:bt,y:ut+Wo,vertical:yo,scale:_r,localGlyph:Jr.localGlyph,fontStack:Jn.fontStack,sectionIndex:Bi,metrics:Jr,rect:mo}),bt+=Jr.advance*_r+it)}oi.length!==0&&(Ot=Math.max(bt-it,Ot),It?zI(oi,$t,si,_i,je*An/2):zI(oi,$t,si,0,je/2)),bt=0;const ir=je*An+si;ci.lineOffset=Math.max(si,Kn),ut+=ir,++En}var mn;const an=ut,{horizontalAlign:Wt,verticalAlign:Vn}=xx(Oe);(function(Tn,An,Kn,ci,oi,si){const pi=(An-Kn)*oi,_i=-si*ci;for(const ir of Tn)for(const ji of ir.positionedGlyphs)ji.x+=pi,ji.y+=_i})(ue.positionedLines,$t,Wt,Vn,Ot,an),ue.top+=-Vn*an,ue.bottom=ue.top+an,ue.left+=-Wt*Ot,ue.right=ue.left+Ot,ue.hasBaseline=It}(se,n,s,h,V,_,S,A,I,k,M,P),!function(ue){for(const we of ue)if(we.positionedGlyphs.length!==0)return!1;return!0}(H)&&se}const Zv={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},DF={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function RI(u,n,s,h,g,f){if(n.imageName){const _=h[n.imageName];return _?_.displaySize[0]*n.scale*ds/f+g:0}{const _=s[n.fontStack],S=_&&_.glyphs[u];return S?S.metrics.advance*n.scale+g:0}}function DI(u,n,s,h){const g=Math.pow(u-n,2);return h?u<n?g/2:2*g:g+Math.abs(s)*s}function OF(u,n,s){let h=0;return u===10&&(h-=1e4),s&&(h+=150),u!==40&&u!==65288||(h+=50),n!==41&&n!==65289||(h+=50),h}function OI(u,n,s,h,g,f){let _=null,S=DI(n,s,g,f);for(const A of h){const k=DI(n-A.x,s,g,f)+A.badness;k<=S&&(_=A,S=k)}return{index:u,x:n,priorBreak:_,badness:S}}function LI(u){return u?LI(u.priorBreak).concat(u.index):[]}function xx(u){let n=.5,s=.5;switch(u){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:n,verticalAlign:s}}function zI(u,n,s,h,g){if(!(n||s||h||g))return;const f=u.length-1,_=u[f],S=(_.x+_.metrics.advance*_.scale)*n;for(let A=0;A<=f;A++)u[A].x-=S,u[A].y+=s+h+g}function LF(u,n,s,h){const{horizontalAlign:g,verticalAlign:f}=xx(h),_=s[0]-u.displaySize[0]*g,S=s[1]-u.displaySize[1]*f;return{imagePrimary:u,imageSecondary:n,top:S,bottom:S+u.displaySize[1],left:_,right:_+u.displaySize[0]}}function BI(u,n,s,h,g,f){const _=u.imagePrimary;let S;if(_.content){const V=_.content,G=_.pixelRatio||1;S=[V[0]/G,V[1]/G,_.displaySize[0]-V[2]/G,_.displaySize[1]-V[3]/G]}const A=n.left*f,k=n.right*f;let x,I,M,C;s==="width"||s==="both"?(C=g[0]+A-h[3],I=g[0]+k+h[1]):(C=g[0]+(A+k-_.displaySize[0])/2,I=C+_.displaySize[0]);const P=n.top*f,O=n.bottom*f;return s==="height"||s==="both"?(x=g[1]+P-h[0],M=g[1]+O+h[2]):(x=g[1]+(P+O-_.displaySize[1])/2,M=x+_.displaySize[1]),{imagePrimary:_,imageSecondary:void 0,top:x,right:I,bottom:M,left:C,collisionPadding:S}}class Bc extends Ue{constructor(n,s,h,g,f){super(n,s),this.angle=g,this.z=h,f!==void 0&&(this.segment=f)}clone(){return new Bc(this.x,this.y,this.z,this.angle,this.segment)}}function FI(u,n,s,h,g){if(n.segment===void 0)return!0;let f=n,_=n.segment+1,S=0;for(;S>-s/2;){if(_--,_<0)return!1;S-=u[_].dist(f),f=u[_]}S+=u[_].dist(u[_+1]),_++;const A=[];let k=0;for(;S<s/2;){const x=u[_],I=u[_+1];if(!I)return!1;let M=u[_-1].angleTo(x)-x.angleTo(I);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),A.push({distance:S,angleDelta:M}),k+=M;S-A[0].distance>h;)k-=A.shift().angleDelta;if(k>g)return!1;_++,S+=x.dist(I)}return!0}function VI(u){let n=0;for(let s=0;s<u.length-1;s++)n+=u[s].dist(u[s+1]);return n}function NI(u,n,s){return u?.6*n*s:0}function UI(u,n){return Math.max(u?u.right-u.left:0,n?n.right-n.left:0)}function zF(u,n,s,h,g,f){const _=NI(s,g,f),S=UI(s,h)*f;let A=0;const k=VI(u)/2;for(let x=0;x<u.length-1;x++){const I=u[x],M=u[x+1],C=I.dist(M);if(A+C>k){const P=(k-A)/C,O=In(I.x,M.x,P),V=In(I.y,M.y,P),G=new Bc(O,V,0,M.angleTo(I),x);return!_||FI(u,G,S,_,n)?G:void 0}A+=C}}function BF(u,n,s,h,g,f,_,S,A){const k=NI(h,f,_),x=UI(h,g),I=x*_,M=u[0].x===0||u[0].x===A||u[0].y===0||u[0].y===A;return n-I<n/4&&(n=I+n/4),jI(u,M?n/2*S%n:(x/2+2*f)*_*S%n,n,k,s,I,M,!1,A)}function jI(u,n,s,h,g,f,_,S,A){const k=f/2,x=VI(u);let I=0,M=n-s,C=[];for(let P=0;P<u.length-1;P++){const O=u[P],V=u[P+1],G=O.dist(V),J=V.angleTo(O);for(;M+s<I+G;){M+=s;const ee=(M-I)/G,H=In(O.x,V.x,ee),se=In(O.y,V.y,ee);if(H>=0&&H<A&&se>=0&&se<A&&M-k>=0&&M+k<=x){const ue=new Bc(H,se,0,J,P);h&&!FI(u,ue,f,h,g)||C.push(ue)}}I+=G}return S||C.length||_||(C=jI(u,I/2,s,h,g,f,_,!0,A)),C}function $I(u,n,s,h,g){const f=[];for(let _=0;_<u.length;_++){const S=u[_];let A;for(let k=0;k<S.length-1;k++){let x=S[k],I=S[k+1];x.x<n&&I.x<n||(x.x<n?x=new Ue(n,x.y+(n-x.x)/(I.x-x.x)*(I.y-x.y))._round():I.x<n&&(I=new Ue(n,x.y+(n-x.x)/(I.x-x.x)*(I.y-x.y))._round()),x.y<s&&I.y<s||(x.y<s?x=new Ue(x.x+(s-x.y)/(I.y-x.y)*(I.x-x.x),s)._round():I.y<s&&(I=new Ue(x.x+(s-x.y)/(I.y-x.y)*(I.x-x.x),s)._round()),x.x>=h&&I.x>=h||(x.x>=h?x=new Ue(h,x.y+(h-x.x)/(I.x-x.x)*(I.y-x.y))._round():I.x>=h&&(I=new Ue(h,x.y+(h-x.x)/(I.x-x.x)*(I.y-x.y))._round()),x.y>=g&&I.y>=g||(x.y>=g?x=new Ue(x.x+(g-x.y)/(I.y-x.y)*(I.x-x.x),g)._round():I.y>=g&&(I=new Ue(x.x+(g-x.y)/(I.y-x.y)*(I.x-x.x),g)._round()),A&&x.equals(A[A.length-1])||(A=[x],f.push(A)),A.push(I)))))}}return f}function GI(u){let n=0,s=0;for(const _ of u)n+=_.w*_.h,s=Math.max(s,_.w);u.sort((_,S)=>S.h-_.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),s),h:1/0}];let g=0,f=0;for(const _ of u)for(let S=h.length-1;S>=0;S--){const A=h[S];if(!(_.w>A.w||_.h>A.h)){if(_.x=A.x,_.y=A.y,f=Math.max(f,_.y+_.h),g=Math.max(g,_.x+_.w),_.w===A.w&&_.h===A.h){const k=h.pop();S<h.length&&(h[S]=k)}else _.h===A.h?(A.x+=_.w,A.w-=_.w):_.w===A.w?(A.y+=_.h,A.h-=_.h):(h.push({x:A.x+_.w,y:A.y,w:A.w-_.w,h:_.h}),A.y+=_.h,A.h-=_.h);break}}return{w:g,h:f,fill:n/(g*f)||0}}Pn(Bc,"Anchor");const tg=1;class wx{constructor(n,{pixelRatio:s,version:h,stretchX:g,stretchY:f,content:_},S){this.paddedRect=n,this.pixelRatio=s,this.stretchX=g,this.stretchY=f,this.content=_,this.version=h,this.padding=S}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.pixelRatio,(this.paddedRect.h-2*this.padding)/this.pixelRatio]}}class HI{constructor(n,s,h){const g={},f={};this.haveRenderCallbacks=[];const _=[];this.addImages(n,g,tg,_),this.addImages(s,f,2,_);const{w:S,h:A}=GI(_),k=new Ds({width:S||1,height:A||1});for(const x in n){const I=n[x],M=g[x].paddedRect;Ds.copy(I.data,k,{x:0,y:0},{x:M.x+tg,y:M.y+tg},I.data,h,I.sdf)}for(const x in s){const I=s[x],M=f[x].paddedRect;let C=f[x].padding;const P=M.x+C,O=M.y+C,V=I.data.width,G=I.data.height;C=C>1?C-1:C,Ds.copy(I.data,k,{x:0,y:0},{x:P,y:O},I.data,h),Ds.copy(I.data,k,{x:0,y:G-C},{x:P,y:O-C},{width:V,height:C},h),Ds.copy(I.data,k,{x:0,y:0},{x:P,y:O+G},{width:V,height:C},h),Ds.copy(I.data,k,{x:V-C,y:0},{x:P-C,y:O},{width:C,height:G},h),Ds.copy(I.data,k,{x:0,y:0},{x:P+V,y:O},{width:C,height:G},h),Ds.copy(I.data,k,{x:V-C,y:G-C},{x:P-C,y:O-C},{width:C,height:C},h),Ds.copy(I.data,k,{x:0,y:G-C},{x:P+V,y:O-C},{width:C,height:C},h),Ds.copy(I.data,k,{x:0,y:0},{x:P+V,y:O+G},{width:C,height:C},h),Ds.copy(I.data,k,{x:V-C,y:0},{x:P-C,y:O+G},{width:C,height:C},h)}this.image=k,this.iconPositions=g,this.patternPositions=f}addImages(n,s,h,g){for(const f in n){const _=n[f],S={x:0,y:0,w:_.data.width+2*h,h:_.data.height+2*h};g.push(S),s[f]=new wx(S,_,h),_.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(n,s,h){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(g=>n.hasImage(g,h)),n.dispatchRenderCallbacks(this.haveRenderCallbacks,h);for(const g in n.getUpdatedImages(h))this.patchUpdatedImage(this.iconPositions[g],n.getImage(g,h),s),this.patchUpdatedImage(this.patternPositions[g],n.getImage(g,h),s)}patchUpdatedImage(n,s,h){if(!n||!s||n.version===s.version)return;n.version=s.version;const[g,f]=n.tl;h.update(s.data,{position:{x:g,y:f}})}}Pn(wx,"ImagePosition"),Pn(HI,"ImageAtlas");const ng=1e20;function qI(u,n,s,h,g,f,_,S,A){for(let k=n;k<n+h;k++)WI(u,s*f+k,f,g,_,S,A);for(let k=s;k<s+g;k++)WI(u,k*f+n,1,h,_,S,A)}function WI(u,n,s,h,g,f,_){f[0]=0,_[0]=-ng,_[1]=ng,g[0]=u[n];for(let S=1,A=0,k=0;S<h;S++){g[S]=u[n+S*s];const x=S*S;do{const I=f[A];k=(g[S]-g[I]+x-I*I)/(S-I)/2}while(k<=_[A]&&--A>-1);A++,f[A]=S,_[A]=k,_[A+1]=ng}for(let S=0,A=0;S<h;S++){for(;_[A+1]<S;)A++;const k=f[A],x=S-k;u[n+S*s]=g[k]+x*x}}const kl=2,Sx={none:0,ideographs:1,all:2};class Uf{constructor(n,s,h){this.requestManager=n,this.localGlyphMode=s,this.localFontFamily=h,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(n,s){this.urls[s]=n}getGlyphs(n,s,h){const g=[],f=this.urls[s]||Ze.GLYPHS_URL;for(const _ in n)for(const S of n[_])g.push({stack:_,id:S});ki(g,({stack:_,id:S},A)=>{let k=this.entries[_];k||(k=this.entries[_]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let x=k.glyphs[S];if(x!==void 0)return void A(null,{stack:_,id:S,glyph:x});if(x=this._tinySDF(k,_,S),x)return k.glyphs[S]=x,void A(null,{stack:_,id:S,glyph:x});const I=Math.floor(S/256);if(256*I>65535)return void A(new Error("glyphs > 65535 not supported"));if(k.ranges[I])return void A(null,{stack:_,id:S,glyph:x});let M=k.requests[I];M||(M=k.requests[I]=[],Uf.loadGlyphRange(_,I,f,this.requestManager,(C,P)=>{if(P){k.ascender=P.ascender,k.descender=P.descender;for(const O in P.glyphs)this._doesCharSupportLocalGlyph(+O)||(k.glyphs[+O]=P.glyphs[+O]);k.ranges[I]=!0}for(const O of M)O(C,P);delete k.requests[I]})),M.push((C,P)=>{C?A(C):P&&A(null,{stack:_,id:S,glyph:P.glyphs[S]||null})})},(_,S)=>{if(_)h(_);else if(S){const A={};for(const{stack:k,id:x,glyph:I}of S)A[k]===void 0&&(A[k]={}),A[k].glyphs===void 0&&(A[k].glyphs={}),A[k].glyphs[x]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics},A[k].ascender=this.entries[k].ascender,A[k].descender=this.entries[k].descender;h(null,A)}})}_doesCharSupportLocalGlyph(n){return this.localGlyphMode!==Sx.none&&(this.localGlyphMode===Sx.all?!!this.localFontFamily:!!this.localFontFamily&&(Ln["CJK Unified Ideographs"](n)||Ln["Hangul Syllables"](n)||Ln.Hiragana(n)||Ln.Katakana(n)||Ln["CJK Symbols and Punctuation"](n)||Ln["CJK Unified Ideographs Extension A"](n)||Ln["CJK Unified Ideographs Extension B"](n)))}_tinySDF(n,s,h){const g=this.localFontFamily;if(!g||!this._doesCharSupportLocalGlyph(h))return;let f=n.tinySDF;if(!f){let O="400";/bold/i.test(s)?O="900":/medium/i.test(s)?O="500":/light/i.test(s)&&(O="200"),f=n.tinySDF=new Uf.TinySDF({fontFamily:g,fontWeight:O,fontSize:24*kl,buffer:3*kl,radius:8*kl}),f.fontWeight=O}if(this.localGlyphs[f.fontWeight][h])return this.localGlyphs[f.fontWeight][h];const _=String.fromCodePoint(h),{data:S,width:A,height:k,glyphWidth:x,glyphHeight:I,glyphLeft:M,glyphTop:C,glyphAdvance:P}=f.draw(_);return this.localGlyphs[f.fontWeight][h]={id:h,bitmap:new Ru({width:A,height:k},S),metrics:{width:x/kl,height:I/kl,left:M/kl,top:C/kl-27,advance:P/kl,localGlyph:!0}}}}Uf.loadGlyphRange=function(u,n,s,h,g){const f=256*n,_=f+255,S=h.transformRequest(h.normalizeGlyphsURL(s).replace("{fontstack}",u).replace("{range}",`${f}-${_}`),Io.Glyphs);ta(S,(A,k)=>{if(A)g(A);else if(k){const x={},I=function(M){return new Wv(M).readFields(MF,{})}(k);for(const M of I.glyphs)x[M.id]=M;g(null,{glyphs:x,ascender:I.ascender,descender:I.descender})}})},Uf.TinySDF=class{constructor({fontSize:u=24,buffer:n=3,radius:s=8,cutoff:h=.25,fontFamily:g="sans-serif",fontWeight:f="normal",fontStyle:_="normal"}={}){this.buffer=n,this.cutoff=h,this.radius=s;const S=this.size=u+4*n,A=this._createCanvas(S),k=this.ctx=A.getContext("2d",{willReadFrequently:!0});k.font=`${_} ${f} ${u}px ${g}`,k.textBaseline="alphabetic",k.textAlign="left",k.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(u){const n=document.createElement("canvas");return n.width=n.height=u,n}draw(u){const{width:n,actualBoundingBoxAscent:s,actualBoundingBoxDescent:h,actualBoundingBoxLeft:g,actualBoundingBoxRight:f}=this.ctx.measureText(u),_=Math.ceil(s),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-g))),A=Math.min(this.size-this.buffer,_+Math.ceil(h)),k=S+2*this.buffer,x=A+2*this.buffer,I=Math.max(k*x,0),M=new Uint8ClampedArray(I),C={data:M,width:k,height:x,glyphWidth:S,glyphHeight:A,glyphTop:_,glyphLeft:0,glyphAdvance:n};if(S===0||A===0)return C;const{ctx:P,buffer:O,gridInner:V,gridOuter:G}=this;P.clearRect(O,O,S,A),P.fillText(u,O,O+_);const J=P.getImageData(O,O,S,A);G.fill(ng,0,I),V.fill(0,0,I);for(let ee=0;ee<A;ee++)for(let H=0;H<S;H++){const se=J.data[4*(ee*S+H)+3]/255;if(se===0)continue;const ue=(ee+O)*k+H+O;if(se===1)G[ue]=0,V[ue]=ng;else{const we=.5-se;G[ue]=we>0?we*we:0,V[ue]=we<0?we*we:0}}qI(G,0,0,k,x,k,this.f,this.v,this.z),qI(V,O,O,S,A,k,this.f,this.v,this.z);for(let ee=0;ee<I;ee++){const H=Math.sqrt(G[ee])-Math.sqrt(V[ee]);M[ee]=Math.round(255-255*(H/this.radius+this.cutoff))}return C}};const Ou=tg;function ZI(u,n,s,h){const g=[],f=u.imagePrimary,_=f.pixelRatio,S=f.paddedRect.w-2*Ou,A=f.paddedRect.h-2*Ou,k=u.right-u.left,x=u.bottom-u.top,I=f.stretchX||[[0,S]],M=f.stretchY||[[0,A]],C=(je,Oe)=>je+Oe[1]-Oe[0],P=I.reduce(C,0),O=M.reduce(C,0),V=S-P,G=A-O;let J=0,ee=P,H=0,se=O,ue=0,we=V,Me=0,Re=G;if(f.content&&h){const je=f.content;J=Xv(I,0,je[0]),H=Xv(M,0,je[1]),ee=Xv(I,je[0],je[2]),se=Xv(M,je[1],je[3]),ue=je[0]-J,Me=je[1]-H,we=je[2]-je[0]-ee,Re=je[3]-je[1]-se}const Ce=(je,Oe,He,Qe)=>{const it=Yv(je.stretch-J,ee,k,u.left),ot=Kv(je.fixed-ue,we,je.stretch,P),ct=Yv(Oe.stretch-H,se,x,u.top),bt=Kv(Oe.fixed-Me,Re,Oe.stretch,O),ut=Yv(He.stretch-J,ee,k,u.left),Ot=Kv(He.fixed-ue,we,He.stretch,P),$t=Yv(Qe.stretch-H,se,x,u.top),It=Kv(Qe.fixed-Me,Re,Qe.stretch,O),En=new Ue(it,ct),mn=new Ue(ut,ct),an=new Ue(ut,$t),Wt=new Ue(it,$t),Vn=new Ue(ot/_,bt/_),Tn=new Ue(Ot/_,It/_),An=n*Math.PI/180;if(An){const _i=Math.sin(An),ir=Math.cos(An),ji=[ir,-_i,_i,ir];En._matMult(ji),mn._matMult(ji),Wt._matMult(ji),an._matMult(ji)}const Kn=je.stretch+je.fixed,ci=He.stretch+He.fixed,oi=Oe.stretch+Oe.fixed,si=Qe.stretch+Qe.fixed,pi=u.imageSecondary;return{tl:En,tr:mn,bl:Wt,br:an,texPrimary:{x:f.paddedRect.x+Ou+Kn,y:f.paddedRect.y+Ou+oi,w:ci-Kn,h:si-oi},texSecondary:pi?{x:pi.paddedRect.x+Ou+Kn,y:pi.paddedRect.y+Ou+oi,w:ci-Kn,h:si-oi}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Vn,pixelOffsetBR:Tn,minFontScaleX:we/_/k,minFontScaleY:Re/_/x,isSDF:s}};if(h&&(f.stretchX||f.stretchY)){const je=XI(I,V,P),Oe=XI(M,G,O);for(let He=0;He<je.length-1;He++){const Qe=je[He],it=je[He+1];for(let ot=0;ot<Oe.length-1;ot++)g.push(Ce(Qe,Oe[ot],it,Oe[ot+1]))}}else g.push(Ce({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:S+1},{fixed:0,stretch:A+1}));return g}function Xv(u,n,s){let h=0;for(const g of u)h+=Math.max(n,Math.min(s,g[1]))-Math.max(n,Math.min(s,g[0]));return h}function XI(u,n,s){const h=[{fixed:-Ou,stretch:0}];for(const[g,f]of u){const _=h[h.length-1];h.push({fixed:g-_.stretch,stretch:_.stretch}),h.push({fixed:g-_.stretch,stretch:_.stretch+(f-g)})}return h.push({fixed:n+Ou,stretch:s}),h}function Yv(u,n,s,h){return u/n*s+h}function Kv(u,n,s,h){return u-n*s/h}function FF(u,n,s,h){const g=n+u.positionedLines[h].lineOffset;return h===0?s+g/2:s+(g+(n+u.positionedLines[h-1].lineOffset))/2}function VF(u,n=1,s=!1){let h=1/0,g=1/0,f=-1/0,_=-1/0;const S=u[0];for(let C=0;C<S.length;C++){const P=S[C];(!C||P.x<h)&&(h=P.x),(!C||P.y<g)&&(g=P.y),(!C||P.x>f)&&(f=P.x),(!C||P.y>_)&&(_=P.y)}const A=Math.min(f-h,_-g);let k=A/2;const x=new Wp([],NF);if(A===0)return new Ue(h,g);for(let C=h;C<f;C+=A)for(let P=g;P<_;P+=A)x.push(new jf(C+k,P+k,k,u));let I=function(C){let P=0,O=0,V=0;const G=C[0];for(let J=0,ee=G.length,H=ee-1;J<ee;H=J++){const se=G[J],ue=G[H],we=se.x*ue.y-ue.x*se.y;O+=(se.x+ue.x)*we,V+=(se.y+ue.y)*we,P+=3*we}return new jf(O/P,V/P,0,C)}(u),M=x.length;for(;x.length;){const C=x.pop();(C.d>I.d||!I.d)&&(I=C,s&&console.log("found best %d after %d probes",Math.round(1e4*C.d)/1e4,M)),C.max-I.d<=n||(k=C.h/2,x.push(new jf(C.p.x-k,C.p.y-k,k,u)),x.push(new jf(C.p.x+k,C.p.y-k,k,u)),x.push(new jf(C.p.x-k,C.p.y+k,k,u)),x.push(new jf(C.p.x+k,C.p.y+k,k,u)),M+=4)}return s&&(console.log(`num probes: ${M}`),console.log(`best distance: ${I.d}`)),I.p}function NF(u,n){return n.max-u.max}class jf{constructor(n,s,h,g){this.p=new Ue(n,s),this.h=h,this.d=function(f,_){let S=!1,A=1/0;for(let k=0;k<_.length;k++){const x=_[k];for(let I=0,M=x.length,C=M-1;I<M;C=I++){const P=x[I],O=x[C];P.y>f.y!=O.y>f.y&&f.x<(O.x-P.x)*(f.y-P.y)/(O.y-P.y)+P.x&&(S=!S),A=Math.min(A,Hi(f,P,O))}}return(S?1:-1)*Math.sqrt(A)}(this.p,g),this.max=this.d+this.h*Math.SQRT2}}const Tx=Number.POSITIVE_INFINITY,UF=Math.sqrt(2);function YI(u,[n,s]){let h=0,g=0;if(s===Tx){n<0&&(n=0);const f=n/UF;switch(u){case"top-right":case"top-left":g=f-7;break;case"bottom-right":case"bottom-left":g=7-f;break;case"bottom":g=7-n;break;case"top":g=n-7}switch(u){case"top-right":case"bottom-right":h=-f;break;case"top-left":case"bottom-left":h=f;break;case"left":h=n;break;case"right":h=-n}}else{switch(n=Math.abs(n),s=Math.abs(s),u){case"top-right":case"top-left":case"top":g=s-7;break;case"bottom-right":case"bottom-left":case"bottom":g=7-s}switch(u){case"top-right":case"bottom-right":case"right":h=-n;break;case"top-left":case"bottom-left":case"left":h=n}}return[h,g]}function Ex(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function jF(u,n,s,h,g,f,_,S,A,k,x,I,M,C,P){let O=f.textMaxSize.evaluate(n,{},I);O===void 0&&(O=_);const V=u.layers[0].layout,G=V.get("icon-offset").evaluate(n,{},I),J=JI(s.horizontal)||s.vertical,ee=M.name==="globe",H=ds,se=_/H,ue=u.tilePixelRatio*O/H,we=(it=u.overscaling,u.zoom>18&&it>2&&(it>>=1),Math.max(_n/(512*it),1)*V.get("symbol-spacing")),Me=V.get("text-padding")*u.tilePixelRatio,Re=V.get("icon-padding")*u.tilePixelRatio,Ce=Gt(V.get("text-max-angle")),je=V.get("text-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",Oe=V.get("icon-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",He=V.get("symbol-placement"),Qe=we/2;var it;const ot=V.get("icon-text-fit").evaluate(n,{},I),ct=V.get("icon-text-fit-padding").evaluate(n,{},I),bt=ot!=="none";let ut;u.hasAnyIconTextFit===!1&&bt&&(u.hasAnyIconTextFit=!0),h&&bt&&(u.allowVerticalPlacement&&s.vertical&&(ut=BI(h,s.vertical,ot,ct,G,se)),J&&(h=BI(h,J,ot,ct,G,se)));const Ot=($t,It,En)=>{if(It.x<0||It.x>=_n||It.y<0||It.y>=_n)return;let mn=null;if(ee){const{x:an,y:Wt,z:Vn}=M.projectTilePoint(It.x,It.y,En);mn={anchor:new Bc(an,Wt,Vn,0,void 0),up:M.upVector(En,It.x,It.y)}}(function(an,Wt,Vn,Tn,An,Kn,ci,oi,si,pi,_i,ir,ji,Jn,Bi,Fi,_r,Jr,mo,Qr,Gr,Wo,yo,fs,hr,ma,Ll){const cl=an.addToLineVertexArray(Wt,Tn);let ul,Xh,Vu,Yh,bg,yA,bA,xA=0,wA=0,SA=0,TA=0,e1=-1,t1=-1;const sc={};let EA=to("");const Kh=Vn?Vn.anchor:Wt,n1=si.layout.get("icon-text-fit").evaluate(Gr,{},hr)!=="none";let i1=0,r1=0;if(si._unevaluatedLayout.getValue("text-radial-offset")===void 0?[i1,r1]=si.layout.get("text-offset").evaluate(Gr,{},hr).map(Pa=>Pa*ds):(i1=si.layout.get("text-radial-offset").evaluate(Gr,{},hr)*ds,r1=Tx),an.allowVerticalPlacement&&An.vertical){const Pa=An.vertical;if(Bi)yA=Ix(Pa),oi&&(bA=Ix(oi));else{const Ma=si.layout.get("text-rotate").evaluate(Gr,{},hr)+90;Vu=Jv(pi,Kh,Wt,_i,ir,ji,Pa,Jn,Ma,Fi),oi&&(Yh=Jv(pi,Kh,Wt,_i,ir,ji,oi,Jr,Ma))}}if(Kn){const Pa=si.layout.get("icon-rotate").evaluate(Gr,{},hr),Ma=ZI(Kn,Pa,yo,n1),Yf=oi?ZI(oi,Pa,yo,n1):void 0;Xh=Jv(pi,Kh,Wt,_i,ir,ji,Kn,Jr,Pa),xA=4*Ma.length;const IA=an.iconSizeData;let Jh=null;IA.kind==="source"?(Jh=[Ml*si.layout.get("icon-size").evaluate(Gr,{},hr)],Jh[0]>Lu&&ii(`${an.layerIds[0]}: Value for "icon-size" is >= ${ig}. Reduce your "icon-size".`)):IA.kind==="composite"&&(Jh=[Ml*Wo.compositeIconSizes[0].evaluate(Gr,{},hr),Ml*Wo.compositeIconSizes[1].evaluate(Gr,{},hr)],(Jh[0]>Lu||Jh[1]>Lu)&&ii(`${an.layerIds[0]}: Value for "icon-size" is >= ${ig}. Reduce your "icon-size".`)),an.addSymbols(an.icon,Ma,Jh,Qr,mo,Gr,!1,Vn,Wt,cl.lineStartIndex,cl.lineLength,-1,fs,hr,ma,Ll),e1=an.icon.placedSymbolArray.length-1,Yf&&(wA=4*Yf.length,an.addSymbols(an.icon,Yf,Jh,Qr,mo,Gr,Wa.vertical,Vn,Wt,cl.lineStartIndex,cl.lineLength,-1,fs,hr,ma,Ll),t1=an.icon.placedSymbolArray.length-1)}for(const Pa in An.horizontal){const Ma=An.horizontal[Pa];ul||(EA=to(Ma.text),Bi?bg=Ix(Ma):ul=Jv(pi,Kh,Wt,_i,ir,ji,Ma,Jn,si.layout.get("text-rotate").evaluate(Gr,{},hr),Fi));const Yf=Ma.positionedLines.length===1;if(SA+=KI(an,Vn,Wt,Ma,ci,si,Bi,Gr,Fi,cl,An.vertical?Wa.horizontal:Wa.horizontalOnly,Yf?Object.keys(An.horizontal):[Pa],sc,e1,Wo,fs,hr,ma),Yf)break}An.vertical&&(TA+=KI(an,Vn,Wt,An.vertical,ci,si,Bi,Gr,Fi,cl,Wa.vertical,["vertical"],sc,t1,Wo,fs,hr,ma));let Nu=-1;const o1=(Pa,Ma)=>Pa?Math.max(Pa,Ma):Ma;Nu=o1(bg,Nu),Nu=o1(yA,Nu),Nu=o1(bA,Nu);const iN=Nu>-1?1:0;an.glyphOffsetArray.length>=65535&&ii("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Gr.sortKey!==void 0&&an.addToSortKeyRanges(an.symbolInstances.length,Gr.sortKey),an.symbolInstances.emplaceBack(Wt.x,Wt.y,Kh.x,Kh.y,Kh.z,sc.right>=0?sc.right:-1,sc.center>=0?sc.center:-1,sc.left>=0?sc.left:-1,sc.vertical>=0?sc.vertical:-1,e1,t1,EA,ul!==void 0?ul:an.collisionBoxArray.length,ul!==void 0?ul+1:an.collisionBoxArray.length,Vu!==void 0?Vu:an.collisionBoxArray.length,Vu!==void 0?Vu+1:an.collisionBoxArray.length,Xh!==void 0?Xh:an.collisionBoxArray.length,Xh!==void 0?Xh+1:an.collisionBoxArray.length,Yh||an.collisionBoxArray.length,Yh?Yh+1:an.collisionBoxArray.length,_i,SA,TA,xA,wA,iN,0,i1,r1,Nu,0,n1?1:0)})(u,It,mn,$t,s,h,g,ut,u.layers[0],u.collisionBoxArray,n.index,n.sourceLayerIndex,u.index,Me,je,A,0,Re,Oe,G,n,f,k,x,I,C,P)};if(He==="line")for(const $t of $I(n.geometry,0,0,_n,_n)){const It=BF($t,we,Ce,s.vertical||J,h,H,ue,u.overscaling,_n);for(const En of It)J&&$F(u,J.text,Qe,En)||Ot($t,En,I)}else if(He==="line-center"){for(const $t of n.geometry)if($t.length>1){const It=zF($t,Ce,s.vertical||J,h,H,ue);It&&Ot($t,It,I)}}else if(n.type==="Polygon")for(const $t of Vv(n.geometry,0)){const It=VF($t,16);Ot($t[0],new Bc(It.x,It.y,0,0,void 0),I)}else if(n.type==="LineString")for(const $t of n.geometry)Ot($t,new Bc($t[0].x,$t[0].y,0,0,void 0),I);else if(n.type==="Point")for(const $t of n.geometry)for(const It of $t)Ot([It],new Bc(It.x,It.y,0,0,void 0),I)}const ig=255,Lu=ig*Ml;function KI(u,n,s,h,g,f,_,S,A,k,x,I,M,C,P,O,V,G){const J=function(se,ue,we,Me,Re,Ce,je,Oe){const He=[];if(ue.positionedLines.length===0)return He;const Qe=Me.layout.get("text-rotate").evaluate(Ce,{})*Math.PI/180,it=function(Ot){const $t=Ot[0],It=Ot[1],En=$t*It;return En>0?[$t,-It]:En<0?[-$t,It]:$t===0?[It,$t]:[It,-$t]}(we);let ot=Math.abs(ue.top-ue.bottom);for(const Ot of ue.positionedLines)ot-=Ot.lineOffset;const ct=ue.positionedLines.length,bt=ot/ct;let ut=ue.top-we[1];for(let Ot=0;Ot<ct;++Ot){const $t=ue.positionedLines[Ot];ut=FF(ue,bt,ut,Ot);for(const It of $t.positionedGlyphs){if(!It.rect)continue;const En=It.rect||{};let mn=kI+1,an=!0,Wt=1,Vn=0;if(It.imageName){const Qr=je[It.imageName];if(!Qr)continue;if(Qr.sdf){ii("SDF images are not supported in formatted text and will be ignored.");continue}an=!1,Wt=Qr.pixelRatio,mn=tg/Wt}const Tn=(Re||Oe)&&It.vertical,An=It.metrics.advance*It.scale/2,Kn=It.metrics,ci=It.rect;if(ci===null)continue;Oe&&ue.verticalizable&&(Vn=It.imageName?An-It.metrics.width*It.scale/2:0);const oi=Re?[It.x+An,It.y]:[0,0];let si=[0,0],pi=[0,0],_i=!1;Re||(Tn?(pi=[It.x+An+it[0],It.y+it[1]-Vn],_i=!0):si=[It.x+An+we[0],It.y+we[1]-Vn]);const ir=ci.w*It.scale/(Wt*(It.localGlyph?kl:1)),ji=ci.h*It.scale/(Wt*(It.localGlyph?kl:1));let Jn,Bi,Fi,_r;if(Tn){const Qr=It.y-ut,Gr=new Ue(-An,An-Qr),Wo=-Math.PI/2,yo=new Ue(...pi);Jn=new Ue(-An+si[0],si[1]),Jn._rotateAround(Wo,Gr)._add(yo),Jn.x+=-Qr+An,Jn.y-=(Kn.left-mn)*It.scale;const fs=It.imageName?Kn.advance*It.scale:ds*It.scale,hr=String.fromCodePoint(It.glyph);CF(hr)?Jn.x+=(1-mn)*It.scale:AF(hr)?Jn.x+=fs-Kn.height*It.scale+(-mn-1)*It.scale:Jn.x+=It.imageName||Kn.width+2*mn===ci.w&&Kn.height+2*mn===ci.h?(fs-ji)/2:(fs-(Kn.height+2*mn)*It.scale)/2,Bi=new Ue(Jn.x,Jn.y-ir),Fi=new Ue(Jn.x+ji,Jn.y),_r=new Ue(Jn.x+ji,Jn.y-ir)}else{const Qr=(Kn.left-mn)*It.scale-An+si[0],Gr=(-Kn.top-mn)*It.scale+si[1],Wo=Qr+ir,yo=Gr+ji;Jn=new Ue(Qr,Gr),Bi=new Ue(Wo,Gr),Fi=new Ue(Qr,yo),_r=new Ue(Wo,yo)}if(Qe){let Qr;Qr=Re?new Ue(0,0):_i?new Ue(it[0],it[1]):new Ue(we[0],we[1]),Jn._rotateAround(Qe,Qr),Bi._rotateAround(Qe,Qr),Fi._rotateAround(Qe,Qr),_r._rotateAround(Qe,Qr)}const Jr=new Ue(0,0),mo=new Ue(0,0);He.push({tl:Jn,tr:Bi,bl:Fi,br:_r,texPrimary:En,texSecondary:void 0,writingMode:ue.writingMode,glyphOffset:oi,sectionIndex:It.sectionIndex,isSDF:an,pixelOffsetTL:Jr,pixelOffsetBR:mo,minFontScaleX:0,minFontScaleY:0})}}return He}(0,h,A,f,_,S,g,u.allowVerticalPlacement),ee=u.textSizeData;let H=null;ee.kind==="source"?(H=[Ml*f.layout.get("text-size").evaluate(S,{},V)],H[0]>Lu&&ii(`${u.layerIds[0]}: Value for "text-size" is >= ${ig}. Reduce your "text-size".`)):ee.kind==="composite"&&(H=[Ml*P.compositeTextSizes[0].evaluate(S,{},V),Ml*P.compositeTextSizes[1].evaluate(S,{},V)],(H[0]>Lu||H[1]>Lu)&&ii(`${u.layerIds[0]}: Value for "text-size" is >= ${ig}. Reduce your "text-size".`)),u.addSymbols(u.text,J,H,A,_,S,x,n,s,k.lineStartIndex,k.lineLength,C,O,V,G,!1);for(const se of I)M[se]=u.text.placedSymbolArray.length-1;return 4*J.length}function JI(u){for(const n in u)return u[n];return null}function Jv(u,n,s,h,g,f,_,S,A,k){let x=_.top,I=_.bottom,M=_.left,C=_.right;const P=_.collisionPadding;if(P&&(M-=P[0],x-=P[1],C+=P[2],I+=P[3]),A){const O=new Ue(M,x),V=new Ue(C,x),G=new Ue(M,I),J=new Ue(C,I),ee=Gt(A);let H=new Ue(0,0);k&&(H=new Ue(k[0],k[1])),O._rotateAround(ee,H),V._rotateAround(ee,H),G._rotateAround(ee,H),J._rotateAround(ee,H),M=Math.min(O.x,V.x,G.x,J.x),C=Math.max(O.x,V.x,G.x,J.x),x=Math.min(O.y,V.y,G.y,J.y),I=Math.max(O.y,V.y,G.y,J.y)}return u.emplaceBack(n.x,n.y,n.z,s.x,s.y,M,x,C,I,S,h,g,f),u.length-1}function Ix(u){u.collisionPadding&&(u.top-=u.collisionPadding[1],u.bottom+=u.collisionPadding[3]);const n=u.bottom-u.top;return n>0?Math.max(10,n):null}function $F(u,n,s,h){const g=u.compareText;if(n in g){const f=g[n];for(let _=f.length-1;_>=0;_--)if(h.dist(f[_])<s)return!0}else g[n]=[];return g[n].push(h),!1}function QI(u,n){const s=u.fovAboveCenter,h=u.elevation?u.elevation.getMinElevationBelowMSL()*n:0,g=(u._camera.position[2]*u.worldSize-h)/Math.cos(u._pitch),f=Math.sin(s)*g/Math.sin(Math.max(Math.PI/2-u._pitch-s,.01));let _=Math.sin(u._pitch)*f+g;const S=g*(1/u._horizonShift);return u.elevation&&u.elevation.exaggeration()!==0||(_*=1+Math.max(u.zoom-17,0)),Math.min(1.01*_,S)}function rg(u,n){if(!n.isReprojectedInTileSpace)return{scale:1<<u.z,x:u.x,y:u.y,x2:u.x+1,y2:u.y+1,projection:n};const s=Math.pow(2,-u.z),h=u.x*s,g=(u.x+1)*s,f=u.y*s,_=(u.y+1)*s,S=Fe(h),A=Fe(g),k=ze(f),x=ze(_),I=n.project(S,k),M=n.project(A,k),C=n.project(A,x),P=n.project(S,x);let O=Math.min(I.x,M.x,C.x,P.x),V=Math.min(I.y,M.y,C.y,P.y),G=Math.max(I.x,M.x,C.x,P.x),J=Math.max(I.y,M.y,C.y,P.y);const ee=s/16;function H(ue,we,Me,Re,Ce,je){const Oe=(Me+Ce)/2,He=(Re+je)/2,Qe=n.project(Fe(Oe),ze(He)),it=Math.max(0,O-Qe.x,V-Qe.y,Qe.x-G,Qe.y-J);O=Math.min(O,Qe.x),G=Math.max(G,Qe.x),V=Math.min(V,Qe.y),J=Math.max(J,Qe.y),it>ee&&(H(ue,Qe,Me,Re,Oe,He),H(Qe,we,Oe,He,Ce,je))}H(I,M,h,f,g,f),H(M,C,g,f,g,_),H(C,P,g,_,h,_),H(P,I,h,_,h,f),O-=ee,V-=ee,G+=ee,J+=ee;const se=1/Math.max(G-O,J-V);return{scale:se,x:O*se,y:V*se,x2:G*se,y2:J*se,projection:n}}function eC(u,{x:n,y:s},h=0){return new Ue(((n-h)*u.scale-u.x)*_n,(s*u.scale-u.y)*_n)}const GF=Ie.mat4.identity(new Float32Array(16));class zu{constructor(n){this.spec=n,this.name=n.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(n,s){return{x:0,y:0,z:0}}unproject(n,s){return new Q(0,0)}projectTilePoint(n,s,h){return{x:n,y:s,z:0}}locationPoint(n,s,h=!0){return n._coordinatePoint(n.locationCoordinate(s),h)}pixelsPerMeter(n,s){return Pe(1,n)*s}pixelSpaceConversion(n,s,h){return 1}farthestPixelDistance(n){return QI(n,n.pixelsPerMeter)}pointCoordinate(n,s,h,g){const f=n.horizonLineFromTop(!1),_=new Ue(s,Math.max(f,h));return n.rayIntersectionCoordinate(n.pointRayIntersection(_,g))}pointCoordinate3D(n,s,h){const g=new Ue(s,h);if(n.elevation)return n.elevation.pointCoordinate(g);{const f=this.pointCoordinate(n,g.x,g.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(n,s){if(n.elevation&&n.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(n,s.x,s.y);const h=n.horizonLineFromTop();return s.y<h}createInversionMatrix(n,s){return GF}createTileMatrix(n,s,h){let g,f,_;const S=h.canonical,A=Ie.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const k=rg(S,this);g=1,f=k.x+h.wrap*k.scale,_=k.y,Ie.mat4.scale(A,A,[g/k.scale,g/k.scale,n.pixelsPerMeter/s])}else g=s/n.zoomScale(S.z),f=(S.x+Math.pow(2,S.z)*h.wrap)*g,_=S.y*g;return Ie.mat4.translate(A,A,[f,_,0]),Ie.mat4.scale(A,A,[g/_n,g/_n,1]),A}upVector(n,s,h){return[0,0,1]}upVectorScale(n,s,h){return{metersToTile:1}}}class HF extends zu{constructor(n){super(n),this.range=[4,7],this.center=n.center||[-96,37.5];const[s,h]=this.parallels=n.parallels||[29.5,45.5],g=Math.sin(Gt(s));this.n=(g+Math.sin(Gt(h)))/2,this.c=1+g*(2*this.n-g),this.r0=Math.sqrt(this.c)/this.n}project(n,s){const{n:h,c:g,r0:f}=this,_=Gt(n-this.center[0]),S=Gt(s),A=Math.sqrt(g-2*h*Math.sin(S))/h;return{x:A*Math.sin(_*h),y:A*Math.cos(_*h)-f,z:0}}unproject(n,s){const{n:h,c:g,r0:f}=this,_=f+s;let S=Math.atan2(n,Math.abs(_))*Math.sign(_);_*h<0&&(S-=Math.PI*Math.sign(n)*Math.sign(_));const A=Gt(this.center[0])*h;S=ti(S,-Math.PI-A,Math.PI-A);const k=hn(Yt(S/h)+this.center[0],-180,180),x=Math.asin(hn((g-(n*n+_*_)*h*h)/(2*h),-1,1)),I=hn(Yt(x),-$e,$e);return new Q(k,I)}}const og=1.340264,sg=-.081106,ag=893e-6,lg=.003796,Qv=Math.sqrt(3)/2;class qF extends zu{project(n,s){s=s/180*Math.PI,n=n/180*Math.PI;const h=Math.asin(Qv*Math.sin(s)),g=h*h,f=g*g*g;return{x:.5*(n*Math.cos(h)/(Qv*(og+3*sg*g+f*(7*ag+9*lg*g)))/Math.PI+.5),y:1-.5*(h*(og+sg*g+f*(ag+lg*g))/Math.PI+1),z:0}}unproject(n,s){n=(2*n-.5)*Math.PI;let h=s=(2*(1-s)-1)*Math.PI,g=h*h,f=g*g*g;for(let x,I,M,C=0;C<12&&(I=h*(og+sg*g+f*(ag+lg*g))-s,M=og+3*sg*g+f*(7*ag+9*lg*g),x=I/M,h=hn(h-x,-Math.PI/3,Math.PI/3),g=h*h,f=g*g*g,!(Math.abs(x)<1e-12));++C);const _=Qv*n*(og+3*sg*g+f*(7*ag+9*lg*g))/Math.cos(h),S=Math.asin(Math.sin(h)/Qv),A=hn(180*_/Math.PI,-180,180),k=hn(180*S/Math.PI,-$e,$e);return new Q(A,k)}}class WF extends zu{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0}project(n,s){return{x:.5+n/360,y:.5-s/360,z:0}}unproject(n,s){const h=360*(n-.5),g=hn(360*(.5-s),-$e,$e);return new Q(h,g)}}const $f=Math.PI/2;function ey(u){return Math.tan(($f+u)/2)}class ZF extends zu{constructor(n){super(n),this.center=n.center||[0,30];const[s,h]=this.parallels=n.parallels||[30,30];let g=Gt(s),f=Gt(h);this.southernCenter=g+f<0,this.southernCenter&&(g=-g,f=-f);const _=Math.cos(g),S=ey(g);this.n=g===f?Math.sin(g):Math.log(_/Math.cos(f))/Math.log(ey(f)/S),this.f=_*Math.pow(ey(g),this.n)/this.n}project(n,s){s=Gt(s),this.southernCenter&&(s=-s),n=Gt(n-this.center[0]);const h=1e-6,{n:g,f}=this;f>0?s<-$f+h&&(s=-$f+h):s>$f-h&&(s=$f-h);const _=f/Math.pow(ey(s),g);let S=_*Math.sin(g*n),A=f-_*Math.cos(g*n);return S=.5*(S/Math.PI+.5),A=.5*(A/Math.PI+.5),{x:S,y:this.southernCenter?A:1-A,z:0}}unproject(n,s){n=(2*n-.5)*Math.PI,this.southernCenter&&(s=1-s),s=(2*(1-s)-.5)*Math.PI;const{n:h,f:g}=this,f=g-s,_=Math.sign(f),S=Math.sign(h)*Math.sqrt(n*n+f*f);let A=Math.atan2(n,Math.abs(f))*_;f*h<0&&(A-=Math.PI*Math.sign(n)*_);const k=hn(Yt(A/h)+this.center[0],-180,180),x=hn(Yt(2*Math.atan(Math.pow(g/S,1/h))-$f),-$e,$e);return new Q(k,this.southernCenter?-x:x)}}class tC extends zu{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(n,s){return{x:ke(n),y:De(s),z:0}}unproject(n,s){const h=Fe(n),g=ze(s);return new Q(h,g)}}const nC=Gt($e);class XF extends zu{project(n,s){const h=(s=Gt(s))*s,g=h*h;return{x:.5*((n=Gt(n))*(.8707-.131979*h+g*(g*(.003971*h-.001529*g)-.013791))/Math.PI+.5),y:1-.5*(s*(1.007226+h*(.015085+g*(.028874*h-.044475-.005916*g)))/Math.PI+1),z:0}}unproject(n,s){n=(2*n-.5)*Math.PI;let h=s=(2*(1-s)-1)*Math.PI,g=25,f=0,_=h*h;do{_=h*h;const k=_*_;f=(h*(1.007226+_*(.015085+k*(.028874*_-.044475-.005916*k)))-s)/(1.007226+_*(.045255+k*(.259866*_-.311325-.005916*11*k))),h=hn(h-f,-nC,nC)}while(Math.abs(f)>1e-6&&--g>0);_=h*h;const S=hn(Yt(n/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),A=Yt(h);return new Q(S,A)}}const iC=Gt($e);class YF extends zu{project(n,s){s=Gt(s),n=Gt(n);const h=Math.cos(s),g=2/Math.PI,f=Math.acos(h*Math.cos(n/2)),_=Math.sin(f)/f,S=.5*(n*g+2*h*Math.sin(n/2)/_)||0,A=.5*(s+Math.sin(s)/_)||0;return{x:.5*(S/Math.PI+.5),y:1-.5*(A/Math.PI+1),z:0}}unproject(n,s){let h=n=(2*n-.5)*Math.PI,g=s=(2*(1-s)-1)*Math.PI,f=25;const _=1e-6;let S=0,A=0;do{const k=Math.cos(g),x=Math.sin(g),I=2*x*k,M=x*x,C=k*k,P=Math.cos(h/2),O=Math.sin(h/2),V=2*P*O,G=O*O,J=1-C*P*P,ee=J?1/J:0,H=J?Math.acos(k*P)*Math.sqrt(1/J):0,se=.5*(2*H*k*O+2*h/Math.PI)-n,ue=.5*(H*x+g)-s,we=.5*ee*(C*G+H*k*P*M)+1/Math.PI,Me=ee*(V*I/4-H*x*O),Re=.125*ee*(I*O-H*x*C*V),Ce=.5*ee*(M*P+H*G*k)+.5,je=Me*Re-Ce*we;S=(ue*Me-se*Ce)/je,A=(se*Re-ue*we)/je,h=hn(h-S,-Math.PI,Math.PI),g=hn(g-A,-iC,iC)}while((Math.abs(S)>_||Math.abs(A)>_)&&--f>0);return new Q(Yt(h),Yt(g))}}class rC extends zu{constructor(n){super(n),this.center=n.center||[0,0],this.parallels=n.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Gt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(n,s){const{scale:h,cosPhi:g}=this;return{x:Gt(n)*g*h+.5,y:-Math.sin(Gt(s))/g*h+.5,z:0}}unproject(n,s){const{scale:h,cosPhi:g}=this,f=-(s-.5)/h,_=hn(Yt((n-.5)/h)/g,-180,180),S=Math.asin(hn(f*g,-1,1)),A=hn(Yt(S),-$e,$e);return new Q(_,A)}}class KF extends tC{constructor(n){super(n),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(n,s,h){const g=jm(n,s,h),f=Lv(rc(h));return Ie.vec3.transformMat4(g,g,f),{x:g[0],y:g[1],z:g[2]}}locationPoint(n,s){const h=j(s.lat,s.lng),g=Ie.vec3.normalize([],h),f=n.elevation?n.elevation.getAtPointOrZero(n.locationCoordinate(s),n._centerAltitude):n._centerAltitude,_=Pe(1,0)*_n*f;Ie.vec3.scaleAndAdd(h,h,g,_);const S=Ie.mat4.identity(new Float64Array(16));return Ie.mat4.multiply(S,n.pixelMatrix,n.globeMatrix),Ie.vec3.transformMat4(h,h,S),new Ue(h[0],h[1])}pixelsPerMeter(n,s){return Pe(1,0)*s}pixelSpaceConversion(n,s,h){const g=Pe(1,n)*s,f=In(Pe(1,45)*s,g,h);return this.pixelsPerMeter(n,s)/f}createTileMatrix(n,s,h){const g=Yb(rc(h.canonical));return Ie.mat4.multiply(new Float64Array(16),n.globeMatrix,g)}createInversionMatrix(n,s){const{center:h}=n,g=Lv(rc(s));return Ie.mat4.rotateY(g,g,Gt(h.lng)),Ie.mat4.rotateX(g,g,Gt(h.lat)),Ie.mat4.scale(g,g,[n._pixelsPerMercatorPixel,n._pixelsPerMercatorPixel,1]),Float32Array.from(g)}pointCoordinate(n,s,h,g){return Rv(n,s,h,!0)||new ft(0,0)}pointCoordinate3D(n,s,h){const g=this.pointCoordinate(n,s,h,0);return[g.x,g.y,g.z]}isPointAboveHorizon(n,s){return!Rv(n,s.x,s.y,!1)}farthestPixelDistance(n){const s=function(g,f){const _=g.cameraToCenterDistance,S=g._centerAltitude*f,A=g._camera,k=g._camera.forward(),x=Ie.vec3.add([],Ie.vec3.scale([],k,-_),[0,0,S]),I=g.worldSize/(2*Math.PI),M=[0,0,-I],C=g.width/g.height,P=Math.tan(g.fovAboveCenter),O=Ie.vec3.scale([],A.up(),P),V=Ie.vec3.scale([],A.right(),P*C),G=Ie.vec3.normalize([],Ie.vec3.add([],Ie.vec3.add([],k,O),V)),J=[];let ee;if(new Pl(x,G).closestPointOnSphere(M,I,J)){const H=Ie.vec3.add([],J,M),se=Ie.vec3.sub([],H,x);ee=Math.cos(g.fovAboveCenter)*Ie.vec3.length(se)}else{const H=Ie.vec3.sub([],x,M),se=Ie.vec3.sub([],M,x);Ie.vec3.normalize(se,se);const ue=Ie.vec3.length(H)-I;ee=Math.sqrt(ue*(ue+2*I));const we=Math.acos(ee/(I+ue))-Math.acos(Ie.vec3.dot(k,se));ee*=Math.cos(we)}return 1.01*ee}(n,this.pixelsPerMeter(n.center.lat,n.worldSize)),h=ku(n.zoom);if(h>0){const g=QI(n,Pe(1,n.center.lat)*n.worldSize),f=n.worldSize/(2*Math.PI),_=Math.max(n.width,n.height)/n.worldSize*Math.PI;return In(s,g+f*(1-Math.cos(_)),Math.pow(h,10))}return s}upVector(n,s,h){return jm(s,h,n,1)}upVectorScale(n){return{metersToTile:Lc(Ov(rc(n)))}}}function oC(u){const n=u.parallels,s=!!n&&Math.abs(n[0]+n[1])<.01;switch(u.name){case"mercator":return new tC(u);case"equirectangular":return new WF(u);case"naturalEarth":return new XF(u);case"equalEarth":return new qF(u);case"winkelTripel":return new YF(u);case"albers":return s?new rC(u):new HF(u);case"lambertConformalConic":return s?new rC(u):new ZF(u);case"globe":return new KF(u)}throw new Error(`Invalid projection name: ${u.name}`)}const JF=Ff.VectorTileFeature.types,QF=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ty(u,n,s,h,g,f,_,S,A,k,x,I,M){const C=S?Math.min(Lu,Math.round(S[0])):0,P=S?Math.min(Lu,Math.round(S[1])):0;u.emplaceBack(n,s,Math.round(32*h),Math.round(32*g),f,_,(C<<1)+(A?1:0),P,16*k,16*x,256*I,256*M)}function ny(u,n,s){u.emplaceBack(n,s)}function iy(u,n,s,h,g,f,_){u.emplaceBack(n,s,h,g,f,_)}function ry(u,n,s,h,g){u.emplaceBack(n,s,h,g),u.emplaceBack(n,s,h,g),u.emplaceBack(n,s,h,g),u.emplaceBack(n,s,h,g)}function eV(u){for(const n of u.sections)if(Rb(n.text))return!0;return!1}class Cx{constructor(n){this.layoutVertexArray=new Am,this.indexArray=new ss,this.programConfigurations=n,this.segments=new Wr,this.dynamicLayoutVertexArray=new El,this.opacityVertexArray=new Mm,this.placedSymbolArray=new Lm,this.iconTransitioningVertexArray=new tc,this.globeExtVertexArray=new Pm,this.zOffsetVertexArray=new Eu}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(n,s,h,g,f){this.isEmpty()||(h&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,_F.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,yF.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,QF,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=n.createVertexBuffer(this.iconTransitioningVertexArray,xF.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,vF.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||f)&&(this.zOffsetVertexBuffer=n.createVertexBuffer(this.zOffsetVertexArray,bF.members,!0)),this.opacityVertexBuffer.itemSize=1),(h||g)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Pn(Cx,"SymbolBuffers");class Ax{constructor(n,s,h){this.layoutVertexArray=new n,this.layoutAttributes=s,this.indexArray=new h,this.segments=new Wr,this.collisionVertexArray=new Tu,this.collisionVertexArrayExt=new El}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,wF.members,!0),this.collisionVertexBufferExt=n.createVertexBuffer(this.collisionVertexArrayExt,SF.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Pn(Ax,"CollisionBuffers");class oy{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.lut=n.lut,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(_=>_.fqid),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ie.mat4.identity([]),this.placementViewportMatrix=Ie.mat4.identity([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=gx(this.zoom,s["text-size"]),this.iconSizeData=gx(this.zoom,s["icon-size"]);const h=this.layers[0].layout,g=h.get("symbol-sort-key"),f=h.get("symbol-z-order");this.canOverlap=h.get("text-allow-overlap")||h.get("icon-allow-overlap")||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&g.constantOr(1)!==void 0,this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=h.get("text-writing-mode").map(_=>Wa[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=n.sourceID,this.projection=n.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=h.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new Cx(new nc(this.layers,{zoom:this.zoom,lut:this.lut},n=>n.startsWith("text")||n.startsWith("symbol"))),this.icon=new Cx(new nc(this.layers,{zoom:this.zoom,lut:this.lut},n=>n.startsWith("icon")||n.startsWith("symbol"))),this.glyphOffsetArray=new Sv,this.lineVertexArray=new Df,this.symbolInstances=new zm}calculateGlyphDependencies(n,s,h,g,f){for(let _=0;_<n.length;_++){const S=n.codePointAt(_);if(S===void 0)break;if(s[S]=!0,g&&f&&S<=65535){const A=Qm[n.charAt(_)];A&&(s[A.charCodeAt(0)]=!0)}}}updateFootprints(n,s){}updateReplacement(n,s){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;const h=s.getReplacementRegionsForTile(n.toUnwrapped(),!0);return!ux(this.activeReplacements,h)&&(this.activeReplacements=h,!0)}populate(n,s,h,g){const f=this.layers[0],_=f.layout,S=this.projection.name==="globe",A=_.get("text-font"),k=_.get("text-field"),x=_.get("icon-image"),I=(k.value.kind!=="constant"||k.value.value instanceof $i&&!k.value.value.isEmpty()||k.value.value.toString().length>0)&&(A.value.kind!=="constant"||A.value.value.length>0),M=x.value.kind!=="constant"||!!x.value.value||Object.keys(x.parameters).length>0,C=_.get("symbol-sort-key");if(this.features=[],!I&&!M)return;const P=s.iconDependencies,O=s.glyphDependencies,V=s.availableImages,G=new qr(this.zoom);for(const{feature:J,id:ee,index:H,sourceLayerIndex:se}of n){const ue=f._featureFilter.needGeometry,we=ln(J,ue);if(!f._featureFilter.filter(G,we,h))continue;if(ue||(we.geometry=sn(J,h,g)),S&&J.type!==1&&h.z<=5){const je=we.geometry,Oe=.98078528056,He=(Qe,it)=>{const ot=jm(Qe.x,Qe.y,h,1),ct=jm(it.x,it.y,h,1);return Ie.vec3.dot(ot,ct)<Oe};for(let Qe=0;Qe<je.length;Qe++)je[Qe]=nn(je[Qe],He)}let Me,Re;if(I){const je=f.getValueAndResolveTokens("text-field",we,h,V),Oe=$i.factory(je);eV(Oe)&&(this.hasRTLText=!0),(!this.hasRTLText||wm()==="unavailable"||this.hasRTLText&&Gs.isParsed())&&(Me=IF(Oe,f,we))}if(M){const je=f.getValueAndResolveTokens("icon-image",we,h,V);Re=je instanceof er?je:er.fromString(je)}if(!Me&&!Re)continue;const Ce=this.sortFeaturesByKey?C.evaluate(we,{},h):void 0;if(this.features.push({id:ee,text:Me,icon:Re,index:H,sourceLayerIndex:se,geometry:we.geometry,properties:J.properties,type:JF[J.type],sortKey:Ce}),Re&&(P[Re.namePrimary]=!0,Re.nameSecondary&&(P[Re.nameSecondary]=!0)),Me){const je=A.evaluate(we,{},h).join(","),Oe=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Wa.vertical)>=0;for(const He of Me.sections)if(He.image)P[He.image.namePrimary]=!0;else{const Qe=_f(Me.toString()),it=He.fontStack||je,ot=O[it]=O[it]||{};this.calculateGlyphDependencies(He.text,ot,Oe,this.allowVerticalPlacement,Qe)}}}_.get("symbol-placement")==="line"&&(this.features=function(J){const ee={},H={},se=[];let ue=0;function we(je){se.push(J[je]),ue++}function Me(je,Oe,He){const Qe=H[je];return delete H[je],H[Oe]=Qe,se[Qe].geometry[0].pop(),se[Qe].geometry[0]=se[Qe].geometry[0].concat(He[0]),Qe}function Re(je,Oe,He){const Qe=ee[Oe];return delete ee[Oe],ee[je]=Qe,se[Qe].geometry[0].shift(),se[Qe].geometry[0]=He[0].concat(se[Qe].geometry[0]),Qe}function Ce(je,Oe,He){const Qe=He?Oe[0][Oe[0].length-1]:Oe[0][0];return`${je}:${Qe.x}:${Qe.y}`}for(let je=0;je<J.length;je++){const Oe=J[je],He=Oe.geometry,Qe=Oe.text?Oe.text.toString():null;if(!Qe){we(je);continue}const it=Ce(Qe,He),ot=Ce(Qe,He,!0);if(it in H&&ot in ee&&H[it]!==ee[ot]){const ct=Re(it,ot,He),bt=Me(it,ot,se[ct].geometry);delete ee[it],delete H[ot],H[Ce(Qe,se[bt].geometry,!0)]=bt,se[ct].geometry=null}else it in H?Me(it,ot,He):ot in ee?Re(it,ot,He):(we(je),ee[it]=ue-1,H[ot]=ue-1)}return se.filter(je=>je.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((J,ee)=>J.sortKey-ee.sortKey)}update(n,s,h,g,f){const _=Object.keys(n).length!==0;if(_&&!this.stateDependentLayers.length)return;const S=_?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(n,s,S,h,g,f),this.icon.programConfigurations.updatePaintArrays(n,s,S,h,g,f)}updateZOffset(){const n=(f,_,S)=>{h+=_,h>f.length&&f.resize(h);for(let A=-_;A<0;A++)f.emplace(A+h,S)},s=(f,_,S)=>{g+=_,g>f.length&&f.resize(g);for(let A=-_;A<0;A++)f.emplace(A+g,S)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let h=0,g=0;for(let f=0;f<this.symbolInstances.length;f++){const _=this.symbolInstances.get(f),{numHorizontalGlyphVertices:S,numVerticalGlyphVertices:A,numIconVertices:k}=_,x=_.zOffset,I=k>0;if((S>0||A>0)&&(n(this.text.zOffsetVertexArray,S,x),n(this.text.zOffsetVertexArray,A,x)),I){const{placedIconSymbolIndex:M,verticalPlacedIconSymbolIndex:C}=_;M>=0&&s(this.icon.zOffsetVertexArray,k,x),C>=0&&s(this.icon.zOffsetVertexArray,_.numVerticalIconVertices,x)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=oC(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,s){const h=this.lineVertexArray.length;if(n.segment!==void 0)for(const{x:g,y:f}of s)this.lineVertexArray.emplaceBack(g,f);return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(n,s,h,g,f,_,S,A,k,x,I,M,C,P,O,V){const G=n.indexArray,J=n.layoutVertexArray,ee=n.globeExtVertexArray,H=n.segments.prepareSegment(4*s.length,J,G,this.canOverlap?_.sortKey:void 0),se=this.glyphOffsetArray.length,ue=H.vertexLength,we=this.allowVerticalPlacement&&S===Wa.vertical?Math.PI/2:0,Me=_.text&&_.text.sections;for(let Ce=0;Ce<s.length;Ce++){const{tl:je,tr:Oe,bl:He,br:Qe,texPrimary:it,texSecondary:ot,pixelOffsetTL:ct,pixelOffsetBR:bt,minFontScaleX:ut,minFontScaleY:Ot,glyphOffset:$t,isSDF:It,sectionIndex:En}=s[Ce],mn=H.vertexLength,an=$t[1];if(ty(J,k.x,k.y,je.x,an+je.y,it.x,it.y,h,It,ct.x,ct.y,ut,Ot),ty(J,k.x,k.y,Oe.x,an+Oe.y,it.x+it.w,it.y,h,It,bt.x,ct.y,ut,Ot),ty(J,k.x,k.y,He.x,an+He.y,it.x,it.y+it.h,h,It,ct.x,bt.y,ut,Ot),ty(J,k.x,k.y,Qe.x,an+Qe.y,it.x+it.w,it.y+it.h,h,It,bt.x,bt.y,ut,Ot),A){const{x:Wt,y:Vn,z:Tn}=A.anchor,[An,Kn,ci]=A.up;iy(ee,Wt,Vn,Tn,An,Kn,ci),iy(ee,Wt,Vn,Tn,An,Kn,ci),iy(ee,Wt,Vn,Tn,An,Kn,ci),iy(ee,Wt,Vn,Tn,An,Kn,ci),ry(n.dynamicLayoutVertexArray,Wt,Vn,Tn,we)}else ry(n.dynamicLayoutVertexArray,k.x,k.y,k.z,we);if(V){const Wt=ot||it;ny(n.iconTransitioningVertexArray,Wt.x,Wt.y),ny(n.iconTransitioningVertexArray,Wt.x+Wt.w,Wt.y),ny(n.iconTransitioningVertexArray,Wt.x,Wt.y+Wt.h),ny(n.iconTransitioningVertexArray,Wt.x+Wt.w,Wt.y+Wt.h)}G.emplaceBack(mn,mn+1,mn+2),G.emplaceBack(mn+1,mn+2,mn+3),H.vertexLength+=4,H.primitiveLength+=2,this.glyphOffsetArray.emplaceBack($t[0]),Ce!==s.length-1&&En===s[Ce+1].sectionIndex||n.programConfigurations.populatePaintArrays(J.length,_,_.index,{},C,P,O,Me&&Me[En])}const Re=A?A.anchor:k;n.placedSymbolArray.emplaceBack(Re.x,Re.y,Re.z,k.x,k.y,se,this.glyphOffsetArray.length-se,ue,x,I,k.segment,h?h[0]:0,h?h[1]:0,g[0],g[1],S,0,!1,0,M,0)}_commitLayoutVertex(n,s,h,g,f,_,S){n.emplaceBack(s,h,g,f,_,Math.round(S.x),Math.round(S.y))}_addCollisionDebugVertices(n,s,h,g,f,_,S){const A=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),k=A.vertexLength,x=S.tileAnchorX,I=S.tileAnchorY;for(let C=0;C<4;C++)h.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(h.collisionVertexArrayExt,s,n.padding,S.zOffset),this._commitLayoutVertex(h.layoutVertexArray,g,f,_,x,I,new Ue(n.x1,n.y1)),this._commitLayoutVertex(h.layoutVertexArray,g,f,_,x,I,new Ue(n.x2,n.y1)),this._commitLayoutVertex(h.layoutVertexArray,g,f,_,x,I,new Ue(n.x2,n.y2)),this._commitLayoutVertex(h.layoutVertexArray,g,f,_,x,I,new Ue(n.x1,n.y2)),A.vertexLength+=4;const M=h.indexArray;M.emplaceBack(k,k+1),M.emplaceBack(k+1,k+2),M.emplaceBack(k+2,k+3),M.emplaceBack(k+3,k),A.primitiveLength+=4}_addTextDebugCollisionBoxes(n,s,h,g,f,_){for(let S=g;S<f;S++){const A=h.get(S),k=this.getSymbolInstanceTextSize(n,_,s,S);this._addCollisionDebugVertices(A,k,this.textCollisionBox,A.projectedAnchorX,A.projectedAnchorY,A.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(n,s,h,g,f,_){for(let S=g;S<f;S++){const A=h.get(S),k=this.getSymbolInstanceIconSize(n,s,_.placedIconSymbolIndex);this._addCollisionDebugVertices(A,k,this.iconCollisionBox,A.projectedAnchorX,A.projectedAnchorY,A.projectedAnchorZ,_)}}generateCollisionDebugBuffers(n,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ax(Rc,CI.members,tc),this.iconCollisionBox=new Ax(Rc,CI.members,tc);const h=Vf(this.iconSizeData,n),g=Vf(this.textSizeData,n);for(let f=0;f<this.symbolInstances.length;f++){const _=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(g,n,s,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(g,n,s,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(h,n,s,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(h,n,s,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(n,s,h,g){const f=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:g),_=qv(this.textSizeData,n,f)/ds;return this.tilePixelRatio*_}getSymbolInstanceIconSize(n,s,h){const g=this.icon.placedSymbolArray.get(h),f=qv(this.iconSizeData,n,g);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(n,s,h,g){n.emplaceBack(s,-h,-h,g),n.emplaceBack(s,h,-h,g),n.emplaceBack(s,h,h,g),n.emplaceBack(s,-h,h,g)}_updateTextDebugCollisionBoxes(n,s,h,g,f,_){for(let S=g;S<f;S++){const A=h.get(S),k=this.getSymbolInstanceTextSize(n,_,s,S);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,k,A.padding,_.zOffset)}}_updateIconDebugCollisionBoxes(n,s,h,g,f,_){for(let S=g;S<f;S++){const A=h.get(S),k=this.getSymbolInstanceIconSize(n,s,_.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,k,A.padding,_.zOffset)}}updateCollisionDebugBuffers(n,s){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const h=Vf(this.iconSizeData,n),g=Vf(this.textSizeData,n);for(let f=0;f<this.symbolInstances.length;f++){const _=this.symbolInstances.get(f);this._updateTextDebugCollisionBoxes(g,n,s,_.textBoxStartIndex,_.textBoxEndIndex,_),this._updateTextDebugCollisionBoxes(g,n,s,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._updateIconDebugCollisionBoxes(h,n,s,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._updateIconDebugCollisionBoxes(h,n,s,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(n,s,h,g,f,_,S,A,k){const x={};if(s<h){const{x1:I,y1:M,x2:C,y2:P,padding:O,projectedAnchorX:V,projectedAnchorY:G,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:H,featureIndex:se}=n.get(s);x.textBox={x1:I,y1:M,x2:C,y2:P,padding:O,projectedAnchorX:V,projectedAnchorY:G,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:H},x.textFeatureIndex=se}if(g<f){const{x1:I,y1:M,x2:C,y2:P,padding:O,projectedAnchorX:V,projectedAnchorY:G,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:H,featureIndex:se}=n.get(g);x.verticalTextBox={x1:I,y1:M,x2:C,y2:P,padding:O,projectedAnchorX:V,projectedAnchorY:G,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:H},x.verticalTextFeatureIndex=se}if(_<S){const{x1:I,y1:M,x2:C,y2:P,padding:O,projectedAnchorX:V,projectedAnchorY:G,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:H,featureIndex:se}=n.get(_);x.iconBox={x1:I,y1:M,x2:C,y2:P,padding:O,projectedAnchorX:V,projectedAnchorY:G,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:H},x.iconFeatureIndex=se}if(A<k){const{x1:I,y1:M,x2:C,y2:P,padding:O,projectedAnchorX:V,projectedAnchorY:G,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:H,featureIndex:se}=n.get(A);x.verticalIconBox={x1:I,y1:M,x2:C,y2:P,padding:O,projectedAnchorX:V,projectedAnchorY:G,projectedAnchorZ:J,tileAnchorX:ee,tileAnchorY:H},x.verticalIconFeatureIndex=se}return x}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const h=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(n,s){const h=n.placedSymbolArray.get(s),g=h.vertexStartIndex+4*h.numGlyphs;for(let f=h.vertexStartIndex;f<g;f+=4)n.indexArray.emplaceBack(f,f+1,f+2),n.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(n),h=Math.cos(n),g=[],f=[],_=[];for(let S=0;S<this.symbolInstances.length;++S){_.push(S);const A=this.symbolInstances.get(S);g.push(0|Math.round(s*A.tileAnchorX+h*A.tileAnchorY)),f.push(A.featureIndex)}return _.sort((S,A)=>g[S]-g[A]||f[A]-f[S]),_}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let n=0;n<this.symbolInstances.length;++n)this.symbolInstanceIndexesSortedZOffset.push(n)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((n,s)=>this.symbolInstances.get(s).zOffset-this.symbolInstances.get(n).zOffset)}addToSortKeyRanges(n,s){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===s?h.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const h=this.symbolInstances.get(s);this.featureSortOrder.push(h.featureIndex);const{rightJustifiedTextSymbolIndex:g,centerJustifiedTextSymbolIndex:f,leftJustifiedTextSymbolIndex:_,verticalPlacedTextSymbolIndex:S,placedIconSymbolIndex:A,verticalPlacedIconSymbolIndex:k}=h;g>=0&&this.addIndicesForPlacedSymbol(this.text,g),f>=0&&f!==g&&this.addIndicesForPlacedSymbol(this.text,f),_>=0&&_!==f&&_!==g&&this.addIndicesForPlacedSymbol(this.text,_),S>=0&&this.addIndicesForPlacedSymbol(this.text,S),A>=0&&this.addIndicesForPlacedSymbol(this.icon,A),k>=0&&this.addIndicesForPlacedSymbol(this.icon,k)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let sC,aC,Px;Pn(oy,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),oy.addDynamicAttributes=ry;class lC{constructor(n){this.type=n.property.overrides?n.property.overrides.runtimeType:rs,this.defaultValue=n}evaluate(n){if(n.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(n.formattedSection))return s.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Pn(lC,"FormatSectionOverride",{omit:["defaultValue"]});const Mx=()=>Px||(Px={layout:sC||(sC=new Or({"symbol-placement":new un(_t.layout_symbol["symbol-placement"]),"symbol-spacing":new un(_t.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new un(_t.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new zn(_t.layout_symbol["symbol-sort-key"]),"symbol-z-order":new un(_t.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new un(_t.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new un(_t.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new un(_t.layout_symbol["icon-ignore-placement"]),"icon-optional":new un(_t.layout_symbol["icon-optional"]),"icon-rotation-alignment":new un(_t.layout_symbol["icon-rotation-alignment"]),"icon-size":new zn(_t.layout_symbol["icon-size"]),"icon-text-fit":new zn(_t.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new zn(_t.layout_symbol["icon-text-fit-padding"]),"icon-image":new zn(_t.layout_symbol["icon-image"]),"icon-rotate":new zn(_t.layout_symbol["icon-rotate"]),"icon-padding":new un(_t.layout_symbol["icon-padding"]),"icon-keep-upright":new un(_t.layout_symbol["icon-keep-upright"]),"icon-offset":new zn(_t.layout_symbol["icon-offset"]),"icon-anchor":new zn(_t.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new un(_t.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new un(_t.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new un(_t.layout_symbol["text-rotation-alignment"]),"text-field":new zn(_t.layout_symbol["text-field"]),"text-font":new zn(_t.layout_symbol["text-font"]),"text-size":new zn(_t.layout_symbol["text-size"]),"text-max-width":new zn(_t.layout_symbol["text-max-width"]),"text-line-height":new zn(_t.layout_symbol["text-line-height"]),"text-letter-spacing":new zn(_t.layout_symbol["text-letter-spacing"]),"text-justify":new zn(_t.layout_symbol["text-justify"]),"text-radial-offset":new zn(_t.layout_symbol["text-radial-offset"]),"text-variable-anchor":new un(_t.layout_symbol["text-variable-anchor"]),"text-anchor":new zn(_t.layout_symbol["text-anchor"]),"text-max-angle":new un(_t.layout_symbol["text-max-angle"]),"text-writing-mode":new un(_t.layout_symbol["text-writing-mode"]),"text-rotate":new zn(_t.layout_symbol["text-rotate"]),"text-padding":new un(_t.layout_symbol["text-padding"]),"text-keep-upright":new un(_t.layout_symbol["text-keep-upright"]),"text-transform":new zn(_t.layout_symbol["text-transform"]),"text-offset":new zn(_t.layout_symbol["text-offset"]),"text-allow-overlap":new un(_t.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new un(_t.layout_symbol["text-ignore-placement"]),"text-optional":new un(_t.layout_symbol["text-optional"]),visibility:new un(_t.layout_symbol.visibility)})),paint:aC||(aC=new Or({"icon-opacity":new zn(_t.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new zn(_t.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new zn(_t.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new zn(_t.paint_symbol["text-emissive-strength"]),"icon-color":new zn(_t.paint_symbol["icon-color"]),"icon-halo-color":new zn(_t.paint_symbol["icon-halo-color"]),"icon-halo-width":new zn(_t.paint_symbol["icon-halo-width"]),"icon-halo-blur":new zn(_t.paint_symbol["icon-halo-blur"]),"icon-translate":new un(_t.paint_symbol["icon-translate"]),"icon-translate-anchor":new un(_t.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new zn(_t.paint_symbol["icon-image-cross-fade"]),"text-opacity":new zn(_t.paint_symbol["text-opacity"]),"text-occlusion-opacity":new zn(_t.paint_symbol["text-occlusion-opacity"]),"text-color":new zn(_t.paint_symbol["text-color"],{runtimeType:no,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new zn(_t.paint_symbol["text-halo-color"]),"text-halo-width":new zn(_t.paint_symbol["text-halo-width"]),"text-halo-blur":new zn(_t.paint_symbol["text-halo-blur"]),"text-translate":new un(_t.paint_symbol["text-translate"]),"text-translate-anchor":new un(_t.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new un(_t.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new un(_t.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new un(_t.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new un(_t.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new zn(_t.paint_symbol["symbol-z-offset"]),"symbol-elevation-reference":new un(_t.paint_symbol["symbol-elevation-reference"])}))},Px);class sy extends xs{constructor(n,s,h,g){super(n,Mx(),s,h,g),this._colorAdjustmentMatrix=Ie.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=n.paint!==void 0&&("icon-occlusion-opacity"in n.paint||"text-occlusion-opacity"in n.paint)}recalculate(n,s){super.recalculate(n,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const h=this.layout.get("text-writing-mode");if(h){const g=[];for(const f of h)g.indexOf(f)<0&&g.push(f);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(n,s,h,g){return this._saturation===n&&this._contrast===s&&this._brightnessMin===h&&this._brightnessMax===g||(this._colorAdjustmentMatrix=function(f,_,S,A){f=Ve(f),_=Te(_);const k=Ie.mat4.create(),x=f/3,I=1-2*x,M=[I,x,x,0,x,I,x,0,x,x,I,0,0,0,0,1],C=.5-.5*_,P=A-S;return Ie.mat4.multiply(k,[P,0,0,0,0,P,0,0,0,0,P,0,S,S,S,1],[_,0,0,0,0,_,0,0,0,0,_,0,C,C,C,1]),Ie.mat4.multiply(k,k,M),k}(n,s,h,g),this._saturation=n,this._contrast=s,this._brightnessMin=h,this._brightnessMax=g),this._colorAdjustmentMatrix}getValueAndResolveTokens(n,s,h,g){const f=this.layout.get(n).evaluate(s,{},h,g),_=this._unevaluatedLayout._values[n];return _.isDataDriven()||ff(_.value)||!f?f:function(S,A){return A.replace(/{([^{}]+)}/g,(k,x)=>x in S?String(S[x]):"")}(s.properties,f)}createBucket(n){return new oy(n)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const n of Mx().paint.overridableProperties){if(!sy.hasPaintOverride(this.layout,n))continue;const s=this.paint.get(n),h=new lC(s),g=new df(h,s.property.specification,this.scope,this.options);let f=null;f=s.value.kind==="constant"||s.value.kind==="source"?new gm("source",g):new il("composite",g,s.value.zoomStops,s.value._interpolationType),this.paint._values[n]=new yu(s.property,f,s.parameters)}}_handleOverridablePaintPropertyUpdate(n,s,h){return!(!this.layout||s.isDataDriven()||h.isDataDriven())&&sy.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,s){const h=n.get("text-field"),g=Mx().paint.properties[s];let f=!1;const _=S=>{for(const A of S)if(g.overrides&&g.overrides.hasOverride(A))return void(f=!0)};if(h.value.kind==="constant"&&h.value.value instanceof $i)_(h.value.value.sections);else if(h.value.kind==="source"){const S=k=>{f||(k instanceof jr&&Ni(k.value)===us?_(k.value.sections):k instanceof Vo?_(k.sections):k.eachChild(S))},A=h.value;A._styleExpression&&S(A._styleExpression.expression)}return f}getProgramIds(){return["symbol"]}getDefaultProgramParams(n,s,h){return{config:new Oc(this,{zoom:s,lut:h}),overrideFog:!1}}}let cC,uC,hC,dC;var kx=Di([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Rx(u){switch(u){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Dx(u){switch(u){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Ox{constructor(n,s,h,g){this.context=n,this.format=h,this.useMipmap=g&&g.useMipmap,this.texture=n.gl.createTexture(),this.update(s,{premultiply:g&&g.premultiply})}update(n,s){const h=n&&n instanceof HTMLVideoElement&&n.width===0?n.videoWidth:n.width,g=n&&n instanceof HTMLVideoElement&&n.height===0?n.videoHeight:n.height,{context:f}=this,{gl:_}=f,{x:S,y:A}=s&&s.position?s.position:{x:0,y:0},k=Math.max(S+h,this.size?this.size[0]:0),x=Math.max(A+g,this.size?this.size[1]:0);!this.size||this.size[0]===k&&this.size[1]===x||(_.bindTexture(_.TEXTURE_2D,null),_.deleteTexture(this.texture),this.texture=_.createTexture(),this.size=null),_.bindTexture(_.TEXTURE_2D,this.texture),f.pixelStoreUnpackFlipY.set(!1),f.pixelStoreUnpack.set(1),f.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA8&&(!s||s.premultiply!==!1));const I=n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||ImageBitmap&&n instanceof ImageBitmap;if(!this.size&&k>0&&x>0){const M=this.useMipmap?Math.floor(Math.log2(Math.max(k,x)))+1:1;_.texStorage2D(_.TEXTURE_2D,M,this.format,k,x),this.size=[k,x]}if(this.size)if(I)_.texSubImage2D(_.TEXTURE_2D,0,S,A,Rx(this.format),Dx(this.format),n);else{const M=n.data;M&&_.texSubImage2D(_.TEXTURE_2D,0,S,A,h,g,Rx(this.format),Dx(this.format),M)}this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(n,s,h=!1){const{context:g}=this,{gl:f}=g;f.bindTexture(f.TEXTURE_2D,this.texture),n!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,n),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap&&!h?n===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:n),this.minFilter=n),s!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,s),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,s),this.wrapS=s)}bindExtraParam(n,s,h,g){const{context:f}=this,{gl:_}=f;_.bindTexture(_.TEXTURE_2D,this.texture),s!==this.magFilter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,s),this.magFilter=s),n!==this.minFilter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,this.useMipmap?n===_.NEAREST?_.NEAREST_MIPMAP_NEAREST:_.LINEAR_MIPMAP_LINEAR:n),this.minFilter=n),h!==this.wrapS&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,h),this.wrapS=h),g!==this.wrapT&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,g),this.wrapT=g)}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}class ay{constructor(n,s){this.context=n,this.texture=s}bind(n,s){const{context:h}=this,{gl:g}=h;g.bindTexture(g.TEXTURE_2D,this.texture),n!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,n),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,n),this.minFilter=n),s!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,s),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,s),this.wrapS=s)}}function ly(u,n,s,h,g,f,_,S){const A=[u,n,1,s,h,1,g,f,1],k=[_,S,1],x=Ie.mat3.adjoint([],A),[I,M,C]=Ie.vec3.transformMat3(k,k,x);return Ie.mat3.multiply(A,A,[I,0,0,0,M,0,0,0,C])}function fC(u,n,s,h,g,f,_,S){const A=function(k,x,I,M,C,P,O,V){const G=ly(0,0,1,0,1,1,0,1),J=ly(k,x,I,M,C,P,O,V),ee=Ie.mat3.adjoint([],G);return Ie.mat3.multiply(J,J,ee)}(u,n,s,h,g,f,_,S);return[A[2]/A[8]/_n,A[5]/A[8]/_n]}function cy(u){return[u[0],Math.min(Math.max(u[1],-$e),$e)]}class pC extends ra{constructor(n,s,h,g){super(),this.id=n,this.dispatcher=h,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(g),this.options=s,this._dirty=!1}load(n,s){if(this._loaded=s||!1,this.fire(new Ns("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return n&&(this.coordinates=n),this._loaded=!0,void this._finishLoading();this._imageRequest=Ur(this.map._requestManager.transformRequest(this.url,Io.Image),(h,g)=>{this._imageRequest=null,this._loaded=!0,h?this.fire(new ia(h)):g&&(this.image=g instanceof HTMLImageElement?wn.getImageData(g):g,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading())})}loaded(){return this._loaded}updateImage(n){return n.url?(this._imageRequest&&n.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}setTexture(n){if(!(n.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new ay(this.map.painter.context,n.handle),this.width=n.dimensions[0],this.height=n.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Ns("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(n){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof ay||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(n){if(this.coordinates=n,this._boundsArray=void 0,this._unsupportedCoords=!1,!n.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let s=n[0][1],h=n[0][1];for(const f of n)f[1]>h&&(h=f[1]),f[1]<s&&(s=f[1]);const g=(h+s)/2;if(g>$e?this.onNorthPole=!0:g<-$e&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const f=n.map(ft.fromLngLat);this.tileID=function(_){let S=1/0,A=1/0,k=-1/0,x=-1/0;for(const O of _)S=Math.min(S,O.x),A=Math.min(A,O.y),k=Math.max(k,O.x),x=Math.max(x,O.y);const I=Math.max(k-S,x-A),M=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),C=Math.pow(2,M);let P=Math.floor((S+k)/2*C);return P>1&&(P-=1),new jo(M,P,Math.floor((A+x)/2*C))}(f),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Ns("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(n){for(const G in this.tiles){const J=this.tiles[G];J.state!=="loaded"&&(J.state="loaded",J.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const s=rg(new jo(0,0,0),this.map.transform.projection),h=[s.projection.project(this.coordinates[0][0],this.coordinates[0][1]),s.projection.project(this.coordinates[1][0],this.coordinates[1][1]),s.projection.project(this.coordinates[2][0],this.coordinates[2][1]),s.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(G){const J=G[1].x-G[0].x,ee=G[1].y-G[0].y,H=G[2].x-G[1].x,se=G[2].y-G[1].y,ue=G[3].x-G[2].x,we=G[3].y-G[2].y,Me=G[0].x-G[3].x,Re=G[0].y-G[3].y,Ce=J*se-H*ee,je=H*we-ue*se,Oe=ue*Re-Me*we,He=Me*ee-J*Re;return Ce>0&&je>0&&Oe>0&&He>0||Ce<0&&je<0&&Oe<0&&He<0}(h))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const g=rg(this.tileID,this.map.transform.projection),[f,_,S,A]=this.coordinates.map(G=>{const J=g.projection.project(G[0],G[1]);return eC(g,J)._round()});this.perspectiveTransform=fC(f.x,f.y,_.x,_.y,S.x,S.y,A.x,A.y);const k=this._boundsArray=new Ql;k.emplaceBack(f.x,f.y,0,0),k.emplaceBack(_.x,_.y,_n,0),k.emplaceBack(A.x,A.y,0,_n),k.emplaceBack(S.x,S.y,_n,_n),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=n.createVertexBuffer(k,kx.members),this.boundsSegments=Wr.simpleSegment(0,0,4,2);const x=[],I=[cy((M=this.coordinates)[0]),cy(M[1]),cy(M[2]),cy(M[3])];var M;const[C,P,O,V]=function(G){let J=G[0][0],ee=J,H=G[0][1],se=H;for(let ue=1;ue<G.length;ue++)G[ue][0]<J?J=G[ue][0]:G[ue][0]>ee&&(ee=G[ue][0]),G[ue][1]<H?H=G[ue][1]:G[ue][1]>se&&(se=G[ue][1]);return[J,H,ee-J,se-H]}(I);{const G=new Ql,[J,ee,H,se]=function(ct){let bt=ct[0].x,ut=bt,Ot=ct[0].y,$t=Ot;for(let It=1;It<ct.length;It++)ct[It].x<bt?bt=ct[It].x:ct[It].x>ut&&(ut=ct[It].x),ct[It].y<Ot?Ot=ct[It].y:ct[It].y>$t&&($t=ct[It].y);return[bt,Ot,ut-bt,$t-Ot]}(h),ue=ct=>[(ct.x-J)/H,(ct.y-ee)/se],[we,Me,Re,Ce]=h.map(ue),je=function(ct,bt,ut,Ot,$t,It,En,mn){const an=ly(0,0,1,0,1,1,0,1),Wt=ly(ct,bt,ut,Ot,$t,It,En,mn),Vn=Ie.mat3.adjoint([],Wt);return Ie.mat3.multiply(an,an,Vn)}(we[0],we[1],Me[0],Me[1],Re[0],Re[1],Ce[0],Ce[1]);this.elevatedGlobePerspectiveTransform=fC(we[0],we[1],Me[0],Me[1],Re[0],Re[1],Ce[0],Ce[1]);const Oe=(ct,bt)=>{x.push(ct.lng);const ut=Math.round((ct.lng-C)/O*_n),Ot=Math.round((ct.lat-P)/V*_n),$t=ue(bt),It=Ie.vec3.transformMat3([],[$t[0],$t[1],1],je),En=Math.round(It[0]/It[2]*_n),mn=Math.round(It[1]/It[2]*_n);G.emplaceBack(ut,Ot,En,mn)},He=h[3].x-h[0].x,Qe=h[3].y-h[0].y,it=h[2].x-h[1].x,ot=h[2].y-h[1].y;for(let ct=0;ct<65;ct++){const bt=ct/64,ut=[h[0].x+bt*He,h[0].y+bt*Qe],Ot=[h[1].x+bt*it,h[1].y+bt*ot],$t=Ot[0]-ut[0],It=Ot[1]-ut[1];for(let En=0;En<65;En++){const mn=En/64,an={x:ut[0]+$t*mn,y:ut[1]+It*mn,z:0};Oe(s.projection.unproject(an.x,an.y),an)}}this.elevatedGlobeVertexBuffer=n.createVertexBuffer(G,kx.members)}{this.maxLongitudeTriangleSize=0;let G=[],J=new ss;const ee=(H,se,ue)=>{J.emplaceBack(H,se,ue);const we=x[H],Me=x[se],Re=x[ue],Ce=Math.min(Math.min(we,Me),Re),je=Math.max(Math.max(we,Me),Re)-Ce;je>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=je),G.push(Ce+je/2)};for(let H=0;H<64;H++)for(let se=0;se<64;se++){const ue=65*H+se,we=ue+1,Me=ue+65,Re=Me+1;ee(ue,Me,we),ee(we,Me,Re)}[G,J]=function(H,se){const ue=Array.from({length:H.length},(Re,Ce)=>Ce);ue.sort((Re,Ce)=>H[Re]-H[Ce]);const we=[],Me=new ss;for(let Re=0;Re<ue.length;Re++){const Ce=ue[Re];we.push(H[Ce]);const je=3*Ce,Oe=je+1;Me.emplaceBack(se.uint16[je],se.uint16[Oe],se.uint16[Oe+1])}return[we,Me]}(G,J),this.elevatedGlobeTrianglesCenterLongitudes=G,this.elevatedGlobeIndexBuffer=n.createIndexBuffer(J)}this.elevatedGlobeSegments=Wr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,O/_n,0,V/_n,0,0,P,C,0])}prepare(){const n=Object.keys(this.tiles).length!==0;if(this.tileID&&!n)return;const s=this.map.painter.context,h=s.gl;!this._dirty||this.texture instanceof ay||(this.texture?this.texture.update(this.image):(this.texture=new Ox(s,this.image,h.RGBA8),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this._dirty=!1),n&&this._prepareData(s)}loadTile(n,s){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},s(null)):(n.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(n){const s=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!s)return null;const h=this.elevatedGlobeTrianglesCenterLongitudes;let g=(f=n+180)+360*Math.round((h[0]-f)/360);var f;const _=new Wr,S=(I,M)=>{_.segments.push({vertexOffset:0,primitiveOffset:I,vertexLength:s.segments[0].vertexLength,primitiveLength:M,sortKey:void 0,vaos:{}})},A=.51*this.maxLongitudeTriangleSize;if(Math.abs(h[0]-g)<=A){const I=ye(h,0,h.length,g+A);return I===h.length||S(I,vt(h,I+1,h.length,g+360-A)-I),_}g<h[0]&&(g+=360);const k=vt(h,0,h.length,g-A);if(k===h.length)return S(0,h.length),_;S(0,k-0);const x=ye(h,k+1,h.length,g+A);return x!==h.length&&S(x,h.length-x),_}}const tV=(Math.pow(256,2)-1)/16907520;class mC extends xs{constructor(n,s,h,g){super(n,{layout:hC||(hC=new Or({visibility:new un(_t.layout_raster.visibility)})),paint:dC||(dC=new Or({"raster-opacity":new un(_t.paint_raster["raster-opacity"]),"raster-color":new Ga(_t.paint_raster["raster-color"]),"raster-color-mix":new un(_t.paint_raster["raster-color-mix"]),"raster-color-range":new un(_t.paint_raster["raster-color-range"]),"raster-hue-rotate":new un(_t.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new un(_t.paint_raster["raster-brightness-min"]),"raster-brightness-max":new un(_t.paint_raster["raster-brightness-max"]),"raster-saturation":new un(_t.paint_raster["raster-saturation"]),"raster-contrast":new un(_t.paint_raster["raster-contrast"]),"raster-resampling":new un(_t.paint_raster["raster-resampling"]),"raster-fade-duration":new un(_t.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new un(_t.paint_raster["raster-emissive-strength"]),"raster-array-band":new un(_t.paint_raster["raster-array-band"]),"raster-elevation":new un(_t.paint_raster["raster-elevation"])}))},s,h,g),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(n){return!(n&&n._source instanceof pC&&(n._source.onNorthPole||n._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(n){n!=="raster-color"&&n!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(n){if(!this.hasColorMap()||!this._curRampRange)return;const s=this._transitionablePaint._values["raster-color"].value.expression,[h,g]=n||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(h)&&isNaN(g)||h===this._curRampRange[0]&&g===this._curRampRange[1]||(this.colorRamp=$m({expression:s,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:h,end:g}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[h,g])}}let gC,_C,vC,yC,bC;class xC extends xs{constructor(n,s,h,g){super(n,{layout:gC||(gC=new Or({visibility:new un(_t["layout_raster-particle"].visibility)})),paint:_C||(_C=new Or({"raster-particle-array-band":new un(_t["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new un(_t["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Ga(_t["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new un(_t["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new un(_t["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new un(_t["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new un(_t["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new un(_t["paint_raster-particle"]["raster-particle-elevation"])}))},s,h,g),this._updateColorRamp(),this.lastInvalidatedAt=wn.now()}onRemove(n){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(n){return!1}_handleSpecialPaintPropertyUpdate(n){n!=="raster-particle-color"&&n!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),n==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const n=this._transitionablePaint._values["raster-particle-color"].value.expression,s=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=$m({expression:n,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:s}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=wn.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class nV extends xs{constructor(n,s){super(n,{},s,null),this.implementation=n,n.slot&&(this.slot=n.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(n){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(n){this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)}onRemove(n){this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)}}function Lx(u,n,s){const h=[0,0,1],g=Ie.quat.identity([]);return Ie.quat.rotateY(g,g,s?-Gt(u)+Math.PI:Gt(u)),Ie.quat.rotateX(g,g,-Gt(n)),Ie.vec3.transformQuat(h,h,g),Ie.vec3.normalize(h,h)}function wC(u,n){const s=uy(u.projection,u.zoom,u.width,u.height),h=function(f,_,S,A,k){const x=new Q(S.lng-180*Bu,S.lat),I=new Q(S.lng+180*Bu,S.lat),M=f.project(x.lng,x.lat),C=f.project(I.lng,I.lat),P=-Math.atan2(C.y-M.y,C.x-M.x),O=ft.fromLngLat(S);O.y=hn(O.y,-1+Bu,1-Bu);const V=O.toLngLat(),G=f.project(V.lng,V.lat),J=ft.fromLngLat(V);J.x+=Bu;const ee=J.toLngLat(),H=f.project(ee.lng,ee.lat),se=TC(H.x-G.x,H.y-G.y,P),ue=ft.fromLngLat(V);ue.y+=Bu;const we=ue.toLngLat(),Me=f.project(we.lng,we.lat),Re=TC(Me.x-G.x,Me.y-G.y,P),Ce=Math.abs(se.x)/Math.abs(Re.y),je=Ie.mat4.identity([]);Ie.mat4.rotateZ(je,je,-P*(1-(k?0:A)));const Oe=Ie.mat4.identity([]);return Ie.mat4.scale(Oe,Oe,[1,1-(1-Ce)*A,1]),Oe[4]=-Re.x/Re.y*A,Ie.mat4.rotateZ(Oe,Oe,P),Ie.mat4.multiply(Oe,je,Oe),Oe}(u.projection,0,u.center,s,n),g=SC(u);return Ie.mat4.scale(h,h,[g,g,1]),h}function SC(u){const n=u.projection,s=uy(u.projection,u.zoom,u.width,u.height),h=zx(n,u.center),g=zx(n,Q.convert(n.center));return Math.pow(2,h*s+(1-s)*g)}function uy(u,n,s,h,g=1/0){const f=u.range;if(!f)return 0;const _=Math.min(g,Math.max(s,h)),S=Math.log(_/1024)/Math.LN2;return jn(f[0]+S,f[1]+S,n)}const Bu=1/4e4;function zx(u,n){const s=hn(n.lat,-$e,$e),h=new Q(n.lng-180*Bu,s),g=new Q(n.lng+180*Bu,s),f=u.project(h.lng,s),_=u.project(g.lng,s),S=ft.fromLngLat(h),A=ft.fromLngLat(g),k=_.x-f.x,x=_.y-f.y,I=A.x-S.x,M=A.y-S.y,C=Math.sqrt((I*I+M*M)/(k*k+x*x));return Math.log(C)/Math.LN2}function TC(u,n,s){const h=Math.cos(s),g=Math.sin(s);return{x:u*h-n*g,y:u*g+n*h}}function EC(u,n,s){Ie.mat4.identity(u),Ie.mat4.rotateZ(u,u,Gt(n[2])),Ie.mat4.rotateX(u,u,Gt(n[0])),Ie.mat4.rotateY(u,u,Gt(n[1])),Ie.mat4.scale(u,u,s),Ie.mat4.multiply(u,u,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function hy(u,n,s,h,g,f,_,S){const A=[s[0]-n[0],s[1]-n[1],0],k=[h[0]-n[0],h[1]-n[1],0];if(Ie.vec3.length(A)<1e-12||Ie.vec3.length(k)<1e-12)return Ie.quat.identity(u);const x=Ie.vec3.cross([],A,k);Ie.vec3.normalize(x,x),Ie.vec3.subtract(k,h,n),A[2]=(f-g)*S,k[2]=(_-g)*S;const I=A;return Ie.vec3.cross(I,A,k),Ie.vec3.normalize(I,I),Ie.quat.rotationTo(u,x,I)}function Bx(u,n,s=!1){const h=ku(n.zoom),g=function(f,_,S){const A=_.worldSize,k=[f[12],f[13],f[14]],x=ze(k[1]/A),I=Fe(k[0]/A),M=Ie.mat4.identity([]),C=Pe(1,x)*A,P=Pe(1,0)*A*nt(x,_.zoom),O=1/Kb(A);let V=P*O;if(S){const H=uy(_.projection,_.zoom,_.width,_.height,1024);V=O*_.projection.pixelSpaceConversion(_.center.lat,A,H)}const G=j(x,I);Ie.vec3.add(G,G,Ie.vec3.scale([],Ie.vec3.normalize([],G),C*V*k[2]));const J=function(H){const se=[H[0],H[1],H[2]];let ue=[0,1,0];const we=Ie.vec3.cross([],ue,se);return Ie.vec3.cross(ue,se,we),Ie.vec3.squaredLength(ue)===0&&(ue=[0,1,0],Ie.vec3.cross(we,se,ue)),Ie.vec3.normalize(we,we),Ie.vec3.normalize(ue,ue),Ie.vec3.normalize(se,se),[we[0],we[1],we[2],0,ue[0],ue[1],ue[2],0,se[0],se[1],se[2],0,H[0],H[1],H[2],1]}(G);Ie.mat4.scale(M,M,[V,V,V*C]),Ie.mat4.translate(M,M,[-k[0],-k[1],-k[2]]);const ee=Ie.mat4.multiply([],_.globeMatrix,J);return Ie.mat4.multiply(ee,ee,M),Ie.mat4.multiply(ee,ee,f),ee}(u,n,s);if(h>0){const f=function(_,S){const A=S.worldSize,k=Pe(1,0)*A*nt(S.center.lat,S.zoom)/Kb(A),x=Pe(1,S.center.lat)*A,I=Ie.mat4.identity([]);return Ie.mat4.rotateY(I,I,Gt(S.center.lng)),Ie.mat4.rotateX(I,I,Gt(S.center.lat)),Ie.mat4.translate(I,I,[0,0,i]),Ie.mat4.scale(I,I,[k,k,k*x]),Ie.mat4.translate(I,I,[S.point.x-.5*A,S.point.y-.5*A,0]),Ie.mat4.multiply(I,I,_),Ie.mat4.multiply(I,S.globeMatrix,I)}(u,n);return function(_,S,A){const k=(P,O,V)=>{const G=Ie.vec3.length(P),J=Ie.vec3.length(O),ee=zc(P,O,V);return Ie.vec3.scale(ee,ee,1/Ie.vec3.length(ee)*In(G,J,V))},x=k([_[0],_[1],_[2]],[S[0],S[1],S[2]],A),I=k([_[4],_[5],_[6]],[S[4],S[5],S[6]],A),M=k([_[8],_[9],_[10]],[S[8],S[9],S[10]],A),C=zc([_[12],_[13],_[14]],[S[12],S[13],S[14]],A);return[x[0],x[1],x[2],0,I[0],I[1],I[2],0,M[0],M[1],M[2],0,C[0],C[1],C[2],1]}(g,f,h)}return g}function IC(u,n,s,h){const g=ur.projectAabbCorners(h,s);let f=Number.MAX_VALUE,_=-1;for(let k=0;k<g.length;++k){const x=g[k];x[0]=(.5*x[0]+.5)*n.width,x[1]=(.5-.5*x[1])*n.height,x[2]<f&&(_=k,f=x[2])}const S=k=>new Ue(g[k][0],g[k][1]);let A;switch(_){case 0:case 6:A=[S(1),S(5),S(4),S(7),S(3),S(2),S(1)];break;case 1:case 7:A=[S(0),S(4),S(5),S(6),S(2),S(3),S(0)];break;case 3:case 5:A=[S(1),S(0),S(4),S(7),S(6),S(2),S(1)];break;default:A=[S(1),S(5),S(6),S(7),S(3),S(0),S(1)]}if(pn(u,A))return f}const iV=Di([{name:"a_pos_3f",components:3,type:"Float32"}]),rV=Di([{name:"a_color_3f",components:3,type:"Float32"}]),oV=Di([{name:"a_color_4f",components:4,type:"Float32"}]),sV=Di([{name:"a_uv_2f",components:2,type:"Float32"}]),aV=Di([{name:"a_normal_3f",components:3,type:"Float32"}]),lV=Di([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),cV=Di([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),CC={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class dy{constructor(n,s,h,g){this.message=(n?`${n}: `:"")+h,g&&(this.identifier=g),s!=null&&s.__line__&&(this.line=s.__line__)}}function AC(u,n){const s=u.indexOf("://")===-1;try{return new URL(u,s&&n?"http://example.com":void 0),!0}catch{return!1}}class PC{constructor(n,s){this.feature=n,this.instancedDataOffset=s,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class MC{constructor(){this.instancedDataArray=new Vh,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Fx{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.fqid),this.projection=n.projection,this.index=n.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(n,s){}populate(n,s,h,g){this.tileToMeter=Ye(h);const f=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:_,id:S,index:A,sourceLayerIndex:k}of n){const x=S??(_.properties&&_.properties.hasOwnProperty("id")?_.properties.id:void 0),I=ln(_,f);if(!this.layers[0]._featureFilter.filter(new qr(this.zoom),I,h))continue;const M={id:x,sourceLayerIndex:k,index:A,geometry:f?I.geometry:sn(_,h,g),properties:_.properties,type:_.type,patterns:{}},C=this.addFeature(M,M.geometry,I);C&&s.featureIndex.insert(_,M.geometry,A,k,this.index,this.instancesPerModel[C].instancedDataArray.length,_n/32)}this.lookup=null}update(n,s,h,g){for(const f in this.instancesPerModel){const _=this.instancesPerModel[f];for(const S in n)_.idToFeaturesIndex.hasOwnProperty(S)&&(this.evaluate(_.features[_.idToFeaturesIndex[S]],n[S],_,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let n=!1;for(const s in this.instancesPerModel){const h=this.instancesPerModel[s];for(const g of h.features){const f=this.layers[0],_=g.feature,S=this.canonical,A=f.paint.get("model-rotation").evaluate(_,{},S),k=f.paint.get("model-scale").evaluate(_,{},S),x=f.paint.get("model-translation").evaluate(_,{},S);Ie.vec3.exactEquals(g.rotation,A)&&Ie.vec3.exactEquals(g.scale,k)&&Ie.vec3.exactEquals(g.translation,x)||(this.evaluate(g,g.featureStates,h,!0),n=!0)}}return n}updateReplacement(n,s,h,g){if(s.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=s.updateTime;const f=s.getReplacementRegionsForTile(n.toUnwrapped(),!0);if(ux(this.activeReplacements,f))return!1;this.activeReplacements=f;let _=!1;for(const S in this.instancesPerModel){const A=this.instancesPerModel[S],k=A.instancedDataArray;for(const x of A.features){const I=x.instancedDataOffset,M=x.instancedDataCount;for(let C=0;C<M;C++){const P=16*(C+I);let O=k.float32[P+0];const V=O>_n;O=V?O-_n:O;const G=Math.floor(O),J=k.float32[P+1];let ee=!1;for(const H of this.activeReplacements)if(!HE(H,h,CC.Model,g)&&!(H.min.x>G||G>H.max.x||H.min.y>J||J>H.max.y)&&(ee=KE(YE(G,J,n.canonical,H.footprintTileId.canonical),H.footprint),ee))break;k.float32[P]=ee?O+_n:O,_=_||ee!==V}}}return _}isEmpty(){for(const n in this.instancesPerModel)if(this.instancesPerModel[n].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(n){if(!this.uploaded)for(const s in this.instancesPerModel){const h=this.instancesPerModel[s];h.instancedDataArray.length<0||h.instancedDataArray.length===0||(h.instancedDataBuffer?h.instancedDataBuffer.updateData(h.instancedDataArray):h.instancedDataBuffer=n.createVertexBuffer(h.instancedDataArray,lV.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const s in this.instancesPerModel){const h=this.instancesPerModel[s];h.instancedDataArray.length!==0&&h.instancedDataBuffer&&h.instancedDataBuffer.destroy()}const n=this.layers[0].modelManager;if(n&&this.modelUris)for(const s of this.modelUris)n.removeModel(s,"")}addFeature(n,s,h){const g=this.layers[0],f=g.layout.get("model-id").evaluate(h,{},this.canonical);if(!f)return ii(`modelId is not evaluated for layer ${g.id} and it is not going to get rendered.`),f;AC(f,!1)&&(this.modelUris.includes(f)||this.modelUris.push(f)),this.instancesPerModel[f]||(this.instancesPerModel[f]=new MC);const _=this.instancesPerModel[f],S=_.instancedDataArray,A=new PC(h,S.length);for(const k of s)for(const x of k){if(x.x<0||x.x>=_n||x.y<0||x.y>=_n)continue;const I=(this.lookupDim-1)/_n,M=this.lookupDim*(x.y*I|0)+x.x*I|0;if(this.lookup){if(this.lookup[M]!==0)continue;this.lookup[M]=1}this.instanceCount++;const C=S.length;S.resize(C+1),_.instancesEvaluatedElevation.push(0),S.float32[16*C]=x.x,S.float32[16*C+1]=x.y}return A.instancedDataCount=_.instancedDataArray.length-A.instancedDataOffset,A.instancedDataCount>0&&(n.id&&(_.idToFeaturesIndex[n.id]=_.features.length),_.features.push(A),this.evaluate(A,{},_,!1)),f}getModelUris(){return this.modelUris}evaluate(n,s,h,g){const f=this.layers[0],_=n.feature,S=this.canonical,A=n.rotation=f.paint.get("model-rotation").evaluate(_,s,S),k=n.scale=f.paint.get("model-scale").evaluate(_,s,S),x=n.translation=f.paint.get("model-translation").evaluate(_,s,S),I=f.paint.get("model-color").evaluate(_,s,S);I.a=f.paint.get("model-color-mix-intensity").evaluate(_,s,S);const M=[];this.maxVerticalOffset<x[2]&&(this.maxVerticalOffset=x[2]),this.maxScale=Math.max(Math.max(this.maxScale,k[0]),Math.max(k[1],k[2])),EC(M,A,k);const C=Math.round(100*I.a)+I.b/1.05;for(let P=0;P<n.instancedDataCount;++P){const O=n.instancedDataOffset+P,V=16*O,G=h.instancedDataArray.float32;let J=0;g&&(J=G[V+6]-h.instancesEvaluatedElevation[O]);const ee=0|G[V+1];G[V]=(0|G[V])+I.r/1.05,G[V+1]=ee+I.g/1.05,G[V+2]=C,G[V+3]=1/(S.z>10?this.tileToMeter:Ye(S,ee)),G[V+4]=x[0],G[V+5]=x[1],G[V+6]=x[2]+J,G[V+7]=M[0],G[V+8]=M[1],G[V+9]=M[2],G[V+10]=M[4],G[V+11]=M[5],G[V+12]=M[6],G[V+13]=M[8],G[V+14]=M[9],G[V+15]=M[10],h.instancesEvaluatedElevation[O]=x[2]}}}let kC,RC;Pn(Fx,"ModelBucket",{omit:["layers"]}),Pn(MC,"PerModelAttributes"),Pn(PC,"ModelFeature");const qh=64,Gf={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function DC(u,n,s,h,g,f,_,S,A,k=!1){const x=s.zoom,I=s.project(h),M=nt(h.lat,x),C=1/M;Ie.mat4.identity(u),Ie.mat4.translate(u,u,[I.x+_[0]*C,I.y+_[1]*C,_[2]]);let P=1,O=1;const V=s.worldSize;if(k){if(s.projection.name==="mercator"){let H=0;s.elevation&&(H=s.elevation.getAtPointOrZero(new ft(I.x/V,I.y/V),0));const se=Ie.vec4.transformMat4([],[I.x,I.y,H,1],s.projMatrix)[3]/s.cameraToCenterDistance;P=se,O=se*nt(s.center.lat,x)}else if(s.projection.name==="globe"){const H=Bx(u,s),se=Ie.mat4.multiply([],s.projMatrix,H),ue=[0,0,0,1];Ie.vec4.transformMat4(ue,ue,se);const we=ue[3]/s.cameraToCenterDistance,Me=ku(x),Re=s.projection.pixelsPerMeter(h.lat,V)*nt(h.lat,x),Ce=s.projection.pixelsPerMeter(s.center.lat,V)*nt(s.center.lat,x);P=we/In(Re,We(s.center.lat),Me),O=we*M/Re,P*=Ce,O*=Ce}}else P=C;Ie.mat4.scale(u,u,[P,P,O]);const G=[...u],J=n.orientation,ee=[];if(EC(ee,[J[0]+g[0],J[1]+g[1],J[2]+g[2]],f),Ie.mat4.multiply(u,G,ee),S&&s.elevation){let H=0;const se=[];if(A&&s.elevation){H=function(Me,Re,Ce,je,Oe){const He=Re.elevation;if(!He)return 0;const Qe=ur.projectAabbCorners(Ce,je),it=Pe(1,Oe.lat)*Re.worldSize,ot=function(Vn,Tn){const An=[0,0,1],Kn=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const ci of Kn){const oi=Vn[ci.corners[0]],si=Vn[ci.corners[1]],pi=Vn[ci.corners[2]],_i=[si[0]-oi[0],si[1]-oi[1],Tn*(si[2]-oi[2])],ir=Ie.vec3.cross(_i,_i,[pi[0]-oi[0],pi[1]-oi[1],Tn*(pi[2]-oi[2])]);Ie.vec3.normalize(ir,ir),ci.dotProductWithUp=Ie.vec3.dot(ir,An)}return Kn.sort((ci,oi)=>ci.dotProductWithUp-oi.dotProductWithUp),Kn[0].corners}(Qe,it),ct=Qe[ot[0]],bt=Qe[ot[1]],ut=Qe[ot[2]],Ot=Qe[ot[3]],$t=He.getAtPointOrZero(new ft(ct[0]/Re.worldSize,ct[1]/Re.worldSize),0),It=He.getAtPointOrZero(new ft(bt[0]/Re.worldSize,bt[1]/Re.worldSize),0),En=He.getAtPointOrZero(new ft(ut[0]/Re.worldSize,ut[1]/Re.worldSize),0),mn=He.getAtPointOrZero(new ft(Ot[0]/Re.worldSize,Ot[1]/Re.worldSize),0),an=($t+mn)/2,Wt=(It+En)/2;return an>Wt?It<En?hy(Me,bt,Ot,ct,It,mn,$t,it):hy(Me,ut,ct,Ot,En,$t,mn,it):$t<mn?hy(Me,ct,bt,ut,$t,It,En,it):hy(Me,Ot,ut,bt,mn,En,It,it),Math.max(an,Wt)}(se,s,n.aabb,u,h);const ue=Ie.mat4.fromQuat([],se),we=Ie.mat4.multiply([],ue,ee);Ie.mat4.multiply(u,G,we)}else H=s.elevation.getAtPointOrZero(new ft(I.x/V,I.y/V),0);H!==0&&(u[14]+=H)}}function cg(u,n,s=!1){u.uploaded||(u.gfxTexture=new Ox(n,u.image,s?n.gl.R8:n.gl.RGBA8,{useMipmap:u.sampler.minFilter>=n.gl.NEAREST_MIPMAP_NEAREST}),u.uploaded=!0,u.image=null)}function uV(u,n,s){u.indexBuffer=n.createIndexBuffer(u.indexArray,!1,!0),u.vertexBuffer=n.createVertexBuffer(u.vertexArray,iV.members,!1,!0),u.normalArray&&(u.normalBuffer=n.createVertexBuffer(u.normalArray,aV.members,!1,!0)),u.texcoordArray&&(u.texcoordBuffer=n.createVertexBuffer(u.texcoordArray,sV.members,!1,!0)),u.colorArray&&(u.colorBuffer=n.createVertexBuffer(u.colorArray,(u.colorArray.bytesPerElement===12?rV:oV).members,!1,!0)),u.featureArray&&(u.pbrBuffer=n.createVertexBuffer(u.featureArray,cV.members,!0)),u.segments=Wr.simpleSegment(0,0,u.vertexArray.length,u.indexArray.length);const h=u.material;h.pbrMetallicRoughness.baseColorTexture&&cg(h.pbrMetallicRoughness.baseColorTexture,n),h.pbrMetallicRoughness.metallicRoughnessTexture&&cg(h.pbrMetallicRoughness.metallicRoughnessTexture,n),h.normalTexture&&cg(h.normalTexture,n),h.occlusionTexture&&cg(h.occlusionTexture,n,s),h.emissionTexture&&cg(h.emissionTexture,n)}function Vx(u,n,s){if(u.meshes)for(const h of u.meshes)uV(h,n,s);if(u.children)for(const h of u.children)Vx(h,n,s)}function fy(u){if(u.meshes)for(const n of u.meshes)n.indexArray.destroy(),n.vertexArray.destroy(),n.colorArray&&n.colorArray.destroy(),n.normalArray&&n.normalArray.destroy(),n.texcoordArray&&n.texcoordArray.destroy(),n.featureArray&&n.featureArray.destroy();if(u.children)for(const n of u.children)fy(n)}function Nx(u){if(u.meshes)for(const s of u.meshes)s.vertexBuffer&&(s.vertexBuffer.destroy(),s.indexBuffer.destroy(),s.normalBuffer&&s.normalBuffer.destroy(),s.texcoordBuffer&&s.texcoordBuffer.destroy(),s.colorBuffer&&s.colorBuffer.destroy(),s.pbrBuffer&&s.pbrBuffer.destroy(),s.segments.destroy(),s.material&&((n=s.material).pbrMetallicRoughness.baseColorTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),n.pbrMetallicRoughness.metallicRoughnessTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),n.normalTexture&&n.normalTexture.gfxTexture&&n.normalTexture.gfxTexture.destroy(),n.emissionTexture&&n.emissionTexture.gfxTexture&&n.emissionTexture.gfxTexture.destroy(),n.occlusionTexture&&n.occlusionTexture.gfxTexture&&n.occlusionTexture.gfxTexture.destroy()));var n;if(u.children)for(const s of u.children)Nx(s)}class Hf{constructor(n,s,h){this._demTile=n,this._dem=this._demTile.dem,this._scale=s,this._offset=h}static create(n,s,h){const g=h||n.findDEMTileFor(s);if(!g||!g.dem)return;const f=g.dem,_=g.tileID,S=1<<s.canonical.z-_.canonical.z;return new Hf(g,f.dim/_n/S,[(s.canonical.x/S-_.canonical.x)*f.dim,(s.canonical.y/S-_.canonical.y)*f.dim])}tileCoordToPixel(n,s){const h=s*this._scale+this._offset[1],g=Math.floor(n*this._scale+this._offset[0]),f=Math.floor(h);return new Ue(g,f)}getElevationAt(n,s,h,g){const f=n*this._scale+this._offset[0],_=s*this._scale+this._offset[1],S=Math.floor(f),A=Math.floor(_),k=this._dem;return g=!!g,h?In(In(k.get(S,A,g),k.get(S,A+1,g),_-A),In(k.get(S+1,A,g),k.get(S+1,A+1,g),_-A),f-S):k.get(S,A,g)}getElevationAtPixel(n,s,h){return this._dem.get(n,s,!!h)}getMeterToDEM(n){return(1<<this._demTile.tileID.canonical.z)*Pe(1,n)*this._dem.stride}}const Ux=new Float32Array(262144),Wh=new Uint8Array(262144);function OC(u){let n=0;if(u.meshes)for(const s of u.meshes)n=Math.max(n,s.aabb.max[2]);if(u.children)for(const s of u.children)n=Math.max(n,OC(s));return n}function LC(u,n,s){if(u.meshes)for(const h of u.meshes)h.aabb.min[0]!==1/0&&s.insert(n,h.aabb.min[0],h.aabb.min[1],h.aabb.max[0],h.aabb.max[1]);if(u.children)for(const h of u.children)LC(h,n,s)}const zC=["","wall","door","roof","window","lamp","logo"];class BC{constructor(n){this.node=n,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:n.id,geometry:[],properties:{height:OC(n)}},this.aabb=this._getLocalBounds()}_getLocalBounds(){if(!this.node.meshes)return new ur([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let n=0;const s=new ur([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const h of this.node.meshes)this.node.lightMeshIndex!==n&&(h.transformedAabb=ur.applyTransformFast(h.aabb,this.node.matrix),s.encapsulate(h.transformedAabb)),n++;this.aabb=s}return this.aabb}}class py{constructor(n,s,h,g,f,_){this.id=s,this.modelTraits|=Gf.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,h&&(this.modelTraits|=Gf.HasMapboxMeshFeatures),g&&(this.modelTraits|=Gf.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=f,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const S of n)this.nodesInfo.push(new BC(S)),LC(S,_.featureIndexArray.length,_.grid),_.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,_.bucketLayerIDs.length-1,0)}updateFootprints(n,s){for(const h of this.getNodesInfo()){const g=h.node;g.footprint&&s.push({footprint:g.footprint,id:n})}}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(n){if(!this.needsUpload)return;const s=this.getNodesInfo();for(const h of s){const g=h.node;this.uploaded?this.updatePbrBuffer(g):Vx(g,n,!0)}for(const h of s)fy(h.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(n){let s=!1;if(!n.meshes)return s;for(const h of n.meshes)h.pbrBuffer&&(h.pbrBuffer.updateData(h.featureArray),s=!0);return s}needsReEvaluation(n,s,h){const g=n.transform.projectionOptions,f=n.style.getBrightness(),_=this.brightness!==f;return!!(!this.uploaded||this.dirty||g.name!==this.projection.name||ug(h.paint.get("model-color").value,_)||ug(h.paint.get("model-color-mix-intensity").value,_)||ug(h.paint.get("model-roughness").value,_)||ug(h.paint.get("model-emissive-strength").value,_)||ug(h.paint.get("model-height-based-emissive-strength-multiplier").value,_))&&(this.projection=g,this.brightness=f,!0)}evaluateScale(n,s){if(n.transform.zoom===this.zoom)return;this.zoom=n.transform.zoom;const h=this.getNodesInfo(),g=this.id.canonical;for(const f of h){const _=f.feature;f.evaluatedScale=s.paint.get("model-scale").evaluate(_,{},g)}}evaluate(n){const s=this.getNodesInfo();for(const h of s){if(!h.node.meshes)continue;const g=h.feature,f=h.node.meshes&&h.node.meshes[0].featureData,_=h.evaluatedColor[2],S=h.evaluatedRMEA[2],A=this.id.canonical;if(h.hasTranslucentParts=!1,f){for(let k=0;k<zC.length;k++){const x=zC[k];x.length&&(g.properties.part=x);const I=n.paint.get("model-color").evaluate(g,{},A).toRenderColor(null),M=n.paint.get("model-color-mix-intensity").evaluate(g,{},A);h.evaluatedColor[k]=[I.r,I.g,I.b,M],h.evaluatedRMEA[k][0]=n.paint.get("model-roughness").evaluate(g,{},A),h.evaluatedRMEA[k][2]=n.paint.get("model-emissive-strength").evaluate(g,{},A),h.evaluatedRMEA[k][3]=I.a,h.emissionHeightBasedParams[k]=n.paint.get("model-height-based-emissive-strength-multiplier").evaluate(g,{},A),!h.hasTranslucentParts&&I.a<1&&(h.hasTranslucentParts=!0)}delete g.properties.part,dV(h,_!==h.evaluatedColor[2]||S!==h.evaluatedRMEA[2],this.modelTraits)}else h.evaluatedRMEA[0][2]=n.paint.get("model-emissive-strength").evaluate(g,{},A);h.evaluatedScale=n.paint.get("model-scale").evaluate(g,{},A),this.updatePbrBuffer(h.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(n,s,h,g){const f=n.findDEMTileFor(h);if(f&&(f.tileID.canonical!==this.terrainTile||s!==this.terrainExaggeration)){if(f.dem&&f.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=f.tileID.overscaledZ;const _=Hf.create(n,h,f);if(!_)return;this.modelTraits&Gf.HasMapboxMeshFeatures&&this.updateDEM(n,_,h,g);for(const S of this.getNodesInfo()){const A=S.node;if(!A.footprint||!A.footprint.vertices||!A.footprint.vertices.length)continue;const k=A.footprint.vertices;let x=_.getElevationAt(k[0].x,k[0].y,!0,!0);for(let I=1;I<k.length;I++)x=Math.min(x,_.getElevationAt(k[I].x,k[I].y,!0,!0));A.elevation=x}}this.terrainTile=f.tileID.canonical,this.terrainExaggeration=s}}updateDEM(n,s,h,g){let f=s._dem._modifiedForSources[g];if(f===void 0&&(s._dem._modifiedForSources[g]=[],f=s._dem._modifiedForSources[g]),f.includes(h.canonical))return;const _=s._dem.dim;f.push(h.canonical);let S=!1;for(const A of this.getNodesInfo()){const k=A.node;if(!k.footprint||!k.footprint.grid)continue;const x=k.footprint.grid,I=s.tileCoordToPixel(x.min.x,x.min.y),M=s.tileCoordToPixel(x.max.x,x.max.y),C=Math.min(Math.min(_-M.y,I.x),Math.min(I.y,_-M.x));if(C<0)continue;const P=hn(C,2,5);let O=Math.max(0,I.x-P),V=Math.max(0,I.y-P),G=Math.min(M.x+P,_-1),J=Math.min(M.y+P,_-1);for(let ue=V;ue<=J;++ue)for(let we=O;we<=G;++we)Wh[ue*_+we]=255;let ee=0,H=0;for(let ue=0;ue<x.cellsY;++ue)for(let we=0;we<x.cellsX;++we){if(!x.cells[ue*x.cellsX+we])continue;const Me=s.tileCoordToPixel(x.min.x+we/x.xScale,x.min.y+ue/x.yScale),Re=s.tileCoordToPixel(x.min.x+(we+1)/x.xScale,x.min.y+(ue+1)/x.yScale);for(let Ce=Me.y;Ce<=Math.min(Re.y+1,_-1);++Ce)for(let je=Me.x;je<=Math.min(Re.x+1,_-1);++je)Wh[Ce*_+je]===255&&(Wh[Ce*_+je]=0,ee+=s.getElevationAtPixel(je,Ce),H++)}const se=ee/H;O=Math.max(1,I.x-P),V=Math.max(1,I.y-P),G=Math.min(M.x+P,_-2),J=Math.min(M.y+P,_-2),S=!0;for(let ue=V;ue<=J;++ue)for(let we=O;we<=G;++we)Wh[ue*_+we]===0&&(Ux[ue*_+we]=s._dem.set(we,ue,se));for(let ue=1;ue<P;++ue){O=Math.max(1,I.x-ue),V=Math.max(1,I.y-ue),G=Math.min(M.x+ue,_-2),J=Math.min(M.y+ue,_-2);for(let we=V;we<=J;++we)for(let Me=O;Me<=G;++Me){const Re=we*_+Me;if(Wh[Re]===255){let Ce=0,je=0,Oe=-1,He=-1;for(let Qe=-1;Qe<=1;++Qe)for(let it=-1;it<=1;++it){const ot=(we+Qe)*_+Me+it;if(Wh[ot]>=ue)continue;const ct=Ux[ot],bt=Math.abs(ct);bt>je&&(Ce=ct,je=bt,Oe=it,He=Qe)}if(je>.1){const Qe=1-(ue+.5*Math.abs(Oe*He))/P;let it=s._dem.get(Me,we)+Ce*Qe;const ot=s._dem.get(Me+Oe,we+He),ct=s._dem.get(Me-Oe,we-He,!0);(it-ot)*(it-ct)>0&&(it=(ot+ct)/2),Ux[Re]=s._dem.set(Me,we,it),Wh[Re]=ue}}}}}S&&(s._demTile.needsDEMTextureUpload=!0,s._dem._timestamp=wn.now())}getNodesInfo(){return this.nodesInfo}destroy(){const n=this.getNodesInfo();for(const s of n)fy(s.node),Nx(s.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(n,s){if(s.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=s.updateTime;const h=s.getReplacementRegionsForTile(n.toUnwrapped()),g=this.getNodesInfo();for(let f=0;f<this.nodesInfo.length;f++){const _=g[f].node;g[f].hiddenByReplacement=!!_.footprint&&!h.find(S=>S.footprint===_.footprint)}}getHeightAtTileCoord(n,s){const h=this.getNodesInfo(),g=[],f=[0,0,0],_=Ie.mat4.identity([]);for(let S=0;S<this.nodesInfo.length;S++){const A=h[S],k=A.node.meshes[0],x=k.transformedAabb;if(n<x.min[0]||s<x.min[1]||n>x.max[0]||s>x.max[1])continue;if(A.node.hidden===!0)return{height:1/0,maxHeight:A.feature.properties.height,hidden:!1,verticalScale:A.evaluatedScale[2]};Ie.mat4.invert(_,A.node.matrix),f[0]=n,f[1]=s,Ie.vec3.transformMat4(f,f,_);const I=(f[0]-k.aabb.min[0])/(k.aabb.max[0]-k.aabb.min[0])*qh|0,M=Math.min(63,(f[1]-k.aabb.min[1])/(k.aabb.max[1]-k.aabb.min[1])*qh|0)*qh+Math.min(63,I),C=k.heightmap[M];if(!(C<0&&A.node.footprint))return A.hiddenByReplacement?void 0:{height:C,maxHeight:A.feature.properties.height,hidden:!1,verticalScale:A.evaluatedScale[2]};if(A.node.footprint.grid.query(new Ue(n,s),new Ue(n,s),g),g.length>0)return{height:void 0,maxHeight:A.feature.properties.height,hidden:A.hiddenByReplacement,verticalScale:A.evaluatedScale[2]}}}}function ug(u,n){return!u.isLightConstant&&n}function hV(u,n,s,h,g,f,_,S){let A=(61440&n|(61440&n)>>4)>>8,k=(3840&n|(3840&n)>>4)>>4,x=240&n|(240&n)>>4;s[3]>0&&(A=In(A,255*s[0],s[3]),k=In(k,255*s[1],s[3]),x=In(x,255*s[2],s[3]));const I=A<<8|k,M=x<<8|Math.floor(255*h[3]),C=function(ue){const we=hn(ue,0,2);return Math.min(Math.round(.5*we*255),255)}(h[2])<<8|15*h[0]<<4|15*h[1],P=hn(g[0],0,1),O=hn(g[1],0,1),V=hn(g[2],0,1),G=hn(g[3],0,1);let J,ee,H,se;if(P!==O&&_!==f&&O!==P){const ue=_-f;ee=1/(ue*(O-P)),H=-(f+ue*P)/(ue*(O-P));const we=hn(g[4],-1,1);se=Math.pow(10,we),J=255*V<<8|255*G}else J=65535,ee=0,H=1,se=1;if(u.emplaceBack(I,M,C,J,ee,H,se),S){const ue=S.length;S.clear();for(let we=0;we<ue;we++)S.emplaceBack(I,M,C,J,ee,H,se)}}function dV(u,n,s){const h=u.node;let g=0;const f=s&Gf.HasMeshoptCompression;for(const _ of h.meshes){if(h.lights&&h.lightMeshIndex===g||!_.featureData)continue;_.featureArray=new Pf,_.featureArray.reserve(_.featureData.length);let S=n;for(const A of _.featureData){const k=f?65535&A:A>>16&65535,x=f?A>>16&65535:65535&A,I=(15&x)<8?15&x:0,M=u.evaluatedRMEA[I],C=u.evaluatedColor[I],P=u.emissionHeightBasedParams[I];let O;if(S&&I===2&&h.lights&&(O=new Pf,O.resize(10*h.lights.length)),hV(_.featureArray,k,C,M,P,_.aabb.min[2],_.aabb.max[2],O),O&&S){S=!1;const V=h.meshes[h.lightMeshIndex];V.featureArray=O,V.featureArray._trim()}}_.featureArray._trim(),g++}}function FC(u,n,s,h){const g=1<<u.z;n.lat=ze((h/_n+u.y)/g),n.lng=Fe((s/_n+u.x)/g)}Pn(py,"Tiled3dModelBucket",{omit:["layers"]}),Pn(BC,"Tiled3dModelFeature");const fV={circle:class extends xs{constructor(u,n,s,h){super(u,{layout:Ui||(Ui=new Or({"circle-sort-key":new zn(_t.layout_circle["circle-sort-key"]),visibility:new un(_t.layout_circle.visibility)})),paint:Zr||(Zr=new Or({"circle-radius":new zn(_t.paint_circle["circle-radius"]),"circle-color":new zn(_t.paint_circle["circle-color"]),"circle-blur":new zn(_t.paint_circle["circle-blur"]),"circle-opacity":new zn(_t.paint_circle["circle-opacity"]),"circle-translate":new un(_t.paint_circle["circle-translate"]),"circle-translate-anchor":new un(_t.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new un(_t.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new un(_t.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new zn(_t.paint_circle["circle-stroke-width"]),"circle-stroke-color":new zn(_t.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new zn(_t.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new un(_t.paint_circle["circle-emissive-strength"])}))},n,s,h)}createBucket(u){return new Fn(u)}queryRadius(u){const n=u;return Lr("circle-radius",this,n)+Lr("circle-stroke-width",this,n)+Zi(this.paint.get("circle-translate"))}queryIntersectsFeature(u,n,s,h,g,f,_,S){const A=Oi(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,u.pixelToTileUnitsFactor),k=this.paint.get("circle-radius").evaluate(n,s)+this.paint.get("circle-stroke-width").evaluate(n,s);return gE(u,h,f,_,S,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",A,k)}getProgramIds(){return["circle"]}getDefaultProgramParams(u,n,s){const h=mE(this);return{config:new Oc(this,{zoom:n,lut:s}),defines:h,overrideFog:!1}}},heatmap:class extends xs{createBucket(u){return new vE(u)}constructor(u,n,s,h){super(u,{layout:yE||(yE=new Or({visibility:new un(_t.layout_heatmap.visibility)})),paint:bE||(bE=new Or({"heatmap-radius":new zn(_t.paint_heatmap["heatmap-radius"]),"heatmap-weight":new zn(_t.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new un(_t.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ga(_t.paint_heatmap["heatmap-color"]),"heatmap-opacity":new un(_t.paint_heatmap["heatmap-opacity"])}))},n,s,h),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(u){u==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=$m({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(u){return Lr("heatmap-radius",this,u)}queryIntersectsFeature(u,n,s,h,g,f,_,S){const A=this.paint.get("heatmap-radius").evaluate(n,s);return gE(u,h,f,_,S,!0,!0,new Ue(0,0),A)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(u,n,s){return u==="heatmap"?{config:new Oc(this,{zoom:n,lut:s}),overrideFog:!1}:{}}},hillshade:class extends xs{constructor(u,n,s,h){super(u,{layout:xE||(xE=new Or({visibility:new un(_t.layout_hillshade.visibility)})),paint:wE||(wE=new Or({"hillshade-illumination-direction":new un(_t.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new un(_t.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new un(_t.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new un(_t.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new un(_t.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new un(_t.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new un(_t.paint_hillshade["hillshade-emissive-strength"])}))},n,s,h)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(u,n,s){return{overrideFog:!1}}},fill:class extends xs{constructor(u,n,s,h){super(u,{layout:ME||(ME=new Or({"fill-sort-key":new zn(_t.layout_fill["fill-sort-key"]),visibility:new un(_t.layout_fill.visibility)})),paint:kE||(kE=new Or({"fill-antialias":new un(_t.paint_fill["fill-antialias"]),"fill-opacity":new zn(_t.paint_fill["fill-opacity"]),"fill-color":new zn(_t.paint_fill["fill-color"]),"fill-outline-color":new zn(_t.paint_fill["fill-outline-color"]),"fill-translate":new un(_t.paint_fill["fill-translate"]),"fill-translate-anchor":new un(_t.paint_fill["fill-translate-anchor"]),"fill-pattern":new zn(_t.paint_fill["fill-pattern"]),"fill-emissive-strength":new un(_t.paint_fill["fill-emissive-strength"]),"fill-z-offset":new zn(_t.paint_fill["fill-z-offset"])}))},n,s,h)}getProgramIds(){const u=this.paint.get("fill-pattern"),n=u&&u.constantOr(1),s=[n?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(n&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getDefaultProgramParams(u,n,s){return{config:new Oc(this,{zoom:n,lut:s}),overrideFog:!1}}recalculate(u,n){super.recalculate(u,n);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(u){return new rx(u)}queryRadius(){return Zi(this.paint.get("fill-translate"))}queryIntersectsFeature(u,n,s,h,g,f){return!u.queryGeometry.isAboveHorizon&&Yn(li(u.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,u.pixelToTileUnitsFactor),h)}isTileClipped(){return!0}is3D(){return this.paint.get("fill-z-offset").constantOr(1)!==0}},"fill-extrusion":class extends xs{constructor(u,n,s,h){super(u,{layout:dI||(dI=new Or({visibility:new un(_t["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new un(_t["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:fI||(fI=new Or({"fill-extrusion-opacity":new un(_t["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new zn(_t["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new un(_t["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new un(_t["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new zn(_t["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new zn(_t["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new zn(_t["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new un(_t["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new un(_t["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new un(_t["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new un(_t["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new un(_t["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new un(_t["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new un(_t["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new un(_t["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new zn(_t["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new zn(_t["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new un(_t["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new un(_t["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new un(_t["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new un(_t["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new zn(_t["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new zn(_t["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new un(_t["paint_fill-extrusion"]["fill-extrusion-cast-shadows"])}))},n,s,h),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(u){return new Hv(u)}queryRadius(){return Zi(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(u,n,s,h,g,f,_,S,A){const k=Oi(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,u.pixelToTileUnitsFactor),x=this.paint.get("fill-extrusion-height").evaluate(n,s),I=this.paint.get("fill-extrusion-base").evaluate(n,s),M=[0,0],C=S&&f.elevation,P=f.elevation?f.elevation.exaggeration():1,O=u.tile.getBucket(this);if(C&&O instanceof Hv){const H=O.centroidVertexArray,se=A+1;se<H.length&&(M[0]=H.geta_centroid_pos0(se),M[1]=H.geta_centroid_pos1(se))}if(M[0]===0&&M[1]===1)return!1;f.projection.name==="globe"&&(h=hI([h],[new Ue(0,0),new Ue(_n,_n)],u.tileID.canonical).map(H=>H.polygon).flat());const V=C?S:null,[G,J]=function(H,se,ue,we,Me,Re,Ce,je,Oe,He,Qe){return H.projection.name==="globe"?function(it,ot,ct,bt,ut,Ot,$t,It,En,mn,an){const Wt=[],Vn=[],Tn=it.projection.upVectorScale(an,it.center.lat,it.worldSize).metersToTile,An=[0,0,0,1],Kn=[0,0,0,1],ci=(si,pi,_i,ir)=>{si[0]=pi,si[1]=_i,si[2]=ir,si[3]=1},oi=uI();ct>0&&(ct+=oi),bt+=oi;for(const si of ot){const pi=[],_i=[];for(const ir of si){const ji=ir.x+ut.x,Jn=ir.y+ut.y,Bi=it.projection.projectTilePoint(ji,Jn,an),Fi=it.projection.upVector(an,ir.x,ir.y);let _r=ct,Jr=bt;if($t){const mo=mI(ji,Jn,ct,bt,$t,It,En,mn);_r+=mo.base,Jr+=mo.top}ct!==0?ci(An,Bi.x+Fi[0]*Tn*_r,Bi.y+Fi[1]*Tn*_r,Bi.z+Fi[2]*Tn*_r):ci(An,Bi.x,Bi.y,Bi.z),ci(Kn,Bi.x+Fi[0]*Tn*Jr,Bi.y+Fi[1]*Tn*Jr,Bi.z+Fi[2]*Tn*Jr),Ie.vec3.transformMat4(An,An,Ot),Ie.vec3.transformMat4(Kn,Kn,Ot),pi.push(new Hh(An[0],An[1],An[2])),_i.push(new Hh(Kn[0],Kn[1],Kn[2]))}Wt.push(pi),Vn.push(_i)}return[Wt,Vn]}(H,se,ue,we,Me,Re,Ce,je,Oe,He,Qe):Ce?function(it,ot,ct,bt,ut,Ot,$t,It,En){const mn=[],an=[],Wt=[0,0,0,1];for(const Vn of it){const Tn=[],An=[];for(const Kn of Vn){const ci=Kn.x+bt.x,oi=Kn.y+bt.y,si=mI(ci,oi,ot,ct,Ot,$t,It,En);Wt[0]=ci,Wt[1]=oi,Wt[2]=si.base,Wt[3]=1,Ie.vec4.transformMat4(Wt,Wt,ut),Wt[3]=Math.max(Wt[3],1e-5);const pi=new Hh(Wt[0]/Wt[3],Wt[1]/Wt[3],Wt[2]/Wt[3]);Wt[0]=ci,Wt[1]=oi,Wt[2]=si.top,Wt[3]=1,Ie.vec4.transformMat4(Wt,Wt,ut),Wt[3]=Math.max(Wt[3],1e-5);const _i=new Hh(Wt[0]/Wt[3],Wt[1]/Wt[3],Wt[2]/Wt[3]);Tn.push(pi),An.push(_i)}mn.push(Tn),an.push(An)}return[mn,an]}(se,ue,we,Me,Re,Ce,je,Oe,He):function(it,ot,ct,bt,ut){const Ot=[],$t=[],It=ut[8]*ot,En=ut[9]*ot,mn=ut[10]*ot,an=ut[11]*ot,Wt=ut[8]*ct,Vn=ut[9]*ct,Tn=ut[10]*ct,An=ut[11]*ct;for(const Kn of it){const ci=[],oi=[];for(const si of Kn){const pi=si.x+bt.x,_i=si.y+bt.y,ir=ut[0]*pi+ut[4]*_i+ut[12],ji=ut[1]*pi+ut[5]*_i+ut[13],Jn=ut[2]*pi+ut[6]*_i+ut[14],Bi=ut[3]*pi+ut[7]*_i+ut[15],Fi=ir+It,_r=ji+En,Jr=Jn+mn,mo=Math.max(Bi+an,1e-5),Qr=ir+Wt,Gr=ji+Vn,Wo=Jn+Tn,yo=Math.max(Bi+An,1e-5);ci.push(new Hh(Fi/mo,_r/mo,Jr/mo)),oi.push(new Hh(Qr/yo,Gr/yo,Wo/yo))}Ot.push(ci),$t.push(oi)}return[Ot,$t]}(se,ue,we,Me,Re)}(f,h,I,x,k,_,V,M,P,f.center.lat,u.tileID.canonical),ee=u.queryGeometry;return function(H,se,ue){let we=1/0;Yn(ue,se)&&(we=pI(ue,se[0]));for(let Me=0;Me<se.length;Me++){const Re=se[Me],Ce=H[Me];for(let je=0;je<Re.length-1;je++){const Oe=Re[je],He=[Oe,Re[je+1],Ce[je+1],Ce[je],Oe];pn(ue,He)&&(we=Math.min(we,pI(ue,He)))}}return we!==1/0&&we}(G,J,ee.isPointQuery()?ee.screenBounds:ee.screenGeometry)}},line:class extends xs{constructor(u,n,s,h){const g=EI();super(u,g,n,s,h),g.layout&&(this.layout=new bu(g.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(u){if(u==="line-gradient"){const n=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=n._styleExpression&&n._styleExpression.expression instanceof Sh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(u,n){super.recalculate(u,n),this.paint._values["line-floorwidth"]=(()=>{if(Jm)return Jm;const s=EI();return Jm=new gF(s.paint.properties["line-width"].specification),Jm.useIntegerZoom=!0,Jm})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)}createBucket(u){return new px(u)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(u,n,s){const h=SI(this);return{config:new Oc(this,{zoom:n,lut:s}),defines:h,overrideFog:!1}}queryRadius(u){const n=u,s=II(Lr("line-width",this,n),Lr("line-gap-width",this,n)),h=Lr("line-offset",this,n);return s/2+Math.abs(h)+Zi(this.paint.get("line-translate"))}queryIntersectsFeature(u,n,s,h,g,f){if(u.queryGeometry.isAboveHorizon)return!1;const _=li(u.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,u.pixelToTileUnitsFactor),S=u.pixelToTileUnitsFactor/2*II(this.paint.get("line-width").evaluate(n,s),this.paint.get("line-gap-width").evaluate(n,s)),A=this.paint.get("line-offset").evaluate(n,s);return A&&(h=function(k,x){const I=[],M=new Ue(0,0);for(let C=0;C<k.length;C++){const P=k[C],O=[];for(let V=0;V<P.length;V++){const G=P[V],J=P[V+1],ee=V===0?M:G.sub(P[V-1])._unit()._perp(),H=V===P.length-1?M:J.sub(G)._unit()._perp(),se=ee._add(H)._unit();se._mult(1/(se.x*H.x+se.y*H.y)),O.push(se._mult(x)._add(G))}I.push(O)}return I}(h,A*u.pixelToTileUnitsFactor)),function(k,x,I){for(let M=0;M<x.length;M++){const C=x[M];if(k.length>=3){for(let P=0;P<C.length;P++)if(gr(k,C[P]))return!0}if(Dn(k,C,I))return!0}return!1}(_,h,S)}isTileClipped(){return!0}isDraped(u){const n=this.layout.get("line-z-offset");return n.isConstant()&&!n.constantOr(0)}},symbol:sy,background:class extends xs{constructor(u,n,s,h){super(u,{layout:cC||(cC=new Or({visibility:new un(_t.layout_background.visibility)})),paint:uC||(uC=new Or({"background-pitch-alignment":new un(_t.paint_background["background-pitch-alignment"]),"background-color":new un(_t.paint_background["background-color"]),"background-pattern":new un(_t.paint_background["background-pattern"]),"background-opacity":new un(_t.paint_background["background-opacity"]),"background-emissive-strength":new un(_t.paint_background["background-emissive-strength"])}))},n,s,h)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(u,n,s){return{overrideFog:!1}}is3D(){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:mC,"raster-particle":xC,sky:class extends xs{constructor(u,n,s,h){super(u,{layout:vC||(vC=new Or({visibility:new un(_t.layout_sky.visibility)})),paint:yC||(yC=new Or({"sky-type":new un(_t.paint_sky["sky-type"]),"sky-atmosphere-sun":new un(_t.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new un(_t.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new un(_t.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new un(_t.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ga(_t.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new un(_t.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new un(_t.paint_sky["sky-atmosphere-color"]),"sky-opacity":new un(_t.paint_sky["sky-opacity"])}))},n,s,h),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(u){u==="sky-gradient"?this._updateColorRamp():u!=="sky-atmosphere-sun"&&u!=="sky-atmosphere-halo-color"&&u!=="sky-atmosphere-color"&&u!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=$m({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(u){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const n=u.style.light.properties.get("position");return this._lightPosition.azimuthal!==n.azimuthal||this._lightPosition.polar!==n.polar}return!1}getCenter(u,n){if(this.paint.get("sky-type")==="atmosphere"){const h=this.paint.get("sky-atmosphere-sun"),g=!h,f=u.style.light,_=f.properties.get("position");return g&&f.properties.get("anchor")==="viewport"&&ii("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),g?Lx(_.azimuthal,90-_.polar,n):Lx(h[0],90-h[1],n)}const s=this.paint.get("sky-gradient-center");return Lx(s[0],90-s[1],n)}isSky(){return!0}markSkyboxValid(u){this._skyboxInvalidated=!1,this._lightPosition=u.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const u=this.paint.get("sky-type");return u==="atmosphere"?["skyboxCapture","skybox"]:u==="gradient"?["skyboxGradient"]:null}},slot:class extends xs{constructor(u,n,s,h){super(u,{paint:bC||(bC=new Or({}))},n,null)}},model:class extends xs{constructor(u,n,s,h){super(u,{layout:kC||(kC=new Or({visibility:new un(_t.layout_model.visibility),"model-id":new zn(_t.layout_model["model-id"])})),paint:RC||(RC=new Or({"model-opacity":new un(_t.paint_model["model-opacity"]),"model-rotation":new zn(_t.paint_model["model-rotation"]),"model-scale":new zn(_t.paint_model["model-scale"]),"model-translation":new zn(_t.paint_model["model-translation"]),"model-color":new zn(_t.paint_model["model-color"]),"model-color-mix-intensity":new zn(_t.paint_model["model-color-mix-intensity"]),"model-type":new un(_t.paint_model["model-type"]),"model-cast-shadows":new un(_t.paint_model["model-cast-shadows"]),"model-receive-shadows":new un(_t.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new un(_t.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new zn(_t.paint_model["model-emissive-strength"]),"model-roughness":new zn(_t.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new zn(_t.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new un(_t.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new un(_t.paint_model["model-front-cutoff"])}))},n,s,h),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(u){return new Fx(u)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(u){return u instanceof py?_n-1:0}queryIntersectsFeature(u,n,s,h,g,f){if(!this.modelManager)return!1;const _=this.modelManager,S=u.tile.getBucket(this);if(!(S&&S instanceof Fx))return!1;const A=S;for(const k in A.instancesPerModel){const x=A.instancesPerModel[k],I=n.id!==void 0?n.id:n.properties&&n.properties.hasOwnProperty("id")?n.properties.id:void 0;if(x.idToFeaturesIndex.hasOwnProperty(I)){const M=x.features[x.idToFeaturesIndex[I]],C=_.getModel(k,this.scope);if(!C)return!1;let P=Ie.mat4.create();const O=new Q(0,0),V=A.canonical;let G=Number.MAX_VALUE;for(let J=0;J<M.instancedDataCount;++J){const ee=16*(M.instancedDataOffset+J),H=x.instancedDataArray.float32,se=[H[ee+4],H[ee+5],H[ee+6]];FC(V,O,H[ee],0|H[ee+1]),DC(P,C,f,O,M.rotation,M.scale,se,!1,!1,!1),f.projection.name==="globe"&&(P=Bx(P,f));const ue=Ie.mat4.multiply([],f.projMatrix,P),we=u.queryGeometry,Me=IC(we.isPointQuery()?we.screenBounds:we.screenGeometry,f,ue,C.aabb);Me!=null&&(G=Math.min(Me,G))}return G!==Number.MAX_VALUE&&G}}return!1}_handleOverridablePaintPropertyUpdate(u,n,s){return!(!this.layout||n.isDataDriven()||s.isDataDriven()||u!=="model-color"&&u!=="model-color-mix-intensity"&&u!=="model-rotation"&&u!=="model-scale"&&u!=="model-translation"&&u!=="model-emissive-strength")}_isPropertyZoomDependent(u){const n=this._transitionablePaint._values[u];return n!=null&&n.value!=null&&n.value.expression!=null&&n.value.expression instanceof il}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(u,n,s,h){const g=u.tile,f=g.getBucket(this);let _=null,S=Number.MAX_VALUE;if(!(f&&f instanceof py))return{queryFeature:_,intersectionZ:S};const A=f.getNodesInfo()[n];if(A.hiddenByReplacement||!A.node.meshes||!s.filter(new qr(g.tileID.overscaledZ),A.feature,g.tileID.canonical))return{queryFeature:_,intersectionZ:S};const k=A.node,x=h.calculatePosMatrix(g.tileID.toUnwrapped(),h.worldSize),I=A.evaluatedScale;let M=0;h.elevation&&k.elevation&&(M=k.elevation*h.elevation.exaggeration()),Ie.mat4.translate(x,x,[(k.anchor?k.anchor[0]:0)*(I[0]-1),(k.anchor?k.anchor[1]:0)*(I[1]-1),M]),Ie.mat4.scale(x,x,I),Ie.mat4.multiply(x,x,k.matrix);const C=u.queryGeometry,P=C.isPointQuery()?C.screenBounds:C.screenGeometry,O=function(G){const J=Ie.mat4.multiply([],x,G.matrix),ee=Ie.mat4.multiply(J,h.expandedFarZProjMatrix,J);for(let H=0;H<G.meshes.length;++H){const se=G.meshes[H];if(H===G.lightMeshIndex)continue;const ue=IC(P,h,ee,se.aabb);ue!=null&&(S=Math.min(ue,S))}if(G.children)for(const H of G.children)O(H)};if(O(k),S===Number.MAX_VALUE)return{queryFeature:_,intersectionZ:S};const V=new Q(0,0);return FC(g.tileID.canonical,V,A.node.anchor[0],A.node.anchor[1]),_={type:"Feature",geometry:{type:"Point",coordinates:[V.lng,V.lat]},properties:A.feature.properties,id:A.feature.id,state:{},layer:this.serialize()},{queryFeature:_,intersectionZ:S}}},clip:class extends xs{constructor(u,n,s,h){super(u,{layout:RE||(RE=new Or({"clip-layer-types":new un(_t.layout_clip["clip-layer-types"]),"clip-layer-scope":new un(_t.layout_clip["clip-layer-scope"])})),paint:DE||(DE=new Or({}))},n,s,h)}recalculate(u,n){super.recalculate(u,n)}createBucket(u){return new OE(u)}isTileClipped(){return!0}is3D(){return!0}}};class pV{constructor(n){this._callback=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class mV{constructor(){this.tasks={},this.taskQueue=[],zr(["process"],this),this.invoker=new pV(this.process),this.nextId=0}add(n,s){const h=this.nextId++,g=function({type:f,isSymbolTile:_,zoom:S}){return S=S||0,f==="message"?0:f!=="maybePrepare"||_?f!=="parseTile"||_?f==="parseTile"&&_?300-S:f==="maybePrepare"&&_?400-S:500:200-S:100-S}(s);if(g===0){try{n()}finally{}return null}return this.tasks[h]={fn:n,metadata:s,priority:g,id:h},this.taskQueue.push(h),this.invoker.trigger(),{cancel:()=>{delete this.tasks[h]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(h=>!!this.tasks[h]),!this.taskQueue.length)return;const n=this.pick();if(n===null)return;const s=this.tasks[n];if(delete this.tasks[n],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let n=null,s=1/0;for(let g=0;g<this.taskQueue.length;g++){const f=this.tasks[this.taskQueue[g]];f.priority<s&&(s=f.priority,n=g)}if(n===null)return null;const h=this.taskQueue[n];return this.taskQueue.splice(n,1),h}remove(){this.invoker.remove()}}class VC{constructor(n,s,h){this.target=n,this.parent=s,this.mapId=h,this.callbacks={},this.cancelCallbacks={},zr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new mV}send(n,s,h,g,f=!1,_){const S=Math.round(1e18*Math.random()).toString(36).substring(0,10);h&&(h.metadata=_,this.callbacks[S]=h);const A=new Set;return this.target.postMessage({id:S,type:n,hasCallback:!!h,targetMapId:g,mustQueue:f,sourceMapId:this.mapId,data:$s(s,A)},A),{cancel:()=>{h&&delete this.callbacks[S],this.target.postMessage({id:S,type:"<cancel>",targetMapId:g,sourceMapId:this.mapId})}}}receive(n){const s=n.data,h=s.id;if(h&&(!s.targetMapId||this.mapId===s.targetMapId))if(s.type==="<cancel>"){const g=this.cancelCallbacks[h];delete this.cancelCallbacks[h],g&&g.cancel()}else if(s.mustQueue||Eo()){const g=this.callbacks[h],f=this.scheduler.add(()=>this.processTask(h,s),g&&g.metadata||{type:"message"});f&&(this.cancelCallbacks[h]=f)}else this.processTask(h,s)}processTask(n,s){if(delete this.cancelCallbacks[n],s.type==="<response>"){const h=this.callbacks[n];delete this.callbacks[n],h&&(s.error?h(Pc(s.error)):h(null,Pc(s.data)))}else{const h=new Set,g=s.hasCallback?(_,S)=>{this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:_?$s(_):null,data:$s(S,h)},h)}:_=>{},f=Pc(s.data);if(this.parent[s.type])this.parent[s.type](s.sourceMapId,f,g);else if(this.parent.getWorkerSource){const _=s.type.split(".");this.parent.getWorkerSource(s.sourceMapId,_[0],f.source,f.scope)[_[1]](f,g)}else g(new Error(`Could not find function ${s.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class qf{constructor(n,s){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=wr();const h=this.workerPool.acquire(this.id);for(let g=0;g<h.length;g++){const f=new qf.Actor(h[g],s,this.id);f.name=`Worker ${g}`,this.actors.push(f)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,s,h){ki(this.actors,(g,f)=>{g.send(n,s,f)},h=h||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}qf.Actor=VC;class NC{constructor(n){this.size=n,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(n,s){const h=this.toIdx(n,s);return{min:this.minimums[h],max:this.maximums[h]}}isLeaf(n,s){return this.leaves[this.toIdx(n,s)]}toIdx(n,s){return s*this.size+n}}function UC(u,n,s,h){let g=0,f=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(h[_])<1e-15){if(s[_]<u[_]||s[_]>n[_])return null}else{const S=1/h[_];let A=(u[_]-s[_])*S,k=(n[_]-s[_])*S;if(A>k){const x=A;A=k,k=x}if(A>g&&(g=A),k<f&&(f=k),g>f)return null}return g}function jC(u,n,s,h,g,f,_,S,A,k,x){const I=h-u,M=g-n,C=f-s,P=_-u,O=S-n,V=A-s,G=x[1]*V-x[2]*O,J=x[2]*P-x[0]*V,ee=x[0]*O-x[1]*P,H=I*G+M*J+C*ee;if(Math.abs(H)<1e-15)return null;const se=1/H,ue=k[0]-u,we=k[1]-n,Me=k[2]-s,Re=(ue*G+we*J+Me*ee)*se;if(Re<0||Re>1)return null;const Ce=we*C-Me*M,je=Me*I-ue*C,Oe=ue*M-we*I,He=(x[0]*Ce+x[1]*je+x[2]*Oe)*se;return He<0||Re+He>1?null:(P*Ce+O*je+V*Oe)*se}function $C(u,n,s){return(u-n)/(s-n)}function GC(u,n,s,h,g,f,_,S,A){const k=1<<s,x=f-h,I=_-g,M=(u+1)/k*x+h,C=(n+0)/k*I+g,P=(n+1)/k*I+g;S[0]=(u+0)/k*x+h,S[1]=C,A[0]=M,A[1]=P}class HC{constructor(n){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=n,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(f){const _=Math.ceil(Math.log2(f.dim/8)),S=[];let A=Math.ceil(Math.pow(2,_));const k=1/A,x=(C,P,O,V,G)=>{const J=V?1:0,ee=(C+1)*O-J,H=P*O,se=(P+1)*O-J;G[0]=C*O,G[1]=H,G[2]=ee,G[3]=se};let I=new NC(A);const M=[];for(let C=0;C<A*A;C++){x(C%A,Math.floor(C/A),k,!1,M);const P=Fu(M[0],M[1],f),O=Fu(M[2],M[1],f),V=Fu(M[2],M[3],f),G=Fu(M[0],M[3],f);I.minimums.push(Math.min(P,O,V,G)),I.maximums.push(Math.max(P,O,V,G)),I.leaves.push(1)}for(S.push(I),A/=2;A>=1;A/=2){const C=S[S.length-1];I=new NC(A);for(let P=0;P<A*A;P++){x(P%A,Math.floor(P/A),2,!0,M);const O=C.getElevation(M[0],M[1]),V=C.getElevation(M[2],M[1]),G=C.getElevation(M[2],M[3]),J=C.getElevation(M[0],M[3]),ee=C.isLeaf(M[0],M[1]),H=C.isLeaf(M[2],M[1]),se=C.isLeaf(M[2],M[3]),ue=C.isLeaf(M[0],M[3]),we=Math.min(O.min,V.min,G.min,J.min),Me=Math.max(O.max,V.max,G.max,J.max),Re=ee&&H&&se&&ue;I.maximums.push(Me),I.minimums.push(we),I.leaves.push(Me-we<=5&&Re?1:0)}S.push(I)}return S}(this.dem),h=s.length-1,g=s[h];this._addNode(g.minimums[0],g.maximums[0],g.leaves[0]),this._construct(s,0,0,h,0)}raycastRoot(n,s,h,g,f,_,S=1){return UC([n,s,-100],[h,g,this.maximums[0]*S],f,_)}raycast(n,s,h,g,f,_,S=1){if(!this.nodeCount)return null;const A=this.raycastRoot(n,s,h,g,f,_,S);if(A==null)return null;const k=[],x=[],I=[],M=[],C=[{idx:0,t:A,nodex:0,nodey:0,depth:0}];for(;C.length>0;){const{idx:P,t:O,nodex:V,nodey:G,depth:J}=C.pop();if(this.leaves[P]){GC(V,G,J,n,s,h,g,I,M);const H=1<<J,se=(V+0)/H,ue=(V+1)/H,we=(G+0)/H,Me=(G+1)/H,Re=Fu(se,we,this.dem)*S,Ce=Fu(ue,we,this.dem)*S,je=Fu(ue,Me,this.dem)*S,Oe=Fu(se,Me,this.dem)*S,He=jC(I[0],I[1],Re,M[0],I[1],Ce,M[0],M[1],je,f,_),Qe=jC(M[0],M[1],je,I[0],M[1],Oe,I[0],I[1],Re,f,_),it=Math.min(He!==null?He:Number.MAX_VALUE,Qe!==null?Qe:Number.MAX_VALUE);if(it!==Number.MAX_VALUE)return it;{const ot=Ie.vec3.scaleAndAdd([],f,_,O);if(qC(Re,Ce,Oe,je,$C(ot[0],I[0],M[0]),$C(ot[1],I[1],M[1]))>=ot[2])return O}continue}let ee=0;for(let H=0;H<this._siblingOffset.length;H++){GC((V<<1)+this._siblingOffset[H][0],(G<<1)+this._siblingOffset[H][1],J+1,n,s,h,g,I,M),I[2]=-100,M[2]=this.maximums[this.childOffsets[P]+H]*S;const se=UC(I,M,f,_);if(se!=null){const ue=se;k[H]=ue;let we=!1;for(let Me=0;Me<ee&&!we;Me++)ue>=k[x[Me]]&&(x.splice(Me,0,H),we=!0);we||(x[ee]=H),ee++}}for(let H=0;H<ee;H++){const se=x[H];C.push({idx:this.childOffsets[P]+se,t:k[se],nodex:(V<<1)+this._siblingOffset[se][0],nodey:(G<<1)+this._siblingOffset[se][1],depth:J+1})}}return null}_addNode(n,s,h){return this.minimums.push(n),this.maximums.push(s),this.leaves.push(h),this.childOffsets.push(0),this.nodeCount++}_construct(n,s,h,g,f){if(n[g].isLeaf(s,h)===1)return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const _=g-1,S=n[_];let A=0,k=0;for(let x=0;x<this._siblingOffset.length;x++){const I=2*s+this._siblingOffset[x][0],M=2*h+this._siblingOffset[x][1],C=S.getElevation(I,M),P=S.isLeaf(I,M),O=this._addNode(C.min,C.max,P);P&&(A|=1<<x),k||(k=O)}for(let x=0;x<this._siblingOffset.length;x++)A&1<<x||this._construct(n,2*s+this._siblingOffset[x][0],2*h+this._siblingOffset[x][1],_,k+x)}}function qC(u,n,s,h,g,f){return In(In(u,s,f),In(n,h,f),g)}function Fu(u,n,s){const h=s.dim,g=hn(u*h-.5,0,h-1),f=hn(n*h-.5,0,h-1),_=Math.floor(g),S=Math.floor(f),A=Math.min(_+1,h-1),k=Math.min(S+1,h-1);return qC(s.get(_,S),s.get(A,S),s.get(_,k),s.get(A,k),g-_,f-S)}const gV={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function _V(u,n,s){return(256*u*256+256*n+s)/10-1e4}function vV(u,n,s){return 256*u+n+s/256-32768}class my{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(n,s,h,g=!1){if(this.uid=n,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(h&&h!=="mapbox"&&h!=="terrarium")return void ii(`"${h}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const f=this.dim=s.height-2,_=new Uint32Array(s.data.buffer);if(this.pixels=new Uint8Array(s.data.buffer),this.floatView=new Float32Array(s.data.buffer),this.borderReady=g,this._modifiedForSources={},!g){for(let A=0;A<f;A++)_[this._idx(-1,A)]=_[this._idx(0,A)],_[this._idx(f,A)]=_[this._idx(f-1,A)],_[this._idx(A,-1)]=_[this._idx(A,0)],_[this._idx(A,f)]=_[this._idx(A,f-1)];_[this._idx(-1,-1)]=_[this._idx(0,0)],_[this._idx(f,-1)]=_[this._idx(f-1,0)],_[this._idx(-1,f)]=_[this._idx(0,f-1)],_[this._idx(f,f)]=_[this._idx(f-1,f-1)]}const S=h==="terrarium"?vV:_V;for(let A=0;A<_.length;++A){const k=4*A;this.floatView[A]=S(this.pixels[k],this.pixels[k+1],this.pixels[k+2])}this._timestamp=wn.now()}_buildQuadTree(){this._tree=new HC(this)}get(n,s,h=!1){h&&(n=hn(n,-1,this.dim),s=hn(s,-1,this.dim));const g=this._idx(n,s);return this.floatView[g]}set(n,s,h){const g=this._idx(n,s),f=this.floatView[g];return this.floatView[g]=h,h-f}static getUnpackVector(n){return gV[n]}_idx(n,s){if(n<-1||n>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(n+1)}static pack(n,s){const h=[0,0,0,0],g=my.getUnpackVector(s);let f=Math.floor((n+g[3])/g[2]);return h[2]=f%256,f=Math.floor(f/256),h[1]=f%256,f=Math.floor(f/256),h[0]=f,h}getPixels(){return new EE({width:this.stride,height:this.stride},this.pixels)}backfillBorder(n,s,h){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let g=s*this.dim,f=s*this.dim+this.dim,_=h*this.dim,S=h*this.dim+this.dim;switch(s){case-1:g=f-1;break;case 1:f=g+1}switch(h){case-1:_=S-1;break;case 1:S=_+1}const A=-s*this.dim,k=-h*this.dim;for(let x=_;x<S;x++)for(let I=g;I<f;I++){const M=4*this._idx(I,x),C=4*this._idx(I+A,x+k);this.pixels[M+0]=n.pixels[C+0],this.pixels[M+1]=n.pixels[C+1],this.pixels[M+2]=n.pixels[C+2],this.pixels[M+3]=n.pixels[C+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function yV(u,n,s){u===1?n.header_length=s.readFixed32():u===2?n.x=s.readVarint():u===3?n.y=s.readVarint():u===4?n.z=s.readVarint():u===5&&n.layers.push(function(h,g){return h.readFields(TV,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},g)}(s,s.readVarint()+s.pos))}function bV(u,n,s){u===1?(n.delta_filter=function(h,g){return h.readFields(xV,{block_size:0},g)}(s,s.readVarint()+s.pos),n.filter="delta_filter"):u===2?(s.readVarint(),n.filter="zigzag_filter"):u===3?(s.readVarint(),n.filter="bitshuffle_filter"):u===4&&(s.readVarint(),n.filter="byteshuffle_filter")}function xV(u,n,s){u===1&&(n.block_size=s.readVarint())}function wV(u,n,s){u===1?(s.readVarint(),n.codec="gzip_data"):u===2?(s.readVarint(),n.codec="jpeg_image"):u===3?(s.readVarint(),n.codec="webp_image"):u===4&&(s.readVarint(),n.codec="png_image")}function SV(u,n,s){u===1?n.first_byte=s.readFixed64():u===2?n.last_byte=s.readFixed64():u===3?n.filters.push(function(h,g){return h.readFields(bV,{},g)}(s,s.readVarint()+s.pos)):u===4?n.codec=function(h,g){return h.readFields(wV,{},g)}(s,s.readVarint()+s.pos):u===5?n.deprecated_offset=s.readFloat():u===6?n.deprecated_scale=s.readFloat():u===7?n.bands.push(s.readString()):u===8?n.offset=s.readDouble():u===9&&(n.scale=s.readDouble())}function TV(u,n,s){u===1?n.version=s.readVarint():u===2?n.name=s.readString():u===3?n.units=s.readString():u===4?n.tilesize=s.readVarint():u===5?n.buffer=s.readVarint():u===6?n.pixel_format=s.readVarint():u===7&&n.data_index.push(function(h,g){return h.readFields(SV,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,deprecated_offset:0,deprecated_scale:0,bands:[]},g)}(s,s.readVarint()+s.pos))}function EV(u,n,s){if(u===2)(function(h,g,f){h.readFields(IV,f,g)})(s,s.readVarint()+s.pos,n);else if(u===3)throw new Error("Not implemented")}function IV(u,n,s){if(u===1){let h=0;const g=s.readVarint()+s.pos;for(;s.pos<g;)n[h++]=s.readVarint()}}Pn(my,"DEMData"),Pn(HC,"DemMinMaxQuadTree",{omit:["dem"]});class CV{constructor(n){this.capacity=n,this.cache=new Map}get(n){if(!this.cache.has(n))return;const s=this.cache.get(n);return this.cache.delete(n),this.cache.set(n,s),s}put(n,s){this.cache.has(n)?this.cache.delete(n):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(n,s)}}function AV(u,n){if(n.length!==4)throw new Error(`Expected data of dimension 4 but got ${n.length}.`);let s=n[3];for(let h=2;h>=1;h--){const g=h===1?1:0,f=h===2?1:0;for(let _=0;_<n[0];_++){const S=n[1]*_;for(let A=g;A<n[1];A++){const k=n[2]*(A+S);for(let x=f;x<n[2];x++){const I=n[3]*(x+k);for(let M=0;M<n[3];M++){const C=I+M;u[C]+=u[C-s]}}}}s*=n[h]}return u}function PV(u){for(let n=0,s=u.length;n<s;n++)u[n]=u[n]>>>1^-(1&u[n]);return u}function MV(u,n){switch(n){case"uint32":return u;case"uint16":for(let s=0;s<u.length;s+=2){const h=u[s],g=u[s+1];u[s]=(240&h)>>4|(61440&h)>>8|(240&g)<<4|61440&g,u[s+1]=15&h|(3840&h)>>4|(15&g)<<8|(3840&g)<<4}return u;case"uint8":for(let s=0;s<u.length;s+=4){const h=u[s],g=u[s+1],f=u[s+2],_=u[s+3];u[s+0]=(192&h)>>6|(192&g)>>4|(192&f)>>2|192&_,u[s+1]=(48&h)>>4|(48&g)>>2|48&f|(48&_)<<2,u[s+2]=(12&h)>>2|12&g|(12&f)<<2|(12&_)<<4,u[s+3]=3&h|(3&g)<<2|(3&f)<<4|(3&_)<<6}return u;default:throw new Error(`Invalid pixel format, "${n}"`)}}var Za=Uint8Array,hg=Uint16Array,kV=Int32Array,WC=new Za([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ZC=new Za([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),RV=new Za([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),XC=function(u,n){for(var s=new hg(31),h=0;h<31;++h)s[h]=n+=1<<u[h-1];var g=new kV(s[30]);for(h=1;h<30;++h)for(var f=s[h];f<s[h+1];++f)g[f]=f-s[h]<<5|h;return{b:s,r:g}},YC=XC(WC,2),KC=YC.b,DV=YC.r;KC[28]=258,DV[258]=28;for(var OV=XC(ZC,0).b,JC=new hg(32768),po=0;po<32768;++po){var Wf=(43690&po)>>1|(21845&po)<<1;JC[po]=((65280&(Wf=(61680&(Wf=(52428&Wf)>>2|(13107&Wf)<<2))>>4|(3855&Wf)<<4))>>8|(255&Wf)<<8)>>1}var dg=function(u,n,s){for(var h=u.length,g=0,f=new hg(n);g<h;++g)u[g]&&++f[u[g]-1];var _,S=new hg(n);for(g=1;g<n;++g)S[g]=S[g-1]+f[g-1]<<1;_=new hg(1<<n);var A=15-n;for(g=0;g<h;++g)if(u[g])for(var k=g<<4|u[g],x=n-u[g],I=S[u[g]-1]++<<x,M=I|(1<<x)-1;I<=M;++I)_[JC[I]>>A]=k;return _},fg=new Za(288);for(po=0;po<144;++po)fg[po]=8;for(po=144;po<256;++po)fg[po]=9;for(po=256;po<280;++po)fg[po]=7;for(po=280;po<288;++po)fg[po]=8;var QC=new Za(32);for(po=0;po<32;++po)QC[po]=5;var LV=dg(fg,9),zV=dg(QC,5),jx=function(u){for(var n=u[0],s=1;s<u.length;++s)u[s]>n&&(n=u[s]);return n},Rl=function(u,n,s){var h=n/8|0;return(u[h]|u[h+1]<<8)>>(7&n)&s},$x=function(u,n){var s=n/8|0;return(u[s]|u[s+1]<<8|u[s+2]<<16)>>(7&n)},BV=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Dl=function(u,n,s){var h=new Error(n||BV[u]);if(h.code=u,Error.captureStackTrace&&Error.captureStackTrace(h,Dl),!s)throw h;return h},FV=new Za(0),VV=typeof TextDecoder<"u"&&new TextDecoder;try{VV.decode(FV,{stream:!0})}catch{}const NV={gzip_data:"gzip"};class ll extends Error{constructor(n){super(n),this.name="MRTError"}}const UV={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},eA={uint32:1,uint16:2,uint8:4},jV={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let Gx;class Hx{constructor(n=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=n}getLayer(n){const s=this.layers[n];if(!s)throw new ll(`Layer '${n}' not found`);return s}getHeaderLength(n){const s=new Uint8Array(n),h=new DataView(n);if(s[0]!==13)throw new ll("File is not a valid MRT.");return h.getUint32(1,!0)}parseHeader(n){const s=new Uint8Array(n),h=this.getHeaderLength(n);if(s.length<h)throw new ll(`Expected header with length >= ${h} but got buffer of length ${s.length}`);const g=function(f,_){return f.readFields(yV,{header_length:0,x:0,y:0,z:0,layers:[]},void 0)}(new Gx(s.subarray(0,h)));if(!isNaN(this.x)&&(this.x!==g.x||this.y!==g.y||this.z!==g.z))throw new ll(`Invalid attempt to parse header ${g.z}/${g.x}/${g.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=g.x,this.y=g.y,this.z=g.z;for(const f of g.layers)this.layers[f.name]=new $V(f,{cacheSize:this._cacheSize});return this}createDecodingTask(n){const s=[],h=this.getLayer(n.layerName);for(let g of n.blockIndices){const f=h.dataIndex[g],_=f.first_byte-n.firstByte,S=f.last_byte-n.firstByte;if(h._blocksInProgress.has(g))continue;const A={layerName:h.name,firstByte:_,lastByte:S,pixelFormat:h.pixelFormat,blockIndex:g,blockShape:[f.bands.length].concat(h.bandShape),buffer:h.buffer,codec:f.codec.codec,filters:f.filters.map(k=>k.filter)};h._blocksInProgress.add(g),s.push(A)}return new tA(s,()=>{s.forEach(g=>h._blocksInProgress.delete(g.blockIndex))},(g,f)=>{if(s.forEach(_=>h._blocksInProgress.delete(_.blockIndex)),g)throw g;f.forEach(_=>{this.getLayer(_.layerName).processDecodedData(_)})})}}class $V{constructor({version:n,name:s,units:h,tilesize:g,pixel_format:f,buffer:_,data_index:S},A){if(this.version=n,this.version!==1)throw new ll(`Cannot parse raster layer encoded with MRT version ${n}`);this.name=s,this.units=h,this.tileSize=g,this.buffer=_,this.pixelFormat=UV[f],this.dataIndex=S,this.bandShape=[g+2*_,g+2*_,eA[this.pixelFormat]],this._decodedBlocks=new CV(A?A.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return eA[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:n})=>n).flat()}processDecodedData(n){const s=n.blockIndex.toString();this._decodedBlocks.get(s)||this._decodedBlocks.put(s,n.data)}getBlockForBand(n){let s=0;switch(typeof n){case"string":for(const[h,g]of this.dataIndex.entries()){for(const[f,_]of g.bands.entries())if(_===n)return{bandIndex:s+f,blockIndex:h,blockBandIndex:f};s+=g.bands.length}break;case"number":for(const[h,g]of this.dataIndex.entries()){if(n>=s&&n<s+g.bands.length)return{bandIndex:n,blockIndex:h,blockBandIndex:n-s};s+=g.bands.length}break;default:throw new ll(`Invalid band \`${JSON.stringify(n)}\`. Expected string or integer.`)}throw new ll(`Band not found: ${JSON.stringify(n)}`)}getDataRange(n){let s=1/0,h=-1/0;const g=[],f=new Set;for(const _ of n){const{blockIndex:S}=this.getBlockForBand(_);if(S<0)throw new ll(`Invalid band: ${JSON.stringify(_)}`);const A=this.dataIndex[S];g.includes(S)||g.push(S),f.add(S),s=Math.min(s,A.first_byte),h=Math.max(h,A.last_byte)}if(f.size>this.cacheSize)throw new ll(`Number of blocks to decode (${f.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:s,lastByte:h,blockIndices:g}}hasBand(n){const{blockIndex:s}=this.getBlockForBand(n);return s>=0}hasDataForBand(n){const{blockIndex:s}=this.getBlockForBand(n);return s>=0&&!!this._decodedBlocks.get(s.toString())}getBandView(n){const{blockIndex:s,blockBandIndex:h}=this.getBlockForBand(n),g=this._decodedBlocks.get(s.toString());if(!g)throw new ll(`Data for band ${JSON.stringify(n)} of layer "${this.name}" not decoded.`);const f=this.dataIndex[s],_=this.bandShape.reduce((k,x)=>k*x,1),S=h*_,A=g.subarray(S,S+_);return{data:A,bytes:new Uint8Array(A.buffer).subarray(A.byteOffset,A.byteOffset+A.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:f.offset!==0?f.offset:f.deprecated_offset,scale:f.scale!==0?f.scale:f.deprecated_scale}}}Hx.setPbf=function(u){Gx=u};class tA{constructor(n,s,h){this.tasks=n,this._onCancel=s,this._onComplete=h,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(n,s){this._finalized||(this._onComplete(n,s),this._finalized=!0)}}Hx.performDecoding=function(u,n){const s=new Uint8Array(u);return Promise.all(n.tasks.map(h=>{const{layerName:g,firstByte:f,lastByte:_,pixelFormat:S,blockShape:A,blockIndex:k,filters:x,codec:I}=h,M=s.subarray(f,_+1),C=new Uint32Array(A[0]*A[1]*A[2]);let P;if(I!=="gzip_data")throw new ll(`Unhandled codec: ${I}`);return P=function(O,V){if(!globalThis.DecompressionStream&&V==="gzip_data")return Promise.resolve(((H=function(we){we[0]==31&&we[1]==139&&we[2]==8||Dl(6,"invalid gzip data");var Me=we[3],Re=10;4&Me&&(Re+=2+(we[10]|we[11]<<8));for(var Ce=(Me>>3&1)+(Me>>4&1);Ce>0;Ce-=!we[Re++]);return Re+(2&Me)}(ee=O))+8>ee.length&&Dl(6,"invalid gzip data"),function(we,Me,Re,Ce){var je=we.length;if(!je||Me.f&&!Me.l)return Re||new Za(0);var Oe=!Re,He=Oe||Me.i!=2,Qe=Me.i;Oe&&(Re=new Za(3*je));var it,ot,ct=function(Vu){var Yh=Re.length;if(Vu>Yh){var bg=new Za(Math.max(2*Yh,Vu));bg.set(Re),Re=bg}},bt=Me.f||0,ut=Me.p||0,Ot=Me.b||0,$t=Me.l,It=Me.d,En=Me.m,mn=Me.n,an=8*je;do{if(!$t){bt=Rl(we,ut,1);var Wt=Rl(we,ut+1,3);if(ut+=3,!Wt){var Vn=we[(Jn=4+((ut+7)/8|0))-4]|we[Jn-3]<<8,Tn=Jn+Vn;if(Tn>je){Qe&&Dl(0);break}He&&ct(Ot+Vn),Re.set(we.subarray(Jn,Tn),Ot),Me.b=Ot+=Vn,Me.p=ut=8*Tn,Me.f=bt;continue}if(Wt==1)$t=LV,It=zV,En=9,mn=5;else if(Wt==2){var An=Rl(we,ut,31)+257,Kn=Rl(we,ut+10,15)+4,ci=An+Rl(we,ut+5,31)+1;ut+=14;for(var oi=new Za(ci),si=new Za(19),pi=0;pi<Kn;++pi)si[RV[pi]]=Rl(we,ut+3*pi,7);ut+=3*Kn;var _i=jx(si),ir=(1<<_i)-1,ji=dg(si,_i);for(pi=0;pi<ci;){var Jn,Bi=ji[Rl(we,ut,ir)];if(ut+=15&Bi,(Jn=Bi>>4)<16)oi[pi++]=Jn;else{var Fi=0,_r=0;for(Jn==16?(_r=3+Rl(we,ut,3),ut+=2,Fi=oi[pi-1]):Jn==17?(_r=3+Rl(we,ut,7),ut+=3):Jn==18&&(_r=11+Rl(we,ut,127),ut+=7);_r--;)oi[pi++]=Fi}}var Jr=oi.subarray(0,An),mo=oi.subarray(An);En=jx(Jr),mn=jx(mo),$t=dg(Jr,En),It=dg(mo,mn)}else Dl(1);if(ut>an){Qe&&Dl(0);break}}He&&ct(Ot+131072);for(var Qr=(1<<En)-1,Gr=(1<<mn)-1,Wo=ut;;Wo=ut){var yo=(Fi=$t[$x(we,ut)&Qr])>>4;if((ut+=15&Fi)>an){Qe&&Dl(0);break}if(Fi||Dl(2),yo<256)Re[Ot++]=yo;else{if(yo==256){Wo=ut,$t=null;break}var fs=yo-254;yo>264&&(fs=Rl(we,ut,(1<<(Ll=WC[pi=yo-257]))-1)+KC[pi],ut+=Ll);var hr=It[$x(we,ut)&Gr],ma=hr>>4;if(hr||Dl(3),ut+=15&hr,mo=OV[ma],ma>3){var Ll=ZC[ma];mo+=$x(we,ut)&(1<<Ll)-1,ut+=Ll}if(ut>an){Qe&&Dl(0);break}He&&ct(Ot+131072);var cl=Ot+fs;if(Ot<mo){var ul=0-mo,Xh=Math.min(mo,cl);for(ul+Ot<0&&Dl(3);Ot<Xh;++Ot)Re[Ot]=(void 0)[ul+Ot]}for(;Ot<cl;++Ot)Re[Ot]=Re[Ot-mo]}}Me.l=$t,Me.p=Wo,Me.b=Ot,Me.f=bt,$t&&(bt=1,Me.m=En,Me.d=It,Me.n=mn)}while(!bt);return Ot!=Re.length&&Oe?(it=Re,((ot=Ot)==null||ot>it.length)&&(ot=it.length),new Za(it.subarray(0,ot))):Re.subarray(0,Ot)}(ee.subarray(H,-8),{i:2},new Za(((G=ee)[(J=G.length)-4]|G[J-3]<<8|G[J-2]<<16|G[J-1]<<24)>>>0))));var G,J,ee,H;const se=NV[V];if(!se)throw new Error(`Unhandled codec: ${V}`);const ue=new globalThis.DecompressionStream(se);return new Response(new Blob([O]).stream().pipeThrough(ue)).arrayBuffer().then(we=>new Uint8Array(we))}(M,I).then(O=>(function(V,G){V.readFields(EV,G)}(new Gx(O),C),new jV[S](C.buffer))),P.then(O=>{for(let V=x.length-1;V>=0;V--)switch(x[V]){case"delta_filter":AV(O,A);break;case"zigzag_filter":PV(O);break;case"bitshuffle_filter":MV(O,S);break;default:throw new ll(`Unhandled filter "${x[V]}"`)}return{layerName:g,blockIndex:k,data:O}}).catch(O=>{throw O})}))},Pn(tA,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});var pg={workerUrl:"",workerClass:null,workerParams:void 0};const qx="mapboxgl_preloaded_worker_pool";class mg{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<mg.workerCount;)this.workers.push(pg.workerClass!=null?new pg.workerClass:new self.Worker(pg.workerUrl,pg.workerParams));return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.workers&&this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[qx]}numActive(){return Object.keys(this.active).length}}let gg;function gy(){return gg||(gg=new mg),gg}mg.workerCount=2;let _g,Wx,Ol,Zf,Zx,Xf=null;function nA(){return Eo()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Wx||Ze.DRACO_URL}function iA(){if(Eo()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Zf)return Zf;const u=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Zf=WebAssembly.validate(u)?Ze.MESHOPT_SIMD_URL:Ze.MESHOPT_URL,Zf}const _y={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},GV={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},vg={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function rA(u,n,s){const h=s.json.bufferViews.length,g=s.buffers.length;n.bufferView=h,s.json.bufferViews[h]={buffer:g,byteLength:u.byteLength},s.buffers[g]=u}const Xx="KHR_draco_mesh_compression";function HV(u,n){const s=u.extensions&&u.extensions[Xx];if(!s)return;const h=new Ol.Decoder,g=lA(n,s.bufferView),f=new Ol.Mesh;if(!h.DecodeArrayToMesh(g,g.byteLength,f))throw new Error("Failed to decode Draco mesh");const _=n.json.accessors[u.indices],S=_y[_.componentType],A=_.count*S.BYTES_PER_ELEMENT,k=Ol._malloc(A);S===Uint16Array?h.GetTrianglesUInt16Array(f,A,k):h.GetTrianglesUInt32Array(f,A,k),rA(Ol.memory.buffer.slice(k,k+A),_,n),Ol._free(k);for(const x of Object.keys(s.attributes)){const I=h.GetAttributeByUniqueId(f,s.attributes[x]),M=n.json.accessors[u.attributes[x]],C=GV[M.componentType],P=M.count*vg[M.type]*_y[M.componentType].BYTES_PER_ELEMENT,O=Ol._malloc(P);h.GetAttributeDataArrayForAllPoints(f,I,Ol[C],P,O),rA(Ol.memory.buffer.slice(O,O+P),M,n),Ol._free(O)}h.destroy(),f.destroy(),delete u.extensions[Xx]}const vy="EXT_meshopt_compression";function qV(u,n){if(!u.extensions||!u.extensions[vy])return;const s=u.extensions[vy],h=new Uint8Array(n.buffers[s.buffer],s.byteOffset||0,s.byteLength||0),g=new Uint8Array(s.count*s.byteStride);Zx.decodeGltfBuffer(g,s.count,s.byteStride,h,s.mode,s.filter),u.buffer=n.buffers.length,u.byteOffset=0,n.buffers[u.buffer]=g.buffer,delete u.extensions[vy]}const oA=1179937895,sA=new TextDecoder("utf8");function aA(u,n){return new URL(u,n).href}function WV(u,n,s,h){return fetch(aA(u.uri,h)).then(g=>g.arrayBuffer()).then(g=>{n.buffers[s]=g})}function lA(u,n){const s=u.json.bufferViews[n];return new Uint8Array(u.buffers[s.buffer],s.byteOffset||0,s.byteLength)}function ZV(u,n,s,h){if(u.uri){const g=aA(u.uri,h);return fetch(g).then(f=>f.blob()).then(f=>createImageBitmap(f)).then(f=>{n.images[s]=f})}if(u.bufferView!==void 0){const g=lA(n,u.bufferView),f=new Blob([g],{type:u.mimeType});return createImageBitmap(f).then(_=>{n.images[s]=_})}}function cA(u,n=0,s){const h={json:null,images:[],buffers:[]};if(new Uint32Array(u,n,1)[0]===oA){const x=new Uint32Array(u,n);let I=2;const M=(x[I++]>>2)-3,C=x[I++]>>2;if(I++,h.json=JSON.parse(sA.decode(x.subarray(I,I+C))),I+=C,I<M){const P=x[I++];I++;const O=n+(I<<2);h.buffers[0]=u.slice(O,O+P)}}else h.json=JSON.parse(sA.decode(new Uint8Array(u,n)));const{buffers:g,images:f,meshes:_,extensionsUsed:S,bufferViews:A}=h.json;let k=Promise.resolve();if(g){const x=[];for(let I=0;I<g.length;I++){const M=g[I];M.uri?x.push(WV(M,h,I,s)):h.buffers[I]||(h.buffers[I]=null)}k=Promise.all(x)}return k.then(()=>{const x=[],I=S&&S.includes(Xx),M=S&&S.includes(vy);if(I&&x.push(function(){if(!Ol)return _g??(_g=function(C){let P,O=null;function V(){P=new Uint8Array(O.buffer)}function G(){throw new Error("Unexpected Draco error.")}const J={a:{a:G,d:function(ee,H,se){return P.copyWithin(ee,H,H+se)},c:function(ee){const H=P.length,se=Math.max(ee>>>0,Math.ceil(1.2*H)),ue=Math.ceil((se-H)/65536);try{return O.grow(ue),V(),!0}catch{return!1}},b:G}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(C,J):C.then(ee=>ee.arrayBuffer()).then(ee=>WebAssembly.instantiate(ee,J))).then(ee=>{const{Rb:H,Qb:se,P:ue,T:we,X:Me,Ja:Re,La:Ce,Qa:je,Va:Oe,Wa:He,eb:Qe,jb:it,f:ot,e:ct,yb:bt,zb:ut,Ab:Ot,Bb:$t,Db:It,Gb:En}=ee.instance.exports;O=ct;const mn=(()=>{let an=0,Wt=0,Vn=0,Tn=0;return An=>{Vn&&(H(Tn),H(an),Wt+=Vn,Vn=an=0),an||(Wt+=128,an=se(Wt));const Kn=An.length+7&-8;let ci=an;Kn>=Wt&&(Vn=Kn,ci=Tn=se(Kn));for(let oi=0;oi<An.length;oi++)P[ci+oi]=An[oi];return ci}})();return V(),ot(),{memory:ct,_free:H,_malloc:se,Mesh:class{constructor(){this.ptr=ue()}destroy(){we(this.ptr)}},Decoder:class{constructor(){this.ptr=Re()}destroy(){it(this.ptr)}DecodeArrayToMesh(an,Wt,Vn){const Tn=mn(an),An=Ce(this.ptr,Tn,Wt,Vn.ptr);return!!Me(An)}GetAttributeByUniqueId(an,Wt){return{ptr:je(this.ptr,an.ptr,Wt)}}GetTrianglesUInt16Array(an,Wt,Vn){Oe(this.ptr,an.ptr,Wt,Vn)}GetTrianglesUInt32Array(an,Wt,Vn){He(this.ptr,an.ptr,Wt,Vn)}GetAttributeDataArrayForAllPoints(an,Wt,Vn,Tn,An){Qe(this.ptr,an.ptr,Wt.ptr,Vn,Tn,An)}},DT_INT8:bt(),DT_UINT8:ut(),DT_INT16:Ot(),DT_UINT16:$t(),DT_UINT32:It(),DT_FLOAT32:En()}})}(fetch(nA())),_g.then(C=>{Ol=C,_g=void 0}))}()),M&&x.push(function(){if(Zx)return;const C=function(P){let O;const V=WebAssembly.instantiateStreaming(P,{}).then(ee=>{O=ee.instance,O.exports.__wasm_call_ctors()}),G={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},J={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:V,supported:!0,decodeGltfBuffer(ee,H,se,ue,we,Me){(function(Re,Ce,je,Oe,He,Qe,it){const ot=Re.exports.sbrk,ct=Oe+3&-4,bt=ot(ct*He),ut=ot(Qe.length),Ot=new Uint8Array(Re.exports.memory.buffer);Ot.set(Qe,ut);const $t=Ce(bt,Oe,He,ut,Qe.length);if($t===0&&it&&it(bt,ct,He),je.set(Ot.subarray(bt,bt+Oe*He)),ot(bt-ot(0)),$t!==0)throw new Error(`Malformed buffer data: ${$t}`)})(O,O.exports[J[we]],ee,H,se,ue,O.exports[G[Me]])}}}(fetch(iA()));return C.ready.then(()=>{Zx=C})}()),f)for(let C=0;C<f.length;C++)x.push(ZV(f[C],h,C,s));return(x.length?Promise.all(x):Promise.resolve()).then(()=>{if(I&&_)for(const{primitives:C}of _)for(const P of C)HV(P,h);if(M&&_&&A)for(const C of A)qV(C,h);return h})})}function Zh(u,n){const s=u.json.bufferViews[n.bufferView],h=_y[n.componentType];return new h(u.buffers[s.buffer],(n.byteOffset||0)+(s.byteOffset||0),n.count*(s.byteStride&&s.byteStride!==vg[n.type]*h.BYTES_PER_ELEMENT?s.byteStride/h.BYTES_PER_ELEMENT:vg[n.type]))}function Yx(u,n,s,h){const g=_y[n.componentType],f=function(x){switch(x){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(g),_=u.json.bufferViews[n.bufferView],S=_.byteStride?_.byteStride/g.BYTES_PER_ELEMENT:vg[n.type],A=s.float32,k=A.length/s.capacity;for(let x=0,I=0;x<n.count*S;x+=S,I+=k)for(let M=0;M<k;M++)A[I+M]=h[x+M]*f;s._trim()}function XV(u,n,s){const h=u.indices,g=u.attributes,f={};f.indexArray=new ss;const _=n.json.accessors[h],S=_.count/3;f.indexArray.reserve(S);const A=Zh(n,_);for(let M=0;M<S;M++)f.indexArray.emplaceBack(A[3*M],A[3*M+1],A[3*M+2]);f.indexArray._trim(),f.vertexArray=new ec;const k=n.json.accessors[g.POSITION];f.vertexArray.reserve(k.count);const x=Zh(n,k);for(let M=0;M<k.count;M++)f.vertexArray.emplaceBack(x[3*M],x[3*M+1],x[3*M+2]);if(f.vertexArray._trim(),f.aabb=new ur(k.min,k.max),f.centroid=function(M,C){const P=[0,0,0],O=M.length;if(O>0){for(let V=0;V<O;V++){const G=3*M[V];P[0]+=C[G],P[1]+=C[G+1],P[2]+=C[G+2]}P[0]/=O,P[1]/=O,P[2]/=O}return P}(A,x),g.COLOR_0!==void 0){const M=n.json.accessors[g.COLOR_0],C=vg[M.type],P=Zh(n,M);f.colorArray=C===3?new ec:new El,f.colorArray.resize(M.count),Yx(n,M,f.colorArray,P)}if(g.NORMAL!==void 0){f.normalArray=new ec;const M=n.json.accessors[g.NORMAL];f.normalArray.resize(M.count);const C=Zh(n,M);Yx(n,M,f.normalArray,C)}if(g.TEXCOORD_0!==void 0&&s.length>0){f.texcoordArray=new Fh;const M=n.json.accessors[g.TEXCOORD_0];f.texcoordArray.resize(M.count);const C=Zh(n,M);Yx(n,M,f.texcoordArray,C)}if(g._FEATURE_ID_RGBA4444!==void 0){const M=n.json.accessors[g._FEATURE_ID_RGBA4444];n.json.extensionsUsed&&n.json.extensionsUsed.includes("EXT_meshopt_compression")&&(f.featureData=Zh(n,M))}g._FEATURE_RGBA4444!==void 0&&(f.featureData=new Uint32Array(Zh(n,n.json.accessors[g._FEATURE_RGBA4444]).buffer));const I=u.material;return f.material=function(M,C){const{emissiveFactor:P=[0,0,0],alphaMode:O="OPAQUE",alphaCutoff:V=.5,normalTexture:G,occlusionTexture:J,emissiveTexture:ee,doubleSided:H}=M,{baseColorFactor:se=[1,1,1,1],metallicFactor:ue=1,roughnessFactor:we=1,baseColorTexture:Me,metallicRoughnessTexture:Re}=M.pbrMetallicRoughness||{},Ce=J?C[J.index]:void 0;if(J&&J.extensions&&J.extensions.KHR_texture_transform&&Ce){const je=J.extensions.KHR_texture_transform;Ce.offsetScale=[je.offset[0],je.offset[1],je.scale[0],je.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new tn(...se),metallicFactor:ue,roughnessFactor:we,baseColorTexture:Me?C[Me.index]:void 0,metallicRoughnessTexture:Re?C[Re.index]:void 0},doubleSided:H,emissiveFactor:P,alphaMode:O,alphaCutoff:V,normalTexture:G?C[G.index]:void 0,occlusionTexture:Ce,emissionTexture:ee?C[ee.index]:void 0,defined:M.defined===void 0}}(I!==void 0?n.json.materials[I]:{defined:!1},s),f}function uA(u,n,s){const{matrix:h,rotation:g,translation:f,scale:_,mesh:S,extras:A,children:k}=u,x={};if(x.matrix=h||Ie.mat4.fromRotationTranslationScale([],g||[0,0,0,1],f||[0,0,0],_||[1,1,1]),S!==void 0){x.meshes=s[S];const I=x.anchor=[0,0];for(const M of x.meshes){const{min:C,max:P}=M.aabb;I[0]+=C[0]+P[0],I[1]+=C[1]+P[1]}I[0]=Math.floor(I[0]/x.meshes.length/2),I[1]=Math.floor(I[1]/x.meshes.length/2)}if(A&&(A.id&&(x.id=A.id),A.lights&&(x.lights=function(I){if(!I.length)return[];const M=function(G){const J=atob(G),ee=new Uint8Array(J.length);for(let H=0;H<J.length;H++)ee[H]=J.codePointAt(H);return ee}(I),C=[],P=M.length/24,O=new Uint16Array(M.buffer),V=new Float32Array(M.buffer);for(let G=0;G<P;G++){const J=O[2*G*6]/30,ee=O[2*G*6+1]/30,H=O[2*G*6+10]/100,se=V[6*G+1],ue=V[6*G+2],we=V[6*G+3],Me=V[6*G+4],Re=we-se,Ce=Me-ue,je=Math.hypot(Re,Ce);C.push({pos:[se+.5*Re,ue+.5*Ce,ee],normal:[Ce/je,-Re/je,0],width:je,height:J,depth:H,points:[se,ue,we,Me]})}return C}(A.lights))),k){const I=[];for(const M of k)I.push(uA(n.json.nodes[M],n,s));x.children=I}return x}function YV(u){if(u.vertices.length===0||u.indices.length===0)return null;const n=new ox(u.vertices,u.indices,8,256),[s,h]=[n.min.clone(),n.max.clone()];return{vertices:u.vertices,indices:u.indices,grid:n,min:s,max:h}}function KV(u){if(!u.extras||!u.extras.ground)return null;const n=u.extras.ground;if(!n||!Array.isArray(n)||n.length===0)return null;const s=n[0];if(!s||!Array.isArray(s)||s.length===0)return null;const h=[];for(const _ of s){if(!Array.isArray(_)||_.length!==2)continue;const S=_[0],A=_[1];typeof S=="number"&&typeof A=="number"&&h.push(new Ue(S,A))}if(h.length<3)return null;h.length>1&&h[h.length-1].equals(h[0])&&h.pop();let g=0;for(let _=0;_<h.length;_++){const S=h[_],A=h[(_+1)%h.length],k=h[(_+2)%h.length];g+=(S.x-A.x)*(k.y-A.y)-(k.x-A.x)*(S.y-A.y)}g>0&&h.reverse();const f=Gm(h.flatMap(_=>[_.x,_.y]),[]);return f.length===0?null:{vertices:h,indices:f}}function JV(u,n){const s=[],h=[];let g=0;const f=[];for(const _ of u){g=s.length;const S=_.vertexArray.float32,A=_.indexArray.uint16;for(let k=0;k<_.vertexArray.length;k++)f[0]=S[3*k+0],f[1]=S[3*k+1],f[2]=S[3*k+2],Ie.vec3.transformMat4(f,f,n),s.push(new Ue(f[0],f[1]));for(let k=0;k<3*_.indexArray.length;k++)h.push(A[k]+g)}if(h.length%3!=0)return null;for(let _=0;_<h.length;_+=3){const S=s[h[_+0]],A=s[h[_+1]],k=s[h[_+2]];(S.x-A.x)*(k.y-A.y)-(k.x-A.x)*(S.y-A.y)>0&&([h[_+1],h[_+2]]=[h[_+2],h[_+1]])}return{vertices:s,indices:h}}function hA(u){const n=function(A,k){const x=[],I=WebGL2RenderingContext;if(A.json.textures)for(const M of A.json.textures){const C={magFilter:I.LINEAR,minFilter:I.NEAREST,wrapS:I.REPEAT,wrapT:I.REPEAT};M.sampler!==void 0&&Object.assign(C,A.json.samplers[M.sampler]),x.push({image:k[M.source],sampler:C,uploaded:!1})}return x}(u,u.images),s=function(A,k){const x=[];for(const I of A.json.meshes){const M=[];for(const C of I.primitives)M.push(XV(C,A,k));x.push(M)}return x}(u,n),{scenes:h,scene:g,nodes:f}=u.json,_=h?h[g||0].nodes:f,S=[];for(const A of _)S.push(uA(f[A],u,s));return function(A,k,x){const I={},M=new Set;for(let C=0;C<A.length;C++){const P=x[k[C]];if(!P.extras)continue;const O=P.extras["mapbox:footprint:version"],V=P.extras["mapbox:footprint:id"];(O||V)&&M.add(C),O==="1.0.0"&&V&&(I[V]=C)}for(let C=0;C<A.length;C++){if(M.has(C))continue;const P=A[C],O=x[k[C]];if(!O.extras)continue;let V=null;P.id in I&&(V=JV(A[I[P.id]].meshes,P.matrix)),V||(V=KV(O)),V&&(P.footprint=YV(V))}if(M.size>0){const C=Array.from(M.values()).sort((P,O)=>P-O);for(let P=C.length-1;P>=0;P--)A.splice(C[P],1)}}(S,_,u.json.nodes),S}function QV(u){u.heightmap=new Float32Array(4096),u.heightmap.fill(-1);const n=u.vertexArray.float32,s=u.aabb.min[0]-1,h=u.aabb.min[1]-1,g=qh/(u.aabb.max[0]-s+2),f=qh/(u.aabb.max[1]-h+2);for(let _=0;_<n.length;_+=3){const S=n[_+2],A=(n[_+0]-s)*g|0,k=(n[_+1]-h)*f|0;S>u.heightmap[k*qh+A]&&(u.heightmap[k*qh+A]=S)}}function eN(u,n){const s={};s.indexArray=new ss,s.indexArray.reserve(4*u.length),s.vertexArray=new ec,s.vertexArray.reserve(10*u.length),s.colorArray=new El,s.vertexArray.reserve(10*u.length);let h=0;for(const _ of u){const S=Math.min(10,Math.max(4,1.3*_.height))*n,A=[-_.normal[1],_.normal[0],0],k=Math.min(.29,.1*_.width/_.depth),x=_.width-2*_.depth*n*(k+.01),I=Ie.vec3.scaleAndAdd([],_.pos,A,x/2),M=Ie.vec3.scaleAndAdd([],_.pos,A,-x/2),C=[I[0],I[1],I[2]+_.height],P=[M[0],M[1],M[2]+_.height],O=Ie.vec3.scaleAndAdd([],_.normal,A,k);Ie.vec3.scale(O,O,S);const V=Ie.vec3.scaleAndAdd([],_.normal,A,-k);Ie.vec3.scale(V,V,S),Ie.vec3.add(O,I,O),Ie.vec3.add(V,M,V),I[2]+=.1,M[2]+=.1,s.vertexArray.emplaceBack(O[0],O[1],O[2]),s.vertexArray.emplaceBack(V[0],V[1],V[2]),s.vertexArray.emplaceBack(I[0],I[1],I[2]),s.vertexArray.emplaceBack(M[0],M[1],M[2]),s.vertexArray.emplaceBack(C[0],C[1],C[2]),s.vertexArray.emplaceBack(P[0],P[1],P[2]),s.vertexArray.emplaceBack(I[0],I[1],I[2]),s.vertexArray.emplaceBack(M[0],M[1],M[2]),s.vertexArray.emplaceBack(O[0],O[1],O[2]),s.vertexArray.emplaceBack(V[0],V[1],V[2]);const G=x/S/2;s.colorArray.emplaceBack(-G-k,-1,G,.8),s.colorArray.emplaceBack(G+k,-1,G,.8),s.colorArray.emplaceBack(-G,0,G,1.3),s.colorArray.emplaceBack(G,0,G,1.3),s.colorArray.emplaceBack(G+k,-.8,G,.7),s.colorArray.emplaceBack(G+k,-.8,G,.7),s.colorArray.emplaceBack(0,0,G,1.3),s.colorArray.emplaceBack(0,0,G,1.3),s.colorArray.emplaceBack(G+k,-1.2,G,.8),s.colorArray.emplaceBack(G+k,-1.2,G,.8),s.indexArray.emplaceBack(6+h,4+h,8+h),s.indexArray.emplaceBack(7+h,9+h,5+h),s.indexArray.emplaceBack(0+h,1+h,2+h),s.indexArray.emplaceBack(1+h,3+h,2+h),h+=10}const g={defined:!0,emissiveFactor:[0,0,0]},f={};return f.baseColorFactor=tn.white,g.pbrMetallicRoughness=f,s.material=g,s.aabb=new ur([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),s}class dA{constructor(n){this._stringToNumber={},this._numberToString=[];for(let s=0;s<n.length;s++){const h=n[s];this._stringToNumber[h]=s,this._numberToString[s]=h}}encode(n){return this._stringToNumber[n]}decode(n){return this._numberToString[n]}}const tN=["id","tile","layer","source","sourceLayer","state"];class fA{constructor(n,s,h,g,f){this.type="Feature",this._vectorTileFeature=n,this._z=s,this._x=h,this._y=g,this.properties=n.properties,this.id=f}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const s of tN)this[s]!==void 0&&(n[s]=this[s]);return n}}class pA{constructor(n,s){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new Ac(_n,16,0),this.featureIndexArray=new Ev,this.promoteId=s,this.is3DTile=!1}insert(n,s,h,g,f,_=0,S=0){const A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,g,f,_);const k=this.grid;for(let x=0;x<s.length;x++){const I=s[x],M=[1/0,1/0,-1/0,-1/0];for(let C=0;C<I.length;C++){const P=I[C];M[0]=Math.min(M[0],P.x),M[1]=Math.min(M[1],P.y),M[2]=Math.max(M[2],P.x),M[3]=Math.max(M[3],P.y)}S!==0&&(M[0]-=S,M[1]-=S,M[2]+=S,M[3]+=S),M[0]<_n&&M[1]<_n&&M[2]>=0&&M[3]>=0&&k.insert(A,M[0],M[1],M[2],M[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ff.VectorTile(new Wv(this.rawTileData)).layers,this.sourceLayerCoder=new dA(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const n in this.vtLayers)this.vtFeatures[n]=[]}return this.vtLayers}query(n,s,h,g){this.loadVTLayers();const f=n.params||{},_=Ha(f.filter),S=n.tileResult,A=n.transform,k=S.bufferedTilespaceBounds,x=this.grid.query(k.min.x,k.min.y,k.max.x,k.max.y,(P,O,V,G)=>Ia(S.bufferedTilespaceGeometry,P,O,V,G));x.sort(nN);let I=null;A.elevation&&x.length>0&&(I=Hf.create(A.elevation,this.tileID));const M={};let C;for(let P=0;P<x.length;P++){const O=x[P];if(O===C)continue;C=O;const V=this.featureIndexArray.get(O);let G=null;if(this.is3DTile){const J=this.bucketLayerIDs[0][0],ee=s[J];if(ee.type!=="model")continue;const{queryFeature:H,intersectionZ:se}=ee.queryIntersectsMatchingFeature(S,V.featureIndex,_,A);H&&this.appendToResult(M,J,V.featureIndex,H,se)}else this.loadMatchingFeature(M,V,_,f.layers,f.availableImages,s,h,g,(J,ee,H,se=0)=>(G||(G=sn(J,this.tileID.canonical,n.tileTransform)),ee.queryIntersectsFeature(S,J,H,G,this.z,n.transform,n.pixelPosMatrix,I,se)))}return M}loadMatchingFeature(n,s,h,g,f,_,S,A,k){const{featureIndex:x,bucketIndex:I,sourceLayerIndex:M,layoutVertexArrayOffset:C}=s,P=this.bucketLayerIDs[I];if(g&&!function(J,ee){for(let H=0;H<J.length;H++)if(ee.indexOf(J[H])>=0)return!0;return!1}(g,P))return;const O=this.sourceLayerCoder.decode(M),V=this.vtLayers[O].feature(x);if(h.needGeometry){const J=ln(V,!0);if(!h.filter(new qr(this.tileID.overscaledZ),J,this.tileID.canonical))return}else if(!h.filter(new qr(this.tileID.overscaledZ),V))return;const G=this.getId(V,O);for(let J=0;J<P.length;J++){const ee=P[J];if(g&&g.indexOf(ee)<0)continue;const H=_[ee];if(!H)continue;let se={};G!==void 0&&A&&(se=A.getState(H.sourceLayer||"_geojsonTileLayer",G));const ue=!k||k(V,H,se,C);if(!ue)continue;const we=new fA(V,this.z,this.x,this.y,G),Me=gi({},S[ee]);Me.paint=mA(Me.paint,H.paint,V,se,f),Me.layout=mA(Me.layout,H.layout,V,se,f),we.layer=Me,this.appendToResult(n,ee,x,we,ue)}}appendToResult(n,s,h,g,f){let _=n[s];_===void 0&&(_=n[s]=[]),_.push({featureIndex:h,feature:g,intersectionZ:f})}lookupSymbolFeatures(n,s,h,g,f,_,S,A){const k={};this.loadVTLayers();const x=Ha(f);for(const I of n)this.loadMatchingFeature(k,{bucketIndex:h,sourceLayerIndex:g,featureIndex:I,layoutVertexArrayOffset:0},x,_,S,A,s);return k}loadFeature(n){const{featureIndex:s,sourceLayerIndex:h}=n;this.loadVTLayers();const g=this.sourceLayerCoder.decode(h),f=this.vtFeatures[g];if(f[s])return f[s];const _=this.vtLayers[g].feature(s);return f[s]=_,_}hasLayer(n){for(const s of this.bucketLayerIDs)for(const h of s)if(n===h)return!0;return!1}getId(n,s){let h=n.id;if(this.promoteId){const g=typeof this.promoteId=="string"?this.promoteId:this.promoteId[s];g!=null&&(h=n.properties[g]),typeof h=="boolean"&&(h=Number(h))}return h}}function mA(u,n,s,h,g){return Ho(u,(f,_)=>{const S=n instanceof bu?n.get(_):null;return S&&S.evaluate?S.evaluate(s,h,g):S})}function nN(u,n){return n-u}Pn(pA,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const gA=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Kx{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[s,h]=new Uint8Array(n,0,2);if(s!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=h>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const f=gA[15&h];if(!f)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(n,2,1),[S]=new Uint32Array(n,4,1);return new Kx(S,_,f,n)}constructor(n,s=64,h=Float64Array,g){if(isNaN(n)||n<0)throw new Error(`Unpexpected numItems value: ${n}.`);this.numItems=+n,this.nodeSize=Math.min(Math.max(+s,2),65535),this.ArrayType=h,this.IndexArrayType=n<65536?Uint16Array:Uint32Array;const f=gA.indexOf(this.ArrayType),_=2*n*this.ArrayType.BYTES_PER_ELEMENT,S=n*this.IndexArrayType.BYTES_PER_ELEMENT,A=(8-S%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${h}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+S+A,2*n),this._pos=2*n,this._finished=!0):(this.data=new ArrayBuffer(8+_+S+A),this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+S+A,2*n),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=s,new Uint32Array(this.data,4,1)[0]=n)}add(n,s){const h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=n,this.coords[this._pos++]=s,h}finish(){const n=this._pos>>1;if(n!==this.numItems)throw new Error(`Added ${n} items when expected ${this.numItems}.`);return Jx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(n,s,h,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:_,nodeSize:S}=this,A=[0,f.length-1,0],k=[];for(;A.length;){const x=A.pop()||0,I=A.pop()||0,M=A.pop()||0;if(I-M<=S){for(let V=M;V<=I;V++){const G=_[2*V],J=_[2*V+1];G>=n&&G<=h&&J>=s&&J<=g&&k.push(f[V])}continue}const C=M+I>>1,P=_[2*C],O=_[2*C+1];P>=n&&P<=h&&O>=s&&O<=g&&k.push(f[C]),(x===0?n<=P:s<=O)&&(A.push(M),A.push(C-1),A.push(1-x)),(x===0?h>=P:g>=O)&&(A.push(C+1),A.push(I),A.push(1-x))}return k}within(n,s,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:f,nodeSize:_}=this,S=[0,g.length-1,0],A=[],k=h*h;for(;S.length;){const x=S.pop()||0,I=S.pop()||0,M=S.pop()||0;if(I-M<=_){for(let V=M;V<=I;V++)vA(f[2*V],f[2*V+1],n,s)<=k&&A.push(g[V]);continue}const C=M+I>>1,P=f[2*C],O=f[2*C+1];vA(P,O,n,s)<=k&&A.push(g[C]),(x===0?n-h<=P:s-h<=O)&&(S.push(M),S.push(C-1),S.push(1-x)),(x===0?n+h>=P:s+h>=O)&&(S.push(C+1),S.push(I),S.push(1-x))}return A}}function Jx(u,n,s,h,g,f){if(g-h<=s)return;const _=h+g>>1;_A(u,n,_,h,g,f),Jx(u,n,s,h,_-1,1-f),Jx(u,n,s,_+1,g,1-f)}function _A(u,n,s,h,g,f){for(;g>h;){if(g-h>600){const k=g-h+1,x=s-h+1,I=Math.log(k),M=.5*Math.exp(2*I/3),C=.5*Math.sqrt(I*M*(k-M)/k)*(x-k/2<0?-1:1);_A(u,n,s,Math.max(h,Math.floor(s-x*M/k+C)),Math.min(g,Math.floor(s+(k-x)*M/k+C)),f)}const _=n[2*s+f];let S=h,A=g;for(yg(u,n,h,s),n[2*g+f]>_&&yg(u,n,h,g);S<A;){for(yg(u,n,S,A),S++,A--;n[2*S+f]<_;)S++;for(;n[2*A+f]>_;)A--}n[2*h+f]===_?yg(u,n,h,A):(A++,yg(u,n,A,g)),A<=s&&(h=A+1),s<=A&&(g=A-1)}}function yg(u,n,s,h){Qx(u,s,h),Qx(n,2*s,2*h),Qx(n,2*s+1,2*h+1)}function Qx(u,n,s){const h=u[n];u[n]=u[s],u[s]=h}function vA(u,n,s,h){const g=u-s,f=n-h;return g*g+f*f}r.$=mv,r.A=class extends dy{},r.B=Ps,r.C=fr,r.D=Dh,r.E=ra,r.F=mm,r.G=uf,r.H=sv,r.I=wx,r.J=ff,r.K=wf,r.L=hv,r.M=Ph,r.N=tf,r.O=wh,r.P=Ue,r.Q=xh,r.R=Io,r.S=hs,r.T=Ox,r.U=en,r.V=dy,r.W=Em,r.X=hf,r.Y=pm,r.Z=function(u){const n=u.value;let s=[];if(!n)return s;const h=Ps(n);return h!=="string"?(s=s.concat([new dy(u.key,n,`string expected, "${h}" found`)]),s):(AC(n,!0)||(s=s.concat([new dy(u.key,n,`invalid url "${n}"`)])),s)},r._=_t,r.a=function(u){return Ze.API_CDN_URL_REGEX.test(u)},r.a$=Om,r.a0=Or,r.a1=un,r.a2=class{constructor(u){this.specification=u}possiblyEvaluate(u,n){return To(u.expression.evaluate(n))}interpolate(u,n,s){return{x:In(u.x,n.x,s),y:In(u.y,n.y,s),z:In(u.z,n.z,s),azimuthal:In(u.azimuthal,n.azimuthal,s),polar:In(u.polar,n.polar,s)}}},r.a3=qr,r.a4=il,r.a5=ft,r.a6=Ie,r.a7=jn,r.a8=bu,r.a9=ku,r.aA=cr,r.aB=mC,r.aC=xC,r.aD=pC,r.aE=function(u,n){const s=document.createElement("video");s.muted=!0,s.onloadstart=function(){n(null,s)};for(let h=0;h<u.length;h++){const g=document.createElement("source");Fo(u[h])||(s.crossOrigin="Anonymous"),g.src=u[h],s.appendChild(g)}return{cancel:()=>{}}},r.aF=ay,r.aG=function(u){return fetch(u).then(n=>n.arrayBuffer()).then(n=>cA(n,0,u))},r.aH=hA,r.aI=class{constructor(u,n,s,h){this.id=u,this.position=n!=null?new Q(n[0],n[1]):new Q(0,0),this.orientation=s??[0,0,0],this.nodes=h,this.uploaded=!1,this.aabb=new ur([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(u,n){if(Ie.mat4.multiply(u.matrix,n,u.matrix),u.meshes)for(const s of u.meshes){const h=ur.applyTransformFast(s.aabb,u.matrix);this.aabb.encapsulate(h)}if(u.children)for(const s of u.children)this._applyTransformations(s,u.matrix)}computeBoundsAndApplyParent(){const u=Ie.mat4.identity([]);for(const n of this.nodes)this._applyTransformations(n,u)}computeModelMatrix(u,n,s,h,g,f,_=!1){DC(this.matrix,this,u.transform,this.position,n,s,h,g,f,_)}upload(u){if(!this.uploaded){for(const n of this.nodes)Vx(n,u);for(const n of this.nodes)fy(n);this.uploaded=!0}}destroy(){for(const u of this.nodes)Nx(u)}},r.aJ=zr,r.aK=rg,r.aL=Fe,r.aM=ze,r.aN=Ql,r.aO=ss,r.aP=wr,r.aQ=Rf,r.aR=oy,r.aS=function(){Gs.isLoading()||Gs.isLoaded()||wm()!=="deferred"||Sm()},r.aT=Ha,r.aU=ln,r.aV=fA,r.aW=es,r.aX=px,r.aY=rx,r.aZ=sn,r.a_=Jl,r.aa=In,r.ab=_n,r.ac=ar,r.ad=class{constructor(u){this.specification=u}possiblyEvaluate(u,n){return function([s,h]){const g=To([1,s,h]);return{x:g.x,y:g.y,z:g.z}}(u.expression.evaluate(n))}interpolate(u,n,s){return{x:In(u.x,n.x,s),y:In(u.y,n.y,s),z:In(u.z,n.z,s)}}},r.ae=function(u,n,s=0,h=!0){const g=new Ue(s,s),f=u.sub(g),_=n.add(g),S=[f,new Ue(_.x,f.y),_,new Ue(f.x,_.y)];return h&&S.push(f.clone()),S},r.af=function(u,n){const s=[];for(let h=0;h<u.length;h++){const g=ti(h-1,-1,u.length-1),f=ti(h+1,-1,u.length-1),_=u[h],S=u[f],A=u[g].sub(_).unit(),k=S.sub(_).unit(),x=k.angleWithSep(A.x,A.y),I=A.add(k).unit().mult(-1*n/Math.sin(x/2));s.push(_.add(I))}return s},r.ag=eC,r.ah=Ia,r.ai=function(u,n,s=0){return Ie.vec3.fromValues(((n.x-s)*u.scale-u.x)*_n,(n.y*u.scale-u.y)*_n,qe(n.z,n.y))},r.aj=Pl,r.ak=bI,r.al=function(u){let n=1/0,s=1/0,h=-1/0,g=-1/0;for(const f of u)n=Math.min(n,f.x),s=Math.min(s,f.y),h=Math.max(h,f.x),g=Math.max(g,f.y);return{min:new Ue(n,s),max:new Ue(h,g)}},r.am=ke,r.an=gr,r.ao=jt,r.ap=hn,r.aq=i,r.ar=function(u,n){const s={};for(let h=0;h<n.length;h++){const g=n[h];g in u&&(s[g]=u[g])}return s},r.as=he,r.at=De,r.au=class{constructor(u){this.entries={},this.scheduler=u}request(u,n,s,h){const g=this.entries[u]=this.entries[u]||{callbacks:[]};if(g.result){const[f,_]=g.result;return this.scheduler?this.scheduler.add(()=>{h(f,_)},n):h(f,_),()=>{}}return g.callbacks.push(h),g.cancel||(g.cancel=s((f,_)=>{g.result=[f,_];for(const S of g.callbacks)this.scheduler?this.scheduler.add(()=>{S(f,_)},n):S(f,_);setTimeout(()=>delete this.entries[u],3e3)})),()=>{g.result||(g.callbacks=g.callbacks.filter(f=>f!==h),g.callbacks.length||(g.cancel(),delete this.entries[u]))}}},r.av=yv,r.aw=function(u,n,s){const h=JSON.stringify(u.request);return u.data&&(this.deduped.entries[h]={result:[null,u.data]}),this.deduped.request(h,{type:"parseTile",isSymbolTile:u.isSymbolTile,zoom:u.tileZoom},g=>{const f=ta(u.request,(_,S,A,k)=>{_?g(_):S&&g(null,{vectorTile:s?void 0:new Ff.VectorTile(new Wv(S)),rawData:S,cacheControl:A,expires:k})});return()=>{f.cancel(),g()}},n)},r.ax=function(u){Pr++,Pr>bi&&(u.getActor().send("enforceCacheSizeLimit",Un),Pr=0)},r.ay=xn,r.az=function(u){return u<=1?1:Math.pow(2,Math.floor(Math.log(u)/Math.LN2))},r.b=function(u){return Ze.API_FONTS_REGEX.test(u)},r.b$=function(u){const{x:n,y:s}=u.point,{lng:h,lat:g}=u._center;return dE(n,s,u.worldSize,h,g)},r.b0=Aa,r.b1=Wr,r.b2=Gm,r.b3=kx,r.b4=function(u,n){const s=ku(n.zoom);if(s===0)return rc(u);const h=Dv(u),g=Xb(h),f=ke(h.getWest())*n.worldSize,_=ke(h.getEast())*n.worldSize,S=De(h.getNorth())*n.worldSize,A=De(h.getSouth())*n.worldSize,k=[f,S,0],x=[_,S,0],I=[f,A,0],M=[_,A,0],C=Ie.mat4.invert([],n.globeMatrix);return Ie.vec3.transformMat4(k,k,C),Ie.vec3.transformMat4(x,x,C),Ie.vec3.transformMat4(I,I,C),Ie.vec3.transformMat4(M,M,C),g[0]=zc(g[0],I,s),g[1]=zc(g[1],M,s),g[2]=zc(g[2],x,s),g[3]=zc(g[3],k,s),ur.fromPoints(g)},r.b5=Lv,r.b6=jm,r.b7=zc,r.b8=If,r.b9=Hs,r.bA=ti,r.bB=Gt,r.bC=bs,r.bD=Pe,r.bE=function(u,n,s){u[4*n+0]=s[0],u[4*n+1]=s[1],u[4*n+2]=s[2],u[4*n+3]=s[3]},r.bF=jh,r.bG=rl,r.bH=Fm,r.bI=ws,r.bJ=Dc,r.bK=Q,r.bL=oC,r.bM=ko,r.bN=Mu,r.bO=SC,r.bP=jo,r.bQ=cE,r.bR=function(u,n,s,h,g,f,_,S,A){if(A.name==="globe")return cE(u,n,new jo(s,h,g),!1);const k=rg({z:s,x:h,y:g},A);return new ur([(f+k.x/k.scale)*n,n*(k.y/k.scale),_],[(f+k.x2/k.scale)*n,n*(k.y2/k.scale),S])},r.bS=function(u,n,s){let h=0;for(let g=0;g<2;++g)u[g]>0&&(h+=(u[g]-0)*(u[g]-0)),n[g]<0&&(h+=(0-n[g])*(0-n[g]));return h},r.bT=$e,r.bU=m,r.bV=function(u){const n=Ie.mat4.identity(new Float64Array(16));Ie.mat4.multiply(n,u.pixelMatrix,u.globeMatrix);const s=[0,R,0],h=[0,z,0];return Ie.vec3.transformMat4(s,s,n),Ie.vec3.transformMat4(h,h,n),[s[0]>0&&s[0]<=u.width&&s[1]>0&&s[1]<=u.height&&!Jb(u,new Q(u.center.lat,90)),h[0]>0&&h[0]<=u.width&&h[1]>0&&h[1]<=u.height&&!Jb(u,new Q(u.center.lat,-90))]},r.bW=function(u,n){const{scale:s}=u.tileTransform,h=s*_n/(u.tileSize*Math.pow(2,n.zoom-u.tileID.overscaledZ+u.tileID.canonical.z));return Ie.mat2.scale(new Float32Array(4),n.inverseAdjustmentMatrix,[h,h])},r.bX=uy,r.bY=wC,r.bZ=function(u){const n=wC(u,!0);return Ie.mat2.invert([],[n[0],n[1],n[4],n[5]])},r.b_=ic,r.ba=Hx,r.bb=Wv,r.bc=ta,r.bd=function(u){const n=[];for(const s in u)n.push(u[s]);return n},r.be=function(u,n){const s=[];for(const h in u)h in n||s.push(h);return s},r.bf=ki,r.bg=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.bh=Et,r.bi=function(u,n){const{x:s,y:h}=u.point,g=dE(s,h,u.worldSize/u._pixelsPerMercatorPixel,0,0);return Ie.mat4.multiply(g,g,Yb(rc(n)))},r.bj=Vf,r.bk=Wa,r.bl=qv,r.bm=function(u,n,s,h,g){const f=5*n+2;u.float32[f+0]=s,u.float32[f+1]=h,u.float32[f+2]=g},r.bn=ry,r.bo=$I,r.bp=pn,r.bq=ds,r.br=HE,r.bs=CC,r.bt=YE,r.bu=KE,r.bv=Ex,r.bw=YI,r.bx=xx,r.by=Kx,r.bz=tn,r.c=at,r.c$=Rs,r.c0=Yt,r.c1=ks,r.c2=a,r.c3=function(u){const n=Math.round((u+45+360)%360/90)%4;return vn[n]},r.c4=45,r.c5=ve,r.c6=Lf,r.c7=function(u,n,s){const h=Math.sqrt(u*u+n*n+s*s),g=h>0?Math.acos(s/h)*Qt:0;let f=u!==0||n!==0?Math.atan2(-n,-u)*Qt+90:0;return f<0&&(f+=360),[h,f,g]},r.c8=Ye,r.c9=ur,r.cA=function(u){const n=$e-5;u=hn(u,-n,n)/n*90;const s=Math.pow(Math.abs(Math.sin(Gt(u))),3);return Math.round(s*(E.length-1))},r.cB=function(u,n,s,h){const g=n.getNorth(),f=n.getSouth(),_=n.getWest(),S=n.getEast(),A=1<<u.z,k=S-_,x=g-f,I=k/w,M=-x/E[s],C=[0,I,0,M,0,0,g,_,0];if(u.z>0){const P=180/h;Ie.mat3.multiply(C,C,[P/k+1,0,0,0,P/x+1,0,-.5*P/I,.5*P/M,1])}return C[2]=A,C[5]=u.x,C[8]=u.y,C},r.cC=rc,r.cD=function(u,n,s){const h=Ie.mat4.identity(new Float64Array(16)),g=(n/(1<<u)-.5)*Math.PI*2;return Ie.mat4.rotateY(h,s.globeMatrix,g),Float32Array.from(h)},r.cE=class{isDataAvailableAtPoint(u){const n=this._source();if(this.isUsingMockSource()||!n||u.y<0||u.y>1)return!1;const s=n.getSource().maxzoom,h=1<<s,g=Math.floor(u.x),f=Math.floor((u.x-g)*h),_=Math.floor(u.y*h),S=this.findDEMTileFor(new cr(s,g,s,f,_));return!(!S||!S.dem)}getAtPointOrZero(u,n=0){return this.getAtPoint(u,n)||0}getAtPoint(u,n,s=!0){if(this.isUsingMockSource())return null;n==null&&(n=null);const h=this._source();if(!h||u.y<0||u.y>1)return n;const g=h.getSource().maxzoom,f=1<<g,_=Math.floor(u.x),S=u.x-_,A=new cr(g,_,g,Math.floor(S*f),Math.floor(u.y*f)),k=this.findDEMTileFor(A);if(!k||!k.dem)return n;const x=k.dem,I=1<<k.tileID.canonical.z,M=(S*I-k.tileID.canonical.x)*x.dim,C=(u.y*I-k.tileID.canonical.y)*x.dim,P=Math.floor(M),O=Math.floor(C);return(s?this.exaggeration():1)*In(In(x.get(P,O),x.get(P,O+1),C-O),In(x.get(P+1,O),x.get(P+1,O+1),C-O),M-P)}getAtTileOffset(u,n,s){const h=1<<u.canonical.z;return this.getAtPointOrZero(new ft(u.wrap+(u.canonical.x+n/_n)/h,(u.canonical.y+s/_n)/h))}getAtTileOffsetFunc(u,n,s,h){return g=>{const f=this.getAtTileOffset(u,g.x,g.y),_=h.upVector(u.canonical,g.x,g.y),S=h.upVectorScale(u.canonical,n,s).metersToTile;return Ie.vec3.scale(_,_,f*S),_}}getForTilePoints(u,n,s,h){if(this.isUsingMockSource())return!1;const g=Hf.create(this,u,h);return!!g&&(n.forEach(f=>{f[2]=this.exaggeration()*g.getElevationAt(f[0],f[1],s)}),!0)}getMinMaxForTile(u){if(this.isUsingMockSource())return null;const n=this.findDEMTileFor(u);if(!n||!n.dem)return null;const s=n.dem.tree,h=n.tileID,g=1<<u.canonical.z-h.canonical.z;let f=u.canonical.x/g-h.canonical.x,_=u.canonical.y/g-h.canonical.y,S=0;for(let A=0;A<u.canonical.z-h.canonical.z&&!s.leaves[S];A++){f*=2,_*=2;const k=2*Math.floor(_)+Math.floor(f);S=s.childOffsets[S]+k,f%=1,_%=1}return{min:this.exaggeration()*s.minimums[S],max:this.exaggeration()*s.maximums[S]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(u,n,s){throw new Error("Pure virtual method called.")}pointCoordinate(u){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(u){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const u=this.visibleDemTiles;if(u.length===0)return null;let n=!1,s=Number.MAX_VALUE,h=Number.MIN_VALUE;for(const g of u){const f=this.getMinMaxForTile(g.tileID);f&&(s=Math.min(s,f.min),h=Math.max(h,f.max),n=!0)}return n?{min:s,max:h}:null}},r.cF=EE,r.cG=Lc,r.cH=function(u,n){return[Math.pow(u[0],2.2)*n,Math.pow(u[1],2.2)*n,Math.pow(u[2],2.2)*n]},r.cI=hE,r.cJ=Ve,r.cK=Te,r.cL=256,r.cM=function(u,n){const s=[0,0,0],h=Lv(rc(n.canonical));return Ie.vec3.transformMat4(s,s,h),Ie.vec3.transformMat4(s,s,u),s},r.cN=u=>({u_camera_to_center_distance:new ws(u),u_extrude_scale:new Nm(u),u_device_pixel_ratio:new ws(u),u_matrix:new jh(u),u_inv_rot_matrix:new jh(u),u_merc_center:new rl(u),u_tile_id:new Fm(u),u_zoom_transition:new ws(u),u_up_dir:new Fm(u),u_emissive_strength:new ws(u)}),r.cO=u=>({u_matrix:new jh(u),u_pixels_to_tile_units:new Nm(u),u_device_pixel_ratio:new ws(u),u_units_to_pixels:new rl(u),u_dash_image:new Dc(u),u_gradient_image:new Dc(u),u_image_height:new ws(u),u_texsize:new rl(u),u_tile_units_to_pixels:new ws(u),u_alpha_discard_threshold:new ws(u),u_trim_offset:new rl(u),u_trim_fade_range:new rl(u),u_trim_color:new Lf(u),u_emissive_strength:new ws(u)}),r.cP=u=>({u_matrix:new jh(u),u_texsize:new rl(u),u_pixels_to_tile_units:new Nm(u),u_device_pixel_ratio:new ws(u),u_image:new Dc(u),u_units_to_pixels:new rl(u),u_tile_units_to_pixels:new ws(u),u_alpha_discard_threshold:new ws(u),u_trim_offset:new rl(u)}),r.cQ=Ms,r.cR=TF,r.cS=EF,r.cT=mE,r.cU=(u,n,s,h,g,f)=>{const _=u.transform,S=_.projection.name==="globe";let A;if(f.paint.get("circle-pitch-alignment")==="map")if(S){const x=hE(_.zoom,n.canonical)*_._pixelsPerMercatorPixel;A=Float32Array.from([x,0,0,x])}else A=_.calculatePixelsToTileUnitsMatrix(s);else A=new Float32Array([_.pixelsToGLUnits[0],0,0,_.pixelsToGLUnits[1]]);const k={u_camera_to_center_distance:u.transform.getCameraToCenterDistance(_.projection),u_matrix:u.translatePosMatrix(n.projMatrix,s,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_device_pixel_ratio:wn.devicePixelRatio,u_extrude_scale:A,u_inv_rot_matrix:A4,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:f.paint.get("circle-emissive-strength")};if(S){k.u_inv_rot_matrix=h,k.u_merc_center=g,k.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],k.u_zoom_transition=ku(_.zoom);const x=g[0]*_n,I=g[1]*_n;k.u_up_dir=_.projection.upVector(new jo(0,0,0),x,I)}return k},r.cV=SI,r.cW=(u,n,s,h,g,f)=>{const _=u.transform;return{u_matrix:wI(u,n,s,h),u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:_.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:g,u_image:0,u_tile_units_to_pixels:xI(n,_),u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:f}},r.cX=(u,n,s,h,g,f,_)=>{const S=u.transform,A=S.calculatePixelsToTileUnitsMatrix(n);return{u_matrix:wI(u,n,s,h),u_pixels_to_tile_units:A,u_device_pixel_ratio:f,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:g,u_texsize:TI(s)&&n.lineAtlasTexture?n.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:xI(n,u.transform),u_alpha_discard_threshold:0,u_trim_offset:_,u_trim_fade_range:s.paint.get("line-trim-fade-range"),u_trim_color:s.paint.get("line-trim-color").toRenderColor(s.lut).toArray01(),u_emissive_strength:s.paint.get("line-emissive-strength")}},r.cY=Rr,r.cZ=$m,r.c_=uI,r.ca=To,r.cb=function(u){return[Math.pow(u[0],1/2.2),Math.pow(u[1],1/2.2),Math.pow(u[2],1/2.2)]},r.cc=function(u){return u({pluginStatus:qo,pluginURL:Kl}),xm.on("pluginStateChange",u),u},r.cd=qf,r.ce=gy,r.cf=Uf,r.cg=Sx,r.ch=xa,r.ci=pv,r.cj=Zn,r.ck=to,r.cl=Tr,r.cm=function(u){const n=u.indexOf(wu);return n>=0?u.slice(0,n):u},r.cn=function(u){return u.indexOf(wu)>=0},r.co=function(u){const n=u.indexOf(wu);return n>=0?u.slice(n+1):""},r.cp=function(u){const n=[],s=u.id;return s===void 0&&n.push({message:`layers.${s}: missing required property "id"`}),u.render===void 0&&n.push({message:`layers.${s}: missing required method "render"`}),u.renderingMode&&u.renderingMode!=="2d"&&u.renderingMode!=="3d"&&n.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),n},r.cq=function(u,n,s,h){return u.type==="custom"?new nV(u,n):new fV[u.type](u,n,s,h)},r.cr=Sr,r.cs=xm,r.ct=wa,r.cu=Vm,r.cv=class extends Al{constructor(u){super(u),this.current=jb}set(u,n,s){if(this.fetchUniformLocation(u,n)){for(let h=0;h<9;h++)if(s[h]!==this.current[h]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}}},r.cw=dn,r.cx=function(u,n,s){const h=ku(s.zoom),g=u.style.map._antialias,f=n.options.extStandardDerivativesForceOff||u.terrain&&u.terrain.exaggeration()>0;return h===0&&!g&&!f},r.cy=function(u){const n=u.pixelsPerMeter,s=n/Pe(1,u.center.lat),h=Ie.mat4.identity(new Float64Array(16));return Ie.mat4.translate(h,h,[u.point.x,u.point.y,0]),Ie.mat4.scale(h,h,[s,s,n]),Float32Array.from(h)},r.cz=Dv,r.d=function(u){return Ze.API_TILEJSON_REGEX.test(u)},r.d$=D,r.d0=Hv,r.d1=Du,r.d2=450,r.d3=7,r.d4=tV,r.d5=Di,r.d6=Mf,r.d7=256,r.d8=Yb,r.d9=ec,r.dA=fE,r.dB=function(u){const n=[0,0,0],s=Ie.mat4.identity(new Float64Array(16));return Ie.mat4.multiply(s,u.pixelMatrix,u.globeMatrix),Ie.vec3.transformMat4(n,n,s),new Ue(n[0],n[1])},r.dC=function(u,n,s=!1){if(qo===kh||qo===Rh||qo===bf)throw new Error("setRTLTextPlugin cannot be called multiple times.");Kl=wn.resolveURL(u),qo=kh,vu=n,bm(),s||Sm()},r.dD=wm,r.dE=function(){gy().acquire(qx)},r.dF=function(){const u=gg;u&&(u.isPreloaded()&&u.numActive()===1?(u.release(qx),gg=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.dG=mg,r.dH=function(u){const n=qi();if(!n)return;const s=n.delete(Xn);u&&s.catch(u).then(()=>u())},r.dI=pg,r.dJ=nA,r.dK=function(u){Wx=wn.resolveURL(u),Xf||(Xf=new qf(gy(),new ra)),Xf.broadcast("setDracoUrl",Wx)},r.dL=iA,r.dM=function(u){Zf=wn.resolveURL(u),Xf||(Xf=new qf(gy(),new ra)),Xf.broadcast("setMeshoptUrl",Zf)},r.dN=Pn,r.dO=Ru,r.dP=kl,r.dQ=dA,r.dR=pA,r.dS=gI,r.dT=Ho,r.dU=HI,r.dV=function(u,n,s,h,g,f,_,S,A,k,x){u.createArrays(),u.tilePixelRatio=_n/(512*u.overscaling),u.compareText={},u.iconsNeedLinear=!1;const I=u.layers[0].layout,M=u.layers[0]._unevaluatedLayout._values,C={};if(u.textSizeData.kind==="composite"){const{minZoom:G,maxZoom:J}=u.textSizeData;C.compositeTextSizes=[M["text-size"].possiblyEvaluate(new qr(G),S),M["text-size"].possiblyEvaluate(new qr(J),S)]}if(u.iconSizeData.kind==="composite"){const{minZoom:G,maxZoom:J}=u.iconSizeData;C.compositeIconSizes=[M["icon-size"].possiblyEvaluate(new qr(G),S),M["icon-size"].possiblyEvaluate(new qr(J),S)]}C.layoutTextSize=M["text-size"].possiblyEvaluate(new qr(A+1),S),C.layoutIconSize=M["icon-size"].possiblyEvaluate(new qr(A+1),S),C.textMaxSize=M["text-size"].possiblyEvaluate(new qr(18),S);const P=I.get("text-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point",O=I.get("text-size");let V=!1;for(const G of u.features)if(G.icon&&G.icon.nameSecondary){V=!0;break}for(const G of u.features){const J=I.get("text-font").evaluate(G,{},S).join(","),ee=O.evaluate(G,{},S),H=C.layoutTextSize.evaluate(G,{},S),se=(C.layoutIconSize.evaluate(G,{},S),{horizontal:{},vertical:void 0}),ue=G.text;let we,Me=[0,0];if(ue){const je=ue.toString(),Oe=I.get("text-letter-spacing").evaluate(G,{},S)*ds,He=I.get("text-line-height").evaluate(G,{},S)*ds,Qe=Mb(je)?Oe:0,it=I.get("text-anchor").evaluate(G,{},S),ot=I.get("text-variable-anchor");if(!ot){const $t=I.get("text-radial-offset").evaluate(G,{},S);Me=$t?YI(it,[$t*ds,Tx]):I.get("text-offset").evaluate(G,{},S).map(It=>It*ds)}let ct=P?"center":I.get("text-justify").evaluate(G,{},S);const bt=I.get("symbol-placement")==="point",ut=bt?I.get("text-max-width").evaluate(G,{},S)*ds:1/0,Ot=$t=>{u.allowVerticalPlacement&&_f(je)&&(se.vertical=bx(ue,n,s,g,J,ut,He,it,$t,Qe,Me,Wa.vertical,!0,H,ee))};if(!P&&ot){const $t=ct==="auto"?ot.map(En=>Ex(En)):[ct];let It=!1;for(let En=0;En<$t.length;En++){const mn=$t[En];if(!se.horizontal[mn])if(It)se.horizontal[mn]=se.horizontal[0];else{const an=bx(ue,n,s,g,J,ut,He,"center",mn,Qe,Me,Wa.horizontal,!1,H,ee);an&&(se.horizontal[mn]=an,It=an.positionedLines.length===1)}}Ot("left")}else{if(ct==="auto"&&(ct=Ex(it)),bt||I.get("text-writing-mode").indexOf("horizontal")>=0||!_f(je)){const $t=bx(ue,n,s,g,J,ut,He,it,ct,Qe,Me,Wa.horizontal,!1,H,ee);$t&&(se.horizontal[ct]=$t)}Ot(bt?"left":ct)}}let Re=!1;if(G.icon&&G.icon.namePrimary){const je=h[G.icon.namePrimary];je&&(we=LF(g[G.icon.namePrimary],G.icon.nameSecondary?g[G.icon.nameSecondary]:void 0,I.get("icon-offset").evaluate(G,{},S),I.get("icon-anchor").evaluate(G,{},S)),Re=je.sdf,u.sdfIcons===void 0?u.sdfIcons=je.sdf:u.sdfIcons!==je.sdf&&ii("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(je.pixelRatio!==u.pixelRatio||I.get("icon-rotate").constantOr(1)!==0)&&(u.iconsNeedLinear=!0))}const Ce=JI(se.horizontal)||se.vertical;u.iconsInText||(u.iconsInText=!!Ce&&Ce.iconsInText),(Ce||we)&&jF(u,G,se,we,h,C,H,0,Me,Re,_,S,k,x,V)}f&&u.generateCollisionDebugBuffers(A,u.collisionBoxArray)},r.dW=Ff,r.dX=my,r.dY=Ne,r.dZ=UE,r.d_=MI,r.da=Cl,r.db=Dm,r.dc=function(u,n,s,h,g){return hn((u-n)/(s-n)*(g-h)+h,h,g)},r.dd=cf,r.de=nt,r.df=class{constructor(u,n,s,h){this.context=u,this.format=h,this.size=s,this.texture=u.gl.createTexture();const[g,f,_]=this.size,{gl:S}=u;S.bindTexture(S.TEXTURE_3D,this.texture),u.pixelStoreUnpackFlipY.set(!1),u.pixelStoreUnpack.set(1),u.pixelStoreUnpackPremultiplyAlpha.set(!1),S.texImage3D(S.TEXTURE_3D,0,this.format,g,f,_,0,Rx(this.format),Dx(this.format),n.data)}bind(u,n){const{context:s}=this,{gl:h}=s;h.bindTexture(h.TEXTURE_3D,this.texture),u!==this.minFilter&&(h.texParameteri(h.TEXTURE_3D,h.TEXTURE_MAG_FILTER,u),h.texParameteri(h.TEXTURE_3D,h.TEXTURE_MIN_FILTER,u),this.minFilter=u),n!==this.wrapS&&(h.texParameteri(h.TEXTURE_3D,h.TEXTURE_WRAP_S,n),h.texParameteri(h.TEXTURE_3D,h.TEXTURE_WRAP_T,n),this.wrapS=n)}destroy(){const{gl:u}=this.context;u.deleteTexture(this.texture),this.texture=null}},r.dg=Bx,r.dh=[1,1,1],r.di=Hf,r.dj=Gf,r.dk=tc,r.dl=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Ue(1/0,1/0),max:new Ue(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(u,n=!1){const s=WE(new Ue(0,0),new Ue(_n,_n),u),h=[];if(n&&!cx(s,this._globalClipBounds))return h;for(const g of this._activeRegions){if(g.hiddenByOverlap||!cx(s,g))continue;const f=K4(g.min,g.max,u);h.push({min:f.min,max:f.max,sourceId:this._sourceIds[g.priority],footprint:g.footprint,footprintTileId:g.tileId,order:g.order,clipMask:g.clipMask,clipScope:g.clipScope})}return h}setSources(u){this._setSources(u.map(n=>({getSourceId:()=>n.cache.id,getFootprints:()=>{const s=[];for(const h of n.cache.getVisibleCoordinates()){const g=n.cache.getTile(h).buckets[n.layer];g&&g.updateFootprints(h.toUnwrapped(),s)}return s},getOrder:()=>n.order,getClipMask:()=>n.clipMask,getClipScope:()=>n.clipScope})))}_addSource(u){const n=u.getFootprints();if(n.length===0)return;const s=u.getOrder(),h=u.getClipMask(),g=u.getClipScope();for(const f of n){if(!f.footprint)continue;const _=WE(f.footprint.min,f.footprint.max,f.id);this._activeRegions.push({min:_.min,max:_.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:f.id,footprint:f.footprint,order:s,clipMask:h,clipScope:g})}this._sourceIds.push(u.getSourceId())}_computeReplacement(){this._activeRegions.sort((n,s)=>n.priority-s.priority||$v(n.min,s.min)||$v(n.max,s.max)||n.order-s.order||n.clipMask-s.clipMask||function(h,g){const f=(_,S)=>_+S;return h.length-g.length||h.reduce(f,"").localeCompare(g.reduce(f,""))}(n.clipScope,s.clipScope));let u=this._activeRegions.length!==this._prevRegions.length;if(!u){let n=0;for(;!u&&n!==this._activeRegions.length;){const s=this._activeRegions[n],h=this._prevRegions[n];u=s.priority!==h.priority||!qE(s,h)||s.order!==h.order||s.clipMask!==h.clipMask||!Et(s.clipScope,h.clipScope),++n}}if(u){++this._updateTime;for(const s of this._activeRegions)s.order!==jv&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,s.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,s.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,s.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,s.max.y));const n=s=>{const h=this._activeRegions;if(s>=h.length)return s;const g=h[s].priority;for(;s<h.length&&h[s].priority===g;)++s;return s};if(this._sourceIds.length>1){let s=0,h=n(s);for(;s!==h;){let g=s;const f=s;for(;g!==h;){const _=this._activeRegions[g];_.hiddenByOverlap=!1;for(let S=0;S<f;S++){const A=this._activeRegions[S];if(!A.hiddenByOverlap&&_.order===jv&&cx(_,A)&&(_.hiddenByOverlap=XE(_.footprint,_.tileId,A.footprint,A.tileId),_.hiddenByOverlap))break}++g}s=h,h=n(s)}}}}_setSources(u){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let n=u.length-1;n>=0;n--)this._addSource(u[n]);this._computeReplacement()}},r.dm=class{constructor(u){this._createGrid(u),this._createPoles(u)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const u of this._poleSegments)u.destroy();for(const u of this._gridSegments)u.withSkirts.destroy(),u.withoutSkirts.destroy()}_fillGridMeshWithLods(u,n){const s=new Jl,h=new ss,g=[],f=u+1+2,_=n[0]+1,S=n[0]+1+(1+n.length),A=(k,x,I)=>{let M=k===f-1?k-2:k===0?k:k-1;return M+=I?24575:0,[M,x]};for(let k=0;k<f;++k)s.emplaceBack(...A(k,0,!0));for(let k=0;k<_;++k)for(let x=0;x<f;++x)s.emplaceBack(...A(x,k,(x===0||x===f-1)&&!0));for(let k=0;k<n.length;++k){const x=n[k];for(let I=0;I<f;++I)s.emplaceBack(...A(I,x,!0))}for(let k=0;k<n.length;++k){const x=h.length,I=n[k]+1+2,M=new ss;for(let O=0;O<I-1;O++){const V=O===I-2,G=V?f*(S-n.length+k-O):f;for(let J=0;J<f-1;J++){const ee=O*f+J;O===0||V||J===0||J===f-2?(M.emplaceBack(ee+1,ee,ee+G),M.emplaceBack(ee+G,ee+G+1,ee+1)):(h.emplaceBack(ee+1,ee,ee+G),h.emplaceBack(ee+G,ee+G+1,ee+1))}}const C=Wr.simpleSegment(0,x,s.length,h.length-x);for(let O=0;O<M.uint16.length;O+=3)h.emplaceBack(M.uint16[O],M.uint16[O+1],M.uint16[O+2]);const P=Wr.simpleSegment(0,x,s.length,h.length-x);g.push({withoutSkirts:C,withSkirts:P})}return{vertices:s,indices:h,segments:g}}_createGrid(u){const n=this._fillGridMeshWithLods(w,E);this._gridSegments=n.segments,this._gridBuffer=u.createVertexBuffer(n.vertices,Aa.members),this._gridIndexBuffer=u.createIndexBuffer(n.indices,!0)}_createPoles(u){const n=new ss;for(let _=0;_<=w;_++)n.emplaceBack(0,_+1,_+2);this._poleIndexBuffer=u.createIndexBuffer(n,!0);const s=new Cl,h=new Cl,g=new Cl,f=new Cl;this._poleSegments=[];for(let _=0,S=0;_<a;_++){const A=360/(1<<_);s.emplaceBack(0,-i,0,.5,0),h.emplaceBack(0,-i,0,.5,1),g.emplaceBack(0,-i,0,.5,.5),f.emplaceBack(0,-i,0,.5,.5);for(let k=0;k<=w;k++){let x=k/w,I=0;const M=In(0,A,x),[C,P,O]=N(I4,C4,M,i);s.emplaceBack(C,P,O,x,I),h.emplaceBack(C,P,O,x,1-I);const V=Gt(M);x=.5+.5*Math.sin(V),I=.5+.5*Math.cos(V),g.emplaceBack(C,P,O,x,I),f.emplaceBack(C,P,O,x,1-I)}this._poleSegments.push(Wr.simpleSegment(S,0,66,64)),S+=66}this._poleNorthVertexBuffer=u.createVertexBuffer(s,pa,!1),this._poleSouthVertexBuffer=u.createVertexBuffer(h,pa,!1),this._texturedPoleNorthVertexBuffer=u.createVertexBuffer(g,pa,!1),this._texturedPoleSouthVertexBuffer=u.createVertexBuffer(f,pa,!1)}getGridBuffers(u,n){return[this._gridBuffer,this._gridIndexBuffer,n?this._gridSegments[u].withSkirts:this._gridSegments[u].withoutSkirts]}getPoleBuffers(u,n){return[n?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,n?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[u]]}},r.dn=jv,r.dp=Wn,r.dq=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.dr=Rn,r.ds=Ke,r.dt=j,r.du=function([u,n,s]){const h=Math.hypot(u,n,s),g=Math.atan2(u,s),f=.5*Math.PI-Math.acos(-n/h);return new Q(Yt(g),Yt(f))},r.dv=zx,r.dw=X,r.dx=function(u){const n=u.navigator?u.navigator.userAgent:null;return!!function(s){if(Qs==null){const h=s.navigator?s.navigator.userAgent:null;Qs=!!s.safari||!(!h||!(/\b(iPad|iPhone|iPod)\b/.test(h)||h.match("Safari")&&!h.match("Chrome")))}return Qs}(u)&&n&&(n.match("Version/15.4")||n.match("Version/15.5")||n.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},r.dy=function(u,n){Un=u,bi=n},r.dz=Jb,r.e=Ze,r.e0=function(u){let n=0;if(new Uint32Array(u,0,1)[0]!==oA){const s=new Uint32Array(u,0,7),[,,h,g,f,_]=s;n=s.byteLength+g+f+_+f,(h!==u.byteLength||n>=u.byteLength)&&ii("Invalid b3dm header information.")}return cA(u,n)},r.e1=function(u,n){const s=hA(u);for(const h of s){for(const g of h.meshes)QV(g);h.lights&&(h.lightMeshIndex=h.meshes.length,h.meshes.push(eN(h.lights,n)))}return s},r.e2=py,r.e3=VC,r.e4=Gs,r.e5=function(u){Qi(),ni!=null&&ni.then(n=>{n.keys().then(s=>{for(let h=0;h<s.length-u;h++)n.delete(s[h])})})},r.f=function(u){return u.indexOf("mapbox:")===0},r.g=function(u,n){return wa(gi(u,{method:"GET"}),n)},r.h=Ge,r.i=function(u){return Ze.API_STYLE_REGEX.test(u)&&!at(u)},r.j=function(u){return decodeURIComponent(atob(u).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join(""))},r.k=function(u){return btoa(encodeURIComponent(u).replace(/%([0-9A-F]{2})/g,(n,s)=>String.fromCharCode(+("0x"+s))))},r.l=gi,r.m=Dr,r.n=function(u,n){return wa(gi(u,{type:"json"}),n)},r.o=Ur,r.p=function(u,n){return wa(gi(u,{method:"POST"}),n)},r.q=wn,r.r=Ds,r.s=function(u){try{const n=self[u];return n.setItem("_mapbox_test_",1),n.removeItem("_mapbox_test_"),!0}catch{return!1}},r.t=ia,r.u=function(){return function u(n){return n?(n^Math.random()*(16>>n/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,u)}()},r.v=function(u){return!!u&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(u)},r.w=ii,r.x=Ns,r.y=2,r.z=GI}),y(["./shared"],function(r){function D(vt){const ye=vt?vt.url.toString():void 0;return ye?performance.getEntriesByName(ye):[]}function L(vt){if(typeof vt=="number"||typeof vt=="boolean"||typeof vt=="string"||vt==null)return JSON.stringify(vt);if(Array.isArray(vt)){let Te="[";for(const Ve of vt)Te+=`${L(Ve)},`;return`${Te}]`}let ye="{";for(const Te of Object.keys(vt).sort())ye+=`${Te}:${L(vt[Te])},`;return`${ye}}`}function B(vt){let ye="";for(const Te of r.bg)ye+=`/${L(vt[Te])}`;return ye}class U{constructor(ye){this.keyCache={},this._layers={},this._layerConfigs={},ye&&this.replace(ye)}replace(ye,Te){this._layerConfigs={},this._layers={},this.update(ye,[],Te)}update(ye,Te,Ve){this._options=Ve;for(const Ge of ye)this._layerConfigs[Ge.id]=Ge,(this._layers[Ge.id]=r.cq(Ge,this.scope,null,this._options)).compileFilter(Ve),this.keyCache[Ge.id]&&delete this.keyCache[Ge.id];for(const Ge of Te)delete this.keyCache[Ge],delete this._layerConfigs[Ge],delete this._layers[Ge];this.familiesBySource={};const Ze=function(Ge,at){const xt={};for(let wt=0;wt<Ge.length;wt++){const Rt=at&&at[Ge[wt].id]||B(Ge[wt]);at&&(at[Ge[wt].id]=Rt);let Tt=xt[Rt];Tt||(Tt=xt[Rt]=[]),Tt.push(Ge[wt])}const lt=[];for(const wt in xt)lt.push(xt[wt]);return lt}(r.bd(this._layerConfigs),this.keyCache);for(const Ge of Ze){const at=Ge.map(Zt=>this._layers[Zt.id]),xt=at[0];if(xt.visibility==="none")continue;const lt=xt.source||"";let wt=this.familiesBySource[lt];wt||(wt=this.familiesBySource[lt]={});const Rt=xt.sourceLayer||"_geojsonTileLayer";let Tt=wt[Rt];Tt||(Tt=wt[Rt]=[]),Tt.push(at)}}}const $=1*r.dP;class W{constructor(ye){const Te={},Ve=[];for(const xt in ye){const lt=ye[xt],wt=Te[xt]={};for(const Rt in lt.glyphs){const Tt=lt.glyphs[+Rt];if(!Tt||Tt.bitmap.width===0||Tt.bitmap.height===0)continue;const Zt=Tt.metrics.localGlyph?$:1,xn={x:0,y:0,w:Tt.bitmap.width+2*Zt,h:Tt.bitmap.height+2*Zt};Ve.push(xn),wt[Rt]=xn}}const{w:Ze,h:Ge}=r.z(Ve),at=new r.dO({width:Ze||1,height:Ge||1});for(const xt in ye){const lt=ye[xt];for(const wt in lt.glyphs){const Rt=lt.glyphs[+wt];if(!Rt||Rt.bitmap.width===0||Rt.bitmap.height===0)continue;const Tt=Te[xt][wt],Zt=Rt.metrics.localGlyph?$:1;r.dO.copy(Rt.bitmap,at,{x:0,y:0},{x:Tt.x+Zt,y:Tt.y+Zt},Rt.bitmap)}}this.image=at,this.positions=Te}}r.dN(W,"GlyphAtlas");class q{constructor(ye){this.tileID=new r.aA(ye.tileID.overscaledZ,ye.tileID.wrap,ye.tileID.canonical.z,ye.tileID.canonical.x,ye.tileID.canonical.y),this.tileZoom=ye.tileZoom,this.uid=ye.uid,this.zoom=ye.zoom,this.lut=ye.lut,this.canonical=ye.tileID.canonical,this.pixelRatio=ye.pixelRatio,this.tileSize=ye.tileSize,this.source=ye.source,this.scope=ye.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ye.showCollisionBoxes,this.collectResourceTiming=!!ye.collectResourceTiming,this.promoteId=ye.promoteId,this.isSymbolTile=ye.isSymbolTile,this.tileTransform=r.aK(ye.tileID.canonical,ye.projection),this.projection=ye.projection,this.brightness=ye.brightness,this.extraShadowCaster=!!ye.extraShadowCaster,this.tessellationStep=ye.tessellationStep}parse(ye,Te,Ve,Ze,Ge){this.status="parsing",this.data=ye,this.collisionBoxArray=new r.aQ;const at=new r.dQ(Object.keys(ye.layers).sort()),xt=new r.dR(this.tileID,this.promoteId);xt.bucketLayerIDs=[];const lt={},wt=new r.dS(256,256),Rt={featureIndex:xt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:wt,availableImages:Ve,brightness:this.brightness},Tt=Te.familiesBySource[this.source];for(const Un in Tt){const bi=ye.layers[Un];if(!bi)continue;let Ri=!1,ni=!1,Ai=!1;for(const Pr of Tt[Un])Pr[0].type==="symbol"?Ri=!0:ni=!0,Pr[0].is3D()&&Pr[0].type!=="model"&&(Ai=!0);if(this.extraShadowCaster&&!Ai||this.isSymbolTile===!0&&!Ri||this.isSymbolTile===!1&&!ni)continue;bi.version===1&&r.w(`Vector tile source "${this.source}" layer "${Un}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const qi=at.encode(Un),Qi=[];for(let Pr=0;Pr<bi.length;Pr++){const Dr=bi.feature(Pr),uo=xt.getId(Dr,Un);Qi.push({feature:Dr,id:uo,index:Pr,sourceLayerIndex:qi})}for(const Pr of Tt[Un]){const Dr=Pr[0];(!this.extraShadowCaster||Dr.is3D()&&Dr.type!=="model")&&(this.isSymbolTile!==void 0&&Dr.type==="symbol"!==this.isSymbolTile||Dr.minzoom&&this.zoom<Math.floor(Dr.minzoom)||Dr.maxzoom&&this.zoom>=Dr.maxzoom||Dr.visibility!=="none"&&(ne(Pr,this.zoom,Rt.brightness,Ve),(lt[Dr.id]=Dr.createBucket({index:xt.bucketLayerIDs.length,layers:Pr,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:qi,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Qi,Rt,this.tileID.canonical,this.tileTransform),xt.bucketLayerIDs.push(Pr.map(uo=>uo.id))))}}let Zt,xn,wn,$n;wt.trim();const Zn={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Xn=()=>{if(Zt)return this.status="done",Ge(Zt);if(this.extraShadowCaster)this.status="done",Ge(null,{buckets:r.bd(lt).filter(Un=>!Un.isEmpty()),featureIndex:xt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Rt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(xn&&wn&&$n){const Un=new W(xn),bi=new r.dU(wn,$n,this.lut);for(const Ri in lt){const ni=lt[Ri];ni instanceof r.aR?(ne(ni.layers,this.zoom,Rt.brightness,Ve),r.dV(ni,xn,Un.positions,wn,bi.iconPositions,this.showCollisionBoxes,Ve,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):ni.hasPattern&&(ni instanceof r.aX||ni instanceof r.aY||ni instanceof r.d0)&&(ne(ni.layers,this.zoom,Rt.brightness,Ve),ni.addFeatures(Rt,this.tileID.canonical,bi.patternPositions,Ve,this.tileTransform,this.brightness))}this.status="done",Ge(null,{buckets:r.bd(lt).filter(Ri=>!Ri.isEmpty()),featureIndex:xt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Un.image,lineAtlas:wt,imageAtlas:bi,brightness:Rt.brightness})}};if(!this.extraShadowCaster){const Un=r.dT(Rt.glyphDependencies,ni=>Object.keys(ni).map(Number));Object.keys(Un).length?Ze.send("getGlyphs",{uid:this.uid,stacks:Un,scope:this.scope},(ni,Ai)=>{Zt||(Zt=ni,xn=Ai,Xn())},void 0,!1,Zn):xn={};const bi=Object.keys(Rt.iconDependencies);bi.length?Ze.send("getImages",{icons:bi,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(ni,Ai)=>{Zt||(Zt=ni,wn=Ai,Xn())},void 0,!1,Zn):wn={};const Ri=Object.keys(Rt.patternDependencies);Ri.length?Ze.send("getImages",{icons:Ri,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(ni,Ai)=>{Zt||(Zt=ni,$n=Ai,Xn())},void 0,!1,Zn):$n={}}Xn()}}function ne(vt,ye,Te,Ve){const Ze=new r.a3(ye,{brightness:Te});for(const Ge of vt)Ge.recalculate(Ze,Ve)}class ce extends r.E{constructor(ye,Te,Ve,Ze,Ge,at){super(),this.actor=ye,this.layerIndex=Te,this.availableImages=Ve,this.loadVectorData=Ge||r.aw,this.loading={},this.loaded={},this.deduped=new r.au(ye.scheduler),this.isSpriteLoaded=Ze,this.scheduler=ye.scheduler,this.brightness=at}loadTile(ye,Te){const Ve=ye.uid,Ze=ye&&ye.request,Ge=Ze&&Ze.collectResourceTiming,at=this.loading[Ve]=new q(ye);at.abort=this.loadVectorData(ye,(xt,lt)=>{const wt=!this.loading[Ve];if(delete this.loading[Ve],wt||xt||!lt)return at.status="done",wt||(this.loaded[Ve]=at),Te(xt);const Rt=lt.rawData,Tt={};lt.expires&&(Tt.expires=lt.expires),lt.cacheControl&&(Tt.cacheControl=lt.cacheControl),at.vectorTile=lt.vectorTile||new r.dW.VectorTile(new r.bb(Rt));const Zt=()=>{at.parse(at.vectorTile,this.layerIndex,this.availableImages,this.actor,(xn,wn)=>{if(xn||!wn)return Te(xn);const $n={};if(Ge){const Zn=D(Ze);Zn.length>0&&($n.resourceTiming=JSON.parse(JSON.stringify(Zn)))}Te(null,r.l({rawTileData:Rt.slice(0)},wn,Tt,$n))})};this.isSpriteLoaded?Zt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Zt,{type:"parseTile",isSymbolTile:ye.isSymbolTile,zoom:ye.tileZoom}):Zt()}),this.loaded=this.loaded||{},this.loaded[Ve]=at})}reloadTile(ye,Te){const Ve=this.loaded,Ze=ye.uid;if(Ve&&Ve[Ze]){const Ge=Ve[Ze];Ge.showCollisionBoxes=ye.showCollisionBoxes,Ge.projection=ye.projection,Ge.brightness=ye.brightness,Ge.tileTransform=r.aK(ye.tileID.canonical,ye.projection),Ge.extraShadowCaster=ye.extraShadowCaster,Ge.lut=ye.lut;const at=(xt,lt)=>{const wt=Ge.reloadCallback;wt&&(delete Ge.reloadCallback,Ge.parse(Ge.vectorTile,this.layerIndex,this.availableImages,this.actor,wt)),Te(xt,lt)};Ge.status==="parsing"?Ge.reloadCallback=at:Ge.status==="done"&&(Ge.vectorTile?Ge.parse(Ge.vectorTile,this.layerIndex,this.availableImages,this.actor,at):at())}else Te(null,void 0)}abortTile(ye,Te){const Ve=ye.uid,Ze=this.loading[Ve];Ze&&(Ze.abort&&Ze.abort(),delete this.loading[Ve]),Te()}removeTile(ye,Te){const Ve=this.loaded,Ze=ye.uid;Ve&&Ve[Ze]&&delete Ve[Ze],Te()}}class oe{loadTile(ye,Te){const{uid:Ve,encoding:Ze,rawImageData:Ge,padding:at}=ye,xt=ImageBitmap&&Ge instanceof ImageBitmap?this.getImageData(Ge,at):Ge;Te(null,new r.dX(Ve,xt,Ze,at<1))}getImageData(ye,Te){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ye.width,ye.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ye.width,this.offscreenCanvas.height=ye.height,this.offscreenCanvasContext.drawImage(ye,0,0,ye.width,ye.height);const Ve=this.offscreenCanvasContext.getImageData(-Te,-Te,ye.width+2*Te,ye.height+2*Te);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Ve}}r.ba.setPbf(r.bb);class fe{decodeRasterArray({task:ye,buffer:Te},Ve){r.ba.performDecoding(Te,ye).then(Ze=>{Ve(null,Ze)},Ze=>{Ve(Ze)})}}const be=r.dW.VectorTileFeature.prototype.toGeoJSON;class ge{constructor(ye){this._feature=ye,this.extent=r.ab,this.type=ye.type,this.properties=ye.tags,"id"in ye&&!isNaN(ye.id)&&(this.id=parseInt(ye.id,10))}loadGeometry(){if(this._feature.type===1){const ye=[];for(const Te of this._feature.geometry)ye.push([new r.P(Te[0],Te[1])]);return ye}{const ye=[];for(const Te of this._feature.geometry){const Ve=[];for(const Ze of Te)Ve.push(new r.P(Ze[0],Ze[1]));ye.push(Ve)}return ye}}toGeoJSON(ye,Te,Ve){return be.call(this,ye,Te,Ve)}}class Ee{constructor(ye){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r.ab,this.length=ye.length,this._features=ye}feature(ye){return new ge(this._features[ye])}}const de=64/4096,re=128;class Y{constructor(){this.features=new Map}clear(){this.features.clear()}load(ye=[],Te){for(const Ve of ye){const Ze=Ve.id;if(Ze==null)continue;let Ge=this.features.get(Ze);Ge&&this.updateCache(Ge,Te),Ve.geometry?(Ge=te(Ve),this.updateCache(Ge,Te),this.features.set(Ze,Ge)):this.features.delete(Ze),this.updateCache(Ge,Te)}}updateCache(ye,Te){for(const{canonical:Ve,uid:Ze}of Object.values(Te)){const{z:Ge,x:at,y:xt}=Ve;ie(ye,Math.pow(2,Ge),at,xt)&&delete Te[Ze]}}getTile(ye,Te,Ve){const Ze=Math.pow(2,ye),Ge=[];for(const at of this.features.values())ie(at,Ze,Te,Ve)&&Ge.push(tt(at,Ze,Te,Ve));return{features:Ge}}getFeatures(){return[...this.features.values()]}}function ie({minX:vt,minY:ye,maxX:Te,maxY:Ve},Ze,Ge,at){return vt<(Ge+1+de)/Ze&&ye<(at+1+de)/Ze&&Te>(Ge-de)/Ze&&Ve>(at-de)/Ze}function te(vt){const{id:ye,geometry:Te,properties:Ve}=vt;if(!Te)return;if(Te.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Ze,coordinates:Ge}=Te,at={id:ye,type:1,geometry:[],tags:Ve,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},xt=at.geometry;if(Ze==="Point")ae(Ge,xt,at);else if(Ze==="MultiPoint")for(const lt of Ge)ae(lt,xt,at);else if(Ze==="LineString")at.type=2,pe(Ge,xt,at);else if(Ze==="MultiLineString")at.type=2,Le(Ge,xt,at);else if(Ze==="Polygon")at.type=3,Le(Ge,xt,at,!0);else{if(Ze!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");at.type=3;for(const lt of Ge)Le(lt,xt,at,!0)}return at}function ae([vt,ye],Te,Ve){const Ze=r.am(vt);let Ge=r.at(ye);Ge=Ge<0?0:Ge>1?1:Ge,Te.push(Ze,Ge),Ve.minX=Math.min(Ve.minX,Ze),Ve.minY=Math.min(Ve.minY,Ge),Ve.maxX=Math.max(Ve.maxX,Ze),Ve.maxY=Math.max(Ve.maxY,Ge)}function pe(vt,ye,Te,Ve=!1,Ze=!1){const Ge=[];for(const at of vt)ae(at,Ge,Te);ye.push(Ge),Ve&&function(at,xt){let lt=0;for(let wt=0,Rt=at.length,Tt=Rt-2;wt<Rt;Tt=wt,wt+=2)lt+=(at[wt]-at[Tt])*(at[wt+1]+at[Tt+1]);if(lt>0===xt)for(let wt=0,Rt=at.length;wt<Rt/2;wt+=2){const Tt=at[wt],Zt=at[wt+1];at[wt]=at[Rt-2-wt],at[wt+1]=at[Rt-1-wt],at[Rt-2-wt]=Tt,at[Rt-1-wt]=Zt}}(Ge,Ze)}function Le(vt,ye,Te,Ve=!1){for(let Ze=0;Ze<vt.length;Ze++)pe(vt[Ze],ye,Te,Ve,Ze===0)}function tt(vt,ye,Te,Ve){const{id:Ze,type:Ge,geometry:at,tags:xt}=vt,lt=[];if(Ge===1)(function(wt,Rt,Tt,Zt,xn){for(let wn=0;wn<wt.length;wn+=2){const $n=Math.round(r.ab*(wt[wn+0]*Rt-Tt)),Zn=Math.round(r.ab*(wt[wn+1]*Rt-Zt));xn.push([$n,Zn])}})(at,ye,Te,Ve,lt);else for(const wt of at)Je(wt,ye,Te,Ve,lt);return{id:Ze,type:Ge,geometry:lt,tags:xt}}function Je(vt,ye,Te,Ve,Ze){const Ge=-re,at=r.ab+re;let xt;for(let lt=0;lt<vt.length-2;lt+=2){let wt=Math.round(r.ab*(vt[lt+0]*ye-Te)),Rt=Math.round(r.ab*(vt[lt+1]*ye-Ve)),Tt=Math.round(r.ab*(vt[lt+2]*ye-Te)),Zt=Math.round(r.ab*(vt[lt+3]*ye-Ve));const xn=Tt-wt,wn=Zt-Rt;wt<Ge&&Tt<Ge||(wt<Ge?(Rt+=Math.round(wn*((Ge-wt)/xn)),wt=Ge):Tt<Ge&&(Zt=Rt+Math.round(wn*((Ge-wt)/xn)),Tt=Ge),Rt<Ge&&Zt<Ge||(Rt<Ge?(wt+=Math.round(xn*((Ge-Rt)/wn)),Rt=Ge):Zt<Ge&&(Tt=wt+Math.round(xn*((Ge-Rt)/wn)),Zt=Ge),wt>=at&&Tt>=at||(wt>=at?(Rt+=Math.round(wn*((at-wt)/xn)),wt=at):Tt>=at&&(Zt=Rt+Math.round(wn*((at-wt)/xn)),Tt=at),Rt>=at&&Zt>=at||(Rt>=at?(wt+=Math.round(xn*((at-Rt)/wn)),Rt=at):Zt>=at&&(Tt=wt+Math.round(xn*((at-Rt)/wn)),Zt=at),xt&&wt===xt[xt.length-1][0]&&Rt===xt[xt.length-1][1]||(xt=[[wt,Rt]],Ze.push(xt)),xt.push([Tt,Zt])))))}}var Mt,Lt,yt,rt={exports:{}},mt=function(){if(yt)return rt.exports;yt=1;var vt=r.d_(),ye=function(){if(Lt)return Mt;Lt=1;var Rt=r.dY(),Tt=r.dZ().VectorTileFeature;function Zt(wn,$n){this.options=$n||{},this.features=wn,this.length=wn.length}function xn(wn,$n){this.id=typeof wn.id=="number"?wn.id:void 0,this.type=wn.type,this.rawGeometry=wn.type===1?[wn.geometry]:wn.geometry,this.properties=wn.tags,this.extent=$n||4096}return Mt=Zt,Zt.prototype.feature=function(wn){return new xn(this.features[wn],this.options.extent)},xn.prototype.loadGeometry=function(){var wn=this.rawGeometry;this.geometry=[];for(var $n=0;$n<wn.length;$n++){for(var Zn=wn[$n],Xn=[],Un=0;Un<Zn.length;Un++)Xn.push(new Rt(Zn[Un][0],Zn[Un][1]));this.geometry.push(Xn)}return this.geometry},xn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var wn=this.geometry,$n=1/0,Zn=-1/0,Xn=1/0,Un=-1/0,bi=0;bi<wn.length;bi++)for(var Ri=wn[bi],ni=0;ni<Ri.length;ni++){var Ai=Ri[ni];$n=Math.min($n,Ai.x),Zn=Math.max(Zn,Ai.x),Xn=Math.min(Xn,Ai.y),Un=Math.max(Un,Ai.y)}return[$n,Xn,Zn,Un]},xn.prototype.toGeoJSON=Tt.prototype.toGeoJSON,Mt}();function Te(Rt){var Tt=new vt;return function(Zt,xn){for(var wn in Zt.layers)xn.writeMessage(3,Ve,Zt.layers[wn])}(Rt,Tt),Tt.finish()}function Ve(Rt,Tt){var Zt;Tt.writeVarintField(15,Rt.version||1),Tt.writeStringField(1,Rt.name||""),Tt.writeVarintField(5,Rt.extent||4096);var xn={keys:[],values:[],keycache:{},valuecache:{}};for(Zt=0;Zt<Rt.length;Zt++)xn.feature=Rt.feature(Zt),Tt.writeMessage(2,Ze,xn);var wn=xn.keys;for(Zt=0;Zt<wn.length;Zt++)Tt.writeStringField(3,wn[Zt]);var $n=xn.values;for(Zt=0;Zt<$n.length;Zt++)Tt.writeMessage(4,wt,$n[Zt])}function Ze(Rt,Tt){var Zt=Rt.feature;Zt.id!==void 0&&Tt.writeVarintField(1,Zt.id),Tt.writeMessage(2,Ge,Rt),Tt.writeVarintField(3,Zt.type),Tt.writeMessage(4,lt,Zt)}function Ge(Rt,Tt){var Zt=Rt.feature,xn=Rt.keys,wn=Rt.values,$n=Rt.keycache,Zn=Rt.valuecache;for(var Xn in Zt.properties){var Un=Zt.properties[Xn],bi=$n[Xn];if(Un!==null){bi===void 0&&(xn.push(Xn),$n[Xn]=bi=xn.length-1),Tt.writeVarint(bi);var Ri=typeof Un;Ri!=="string"&&Ri!=="boolean"&&Ri!=="number"&&(Un=JSON.stringify(Un));var ni=Ri+":"+Un,Ai=Zn[ni];Ai===void 0&&(wn.push(Un),Zn[ni]=Ai=wn.length-1),Tt.writeVarint(Ai)}}}function at(Rt,Tt){return(Tt<<3)+(7&Rt)}function xt(Rt){return Rt<<1^Rt>>31}function lt(Rt,Tt){for(var Zt=Rt.loadGeometry(),xn=Rt.type,wn=0,$n=0,Zn=Zt.length,Xn=0;Xn<Zn;Xn++){var Un=Zt[Xn],bi=1;xn===1&&(bi=Un.length),Tt.writeVarint(at(1,bi));for(var Ri=xn===3?Un.length-1:Un.length,ni=0;ni<Ri;ni++){ni===1&&xn!==1&&Tt.writeVarint(at(2,Ri-1));var Ai=Un[ni].x-wn,qi=Un[ni].y-$n;Tt.writeVarint(xt(Ai)),Tt.writeVarint(xt(qi)),wn+=Ai,$n+=qi}xn===3&&Tt.writeVarint(at(7,1))}}function wt(Rt,Tt){var Zt=typeof Rt;Zt==="string"?Tt.writeStringField(1,Rt):Zt==="boolean"?Tt.writeBooleanField(7,Rt):Zt==="number"&&(Rt%1!=0?Tt.writeDoubleField(3,Rt):Rt<0?Tt.writeSVarintField(6,Rt):Tt.writeVarintField(5,Rt))}return rt.exports=Te,rt.exports.fromVectorTileJs=Te,rt.exports.fromGeojsonVt=function(Rt,Tt){Tt=Tt||{};var Zt={};for(var xn in Rt)Zt[xn]=new ye(Rt[xn].features,Tt),Zt[xn].name=xn,Zt[xn].version=Tt.version,Zt[xn].extent=Tt.extent;return Te({layers:Zt})},rt.exports.GeoJSONWrapper=ye,rt.exports}(),Ft=r.d$(mt);const bn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:vt=>vt},Bt=Math.fround||(ht=new Float32Array(1),vt=>(ht[0]=+vt,ht[0]));var ht;const gt=3,et=5,Nt=6;class St{constructor(ye){this.options=Object.assign(Object.create(bn),ye),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ye){const{log:Te,minZoom:Ve,maxZoom:Ze}=this.options;Te&&console.time("total time");const Ge=`prepare ${ye.length} points`;Te&&console.time(Ge),this.points=ye;const at=[];for(let lt=0;lt<ye.length;lt++){const wt=ye[lt];if(!wt.geometry)continue;const[Rt,Tt]=wt.geometry.coordinates,Zt=Bt(gn(Rt)),xn=Bt(Ae(Tt));at.push(Zt,xn,1/0,lt,-1,1),this.options.reduce&&at.push(0)}let xt=this.trees[Ze+1]=this._createTree(at);Te&&console.timeEnd(Ge);for(let lt=Ze;lt>=Ve;lt--){const wt=+Date.now();xt=this.trees[lt]=this._createTree(this._cluster(xt,lt)),Te&&console.log("z%d: %d clusters in %dms",lt,xt.numItems,+Date.now()-wt)}return Te&&console.timeEnd("total time"),this}getClusters(ye,Te){let Ve=((ye[0]+180)%360+360)%360-180;const Ze=Math.max(-90,Math.min(90,ye[1]));let Ge=ye[2]===180?180:((ye[2]+180)%360+360)%360-180;const at=Math.max(-90,Math.min(90,ye[3]));if(ye[2]-ye[0]>=360)Ve=-180,Ge=180;else if(Ve>Ge){const Tt=this.getClusters([Ve,Ze,180,at],Te),Zt=this.getClusters([-180,Ze,Ge,at],Te);return Tt.concat(Zt)}const xt=this.trees[this._limitZoom(Te)],lt=xt.range(gn(Ve),Ae(at),gn(Ge),Ae(Ze)),wt=xt.data,Rt=[];for(const Tt of lt){const Zt=this.stride*Tt;Rt.push(wt[Zt+et]>1?Xt(wt,Zt,this.clusterProps):this.points[wt[Zt+gt]])}return Rt}getChildren(ye){const Te=this._getOriginId(ye),Ve=this._getOriginZoom(ye),Ze="No cluster with the specified id.",Ge=this.trees[Ve];if(!Ge)throw new Error(Ze);const at=Ge.data;if(Te*this.stride>=at.length)throw new Error(Ze);const xt=this.options.radius/(this.options.extent*Math.pow(2,Ve-1)),lt=Ge.within(at[Te*this.stride],at[Te*this.stride+1],xt),wt=[];for(const Rt of lt){const Tt=Rt*this.stride;at[Tt+4]===ye&&wt.push(at[Tt+et]>1?Xt(at,Tt,this.clusterProps):this.points[at[Tt+gt]])}if(wt.length===0)throw new Error(Ze);return wt}getLeaves(ye,Te,Ve){const Ze=[];return this._appendLeaves(Ze,ye,Te=Te||10,Ve=Ve||0,0),Ze}getTile(ye,Te,Ve){const Ze=this.trees[this._limitZoom(ye)],Ge=Math.pow(2,ye),{extent:at,radius:xt}=this.options,lt=xt/at,wt=(Ve-lt)/Ge,Rt=(Ve+1+lt)/Ge,Tt={features:[]};return this._addTileFeatures(Ze.range((Te-lt)/Ge,wt,(Te+1+lt)/Ge,Rt),Ze.data,Te,Ve,Ge,Tt),Te===0&&this._addTileFeatures(Ze.range(1-lt/Ge,wt,1,Rt),Ze.data,Ge,Ve,Ge,Tt),Te===Ge-1&&this._addTileFeatures(Ze.range(0,wt,lt/Ge,Rt),Ze.data,-1,Ve,Ge,Tt),Tt.features.length?Tt:null}getClusterExpansionZoom(ye){let Te=this._getOriginZoom(ye)-1;for(;Te<=this.options.maxZoom;){const Ve=this.getChildren(ye);if(Te++,Ve.length!==1)break;ye=Ve[0].properties.cluster_id}return Te}_appendLeaves(ye,Te,Ve,Ze,Ge){const at=this.getChildren(Te);for(const xt of at){const lt=xt.properties;if(lt&&lt.cluster?Ge+lt.point_count<=Ze?Ge+=lt.point_count:Ge=this._appendLeaves(ye,lt.cluster_id,Ve,Ze,Ge):Ge<Ze?Ge++:ye.push(xt),ye.length===Ve)break}return Ge}_createTree(ye){const Te=new r.by(ye.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Ve=0;Ve<ye.length;Ve+=this.stride)Te.add(ye[Ve],ye[Ve+1]);return Te.finish(),Te.data=ye,Te}_addTileFeatures(ye,Te,Ve,Ze,Ge,at){for(const xt of ye){const lt=xt*this.stride,wt=Te[lt+et]>1;let Rt,Tt,Zt;if(wt)Rt=Ie(Te,lt,this.clusterProps),Tt=Te[lt],Zt=Te[lt+1];else{const $n=this.points[Te[lt+gt]];Rt=$n.properties;const[Zn,Xn]=$n.geometry.coordinates;Tt=gn(Zn),Zt=Ae(Xn)}const xn={type:1,geometry:[[Math.round(this.options.extent*(Tt*Ge-Ve)),Math.round(this.options.extent*(Zt*Ge-Ze))]],tags:Rt};let wn;wn=wt||this.options.generateId?Te[lt+gt]:this.points[Te[lt+gt]].id,wn!==void 0&&(xn.id=wn),at.features.push(xn)}}_limitZoom(ye){return Math.max(this.options.minZoom,Math.min(Math.floor(+ye),this.options.maxZoom+1))}_cluster(ye,Te){const{radius:Ve,extent:Ze,reduce:Ge,minPoints:at}=this.options,xt=Ve/(Ze*Math.pow(2,Te)),lt=ye.data,wt=[],Rt=this.stride;for(let Tt=0;Tt<lt.length;Tt+=Rt){if(lt[Tt+2]<=Te)continue;lt[Tt+2]=Te;const Zt=lt[Tt],xn=lt[Tt+1],wn=ye.within(lt[Tt],lt[Tt+1],xt),$n=lt[Tt+et];let Zn=$n;for(const Xn of wn){const Un=Xn*Rt;lt[Un+2]>Te&&(Zn+=lt[Un+et])}if(Zn>$n&&Zn>=at){let Xn,Un=Zt*$n,bi=xn*$n,Ri=-1;const ni=(Tt/Rt<<5)+(Te+1)+this.points.length;for(const Ai of wn){const qi=Ai*Rt;if(lt[qi+2]<=Te)continue;lt[qi+2]=Te;const Qi=lt[qi+et];Un+=lt[qi]*Qi,bi+=lt[qi+1]*Qi,lt[qi+4]=ni,Ge&&(Xn||(Xn=this._map(lt,Tt,!0),Ri=this.clusterProps.length,this.clusterProps.push(Xn)),Ge(Xn,this._map(lt,qi)))}lt[Tt+4]=ni,wt.push(Un/Zn,bi/Zn,1/0,ni,-1,Zn),Ge&&wt.push(Ri)}else{for(let Xn=0;Xn<Rt;Xn++)wt.push(lt[Tt+Xn]);if(Zn>1)for(const Xn of wn){const Un=Xn*Rt;if(!(lt[Un+2]<=Te)){lt[Un+2]=Te;for(let bi=0;bi<Rt;bi++)wt.push(lt[Un+bi])}}}}return wt}_getOriginId(ye){return ye-this.points.length>>5}_getOriginZoom(ye){return(ye-this.points.length)%32}_map(ye,Te,Ve){if(ye[Te+et]>1){const at=this.clusterProps[ye[Te+Nt]];return Ve?Object.assign({},at):at}const Ze=this.points[ye[Te+gt]].properties,Ge=this.options.map(Ze);return Ve&&Ge===Ze?Object.assign({},Ge):Ge}}function Xt(vt,ye,Te){return{type:"Feature",id:vt[ye+gt],properties:Ie(vt,ye,Te),geometry:{type:"Point",coordinates:[(Ve=vt[ye],360*(Ve-.5)),Ne(vt[ye+1])]}};var Ve}function Ie(vt,ye,Te){const Ve=vt[ye+et],Ze=Ve>=1e4?`${Math.round(Ve/1e3)}k`:Ve>=1e3?Math.round(Ve/100)/10+"k":Ve,Ge=vt[ye+Nt],at=Ge===-1?{}:Object.assign({},Te[Ge]);return Object.assign(at,{cluster:!0,cluster_id:vt[ye+gt],point_count:Ve,point_count_abbreviated:Ze})}function gn(vt){return vt/360+.5}function Ae(vt){const ye=Math.sin(vt*Math.PI/180),Te=.5-.25*Math.log((1+ye)/(1-ye))/Math.PI;return Te<0?0:Te>1?1:Te}function Ne(vt){const ye=(180-360*vt)*Math.PI/180;return 360*Math.atan(Math.exp(ye))/Math.PI-90}function Ue(vt,ye,Te,Ve){let Ze=Ve;const Ge=ye+(Te-ye>>1);let at,xt=Te-ye;const lt=vt[ye],wt=vt[ye+1],Rt=vt[Te],Tt=vt[Te+1];for(let Zt=ye+3;Zt<Te;Zt+=3){const xn=Et(vt[Zt],vt[Zt+1],lt,wt,Rt,Tt);if(xn>Ze)at=Zt,Ze=xn;else if(xn===Ze){const wn=Math.abs(Zt-Ge);wn<xt&&(at=Zt,xt=wn)}}Ze>Ve&&(at-ye>3&&Ue(vt,ye,at,Ve),vt[at+2]=Ze,Te-at>3&&Ue(vt,at,Te,Ve))}function Et(vt,ye,Te,Ve,Ze,Ge){let at=Ze-Te,xt=Ge-Ve;if(at!==0||xt!==0){const lt=((vt-Te)*at+(ye-Ve)*xt)/(at*at+xt*xt);lt>1?(Te=Ze,Ve=Ge):lt>0&&(Te+=at*lt,Ve+=xt*lt)}return at=vt-Te,xt=ye-Ve,at*at+xt*xt}function Ct(vt,ye,Te,Ve){const Ze={id:vt??null,type:ye,geometry:Te,tags:Ve,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ye==="Point"||ye==="MultiPoint"||ye==="LineString")Qt(Ze,Te);else if(ye==="Polygon")Qt(Ze,Te[0]);else if(ye==="MultiLineString")for(const Ge of Te)Qt(Ze,Ge);else if(ye==="MultiPolygon")for(const Ge of Te)Qt(Ze,Ge[0]);return Ze}function Qt(vt,ye){for(let Te=0;Te<ye.length;Te+=3)vt.minX=Math.min(vt.minX,ye[Te]),vt.minY=Math.min(vt.minY,ye[Te+1]),vt.maxX=Math.max(vt.maxX,ye[Te]),vt.maxY=Math.max(vt.maxY,ye[Te+1])}function Gt(vt,ye,Te,Ve){if(!ye.geometry)return;const Ze=ye.geometry.coordinates;if(Ze&&Ze.length===0)return;const Ge=ye.geometry.type,at=Math.pow(Te.tolerance/((1<<Te.maxZoom)*Te.extent),2);let xt=[],lt=ye.id;if(Te.promoteId?lt=ye.properties[Te.promoteId]:Te.generateId&&(lt=Ve||0),Ge==="Point")Yt(Ze,xt);else if(Ge==="MultiPoint")for(const wt of Ze)Yt(wt,xt);else if(Ge==="LineString")vn(Ze,xt,at,!1);else if(Ge==="MultiLineString"){if(Te.lineMetrics){for(const wt of Ze)xt=[],vn(wt,xt,at,!1),vt.push(Ct(lt,"LineString",xt,ye.properties));return}dn(Ze,xt,at,!1)}else if(Ge==="Polygon")dn(Ze,xt,at,!0);else{if(Ge!=="MultiPolygon"){if(Ge==="GeometryCollection"){for(const wt of ye.geometry.geometries)Gt(vt,{id:lt,geometry:wt,properties:ye.properties},Te,Ve);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const wt of Ze){const Rt=[];dn(wt,Rt,at,!0),xt.push(Rt)}}vt.push(Ct(lt,Ge,xt,ye.properties))}function Yt(vt,ye){ye.push(Wn(vt[0]),Rn(vt[1]),0)}function vn(vt,ye,Te,Ve){let Ze,Ge,at=0;for(let lt=0;lt<vt.length;lt++){const wt=Wn(vt[lt][0]),Rt=Rn(vt[lt][1]);ye.push(wt,Rt,0),lt>0&&(at+=Ve?(Ze*Rt-wt*Ge)/2:Math.sqrt(Math.pow(wt-Ze,2)+Math.pow(Rt-Ge,2))),Ze=wt,Ge=Rt}const xt=ye.length-3;ye[2]=1,Ue(ye,0,xt,Te),ye[xt+2]=1,ye.size=Math.abs(at),ye.start=0,ye.end=ye.size}function dn(vt,ye,Te,Ve){for(let Ze=0;Ze<vt.length;Ze++){const Ge=[];vn(vt[Ze],Ge,Te,Ve),ye.push(Ge)}}function Wn(vt){return vt/360+.5}function Rn(vt){const ye=Math.sin(vt*Math.PI/180),Te=.5-.25*Math.log((1+ye)/(1-ye))/Math.PI;return Te<0?0:Te>1?1:Te}function hn(vt,ye,Te,Ve,Ze,Ge,at,xt){if(Ve/=ye,Ge>=(Te/=ye)&&at<Ve)return vt;if(at<Te||Ge>=Ve)return null;const lt=[];for(const wt of vt){const Rt=wt.geometry;let Tt=wt.type;const Zt=Ze===0?wt.minX:wt.minY,xn=Ze===0?wt.maxX:wt.maxY;if(Zt>=Te&&xn<Ve){lt.push(wt);continue}if(xn<Te||Zt>=Ve)continue;let wn=[];if(Tt==="Point"||Tt==="MultiPoint")jn(Rt,wn,Te,Ve,Ze);else if(Tt==="LineString")ti(Rt,wn,Te,Ve,Ze,!1,xt.lineMetrics);else if(Tt==="MultiLineString")gi(Rt,wn,Te,Ve,Ze,!1);else if(Tt==="Polygon")gi(Rt,wn,Te,Ve,Ze,!0);else if(Tt==="MultiPolygon")for(const $n of Rt){const Zn=[];gi($n,Zn,Te,Ve,Ze,!0),Zn.length&&wn.push(Zn)}if(wn.length){if(xt.lineMetrics&&Tt==="LineString"){for(const $n of wn)lt.push(Ct(wt.id,Tt,$n,wt.tags));continue}Tt!=="LineString"&&Tt!=="MultiLineString"||(wn.length===1?(Tt="LineString",wn=wn[0]):Tt="MultiLineString"),Tt!=="Point"&&Tt!=="MultiPoint"||(Tt=wn.length===3?"Point":"MultiPoint"),lt.push(Ct(wt.id,Tt,wn,wt.tags))}}return lt.length?lt:null}function jn(vt,ye,Te,Ve,Ze){for(let Ge=0;Ge<vt.length;Ge+=3){const at=vt[Ge+Ze];at>=Te&&at<=Ve&&or(ye,vt[Ge],vt[Ge+1],vt[Ge+2])}}function ti(vt,ye,Te,Ve,Ze,Ge,at){let xt=ki(vt);const lt=Ze===0?wr:Rr;let wt,Rt,Tt=vt.start;for(let Zn=0;Zn<vt.length-3;Zn+=3){const Xn=vt[Zn],Un=vt[Zn+1],bi=vt[Zn+2],Ri=vt[Zn+3],ni=vt[Zn+4],Ai=Ze===0?Xn:Un,qi=Ze===0?Ri:ni;let Qi=!1;at&&(wt=Math.sqrt(Math.pow(Xn-Ri,2)+Math.pow(Un-ni,2))),Ai<Te?qi>Te&&(Rt=lt(xt,Xn,Un,Ri,ni,Te),at&&(xt.start=Tt+wt*Rt)):Ai>Ve?qi<Ve&&(Rt=lt(xt,Xn,Un,Ri,ni,Ve),at&&(xt.start=Tt+wt*Rt)):or(xt,Xn,Un,bi),qi<Te&&Ai>=Te&&(Rt=lt(xt,Xn,Un,Ri,ni,Te),Qi=!0),qi>Ve&&Ai<=Ve&&(Rt=lt(xt,Xn,Un,Ri,ni,Ve),Qi=!0),!Ge&&Qi&&(at&&(xt.end=Tt+wt*Rt),ye.push(xt),xt=ki(vt)),at&&(Tt+=wt)}let Zt=vt.length-3;const xn=vt[Zt],wn=vt[Zt+1],$n=Ze===0?xn:wn;$n>=Te&&$n<=Ve&&or(xt,xn,wn,vt[Zt+2]),Zt=xt.length-3,Ge&&Zt>=3&&(xt[Zt]!==xt[0]||xt[Zt+1]!==xt[1])&&or(xt,xt[0],xt[1],xt[2]),xt.length&&ye.push(xt)}function ki(vt){const ye=[];return ye.size=vt.size,ye.start=vt.start,ye.end=vt.end,ye}function gi(vt,ye,Te,Ve,Ze,Ge){for(const at of vt)ti(at,ye,Te,Ve,Ze,Ge,!1)}function or(vt,ye,Te,Ve){vt.push(ye,Te,Ve)}function wr(vt,ye,Te,Ve,Ze,Ge){const at=(Ge-ye)/(Ve-ye);return or(vt,Ge,Te+(Ze-Te)*at,1),at}function Rr(vt,ye,Te,Ve,Ze,Ge){const at=(Ge-Te)/(Ze-Te);return or(vt,ye+(Ve-ye)*at,Ge,1),at}function zr(vt,ye){const Te=[];for(let Ve=0;Ve<vt.length;Ve++){const Ze=vt[Ve],Ge=Ze.type;let at;if(Ge==="Point"||Ge==="MultiPoint"||Ge==="LineString")at=dr(Ze.geometry,ye);else if(Ge==="MultiLineString"||Ge==="Polygon"){at=[];for(const xt of Ze.geometry)at.push(dr(xt,ye))}else if(Ge==="MultiPolygon"){at=[];for(const xt of Ze.geometry){const lt=[];for(const wt of xt)lt.push(dr(wt,ye));at.push(lt)}}Te.push(Ct(Ze.id,Ge,at,Ze.tags))}return Te}function dr(vt,ye){const Te=[];Te.size=vt.size,vt.start!==void 0&&(Te.start=vt.start,Te.end=vt.end);for(let Ve=0;Ve<vt.length;Ve+=3)Te.push(vt[Ve]+ye,vt[Ve+1],vt[Ve+2]);return Te}function Ho(vt,ye){if(vt.transformed)return vt;const Te=1<<vt.z,Ve=vt.x,Ze=vt.y;for(const Ge of vt.features){const at=Ge.geometry,xt=Ge.type;if(Ge.geometry=[],xt===1)for(let lt=0;lt<at.length;lt+=2)Ge.geometry.push(Sr(at[lt],at[lt+1],ye,Te,Ve,Ze));else for(let lt=0;lt<at.length;lt++){const wt=[];for(let Rt=0;Rt<at[lt].length;Rt+=2)wt.push(Sr(at[lt][Rt],at[lt][Rt+1],ye,Te,Ve,Ze));Ge.geometry.push(wt)}}return vt.transformed=!0,vt}function Sr(vt,ye,Te,Ve,Ze,Ge){return[Math.round(Te*(vt*Ve-Ze)),Math.round(Te*(ye*Ve-Ge))]}function Tr(vt,ye,Te,Ve,Ze){const Ge=ye===Ze.maxZoom?0:Ze.tolerance/((1<<ye)*Ze.extent),at={features:[],numPoints:0,numSimplified:0,numFeatures:vt.length,source:null,x:Te,y:Ve,z:ye,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const xt of vt)Bo(at,xt,Ge,Ze);return at}function Bo(vt,ye,Te,Ve){const Ze=ye.geometry,Ge=ye.type,at=[];if(vt.minX=Math.min(vt.minX,ye.minX),vt.minY=Math.min(vt.minY,ye.minY),vt.maxX=Math.max(vt.maxX,ye.maxX),vt.maxY=Math.max(vt.maxY,ye.maxY),Ge==="Point"||Ge==="MultiPoint")for(let xt=0;xt<Ze.length;xt+=3)at.push(Ze[xt],Ze[xt+1]),vt.numPoints++,vt.numSimplified++;else if(Ge==="LineString")ii(at,Ze,vt,Te,!1,!1);else if(Ge==="MultiLineString"||Ge==="Polygon")for(let xt=0;xt<Ze.length;xt++)ii(at,Ze[xt],vt,Te,Ge==="Polygon",xt===0);else if(Ge==="MultiPolygon")for(let xt=0;xt<Ze.length;xt++){const lt=Ze[xt];for(let wt=0;wt<lt.length;wt++)ii(at,lt[wt],vt,Te,!0,wt===0)}if(at.length){let xt=ye.tags||null;if(Ge==="LineString"&&Ve.lineMetrics){xt={};for(const wt in ye.tags)xt[wt]=ye.tags[wt];xt.mapbox_clip_start=Ze.start/Ze.size,xt.mapbox_clip_end=Ze.end/Ze.size}const lt={geometry:at,type:Ge==="Polygon"||Ge==="MultiPolygon"?3:Ge==="LineString"||Ge==="MultiLineString"?2:1,tags:xt};ye.id!==null&&(lt.id=ye.id),vt.features.push(lt)}}function ii(vt,ye,Te,Ve,Ze,Ge){const at=Ve*Ve;if(Ve>0&&ye.size<(Ze?at:Ve))return void(Te.numPoints+=ye.length/3);const xt=[];for(let lt=0;lt<ye.length;lt+=3)(Ve===0||ye[lt+2]>at)&&(Te.numSimplified++,xt.push(ye[lt],ye[lt+1])),Te.numPoints++;Ze&&function(lt,wt){let Rt=0;for(let Tt=0,Zt=lt.length,xn=Zt-2;Tt<Zt;xn=Tt,Tt+=2)Rt+=(lt[Tt]-lt[xn])*(lt[Tt+1]+lt[xn+1]);if(Rt>0===wt)for(let Tt=0,Zt=lt.length;Tt<Zt/2;Tt+=2){const xn=lt[Tt],wn=lt[Tt+1];lt[Tt]=lt[Zt-2-Tt],lt[Tt+1]=lt[Zt-1-Tt],lt[Zt-2-Tt]=xn,lt[Zt-1-Tt]=wn}}(xt,Ge),vt.push(xt)}const Qo={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class vs{constructor(ye,Te){const Ve=(Te=this.options=function(Ge,at){for(const xt in at)Ge[xt]=at[xt];return Ge}(Object.create(Qo),Te)).debug;if(Ve&&console.time("preprocess data"),Te.maxZoom<0||Te.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Te.promoteId&&Te.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ze=function(Ge,at){const xt=[];if(Ge.type==="FeatureCollection")for(let lt=0;lt<Ge.features.length;lt++)Gt(xt,Ge.features[lt],at,lt);else Gt(xt,Ge.type==="Feature"?Ge:{geometry:Ge},at);return xt}(ye,Te);this.tiles={},this.tileCoords=[],Ve&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Te.indexMaxZoom,Te.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ze=function(Ge,at){const xt=at.buffer/at.extent;let lt=Ge;const wt=hn(Ge,1,-1-xt,xt,0,-1,2,at),Rt=hn(Ge,1,1-xt,2+xt,0,-1,2,at);return(wt||Rt)&&(lt=hn(Ge,1,-xt,1+xt,0,-1,2,at)||[],wt&&(lt=zr(wt,1).concat(lt)),Rt&&(lt=lt.concat(zr(Rt,-1)))),lt}(Ze,Te),Ze.length&&this.splitTile(Ze,0,0,0),Ve&&(Ze.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ye,Te,Ve,Ze,Ge,at,xt){const lt=[ye,Te,Ve,Ze],wt=this.options,Rt=wt.debug;for(;lt.length;){Ze=lt.pop(),Ve=lt.pop(),Te=lt.pop(),ye=lt.pop();const Tt=1<<Te,Zt=To(Te,Ve,Ze);let xn=this.tiles[Zt];if(!xn&&(Rt>1&&console.time("creation"),xn=this.tiles[Zt]=Tr(ye,Te,Ve,Ze,wt),this.tileCoords.push({z:Te,x:Ve,y:Ze}),Rt)){Rt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Te,Ve,Ze,xn.numFeatures,xn.numPoints,xn.numSimplified),console.timeEnd("creation"));const Qi=`z${Te}`;this.stats[Qi]=(this.stats[Qi]||0)+1,this.total++}if(xn.source=ye,Ge==null){if(Te===wt.indexMaxZoom||xn.numPoints<=wt.indexMaxPoints)continue}else{if(Te===wt.maxZoom||Te===Ge)continue;if(Ge!=null){const Qi=Ge-Te;if(Ve!==at>>Qi||Ze!==xt>>Qi)continue}}if(xn.source=null,ye.length===0)continue;Rt>1&&console.time("clipping");const wn=.5*wt.buffer/wt.extent,$n=.5-wn,Zn=.5+wn,Xn=1+wn;let Un=null,bi=null,Ri=null,ni=null,Ai=hn(ye,Tt,Ve-wn,Ve+Zn,0,xn.minX,xn.maxX,wt),qi=hn(ye,Tt,Ve+$n,Ve+Xn,0,xn.minX,xn.maxX,wt);ye=null,Ai&&(Un=hn(Ai,Tt,Ze-wn,Ze+Zn,1,xn.minY,xn.maxY,wt),bi=hn(Ai,Tt,Ze+$n,Ze+Xn,1,xn.minY,xn.maxY,wt),Ai=null),qi&&(Ri=hn(qi,Tt,Ze-wn,Ze+Zn,1,xn.minY,xn.maxY,wt),ni=hn(qi,Tt,Ze+$n,Ze+Xn,1,xn.minY,xn.maxY,wt),qi=null),Rt>1&&console.timeEnd("clipping"),lt.push(Un||[],Te+1,2*Ve,2*Ze),lt.push(bi||[],Te+1,2*Ve,2*Ze+1),lt.push(Ri||[],Te+1,2*Ve+1,2*Ze),lt.push(ni||[],Te+1,2*Ve+1,2*Ze+1)}}getTile(ye,Te,Ve){ye=+ye,Te=+Te,Ve=+Ve;const Ze=this.options,{extent:Ge,debug:at}=Ze;if(ye<0||ye>24)return null;const xt=1<<ye,lt=To(ye,Te=Te+xt&xt-1,Ve);if(this.tiles[lt])return Ho(this.tiles[lt],Ge);at>1&&console.log("drilling down to z%d-%d-%d",ye,Te,Ve);let wt,Rt=ye,Tt=Te,Zt=Ve;for(;!wt&&Rt>0;)Rt--,Tt>>=1,Zt>>=1,wt=this.tiles[To(Rt,Tt,Zt)];return wt&&wt.source?(at>1&&(console.log("found parent tile z%d-%d-%d",Rt,Tt,Zt),console.time("drilling down")),this.splitTile(wt.source,Rt,Tt,Zt,ye,Te,Ve),at>1&&console.timeEnd("drilling down"),this.tiles[lt]?Ho(this.tiles[lt],Ge):null):null}}function To(vt,ye,Te){return 32*((1<<vt)*Te+ye)+vt}function Eo(vt,ye){const Te=vt.tileID.canonical;if(!this._geoJSONIndex)return void ye(null,null);const Ve=this._geoJSONIndex.getTile(Te.z,Te.x,Te.y);if(!Ve)return void ye(null,null);const Ze=new Ee(Ve.features);let Ge=Ft(Ze);Ge.byteOffset===0&&Ge.byteLength===Ge.buffer.byteLength||(Ge=new Uint8Array(Ge)),ye(null,{vectorTile:Ze,rawData:Ge.buffer})}class es extends ce{constructor(ye,Te,Ve,Ze,Ge,at){super(ye,Te,Ve,Ze,Eo,at),Ge&&(this.loadGeoJSON=Ge),this._dynamicIndex=new Y}loadData(ye,Te){const Ve=ye&&ye.request,Ze=Ve&&Ve.collectResourceTiming;this.loadGeoJSON(ye,(Ge,at)=>{if(Ge||!at)return Te(Ge);if(typeof at!="object")return Te(new Error(`Input data given to '${ye.source}' is not a valid GeoJSON object.`));{try{if(ye.filter){const lt=r.M(ye.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(lt.result==="error")throw new Error(lt.value.map(wt=>`${wt.key}: ${wt.message}`).join(", "));at.features=at.features.filter(wt=>lt.value.evaluate({zoom:0},wt))}ye.dynamic?(at.type==="Feature"&&(at={type:"FeatureCollection",features:[at]}),ye.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(at.features,this.loaded),ye.cluster&&(at.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ye.cluster?new St(function({superclusterOptions:lt,clusterProperties:wt}){if(!wt||!lt)return lt;const Rt={},Tt={},Zt={accumulated:null,zoom:0},xn={properties:null},wn=Object.keys(wt);for(const $n of wn){const[Zn,Xn]=wt[$n],Un=r.M(Xn),bi=r.M(typeof Zn=="string"?[Zn,["accumulated"],["get",$n]]:Zn);Rt[$n]=Un.value,Tt[$n]=bi.value}return lt.map=$n=>{xn.properties=$n;const Zn={};for(const Xn of wn)Zn[Xn]=Rt[Xn].evaluate(Zt,xn);return Zn},lt.reduce=($n,Zn)=>{xn.properties=Zn;for(const Xn of wn)Zt.accumulated=$n[Xn],$n[Xn]=Tt[Xn].evaluate(Zt,xn)},lt}(ye)).load(at.features):ye.dynamic?this._dynamicIndex:function(lt,wt){return new vs(lt,wt)}(at,ye.geojsonVtOptions)}catch(lt){return Te(lt)}const xt={};if(Ze){const lt=D(Ve);lt&&(xt.resourceTiming={},xt.resourceTiming[ye.source]=JSON.parse(JSON.stringify(lt)))}Te(null,xt)}})}reloadTile(ye,Te){const Ve=this.loaded;return Ve&&Ve[ye.uid]?ye.partial?Te(null,void 0):super.reloadTile(ye,Te):this.loadTile(ye,Te)}loadGeoJSON(ye,Te){if(ye.request)r.n(ye.request,Te);else{if(typeof ye.data!="string")return Te(new Error(`Input data given to '${ye.source}' is not a valid GeoJSON object.`));try{return Te(null,JSON.parse(ye.data))}catch{return Te(new Error(`Input data given to '${ye.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ye,Te){try{Te(null,this._geoJSONIndex.getClusterExpansionZoom(ye.clusterId))}catch(Ve){Te(Ve)}}getClusterChildren(ye,Te){try{Te(null,this._geoJSONIndex.getChildren(ye.clusterId))}catch(Ve){Te(Ve)}}getClusterLeaves(ye,Te){try{Te(null,this._geoJSONIndex.getLeaves(ye.clusterId,ye.limit,ye.offset))}catch(Ve){Te(Ve)}}}class ys{constructor(ye,Te){this.tileID=new r.aA(ye.tileID.overscaledZ,ye.tileID.wrap,ye.tileID.canonical.z,ye.tileID.canonical.x,ye.tileID.canonical.y),this.tileZoom=ye.tileZoom,this.uid=ye.uid,this.zoom=ye.zoom,this.canonical=ye.tileID.canonical,this.pixelRatio=ye.pixelRatio,this.tileSize=ye.tileSize,this.source=ye.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ye.projection,this.brightness=Te}parse(ye,Te,Ve,Ze){this.status="parsing";const Ge=new r.aA(Ve.tileID.overscaledZ,Ve.tileID.wrap,Ve.tileID.canonical.z,Ve.tileID.canonical.x,Ve.tileID.canonical.y),at={},xt=Te.familiesBySource[Ve.source],lt=new r.dR(Ge,Ve.promoteId);return lt.bucketLayerIDs=[],lt.is3DTile=!0,r.e0(ye).then(wt=>{if(!wt)return Ze(new Error("Could not parse tile"));const Rt=r.e1(wt,1/r.c8(Ve.tileID.canonical)),Tt=wt.json.extensionsUsed&&wt.json.extensionsUsed.includes("MAPBOX_mesh_features")||wt.json.asset.extras&&wt.json.asset.extras.MAPBOX_mesh_features,Zt=wt.json.extensionsUsed&&wt.json.extensionsUsed.includes("EXT_meshopt_compression"),xn=new r.a3(this.zoom,{brightness:this.brightness});for(const wn in xt)for(const $n of xt[wn]){const Zn=$n[0];lt.bucketLayerIDs.push($n.map(Un=>Un.id)),Zn.recalculate(xn,[]);const Xn=new r.e2(Rt,Ge,Tt,Zt,this.brightness,lt);Tt||(Xn.needsUpload=!0),at[Zn.fqid]=Xn,Xn.evaluate(Zn)}this.status="done",Ze(null,{buckets:at,featureIndex:lt})}).catch(wt=>Ze(new Error(wt.message)))}}class Qs{constructor(ye,Te,Ve,Ze,Ge,at){this.actor=ye,this.layerIndex=Te,this.brightness=at,this.loading={},this.loaded={}}loadTile(ye,Te){const Ve=ye.uid,Ze=this.loading[Ve]=new ys(ye,this.brightness);r.bc(ye.request,(Ge,at)=>{const xt=!this.loading[Ve];return delete this.loading[Ve],xt||Ge?(Ze.status="done",xt||(this.loaded[Ve]=Ze),Te(Ge)):at&&at.byteLength!==0?void Ze.parse(at,this.layerIndex,ye,(lt,wt)=>{Ze.status="done",this.loaded=this.loaded||{},this.loaded[Ve]=Ze,lt||!wt?Te(lt):Te(null,wt)}):(Ze.status="done",this.loaded[Ve]=Ze,Te())})}reloadTile(ye,Te){const Ve=this.loaded,Ze=ye.uid;if(Ve&&Ve[Ze]){const Ge=Ve[Ze];Ge.projection=ye.projection,Ge.brightness=ye.brightness;const at=(xt,lt)=>{Ge.reloadCallback&&(delete Ge.reloadCallback,this.loadTile(ye,Te)),Te(xt,lt)};Ge.status==="parsing"?Ge.reloadCallback=at:Ge.status==="done"&&this.loadTile(ye,Te)}}abortTile(ye,Te){const Ve=ye.uid;this.loading[Ve]&&delete this.loading[Ve],Te()}removeTile(ye,Te){const Ve=this.loaded,Ze=ye.uid;Ve&&Ve[Ze]&&delete Ve[Ze],Te()}}class bs{constructor(ye){this.self=ye,this.actor=new r.e3(ye,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=r.bL({name:"mercator"}),this.workerSourceTypes={vector:ce,geojson:es,"batched-model":Qs},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Te,Ve)=>{if(this.workerSourceTypes[Te])throw new Error(`Worker source with name "${Te}" already registered.`);this.workerSourceTypes[Te]=Ve},this.self.registerRTLTextPlugin=Te=>{if(r.e4.isParsed())throw new Error("RTL text plugin already registered.");r.e4.applyArabicShaping=Te.applyArabicShaping,r.e4.processBidirectionalText=Te.processBidirectionalText,r.e4.processStyledBidirectionalText=Te.processStyledBidirectionalText}}clearCaches(ye,Te,Ve){delete this.layerIndexes[ye],delete this.availableImages[ye],delete this.workerSources[ye],delete this.demWorkerSources[ye],delete this.rasterArrayWorkerSource,Ve()}checkIfReady(ye,Te,Ve){Ve()}setReferrer(ye,Te){this.referrer=Te}spriteLoaded(ye,{scope:Te,isLoaded:Ve}){if(this.isSpriteLoaded[ye]||(this.isSpriteLoaded[ye]={}),this.isSpriteLoaded[ye][Te]=Ve,this.workerSources[ye]&&this.workerSources[ye][Te])for(const Ze in this.workerSources[ye][Te]){const Ge=this.workerSources[ye][Te][Ze];for(const at in Ge){const xt=Ge[at];xt instanceof ce&&(xt.isSpriteLoaded=Ve,xt.fire(new r.x("isSpriteLoaded")))}}}setImages(ye,{scope:Te,images:Ve},Ze){if(this.availableImages[ye]||(this.availableImages[ye]={}),this.availableImages[ye][Te]=Ve,this.workerSources[ye]&&this.workerSources[ye][Te]){for(const Ge in this.workerSources[ye][Te]){const at=this.workerSources[ye][Te][Ge];for(const xt in at)at[xt].availableImages=Ve}Ze()}else Ze()}setProjection(ye,Te){this.projections[ye]=r.bL(Te)}setBrightness(ye,Te,Ve){this.brightness=Te,Ve()}setLayers(ye,Te,Ve){this.getLayerIndex(ye,Te.scope).replace(Te.layers,Te.options),Ve()}updateLayers(ye,Te,Ve){this.getLayerIndex(ye,Te.scope).update(Te.layers,Te.removedIds,Te.options),Ve()}loadTile(ye,Te,Ve){Te.projection=this.projections[ye]||this.defaultProjection,this.getWorkerSource(ye,Te.type,Te.source,Te.scope).loadTile(Te,Ve)}loadDEMTile(ye,Te,Ve){this.getDEMWorkerSource(ye,Te.source,Te.scope).loadTile(Te,Ve)}decodeRasterArray(ye,Te,Ve){this.getRasterArrayWorkerSource().decodeRasterArray(Te,Ve)}reloadTile(ye,Te,Ve){Te.projection=this.projections[ye]||this.defaultProjection,this.getWorkerSource(ye,Te.type,Te.source,Te.scope).reloadTile(Te,Ve)}abortTile(ye,Te,Ve){this.getWorkerSource(ye,Te.type,Te.source,Te.scope).abortTile(Te,Ve)}removeTile(ye,Te,Ve){this.getWorkerSource(ye,Te.type,Te.source,Te.scope).removeTile(Te,Ve)}removeSource(ye,Te,Ve){if(!(this.workerSources[ye]&&this.workerSources[ye][Te.scope]&&this.workerSources[ye][Te.scope][Te.type]&&this.workerSources[ye][Te.scope][Te.type][Te.source]))return;const Ze=this.workerSources[ye][Te.scope][Te.type][Te.source];delete this.workerSources[ye][Te.scope][Te.type][Te.source],Ze.removeSource!==void 0?Ze.removeSource(Te,Ve):Ve()}loadWorkerSource(ye,Te,Ve){try{this.self.importScripts(Te.url),Ve()}catch(Ze){Ve(Ze.toString())}}syncRTLPluginState(ye,Te,Ve){try{r.e4.setState(Te);const Ze=r.e4.getPluginURL();if(r.e4.isLoaded()&&!r.e4.isParsed()&&Ze!=null){this.self.importScripts(Ze);const Ge=r.e4.isParsed();Ve(Ge?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Ze}`),Ge)}}catch(Ze){Ve(Ze.toString())}}setDracoUrl(ye,Te){this.dracoUrl=Te}getAvailableImages(ye,Te){this.availableImages[ye]||(this.availableImages[ye]={});let Ve=this.availableImages[ye][Te];return Ve||(Ve=[]),Ve}getLayerIndex(ye,Te){this.layerIndexes[ye]||(this.layerIndexes[ye]={});let Ve=this.layerIndexes[ye][Te];return Ve||(Ve=this.layerIndexes[ye][Te]=new U,Ve.scope=Te),Ve}getWorkerSource(ye,Te,Ve,Ze){return this.workerSources[ye]||(this.workerSources[ye]={}),this.workerSources[ye][Ze]||(this.workerSources[ye][Ze]={}),this.workerSources[ye][Ze][Te]||(this.workerSources[ye][Ze][Te]={}),this.isSpriteLoaded[ye]||(this.isSpriteLoaded[ye]={}),this.workerSources[ye][Ze][Te][Ve]||(this.workerSources[ye][Ze][Te][Ve]=new this.workerSourceTypes[Te]({send:(Ge,at,xt,lt,wt,Rt)=>{this.actor.send(Ge,at,xt,ye,wt,Rt)},scheduler:this.actor.scheduler},this.getLayerIndex(ye,Ze),this.getAvailableImages(ye,Ze),this.isSpriteLoaded[ye][Ze],void 0,this.brightness)),this.workerSources[ye][Ze][Te][Ve]}getDEMWorkerSource(ye,Te,Ve){return this.demWorkerSources[ye]||(this.demWorkerSources[ye]={}),this.demWorkerSources[ye][Ve]||(this.demWorkerSources[ye][Ve]={}),this.demWorkerSources[ye][Ve][Te]||(this.demWorkerSources[ye][Ve][Te]=new oe),this.demWorkerSources[ye][Ve][Te]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new fe),this.rasterArrayWorkerSource}enforceCacheSizeLimit(ye,Te){r.e5(Te)}getWorkerPerformanceMetrics(ye,Te,Ve){Ve(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new bs(self)),bs}),y(["./shared"],function(r){var D="3.7.0";const L={create:"create",load:"load",fullLoad:"fullLoad"},B={mark(p){performance.mark(p)},measure(p,i,a){performance.measure(p,i,a)}};function U(p){const i=p.name.split("?")[0];return r.a(i)&&i.includes("mapbox-gl.js")?"javascript":r.a(i)&&i.includes("mapbox-gl.css")?"css":r.b(i)?"fontRange":r.c(i)?"sprite":r.i(i)?"style":r.d(i)?"tilejson":"other"}var $,W={},q=function(){if($)return W;function p(m){return!i(m)}function i(m){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var w,E,R=new Blob([""],{type:"text/javascript"}),z=URL.createObjectURL(R);try{E=new Worker(z),w=!0}catch{w=!1}return E&&E.terminate(),URL.revokeObjectURL(z),w}()?function(){var w=document.createElement("canvas");w.width=w.height=1;var E=w.getContext("2d");if(!E)return!1;var R=E.getImageData(0,0,1,1);return R&&R.width===w.width}()?(a[b=m&&m.failIfMajorPerformanceCaveat]===void 0&&(a[b]=function(w){var E,R=function(z){var N=document.createElement("canvas"),j=Object.create(p.webGLContextAttributes);return j.failIfMajorPerformanceCaveat=z,N.getContext("webgl2",j)}(w);if(!R)return!1;try{E=R.createShader(R.VERTEX_SHADER)}catch{return!1}return!(!E||R.isContextLost())&&(R.shaderSource(E,"void main() {}"),R.compileShader(E),R.getShaderParameter(E,R.COMPILE_STATUS)===!0)}(b)),a[b]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var b}$=1,W.supported=p,W.notSupportedReason=i;var a={};return p.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},W}();function ne(p,i,a){const m=document.createElement(p);return i!=null&&(m.className=i),a&&a.appendChild(m),m}function ce(p,i,a){const m=document.createElementNS("http://www.w3.org/2000/svg",p);for(const b of Object.keys(i))m.setAttributeNS(null,b,String(i[b]));return a&&a.appendChild(m),m}const oe=typeof document<"u"?document.documentElement&&document.documentElement.style:null,fe=oe&&oe.userSelect!==void 0?"userSelect":"WebkitUserSelect";let be;function ge(){oe&&fe&&(be=oe[fe],oe[fe]="none")}function Ee(){oe&&fe&&(oe[fe]=be)}function de(p){p.preventDefault(),p.stopPropagation(),window.removeEventListener("click",de,!0)}function re(){window.addEventListener("click",de,!0),window.setTimeout(()=>{window.removeEventListener("click",de,!0)},0)}function Y(p,i){const a=p.getBoundingClientRect();return ae(p,a,i)}function ie(p,i){const a=p.getBoundingClientRect(),m=[];for(let b=0;b<i.length;b++)m.push(ae(p,a,i[b]));return m}function te(p){return window.InstallTrigger!==void 0&&p.button===2&&p.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:p.button}function ae(p,i,a){const m=p.offsetWidth===i.width?1:p.offsetWidth/i.width;return new r.P((a.clientX-i.left)*m,(a.clientY-i.top)*m)}const pe="01",Le="NO_ACCESS_TOKEN";class tt{constructor(i,a,m){this._transformRequestFn=i,this._customAccessToken=a,this._silenceAuthErrors=!!m,this._createSkuToken()}_createSkuToken(){const i=function(){let a="";for(let m=0;m<10;m++)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",pe,a].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,a){return this._transformRequestFn&&this._transformRequestFn(i,a)||{url:i}}normalizeStyleURL(i,a){if(!r.f(i))return i;const m=Mt(i);return m.params.push(`sdk=js-${D}`),m.path=`/styles/v1${m.path}`,this._makeAPIURL(m,this._customAccessToken||a)}normalizeGlyphsURL(i,a){if(!r.f(i))return i;const m=Mt(i);return m.path=`/fonts/v1${m.path}`,this._makeAPIURL(m,this._customAccessToken||a)}normalizeModelURL(i,a){if(!r.f(i))return i;const m=Mt(i);return m.path=`/models/v1${m.path}`,this._makeAPIURL(m,this._customAccessToken||a)}normalizeSourceURL(i,a,m,b){if(!r.f(i))return i;const w=Mt(i);return w.path=`/v4/${w.authority}.json`,w.params.push("secure"),m&&w.params.push(`language=${m}`),b&&w.params.push(`worldview=${b}`),this._makeAPIURL(w,this._customAccessToken||a)}normalizeSpriteURL(i,a,m,b){const w=Mt(i);return r.f(i)?(w.path=`/styles/v1${w.path}/sprite${a}${m}`,this._makeAPIURL(w,this._customAccessToken||b)):(w.path+=`${a}${m}`,Lt(w))}normalizeTileURL(i,a,m){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!r.f(i))return i;const b=Mt(i);b.path=b.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${a||m&&b.authority!=="raster"&&m===512?"@2x":""}${r.m.supported?".webp":"$1"}`),b.authority==="raster"?b.path=`/${r.e.RASTER_URL_PREFIX}${b.path}`:b.authority==="rasterarrays"?b.path=`/${r.e.RASTERARRAYS_URL_PREFIX}${b.path}`:b.authority==="3dtiles"?b.path=`/${r.e.TILES3D_URL_PREFIX}${b.path}`:(b.path=b.path.replace(/^.+\/v4\//,"/"),b.path=`/${r.e.TILE_URL_VERSION}${b.path}`);const w=this._customAccessToken||function(E){for(const R of E){const z=R.match(/^access_token=(.*)$/);if(z)return z[1]}return null}(b.params)||r.e.ACCESS_TOKEN;return r.e.REQUIRE_ACCESS_TOKEN&&w&&this._skuToken&&b.params.push(`sku=${this._skuToken}`),this._makeAPIURL(b,w)}canonicalizeTileURL(i,a){const m=Mt(i);if(!m.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!m.path.match(/\.[\w]+$/))return i;let b="mapbox://";m.path.match(/^\/raster\/v1\//)?b+=`raster/${m.path.replace(`/${r.e.RASTER_URL_PREFIX}/`,"")}`:m.path.match(/^\/rasterarrays\/v1\//)?b+=`rasterarrays/${m.path.replace(`/${r.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:b+=`tiles/${m.path.replace(`/${r.e.TILE_URL_VERSION}/`,"")}`;let w=m.params;return a&&(w=w.filter(E=>!E.match(/^access_token=/))),w.length&&(b+=`?${w.join("&")}`),b}canonicalizeTileset(i,a){const m=!!a&&r.f(a),b=[];for(const w of i.tiles||[])r.h(w)?b.push(this.canonicalizeTileURL(w,m)):b.push(w);return b}_makeAPIURL(i,a){const m="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",b=Mt(r.e.API_URL);if(i.protocol=b.protocol,i.authority=b.authority,i.protocol==="http"){const w=i.params.indexOf("secure");w>=0&&i.params.splice(w,1)}if(b.path!=="/"&&(i.path=`${b.path}${i.path}`),!r.e.REQUIRE_ACCESS_TOKEN)return Lt(i);if(a=a||r.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!a)throw new Error(`An API access token is required to use Mapbox GL. ${m}`);if(a[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${m}`)}return i.params=i.params.filter(w=>w.indexOf("access_token")===-1),i.params.push(`access_token=${a||""}`),Lt(i)}}const Je=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Mt(p){const i=p.match(Je);if(!i)throw new Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function Lt(p){const i=p.params.length?`?${p.params.join("&")}`:"";return`${p.protocol}://${p.authority}${p.path}${i}`}const yt="mapbox.eventData";function rt(p){if(!p)return null;const i=p.split(".");if(!i||i.length!==3)return null;try{return JSON.parse(r.j(i[1]))}catch{return null}}class mt{constructor(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){const a=rt(r.e.ACCESS_TOKEN);let m="";return m=a&&a.u?r.k(a.u):r.e.ACCESS_TOKEN||"",i?`${yt}.${i}:${m}`:`${yt}:${m}`}fetchEventData(){const i=r.s("localStorage"),a=this.getStorageKey(),m=this.getStorageKey("uuid");if(i)try{const b=localStorage.getItem(a);b&&(this.eventData=JSON.parse(b));const w=localStorage.getItem(m);w&&(this.anonId=w)}catch{r.w("Unable to read from LocalStorage")}}saveEventData(){const i=r.s("localStorage"),a=this.getStorageKey(),m=this.getStorageKey("uuid"),b=this.anonId;if(i&&b)try{localStorage.setItem(m,b),Object.keys(this.eventData).length>=1&&localStorage.setItem(a,JSON.stringify(this.eventData))}catch{r.w("Unable to write to LocalStorage")}}processRequests(i){}postEvent(i,a,m,b){if(!r.e.EVENTS_URL)return;const w=Mt(r.e.EVENTS_URL);w.params.push(`access_token=${b||r.e.ACCESS_TOKEN||""}`);const E={event:this.type,created:new Date(i).toISOString()},R=a?r.l(E,a):E,z={url:Lt(w),headers:{"Content-Type":"text/plain"},body:JSON.stringify([R])};this.pendingRequest=r.p(z,N=>{this.pendingRequest=null,m(N),this.saveEventData(),this.processRequests(b)})}queueRequest(i,a){this.queue.push(i),this.processRequests(a)}}const Ft=new class extends mt{constructor(p){super("appUserTurnstile"),this._customAccessToken=p}postTurnstileEvent(p,i){r.e.EVENTS_URL&&r.e.ACCESS_TOKEN&&Array.isArray(p)&&p.some(a=>r.f(a)||r.h(a))&&this.queueRequest(Date.now(),i)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=rt(r.e.ACCESS_TOKEN),a=i?i.u:r.e.ACCESS_TOKEN;let m=a!==this.eventData.tokenU;r.v(this.anonId)||(this.anonId=r.u(),m=!0);const b=this.queue.shift();if(this.eventData.lastSuccess){const w=new Date(this.eventData.lastSuccess),E=new Date(b),R=(b-this.eventData.lastSuccess)/864e5;m=m||R>=1||R<-1||w.getDate()!==E.getDate()}else m=!0;m?this.postEvent(b,{sdkIdentifier:"mapbox-gl-js",sdkVersion:D,skuId:pe,"enabled.telemetry":!1,userId:this.anonId},w=>{w||(this.eventData.lastSuccess=b,this.eventData.tokenU=a)},p):this.processRequests()}},bn=Ft.postTurnstileEvent.bind(Ft),Bt=new class extends mt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(p,i,a,m){this.skuToken=i,this.errorCb=m,r.e.EVENTS_URL&&(a||r.e.ACCESS_TOKEN?this.queueRequest({id:p,timestamp:Date.now()},a):this.errorCb(new Error(Le)))}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:a}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),r.v(this.anonId)||(this.anonId=r.u()),this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:D,skuId:pe,skuToken:this.skuToken,userId:this.anonId},m=>{m?this.errorCb(m):i&&(this.success[i]=!0)},p))}remove(){this.errorCb=null}},ht=Bt.postMapLoadEvent.bind(Bt),gt=new class extends mt{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(p){let i=this.mapInstanceIdMap.get(p);return i||(i=r.u(),this.mapInstanceIdMap.set(p,i)),i}getEventId(p){const i=this.eventIdPerMapInstanceMap.get(p)||0;return this.eventIdPerMapInstanceMap.set(p,i+1),i}postStyleLoadEvent(p,i){const{map:a,style:m,importedStyles:b}=i;if(!r.e.EVENTS_URL||!p&&!r.e.ACCESS_TOKEN)return;const w=this.getMapInstanceId(a),E={mapInstanceId:w,eventId:this.getEventId(w),style:m};b.length&&(E.importedStyles=b),this.queueRequest({timestamp:Date.now(),payload:E},p)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:i,payload:a}=this.queue.shift();this.postEvent(i,a,()=>{},p)}},et=gt.postStyleLoadEvent.bind(gt),Nt=new class extends mt{constructor(){super("gljs.performance")}postPerformanceEvent(p,i){r.e.EVENTS_URL&&(p||r.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:i},p)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:i,performanceData:a}=this.queue.shift(),m=function(b){const w=performance.getEntriesByType("resource"),E=performance.getEntriesByType("mark"),R=function(Q){const he={};if(Q){for(const me in Q)if(me!=="other")for(const _e of Q[me]){const ve=`${me}ResolveRangeMin`,ke=`${me}ResolveRangeMax`,De=`${me}RequestCount`,Pe=`${me}RequestCachedCount`;he[ve]=Math.min(he[ve]||1/0,_e.startTime),he[ke]=Math.max(he[ke]||-1/0,_e.responseEnd);const Fe=ze=>{he[ze]===void 0&&(he[ze]=0),++he[ze]};_e.transferSize!==void 0&&_e.transferSize===0&&Fe(Pe),Fe(De)}}return he}(function(Q,he){const me={};if(Q)for(const _e of Q){const ve=he(_e);me[ve]===void 0&&(me[ve]=[]),me[ve].push(_e)}return me}(w,U)),z=window.devicePixelRatio,N=navigator.connection||navigator.mozConnection||navigator.webkitConnection,j=N?N.effectiveType:void 0,X={counters:[],metadata:[],attributes:[]},K=(Q,he,me)=>{me!=null&&Q.push({name:he,value:me.toString()})};for(const Q in R)K(X.counters,Q,R[Q]);if(b.interactionRange[0]!==1/0&&b.interactionRange[1]!==-1/0&&(K(X.counters,"interactionRangeMin",b.interactionRange[0]),K(X.counters,"interactionRangeMax",b.interactionRange[1])),E)for(const Q of Object.keys(L)){const he=L[Q],me=E.find(_e=>_e.name===he);me&&K(X.counters,he,me.startTime)}return K(X.counters,"visibilityHidden",b.visibilityHidden),K(X.attributes,"style",function(Q){if(Q)for(const he of Q){const me=he.name.split("?")[0];if(r.i(me)){const _e=me.split("/").slice(-2);if(_e.length===2)return`mapbox://styles/${_e[0]}/${_e[1]}`}}}(w)),K(X.attributes,"terrainEnabled",b.terrainEnabled?"true":"false"),K(X.attributes,"fogEnabled",b.fogEnabled?"true":"false"),K(X.attributes,"projection",b.projection),K(X.attributes,"zoom",b.zoom),K(X.metadata,"devicePixelRatio",z),K(X.metadata,"connectionEffectiveType",j),K(X.metadata,"navigatorUserAgent",navigator.userAgent),K(X.metadata,"screenWidth",window.screen.width),K(X.metadata,"screenHeight",window.screen.height),K(X.metadata,"windowWidth",window.innerWidth),K(X.metadata,"windowHeight",window.innerHeight),K(X.metadata,"mapWidth",b.width/z),K(X.metadata,"mapHeight",b.height/z),K(X.metadata,"webglRenderer",b.renderer),K(X.metadata,"webglVendor",b.vendor),K(X.metadata,"sdkVersion",D),K(X.metadata,"sdkIdentifier","mapbox-gl-js"),X}(a);for(const b of m.metadata);for(const b of m.counters);for(const b of m.attributes);this.postEvent(i,m,()=>{},p)}},St=Nt.postPerformanceEvent.bind(Nt),Xt=new class extends mt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(p,i,a,m){if(!r.e.API_URL||!r.e.SESSION_PATH)return;const b=Mt(r.e.API_URL+r.e.SESSION_PATH);b.params.push(`sku=${i||""}`),b.params.push(`access_token=${m||r.e.ACCESS_TOKEN||""}`);const w={url:Lt(b),headers:{"Content-Type":"text/plain"}};this.pendingRequest=r.g(w,E=>{this.pendingRequest=null,a(E),this.saveEventData(),this.processRequests(m)})}getSessionAPI(p,i,a,m){this.skuToken=i,this.errorCb=m,r.e.SESSION_PATH&&r.e.API_URL&&(a||r.e.ACCESS_TOKEN?this.queueRequest({id:p,timestamp:Date.now()},a):this.errorCb(new Error(Le)))}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:a}=this.queue.shift();i&&this.success[i]||this.getSession(a,this.skuToken,m=>{m?this.errorCb(m):i&&(this.success[i]=!0)},p)}remove(){this.errorCb=null}},Ie=Xt.getSessionAPI.bind(Xt),gn=new Set;function Ae(p,i){i?gn.add(p):gn.delete(p)}class Ne{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(i,a){this._updatedSourceCaches[i]=a,this.setDirty()}discardSourceCacheUpdate(i){delete this._updatedSourceCaches[i]}updateLayer(i){const a=i.scope;this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._updatedLayers[a].add(i.id),this.setDirty()}removeLayer(i){const a=i.scope;this._removedLayers[a]=this._removedLayers[a]||{},this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._removedLayers[a][i.id]=i,this._updatedLayers[a].delete(i.id),this._updatedPaintProps.delete(i.fqid),this.setDirty()}getRemovedLayer(i){return this._removedLayers[i.scope]?this._removedLayers[i.scope][i.id]:null}discardLayerRemoval(i){this._removedLayers[i.scope]&&delete this._removedLayers[i.scope][i.id]}getLayerUpdatesByScope(){const i={};for(const a in this._updatedLayers)i[a]=i[a]||{},i[a].updatedIds=Array.from(this._updatedLayers[a].values());for(const a in this._removedLayers)i[a]=i[a]||{},i[a].removedIds=Object.keys(this._removedLayers[a]);return i}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(i){this._updatedPaintProps.add(i.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(i){this._updatedImages.add(i),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function Ue(p){const{userImage:i}=p;return!!(i&&i.render&&i.render())&&(p.data.replace(new Uint8Array(i.data.buffer)),!0)}class Et extends r.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(i){this.images[i]={},this.loaded[i]=!1,this.updatedImages[i]={},this.patterns[i]={},this.callbackDispatchedThisFrame[i]={},this.atlasImage[i]=new r.r({width:1,height:1})}isLoaded(){for(const i in this.loaded)if(!this.loaded[i])return!1;return!0}setLoaded(i,a){if(this.loaded[a]!==i&&(this.loaded[a]=i,i)){for(const{ids:m,callback:b}of this.requestors)this._notify(m,a,b);this.requestors=[]}}hasImage(i,a){return!!this.getImage(i,a)}getImage(i,a){return this.images[a][i]}addImage(i,a,m){this._validate(i,m)&&(this.images[a][i]=m)}_validate(i,a){let m=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new r.t(new Error(`Image "${i}" has invalid "stretchX" value`))),m=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new r.t(new Error(`Image "${i}" has invalid "stretchY" value`))),m=!1),this._validateContent(a.content,a)||(this.fire(new r.t(new Error(`Image "${i}" has invalid "content" value`))),m=!1),m}_validateStretch(i,a){if(!i)return!0;let m=0;for(const b of i){if(b[0]<m||b[1]<b[0]||a<b[1])return!1;m=b[1]}return!0}_validateContent(i,a){return!(i&&(i.length!==4||i[0]<0||a.data.width<i[0]||i[1]<0||a.data.height<i[1]||i[2]<0||a.data.width<i[2]||i[3]<0||a.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,a,m){m.version=this.images[a][i].version+1,this.images[a][i]=m,this.updatedImages[a][i]=!0}removeImage(i,a){const m=this.images[a][i];delete this.images[a][i],delete this.patterns[a][i],m.userImage&&m.userImage.onRemove&&m.userImage.onRemove()}listImages(i){return Object.keys(this.images[i])}getImages(i,a,m){let b=!0;const w=!!this.loaded[a];if(!w)for(const E of i)this.images[a][E]||(b=!1);w||b?this._notify(i,a,m):this.requestors.push({ids:i,scope:a,callback:m})}getUpdatedImages(i){return this.updatedImages[i]}_notify(i,a,m){const b={};for(const w of i){this.images[a][w]||this.fire(new r.x("styleimagemissing",{id:w}));const E=this.images[a][w];E?b[w]={data:E.data.clone(),pixelRatio:E.pixelRatio,sdf:E.sdf,version:E.version,stretchX:E.stretchX,stretchY:E.stretchY,content:E.content,hasRenderCallback:!!(E.userImage&&E.userImage.render)}:r.w(`Image "${w}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}m(null,b)}getPixelSize(i){const{width:a,height:m}=this.atlasImage[i];return{width:a,height:m}}getPattern(i,a,m){const b=this.patterns[a][i],w=this.getImage(i,a);if(!w)return null;if(b&&b.position.version===w.version)return b.position;if(b)b.position.version=w.version;else{const E={w:w.data.width+2*r.y,h:w.data.height+2*r.y,x:0,y:0},R=new r.I(E,w,r.y);this.patterns[a][i]={bin:E,position:R}}return this._updatePatternAtlas(a,m),this.patterns[a][i].position}bind(i,a){const m=i.gl;let b=this.atlasTexture[a];b?this.dirty&&(b.update(this.atlasImage[a]),this.dirty=!1):(b=new r.T(i,this.atlasImage[a],m.RGBA8),this.atlasTexture[a]=b),b.bind(m.LINEAR,m.CLAMP_TO_EDGE)}_updatePatternAtlas(i,a){const m=[];for(const R in this.patterns[i])m.push(this.patterns[i][R].bin);const{w:b,h:w}=r.z(m),E=this.atlasImage[i];E.resize({width:b||1,height:w||1});for(const R in this.patterns[i]){const{bin:z,position:N}=this.patterns[i][R];let j=N.padding;const X=z.x+j,K=z.y+j,Q=this.images[i][R].data,he=Q.width,me=Q.height;j=j>1?j-1:j,r.r.copy(Q,E,{x:0,y:0},{x:X,y:K},{width:he,height:me},a),r.r.copy(Q,E,{x:0,y:me-j},{x:X,y:K-j},{width:he,height:j},a),r.r.copy(Q,E,{x:0,y:0},{x:X,y:K+me},{width:he,height:j},a),r.r.copy(Q,E,{x:he-j,y:0},{x:X-j,y:K},{width:j,height:me},a),r.r.copy(Q,E,{x:0,y:0},{x:X+he,y:K},{width:j,height:me},a),r.r.copy(Q,E,{x:he-j,y:me-j},{x:X-j,y:K-j},{width:j,height:j},a),r.r.copy(Q,E,{x:0,y:me-j},{x:X+he,y:K-j},{width:j,height:j},a),r.r.copy(Q,E,{x:0,y:0},{x:X+he,y:K+me},{width:j,height:j},a),r.r.copy(Q,E,{x:he-j,y:0},{x:X-j,y:K+me},{width:j,height:j},a)}this.dirty=!0}beginFrame(){for(const i in this.images)this.callbackDispatchedThisFrame[i]={}}dispatchRenderCallbacks(i,a){for(const m of i){if(this.callbackDispatchedThisFrame[a][m])continue;this.callbackDispatchedThisFrame[a][m]=!0;const b=this.images[a][m];Ue(b)&&this.updateImage(m,a,b)}}}function Ct(p){const i=p.key,a=p.value,m=p.valueSpec||{},b=p.objectElementValidators||{},w=p.style,E=p.styleSpec;let R=[];const z=r.B(a);if(z!=="object")return[new r.V(i,a,`object expected, ${z} found`)];for(const N in a){const j=N.split(".")[0];let X;b[j]?X=b[j]:m[j]?X=ii:b["*"]?X=b["*"]:m["*"]&&(X=ii),X?R=R.concat(X({key:(i&&`${i}.`)+N,value:a[N],valueSpec:m[j]||m["*"],style:w,styleSpec:E,object:a,objectKey:N},a)):R.push(new r.A(i,a[N],`unknown property "${N}"`))}for(const N in m)b[N]||m[N].required&&m[N].default===void 0&&a[N]===void 0&&R.push(new r.V(i,a,`missing required property "${N}"`));return R}function Qt(p){const i=p.value,a=p.valueSpec,m=p.style,b=p.styleSpec,w=p.key,E=p.arrayElementValidator||ii;if(r.B(i)!=="array")return[new r.V(w,i,`array expected, ${r.B(i)} found`)];if(a.length&&i.length!==a.length)return[new r.V(w,i,`array length ${a.length} expected, length ${i.length} found`)];if(a["min-length"]&&i.length<a["min-length"])return[new r.V(w,i,`array length at least ${a["min-length"]} expected, length ${i.length} found`)];let R={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};b.$version<7&&(R.function=a.function),r.B(a.value)==="object"&&(R=a.value);let z=[];for(let N=0;N<i.length;N++)z=z.concat(E({array:i,arrayIndex:N,value:i[N],valueSpec:R,style:m,styleSpec:b,key:`${w}[${N}]`},!0));return z}function Gt(p){const i=p.key,a=p.value,m=p.valueSpec;let b=r.B(a);if(b==="number"&&a!=a&&(b="NaN"),b!=="number")return[new r.V(i,a,`number expected, ${b} found`)];if("minimum"in m){let w=m.minimum;if(r.B(m.minimum)==="array"&&(w=m.minimum[p.arrayIndex]),a<w)return[new r.V(i,a,`${a} is less than the minimum value ${w}`)]}if("maximum"in m){let w=m.maximum;if(r.B(m.maximum)==="array"&&(w=m.maximum[p.arrayIndex]),a>w)return[new r.V(i,a,`${a} is greater than the maximum value ${w}`)]}return[]}function Yt(p){const i=p.valueSpec,a=r.D(p.value.type);let m,b,w,E={};const R=a!=="categorical"&&p.value.property===void 0,z=!R,N=r.B(p.value.stops)==="array"&&r.B(p.value.stops[0])==="array"&&r.B(p.value.stops[0][0])==="object",j=Ct({key:p.key,value:p.value,valueSpec:p.styleSpec.function,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{stops:function(Q){if(a==="identity")return[new r.V(Q.key,Q.value,'identity function may not have a "stops" property')];let he=[];const me=Q.value;return he=he.concat(Qt({key:Q.key,value:me,valueSpec:Q.valueSpec,style:Q.style,styleSpec:Q.styleSpec,arrayElementValidator:X})),r.B(me)==="array"&&me.length===0&&he.push(new r.V(Q.key,me,"array must have at least one stop")),he},default:function(Q){return ii({key:Q.key,value:Q.value,valueSpec:i,style:Q.style,styleSpec:Q.styleSpec})}}});return a==="identity"&&R&&j.push(new r.V(p.key,p.value,'missing required property "property"')),a==="identity"||p.value.stops||j.push(new r.V(p.key,p.value,'missing required property "stops"')),a==="exponential"&&p.valueSpec.expression&&!r.F(p.valueSpec)&&j.push(new r.V(p.key,p.value,"exponential functions not supported")),p.styleSpec.$version>=8&&(z&&!r.G(p.valueSpec)?j.push(new r.V(p.key,p.value,"property functions not supported")):R&&!r.H(p.valueSpec)&&j.push(new r.V(p.key,p.value,"zoom functions not supported"))),a!=="categorical"&&!N||p.value.property!==void 0||j.push(new r.V(p.key,p.value,'"property" property is required')),j;function X(Q){let he=[];const me=Q.value,_e=Q.key;if(r.B(me)!=="array")return[new r.V(_e,me,`array expected, ${r.B(me)} found`)];if(me.length!==2)return[new r.V(_e,me,`array length 2 expected, length ${me.length} found`)];if(N){if(r.B(me[0])!=="object")return[new r.V(_e,me,`object expected, ${r.B(me[0])} found`)];if(me[0].zoom===void 0)return[new r.V(_e,me,"object stop key must have zoom")];if(me[0].value===void 0)return[new r.V(_e,me,"object stop key must have value")];const ve=r.D(me[0].zoom);if(typeof ve!="number")return[new r.V(_e,me[0].zoom,"stop zoom values must be numbers")];if(w&&w>ve)return[new r.V(_e,me[0].zoom,"stop zoom values must appear in ascending order")];ve!==w&&(w=ve,b=void 0,E={}),he=he.concat(Ct({key:`${_e}[0]`,value:me[0],valueSpec:{zoom:{}},style:Q.style,styleSpec:Q.styleSpec,objectElementValidators:{zoom:Gt,value:K}}))}else he=he.concat(K({key:`${_e}[0]`,value:me[0],valueSpec:{},style:Q.style,styleSpec:Q.styleSpec},me));return r.J(r.K(me[1]))?he.concat([new r.V(`${_e}[1]`,me[1],"expressions are not allowed in function stops.")]):he.concat(ii({key:`${_e}[1]`,value:me[1],valueSpec:i,style:Q.style,styleSpec:Q.styleSpec}))}function K(Q,he){const me=r.B(Q.value),_e=r.D(Q.value),ve=Q.value!==null?Q.value:he;if(m){if(me!==m)return[new r.V(Q.key,ve,`${me} stop domain type must match previous stop domain type ${m}`)]}else m=me;if(me!=="number"&&me!=="string"&&me!=="boolean"&&typeof _e!="number"&&typeof _e!="string"&&typeof _e!="boolean")return[new r.V(Q.key,ve,"stop domain value must be a number, string, or boolean")];if(me!=="number"&&a!=="categorical"){let ke=`number expected, ${me} found`;return r.G(i)&&a===void 0&&(ke+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V(Q.key,ve,ke)]}return a!=="categorical"||me!=="number"||typeof _e=="number"&&isFinite(_e)&&Math.floor(_e)===_e?a!=="categorical"&&me==="number"&&typeof _e=="number"&&typeof b=="number"&&b!==void 0&&_e<b?[new r.V(Q.key,ve,"stop domain values must appear in ascending order")]:(b=_e,a==="categorical"&&_e in E?[new r.V(Q.key,ve,"stop domain values must be unique")]:(E[_e]=!0,[])):[new r.V(Q.key,ve,`integer expected, found ${String(_e)}`)]}}function vn(p){const i=(p.expressionContext==="property"?r.L:r.M)(r.K(p.value),p.valueSpec);if(i.result==="error")return i.value.map(m=>new r.V(`${p.key}${m.key}`,p.value,m.message));const a=i.value.expression||i.value._styleExpression.expression;if(p.expressionContext==="property"&&p.propertyKey==="text-font"&&!a.outputDefined())return[new r.V(p.key,p.value,`Invalid data expression for "${p.propertyKey}". Output values must be contained as literals within the expression.`)];if(p.expressionContext==="property"&&p.propertyType==="layout"&&!r.N(a))return[new r.V(p.key,p.value,'"feature-state" data expressions are not supported with layout properties.')];if(p.expressionContext==="filter")return dn(a,p);if(p.expressionContext&&p.expressionContext.indexOf("cluster")===0){if(!r.O(a,["zoom","feature-state"]))return[new r.V(p.key,p.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(p.expressionContext==="cluster-initial"&&!r.Q(a))return[new r.V(p.key,p.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function dn(p,i){const a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const b of i.valueSpec.expression.parameters)a.delete(b);if(a.size===0)return[];const m=[];return p instanceof r.S&&a.has(p.name)?[new r.V(i.key,i.value,`["${p.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(p.eachChild(b=>{m.push(...dn(b,i))}),m)}function Wn(p){const i=p.key,a=p.value,m=p.valueSpec,b=[];return Array.isArray(m.values)?m.values.indexOf(r.D(a))===-1&&b.push(new r.V(i,a,`expected one of [${m.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(m.values).indexOf(r.D(a))===-1&&b.push(new r.V(i,a,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(a)} found`)),b}function Rn(p){return r.W(r.K(p.value))?vn(r.C({},p,{expressionContext:"filter",valueSpec:p.styleSpec[`filter_${p.layerType||"fill"}`]})):hn(p)}function hn(p){const i=p.value,a=p.key;if(r.B(i)!=="array")return[new r.V(a,i,`array expected, ${r.B(i)} found`)];const m=p.styleSpec;let b,w=[];if(i.length<1)return[new r.V(a,i,"filter array must have at least 1 element")];switch(w=w.concat(Wn({key:`${a}[0]`,value:i[0],valueSpec:m.filter_operator,style:p.style,styleSpec:p.styleSpec})),r.D(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&r.D(i[1])==="$type"&&w.push(new r.V(a,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&w.push(new r.V(a,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(b=r.B(i[1]),b!=="string"&&w.push(new r.V(`${a}[1]`,i[1],`string expected, ${b} found`)));for(let E=2;E<i.length;E++)b=r.B(i[E]),r.D(i[1])==="$type"?w=w.concat(Wn({key:`${a}[${E}]`,value:i[E],valueSpec:m.geometry_type,style:p.style,styleSpec:p.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&w.push(new r.V(`${a}[${E}]`,i[E],`string, number, or boolean expected, ${b} found`));break;case"any":case"all":case"none":for(let E=1;E<i.length;E++)w=w.concat(hn({key:`${a}[${E}]`,value:i[E],style:p.style,styleSpec:p.styleSpec}));break;case"has":case"!has":b=r.B(i[1]),i.length!==2?w.push(new r.V(a,i,`filter array for "${i[0]}" operator must have 2 elements`)):b!=="string"&&w.push(new r.V(`${a}[1]`,i[1],`string expected, ${b} found`))}return w}function jn(p,i){const a=p.key,m=p.style,b=p.layer,w=p.styleSpec,E=p.value,R=p.objectKey,z=w[`${i}_${p.layerType}`];if(!z)return[];const N=R.match(/^(.*)-transition$/);if(i==="paint"&&N&&z[N[1]]&&z[N[1]].transition)return ii({key:a,value:E,valueSpec:w.transition,style:m,styleSpec:w});const j=p.valueSpec||z[R];if(!j)return[new r.A(a,E,`unknown property "${R}"`)];let X;if(r.B(E)==="string"&&r.G(j)&&!j.tokens&&(X=/^{([^}]+)}$/.exec(E))){const Q=`\`{ "type": "identity", "property": ${X?JSON.stringify(X[1]):'"_"'} }\``;return[new r.V(a,E,`"${R}" does not support interpolation syntax
Use an identity property function instead: ${Q}.`)]}const K=[];if(p.layerType==="symbol")R!=="text-field"||!m||m.glyphs||m.imports||K.push(new r.V(a,E,'use of "text-field" requires a style "glyphs" property')),R==="text-font"&&r.X(r.K(E))&&r.D(E.type)==="identity"&&K.push(new r.V(a,E,'"text-font" does not support identity functions'));else if(p.layerType==="model"&&i==="paint"&&b&&b.layout&&b.layout.hasOwnProperty("model-id")&&r.G(j)&&(r.Y(j)||r.H(j))){const Q=r.L(r.K(E),j),he=Q.value.expression||Q.value._styleExpression.expression;he&&!r.O(he,["measure-light"])&&(R==="model-emissive-strength"&&r.Q(he)&&r.N(he)||K.push(new r.V(a,E,`${R} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return K.concat(ii({key:p.key,value:E,valueSpec:j,style:m,styleSpec:w,expressionContext:"property",propertyType:i,propertyKey:R}))}function ti(p){return jn(p,"paint")}function ki(p){return jn(p,"layout")}function gi(p){let i=[];const a=p.value,m=p.key,b=p.style,w=p.styleSpec;a.type||a.ref||i.push(new r.V(m,a,'either "type" or "ref" is required'));let E=r.D(a.type);const R=r.D(a.ref);if(a.id){const z=r.D(a.id);for(let N=0;N<p.arrayIndex;N++){const j=b.layers[N];r.D(j.id)===z&&i.push(new r.V(m,a.id,`duplicate layer id "${a.id}", previously used at line ${j.id.__line__}`))}}if("ref"in a){let z;["type","source","source-layer","filter","layout"].forEach(N=>{N in a&&i.push(new r.V(m,a[N],`"${N}" is prohibited for ref layers`))}),b.layers.forEach(N=>{r.D(N.id)===R&&(z=N)}),z?z.ref?i.push(new r.V(m,a.ref,"ref cannot reference another ref layer")):E=r.D(z.type):typeof R=="string"&&i.push(new r.V(m,a.ref,`ref layer "${R}" not found`))}else if(E!=="background"&&E!=="sky"&&E!=="slot")if(a.source){const z=b.sources&&b.sources[a.source],N=z&&r.D(z.type);z?N==="vector"&&E==="raster"?i.push(new r.V(m,a.source,`layer "${a.id}" requires a raster source`)):N==="raster"&&E!=="raster"?i.push(new r.V(m,a.source,`layer "${a.id}" requires a vector source`)):N!=="vector"||a["source-layer"]?N==="raster-dem"&&E!=="hillshade"?i.push(new r.V(m,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):N!=="raster-array"||["raster","raster-particle"].includes(E)?E!=="line"||!a.paint||!a.paint["line-gradient"]&&!a.paint["line-trim-offset"]||N==="geojson"&&z.lineMetrics?E==="raster-particle"&&N!=="raster-array"&&i.push(new r.V(m,a.source,`layer "${a.id}" requires a 'raster-array' source.`)):i.push(new r.V(m,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new r.V(m,a.source,"raster-array source can only be used with layer type 'raster'.")):i.push(new r.V(m,a,`layer "${a.id}" must specify a "source-layer"`)):i.push(new r.V(m,a.source,`source "${a.source}" not found`))}else i.push(new r.V(m,a,'missing required property "source"'));return i=i.concat(Ct({key:m,value:a,valueSpec:w.layer,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ii({key:`${m}.type`,value:a.type,valueSpec:w.layer.type,style:p.style,styleSpec:p.styleSpec,object:a,objectKey:"type"}),filter:z=>Rn(r.C({layerType:E},z)),layout:z=>Ct({layer:a,key:z.key,value:z.value,valueSpec:{},style:z.style,styleSpec:z.styleSpec,objectElementValidators:{"*":N=>ki(r.C({layerType:E},N))}}),paint:z=>Ct({layer:a,key:z.key,value:z.value,valueSpec:{},style:z.style,styleSpec:z.styleSpec,objectElementValidators:{"*":N=>ti(r.C({layerType:E,layer:a},N))}})}})),i}function or(p){const i=p.value,a=p.key,m=r.B(i);return m!=="string"?[new r.V(a,i,`string expected, ${m} found`)]:[]}const wr={promoteId:function({key:p,value:i}){if(r.B(i)==="string")return or({key:p,value:i});{const a=[];for(const m in i)a.push(...or({key:`${p}.${m}`,value:i[m]}));return a}}};function Rr(p){const i=p.value,a=p.key,m=p.styleSpec,b=p.style;if(!i.type)return[new r.V(a,i,'"type" is required')];const w=r.D(i.type);let E=[];switch(["vector","raster","raster-dem","raster-array"].includes(w)&&(i.url||i.tiles||E.push(new r.A(a,i,'Either "url" or "tiles" is required.'))),w){case"vector":case"raster":case"raster-dem":case"raster-array":return E=E.concat(Ct({key:a,value:i,valueSpec:m[`source_${w.replace("-","_")}`],style:p.style,styleSpec:m,objectElementValidators:wr})),E;case"geojson":if(E=Ct({key:a,value:i,valueSpec:m.source_geojson,style:b,styleSpec:m,objectElementValidators:wr}),i.cluster)for(const R in i.clusterProperties){const[z,N]=i.clusterProperties[R],j=typeof z=="string"?[z,["accumulated"],["get",R]]:z;E.push(...vn({key:`${a}.${R}.map`,value:N,expressionContext:"cluster-map"})),E.push(...vn({key:`${a}.${R}.reduce`,value:j,expressionContext:"cluster-reduce"}))}return E;case"video":return Ct({key:a,value:i,valueSpec:m.source_video,style:b,styleSpec:m});case"image":return Ct({key:a,value:i,valueSpec:m.source_image,style:b,styleSpec:m});case"canvas":return[new r.V(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Wn({key:`${a}.type`,value:i.type,valueSpec:{values:zr(m)},style:b,styleSpec:m})}}function zr(p){return p.source.reduce((i,a)=>{const m=p[a];return m.type.type==="enum"&&(i=i.concat(Object.keys(m.type.values))),i},[])}function dr(p){const i=p.value,a=p.styleSpec,m=a.light,b=p.style;let w=[];const E=r.B(i);if(i===void 0)return w;if(E!=="object")return w=w.concat([new r.V("light",i,`object expected, ${E} found`)]),w;for(const R in i){const z=R.match(/^(.*)-transition$/);w=w.concat(z&&m[z[1]]&&m[z[1]].transition?ii({key:R,value:i[R],valueSpec:a.transition,style:b,styleSpec:a}):m[R]?ii({key:R,value:i[R],valueSpec:m[R],style:b,styleSpec:a}):[new r.V(R,i[R],`unknown property "${R}"`)])}return w}function Ho(p){const i=p.value;let a=[];if(!i)return a;const m=r.B(i);if(m!=="object")return a=a.concat([new r.V("light-3d",i,`object expected, ${m} found`)]),a;const b=p.styleSpec,w=b["light-3d"],E=p.key,R=p.style,z=p.style.lights;for(const X of["type","id"])if(!(X in i))return a=a.concat([new r.V("light-3d",i,`missing property ${X} on light`)]),a;if(i.type&&z)for(let X=0;X<p.arrayIndex;X++){const K=r.D(i.type),Q=z[X];r.D(Q.type)===K&&a.push(new r.V(E,i.id,`duplicate light type "${i.type}", previously defined at line ${Q.id.__line__}`))}const N=`properties_light_${i.type}`;if(!(N in b))return a=a.concat([new r.V("light-3d",i,`Invalid light type ${i.type}`)]),a;const j=b[N];for(const X in i)if(X==="properties"){const K=i[X],Q=r.B(K);if(Q!=="object")return a=a.concat([new r.V("properties",K,`object expected, ${Q} found`)]),a;for(const he in K)a=a.concat(j[he]?ii({key:he,value:K[he],valueSpec:j[he],style:R,styleSpec:b}):[new r.A(p.key,K[he],`unknown property "${he}"`)])}else{const K=X.match(/^(.*)-transition$/);a=a.concat(K&&w[K[1]]&&w[K[1]].transition?ii({key:X,value:i[X],valueSpec:b.transition,style:R,styleSpec:b}):w[X]?ii({key:X,value:i[X],valueSpec:w[X],style:R,styleSpec:b}):[new r.A(X,i[X],`unknown property "${X}"`)])}return a}function Sr(p){const i=p.value,a=p.key,m=p.style,b=p.styleSpec,w=b.terrain;let E=[];const R=r.B(i);if(i===void 0||R==="null")return E;if(R!=="object")return E=E.concat([new r.V("terrain",i,`object expected, ${R} found`)]),E;for(const z in i){const N=z.match(/^(.*)-transition$/);E=E.concat(N&&w[N[1]]&&w[N[1]].transition?ii({key:z,value:i[z],valueSpec:b.transition,style:m,styleSpec:b}):w[z]?ii({key:z,value:i[z],valueSpec:w[z],style:m,styleSpec:b}):[new r.A(z,i[z],`unknown property "${z}"`)])}if(i.source){const z=m.sources&&m.sources[i.source],N=z&&r.D(z.type);z?N!=="raster-dem"&&E.push(new r.V(a,i.source,`terrain cannot be used with a source of type ${String(N)}, it only be used with a "raster-dem" source type`)):E.push(new r.V(a,i.source,`source "${i.source}" not found`))}else E.push(new r.V(a,i,'terrain is missing required property "source"'));return E}function Tr(p){const i=p.value,a=p.style,m=p.styleSpec,b=m.fog;let w=[];const E=r.B(i);if(i===void 0)return w;if(E!=="object")return w=w.concat([new r.V("fog",i,`object expected, ${E} found`)]),w;for(const R in i){const z=R.match(/^(.*)-transition$/);w=w.concat(z&&b[z[1]]&&b[z[1]].transition?ii({key:R,value:i[R],valueSpec:m.transition,style:a,styleSpec:m}):b[R]?ii({key:R,value:i[R],valueSpec:b[R],style:a,styleSpec:m}):[new r.A(R,i[R],`unknown property "${R}"`)])}return w}const Bo={"*":()=>[],array:Qt,boolean:function(p){const i=p.value,a=p.key,m=r.B(i);return m!=="boolean"?[new r.V(a,i,`boolean expected, ${m} found`)]:[]},number:Gt,color:function(p){const i=p.key,a=p.value,m=r.B(a);return m!=="string"?[new r.V(i,a,`color expected, ${m} found`)]:r.U.parseCSSColor(a)===null?[new r.V(i,a,`color expected, "${a}" found`)]:[]},enum:Wn,filter:Rn,function:Yt,layer:gi,object:Ct,source:Rr,model:r.Z,light:dr,"light-3d":Ho,terrain:Sr,fog:Tr,string:or,formatted:function(p){return or(p).length===0?[]:vn(p)},resolvedImage:function(p){return or(p).length===0?[]:vn(p)},projection:function(p){const i=p.value,a=p.styleSpec,m=a.projection,b=p.style;let w=[];const E=r.B(i);if(E==="object")for(const R in i)w=w.concat(ii({key:R,value:i[R],valueSpec:m[R],style:b,styleSpec:a}));else E!=="string"&&(w=w.concat([new r.V("projection",i,`object or string expected, ${E} found`)]));return w},import:function(p){const{value:i,styleSpec:a}=p,{data:m,...b}=i;Object.defineProperty(b,"__line__",{value:i.__line__,enumerable:!1});let w=Ct(r.C({},p,{value:b,valueSpec:a.import}));return r.D(b.id)===""&&w.push(new r.V(`${p.key}.id`,b,"import id can't be an empty string")),m&&(w=w.concat(vs(m,a,{key:`${p.key}.data`}))),w}};function ii(p,i=!1){const a=p.value,m=p.valueSpec,b=p.styleSpec;if(m.expression&&r.X(r.D(a)))return Yt(p);if(m.expression&&r.J(r.K(a)))return vn(p);if(m.type&&Bo[m.type]){const w=Bo[m.type](p);return i===!0&&w.length>0&&r.B(p.value)==="array"?vn(p):w}return Ct(r.C({},p,{valueSpec:m.type?b[m.type]:m}))}function Qo(p){const i=p.value,a=p.key,m=or(p);return m.length||(i.indexOf("{fontstack}")===-1&&m.push(new r.V(a,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&m.push(new r.V(a,i,'"glyphs" url must include a "{range}" token'))),m}function vs(p,i=r._,a={}){return ii({key:a.key||"",value:p,valueSpec:i.$root,styleSpec:i,style:p,objectElementValidators:{glyphs:Qo,"*":()=>[]}})}function To(p,i=r._){return Ge(vs(p,i))}const Eo=p=>Ge(Rr(p)),es=p=>Ge(dr(p)),ys=p=>Ge(Ho(p)),Qs=p=>Ge(Sr(p)),bs=p=>Ge(Tr(p)),vt=p=>Ge(gi(p)),ye=p=>Ge(Rn(p)),Te=p=>Ge(ti(p)),Ve=p=>Ge(ki(p)),Ze=p=>Ge(r.Z(p));function Ge(p){return p.slice().sort((i,a)=>i.line&&a.line?i.line-a.line:0)}function at(p,i){let a=!1;if(i&&i.length)for(const m of i)m instanceof r.A?r.w(m.message):(p.fire(new r.t(new Error(m.message))),a=!0);return a}let xt;class lt extends r.E{constructor(i,a="flat"){super(),this._transitionable=new r.$(xt||(xt=new r.a0({anchor:new r.a1(r._.light.anchor),position:new r.a2(r._.light.position),color:new r.a1(r._.light.color),intensity:new r.a1(r._.light.intensity)}))),this.setLight(i,a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,a,m={}){this._validate(es,i,m)||(this._transitionable.setTransitionOrValue(i),this.id=a)}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,a,m){return(!m||m.validate!==!1)&&at(this,i.call(To,r.l({value:a,style:{glyphs:!0,sprite:!0},styleSpec:r._})))}}const wt=new r.a0({source:new r.a1(r._.terrain.source),exaggeration:new r.a1(r._.terrain.exaggeration)});let Rt=class extends r.E{constructor(p,i,a,m){super(),this.scope=a,this._transitionable=new r.$(wt,a,m),this._transitionable.setTransitionOrValue(p,m),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(p,i){this._transitionable.setTransitionOrValue(p,i)}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}getExaggeration(p){return this._transitioning.possiblyEvaluate(new r.a3(p)).get("exaggeration")}isZoomDependent(){const p=this._transitionable._values.exaggeration;return p!=null&&p.value!=null&&p.value.expression!=null&&p.value.expression instanceof r.a4}};const Tt=45,Zt=65,xn=.05;function wn(p,i,a,m){const b=r.a7(Tt,Zt,a),[w,E]=$n(p,m);let R=1-Math.min(1,Math.exp((i-w)/(E-w)*-6));return R*=R*R,R=Math.min(1,1.00747*R),R*b*p.alpha}function $n(p,i){const a=.5/Math.tan(.5*i);return[p.range[0]+a,p.range[1]+a]}function Zn(p,i,a,m,b){const w=r.a6.vec3.transformMat4([],[i,a,m],b.mercatorFogMatrix);return wn(p,r.a6.vec3.length(w),b.pitch,b._fov)}function Xn(p,i,a,m,b,w,E){const R=[[a,m,0],[b,m,0],[b,w,0],[a,w,0]];let z=Number.MAX_VALUE,N=-Number.MAX_VALUE;for(const j of R){const X=r.a6.vec3.transformMat4([],j,i),K=r.a6.vec3.length(X);z=Math.min(z,K),N=Math.max(N,K)}return[wn(p,z,E.pitch,E._fov),wn(p,N,E.pitch,E._fov)]}const Un=new r.a0({range:new r.a1(r._.fog.range),color:new r.a1(r._.fog.color),"high-color":new r.a1(r._.fog["high-color"]),"space-color":new r.a1(r._.fog["space-color"]),"horizon-blend":new r.a1(r._.fog["horizon-blend"]),"star-intensity":new r.a1(r._.fog["star-intensity"]),"vertical-range":new r.a1(r._.fog["vertical-range"])});class bi extends r.E{constructor(i,a,m,b){super(),this._transitionable=new r.$(Un,m,new Map(b)),this.set(i,b),this._transitioning=this._transitionable.untransitioned(),this._transform=a,this.properties=new r.a8(Un),this.scope=m}get state(){const i=this._transform,a=i.projection.name==="globe",m=r.a9(i.zoom),b=this.properties.get("range"),w=[.5,3];return{range:a?[r.aa(w[0],b[0],m),r.aa(w[1],b[1],m)]:b,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,a,m={}){if(this._validate(bs,i,m))return;const b=r.l({},i);for(const w of Object.keys(r._.fog))b[w]===void 0&&(b[w]=r._.fog[w].default);this._options=b,this._transitionable.setTransitionOrValue(this._options,a)}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const a=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.a7(Tt,Zt,i))*a.a}getOpacityAtLatLng(i,a){return this._transform.projection.supportsFog?function(m,b,w){const E=r.a5.fromLngLat(b),R=w.elevation?w.elevation.getAtPointOrZero(E):0;return Zn(m,E.x,E.y,R,w)}(this.state,i,a):0}getOpacityForTile(i){if(!this._transform.projection.supportsFog)return[1,1];const a=this._transform.calculateFogTileMatrix(i.toUnwrapped());return Xn(this.state,a,0,0,r.ab,r.ab,this._transform)}getOpacityForBounds(i,a,m,b,w){return this._transform.projection.supportsFog?Xn(this.state,i,a,m,b,w,this._transform):[1,1]}getFovAdjustedRange(i){return this._transform.projection.supportsFog?$n(this.state,i):[0,1]}isVisibleOnFrustum(i){if(!this._transform.projection.supportsFog)return!1;const a=[4,5,6,7];for(const m of a){const b=i.points[m];let w;if(b[2]>=0)w=b;else{const E=i.points[m-4];w=r.ac(E,b,E[2]/(E[2]-b[2]))}if(Zn(this.state,w[0],w[1],0,this._transform)>=xn)return!0}return!1}updateConfig(i){this._transitionable.setTransitionOrValue(this._options,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,a,m){return(!m||m.validate!==!1)&&at(this,i.call(To,r.l({value:a,style:{glyphs:!0,sprite:!0},styleSpec:r._})))}}class Ri extends r.E{constructor(i,a,m,b){super(),this.scope=m,this._options=i,this.properties=new r.a8(a),this._transitionable=new r.$(a,m,new Map(b)),this._transitionable.setTransitionOrValue(i.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(i){this._transitionable.setTransitionOrValue(this._options.properties,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(i,a){this._options=i,this._transitionable.setTransitionOrValue(i.properties,a)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let ni,Ai;class qi{constructor(i,a,m,b){this.screenBounds=i,this.cameraPoint=a,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,b)}static createFromScreenPoints(i,a){let m,b;if(i instanceof r.P||typeof i[0]=="number"){const w=r.P.convert(i);m=[w],b=a.isPointAboveHorizon(w)}else{const w=r.P.convert(i[0]),E=r.P.convert(i[1]);m=[w,E],b=r.ae(w,E).every(R=>a.isPointAboveHorizon(R))}return new qi(m,a.getCameraPoint(),b,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(i){return r.ae(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const a=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],b=r.ae(a,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<m.x?b.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?b[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(b[3]=this.cameraPoint)),r.af(b,i)}bufferedCameraGeometryGlobe(i){const a=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],b=r.ae(a,m,i),w=this.cameraPoint.clone();switch(3*((w.y>a.y)+(w.y>m.y))+((w.x>a.x)+(w.x>m.x))){case 0:b[0]=w,b[4]=w.clone();break;case 1:b.splice(1,0,w);break;case 2:b[1]=w;break;case 3:b.splice(4,0,w);break;case 5:b.splice(2,0,w);break;case 6:b[3]=w;break;case 7:b.splice(3,0,w);break;case 8:b[2]=w}return b}containsTile(i,a,m,b=0){const w=i.queryPadding/a._pixelsPerMercatorPixel+1,E=m?this._bufferedCameraMercator(w,a):this._bufferedScreenMercator(w,a);let R=i.tileID.wrap+(E.unwrapped?b:0);const z=E.polygon.map(_e=>r.ag(i.tileTransform,_e,R));if(!r.ah(z,0,0,r.ab,r.ab))return;R=i.tileID.wrap+(this.screenGeometryMercator.unwrapped?b:0);const N=this.screenGeometryMercator.polygon.map(_e=>r.ai(i.tileTransform,_e,R)),j=N.map(_e=>new r.P(_e[0],_e[1])),X=a.getFreeCameraOptions().position||new r.a5(0,0,0),K=r.ai(i.tileTransform,X,R),Q=N.map(_e=>{const ve=r.a6.vec3.sub(_e,_e,K);return r.a6.vec3.normalize(ve,ve),new r.aj(K,ve)}),he=r.ak(i,1,a.zoom)*a._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:j,tilespaceRays:Q,bufferedTilespaceGeometry:z,bufferedTilespaceBounds:(me=r.al(z),me.min.x=r.ap(me.min.x,0,r.ab),me.min.y=r.ap(me.min.y,0,r.ab),me.max.x=r.ap(me.max.x,0,r.ab),me.max.y=r.ap(me.max.y,0,r.ab),me),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:he};var me}_bufferedScreenMercator(i,a){const m=Dr(i);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let b;return b=a.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(i),a):{polygon:this.bufferedScreenGeometry(i).map(w=>a.pointCoordinate3D(w)),unwrapped:!0},this._screenRaycastCache[m]=b,b}}_bufferedCameraMercator(i,a){const m=Dr(i);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let b;return b=a.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(i),a):{polygon:this.bufferedCameraGeometry(i).map(w=>a.pointCoordinate3D(w)),unwrapped:!0},this._cameraRaycastCache[m]=b,b}}_projectAndResample(i,a){const m=function(w,E){const R=r.a6.mat4.multiply([],E.pixelMatrix,E.globeMatrix),z=[0,-r.aq,0,1],N=[0,r.aq,0,1],j=[0,0,0,1];r.a6.vec4.transformMat4(z,z,R),r.a6.vec4.transformMat4(N,N,R),r.a6.vec4.transformMat4(j,j,R);const X=new r.P(z[0]/z[3],z[1]/z[3]),K=new r.P(N[0]/N[3],N[1]/N[3]),Q=r.an(w,X)&&z[3]<j[3],he=r.an(w,K)&&N[3]<j[3];if(!Q&&!he)return null;const me=function(qe,$e,We){for(let nt=1;nt<qe.length;nt++){const Ke=Pr($e.pointCoordinate3D(qe[nt-1]).x),Ye=Pr($e.pointCoordinate3D(qe[nt]).x);if(We<0){if(Ke<Ye)return{idx:nt,t:-Ke/(Ye-1-Ke)}}else if(Ye<Ke)return{idx:nt,t:(1-Ke)/(Ye+1-Ke)}}return null}(w,E,Q?-1:1);if(!me)return null;const{idx:_e,t:ve}=me;let ke=_e>1?Qi(w.slice(0,_e),E):[],De=_e<w.length?Qi(w.slice(_e),E):[];ke=ke.map(qe=>new r.P(Pr(qe.x),qe.y)),De=De.map(qe=>new r.P(Pr(qe.x),qe.y));const Pe=[...ke];Pe.length===0&&Pe.push(De[De.length-1]);const Fe=r.aa(Pe[Pe.length-1].y,(De.length===0?ke[0]:De[0]).y,ve);let ze;return ze=Q?[new r.P(0,Fe),new r.P(0,0),new r.P(1,0),new r.P(1,Fe)]:[new r.P(1,Fe),new r.P(1,1),new r.P(0,1),new r.P(0,Fe)],Pe.push(...ze),De.length===0?Pe.push(ke[0]):Pe.push(...De),{polygon:Pe.map(qe=>new r.a5(qe.x,qe.y)),unwrapped:!1}}(i,a);if(m)return m;const b=function(w,E){let R=!1,z=-1/0,N=0;for(let X=0;X<w.length-1;X++)w[X].x>z&&(z=w[X].x,N=X);for(let X=0;X<w.length-1;X++){const K=(N+X)%(w.length-1),Q=w[K],he=w[K+1];Math.abs(Q.x-he.x)>.5&&(Q.x<he.x?(Q.x+=1,K===0&&(w[w.length-1].x+=1)):(he.x+=1,K+1===w.length-1&&(w[0].x+=1)),R=!0)}const j=r.am(E.center.lng);return R&&j<Math.abs(j-1)&&w.forEach(X=>{X.x-=1}),{polygon:w,unwrapped:R}}(Qi(i,a).map(w=>new r.P(Pr(w.x),w.y)),a);return{polygon:b.polygon.map(w=>new r.a5(w.x,w.y)),unwrapped:b.unwrapped}}}function Qi(p,i){return r.ao(p,a=>{const m=i.pointCoordinate3D(a);a.x=m.x,a.y=m.y},1/256)}function Pr(p){return p<0?1+p%1:p%1}function Dr(p){return 100*p|0}function uo(p,i,a,m,b){const w=function(R,z){if(R)return b(R);if(z){if(p.url&&z.tiles&&p.tiles&&delete p.tiles,z.variants){if(!Array.isArray(z.variants))return b(new Error("variants must be an array"));for(const j of z.variants){if(j==null||typeof j!="object"||j.constructor!==Object)return b(new Error("variant must be an object"));if(!Array.isArray(j.capabilities))return b(new Error("capabilities must be an array"));if(j.capabilities.length===1&&j.capabilities[0]==="meshopt"){z=r.l(z,j);break}}}const N=r.ar(r.l(z,p),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);z.vector_layers&&(N.vectorLayers=z.vector_layers,N.vectorLayerIds=N.vectorLayers.map(j=>j.id)),z.raster_layers&&(N.rasterLayers=z.raster_layers,N.rasterLayerIds=N.rasterLayers.map(j=>j.id)),N.tiles=i.canonicalizeTileset(N,p.url),b(null,N)}},E=function(R,z,N){if(!R)return null;if(!z&&!N)return R;N=N||R.worldview_default;const j=Object.values(R.language||{});if(j.length===0)return null;const X=Object.values(R.worldview||{});if(X.length===0)return null;const K=j.every(he=>he===z),Q=X.every(he=>he===N);return K&&Q?R:z in(R.language_options||{})||N in(R.worldview_options||{})?null:R.language_options&&R.worldview_options?R:null}(p.data,a,m);return E?r.q.frame(()=>w(null,E)):p.url?r.n(i.transformRequest(i.normalizeSourceURL(p.url,null,a,m),r.R.Source),w):r.q.frame(()=>{const{data:R,...z}=p;w(null,z)})}class ts{constructor(i,a,m){this.bounds=r.as.convert(this.validateBounds(i)),this.minzoom=a||0,this.maxzoom=m||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const a=Math.pow(2,i.z),m=Math.floor(r.am(this.bounds.getWest())*a),b=Math.floor(r.at(this.bounds.getNorth())*a),w=Math.ceil(r.am(this.bounds.getEast())*a),E=Math.ceil(r.at(this.bounds.getSouth())*a);return i.x>=m&&i.x<w&&i.y>=b&&i.y<E}}class el extends r.E{constructor(i,a,m,b){if(super(),this.id=i,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.l(this,r.ar(a,["url","scheme","tileSize","promoteId"])),this._options=r.l({type:"vector"},a),this._collectResourceTiming=!!a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b),this._tileWorkers={},this._deduped=new r.au}load(i){this._loaded=!1,this.fire(new r.x("dataloading",{dataType:"source"}));const a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,m=this.map._worldview;this._tileJSONRequest=uo(this._options,this.map._requestManager,a,m,(b,w)=>{this._tileJSONRequest=null,this._loaded=!0,b?(a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),m&&m.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${m}`),this.fire(new r.t(b))):w&&(r.l(this,w),w.bounds&&(this.tileBounds=new ts(w.bounds,this.minzoom,this.maxzoom)),bn(w.tiles,this.map._requestManager._customAccessToken),this.fire(new r.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.x("data",{dataType:"source",sourceDataType:"content"}))),i&&i(b)})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=r.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return r.l({},this._options)}loadTile(i,a){const m=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme)),b=this.map._requestManager.transformRequest(m,r.R.Tile),w=this.map.style?this.map.style.getLut(this.scope):null,E={request:b,data:void 0,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,lut:w?{image:w.image.clone()}:null,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:i.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:i.isExtraShadowCaster,tessellationStep:this.map._tessellationStep};if(E.request.collectResourceTiming=this._collectResourceTiming,i.actor&&i.state!=="expired")i.state==="loading"?i.reloadCallback=a:i.request=i.actor.send("reloadTile",E,R.bind(this));else if(i.actor=this._tileWorkers[m]=this._tileWorkers[m]||this.dispatcher.getActor(),this.dispatcher.ready)i.request=i.actor.send("loadTile",E,R.bind(this),void 0,!0);else{const z=r.aw.call({deduped:this._deduped},E,(N,j)=>{N||!j?R.call(this,N):(E.data={cacheControl:j.cacheControl,expires:j.expires,rawData:j.rawData.slice(0)},i.actor&&i.actor.send("loadTile",E,R.bind(this),void 0,!0))},!0);i.request={cancel:z}}function R(z,N){return delete i.request,i.aborted?a(null):z&&z.status!==404?a(z):(N&&N.resourceTiming&&(i.resourceTiming=N.resourceTiming),this.map._refreshExpiredTiles&&N&&i.setExpiryData(N),i.loadVectorData(N,this.map.painter),r.ax(this.dispatcher),a(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(i,a){i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope}),i.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Cs extends r.E{constructor(i,a,m,b){super(),this.id=i,this.dispatcher=m,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.l({type:"raster"},a),r.l(this,r.ar(a,["url","scheme","tileSize"]))}load(i){this._loaded=!1,this.fire(new r.x("dataloading",{dataType:"source"})),this._tileJSONRequest=uo(this._options,this.map._requestManager,null,null,(a,m)=>{this._tileJSONRequest=null,this._loaded=!0,a?this.fire(new r.t(a)):m&&(r.l(this,m),m.bounds&&(this.tileBounds=new ts(m.bounds,this.minzoom,this.maxzoom)),bn(m.tiles),this.fire(new r.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.x("data",{dataType:"source",sourceDataType:"content"}))),i&&i(a)})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=r.av(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return r.l({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,a){const m=r.q.devicePixelRatio>=2,b=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);i.request=r.o(this.map._requestManager.transformRequest(b,r.R.Tile),(w,E,R,z)=>(delete i.request,i.aborted?(i.state="unloaded",a(null)):w?(i.state="errored",a(w)):E?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:R,expires:z}),i.setTexture(E,this.map.painter),i.state="loaded",r.ax(this.dispatcher),void a(null)):a(null)))}abortTile(i,a){i.request&&(i.request.cancel(),delete i.request),a&&a()}unloadTile(i,a){i.texture&&i.texture instanceof r.T?(i.destroy(!0),i.texture&&i.texture instanceof r.T&&this.map.painter.saveTileTexture(i.texture)):i.destroy(),a&&a()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ea extends Cs{constructor(i,a,m,b){super(i,a,m,b),this.type="raster-array",this.maxzoom=22,this._options=r.l({type:"raster-array"},a)}triggerRepaint(i){const a=this.map.painter._terrain,m=this.map.style.getSourceCache(this.id);a&&a.enabled&&m&&a._clearRenderCacheForTile(m.id,i.tileID),this.map.triggerRepaint()}loadTile(i,a){const m=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),b=this.map._requestManager.transformRequest(m,r.R.Tile);i.requestParams=b,i.actor||(i.actor=this.dispatcher.getActor()),i.request=i.fetchHeader(void 0,(w,E,R,z)=>{if(delete i.request,i.aborted)return i.state="unloaded",a(null);if(w)return w.code===20?void 0:(i.state="errored",a(w));this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:R,expires:z}),i.state="empty",a(null)})}unloadTile(i,a){const m=i.texture;m&&m instanceof r.T?(i.destroy(!0),this.map.painter.saveTileTexture(m)):(i.destroy(),i.flushQueues(),i._isHeaderLoaded=!1,delete i._mrt,delete i.textureDescriptor),i.fbo&&(i.fbo.destroy(),delete i.fbo),delete i.request,delete i.requestParams,delete i.neighboringTiles,i.state="unloaded"}prepareTile(i,a,m){i._isHeaderLoaded&&(i.state!=="empty"&&(i.state="reloading"),i.fetchBand(a,m,(b,w)=>{if(b)return i.state="errored",this.fire(new r.t(b)),void this.triggerRepaint(i);w&&(i.setTexture(w,this.map.painter),i.state="loaded",this.triggerRepaint(i))}))}getInitialBand(i){if(!this.rasterLayers)return 0;const a=this.rasterLayers.find(({id:w})=>w===i),m=a&&a.fields,b=m&&m.bands&&m.bands;return b?b[0]:0}getTextureDescriptor(i,a,m){if(!i)return;const b=a.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!b)return;let w=null;a instanceof r.aB?w=a.paint.get("raster-array-band"):a instanceof r.aC&&(w=a.paint.get("raster-particle-array-band"));const E=w||this.getInitialBand(b);if(E!=null)if(i.textureDescriptor){if(!i.updateNeeded(b,E)||m)return Object.assign({},i.textureDescriptor,{texture:i.texture})}else this.prepareTile(i,b,E)}}const Ua={vector:el,raster:Cs,"raster-dem":class extends Cs{constructor(p,i,a,m){super(p,i,a,m),this.type="raster-dem",this.maxzoom=22,this._options=r.l({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(p,i){const a=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(b,w){b&&(p.state="errored",i(b)),w&&(p.dem=w,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",i(null))}p.request=r.o(this.map._requestManager.transformRequest(a,r.R.Tile),(function(b,w,E,R){if(delete p.request,p.aborted)p.state="unloaded",i(null);else if(b)p.state="errored",i(b);else if(w){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:E,expires:R});const z=ImageBitmap&&w instanceof ImageBitmap&&r.ay(),N=1-(w.width-r.az(w.width))/2;N<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const j=z?w:r.q.getImageData(w,N),X={uid:p.uid,coord:p.tileID,source:this.id,scope:this.scope,rawImageData:j,encoding:this.encoding,padding:N};p.actor&&p.state!=="expired"||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",X,m.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(p){const i=p.canonical,a=Math.pow(2,i.z),m=(i.x-1+a)%a,b=i.x===0?p.wrap-1:p.wrap,w=(i.x+1+a)%a,E=i.x+1===a?p.wrap+1:p.wrap,R={};return R[new r.aA(p.overscaledZ,b,i.z,m,i.y).key]={backfilled:!1},R[new r.aA(p.overscaledZ,E,i.z,w,i.y).key]={backfilled:!1},i.y>0&&(R[new r.aA(p.overscaledZ,b,i.z,m,i.y-1).key]={backfilled:!1},R[new r.aA(p.overscaledZ,p.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},R[new r.aA(p.overscaledZ,E,i.z,w,i.y-1).key]={backfilled:!1}),i.y+1<a&&(R[new r.aA(p.overscaledZ,b,i.z,m,i.y+1).key]={backfilled:!1},R[new r.aA(p.overscaledZ,p.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},R[new r.aA(p.overscaledZ,E,i.z,w,i.y+1).key]={backfilled:!1}),R}},"raster-array":ea,geojson:class extends r.E{constructor(p,i,a,m){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(m),this._data=i.data,this._options=r.l({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.minzoom!==void 0&&(this.minzoom=i.minzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const b=r.ab/this.tileSize;this.workerOptions=r.l({source:this.id,scope:this.scope,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(i.buffer!==void 0?i.buffer:128)*b,tolerance:(i.tolerance!==void 0?i.tolerance:.375)*b,extent:r.ab,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:r.ab,radius:(i.clusterRadius!==void 0?i.clusterRadius:50)*b,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter,dynamic:i.dynamic},i.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}updateData(p){if(!this._options.dynamic)return this.fire(new r.t(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof p!="string"&&(p.type==="Feature"&&(p={type:"FeatureCollection",features:[p]}),p.type!=="FeatureCollection"))return this.fire(new r.t(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof p!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const i=new Map;for(const a of this._data.features)i.set(a.id,a);for(const a of p.features)i.set(a.id,a);this._data.features=[...i.values()]}else this._data=p;return this._updateWorkerData(!0),this}getClusterExpansionZoom(p,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id,scope:this.scope},i),this}getClusterChildren(p,i){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id,scope:this.scope},i),this}getClusterLeaves(p,i,a,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:p,limit:i,offset:a},m),this}_updateWorkerData(p=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.x("dataloading",{dataType:"source"})),this._loaded=!1;const i=r.l({append:p},this.workerOptions);i.scope=this.scope;const a=this._data;typeof a=="string"?(i.request=this.map._requestManager.transformRequest(r.q.resolveURL(a),r.R.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,i,(m,b)=>{if(this._loaded=!0,this._pendingLoad=null,m)this.fire(new r.t(m));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&b&&b.resourceTiming&&b.resourceTiming[this.id]&&(w.resourceTiming=b.resourceTiming[this.id]),p&&(this._partialReload=!0),this.fire(new r.x("data",w)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(p),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(p,i){const a=p.actor?"reloadTile":"loadTile";p.actor=this.actor;const m=this.map.style?this.map.style.getLut(this.scope):null,b=this._partialReload,w={type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:m?{image:m.image.clone()}:null,scope:this.scope,pixelRatio:r.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,partial:b};p.request=this.actor.send(a,w,(E,R)=>b&&!R?(p.state="loaded",i(null)):(delete p.request,p.destroy(),p.aborted?i(null):E?i(E):(p.loadVectorData(R,this.map.painter,a==="reloadTile"),i(null))),void 0,a==="loadTile")}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p,i){this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id,scope:this.scope}),p.destroy()}onRemove(p){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return r.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.aD{constructor(p,i,a,m){super(p,i,a,m),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const i of p.urls)this.urls.push(this.map._requestManager.transformRequest(i,r.R.Source).url);r.aE(this.urls,(i,a)=>{this._loaded=!0,i?this.fire(new r.t(i)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const i=this.video.seekable;p<i.start(0)||p>i.end(0)?this.fire(new r.t(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const p=this.map.painter.context,i=p.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(p,this.video,i.RGBA8),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.aD,model:class extends r.E{constructor(p,i,a,m){super(),this.id=p,this.type="model",this.models=[],this._loaded=!1,this._options=i}load(){const p=[];for(const i in this._options.models){const a=this._options.models[i],m=r.aG(this.map._requestManager.transformRequest(a.uri,r.R.Model).url).then(b=>{if(!b)return;const w=r.aH(b),E=new r.aI(i,a.position,a.orientation,w);E.computeBoundsAndApplyParent(),this.models.push(E)}).catch(b=>{this.fire(new r.t(new Error(`Could not load model ${i} from ${a.uri}: ${b.message}`)))});p.push(m)}return Promise.allSettled(p).then(()=>{this._loaded=!0,this.fire(new r.x("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(i=>{this.fire(new r.t(new Error(`Could not load models: ${i.message}`)))})}onAdd(p){this.map=p,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(p,i){}serialize(){return{type:"model"}}},"batched-model":class extends r.E{constructor(p,i,a,m){super(),this.type="batched-model",this.id=p,this.tileSize=512,this._options=i,this.tiles=this._options.tiles,this.maxzoom=i.maxzoom||19,this.minzoom=i.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=a,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(m)}onAdd(p){this.map=p,this.load()}load(p){this._loaded=!1,this.fire(new r.x("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,a=this.map._worldview;this._tileJSONRequest=uo(this._options,this.map._requestManager,i,a,(m,b)=>{this._tileJSONRequest=null,this._loaded=!0,m?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),a&&a.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new r.t(m))):b&&(r.l(this,b),b.bounds&&(this.tileBounds=new ts(b.bounds,this.minzoom,this.maxzoom)),bn(b.tiles,this.map._requestManager._customAccessToken),this.fire(new r.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.x("data",{dataType:"source",sourceDataType:"content"}))),p&&p(m)})}hasTransition(){return!1}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}loaded(){return this._loaded}loadTile(p,i){const a=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),m={request:this.map._requestManager.transformRequest(a,r.R.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:p.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(p.actor&&p.state!=="expired")if(p.state==="loading")p.reloadCallback=i;else{if(p.buckets){const w=Object.values(p.buckets);for(const E of w)E.dirty=!0;return void(p.state="loaded")}p.request=p.actor.send("reloadTile",m,b.bind(this))}else p.actor=this.dispatcher.getActor(),p.request=p.actor.send("loadTile",m,b.bind(this),void 0,!0);function b(w,E){return p.aborted?i(null):w&&w.status!==404?i(w):(E&&(E.resourceTiming&&(p.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&p.setExpiryData(E),p.buckets={...p.buckets,...E.buckets},E.featureIndex&&(p.latestFeatureIndex=E.featureIndex)),p.state="loaded",void i(null))}}serialize(){return r.l({},this._options)}},canvas:class extends r.aD{constructor(p,i,a,m){super(p,i,a,m),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(w=>typeof w!="number"))||this.fire(new r.t(new r.V(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.t(new r.V(`sources.${p}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new r.t(new r.V(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof HTMLCanvasElement||this.fire(new r.t(new r.V(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.t(new r.V(`sources.${p}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.t(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(p){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context;this.texture?!p&&!this._playing||this.texture instanceof r.aF||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(i,this.canvas,i.gl.RGBA8,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends r.E{constructor(p,i,a,m){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=i,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.t(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.t(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new ts(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),r.l(this,r.ar(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.ar(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.x("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.x("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this.map=p,this._loaded=!1,this.fire(new r.x("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){const{x:i,y:a,z:m}=p.canonical;return this._implementation.hasTile({x:i,y:a,z:m})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,i){const{x:a,y:m,z:b}=p.tileID.canonical,w=new AbortController;p.request=Promise.resolve(this._implementation.loadTile({x:a,y:m,z:b},{signal:w.signal})).then((function(E){return delete p.request,p.aborted?(p.state="unloaded",i(null)):E===void 0?(p.state="errored",i(null)):E===null?(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",i(null)):function(R){return R instanceof ImageData||R instanceof HTMLCanvasElement||R instanceof ImageBitmap||R instanceof HTMLImageElement}(E)?(this.loadTileData(p,E),p.state="loaded",void i(null)):(p.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(E=>{E.code!==20&&(p.state="errored",i(E))}),p.request.cancel=()=>w.abort()}loadTileData(p,i){p.setTexture(i,this.map.painter)}unloadTile(p,i){if(p.texture&&p.texture instanceof r.T?(p.destroy(!0),p.texture&&p.texture instanceof r.T&&this.map.painter.saveTileTexture(p.texture)):p.destroy(),this._implementation.unloadTile){const{x:a,y:m,z:b}=p.tileID.canonical;this._implementation.unloadTile({x:a,y:m,z:b})}i&&i()}abortTile(p,i){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),i&&i()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_clearTiles(){const p=r.av(this.id,this.scope);this.map.style.clearSource(p)}_update(){this.fire(new r.x("data",{dataType:"source",sourceDataType:"content"}))}}},Io=function(p,i,a,m){const b=new Ua[i.type](p,i,a,m);if(b.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${b.id}`);return r.aJ(["load","abort","unload","serialize","prepare"],b),b};function ja(p,i){const a=r.a6.mat4.identity([]);return r.a6.mat4.scale(a,a,[.5*p.width,.5*-p.height,1]),r.a6.mat4.translate(a,a,[1,-1,0]),r.a6.mat4.multiply(a,a,p.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(a)}function xa(p,i,a,m,b,w,E,R=!1){const z=p.tilesIn(m,E,R);z.sort(ta);const N=[];for(const X of z)N.push({wrappedTileID:X.tile.tileID.wrapped().key,queryResults:X.tile.queryRenderedFeatures(i,a,p._state,X,b,w,ja(p.transform,X.tile.tileID),R)});const j=function(X){const K={},Q={};for(const he of X){const me=he.queryResults,_e=he.wrappedTileID,ve=Q[_e]=Q[_e]||{};for(const ke in me){const De=me[ke],Pe=ve[ke]=ve[ke]||{},Fe=K[ke]=K[ke]||[];for(const ze of De)Pe[ze.featureIndex]||(Pe[ze.featureIndex]=!0,Fe.push(ze))}}return K}(N);for(const X in j)j[X].forEach(K=>{const Q=K.feature,he=Q.layer;he&&he.type!=="background"&&he.type!=="sky"&&he.type!=="slot"&&(Q.source=he.source,he["source-layer"]&&(Q.sourceLayer=he["source-layer"]),Q.state=Q.id!==void 0?p.getFeatureState(he["source-layer"],Q.id):{})});return j}function wa(p,i){const a=p.getRenderableIds().map(w=>p.getTileByID(w)),m=[],b={};for(let w=0;w<a.length;w++){const E=a[w],R=E.tileID.canonical.key;b[R]||(b[R]=!0,E.querySourceFeatures(m,i))}return m}function ta(p,i){const a=p.tileID,m=i.tileID;return a.overscaledZ-m.overscaledZ||a.canonical.y-m.canonical.y||a.wrap-m.wrap||a.canonical.x-m.canonical.x}const Fo=32,ns=33,_o=new Uint16Array(8184);for(let p=0;p<2046;p++){let i=p+2,a=0,m=0,b=0,w=0,E=0,R=0;for(1&i?b=w=E=Fo:a=m=R=Fo;(i>>=1)>1;){const N=a+b>>1,j=m+w>>1;1&i?(b=a,w=m,a=E,m=R):(a=b,m=w,b=E,w=R),E=N,R=j}const z=4*p;_o[z+0]=a,_o[z+1]=m,_o[z+2]=b,_o[z+3]=w}const Co=new Uint16Array(2178),Ur=new Uint8Array(1089),ho=new Uint16Array(1089);function is(p){return p===0?-.03125:p===32?.03125:0}const Sa={type:2,extent:r.ab,loadGeometry:()=>[[new r.P(0,0),new r.P(r.ab+1,0),new r.P(r.ab+1,r.ab+1),new r.P(0,r.ab+1),new r.P(0,0)]]};class cs{constructor(i,a,m,b,w){this.tileID=i,this.uid=r.aP(),this.uses=0,this.tileSize=a,this.tileZoom=m,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=w,b&&b.style&&(this._lastUpdatedBrightness=b.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",b&&b.transform&&(this.projection=b.transform.projection)}registerFadeDuration(i){const a=i+this.timeAdded;a<r.q.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=r.aK(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,a,m){if(this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(b,w){const E={};if(!w)return E;for(const R of b){const z=R.layerIds.map(N=>w.getLayer(N)).filter(Boolean);if(z.length!==0){R.layers=z,R.stateDependentLayerIds&&(R.stateDependentLayers=R.stateDependentLayerIds.map(N=>z.filter(j=>j.id===N)[0]));for(const N of z)E[N.fqid]=R}}return E}(i.buckets,a.style),this.hasSymbolBuckets=!1;for(const b in this.buckets){const w=this.buckets[b];if(w instanceof r.aR){if(this.hasSymbolBuckets=!0,!m)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const b in this.buckets){const w=this.buckets[b];if(w instanceof r.aR&&w.hasRTLText){this.hasRTLText=!0,r.aS();break}}this.queryPadding=0;for(const b in this.buckets){const w=this.buckets[b],E=a.style.getOwnLayer(b);if(!E)continue;const R=E.queryRadius(w);this.queryPadding=Math.max(this.queryPadding,R)}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas),this._lastUpdatedBrightness=i.brightness}else this.collisionBoxArray=new r.aQ}unloadVectorData(){if(this.hasData()){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(i){return this.buckets[i.fqid]}upload(i){for(const b in this.buckets){const w=this.buckets[b];w.uploadPending()&&w.upload(i)}const a=i.gl,m=this.imageAtlas;if(m&&!m.uploaded){const b=!!Object.keys(m.patternPositions).length;this.imageAtlasTexture=new r.T(i,m.image,a.RGBA8,{useMipmap:b}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new r.T(i,this.glyphAtlasImage,a.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new r.T(i,this.lineAtlas.image,a.R8),this.lineAtlas.uploaded=!0)}prepare(i,a,m){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture,m),!a||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const b=a.style.getBrightness();(this._lastUpdatedBrightness||b)&&(this._lastUpdatedBrightness&&b&&Math.abs(this._lastUpdatedBrightness-b)<.001||(this._lastUpdatedBrightness=b,this.updateBuckets(a)))}queryRenderedFeatures(i,a,m,b,w,E,R,z){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:b,pixelPosMatrix:R,transform:E,params:w,tileTransform:this.tileTransform},i,a,m):{}}querySourceFeatures(i,a){const m=this.latestFeatureIndex;if(!m||!m.rawTileData)return;const b=m.loadVTLayers(),w=a?a.sourceLayer:"",E=b._geojsonTileLayer||b[w];if(!E)return;const R=r.aT(a&&a.filter),{z,x:N,y:j}=this.tileID.canonical,X={z,x:N,y:j};for(let K=0;K<E.length;K++){const Q=E.feature(K);if(R.needGeometry){const _e=r.aU(Q,!0);if(!R.filter(new r.a3(this.tileID.overscaledZ),_e,this.tileID.canonical))continue}else if(!R.filter(new r.a3(this.tileID.overscaledZ),Q))continue;const he=m.getId(Q,w),me=new r.aV(Q,z,N,j,he);me.tile=X,i.push(me)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const a=this.expirationTime;if(i.cacheControl){const m=r.aW(i.cacheControl);m["max-age"]&&(this.expirationTime=Date.now()+1e3*m["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const m=Date.now();let b=!1;if(this.expirationTime>m)b=!1;else if(a)if(this.expirationTime<a)b=!0;else{const w=this.expirationTime-a;w?this.expirationTime=m+Math.max(w,3e4):b=!0}else b=!0;b?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(i,a){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(i).length!==0&&a&&this.updateBuckets(a)}updateBuckets(i){if(!this.latestFeatureIndex)return;const a=this.latestFeatureIndex.loadVTLayers(),m=i.style.listImages(),b=i.style.getBrightness();for(const w in this.buckets){if(!i.style.hasLayer(w))continue;const E=this.buckets[w],R=E.layers[0].sourceLayer||"_geojsonTileLayer",z=a[R],N=i.style.getOwnSourceCache(E.layers[0].source);let j={};N&&(j=N._state.getState(R,void 0)),E.update(j,z,m,this.imageAtlas&&this.imageAtlas.patternPositions||{},b),(E instanceof r.aX||E instanceof r.aY)&&i._terrain&&i._terrain.enabled&&N&&E.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(N.id,this.tileID);const X=i&&i.style&&i.style.getOwnLayer(w);X&&(this.queryPadding=Math.max(this.queryPadding,X.queryRadius(E)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<r.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=r.q.now()+i}setTexture(i,a){const m=a.context,b=m.gl;this.texture=this.texture||a.getTileTexture(i.width),this.texture&&this.texture instanceof r.T?this.texture.update(i):(this.texture=new r.T(m,i,b.RGBA8,{useMipmap:!0}),this.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE))}setDependencies(i,a){const m={};for(const b of a)m[b]=!0;this.dependencies[i]=m}hasDependency(i,a){for(const m of i){const b=this.dependencies[m];if(b){for(const w of a)if(b[w])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,a){if(!a||a.name==="mercator"||this._tileDebugBuffer)return;const m=r.aZ(Sa,this.tileID.canonical,this.tileTransform)[0],b=new r.a_,w=new r.a$;for(let E=0;E<m.length;E++){const{x:R,y:z}=m[E];b.emplaceBack(R,z),w.emplaceBack(E)}w.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(w),this._tileDebugBuffer=i.createVertexBuffer(b,r.b0.members),this._tileDebugSegments=r.b1.simpleSegment(0,0,b.length,w.length)}_makeTileBoundsBuffers(i,a){if(this._tileBoundsBuffer||!a||a.name==="mercator")return;const m=r.aZ(Sa,this.tileID.canonical,this.tileTransform)[0];let b,w;if(this.isRaster){const E=function(R,z){const N=r.aK(R,z),j=Math.pow(2,R.z);for(let _e=0;_e<ns;_e++)for(let ve=0;ve<ns;ve++){const ke=r.aL((R.x+(ve+is(ve))/Fo)/j),De=r.aM((R.y+(_e+is(_e))/Fo)/j),Pe=z.project(ke,De),Fe=_e*ns+ve;Co[2*Fe+0]=Math.round((Pe.x*N.scale-N.x)*r.ab),Co[2*Fe+1]=Math.round((Pe.y*N.scale-N.y)*r.ab)}Ur.fill(0),ho.fill(0);for(let _e=2045;_e>=0;_e--){const ve=4*_e,ke=_o[ve+0],De=_o[ve+1],Pe=_o[ve+2],Fe=_o[ve+3],ze=ke+Pe>>1,qe=De+Fe>>1,$e=ze+qe-De,We=qe+ke-ze,nt=De*ns+ke,Ke=Fe*ns+Pe,Ye=qe*ns+ze,ft=Math.hypot((Co[2*nt+0]+Co[2*Ke+0])/2-Co[2*Ye+0],(Co[2*nt+1]+Co[2*Ke+1])/2-Co[2*Ye+1])>=16;Ur[Ye]=Ur[Ye]||(ft?1:0),_e<1022&&(Ur[Ye]=Ur[Ye]||Ur[(De+We>>1)*ns+(ke+$e>>1)]||Ur[(Fe+We>>1)*ns+(Pe+$e>>1)])}const X=new r.aN,K=new r.aO;let Q=0;function he(_e,ve){const ke=ve*ns+_e;return ho[ke]===0&&(X.emplaceBack(Co[2*ke+0],Co[2*ke+1],_e*r.ab/Fo,ve*r.ab/Fo),ho[ke]=++Q),ho[ke]-1}function me(_e,ve,ke,De,Pe,Fe){const ze=_e+ke>>1,qe=ve+De>>1;if(Math.abs(_e-Pe)+Math.abs(ve-Fe)>1&&Ur[qe*ns+ze])me(Pe,Fe,_e,ve,ze,qe),me(ke,De,Pe,Fe,ze,qe);else{const $e=he(_e,ve),We=he(ke,De),nt=he(Pe,Fe);K.emplaceBack($e,We,nt)}}return me(0,0,Fo,Fo,Fo,0),me(Fo,Fo,0,0,0,Fo),{vertices:X,indices:K}}(this.tileID.canonical,a);b=E.vertices,w=E.indices}else{b=new r.aN,w=new r.aO;for(const{x:R,y:z}of m)b.emplaceBack(R,z,0,0);const E=r.b2(b.int16,void 0,4);for(let R=0;R<E.length;R+=3)w.emplaceBack(E[R],E[R+1],E[R+2])}this._tileBoundsBuffer=i.createVertexBuffer(b,r.b3.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(w),this._tileBoundsSegments=r.b1.simpleSegment(0,0,b.length,w.length)}_makeGlobeTileDebugBuffers(i,a){const m=a.projection;if(!m||m.name!=="globe"||a.freezeTileCoverage)return;const b=this.tileID.canonical,w=r.b4(b,a),E=r.b5(w),R=r.a9(a.zoom);let z;R>0&&(z=r.a6.mat4.invert(new Float64Array(16),a.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(i,b,a,E,z,R),this._makeGlobeTileDebugTextBuffer(i,b,a,E,z,R)}_globePoint(i,a,m,b,w,E,R){let z=r.b6(i,a,m);if(E){const N=1<<m.z,j=r.am(b.center.lng),X=r.at(b.center.lat),K=(m.x+.5)/N-j;let Q=0;K>.5?Q=-1:K<-.5&&(Q=1);let he=(i/r.ab+m.x)/N+Q,me=(a/r.ab+m.y)/N;he=(he-j)*b._pixelsPerMercatorPixel+j,me=(me-X)*b._pixelsPerMercatorPixel+X;const _e=[he*b.worldSize,me*b.worldSize,0];r.a6.vec3.transformMat4(_e,_e,E),z=r.b7(z,_e,R)}return r.a6.vec3.transformMat4(z,z,w)}_makeGlobeTileDebugBorderBuffer(i,a,m,b,w,E){const R=new r.a_,z=new r.a$,N=new r.b8,j=(K,Q,he,me,_e)=>{const ve=(he-K)/(_e-1),ke=(me-Q)/(_e-1),De=R.length;for(let Pe=0;Pe<_e;Pe++){const Fe=K+Pe*ve,ze=Q+Pe*ke;R.emplaceBack(Fe,ze);const qe=this._globePoint(Fe,ze,a,m,b,w,E);N.emplaceBack(qe[0],qe[1],qe[2]),z.emplaceBack(De+Pe)}},X=r.ab;j(0,0,X,0,16),j(X,0,X,X,16),j(X,X,0,X,16),j(0,X,0,0,16),this._tileDebugIndexBuffer=i.createIndexBuffer(z),this._tileDebugBuffer=i.createVertexBuffer(R,r.b0.members),this._globeTileDebugBorderBuffer=i.createVertexBuffer(N,r.b9.members),this._tileDebugSegments=r.b1.simpleSegment(0,0,R.length,z.length)}_makeGlobeTileDebugTextBuffer(i,a,m,b,w,E){const R=r.ab/4,z=new r.a_,N=new r.aO,j=new r.b8,X=25;N.reserve(32),z.reserve(X),j.reserve(X);const K=(Q,he)=>X*Q+he;for(let Q=0;Q<X;Q++){const he=Q*R;for(let me=0;me<X;me++){const _e=me*R;z.emplaceBack(_e,he);const ve=this._globePoint(_e,he,a,m,b,w,E);j.emplaceBack(ve[0],ve[1],ve[2])}}for(let Q=0;Q<4;Q++)for(let he=0;he<4;he++){const me=K(Q,he),_e=K(Q,he+1),ve=K(Q+1,he),ke=K(Q+1,he+1);N.emplaceBack(me,_e,ve),N.emplaceBack(ve,_e,ke)}this._tileDebugTextIndexBuffer=i.createIndexBuffer(N),this._tileDebugTextBuffer=i.createVertexBuffer(z,r.b0.members),this._globeTileDebugTextBuffer=i.createVertexBuffer(j,r.b9.members),this._tileDebugTextSegments=r.b1.simpleSegment(0,0,X,32)}destroy(i=!1){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!i&&this.texture&&this.texture instanceof r.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}r.ba.setPbf(r.bb);class sr extends cs{constructor(i,a,m,b,w){super(i,a,m,b,w),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(i,a){const m=a.context,b=m.gl;this.texture=this.texture||a.getTileTexture(i.width),this.texture&&this.texture instanceof r.T?this.texture.update(i,{premultiply:!1}):this.texture=new r.T(m,i,b.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(i=16384,a){const m=this._mrt=new r.ba(30),b=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(i-1)}});return this.entireBuffer=null,this.request=r.bc(b,(w,E,R,z)=>{if(w)a(w);else try{const N=m.getHeaderLength(E);if(N>i)return void(this.request=this.fetchHeader(N,a));m.parseHeader(E),this._isHeaderLoaded=!0;let j=0;for(const X of Object.values(m.layers))j=Math.max(j,X.dataIndex[X.dataIndex.length-1].last_byte);E.byteLength>=j&&(this.entireBuffer=E),a(null,this.entireBuffer||E,R,z)}catch(N){a(N)}}),this.request}fetchBand(i,a,m){const b=this._mrt;if(!this._isHeaderLoaded||!b)return void m(new Error("Tile header is not ready"));const w=this.actor;if(!w)return void m(new Error("Can't fetch tile band without an actor"));let E;const R=(X,K)=>{E.complete(X,K),X?m(X):(this.updateTextureDescriptor(i,a),m(null,this.textureDescriptor&&this.textureDescriptor.img))},z=(X,K)=>{if(X)return m(X);const Q=w.send("decodeRasterArray",{buffer:K,task:E},R,void 0,!0);this._workQueue.push(()=>{Q&&Q.cancel(),E.cancel()})},N=b.getLayer(i);if(!N)return void m(new Error(`Unknown sourceLayer "${i}"`));if(N.hasDataForBand(a))return this.updateTextureDescriptor(i,a),void m(null,this.textureDescriptor?this.textureDescriptor.img:null);const j=N.getDataRange([a]);if(E=b.createDecodingTask(j),!E||E.tasks.length)if(this.flushQueues(),this.entireBuffer)z(null,this.entireBuffer.slice(j.firstByte,j.lastByte+1));else{const X=Object.assign({},this.requestParams,{headers:{Range:`bytes=${j.firstByte}-${j.lastByte}`}}),K=r.bc(X,z);this._fetchQueue.push(()=>{K.cancel(),E.cancel()})}else m(null)}updateNeeded(i,a){return(!this.textureDescriptor||this.textureDescriptor.band!==a||this.textureDescriptor.layer!==i)&&this.state!=="errored"}updateTextureDescriptor(i,a){if(!this._mrt)return;const m=this._mrt.getLayer(i);if(!m||!m.hasBand(a)||!m.hasDataForBand(a))return;const{bytes:b,tileSize:w,buffer:E,offset:R,scale:z}=m.getBandView(a),N=w+2*E,j={data:b,width:N,height:N},X=this.texture;X&&X instanceof r.T&&X.update(j,{premultiply:!1}),this.textureDescriptor={layer:i,band:a,img:j,buffer:E,offset:R,tileSize:w,format:m.pixelFormat,mix:[z,256*z,65536*z,16777216*z]}}}class $a{constructor(i,a){this.max=i,this.onRemove=a,this.reset()}reset(){for(const i in this.data)for(const a of this.data[i])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(i,a,m){const b=i.wrapped().key;this.data[b]===void 0&&(this.data[b]=[]);const w={value:a,timeout:void 0};if(m!==void 0&&(w.timeout=setTimeout(()=>{this.remove(i,w)},m)),this.data[b].push(w),this.order.push(b),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const a=this.data[i].shift();return a.timeout&&clearTimeout(a.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),a.value}getByKey(i){const a=this.data[i];return a?a[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,a){if(!this.has(i))return this;const m=i.wrapped().key,b=a===void 0?0:this.data[m].indexOf(a),w=this.data[m][b];return this.data[m].splice(b,1),w.timeout&&clearTimeout(w.timeout),this.data[m].length===0&&delete this.data[m],this.onRemove(w.value),this.order.splice(this.order.indexOf(m),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(i){const a=[];for(const m in this.data)for(const b of this.data[m])i(b.value)||a.push(b);for(const m of a)this.remove(m.value.tileID,m)}}class na{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,a,m){const b=String(a);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][b]=this.stateChanges[i][b]||{},r.l(this.stateChanges[i][b],m),this.deletedStates[i]===null){this.deletedStates[i]={};for(const w in this.state[i])w!==b&&(this.deletedStates[i][w]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][b]===null){this.deletedStates[i][b]={};for(const w in this.state[i][b])m[w]||(this.deletedStates[i][b][w]=null)}else for(const w in m)this.deletedStates[i]&&this.deletedStates[i][b]&&this.deletedStates[i][b][w]===null&&delete this.deletedStates[i][b][w]}removeFeatureState(i,a,m){if(this.deletedStates[i]===null)return;const b=String(a);if(this.deletedStates[i]=this.deletedStates[i]||{},m&&a!==void 0)this.deletedStates[i][b]!==null&&(this.deletedStates[i][b]=this.deletedStates[i][b]||{},this.deletedStates[i][b][m]=null);else if(a!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][b])for(m in this.deletedStates[i][b]={},this.stateChanges[i][b])this.deletedStates[i][b][m]=null;else this.deletedStates[i][b]=null;else this.deletedStates[i]=null}getState(i,a){const m=this.state[i]||{},b=this.stateChanges[i]||{},w=this.deletedStates[i];if(w===null)return{};if(a!==void 0){const R=String(a),z=r.l({},m[R],b[R]);if(w){const N=w[a];if(N===null)return{};for(const j in N)delete z[j]}return z}const E=r.l({},m,b);if(w)for(const R in w)delete E[R];return E}initializeTileState(i,a){i.setFeatureState(this.state,a)}coalesceChanges(i,a){const m={};for(const b in this.stateChanges){this.state[b]=this.state[b]||{};const w={};for(const E in this.stateChanges[b])this.state[b][E]||(this.state[b][E]={}),r.l(this.state[b][E],this.stateChanges[b][E]),w[E]=this.state[b][E];m[b]=w}for(const b in this.deletedStates){this.state[b]=this.state[b]||{};const w={};if(this.deletedStates[b]===null)for(const E in this.state[b])w[E]={},this.state[b][E]={};else for(const E in this.deletedStates[b]){if(this.deletedStates[b][E]===null)this.state[b][E]={};else if(this.state[b][E])for(const R of Object.keys(this.deletedStates[b][E]))delete this.state[b][E][R];w[E]=this.state[b][E]}m[b]=m[b]||{},r.l(m[b],w)}if(this.stateChanges={},this.deletedStates={},Object.keys(m).length!==0)for(const b in i)i[b].setFeatureState(m,a)}}class to extends r.E{constructor(i,a,m){super(),this.id=i,this._onlySymbols=m,a.on("data",b=>{b.dataType==="source"&&b.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&b.dataType==="source"&&b.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new $a(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new na,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(i){this.map=i,this._minTileCacheSize=this._minTileCacheSize===void 0&&i?i._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&i?i._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles){const a=this._tiles[i];if(a.state!=="loaded"&&a.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,a){return i.isSymbolTile=this._onlySymbols,i.isExtraShadowCaster=this._shadowCasterTiles[i.tileID.key],this._source.loadTile(i,a)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i)}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i)}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const m=this._tiles[a];m.upload(i),m.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return r.bd(this._tiles).map(i=>i.tileID).sort(Ns).map(i=>i.key)}getRenderableIds(i,a){const m=[];for(const b in this._tiles)this._isIdRenderable(+b,i,a)&&m.push(this._tiles[b]);return i?m.sort((b,w)=>{const E=b.tileID,R=w.tileID,z=new r.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle),N=new r.P(R.canonical.x,R.canonical.y)._rotate(this.transform.angle);return E.overscaledZ-R.overscaledZ||N.y-z.y||N.x-z.x}).map(b=>b.tileID.key):m.map(b=>b.tileID).sort(Ns).map(b=>b.key)}hasRenderableParent(i){const a=this.findLoadedParent(i,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(i,a,m){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(a||!this._tiles[i].holdingForFade())&&(m||!this._shadowCasterTiles[i])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(+i,"reloading")}}_reloadTile(i,a){const m=this._tiles[i];m&&(m.state!=="loading"&&(m.state=a),this._loadTile(m,this._tileLoaded.bind(this,m,i,a)))}_tileLoaded(i,a,m,b){if(b)if(i.state="errored",b.status!==404)this._source.fire(new r.t(b,{tile:i}));else{if(this._source.fire(new r.x("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:i})),!(i.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const w=this.map.painter.terrain;this.update(this.transform,w.getScaledDemTileSize(),!0),w.resetTileLookupCache(this.id)}else this.update(this.transform)}else i.timeAdded=r.q.now(),m==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(a,i),this._source.type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new r.x("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const a=this.getRenderableIds();for(let b=0;b<a.length;b++){const w=a[b];if(i.neighboringTiles&&i.neighboringTiles[w]){const E=this.getTileByID(w);m(i,E),m(E,i)}}function m(b,w){if(!b.dem||b.dem.borderReady)return;b.needsHillshadePrepare=!0,b.needsDEMTextureUpload=!0;let E=w.tileID.canonical.x-b.tileID.canonical.x;const R=w.tileID.canonical.y-b.tileID.canonical.y,z=Math.pow(2,b.tileID.canonical.z),N=w.tileID.key;E===0&&R===0||Math.abs(R)>1||(Math.abs(E)>1&&(Math.abs(E+z)===1?E+=z:Math.abs(E-z)===1&&(E-=z)),w.dem&&b.dem&&(b.dem.backfillBorder(w.dem,E,R),b.neighboringTiles&&b.neighboringTiles[N]&&(b.neighboringTiles[N].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,a,m,b){for(const w in this._tiles){let E=this._tiles[w];if(b[w]||!E.hasData()||E.tileID.overscaledZ<=a||E.tileID.overscaledZ>m)continue;let R=E.tileID;for(;E&&E.tileID.overscaledZ>a+1;){const N=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[N.key],E&&E.hasData()&&(R=N)}let z=R;for(;z.overscaledZ>a;)if(z=z.scaledTo(z.overscaledZ-1),i[z.key]){b[R.key]=R;break}}}findLoadedParent(i,a){if(i.key in this._loadedParentTiles){const m=this._loadedParentTiles[i.key];return m&&m.tileID.overscaledZ>=a?m:null}for(let m=i.overscaledZ-1;m>=a;m--){const b=i.scaledTo(m),w=this._getLoadedTile(b);if(w)return w}}_getLoadedTile(i){const a=this._tiles[i.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,a){a=a||this._source.tileSize;const m=Math.ceil(i.width/a)+1,b=Math.ceil(i.height/a)+1,w=Math.floor(m*b*5),E=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,w):w,R=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,E):E;this._cache.setMaxSize(R)}handleWrapJump(i){const a=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,a){const m={};for(const b in this._tiles){const w=this._tiles[b];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+a),m[w.tileID.key]=w}this._tiles=m;for(const b in this._timers)clearTimeout(this._timers[b]),delete this._timers[b];for(const b in this._tiles)this._setTileReloadTimer(+b,this._tiles[b])}}update(i,a,m,b){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!m)return;this.updateCacheSize(i,a),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const w=this._source.type==="batched-model";let E;if(this.used||this.usedForTerrain){if(this._source.tileID)E=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(N=>new r.aA(N.canonical.z,N.wrap,N.canonical.z,N.canonical.x,N.canonical.y));else if(this.tileCoverLift!==0){const N=i.clone();N.tileCoverLift=this.tileCoverLift,E=N.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!m,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:w}),this._source.minzoom<=1&&i.projection.name==="globe"&&(E.push(new r.aA(1,0,1,0,0)),E.push(new r.aA(1,0,1,1,0)),E.push(new r.aA(1,0,1,0,1)),E.push(new r.aA(1,0,1,1,1)))}else if(E=i.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!m,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:w}),this._source.hasTile){const N=this._source.hasTile.bind(this._source);E=E.filter(j=>N(j))}}else E=[];if(E.length>0&&this.castsShadows&&b&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!ia(this._source.type)){const N=i.coveringZoomLevel({tileSize:a||this._source.tileSize,roundZoom:this._source.roundZoom&&!m}),j=Math.min(N,this._source.maxzoom);if(w){const X=i.extendTileCover(E,j);for(const K of X)E.push(K)}else{const X=i.extendTileCover(E,j,b);for(const K of X)this._shadowCasterTiles[K.key]=!0,E.push(K)}}const R=this._updateRetainedTiles(E);if(ia(this._source.type)&&E.length!==0){const N={},j={},X=Object.keys(R);for(const Q of X){const he=R[Q],me=this._tiles[Q];if(!me||me.fadeEndTime&&me.fadeEndTime<=r.q.now())continue;const _e=this.findLoadedParent(he,Math.max(he.overscaledZ-to.maxOverzooming,this._source.minzoom));_e&&(this._addTile(_e.tileID),N[_e.tileID.key]=_e.tileID),j[Q]=he}const K=E[E.length-1].overscaledZ;for(const Q in this._tiles){const he=this._tiles[Q];if(R[Q]||!he.hasData())continue;let me=he.tileID;for(;me.overscaledZ>K;){me=me.scaledTo(me.overscaledZ-1);const _e=this._tiles[me.key];if(_e&&_e.hasData()&&j[me.key]){R[Q]=he.tileID;break}}}for(const Q in N)R[Q]||(this._coveredTiles[Q]=!0,R[Q]=N[Q])}for(const N in R)this._tiles[N].clearFadeHold();const z=r.be(this._tiles,R);for(const N of z){const j=this._tiles[N];j.hasSymbolBuckets&&!j.holdingForFade()?j.setHoldDuration(this.map._fadeDuration):j.hasSymbolBuckets&&!j.symbolFadeFinished()||this._removeTile(+N)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const a={};if(i.length===0)return a;const m={},b=i.reduce((N,j)=>Math.min(N,j.overscaledZ),1/0),w=i[0].overscaledZ,E=Math.max(w-to.maxOverzooming,this._source.minzoom),R=Math.max(w+to.maxUnderzooming,this._source.minzoom),z={};for(const N of i){const j=this._addTile(N);a[N.key]=N,j.hasData()||b<this._source.maxzoom&&(z[N.key]=N)}this._retainLoadedChildren(z,b,R,a);for(const N of i){let j=this._tiles[N.key];if(j.hasData())continue;if(N.canonical.z>=this._source.maxzoom){const K=N.children(this._source.maxzoom)[0],Q=this.getTile(K);if(Q&&Q.hasData()){a[K.key]=K;continue}}else{const K=N.children(this._source.maxzoom);if(a[K[0].key]&&a[K[1].key]&&a[K[2].key]&&a[K[3].key])continue}let X=j.wasRequested();for(let K=N.overscaledZ-1;K>=E;--K){const Q=N.scaledTo(K);if(m[Q.key]||(m[Q.key]=!0,j=this.getTile(Q),!j&&X&&(j=this._addTile(Q)),j&&(a[Q.key]=Q,X=j.wasRequested(),j.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const a=[];let m,b=this._tiles[i].tileID;for(;b.overscaledZ>0;){if(b.key in this._loadedParentTiles){m=this._loadedParentTiles[b.key];break}a.push(b.key);const w=b.scaledTo(b.overscaledZ-1);if(m=this._getLoadedTile(w),m)break;b=w}for(const w of a)this._loadedParentTiles[w]=m}}_addTile(i){let a=this._tiles[i.key];if(a)return a.isExtraShadowCaster!==!0||this._shadowCasterTiles[i.key]||this._reloadTile(i.key,"reloading"),a;a=this._cache.getAndRemove(i),a&&(this._setTileReloadTimer(i.key,a),a.tileID=i,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,a)));const m=!!a;if(!m){const b=this.map?this.map.painter:null,w=this._source.tileSize*i.overscaleFactor();a=this._source.type==="raster-array"?new sr(i,w,this.transform.tileZoom,b,this._isRaster):new cs(i,w,this.transform.tileZoom,b,this._isRaster),this._loadTile(a,this._tileLoaded.bind(this,a,i.key,a.state))}return a?(a.uses++,this._tiles[i.key]=a,m||this._source.fire(new r.x("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a):null}_setTileReloadTimer(i,a){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const m=a.getExpiryTimeout();m&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},m))}_removeTile(i){const a=this._tiles[i];a&&(a.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),a.uses>0||(a.hasData()&&a.state!=="reloading"||a.state==="empty"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(i,a,m){const b=[],w=this.transform;if(!w)return b;const E=w.projection.name==="globe",R=r.am(w.center.lng);for(const z in this._tiles){const N=this._tiles[z];if(m&&N.clearQueryDebugViz(),N.holdingForFade())continue;let j;if(E){const X=N.tileID.canonical;if(X.z===0){const K=[Math.abs(r.ap(R,...As(X,-1))-R),Math.abs(r.ap(R,...As(X,1))-R)];j=[0,2*K.indexOf(Math.min(...K))-1]}else{const K=[Math.abs(r.ap(R,...As(X,-1))-R),Math.abs(r.ap(R,...As(X,0))-R),Math.abs(r.ap(R,...As(X,1))-R)];j=[K.indexOf(Math.min(...K))-1]}}else j=[0];for(const X of j){const K=i.containsTile(N,w,a,X);K&&b.push(K)}}return b}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(i){return this._getRenderableCoordinates(i)}_getRenderableCoordinates(i,a){const m=this.getRenderableIds(i,a).map(w=>this._tiles[w].tileID),b=this.transform.projection.name==="globe";for(const w of m)w.projMatrix=this.transform.calculateProjMatrix(w.toUnwrapped()),w.expandedProjMatrix=b?this.transform.calculateProjMatrix(w.toUnwrapped(),!1,!0):w.projMatrix;return m}sortCoordinatesByDistance(i){const a=i.slice(),m=this.transform._camera.position,b=this.transform._camera.forward(),w={};for(const E of a){const R=1/(1<<E.canonical.z);w[E.key]=((E.canonical.x+.5)*R+E.wrap-m[0])*b[0]+((E.canonical.y+.5)*R-m[1])*b[1]-m[2]*b[2]}return a.sort((E,R)=>w[E.key]-w[R.key]),a}hasTransition(){if(this._source.hasTransition())return!0;if(ia(this._source.type))for(const i in this._tiles){const a=this._tiles[i];if(a.fadeEndTime!==void 0&&a.fadeEndTime>=r.q.now())return!0}return!1}setFeatureState(i,a,m){this._state.updateState(i=i||"_geojsonTileLayer",a,m)}removeFeatureState(i,a,m){this._state.removeFeatureState(i=i||"_geojsonTileLayer",a,m)}getFeatureState(i,a){return this._state.getState(i=i||"_geojsonTileLayer",a)}setDependencies(i,a,m){const b=this._tiles[i];b&&b.setDependencies(a,m)}reloadTilesForDependencies(i,a){for(const m in this._tiles)this._tiles[m].hasDependency(i,a)&&this._reloadTile(+m,"reloading");this._cache.filter(m=>!m.hasDependency(i,a))}_preloadTiles(i,a){if(!this._sourceLoaded){const z=()=>{this._sourceLoaded&&(this._source.off("data",z),this._preloadTiles(i,a))};return void this._source.on("data",z)}const m=new Map,b=Array.isArray(i)?i:[i],w=this.map.painter.terrain,E=this.usedForTerrain&&w?w.getScaledDemTileSize():this._source.tileSize;for(const z of b){const N=z.coveringTiles({tileSize:E,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const j of N)m.set(j.key,j);this.usedForTerrain&&z.updateElevation(!1)}const R=Array.from(m.values());r.bf(R,(z,N)=>{const j=new cs(z,this._source.tileSize*z.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(j,X=>{this._source.type==="raster-dem"&&j.dem&&this._backfillDEM(j),N(X,j)})},a)}}function Ns(p,i){const a=Math.abs(2*p.wrap)-+(p.wrap<0),m=Math.abs(2*i.wrap)-+(i.wrap<0);return p.overscaledZ-i.overscaledZ||m-a||i.canonical.y-p.canonical.y||i.canonical.x-p.canonical.x}function ia(p){return p==="raster"||p==="image"||p==="video"||p==="custom"}function As(p,i){const a=1<<p.z;return[p.x/a+i,(p.x+1)/a+i]}to.maxOverzooming=10,to.maxUnderzooming=3;class Us{constructor(i){this.style=i,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const i=!1,a=!1;for(const m in this.style._mergedLayers){const b=this.style._mergedLayers[m];if(b.type==="fill-extrusion")this.layers.push({layer:b,visible:i,visibilityChanged:a});else if(b.type==="model"){const w=this.style.getLayerSource(b);w&&w.type==="batched-model"&&this.layers.push({layer:b,visible:i,visibilityChanged:a})}}}onNewFrame(i){this.layersGotHidden=!1;for(const a of this.layers){const m=a.layer;let b=!1;m.type==="fill-extrusion"?b=!m.isHidden(i)&&m.paint.get("fill-extrusion-opacity")>0:m.type==="model"&&(b=!m.isHidden(i)&&m.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!b&&a.visible,a.visible=b}}updateZOffset(i,a){this.currentBuildingBuckets=[];for(const b of this.layers){const w=b.layer,E=this.style.getLayerSourceCache(w);let R=1;w.type==="fill-extrusion"&&(R=b.visible?w.paint.get("fill-extrusion-vertical-scale"):0);let z=E?E.getTile(a):null;if(!z&&E&&a.canonical.z>E.getSource().minzoom){let N=a.scaledTo(Math.min(E.getSource().maxzoom,a.overscaledZ-1));for(;N.overscaledZ>=E.getSource().minzoom&&(z=E.getTile(N),!z&&N.overscaledZ!==0);)N=N.scaledTo(N.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:z?z.getBucket(w):null,tileID:z?z.tileID:a,verticalScale:R})}i.hasAnyZOffset=!1;let m=!1;for(let b=0;b<i.symbolInstances.length;b++){const w=i.symbolInstances.get(b),E=w.zOffset,R=this._getHeightAtTileOffset(a,w.tileAnchorX,w.tileAnchorY);w.zOffset=R!==Number.NEGATIVE_INFINITY?R:E,m||E===w.zOffset||(m=!0),i.hasAnyZOffset||w.zOffset===0||(i.hasAnyZOffset=!0)}m&&(i.zOffsetBuffersNeedUpload=!0,i.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(i,a,m,b){let w=a,E=m;if(i.canonical.z!==b.canonical.z){const R=b.canonical,z=1/(1<<i.canonical.z-R.z);w=(a+i.canonical.x*r.ab)*z-R.x*r.ab|0,E=(m+i.canonical.y*r.ab)*z-R.y*r.ab|0}return{tileX:w,tileY:E}}_getHeightAtTileOffset(i,a,m){let b,w;for(let E=0;E<this.layers.length;++E){if(this.layers[E].layer.type!=="fill-extrusion")continue;const{bucket:R,tileID:z,verticalScale:N}=this.currentBuildingBuckets[E];if(!R)continue;const{tileX:j,tileY:X}=this._mapCoordToOverlappingTile(i,a,m,z),K=R.getHeightAtTileCoord(j,X);K&&K.height!==void 0&&(K.hidden?b=K.height:w=Math.max(K.height*N,w||0))}if(w!==void 0)return w;for(let E=0;E<this.layers.length;++E){const R=this.layers[E];if(R.layer.type!=="model"||!R.visible)continue;const{bucket:z,tileID:N}=this.currentBuildingBuckets[E];if(!z)continue;const{tileX:j,tileY:X}=this._mapCoordToOverlappingTile(i,a,m,N),K=z.getHeightAtTileCoord(j,X);if(K&&!K.hidden)return K.height===void 0&&b!==void 0?Math.min(K.maxHeight,b)*K.verticalScale:K.height?K.height*K.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function ra(p,i){const a={};for(const m in p)m!=="ref"&&(a[m]=p[m]);return r.bg.forEach(m=>{m in i&&(a[m]=i[m])}),a}function bl(p){p=p.slice();const i=Object.create(null);for(let a=0;a<p.length;a++)i[p[a].id]=p[a];for(let a=0;a<p.length;a++)"ref"in p[a]&&(p[a]=ra(p[a],i[p[a].ref]));return p}const st={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function en(p,i,a){a.push({command:st.addSource,args:[p,i[p]]})}function tn(p,i,a){i.push({command:st.removeSource,args:[p]}),a[p]=!0}function xi(p,i,a,m){tn(p,a,m),en(p,i,a)}function In(p,i,a){let m;for(m in p[a])if(p[a].hasOwnProperty(m)&&m!=="data"&&!r.bh(p[a][m],i[a][m]))return!1;for(m in i[a])if(i[a].hasOwnProperty(m)&&m!=="data"&&!r.bh(p[a][m],i[a][m]))return!1;return!0}function ar(p,i,a,m,b,w){let E;for(E in i=i||{},p=p||{})p.hasOwnProperty(E)&&(r.bh(p[E],i[E])||a.push({command:w,args:[m,E,i[E],b]}));for(E in i)i.hasOwnProperty(E)&&!p.hasOwnProperty(E)&&(r.bh(p[E],i[E])||a.push({command:w,args:[m,E,i[E],b]}))}function Mr(p){return p.id}function fr(p,i){return p[i.id]=i,p}class Yr{constructor(i,a){this.reset(i,a)}reset(i,a){this.points=i||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=r.ap(i,0,1);let a=1,m=this._distances[a];const b=i*this.paddedLength+this.padding;for(;m<b&&a<this._distances.length;)m=this._distances[++a];const w=a-1,E=this._distances[w],R=m-E,z=R>0?(b-E)/R:0;return this.points[w].mult(1-z).add(this.points[a].mult(z))}}class Er{constructor(i,a,m){const b=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(i/m),this.yCellCount=Math.ceil(a/m);for(let E=0;E<this.xCellCount*this.yCellCount;E++)b.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=a,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,a,m,b,w){this._forEachCell(a,m,b,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(a),this.bboxes.push(m),this.bboxes.push(b),this.bboxes.push(w)}insertCircle(i,a,m,b){this._forEachCell(a-b,m-b,a+b,m+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(a),this.circles.push(m),this.circles.push(b)}_insertBoxCell(i,a,m,b,w,E){this.boxCells[w].push(E)}_insertCircleCell(i,a,m,b,w,E){this.circleCells[w].push(E)}_query(i,a,m,b,w,E){if(m<0||i>this.width||b<0||a>this.height)return!w&&[];const R=[];if(i<=0&&a<=0&&this.width<=m&&this.height<=b){if(w)return!0;for(let z=0;z<this.boxKeys.length;z++)R.push({key:this.boxKeys[z],x1:this.bboxes[4*z],y1:this.bboxes[4*z+1],x2:this.bboxes[4*z+2],y2:this.bboxes[4*z+3]});for(let z=0;z<this.circleKeys.length;z++){const N=this.circles[3*z],j=this.circles[3*z+1],X=this.circles[3*z+2];R.push({key:this.circleKeys[z],x1:N-X,y1:j-X,x2:N+X,y2:j+X})}return E?R.filter(E):R}return this._forEachCell(i,a,m,b,this._queryCell,R,{hitTest:w,seenUids:{box:{},circle:{}}},E),w?R.length>0:R}_queryCircle(i,a,m,b,w){const E=i-m,R=i+m,z=a-m,N=a+m;if(R<0||E>this.width||N<0||z>this.height)return!b&&[];const j=[];return this._forEachCell(E,z,R,N,this._queryCellCircle,j,{hitTest:b,circle:{x:i,y:a,radius:m},seenUids:{box:{},circle:{}}},w),b?j.length>0:j}query(i,a,m,b,w){return this._query(i,a,m,b,!1,w)}hitTest(i,a,m,b,w){return this._query(i,a,m,b,!0,w)}hitTestCircle(i,a,m,b){return this._queryCircle(i,a,m,!0,b)}_queryCell(i,a,m,b,w,E,R,z){const N=R.seenUids,j=this.boxCells[w];if(j!==null){const K=this.bboxes;for(const Q of j)if(!N.box[Q]){N.box[Q]=!0;const he=4*Q;if(i<=K[he+2]&&a<=K[he+3]&&m>=K[he+0]&&b>=K[he+1]&&(!z||z(this.boxKeys[Q]))){if(R.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[Q],x1:K[he],y1:K[he+1],x2:K[he+2],y2:K[he+3]})}}}const X=this.circleCells[w];if(X!==null){const K=this.circles;for(const Q of X)if(!N.circle[Q]){N.circle[Q]=!0;const he=3*Q;if(this._circleAndRectCollide(K[he],K[he+1],K[he+2],i,a,m,b)&&(!z||z(this.circleKeys[Q]))){if(R.hitTest)return E.push(!0),!0;{const me=K[he],_e=K[he+1],ve=K[he+2];E.push({key:this.circleKeys[Q],x1:me-ve,y1:_e-ve,x2:me+ve,y2:_e+ve})}}}}}_queryCellCircle(i,a,m,b,w,E,R,z){const N=R.circle,j=R.seenUids,X=this.boxCells[w];if(X!==null){const Q=this.bboxes;for(const he of X)if(!j.box[he]){j.box[he]=!0;const me=4*he;if(this._circleAndRectCollide(N.x,N.y,N.radius,Q[me+0],Q[me+1],Q[me+2],Q[me+3])&&(!z||z(this.boxKeys[he])))return E.push(!0),!0}}const K=this.circleCells[w];if(K!==null){const Q=this.circles;for(const he of K)if(!j.circle[he]){j.circle[he]=!0;const me=3*he;if(this._circlesCollide(Q[me],Q[me+1],Q[me+2],N.x,N.y,N.radius)&&(!z||z(this.circleKeys[he])))return E.push(!0),!0}}}_forEachCell(i,a,m,b,w,E,R,z){const N=this._convertToXCellCoord(i),j=this._convertToYCellCoord(a),X=this._convertToXCellCoord(m),K=this._convertToYCellCoord(b);for(let Q=N;Q<=X;Q++)for(let he=j;he<=K;he++)if(w.call(this,i,a,m,b,this.xCellCount*he+Q,E,R,z))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,a,m,b,w,E){const R=b-i,z=w-a,N=m+E;return N*N>R*R+z*z}_circleAndRectCollide(i,a,m,b,w,E,R){const z=(E-b)/2,N=Math.abs(i-(b+z));if(N>z+m)return!1;const j=(R-w)/2,X=Math.abs(a-(w+j));if(X>j+m)return!1;if(N<=z||X<=j)return!0;const K=N-z,Q=X-j;return K*K+Q*Q<=m*m}}const rs={unknown:0,flipRequired:1,flipNotRequired:2},yn=Math.tan(85*Math.PI/180);function fi(p,i,a,m,b,w,E){const R=r.a6.mat4.create();if(a)if(w.name==="globe"){const z=r.bi(b,i);r.a6.mat4.multiply(R,R,z)}else{const z=r.a6.mat2.invert([],E);R[0]=z[0],R[1]=z[1],R[4]=z[2],R[5]=z[3],m||r.a6.mat4.rotateZ(R,R,b.angle)}else r.a6.mat4.multiply(R,b.labelPlaneMatrix,p);return R}function hi(p,i,a,m,b,w,E){const R=fi(p,i,a,m,b,w,E);return w.name==="globe"&&a||(R[2]=R[6]=R[10]=R[14]=0),R}function no(p,i,a,m,b,w,E){if(a){if(w.name==="globe"){const R=fi(p,i,a,m,b,w,E);return r.a6.mat4.invert(R,R),r.a6.mat4.multiply(R,p,R),R}{const R=r.a6.mat4.clone(p),z=r.a6.mat4.identity([]);return z[0]=E[0],z[1]=E[1],z[4]=E[2],z[5]=E[3],r.a6.mat4.multiply(R,R,z),m||r.a6.mat4.rotateZ(R,R,-b.angle),R}}return b.glCoordMatrix}function kr(p,i,a,m){const b=[p,i,a,1];a?r.a6.vec4.transformMat4(b,b,m):yi(b,b,m);const w=b[3];return b[0]/=w,b[1]/=w,b[2]/=w,b}function ri(p,i){return Math.min(.5+p/i*.5,1.5)}function oa(p,i){const a=p[0]/p[3],m=p[1]/p[3];return a>=-i[0]&&a<=i[0]&&m>=-i[1]&&m<=i[1]}function us(p,i,a,m,b,w,E,R,z,N){const j=a.transform,X=m?p.textSizeData:p.iconSizeData,K=r.bj(X,a.transform.zoom),Q=j.projection.name==="globe",he=[256/a.width*2+1,256/a.height*2+1],me=m?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;me.clear();let _e=null;Q&&(_e=m?p.text.globeExtVertexArray:p.icon.globeExtVertexArray);const ve=p.lineVertexArray,ke=m?p.text.placedSymbolArray:p.icon.placedSymbolArray,De=a.transform.width/a.transform.height;let Pe,Fe=!1;for(let ze=0;ze<ke.length;ze++){const qe=ke.get(ze),{numGlyphs:$e,writingMode:We}=qe;if(We!==r.bk.vertical||Fe||Pe===r.bk.horizontal||(Fe=!0),Pe=We,(qe.hidden||We===r.bk.vertical)&&!Fe){zi($e,me);continue}Fe=!1;const nt=new r.P(qe.tileAnchorX,qe.tileAnchorY);let{x:Ke,y:Ye,z:ft}=j.projection.projectTilePoint(nt.x,nt.y,N.canonical);if(z){const[Ut,qt,Fn]=z(nt);Ke+=Ut,Ye+=qt,ft+=Fn}const kt=[Ke,Ye,ft,1];if(r.a6.vec4.transformMat4(kt,kt,i),!oa(kt,he)){zi($e,me);continue}const jt=kt[3],Pt=ri(a.transform.getCameraToCenterDistance(j.projection),jt),nn=r.bl(X,K,qe),pt=E?nn/Pt:nn*Pt,Vt=kr(Ke,Ye,ft,b);if(Vt[3]<=0){zi($e,me);continue}let zt={};const sn=E?null:z,ln=Xe(qe,pt,!1,R,i,b,w,p.glyphOffsetArray,ve,me,_e,Vt,nt,zt,De,sn,j.projection,N,E);Fe=ln.useVertical,sn&&ln.needsFlipping&&(zt={}),(ln.notEnoughRoom||Fe||ln.needsFlipping&&Xe(qe,pt,!0,R,i,b,w,p.glyphOffsetArray,ve,me,_e,Vt,nt,zt,De,sn,j.projection,N,E).notEnoughRoom)&&zi($e,me)}m?(p.text.dynamicLayoutVertexBuffer.updateData(me),_e&&p.text.globeExtVertexBuffer&&p.text.globeExtVertexBuffer.updateData(_e)):(p.icon.dynamicLayoutVertexBuffer.updateData(me),_e&&p.icon.globeExtVertexBuffer&&p.icon.globeExtVertexBuffer.updateData(_e))}function pr(p,i,a,m,b,w,E,R,z,N,j,X,K,Q,he,me){const{lineStartIndex:_e,glyphStartIndex:ve,segment:ke}=R,De=ve+R.numGlyphs,Pe=_e+R.lineLength,Fe=i.getoffsetX(ve),ze=i.getoffsetX(De-1),qe=Hn(p*Fe,a,m,b,w,E,ke,_e,Pe,z,N,j,X,K,!0,Q,he,me);if(!qe)return null;const $e=Hn(p*ze,a,m,b,w,E,ke,_e,Pe,z,N,j,X,K,!0,Q,he,me);return $e?{first:qe,last:$e}:null}function vo(p,i,a,m){return p===r.bk.horizontal&&Math.abs(m)>Math.abs(a)?{useVertical:!0}:p===r.bk.vertical?m>0?{needsFlipping:!0}:null:i!==rs.unknown&&function(b,w){return b===0||Math.abs(w/b)>yn}(a,m)?i===rs.flipRequired?{needsFlipping:!0}:null:a<0?{needsFlipping:!0}:null}function Xe(p,i,a,m,b,w,E,R,z,N,j,X,K,Q,he,me,_e,ve,ke){const De=i/24,Pe=p.lineOffsetX*De,Fe=p.lineOffsetY*De,{lineStartIndex:ze,glyphStartIndex:qe,numGlyphs:$e,segment:We,writingMode:nt,flipState:Ke}=p,Ye=ze+p.lineLength,ft=kt=>{if(j){const[pt,Vt,zt]=kt.up,sn=N.length;r.bm(j,sn+0,pt,Vt,zt),r.bm(j,sn+1,pt,Vt,zt),r.bm(j,sn+2,pt,Vt,zt),r.bm(j,sn+3,pt,Vt,zt)}const[jt,Pt,nn]=kt.point;r.bn(N,jt,Pt,nn,kt.angle)};if($e>1){const kt=pr(De,R,Pe,Fe,a,X,K,p,z,w,Q,me,!1,_e,ve,ke);if(!kt)return{notEnoughRoom:!0};if(m&&!a){let[jt,Pt,nn]=kt.first.point,[pt,Vt,zt]=kt.last.point;[jt,Pt]=kr(jt,Pt,nn,E),[pt,Vt]=kr(pt,Vt,zt,E);const sn=vo(nt,Ke,(pt-jt)*he,Vt-Pt);if(p.flipState=sn&&sn.needsFlipping?rs.flipRequired:rs.flipNotRequired,sn)return sn}ft(kt.first);for(let jt=qe+1;jt<qe+$e-1;jt++){const Pt=Hn(De*R.getoffsetX(jt),Pe,Fe,a,X,K,We,ze,Ye,z,w,Q,me,!1,!1,_e,ve,ke);if(!Pt)return N.length-=4*(jt-qe),{notEnoughRoom:!0};ft(Pt)}ft(kt.last)}else{if(m&&!a){const jt=kr(K.x,K.y,0,b),Pt=ze+We+1,nn=new r.P(z.getx(Pt),z.gety(Pt)),pt=kr(nn.x,nn.y,0,b),Vt=pt[3]>0?pt:Sn(K,nn,jt,1,b,void 0,_e,ve.canonical),zt=vo(nt,Ke,(Vt[0]-jt[0])*he,Vt[1]-jt[1]);if(p.flipState=zt&&zt.needsFlipping?rs.flipRequired:rs.flipNotRequired,zt)return zt}const kt=Hn(De*R.getoffsetX(qe),Pe,Fe,a,X,K,We,ze,Ye,z,w,Q,me,!1,!1,_e,ve,ke);if(!kt)return{notEnoughRoom:!0};ft(kt)}return{}}function Dt(p,i,a,m,b){const{x:w,y:E,z:R}=m.projectTilePoint(p.x,p.y,i);if(!b)return kr(w,E,R,a);const[z,N,j]=b(p);return kr(w+z,E+N,R+j,a)}function Sn(p,i,a,m,b,w,E,R){const z=Dt(p.sub(i)._unit()._add(p),R,b,E,w);return r.a6.vec3.sub(z,a,z),r.a6.vec3.normalize(z,z),r.a6.vec3.scaleAndAdd(z,a,z,m)}function Hn(p,i,a,m,b,w,E,R,z,N,j,X,K,Q,he,me,_e,ve){const ke=m?p-i:p+i;let De=ke>0?1:-1,Pe=0;m&&(De*=-1,Pe=Math.PI),De<0&&(Pe+=Math.PI);let Fe=R+E+(De>0?0:1)|0,ze=b,qe=b,$e=0,We=0;const nt=Math.abs(ke),Ke=[],Ye=[];let ft=w,kt=ft;const jt=()=>Sn(kt,ft,qe,nt-$e+1,j,K,me,_e.canonical);for(;$e+We<=nt;){if(Fe+=De,Fe<R||Fe>=z)return null;if(qe=ze,kt=ft,Ke.push(qe),Q&&Ye.push(kt),ft=new r.P(N.getx(Fe),N.gety(Fe)),ze=X[Fe],!ze){const qt=Dt(ft,_e.canonical,j,me,K);ze=qt[3]>0?X[Fe]=qt:jt()}$e+=We,We=r.a6.vec3.distance(qe,ze)}he&&K&&(X[Fe]&&(ze=jt(),We=r.a6.vec3.distance(qe,ze)),X[Fe]=ze);const Pt=(nt-$e)/We,nn=ft.sub(kt)._mult(Pt)._add(kt),pt=r.a6.vec3.sub([],ze,qe),Vt=r.a6.vec3.scaleAndAdd([],qe,pt,Pt);let zt=[0,0,1],sn=pt[0],ln=pt[1];if(ve&&(zt=me.upVector(_e.canonical,nn.x,nn.y),zt[0]!==0||zt[1]!==0||zt[2]!==1)){const qt=[zt[2],0,-zt[0]],Fn=r.a6.vec3.cross([],zt,qt);r.a6.vec3.normalize(qt,qt),r.a6.vec3.normalize(Fn,Fn),sn=r.a6.vec3.dot(pt,qt),ln=r.a6.vec3.dot(pt,Fn)}if(a){const qt=r.a6.vec3.cross([],zt,pt);r.a6.vec3.normalize(qt,qt),r.a6.vec3.scaleAndAdd(Vt,Vt,qt,a*De)}const Ut=Pe+Math.atan2(ln,sn);return Ke.push(Vt),Q&&Ye.push(nn),{point:Vt,angle:Ut,path:Ke,tilePath:Ye,up:zt}}function zi(p,i){const a=i.length,m=a+4*p;i.resize(m),i.float32.fill(-1/0,4*a,4*m)}function yi(p,i,a){const m=i[0],b=i[1];return p[0]=a[0]*m+a[4]*b+a[12],p[1]=a[1]*m+a[5]*b+a[13],p[3]=a[3]*m+a[7]*b+a[15],p}const Ti=100;class $i{constructor(i,a,m=new Er(i.width+200,i.height+200,25),b=new Er(i.width+200,i.height+200,25)){this.transform=i,this.grid=m,this.ignoredGrid=b,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Ti,this.screenBottomBoundary=i.height+Ti,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=a}placeCollisionBox(i,a,m,b,w,E,R,z){let N=m.projectedAnchorX,j=m.projectedAnchorY,X=m.projectedAnchorZ;const K=m.elevation,Q=m.tileID,he=i.getProjection();if(K&&Q){const[ze,qe,$e]=he.upVector(Q.canonical,m.tileAnchorX,m.tileAnchorY),We=he.upVectorScale(Q.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;N+=ze*K*We,j+=qe*K*We,X+=$e*K*We}const me=this.projectAndGetPerspectiveRatio(R,N,j,X,m.tileID,he.name==="globe"||!!K||this.transform.pitch>0,he),_e=E*me.perspectiveRatio,ve=(m.x1*a+b.x-m.padding)*_e+me.point.x,ke=(m.y1*a+b.y-m.padding)*_e+me.point.y,De=(m.x2*a+b.x+m.padding)*_e+me.point.x,Pe=(m.y2*a+b.y+m.padding)*_e+me.point.y,Fe=me.perspectiveRatio<=.55||me.occluded;return!this.isInsideGrid(ve,ke,De,Pe)||!w&&this.grid.hitTest(ve,ke,De,Pe,z)||Fe?{box:[],offscreen:!1,occluded:me.occluded}:{box:[ve,ke,De,Pe],offscreen:this.isOffscreen(ve,ke,De,Pe),occluded:!1}}placeCollisionCircles(i,a,m,b,w,E,R,z,N,j,X,K,Q,he,me){const _e=[],ve=this.transform.elevation,ke=i.getProjection(),De=ve?ve.getAtTileOffsetFunc(me,this.transform.center.lat,this.transform.worldSize,ke):null,Pe=new r.P(m.tileAnchorX,m.tileAnchorY);let{x:Fe,y:ze,z:qe}=ke.projectTilePoint(Pe.x,Pe.y,me.canonical);if(De){const[nn,pt,Vt]=De(Pe);Fe+=nn,ze+=pt,qe+=Vt}const $e=ke.name==="globe",We=this.projectAndGetPerspectiveRatio(R,Fe,ze,qe,me,$e||!!ve||this.transform.pitch>0,ke),{perspectiveRatio:nt}=We,Ke=(X?E/nt:E*nt)/r.bq,Ye=kr(Fe,ze,qe,z),ft=We.signedDistanceFromCamera>0?pr(Ke,w,m.lineOffsetX*Ke,m.lineOffsetY*Ke,!1,Ye,Pe,m,b,z,{},ve&&!X?De:null,X&&!!ve,ke,me,X):null;let kt=!1,jt=!1,Pt=!0;if(ft&&!We.occluded){const nn=.5*Q*nt+he,pt=new r.P(-100,-100),Vt=new r.P(this.screenRightBoundary,this.screenBottomBoundary),zt=new Yr,{first:sn,last:ln}=ft,Ut=sn.path.length;let qt=[];for(let Cn=Ut-1;Cn>=1;Cn--)qt.push(sn.path[Cn]);for(let Cn=1;Cn<ln.path.length;Cn++)qt.push(ln.path[Cn]);const Fn=2.5*nn;N&&(qt=qt.map(([Cn,Yn,Dn],qn)=>(De&&!$e&&(Dn=De(qn<Ut-1?sn.tilePath[Ut-1-qn]:ln.tilePath[qn-Ut+2])[2]),kr(Cn,Yn,Dn,N))),qt.some(Cn=>Cn[3]<=0)&&(qt=[]));let pn=[];if(qt.length>0){let Cn=1/0,Yn=-1/0,Dn=1/0,qn=-1/0;for(const di of qt)Cn=Math.min(Cn,di[0]),Dn=Math.min(Dn,di[1]),Yn=Math.max(Yn,di[0]),qn=Math.max(qn,di[1]);Yn>=pt.x&&Cn<=Vt.x&&qn>=pt.y&&Dn<=Vt.y&&(pn=[qt.map(di=>new r.P(di[0],di[1]))],(Cn<pt.x||Yn>Vt.x||Dn<pt.y||qn>Vt.y)&&(pn=r.bo(pn,pt.x,pt.y,Vt.x,Vt.y)))}for(const Cn of pn){zt.reset(Cn,.25*nn);let Yn=0;Yn=zt.length<=.5*nn?1:Math.ceil(zt.paddedLength/Fn)+1;for(let Dn=0;Dn<Yn;Dn++){const qn=Dn/Math.max(Yn-1,1),di=zt.lerp(qn),ai=di.x+Ti,Hi=di.y+Ti;_e.push(ai,Hi,nn,0);const nr=ai-nn,gr=Hi-nn,Ia=ai+nn,ro=Hi+nn;if(Pt=Pt&&this.isOffscreen(nr,gr,Ia,ro),jt=jt||this.isInsideGrid(nr,gr,Ia,ro),!a&&this.grid.hitTestCircle(ai,Hi,nn,K)&&(kt=!0,!j))return{circles:[],offscreen:!1,collisionDetected:kt,occluded:!1}}}}return{circles:!j&&kt||!jt?[]:_e,offscreen:Pt,collisionDetected:kt,occluded:We.occluded}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let m=1/0,b=1/0,w=-1/0,E=-1/0;for(const j of i){const X=new r.P(j.x+Ti,j.y+Ti);m=Math.min(m,X.x),b=Math.min(b,X.y),w=Math.max(w,X.x),E=Math.max(E,X.y),a.push(X)}const R=this.grid.query(m,b,w,E).concat(this.ignoredGrid.query(m,b,w,E)),z={},N={};for(const j of R){const X=j.key;if(z[X.bucketInstanceId]===void 0&&(z[X.bucketInstanceId]={}),z[X.bucketInstanceId][X.featureIndex])continue;const K=[new r.P(j.x1,j.y1),new r.P(j.x2,j.y1),new r.P(j.x2,j.y2),new r.P(j.x1,j.y2)];r.bp(a,K)&&(z[X.bucketInstanceId][X.featureIndex]=!0,N[X.bucketInstanceId]===void 0&&(N[X.bucketInstanceId]=[]),N[X.bucketInstanceId].push(X.featureIndex))}return N}insertCollisionBox(i,a,m,b,w){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:b,collisionGroupID:w},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,a,m,b,w){const E=a?this.ignoredGrid:this.grid,R={bucketInstanceId:m,featureIndex:b,collisionGroupID:w};for(let z=0;z<i.length;z+=4)E.insertCircle(R,i[z],i[z+1],i[z+2])}projectAndGetPerspectiveRatio(i,a,m,b,w,E,R){const z=[a,m,b,1];let N=!1;b||this.transform.pitch>0?(r.a6.vec4.transformMat4(z,z,i),this.fogState&&w&&R.name!=="globe"&&(N=function(K,Q,he,me,_e,ve){const ke=ve.calculateFogTileMatrix(_e),De=[Q,he,me];return r.a6.vec3.transformMat4(De,De,ke),wn(K,r.a6.vec3.length(De),ve.pitch,ve._fov)}(this.fogState,a,m,b,w.toUnwrapped(),this.transform)>.9)):yi(z,z,i);const j=z[3];return{point:new r.P((z[0]/j+1)/2*this.transform.width+Ti,(-z[1]/j+1)/2*this.transform.height+Ti),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(R)/j*.5,1.5),signedDistanceFromCamera:j,occluded:E&&z[2]>j||N}}isOffscreen(i,a,m,b){return m<Ti||i>=this.screenRightBoundary||b<Ti||a>this.screenBottomBoundary}isInsideGrid(i,a,m,b){return m>=0&&i<this.gridRightBoundary&&b>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const i=r.a6.mat4.identity([]);return r.a6.mat4.translate(i,i,[-100,-100,0]),i}}function er(p,i,a){const m=i.createTileMatrix(p,p.worldSize,a.toUnwrapped());return r.a6.mat4.multiply(new Float32Array(16),p.projMatrix,m)}function mr(p,i,a){if(i.projection.name===a.projection.name)return p.projMatrix;const m=a.clone();return m.setProjection(i.projection),er(m,i.getProjection(),p)}function Kr(p,i,a){return i.name===a.projection.name?p.projMatrix:er(a,i,p)}class Ni{constructor(i,a,m,b){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?a:-a))):b&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class Wi{constructor(i,a,m,b,w,E=!1){this.text=new Ni(i?i.text:null,a,m,w),this.icon=new Ni(i?i.icon:null,a,b,w),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class jr{constructor(i,a,m,b=!1){this.text=i,this.icon=a,this.skipFade=m,this.clipped=b}}class Gi{constructor(){this.invProjMatrix=r.a6.mat4.create(),this.viewportMatrix=r.a6.mat4.create(),this.circles=[]}}class js{constructor(i,a,m,b,w){this.bucketInstanceId=i,this.featureIndex=a,this.sourceLayerIndex=m,this.bucketIndex=b,this.tileID=w}}class io{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const a=++this.maxGroupID;this.collisionGroups[i]={ID:a,predicate:m=>m.collisionGroupID===a}}return this.collisionGroups[i]}}function Vo(p,i,a,m,b){const{horizontalAlign:w,verticalAlign:E}=r.bx(p),R=-(w-.5)*i,z=-(E-.5)*a,N=r.bw(p,m);return new r.P(R+N[0]*b,z+N[1]*b)}function sa(p,i,a,m,b){const w=new r.P(p,i);return a&&w._rotate(m?b:-b),w}class Ps{constructor(i,a,m,b,w,E){this.transform=i.clone(),this.projection=i.projection.name,this.collisionIndex=new $i(this.transform,w),this.buildingIndex=E,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new io(m),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,a,m,b){const w=m.getBucket(a),E=m.latestFeatureIndex;if(!w||!E||a.fqid!==w.layerIds[0])return;const R=w.layers[0].layout,z=w.layers[0].paint,N=m.collisionBoxArray,j=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),X=m.tileSize/r.ab,K=m.tileID.toUnwrapped();this.transform.setProjection(w.projection);const Q=(he=m.tileID,me=w.getProjection(),_e=this.transform,me.name===this.projection?_e.calculateProjMatrix(he.toUnwrapped()):er(_e,me,he));var he,me,_e;const ve=R.get("text-pitch-alignment")==="map",ke=R.get("text-rotation-alignment")==="map";a.compileFilter();const De=a.dynamicFilter(),Pe=a.dynamicFilterNeedsFeature(),Fe=this.transform.calculatePixelsToTileUnitsMatrix(m),ze=hi(Q,m.tileID.canonical,ve,ke,this.transform,w.getProjection(),Fe);let qe=null;if(ve){const nt=no(Q,m.tileID.canonical,ve,ke,this.transform,w.getProjection(),Fe);qe=r.a6.mat4.multiply([],this.transform.labelPlaneMatrix,nt)}let $e=null;De&&m.latestFeatureIndex&&($e={unwrappedTileID:K,dynamicFilter:De,dynamicFilterNeedsFeature:Pe}),this.retainedQueryData[w.bucketInstanceId]=new js(w.bucketInstanceId,E,w.sourceLayerIndex,w.index,m.tileID);const We={bucket:w,layout:R,paint:z,posMatrix:Q,textLabelPlaneMatrix:ze,labelToScreenMatrix:qe,clippingData:$e,scale:j,textPixelRatio:X,holdingForFade:m.holdingForFade(),collisionBoxArray:N,partiallyEvaluatedTextSize:r.bj(w.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:r.bj(w.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID),latestFeatureIndex:m.latestFeatureIndex};if(b)for(const nt of w.sortKeyRanges){const{sortKey:Ke,symbolInstanceStart:Ye,symbolInstanceEnd:ft}=nt;i.push({sortKey:Ke,symbolInstanceStart:Ye,symbolInstanceEnd:ft,parameters:We})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:We})}attemptAnchorPlacement(i,a,m,b,w,E,R,z,N,j,X,K,Q,he,me,_e,ve,ke){const{textOffset0:De,textOffset1:Pe,crossTileID:Fe}=K,ze=[De,Pe],qe=Vo(i,m,b,ze,w),$e=this.collisionIndex.placeCollisionBox(he,w,a,sa(qe.x,qe.y,E,R,this.transform.angle),X,z,N,j.predicate);if(_e){const We=he.getSymbolInstanceIconSize(ke,this.transform.zoom,K.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(he,We,_e,sa(qe.x,qe.y,E,R,this.transform.angle),X,z,N,j.predicate).box.length===0)return}if($e.box.length>0){let We;return this.prevPlacement&&this.prevPlacement.variableOffsets[Fe]&&this.prevPlacement.placements[Fe]&&this.prevPlacement.placements[Fe].text&&(We=this.prevPlacement.variableOffsets[Fe].anchor),this.variableOffsets[Fe]={textOffset:ze,width:m,height:b,anchor:i,textScale:w,prevAnchor:We},this.markUsedJustification(he,i,K,me),he.allowVerticalPlacement&&(this.markUsedOrientation(he,me,K),this.placedOrientations[Fe]=me),{shift:qe,placedGlyphBoxes:$e}}}placeLayerBucketPart(i,a,m,b){const{bucket:w,layout:E,paint:R,posMatrix:z,textLabelPlaneMatrix:N,labelToScreenMatrix:j,clippingData:X,textPixelRatio:K,holdingForFade:Q,collisionBoxArray:he,partiallyEvaluatedTextSize:me,partiallyEvaluatedIconSize:_e,collisionGroup:ve,latestFeatureIndex:ke}=i.parameters,De=E.get("text-optional"),Pe=E.get("icon-optional"),Fe=E.get("text-allow-overlap"),ze=E.get("icon-allow-overlap"),qe=E.get("text-rotation-alignment")==="map",$e=E.get("text-pitch-alignment")==="map",We=E.get("symbol-z-elevate"),nt=R.get("symbol-z-offset"),Ke=R.get("symbol-elevation-reference")==="sea";this.transform.setProjection(w.projection);let Ye=Fe&&(ze||!w.hasIconData()||Pe),ft=ze&&(Fe||!w.hasTextData()||De);const kt=!nt.isConstant();!w.collisionArrays&&he&&w.deserializeCollisionBoxes(he),m&&b&&w.updateCollisionDebugBuffers(this.transform.zoom,he);const jt=(Pt,nn,pt)=>{const{crossTileID:Vt,numVerticalGlyphVertices:zt}=Pt;let sn=null;if(X&&X.dynamicFilterNeedsFeature||kt){const li=this.retainedQueryData[w.bucketInstanceId];sn=ke.loadFeature({featureIndex:Pt.featureIndex,bucketIndex:li.bucketIndex,sourceLayerIndex:li.sourceLayerIndex,layoutVertexArrayOffset:0})}if(X&&!(0,X.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},sn,this.retainedQueryData[w.bucketInstanceId].tileID.canonical,new r.P(Pt.tileAnchorX,Pt.tileAnchorY),this.transform.calculateDistanceTileData(X.unwrappedTileID)))return this.placements[Vt]=new jr(!1,!1,!1,!0),void a.add(Vt);const ln=nt.evaluate(sn,{});if(a.has(Vt))return;if(Q)return void(this.placements[Vt]=new jr(!1,!1,!1));let Ut=!1,qt=!1,Fn=!0,pn=!1,Cn=!1,Yn=null,Dn={box:null,offscreen:null,occluded:null},qn={box:null,offscreen:null,occluded:null},di=null,ai=null,Hi=null,nr=0,gr=0,Ia=0;pt.textFeatureIndex?nr=pt.textFeatureIndex:Pt.useRuntimeCollisionCircles&&(nr=Pt.featureIndex),pt.verticalTextFeatureIndex&&(gr=pt.verticalTextFeatureIndex);const ro=li=>{li.tileID=this.retainedQueryData[w.bucketInstanceId].tileID;const Oi=this.transform.elevation;li.elevation=Ke?ln:ln+(Oi?Oi.getAtTileOffset(li.tileID,li.tileAnchorX,li.tileAnchorY):0),li.elevation+=Pt.zOffset},vi=pt.textBox;if(vi){ro(vi);const li=Ui=>{let Zr=r.bk.horizontal;if(w.allowVerticalPlacement&&!Ui&&this.prevPlacement){const oo=this.prevPlacement.placedOrientations[Vt];oo&&(this.placedOrientations[Vt]=oo,Zr=oo,this.markUsedOrientation(w,Zr,Pt))}return Zr},Oi=(Ui,Zr)=>{if(w.allowVerticalPlacement&&zt>0&&pt.verticalTextBox){for(const oo of w.writingModes)if(oo===r.bk.vertical?(Dn=Zr(),qn=Dn):Dn=Ui(),Dn&&Dn.box&&Dn.box.length)break}else Dn=Ui()};if(E.get("text-variable-anchor")){let Ui=E.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Vt]){const Ii=this.prevPlacement.variableOffsets[Vt];Ui.indexOf(Ii.anchor)>0&&(Ui=Ui.filter(Mo=>Mo!==Ii.anchor),Ui.unshift(Ii.anchor))}const Zr=(Ii,Mo,jo)=>{const ko=w.getSymbolInstanceTextSize(me,Pt,this.transform.zoom,nn),cr=(Ii.x2-Ii.x1)*ko+2*Ii.padding,ks=(Ii.y2-Ii.y1)*ko+2*Ii.padding,Rs=Pt.hasIconTextFit&&!ze?Mo:null;Rs&&ro(Rs);let Ca={box:[],offscreen:!1,occluded:!1};const pa=Fe?2*Ui.length:Ui.length;for(let Hs=0;Hs<pa;++Hs){const Aa=this.attemptAnchorPlacement(Ui[Hs%Ui.length],Ii,cr,ks,ko,qe,$e,K,z,ve,Hs>=Ui.length,Pt,nn,w,jo,Rs,me,_e);if(Aa&&(Ca=Aa.placedGlyphBoxes,Ca&&Ca.box&&Ca.box.length)){Ut=!0,Yn=Aa.shift;break}}return Ca};Oi(()=>Zr(vi,pt.iconBox,r.bk.horizontal),()=>{const Ii=pt.verticalTextBox;return Ii&&ro(Ii),w.allowVerticalPlacement&&!(Dn&&Dn.box&&Dn.box.length)&&zt>0&&Ii?Zr(Ii,pt.verticalIconBox,r.bk.vertical):{box:null,offscreen:null,occluded:null}}),Dn&&(Ut=Dn.box,Fn=Dn.offscreen,pn=Dn.occluded);const oo=li(!(!Dn||!Dn.box));if(!Ut&&this.prevPlacement){const Ii=this.prevPlacement.variableOffsets[Vt];Ii&&(this.variableOffsets[Vt]=Ii,this.markUsedJustification(w,Ii.anchor,Pt,oo))}}else{const Ui=(Zr,oo)=>{const Ii=w.getSymbolInstanceTextSize(me,Pt,this.transform.zoom,nn),Mo=this.collisionIndex.placeCollisionBox(w,Ii,Zr,new r.P(0,0),Fe,K,z,ve.predicate);return Mo&&Mo.box&&Mo.box.length&&(this.markUsedOrientation(w,oo,Pt),this.placedOrientations[Vt]=oo),Mo};Oi(()=>Ui(vi,r.bk.horizontal),()=>{const Zr=pt.verticalTextBox;return w.allowVerticalPlacement&&zt>0&&Zr?(ro(Zr),Ui(Zr,r.bk.vertical)):{box:null,offscreen:null,occluded:null}}),li(!!(Dn&&Dn.box&&Dn.box.length))}}if(di=Dn,Ut=di&&di.box&&di.box.length>0,Fn=di&&di.offscreen,pn=di&&di.occluded,Pt.useRuntimeCollisionCircles){const li=w.text.placedSymbolArray.get(Pt.centerJustifiedTextSymbolIndex>=0?Pt.centerJustifiedTextSymbolIndex:Pt.verticalPlacedTextSymbolIndex),Oi=r.bl(w.textSizeData,me,li),Ui=E.get("text-padding");ai=this.collisionIndex.placeCollisionCircles(w,Fe,li,w.lineVertexArray,w.glyphOffsetArray,Oi,z,N,j,m,$e,ve.predicate,Pt.collisionCircleDiameter*Oi/r.bq,Ui,this.retainedQueryData[w.bucketInstanceId].tileID),Ut=Fe||ai.circles.length>0&&!ai.collisionDetected,Fn=Fn&&ai.offscreen,pn=ai.occluded}if(pt.iconFeatureIndex&&(Ia=pt.iconFeatureIndex),pt.iconBox){const li=Oi=>{ro(Oi);const Ui=Pt.hasIconTextFit&&Yn?sa(Yn.x,Yn.y,qe,$e,this.transform.angle):new r.P(0,0),Zr=w.getSymbolInstanceIconSize(_e,this.transform.zoom,Pt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(w,Zr,Oi,Ui,ze,K,z,ve.predicate)};qn&&qn.box&&qn.box.length&&pt.verticalIconBox?(Hi=li(pt.verticalIconBox),qt=Hi.box.length>0):(Hi=li(pt.iconBox),qt=Hi.box.length>0),Fn=Fn&&Hi.offscreen,Cn=Hi.occluded}const Yi=De||Pt.numHorizontalGlyphVertices===0&&zt===0,Lr=Pe||Pt.numIconVertices===0;if(Yi||Lr?Lr?Yi||(qt=qt&&Ut):Ut=qt&&Ut:qt=Ut=qt&&Ut,Ut&&di&&di.box&&this.collisionIndex.insertCollisionBox(di.box,E.get("text-ignore-placement"),w.bucketInstanceId,qn&&qn.box&&gr?gr:nr,ve.ID),qt&&Hi&&this.collisionIndex.insertCollisionBox(Hi.box,E.get("icon-ignore-placement"),w.bucketInstanceId,Ia,ve.ID),ai&&(Ut&&this.collisionIndex.insertCollisionCircles(ai.circles,E.get("text-ignore-placement"),w.bucketInstanceId,nr,ve.ID),m)){const li=w.bucketInstanceId;let Oi=this.collisionCircleArrays[li];Oi===void 0&&(Oi=this.collisionCircleArrays[li]=new Gi);for(let Ui=0;Ui<ai.circles.length;Ui+=4)Oi.circles.push(ai.circles[Ui+0]),Oi.circles.push(ai.circles[Ui+1]),Oi.circles.push(ai.circles[Ui+2]),Oi.circles.push(ai.collisionDetected?1:0)}const Zi=w.projection.name!=="globe";Ye=Ye&&(Zi||!pn),ft=ft&&(Zi||!Cn),this.placements[Vt]=new jr(Ut||Ye,qt||ft,Fn||w.justReloaded),a.add(Vt)};if(We&&this.buildingIndex&&(this.buildingIndex.updateZOffset(w,this.retainedQueryData[w.bucketInstanceId].tileID),w.updateZOffset()),w.sortFeaturesByY){const Pt=w.getSortedSymbolIndexes(this.transform.angle);for(let nn=Pt.length-1;nn>=0;--nn){const pt=Pt[nn];jt(w.symbolInstances.get(pt),pt,w.collisionArrays[pt])}w.hasAnyZOffset&&r.w(`${w.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(w.hasAnyZOffset){const Pt=w.getSortedIndexesByZOffset();for(let nn=0;nn<Pt.length;++nn){const pt=Pt[nn];jt(w.symbolInstances.get(pt),pt,w.collisionArrays[pt])}}else for(let Pt=i.symbolInstanceStart;Pt<i.symbolInstanceEnd;Pt++)jt(w.symbolInstances.get(Pt),Pt,w.collisionArrays[Pt]);if(m&&w.bucketInstanceId in this.collisionCircleArrays){const Pt=this.collisionCircleArrays[w.bucketInstanceId];r.a6.mat4.invert(Pt.invProjMatrix,z),Pt.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1}markUsedJustification(i,a,m,b){const{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:R,verticalPlacedTextSymbolIndex:z,crossTileID:N}=m,j=r.bv(a),X=b===r.bk.vertical?z:j==="left"?w:j==="center"?E:j==="right"?R:-1;w>=0&&(i.text.placedSymbolArray.get(w).crossTileID=X>=0&&w!==X?0:N),E>=0&&(i.text.placedSymbolArray.get(E).crossTileID=X>=0&&E!==X?0:N),R>=0&&(i.text.placedSymbolArray.get(R).crossTileID=X>=0&&R!==X?0:N),z>=0&&(i.text.placedSymbolArray.get(z).crossTileID=X>=0&&z!==X?0:N)}markUsedOrientation(i,a,m){const b=a===r.bk.horizontal||a===r.bk.horizontalOnly?a:0,w=a===r.bk.vertical?a:0,{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:R,rightJustifiedTextSymbolIndex:z,verticalPlacedTextSymbolIndex:N}=m,j=i.text.placedSymbolArray;E>=0&&(j.get(E).placedOrientation=b),R>=0&&(j.get(R).placedOrientation=b),z>=0&&(j.get(z).placedOrientation=b),N>=0&&(j.get(N).placedOrientation=w)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let m=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const b=a?a.symbolFadeChange(i):1,w=a?a.opacities:{},E=a?a.variableOffsets:{},R=a?a.placedOrientations:{};for(const z in this.placements){const N=this.placements[z],j=w[z];j?(this.opacities[z]=new Wi(j,b,N.text,N.icon,null,N.clipped),m=m||N.text!==j.text.placed||N.icon!==j.icon.placed):(this.opacities[z]=new Wi(null,b,N.text,N.icon,N.skipFade,N.clipped),m=m||N.text||N.icon)}for(const z in w){const N=w[z];if(!this.opacities[z]){const j=new Wi(N,b,!1,!1);j.isHidden()||(this.opacities[z]=j,m=m||N.text.placed||N.icon.placed)}}for(const z in E)this.variableOffsets[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.variableOffsets[z]=E[z]);for(const z in R)this.placedOrientations[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.placedOrientations[z]=R[z]);m?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:i)}updateLayerOpacities(i,a,m,b){const w=new Set;for(const E of a){const R=E.getBucket(i);R&&E.latestFeatureIndex&&i.fqid===R.layerIds[0]&&(this.updateBucketOpacities(R,w,E,E.collisionBoxArray,m,b,E.tileID,i.scope),R.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(R,E.tileID),R.updateZOffset()))}}updateBucketOpacities(i,a,m,b,w,E,R,z){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const N=i.layers[0].layout,j=i.layers[0].paint,X=!!i.layers[0].dynamicFilter(),K=new Wi(null,0,!1,!1,!0),Q=N.get("text-allow-overlap"),he=N.get("icon-allow-overlap"),me=N.get("text-variable-anchor"),_e=N.get("text-rotation-alignment")==="map",ve=N.get("text-pitch-alignment")==="map",ke=j.get("symbol-z-offset"),De=j.get("symbol-elevation-reference")==="sea",Pe=!ke.isConstant(),Fe=new Wi(null,0,Q&&(he||!i.hasIconData()||N.get("icon-optional")),he&&(Q||!i.hasTextData()||N.get("text-optional")),!0);!i.collisionArrays&&b&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(b);const ze=($e,We,nt)=>{for(let Ke=0;Ke<We/4;Ke++)$e.opacityVertexArray.emplaceBack(nt)};let qe=0;E&&i.updateReplacement(R,E);for(let $e=0;$e<i.symbolInstances.length;$e++){const We=i.symbolInstances.get($e),{numHorizontalGlyphVertices:nt,numVerticalGlyphVertices:Ke,crossTileID:Ye,numIconVertices:ft,tileAnchorX:kt,tileAnchorY:jt}=We;let Pt=null;if(We&&Pe){const pn=this.retainedQueryData[i.bucketInstanceId];Pt=m.latestFeatureIndex.loadFeature({featureIndex:We.featureIndex,bucketIndex:pn.bucketIndex,sourceLayerIndex:pn.sourceLayerIndex,layoutVertexArrayOffset:0})}const nn=ke.evaluate(Pt,{}),pt=a.has(Ye);let Vt=this.opacities[Ye];pt?Vt=K:Vt||(Vt=Fe,this.opacities[Ye]=Vt),a.add(Ye);const zt=nt>0||Ke>0,sn=ft>0,ln=this.placedOrientations[Ye],Ut=ln===r.bk.vertical,qt=ln===r.bk.horizontal||ln===r.bk.horizontalOnly;!zt&&!sn||Vt.isHidden()||qe++;let Fn=!1;if((zt||sn)&&E)for(const pn of i.activeReplacements){if(r.br(pn,w,r.bs.Symbol,z)||pn.min.x>kt||kt>pn.max.x||pn.min.y>jt||jt>pn.max.y)continue;const Cn=r.bt(kt,jt,R.canonical,pn.footprintTileId.canonical);if(Fn=r.bu(Cn,pn.footprint),Fn)break}if(zt){const pn=Fn?wl:xl(Vt.text);ze(i.text,nt,Ut?wl:pn),ze(i.text,Ke,qt?wl:pn);const Cn=Vt.text.isHidden(),{leftJustifiedTextSymbolIndex:Yn,centerJustifiedTextSymbolIndex:Dn,rightJustifiedTextSymbolIndex:qn,verticalPlacedTextSymbolIndex:di}=We,ai=i.text.placedSymbolArray,Hi=Cn||Ut?1:0;Yn>=0&&(ai.get(Yn).hidden=Hi),Dn>=0&&(ai.get(Dn).hidden=Hi),qn>=0&&(ai.get(qn).hidden=Hi),di>=0&&(ai.get(di).hidden=Cn||qt?1:0);const nr=this.variableOffsets[Ye];nr&&this.markUsedJustification(i,nr.anchor,We,ln);const gr=this.placedOrientations[Ye];gr&&(this.markUsedJustification(i,"left",We,gr),this.markUsedOrientation(i,gr,We))}if(sn){const pn=Fn?wl:xl(Vt.icon),{placedIconSymbolIndex:Cn,verticalPlacedIconSymbolIndex:Yn}=We,Dn=i.icon.placedSymbolArray,qn=Vt.icon.isHidden()?1:0;Cn>=0&&(ze(i.icon,ft,Ut?wl:pn),Dn.get(Cn).hidden=qn),Yn>=0&&(ze(i.icon,We.numVerticalIconVertices,qt?wl:pn),Dn.get(Yn).hidden=qn)}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const pn=i.collisionArrays[$e];if(pn){let Cn=new r.P(0,0),Yn=!0;if(pn.textBox||pn.verticalTextBox){if(me){const qn=this.variableOffsets[Ye];qn?(Cn=Vo(qn.anchor,qn.width,qn.height,qn.textOffset,qn.textScale),_e&&Cn._rotate(ve?this.transform.angle:-this.transform.angle)):Yn=!1}X&&(Yn=!Vt.clipped),pn.textBox&&aa(i.textCollisionBox.collisionVertexArray,Vt.text.placed,!Yn||Ut,nn,De,Cn.x,Cn.y),pn.verticalTextBox&&aa(i.textCollisionBox.collisionVertexArray,Vt.text.placed,!Yn||qt,nn,De,Cn.x,Cn.y)}const Dn=Yn&&!!(!qt&&pn.verticalIconBox);pn.iconBox&&aa(i.iconCollisionBox.collisionVertexArray,Vt.icon.placed,Dn,nn,De,We.hasIconTextFit?Cn.x:0,We.hasIconTextFit?Cn.y:0),pn.verticalIconBox&&aa(i.iconCollisionBox.collisionVertexArray,Vt.icon.placed,!Dn,nn,De,We.hasIconTextFit?Cn.x:0,We.hasIconTextFit?Cn.y:0)}}}if(i.fullyClipped=qe===0,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const $e=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=$e.invProjMatrix,i.placementViewportMatrix=$e.viewportMatrix,i.collisionCircleArray=$e.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,a){const m=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*m>i}setStale(){this.stale=!0}}function aa(p,i,a,m,b,w,E){p.emplaceBack(i?1:0,a?1:0,w||0,E||0,m,b?1:0),p.emplaceBack(i?1:0,a?1:0,w||0,E||0,m,b?1:0),p.emplaceBack(i?1:0,a?1:0,w||0,E||0,m,b?1:0),p.emplaceBack(i?1:0,a?1:0,w||0,E||0,m,b?1:0)}const la=Math.pow(2,25),jd=Math.pow(2,24),Ic=Math.pow(2,17),hs=Math.pow(2,16),$d=Math.pow(2,9),Ta=Math.pow(2,8),_h=Math.pow(2,1);function xl(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const i=p.placed?1:0,a=Math.floor(127*p.opacity);return a*la+i*jd+a*Ic+i*hs+a*$d+i*Ta+a*_h+i}const wl=0;class Gd{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(i,a,m,b,w){const E=this._bucketParts;for(;this._currentTileIndex<i.length;)if(a.getBucketParts(E,b,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((R,z)=>R.sortKey-z.sortKey));this._currentPartIndex<E.length;){const R=E[this._currentPartIndex];if(a.placeLayerBucketPart(R,this._seenCrossTileIDs,m,R.symbolInstanceStart===0),this._currentPartIndex++,w())return!0}return!1}}class os{constructor(i,a,m,b,w,E,R,z,N){this.placement=new Ps(i,w,E,R,z,N),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(i,a,m,b){const w=r.q.now(),E=()=>{const R=r.q.now()-w;return!this._forceFullPlacement&&R>2};for(;this._currentPlacementIndex>=0;){const R=a[i[this._currentPlacementIndex]],z=this.placement.collisionIndex.transform.zoom;if(R.type==="symbol"&&(!R.minzoom||R.minzoom<=z)&&(!R.maxzoom||R.maxzoom>z)){const N=R,j=N.layout.get("symbol-z-elevate"),X=N.layout.get("symbol-sort-key").constantOr(1)!==void 0,K=N.layout.get("symbol-z-order"),Q=K==="viewport-y"||K==="auto"&&!(K!=="viewport-y"&&X),he=N.layout.get("text-allow-overlap")||N.layout.get("icon-allow-overlap")||N.layout.get("text-ignore-placement")||N.layout.get("icon-ignore-placement"),me=Q&&he,_e=this._inProgressLayer=this._inProgressLayer||new Gd(N),ve=r.av(R.source,R.scope);if(_e.continuePlacement(j||me?b[ve]:m[ve],this.placement,this._showCollisionBoxes,R,E))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const tl=512/r.ab/2;class Hd{constructor(i,a,m){this.tileID=i,this.bucketInstanceId=m,this.index=new r.by(a.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const b=i.canonical.x*r.ab,w=i.canonical.y*r.ab;for(let E=0;E<a.length;E++){const{key:R,crossTileID:z,tileAnchorX:N,tileAnchorY:j}=a.get(E),X=Math.floor((b+N)*tl),K=Math.floor((w+j)*tl);this.index.add(X,K),this.keys.push(R),this.crossTileIDs.push(z)}this.index.finish()}findMatches(i,a,m){const b=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z),w=tl/Math.pow(2,a.canonical.z-this.tileID.canonical.z),E=a.canonical.x*r.ab,R=a.canonical.y*r.ab;for(let z=0;z<i.length;z++){const N=i.get(z);if(N.crossTileID)continue;const{key:j,tileAnchorX:X,tileAnchorY:K}=N,Q=Math.floor((E+X)*w),he=Math.floor((R+K)*w),me=this.index.range(Q-b,he-b,Q+b,he+b);for(const _e of me){const ve=this.crossTileIDs[_e];if(this.keys[_e]===j&&!m.has(ve)){m.add(ve),N.crossTileID=ve;break}}}}}class ca{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class F{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const a=Math.round((i-this.lng)/360);if(a!==0)for(const m in this.indexes){const b=this.indexes[m],w={};for(const E in b){const R=b[E];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+a),w[R.tileID.key]=R}this.indexes[m]=w}this.lng=i}addBucket(i,a,m){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let w=0;w<a.symbolInstances.length;w++)a.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]=new Set);const b=this.usedCrossTileIDs[i.overscaledZ];for(const w in this.indexes){const E=this.indexes[w];if(Number(w)>i.overscaledZ)for(const R in E){const z=E[R];z.tileID.isChildOf(i)&&z.findMatches(a.symbolInstances,i,b)}else{const R=E[i.scaledTo(Number(w)).key];R&&R.findMatches(a.symbolInstances,i,b)}}for(let w=0;w<a.symbolInstances.length;w++){const E=a.symbolInstances.get(w);E.crossTileID||(E.crossTileID=m.generate(),b.add(E.crossTileID))}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Hd(i,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(i,a){for(const m of a.crossTileIDs)this.usedCrossTileIDs[i].delete(m)}removeStaleBuckets(i){let a=!1;for(const m in this.indexes){const b=this.indexes[m];for(const w in b)i[b[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,b[w]),delete b[w],a=!0)}return a}}class le{constructor(){this.layerIndexes={},this.crossTileIDs=new ca,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,a,m,b){let w=this.layerIndexes[i.fqid];w===void 0&&(w=this.layerIndexes[i.fqid]=new F);let E=!1;const R={};b.name!=="globe"&&w.handleWrapJump(m);for(const z of a){const N=z.getBucket(i);N&&i.fqid===N.layerIds[0]&&(N.bucketInstanceId||(N.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(z.tileID,N,this.crossTileIDs)&&(E=!0),R[N.bucketInstanceId]=!0)}return w.removeStaleBuckets(R)&&(E=!0),E}pruneUnusedLayers(i){const a={};i.forEach(m=>{a[m]=!0});for(const m in this.layerIndexes)a[m]||delete this.layerIndexes[m]}}const xe=771;class Be{constructor(i,a,m,b){this.blendFunction=i,this.blendColor=a,this.mask=m,this.blendEquation=b}}Be.Replace=[1,0,1,0],Be.disabled=new Be(Be.Replace,r.bz.transparent,[!1,!1,!1,!1]),Be.unblended=new Be(Be.Replace,r.bz.transparent,[!0,!0,!0,!0]),Be.alphaBlended=new Be([1,xe,1,xe],r.bz.transparent,[!0,!0,!0,!0]),Be.alphaBlendedNonPremultiplied=new Be([770,xe,770,xe],r.bz.transparent,[!0,!0,!0,!0]),Be.multiply=new Be([774,0,774,0],r.bz.transparent,[!0,!0,!0,!0]);class dt{constructor(i,a,m){this.func=i,this.mask=a,this.range=m}}dt.ReadOnly=!1,dt.ReadWrite=!0,dt.disabled=new dt(519,dt.ReadOnly,[0,1]);const on=7680;class Kt{constructor(i,a,m,b,w,E){this.test=i,this.ref=a,this.mask=m,this.fail=b,this.depthFail=w,this.pass=E}}Kt.disabled=new Kt({func:519,mask:0},0,0,on,on,on);const Ir=1029,fo=2305;class Mn{constructor(i,a,m){this.enable=i,this.mode=a,this.frontFace=m}}function No(p,i){const a=r.bC(p,3);r.a6.mat4.fromQuat(p,i),r.bE(p,3,a)}function Ao(p,i){const a=r.a6.quat.identity([]);return r.a6.quat.rotateZ(a,a,-i),r.a6.quat.rotateX(a,a,-p),a}function nl(p,i){const a=[p[0],p[1],0],m=[i[0],i[1],0];if(r.a6.vec3.length(a)>=1e-15){const E=r.a6.vec3.normalize([],a);r.a6.vec3.scale(m,E,r.a6.vec3.dot(m,E)),i[0]=m[0],i[1]=m[1]}const b=r.a6.vec3.cross([],i,p);if(r.a6.vec3.len(b)<1e-15)return null;const w=Math.atan2(-b[1],b[0]);return Ao(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),w)}Mn.disabled=new Mn(!1,Ir,fo),Mn.backCCW=new Mn(!0,Ir,fo),Mn.backCW=new Mn(!0,Ir,2304),Mn.frontCW=new Mn(!0,1028,2304),Mn.frontCCW=new Mn(!0,1028,fo);class Uo{constructor(i,a){this.position=i,this.orientation=a}get position(){return this._position}set position(i){if(i){const a=i instanceof r.a5?i:new r.a5(i[0],i[1],i[2]);this._renderWorldCopies&&(a.x=r.bA(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(i,a){if(this.orientation=null,!this.position)return;const m=this.position,b=this._elevation?this._elevation.getAtPointOrZero(r.a5.fromLngLat(i)):0,w=r.a5.fromLngLat(i,b),E=[w.x-m.x,w.y-m.y,w.z-m.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=nl(E,a)}setPitchBearing(i,a){this.orientation=Ao(r.bB(i),r.bB(-a))}}class Ea{constructor(i,a){this._transform=r.a6.mat4.identity([]),this.orientation=a,this.position=i}get mercatorPosition(){const i=this.position;return new r.a5(i[0],i[1],i[2])}get position(){const i=r.bC(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var a;i&&r.bE(this._transform,3,[(a=i)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||r.a6.quat.identity([]),i&&No(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,a){this._orientation=Ao(i,a),No(this._transform,this._orientation)}forward(){const i=r.bC(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=r.bC(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=r.bC(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,a){const m=new Float64Array(16);return r.a6.mat4.invert(m,this.getWorldToCamera(i,a)),m}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(i,a,m){const b=this.position;r.a6.vec3.scale(b,b,-i);const w=new Float64Array(16);return r.a6.mat4.fromScaling(w,[m,m,m]),r.a6.mat4.translate(w,w,b),w[10]*=a,w}getWorldToCamera(i,a){const m=new Float64Array(16),b=new Float64Array(4),w=this.position;return r.a6.quat.conjugate(b,this._orientation),r.a6.vec3.scale(w,w,-i),r.a6.mat4.fromQuat(m,b),r.a6.mat4.translate(m,m,w),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=a,m[9]*=a,m[10]*=a,m[11]*=a,m}getCameraToClipPerspective(i,a,m,b){const w=new Float64Array(16);return r.a6.mat4.perspective(w,i,a,m,b),w}getCameraToClipOrthographic(i,a,m,b,w,E){const R=new Float64Array(16);return r.a6.mat4.ortho(R,i,a,m,b,w,E),R}getDistanceToElevation(i,a=!1){const m=i===0?0:r.bD(i,a?r.aM(this.position[1]):this.position[1]),b=this.forward();return(m-this.position[2])/b[2]}clone(){return new Ea([...this.position],[...this.orientation])}}const Po={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class qd{constructor(i=0,a=0,m=0,b=0){if(isNaN(i)||i<0||isNaN(a)||a<0||isNaN(m)||m<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=a,this.left=m,this.right=b}interpolate(i,a,m){return a.top!=null&&i.top!=null&&(this.top=r.aa(i.top,a.top,m)),a.bottom!=null&&i.bottom!=null&&(this.bottom=r.aa(i.bottom,a.bottom,m)),a.left!=null&&i.left!=null&&(this.left=r.aa(i.left,a.left,m)),a.right!=null&&i.right!=null&&(this.right=r.aa(i.right,a.right,m)),this}getCenter(i,a){const m=r.ap((this.left+i-this.right)/2,0,i),b=r.ap((this.top+a-this.bottom)/2,0,a);return new r.P(m,b)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new qd(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const au=(p,i,a)=>(1-a)*p+a*i,lu=p=>p*p*p*p*p;class Wd{constructor(i,a,m,b,w,E,R){this.tileSize=512,this._renderWorldCopies=w===void 0||w,this._minZoom=i||0,this._maxZoom=a||22,this._minPitch=m??0,this._maxPitch=b??60,this.setProjection(E),this.setMaxBounds(R),this.width=0,this.height=0,this._center=new r.bK(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new qd,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Ea,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const i=new Wd(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.mercatorFromTransition=this.mercatorFromTransition,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.frustumCorners=this.frustumCorners,i}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(i,a=!1){const m=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||m)&&this._updateCameraOnTerrain(),(i||m)&&this._constrainCamera(a),this._calcMatrices()}getProjection(){return r.ar(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const a=this.projection?this.getProjection():void 0;this.projection=r.bL(this.projectionOptions);const m=this.getProjection(),b=!r.bh(a,m);return b&&this._calcMatrices(),this.mercatorFromTransition=!1,b}setOrthographicProjectionAtLowPitch(i){return this._orthographicProjectionAtLowPitch!==i&&(this._orthographicProjectionAtLowPitch=i,this._calcMatrices(),!0)}setMercatorFromTransition(){const i=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.bL({name:"mercator"});const a=i!==this.projection.name;return a&&this._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.bD(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.bA(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const a=-i*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=r.a6.mat2.create(),r.a6.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const a=r.ap(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const i=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/i)}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=r.bB(i),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){const a=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(i){this._tileCoverLift!==i&&(this._tileCoverLift=i)}_updateCameraOnTerrain(){const i=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,a=this.elevation&&i===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||i===Number.NEGATIVE_INFINITY&&(!a||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const m=this._elevation;a||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&m.exaggeration()&&this._centerAltitudeValidForExaggeration!==m.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*m.exaggeration(),this._centerAltitudeValidForExaggeration=m.exaggeration()):(this._centerAltitude=i||0,this._centerAltitudeValidForExaggeration=m.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let b=0,w=0;for(let E=0;E<a.length;E++){const R=new r.P(a[E][0]*this.width,m+a[E][1]*(this.height-m)),z=i.pointCoordinate(R);if(!z)continue;const N=1/Math.hypot(z[0]-this._camera.position[0],z[1]-this._camera.position[1]);b+=z[3]*N,w+=N}return w===0?NaN:b/w}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const i=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*a,b=this._mercatorZfromZoom(i),w=this._mercatorZfromZoom(this._maxZoom),E=Math.max(b-m,w);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let m;m=i.z<this._camera.position[2]?[a.x,a.y,a.z]:[i.x,i.y,i.z];const b=r.a6.vec3.length(r.a6.vec3.sub([],this._camera.position,m));return r.ap(this._zoomFromMercatorZ(b),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let a=!1;if(i.orientation&&!r.a6.quat.exactEquals(i.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(i.orientation)),i.position){const m=[i.position.x,i.position.y,i.position.z];r.a6.vec3.exactEquals(m,this._camera.position)||(this._setCameraPosition(m),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,a=new Uo;return a.position=new r.a5(i[0],i[1],i[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(i){if(!r.a6.quat.length(i))return!1;r.a6.quat.normalize(i,i);const a=r.a6.vec3.transformQuat([],[0,0,-1],i),m=r.a6.vec3.transformQuat([],[0,-1,0],i);if(m[2]<0)return!1;const b=nl(a,m);return!!b&&(this._camera.orientation=b,!0)}_setCameraPosition(i){const a=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,b=this.cameraToCenterDistance;i[2]=r.ap(i[2],b/m,b/a),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,a,m){this._unmodified=!1,this._edgeInsets.interpolate(i,a,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const a=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(i){const a=[new r.bM(0,i)];if(this.renderWorldCopies){const m=this.pointCoordinate(new r.P(0,0)),b=this.pointCoordinate(new r.P(this.width,0)),w=this.pointCoordinate(new r.P(this.width,this.height)),E=this.pointCoordinate(new r.P(0,this.height)),R=Math.floor(Math.min(m.x,b.x,w.x,E.x)),z=Math.floor(Math.max(m.x,b.x,w.x,E.x)),N=1;for(let j=R-N;j<=z+N;j++)j!==0&&a.push(new r.bM(j,i))}return a}isLODDisabled(i){return(!i||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(i,a,m){let b=[];const w=m!==void 0,E=!w;if(E&&this.zoom<a||w&&m[0]===0&&m[1]===0)return b;const R=new Set,z=(j,X,K,Q,he)=>{const me=r.c1(X,j,K,Q,he);R.has(me)||(b.push(new r.aA(j,X,K,Q,he)),R.add(me))};for(let j=0;j<i.length;j++){const X=i[j];if(E&&X.canonical.z!==a)continue;const K=X.canonical,Q=X.overscaledZ,he=X.wrap,me=1<<K.z,_e=K.x+1<me,ve=K.x>0,ke=K.y+1<me,De=K.y>0,Pe=X.wrap-(ve?0:1),Fe=X.wrap+(_e?0:1),ze=ve?K.x-1:me-1,qe=_e?K.x+1:0;if(w)m[0]<0?(z(Q,Fe,K.z,qe,K.y),m[1]<0&&ke&&(z(Q,he,K.z,K.x,K.y+1),z(Q,Fe,K.z,qe,K.y+1)),m[1]>0&&De&&(z(Q,he,K.z,K.x,K.y-1),z(Q,Fe,K.z,qe,K.y-1))):m[0]>0?(z(Q,Pe,K.z,ze,K.y),m[1]<0&&ke&&(z(Q,he,K.z,K.x,K.y+1),z(Q,Pe,K.z,ze,K.y+1)),m[1]>0&&De&&(z(Q,he,K.z,K.x,K.y-1),z(Q,Pe,K.z,ze,K.y-1))):m[1]<0&&ke?z(Q,he,K.z,K.x,K.y+1):De&&z(Q,he,K.z,K.x,K.y-1);else{const $e=X.visibleQuadrants;1&$e&&(z(Q,Pe,K.z,ze,K.y),De&&(z(Q,he,K.z,K.x,K.y-1),z(Q,Pe,K.z,ze,K.y-1))),2&$e&&(z(Q,Fe,K.z,qe,K.y),De&&(z(Q,he,K.z,K.x,K.y-1),z(Q,Fe,K.z,qe,K.y-1))),4&$e&&(z(Q,Pe,K.z,ze,K.y),ke&&(z(Q,he,K.z,K.x,K.y+1),z(Q,Pe,K.z,ze,K.y+1))),8&$e&&(z(Q,Fe,K.z,qe,K.y),ke&&(z(Q,he,K.z,K.x,K.y+1),z(Q,Fe,K.z,qe,K.y+1)))}}const N=[];for(const j of b)b.some(X=>j.isChildOf(X))||N.push(j);if(b=N.filter(j=>!i.some(X=>!!(j.overscaledZ<a&&X.isChildOf(j))||j.equals(X)||j.isChildOf(X))),E){const j=1<<a,X=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),K=[j*X.x,j*X.y],Q=4,he=Q*Q;b=b.filter(me=>{const _e=me.canonical.x+.5-K[0],ve=me.canonical.y+.5-K[1];return _e*_e+ve*ve<he})}return b}coveringTiles(i){let a=this.coveringZoomLevel(i);const m=a,b=this.elevation&&this.elevation.exaggeration(),w=b&&!i.isTerrainDEM,E=this.projection.name==="mercator";if(i.minzoom!==void 0&&a<i.minzoom)return[];i.maxzoom!==void 0&&a>i.maxzoom&&(a=i.maxzoom);const R=this.locationCoordinate(this.center),z=this.center.lat,N=1<<a,j=[N*R.x,N*R.y,0],X=this.projection.name==="globe",K=!X,Q=r.bN.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,K),he=X?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),me=N*r.bD(1,this.center.lat),_e=this._camera.position[2]/r.bD(1,this.center.lat),ve=[N*he.x,N*he.y,_e*(K?1:me)],ke=X||b,De=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),Pe=this.isLODDisabled(!0)?a:0;let Fe;if(this._elevation&&i.isTerrainDEM)Fe=1e4*this._elevation.exaggeration();else if(this._elevation){const pt=this._elevation.getMinMaxForVisibleTiles();Fe=pt?pt.max:this._centerAltitude}else Fe=this._centerAltitude;const ze=i.isTerrainDEM?-Fe:this._elevation?this._elevation.getMinElevationBelowMSL():0,qe=this.projection.isReprojectedInTileSpace?r.bO(this):1,$e=pt=>{const zt=new r.a5(pt.x+25e-6,pt.y,pt.z),sn=new r.a5(pt.x,pt.y+25e-6,pt.z),ln=pt.toLngLat(),Ut=zt.toLngLat(),qt=sn.toLngLat(),Fn=this.locationCoordinate(ln),pn=this.locationCoordinate(Ut),Cn=this.locationCoordinate(qt),Yn=Math.hypot(pn.x-Fn.x,pn.y-Fn.y),Dn=Math.hypot(Cn.x-Fn.x,Cn.y-Fn.y);return Math.sqrt(Yn*Dn)*qe/25e-6},We=pt=>{const Vt=Fe,zt=ze;return{aabb:r.bR(this,N,0,0,0,pt,zt,Vt,this.projection),zoom:0,x:0,y:0,minZ:zt,maxZ:Vt,wrap:pt,fullyVisible:!1}},nt=[];let Ke=[];const Ye=a,ft=i.reparseOverscaled?m:a,kt=(_e-this._centerAltitude)*me,jt=pt=>{if(!this._elevation||!pt.tileID||!E)return;const Vt=this._elevation.getMinMaxForTile(pt.tileID),zt=pt.aabb;Vt?(zt.min[2]=Vt.min,zt.max[2]=Vt.max,zt.center[2]=(zt.min[2]+zt.max[2])/2):(pt.shouldSplit=nn(pt),pt.shouldSplit||(zt.min[2]=zt.max[2]=zt.center[2]=this._centerAltitude))},Pt=(pt,Vt)=>{if(.707*Vt<pt)return 1;const zt=Vt/pt;return zt/(1.4144271570014144+(Math.pow(1.1,zt-1.4144271570014144+1)-1)/(1.1-1)-1)},nn=pt=>{if(pt.zoom<Pe)return!0;if(pt.zoom===Ye)return!1;if(pt.shouldSplit!=null)return pt.shouldSplit;const Vt=pt.aabb.distanceX(ve),zt=pt.aabb.distanceY(ve);let sn=kt,ln=1;if(X){sn=pt.aabb.distanceZ(ve);const Dn=Math.pow(2,pt.zoom),qn=r.aM((pt.y+1)/Dn),di=r.aM(pt.y/Dn),ai=Math.min(Math.max(z,qn),di),Hi=r.c5(ai)/r.c5(z);if(ln=ai===z?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Hi/this._mercatorScaleRatio),this.zoom<=r.c2&&pt.zoom===Ye-1&&Hi>=.9)return!0}else if(w&&(sn=pt.aabb.distanceZ(ve)*me),this.projection.isReprojectedInTileSpace&&m<=5){const Dn=Math.pow(2,pt.zoom),qn=$e(new r.a5((pt.x+.5)/Dn,(pt.y+.5)/Dn));ln=qn>.85?1:qn}if(!E){const Dn=Math.sqrt(Vt*Vt+zt*zt+sn*sn);let qn=(1<<Ye-pt.zoom)*De*ln;return qn*=Pt(Math.max(sn,kt),Dn),Dn<qn}let Ut=Number.MAX_VALUE,qt=0;const Fn=pt.aabb.getCorners(),pn=[];for(const Dn of Fn){r.a6.vec3.sub(pn,Dn,ve),X||(w?pn[2]*=me:pn[2]=kt);const qn=r.a6.vec3.dot(pn,this._camera.forward());qn<Ut&&(Ut=qn,qt=Math.abs(pn[2]))}let Cn=(1<<Ye-pt.zoom)*De*ln;if(Cn*=Pt(Math.max(qt,kt),Ut),Ut<Cn)return!0;const Yn=pt.aabb.closestPoint(j);return Yn[0]===j[0]&&Yn[1]===j[1]};if(this.renderWorldCopies)for(let pt=1;pt<=3;pt++)nt.push(We(-pt)),nt.push(We(pt));for(nt.push(We(0));nt.length>0;){const pt=nt.pop(),Vt=pt.x,zt=pt.y;let sn=pt.fullyVisible;const ln=()=>this.projection.name==="globe"&&(pt.y===0||pt.y===(1<<pt.zoom)-1);if(!sn){let Ut=ke?pt.aabb.intersects(Q):pt.aabb.intersectsFlat(Q);if(Ut===0&&ln()){const qt=new r.bP(pt.zoom,Vt,zt);Ut=r.bQ(this,N,qt,!0).intersects(Q)}if(Ut===0)continue;sn=Ut===2}if(pt.zoom!==Ye&&nn(pt))for(let Ut=0;Ut<4;Ut++){const qt=(Vt<<1)+Ut%2,Fn=(zt<<1)+(Ut>>1),pn={aabb:E?pt.aabb.quadrant(Ut):r.bR(this,N,pt.zoom+1,qt,Fn,pt.wrap,pt.minZ,pt.maxZ,this.projection),zoom:pt.zoom+1,x:qt,y:Fn,wrap:pt.wrap,fullyVisible:sn,tileID:void 0,shouldSplit:void 0,minZ:pt.minZ,maxZ:pt.maxZ};w&&!X&&(pn.tileID=new r.aA(pt.zoom+1===Ye?ft:pt.zoom+1,pt.wrap,pt.zoom+1,qt,Fn),jt(pn)),nt.push(pn)}else{const Ut=pt.zoom===Ye?ft:pt.zoom;if(i.minzoom&&i.minzoom>Ut)continue;let qt=0;if(!sn){let Yn=ke?pt.aabb.intersectsPrecise(Q):pt.aabb.intersectsPreciseFlat(Q);if(Yn===0&&ln()){const Dn=new r.bP(pt.zoom,Vt,zt);Yn=r.bQ(this,N,Dn,!0).intersectsPrecise(Q)}if(Yn===0)continue;if(i.calculateQuadrantVisibility)if(Q.containsPoint(pt.aabb.center))qt=15;else for(let Dn=0;Dn<4;Dn++)pt.aabb.quadrant(Dn).intersects(Q)!==0&&(qt|=1<<Dn)}const Fn=j[0]-(.5+Vt+(pt.wrap<<pt.zoom))*(1<<a-pt.zoom),pn=j[1]-.5-zt,Cn=pt.tileID?pt.tileID:new r.aA(Ut,pt.wrap,pt.zoom,Vt,zt);i.calculateQuadrantVisibility&&(Cn.visibleQuadrants=qt),Ke.push({tileID:Cn,distanceSq:Fn*Fn+pn*pn})}}if(this.fogCullDistSq){const pt=this.fogCullDistSq,Vt=this.horizonLineFromTop();Ke=Ke.filter(zt=>{const sn=[0,0,0,1],ln=[r.ab,r.ab,0,1],Ut=this.calculateFogTileMatrix(zt.tileID.toUnwrapped());r.a6.vec4.transformMat4(sn,sn,Ut),r.a6.vec4.transformMat4(ln,ln,Ut);const qt=r.a6.vec4.min([],sn,ln),Fn=r.a6.vec4.max([],sn,ln),pn=r.bS(qt,Fn);if(pn===0)return!0;let Cn=!1;const Yn=this._elevation;if(Yn&&pn>pt&&Vt!==0){const Dn=this.calculateProjMatrix(zt.tileID.toUnwrapped());let qn;i.isTerrainDEM||(qn=Yn.getMinMaxForTile(zt.tileID)),qn||(qn={min:ze,max:Fe});const di=r.c3(this.rotation),ai=[di[0]*r.ab,di[1]*r.ab,qn.max];r.a6.vec3.transformMat4(ai,ai,Dn),Cn=(1-ai[1])*this.height*.5<Vt}return pn<pt||Cn})}return Ke.sort((pt,Vt)=>pt.distanceSq-Vt.distanceSq).map(pt=>pt.tileID)}resize(i,a){this.width=i,this.height=a,this.pixelsToGLUnits=[2/i,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const a=r.ap(i.lat,-r.bT,r.bT),m=this.projection.project(i.lng,a);return new r.P(m.x*this.worldSize,m.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.bD(1,this.center.lat)/this.worldSize}setLocationAtPoint(i,a){let m,b;const w=this.centerPoint;if(this.projection.name==="globe"){const R=this.worldSize;m=(a.x-w.x)/R,b=(a.y-w.y)/R}else{const R=this.pointCoordinate(a),z=this.pointCoordinate(w);m=R.x-z.x,b=R.y-z.y}const E=this.locationCoordinate(i);this.setLocation(new r.a5(E.x-m,E.y-b))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this.projection.locationPoint(this,i,!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,a){const m=a?r.bD(a,i.lat):void 0,b=this.projection.project(i.lng,i.lat);return new r.a5(b.x,b.y,m)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,a){const m=a??this._centerAltitude,b=[i.x,i.y,0,1],w=[i.x,i.y,1,1];r.a6.vec4.transformMat4(b,b,this.pixelMatrixInverse),r.a6.vec4.transformMat4(w,w,this.pixelMatrixInverse);const E=w[3];r.a6.vec4.scale(b,b,1/b[3]),r.a6.vec4.scale(w,w,1/E);const R=b[2],z=w[2];return{p0:b,p1:w,t:R===z?0:(m-R)/(z-R)}}screenPointToMercatorRay(i){const a=[i.x,i.y,0,1],m=[i.x,i.y,1,1];return r.a6.vec4.transformMat4(a,a,this.pixelMatrixInverse),r.a6.vec4.transformMat4(m,m,this.pixelMatrixInverse),r.a6.vec4.scale(a,a,1/a[3]),r.a6.vec4.scale(m,m,1/m[3]),a[2]=r.bD(a[2],this._center.lat)*this.worldSize,m[2]=r.bD(m[2],this._center.lat)*this.worldSize,r.a6.vec4.scale(a,a,1/this.worldSize),r.a6.vec4.scale(m,m,1/this.worldSize),new r.aj([a[0],a[1],a[2]],r.a6.vec3.normalize([],r.a6.vec3.sub([],m,a)))}rayIntersectionCoordinate(i){const{p0:a,p1:m,t:b}=i,w=r.bD(a[2],this._center.lat),E=r.bD(m[2],this._center.lat);return new r.a5(r.aa(a[0],m[0],b)/this.worldSize,r.aa(a[1],m[1],b)/this.worldSize,r.aa(w,E,b))}pointCoordinate(i,a=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,a)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);let a=this.projection.pointCoordinate3D(this,i.x,i.y);if(a)return new r.a5(a[0],a[1],a[2]);let m=0,b=this.horizonLineFromTop();if(i.y>b)return this.pointCoordinate(i);const w=.02*b,E=i.clone();for(let R=0;R<10&&b-m>w;R++){E.y=r.aa(m,b,.66);const z=this.projection.pointCoordinate3D(this,E.x,E.y);z?(b=E.y,a=z):m=E.y}return a?new r.a5(a[0],a[1],a[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){return this.projection.isPointAboveHorizon(this,i)}isPointOnSurface(i){if(i.y<0||i.y>this.height||i.x<0||i.x>this.width)return!1;if(this.elevation||this.zoom>=r.bU)return!this.isPointAboveHorizon(i);const a=this.pointCoordinate(i);return a.y>=0&&a.y<=1}_coordinatePoint(i,a){const m=a&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,b=[i.x*this.worldSize,i.y*this.worldSize,m+i.toAltitude(),1];return r.a6.vec4.transformMat4(b,b,this.pixelMatrix),b[3]>0?new r.P(b[0]/b[3],b[1]/b[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:i,left:a}=this._edgeInsets,m=this.height-this._edgeInsets.bottom,b=this.width-this._edgeInsets.right,w=this.pointLocation3D(new r.P(a,i)),E=this.pointLocation3D(new r.P(b,i)),R=this.pointLocation3D(new r.P(b,m)),z=this.pointLocation3D(new r.P(a,m));let N=Math.min(w.lng,E.lng,R.lng,z.lng),j=Math.max(w.lng,E.lng,R.lng,z.lng),X=Math.min(w.lat,E.lat,R.lat,z.lat),K=Math.max(w.lat,E.lat,R.lat,z.lat);const Q=Math.pow(2,-this.zoom)/16*270,he=this.projection.name==="globe"?1:4,me=(_e,ve,ke,De,Pe)=>{const Fe=(_e+ke)/2,ze=(ve+De)/2,qe=new r.P(Fe,ze),{lng:$e,lat:We}=this.pointLocation3D(qe),nt=Math.max(0,N-$e,X-We,$e-j,We-K);N=Math.min(N,$e),j=Math.max(j,$e),X=Math.min(X,We),K=Math.max(K,We),(Pe<he||nt>Q)&&(me(_e,ve,Fe,ze,Pe+1),me(Fe,ze,ke,De,Pe+1))};if(me(a,i,b,i,1),me(b,i,b,m,1),me(b,m,a,m,1),me(a,m,a,i,1),this.projection.name==="globe"){const[_e,ve]=r.bV(this);_e?(K=90,j=180,N=-180):ve&&(X=-90,j=180,N=-180)}return new r.as(new r.bK(N,X),new r.bK(j,K))}_getBoundsRectangular(i,a){const{top:m,left:b}=this._edgeInsets,w=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,R=new r.P(b,m),z=new r.P(E,m),N=new r.P(E,w),j=new r.P(b,w);let X=this.pointCoordinate(R,i),K=this.pointCoordinate(z,i);const Q=this.pointCoordinate(N,a),he=this.pointCoordinate(j,a),me=(_e,ve)=>(ve.y-_e.y)/(ve.x-_e.x);return X.y>1&&K.y>=0?X=new r.a5((1-he.y)/me(he,X)+he.x,1):X.y<0&&K.y<=1&&(X=new r.a5(-he.y/me(he,X)+he.x,0)),K.y>1&&X.y>=0?K=new r.a5((1-Q.y)/me(Q,K)+Q.x,1):K.y<0&&X.y<=1&&(K=new r.a5(-Q.y/me(Q,K)+Q.x,0)),new r.as().extend(this.coordinateLocation(X)).extend(this.coordinateLocation(K)).extend(this.coordinateLocation(he)).extend(this.coordinateLocation(Q))}_getBoundsRectangularTerrain(){const i=this.elevation;if(!i.visibleDemTiles.length||i.isUsingMockSource())return this._getBoundsRectangular(0,0);const a=i.visibleDemTiles.reduce((m,b)=>{if(b.dem){const w=b.dem.tree;m.min=Math.min(m.min,w.minimums[0]),m.max=Math.max(m.max,w.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(a.min*i.exaggeration(),a.max*i.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(i=!0){const a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,m=this.height/2-a*(1-this._horizonShift);return i?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-r.bT,this.maxLat=r.bT,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.am(this.minLng)*this.tileSize,this.worldMaxX=r.am(this.maxLng)*this.tileSize,this.worldMinY=r.at(this.maxLat)*this.tileSize,this.worldMaxY=r.at(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,a){return this.projection.createTileMatrix(this,a,i)}calculateDistanceTileData(i){const a=i.key,m=this._distanceTileDataCache;if(m[a])return m[a];const b=i.canonical,w=1/this.height,E=this.cameraWorldSize,R=E/this.zoomScale(b.z),z=(b.x+Math.pow(2,b.z)*i.wrap)*R,N=b.y*R,j=this.point;j.x*=E/this.worldSize,j.y*=E/this.worldSize;const X=this.angle,K=Math.sin(-X),Q=-Math.cos(-X);return m[a]={bearing:[K,Q],center:[(j.x-z)*w,(j.y-N)*w],scale:R/r.ab*w},m[a]}calculateFogTileMatrix(i){const a=i.key,m=this._fogTileMatrixCache;if(m[a])return m[a];const b=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,i);return r.a6.mat4.multiply(b,this.worldToFogMatrix,b),m[a]=new Float32Array(b),m[a]}calculateProjMatrix(i,a=!1,m=!1){const b=i.key;let w;if(w=m?this._expandedProjMatrixCache:a?this._alignedProjMatrixCache:this._projMatrixCache,w[b])return w[b];const E=this.calculatePosMatrix(i,this.worldSize);let R;return R=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:m?this.expandedFarZProjMatrix:a?this.alignedProjMatrix:this.projMatrix,r.a6.mat4.multiply(E,R,E),w[b]=new Float32Array(E),w[b]}calculatePixelsToTileUnitsMatrix(i){const a=i.tileID.key,m=this._pixelsToTileUnitsCache;if(m[a])return m[a];const b=r.bW(i,this);return m[a]=b,m[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const i=1/this.worldSize,a=r.a6.mat4.fromScaling([],[i,i,i]);return r.a6.mat4.multiply(a,a,this.globeMatrix),a}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const i=this._elevation;this._updateCameraState();const a=r.bD(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(a),b=this._camera.forward(),w=r.bD(1,this._center.lat);m[2]/=w,b[2]/=w,r.a6.vec3.normalize(b,b);const E=i.raycast(m,b,i.exaggeration());if(E){const R=r.a6.vec3.scaleAndAdd([],m,b,E),z=new r.a5(R[0],R[1],r.bD(R[2],r.aM(R[1]))),N=(z.z+r.a6.vec3.length([z.x-m[0],z.y-m[1],z.z-m[2]*w]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(N),this._centerAltitude=z.toAltitude(),this._center=this.coordinateLocation(z),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(i=!1){if(!this._elevation)return;const a=this._elevation,m=r.bD(1,this._center.lat)*this.worldSize,b=this._computeCameraPosition(m),w=a.getAtPointOrZero(new r.a5(...b)),E=this.pixelsPerMeter/this.worldSize*w,R=this._minimumHeightOverTerrain(),z=b[2]-E;if(z<=R)if(z<0||i){const N=this.locationCoordinate(this._center,this._centerAltitude),j=[b[0],b[1],N.z-b[2]],X=r.a6.vec3.length(j);j[2]-=(R-z)/this._pixelsPerMercatorPixel;const K=r.a6.vec3.length(j);if(K===0)return;r.a6.vec3.scale(j,j,X/K*this._pixelsPerMercatorPixel),this._camera.position=[b[0],b[1],N.z*this._pixelsPerMercatorPixel-j[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||i){const K=this.center;return K.lat=r.ap(K.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!i)&&(K.lng=r.ap(K.lng,this.minLng,this.maxLng)),this.center=K,void(this._constraining=!1)}const a=this._unmodified,{x:m,y:b}=this.point;let w=0,E=m,R=b;const z=this.width/2,N=this.height/2,j=this.worldMinY*this.scale,X=this.worldMaxY*this.scale;if(b-N<j&&(R=j+N),b+N>X&&(R=X-N),X-j<this.height&&(w=Math.max(w,this.height/(X-j)),R=(X+j)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const K=this.worldMinX*this.scale,Q=this.worldMaxX*this.scale,he=this.worldSize/2-(K+Q)/2;E=(m+he+this.worldSize)%this.worldSize-he,E-z<K&&(E=K+z),E+z>Q&&(E=Q-z),Q-K<this.width&&(w=Math.max(w,this.width/(Q-K)),E=(Q+K)/2)}E===m&&R===b||(this.center=this.unproject(new r.P(E,R))),w&&(this.zoom+=this.scaleZoom(w)),this._constrainCamera(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,a=this.projection.name==="globe",m=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.bD(1,this.center.lat)/r.bD(1,r.c4));const b=r.bX(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,b),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const w=this.projection.zAxisUnit==="meters"?m:1,E=this._camera.getWorldToCamera(this.worldSize,w);let R;const z=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(z[8]=2*-i.x/this.width,z[9]=2*i.y/this.height,this.isOrthographic){let We=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),nt=We*this.aspect,Ke=-nt,Ye=-We;nt-=i.x,Ke-=i.x,We+=i.y,Ye+=i.y,R=this._camera.getCameraToClipOrthographic(Ke,nt,Ye,We,this._nearZ,this._farZ),((ft,kt,jt,Pt)=>{for(let nn=0;nn<16;nn++)ft[nn]=au(kt[nn],jt[nn],Pt)})(R,R,z,lu(this.pitch>=15?1:this.pitch/15))}else R=z;const N=r.a6.mat4.mul([],z,E);let j=r.a6.mat4.mul([],R,E);if(this.projection.isReprojectedInTileSpace){const We=this.locationCoordinate(this.center),nt=r.a6.mat4.identity([]);r.a6.mat4.translate(nt,nt,[We.x*this.worldSize,We.y*this.worldSize,0]),r.a6.mat4.multiply(nt,nt,r.bY(this)),r.a6.mat4.translate(nt,nt,[-We.x*this.worldSize,-We.y*this.worldSize,0]),r.a6.mat4.multiply(j,j,nt),r.a6.mat4.multiply(N,N,nt),this.inverseAdjustmentMatrix=r.bZ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.a6.mat4.scale([],j,[this.worldSize,this.worldSize,this.worldSize/w,1]),this.projMatrix=j,this.invProjMatrix=r.a6.mat4.invert(new Float64Array(16),this.projMatrix),a){const We=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);We[8]=2*-i.x/this.width,We[9]=2*i.y/this.height,this.expandedFarZProjMatrix=r.a6.mat4.mul([],We,E)}else this.expandedFarZProjMatrix=this.projMatrix;const X=r.a6.mat4.invert([],R);this.frustumCorners=r.b_.fromInvProjectionMatrix(X,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.bN.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!a);const K=new Float32Array(16);r.a6.mat4.identity(K),r.a6.mat4.scale(K,K,[1,-1,1]),r.a6.mat4.rotateX(K,K,this._pitch),r.a6.mat4.rotateZ(K,K,this.angle);const Q=r.a6.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.a6.mat4.clone(Q);const he=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Q[8]=2*-i.x/this.width,Q[9]=2*(i.y+he)/this.height,this.skyboxMatrix=r.a6.mat4.multiply(K,Q,K);const me=this.point,_e=me.x,ve=me.y,ke=this.width%2/2,De=this.height%2/2,Pe=Math.cos(this.angle),Fe=Math.sin(this.angle),ze=_e-Math.round(_e)+Pe*ke+Fe*De,qe=ve-Math.round(ve)+Pe*De+Fe*ke,$e=new Float64Array(j);if(r.a6.mat4.translate($e,$e,[ze>.5?ze-1:ze,qe>.5?qe-1:qe,0]),this.alignedProjMatrix=$e,j=r.a6.mat4.create(),r.a6.mat4.scale(j,j,[this.width/2,-this.height/2,1]),r.a6.mat4.translate(j,j,[1,-1,0]),this.labelPlaneMatrix=j,j=r.a6.mat4.create(),r.a6.mat4.scale(j,j,[1,-1,1]),r.a6.mat4.translate(j,j,[-1,-1,0]),r.a6.mat4.scale(j,j,[2/this.width,2/this.height,1]),this.glCoordMatrix=j,this.pixelMatrix=r.a6.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,N),this._calcFogMatrices(),this._distanceTileDataCache={},j=r.a6.mat4.invert(new Float64Array(16),this.pixelMatrix),!j)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=j,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.b$(this);const We=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.a6.vec3.transformMat4(We,We,E),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=j;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSizeForFog,a=this.cameraPixelsPerMeter,m=this._camera.position,b=1/this.height/this._pixelsPerMercatorPixel,w=[i,i,a];r.a6.vec3.scale(w,w,b),r.a6.vec3.scale(m,m,-1),r.a6.vec3.multiply(m,m,w);const E=r.a6.mat4.create();r.a6.mat4.translate(E,E,m),r.a6.mat4.scale(E,E,w),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,a,b)}_computeCameraPosition(i){const a=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),b=this.point,w=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-i/this.worldSize*this._centerAltitude;return[b.x/this.worldSize-m[0]*w,b.y/this.worldSize-m[1]*w,i/this.worldSize*this._centerAltitude-m[2]*w]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=this._camera.position[2],b=i[2];let w=1;this.projection.wrap&&(this.center=this.center.wrap()),b>0&&(w=Math.min((a-m)/b,1)),this._camera.position=r.a6.vec3.scaleAndAdd([],this._camera.position,i,w),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,a=this._camera.forward(),{pitch:m,bearing:b}=this._camera.getPitchBearing(),w=r.bD(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.bB(this._maxPitch)),R=Math.max((i[2]-w)/Math.cos(m),E),z=this._zoomFromMercatorZ(R);r.a6.vec3.scaleAndAdd(i,i,a,R),this._pitch=r.ap(m,r.bB(this.minPitch),r.bB(this.maxPitch)),this.angle=r.bA(b,-Math.PI,Math.PI),this._setZoom(r.ap(z,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.a5(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}zoomFromMercatorZAdjusted(i){let a=0,m=r.bU,b=0,w=1/0;for(;m-a>1e-6&&m>a;){const E=a+.5*(m-a),R=this.tileSize*Math.pow(2,E),z=this.getCameraToCenterDistance(this.projection,E,R),N=this.scaleZoom(z/(i*this.tileSize)),j=Math.abs(E-N);j<w&&(w=j,b=E),E<N?a=E:m=E}return b}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(i,a){const m=Math.min(i.x,a.x),b=Math.max(i.x,a.x),w=Math.min(i.y,a.y),E=Math.max(i.y,a.y);if(w<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const R=[new r.P(m,w),new r.P(b,E),new r.P(m,E),new r.P(b,w)],z=this.renderWorldCopies?-3:0,N=this.renderWorldCopies?4:1;for(const j of R){const X=this.pointRayIntersection(j);if(X.t<0)return!0;const K=this.rayIntersectionCoordinate(X);if(K.x<z||K.y<0||K.x>N||K.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.c0(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(i,a){const m=r.a6.vec3.length(r.a6.vec3.sub([],this._camera.position,i)),b=this._zoomFromMercatorZ(m)+a;return m-this._mercatorZfromZoom(b)}getCameraPoint(){if(this.projection.name==="globe"){const i=function([a,m,b],w){const E=[a,m,b,1];r.a6.vec4.transformMat4(E,E,w);const R=E[3]=Math.max(E[3],1e-6);return E[0]/=R,E[1]/=R,E[2]/=R,E}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(i[0],i[1])}{const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,i))}}getCameraToCenterDistance(i,a=this.zoom,m=this.worldSize){const b=r.bX(i,a,this.width,this.height,1024),w=i.pixelSpaceConversion(this.center.lat,m,b);let E=.5/Math.tan(.5*this._fov)*this.height*w;return this.isOrthographic&&(E=au(1,E,lu(this.pitch>=15?1:this.pitch/15))),E}getWorldToCameraMatrix(){const i=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.a6.mat4.multiply(i,i,this.globeMatrix),i}getFrustum(i){return r.bN.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,this.projection.zAxisUnit==="meters")}}const Sl=(p,i)=>{if(i>0&&p.terrain&&r.w("Cutoff is currently disabled on terrain"),i<=0||p.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const a=p.transform,m=Math.max(Math.abs(a._zoom-(p.minCutoffZoom-1)),1),b=a.isLODDisabled(!1)?r.a7(60,45,a.pitch):r.a7(30,15,a.pitch),w=a._farZ-a._nearZ,E=i*a.height,R=((1-(z=b))*a.cameraToCenterDistance+z*(a._farZ+E))*m;var z;return{shouldRenderCutoff:b<1,uniformValues:{u_cutoff_params:[a._nearZ,a._farZ,(R-a._nearZ)/w,(R-E-a._nearZ)/w]}}},$r={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Wp{constructor(i,a){this.aabb=i,this.lastCascade=a}}class _n{add(i,a){const m=this.receivers[i.key];m!==void 0?(m.aabb.min[0]=Math.min(m.aabb.min[0],a.min[0]),m.aabb.min[1]=Math.min(m.aabb.min[1],a.min[1]),m.aabb.min[2]=Math.min(m.aabb.min[2],a.min[2]),m.aabb.max[0]=Math.max(m.aabb.max[0],a.max[0]),m.aabb.max[1]=Math.max(m.aabb.max[1],a.max[1]),m.aabb.max[2]=Math.max(m.aabb.max[2],a.max[2])):this.receivers[i.key]=new Wp(a,null)}clear(){this.receivers={}}get(i){return this.receivers[i.key]}computeRequiredCascades(i,a,m){const b=r.c9.fromPoints(i.points);let w=0;for(const E in this.receivers){const R=this.receivers[E];if(!R||!b.intersectsAabb(R.aabb))continue;R.aabb.min=b.closestPoint(R.aabb.min),R.aabb.max=b.closestPoint(R.aabb.max);const z=R.aabb.getCorners();for(let N=0;N<m.length;N++){let j=!0;for(const X of z){const K=[X[0]*a,X[1]*a,X[2]];if(r.a6.vec3.transformMat4(K,K,m[N].matrix),K[0]<-1||K[0]>1||K[1]<-1||K[1]>1){j=!1;break}}if(R.lastCascade=N,w=Math.max(w,N),j)break}}return w+1}}class z_{constructor(i){this.painter=i,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new _n,this._depthMode=new dt(i.context.gl.LEQUAL,dt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,i.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),i.tp.registerParameter($r,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),i.tp.registerParameter($r,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),i.tp.registerParameter($r,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),i.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const i of this._cascades)i.texture.destroy(),i.framebuffer.destroy();this._cascades=[]}updateShadowParameters(i,a){const m=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!a||!a.properties)return;const b=a.properties.get("shadow-intensity");if(!a.shadowsEnabled()||b<=0||(this._shadowLayerCount=m.style.order.reduce((he,me)=>{const _e=m.style._mergedLayers[me];return he+(_e.hasShadowPass()&&!_e.isHidden(i.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const w=m.context,E=$r.shadowMapResolution,R=$r.shadowMapResolution;if(this._cascades.length===0||$r.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let he=0;he<$r.cascadeCount;++he){const me=m._shadowMapDebug,_e=w.gl,ve=w.createFramebuffer(E,R,me,"texture"),ke=new r.T(w,{width:E,height:R,data:null},_e.DEPTH_COMPONENT16);if(ve.depthAttachment.set(ke.texture),me){const De=new r.T(w,{width:E,height:R,data:null},_e.RGBA8);ve.colorAttachment.set(De.texture)}this._cascades.push({framebuffer:ve,texture:ke,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.bN,scale:0})}}this.shadowDirection=Zd(a);let z=0;if(i.elevation){const he=i.elevation,me=[1e4,-1e4];he.visibleDemTiles.filter(_e=>_e.dem).forEach(_e=>{const ve=_e.dem.tree;me[0]=Math.min(me[0],ve.minimums[0]),me[1]=Math.max(me[1],ve.maximums[0])}),me[0]!==1e4&&(z=(me[1]-me[0])*he.exaggeration())}const N=1.5*i.cameraToCenterDistance,j=3*N,X=new Float64Array(16);for(let he=0;he<this._cascades.length;++he){const me=this._cascades[he];let _e=i.height/50,ve=1;$r.cascadeCount===1?ve=j:he===0?ve=N:(_e=N,ve=j);const[ke,De]=Yd(i,this.shadowDirection,_e,ve,$r.shadowMapResolution,z);me.scale=i.scale,me.matrix=ke,me.boundingSphereRadius=De,r.a6.mat4.invert(X,me.matrix),me.frustum=r.bN.fromInvProjectionMatrix(X,1,0,!0),me.far=ve}const K=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[K].far,this._cascades[K].far],this._uniformValues.u_shadow_intensity=b,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/$r.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=$r.shadowMapResolution,this._uniformValues.u_shadowmap_0=Po.ShadowMap0,this._uniformValues.u_shadowmap_1=Po.ShadowMap0+1,this._groundShadowTiles=m.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const Q=m.transform.elevation;for(const he of this._groundShadowTiles){let me={min:0,max:0};if(Q){const _e=Q.getMinMaxForTile(he);_e&&(me=_e)}this.addShadowReceiver(he.toUnwrapped(),me.min,me.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(i){this._enabled=i}drawShadowPass(i,a){if(!this.enabled)return;const m=this.painter,b=m.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(m.transform.getFrustum(0),m.transform.worldSize,this._cascades),b.viewport.set([0,0,$r.shadowMapResolution,$r.shadowMapResolution]);for(let w=0;w<this._numCascadesToRender;++w){m.currentShadowCascade=w,b.bindFramebuffer.set(this._cascades[w].framebuffer.framebuffer),b.clear({color:r.bz.white,depth:1});for(const E of i.order){const R=i._mergedLayers[E];if(!R.hasShadowPass()||R.isHidden(m.transform.zoom))continue;const z=i.getLayerSourceCache(R),N=z?a[z.id]:void 0;(R.type==="model"||N&&N.length)&&m.renderLayer(m,z,R,N)}}m.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const i=this.painter,a=i.style,m=i.context,b=a.directionalLight,w=a.ambientLight;if(!b||!w)return;const E=[],R=Sl(i,i.longestCutoffRange);R.shouldRenderCutoff&&E.push("RENDER_CUTOFF");const z=Xd(a,b,w),N=new dt(m.gl.LEQUAL,dt.ReadOnly,i.depthRangeFor3D);for(const j of this._groundShadowTiles){const X=j.toUnwrapped(),K=i.isTileAffectedByFog(j),Q=i.getOrCreateProgram("groundShadow",{defines:E,overrideFog:K});this.setupShadows(X,Q),i.uploadCommonUniforms(m,Q,X,null,R);const he={u_matrix:i.transform.calculateProjMatrix(X),u_ground_shadow_factor:z};Q.draw(i,m.gl.TRIANGLES,N,Kt.disabled,Be.multiply,Mn.disabled,he,"ground_shadow",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments,{},i.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Be.unblended:Be.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(i){const a=this.painter.transform,m=a.calculatePosMatrix(i,a.worldSize);return r.a6.mat4.multiply(m,this._cascades[this.painter.currentShadowCascade].matrix,m),Float32Array.from(m)}calculateShadowPassMatrixFromMatrix(i){return r.a6.mat4.multiply(i,this._cascades[this.painter.currentShadowCascade].matrix,i),Float32Array.from(i)}setupShadows(i,a,m,b=0){if(!this.enabled)return;const w=this.painter.transform,E=this.painter.context,R=E.gl,z=this._uniformValues,N=new Float64Array(16),j=w.calculatePosMatrix(i,w.worldSize);for(let X=0;X<this._cascades.length;X++)r.a6.mat4.multiply(N,this._cascades[X].matrix,j),z[X===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(N),E.activeTexture.set(R.TEXTURE0+Po.ShadowMap0+X),this._cascades[X].texture.bind(R.NEAREST,R.CLAMP_TO_EDGE);if(this.useNormalOffset=!!m,this.useNormalOffset){const X=r.c8(i.canonical),K=2/w.tileSize*r.ab/$r.shadowMapResolution,Q=K*this._cascades[0].boundingSphereRadius,he=K*this._cascades[this._cascades.length-1].boundingSphereRadius,me=(m==="vector-tile"?1:3)/Math.pow(2,b-i.canonical.z-(1-w.zoom+Math.floor(w.zoom)));z.u_shadow_normal_offset=[X,Q*me,he*me],z.u_shadow_bias=[6e-5,.0012,.012]}else z.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(E,z)}setupShadowsFromMatrix(i,a,m=!1){if(!this.enabled)return;const b=this.painter.context,w=b.gl,E=this._uniformValues,R=new Float64Array(16);for(let z=0;z<$r.cascadeCount;z++)r.a6.mat4.multiply(R,this._cascades[z].matrix,i),E[z===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(R),b.activeTexture.set(w.TEXTURE0+Po.ShadowMap0+z),this._cascades[z].texture.bind(w.NEAREST,w.CLAMP_TO_EDGE);if(this.useNormalOffset=m,m){const z=$r.normalOffset;E.u_shadow_normal_offset=[1,z,z],E.u_shadow_bias=[6e-5,.0012,.012]}else E.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(b,E)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(i,a,m,b){if(b[2]>=0)return{};const w=function(z,N,j){const X=j/(1<<z.canonical.z);return new r.c9([z.canonical.x*X+z.wrap*j,z.canonical.y*X+z.wrap*j,0],[(z.canonical.x+1)*X+z.wrap*j,(z.canonical.y+1)*X+z.wrap*j,N])}(i,a,m).getCorners(),E=a/-b[2];b[0]<0?(r.a6.vec3.add(w[0],w[0],[b[0]*E,0,0]),r.a6.vec3.add(w[3],w[3],[b[0]*E,0,0])):b[0]>0&&(r.a6.vec3.add(w[1],w[1],[b[0]*E,0,0]),r.a6.vec3.add(w[2],w[2],[b[0]*E,0,0])),b[1]<0?(r.a6.vec3.add(w[0],w[0],[0,b[1]*E,0]),r.a6.vec3.add(w[1],w[1],[0,b[1]*E,0])):b[1]>0&&(r.a6.vec3.add(w[2],w[2],[0,b[1]*E,0]),r.a6.vec3.add(w[3],w[3],[0,b[1]*E,0]));const R={};return R.vertices=w,R.planes=[cu(w[1],w[0],w[4]),cu(w[2],w[1],w[5]),cu(w[3],w[2],w[6]),cu(w[0],w[3],w[7])],R}addShadowReceiver(i,a,m){this._receivers.add(i,r.c9.fromTileIdAndHeight(i,a,m))}getMaxCascadeForTile(i){const a=this._receivers.get(i);return a&&a.lastCascade?a.lastCascade:0}}function cu(p,i,a){const m=r.a6.vec3.sub([],a,i),b=r.a6.vec3.sub([],p,i),w=r.a6.vec3.cross([],m,b),E=r.a6.vec3.length(w);return E===0?[0,0,1,0]:(r.a6.vec3.scale(w,w,1/E),[w[0],w[1],w[2],-r.a6.vec3.dot(w,i)])}function Zd(p){const i=p.properties.get("direction"),a=r.c7(i.x,i.y,i.z);a[2]=r.ap(a[2],0,75);const m=r.ca([a[0],a[1],a[2]]);return r.a6.vec3.fromValues(m.x,m.y,m.z)}function Xd(p,i,a){const m=i.properties.get("color"),b=i.properties.get("intensity"),w=i.properties.get("direction"),E=[w.x,w.y,w.z],R=a.properties.get("color"),z=a.properties.get("intensity"),N=Math.max(r.a6.vec3.dot([0,0,1],E),0),j=[0,0,0];r.a6.vec3.scale(j,R.toRenderColor(p.getLut(i.scope)).toArray01Linear().slice(0,3),z);const X=[0,0,0];return r.a6.vec3.scale(X,m.toRenderColor(p.getLut(a.scope)).toArray01Linear().slice(0,3),N*b),r.cb([j[0]>0?j[0]/(j[0]+X[0]):0,j[1]>0?j[1]/(j[1]+X[1]):0,j[2]>0?j[2]/(j[2]+X[2]):0])}function Yd(p,i,a,m,b,w){const E=p.zoom,R=p.scale,z=p.worldSize,N=1/z,j=p.aspect,X=Math.sqrt(1+j*j)*Math.tan(.5*p.fovX),K=X*X,Q=m-a,he=m+a;let me,_e;K>Q/he?(me=m,_e=m*X):(me=.5*he*(1+K),_e=.5*Math.sqrt(Q*Q+2*(m*m+a*a)*K+he*he*K*K));const ve=p.projection.pixelsPerMeter(p.center.lat,z),ke=p._camera.getCameraToWorldMercator(),De=[0,0,-me*N];r.a6.vec3.transformMat4(De,De,ke);let Pe=_e*N;const Fe=p._edgeInsets;if(!(Fe.left===0&&Fe.top===0&&Fe.right===0&&Fe.bottom===0||Fe.left===Fe.right&&Fe.top===Fe.bottom)){const sn=p._camera.getWorldToCamera(p.worldSize,p.projection.zAxisUnit==="meters"?ve:1),ln=p._camera.getCameraToClipPerspective(p._fov,p.width/p.height,a,m);ln[8]=2*-p.centerOffset.x/p.width,ln[9]=2*p.centerOffset.y/p.height;const Ut=new Float64Array(16);r.a6.mat4.mul(Ut,ln,sn);const qt=new Float64Array(16);r.a6.mat4.invert(qt,Ut);const Fn=r.bN.fromInvProjectionMatrix(qt,z,E,!0);for(const pn of Fn.points){const Cn=((ze=pn)[0]/=R,ze[1]/=R,ze[2]=r.bD(ze[2],p._center.lat),ze);Pe=Math.max(Pe,r.a6.vec3.len(r.a6.vec3.subtract([],De,Cn)))}}var ze;Pe*=b/(b-1);const qe=Math.acos(i[2]),$e=Math.atan2(-i[0],-i[1]),We=new Ea;We.position=De,We.setPitchBearing(qe,$e);const nt=We.getWorldToCamera(z,ve),Ke=Pe*z,Ye=Math.min(p._mercatorZfromZoom(17)*z*-2,-2*Ke),ft=We.getCameraToClipOrthographic(-Ke,Ke,-Ke,Ke,Ye,(Ke+w*ve)/i[2]),kt=new Float64Array(16);r.a6.mat4.multiply(kt,ft,nt);const jt=r.a6.vec3.fromValues(Math.floor(1e6*De[0])/1e6*z,Math.floor(1e6*De[1])/1e6*z,0),Pt=.5*b,nn=[0,0,0];r.a6.vec3.transformMat4(nn,jt,kt),r.a6.vec3.scale(nn,nn,Pt);const pt=[Math.floor(nn[0]),Math.floor(nn[1]),Math.floor(nn[2])],Vt=[0,0,0];r.a6.vec3.sub(Vt,nn,pt),r.a6.vec3.scale(Vt,Vt,-1/Pt);const zt=new Float64Array(16);return r.a6.mat4.identity(zt),r.a6.mat4.translate(zt,zt,Vt),r.a6.mat4.multiply(kt,zt,kt),[kt,Ke]}class Tl extends r.E{constructor(i){super(),this.requestManager=i,this.models={"":{}},this.numModelsLoading={}}loadModel(i,a){return r.aG(this.requestManager.transformRequest(a,r.R.Model).url).then(m=>{if(!m)return;const b=r.aH(m),w=new r.aI(i,void 0,void 0,b);return w.computeBoundsAndApplyParent(),w}).catch(m=>{if(m&&m.status===404)return null;this.fire(new r.t(new Error(`Could not load model ${i} from ${a}: ${m.message}`)))})}load(i,a){this.models[a]||(this.models[a]={});const m=Object.keys(i);this.numModelsLoading[a]=(this.numModelsLoading[a]||0)+m.length;const b=[];for(const w of m)b.push(this.loadModel(w,i[w]));Promise.allSettled(b).then(w=>{for(let E=0;E<w.length;E++){const{status:R,value:z}=w[E];R==="fulfilled"&&z&&(this.models[a][m[E]]={model:z,numReferences:1})}this.numModelsLoading[a]-=m.length,this.fire(new r.x("data",{dataType:"style"}))}).catch(w=>{this.fire(new r.t(new Error(`Could not load models: ${w.message}`)))})}isLoaded(){for(const i in this.numModelsLoading)if(this.numModelsLoading[i]>0)return!1;return!0}hasModel(i,a){return!!this.getModel(i,a)}getModel(i,a){return this.models[a]||(this.models[a]={}),this.models[a][i]?this.models[a][i].model:void 0}addModel(i,a,m){this.models[m]||(this.models[m]={}),this.hasModel(i,m)&&this.models[m][i].numReferences++,this.load({[i]:this.requestManager.normalizeModelURL(a)},m)}addModels(i,a){this.models[a]||(this.models[a]={});const m={};for(const b in i)this.models[a][b]={},m[b]=this.requestManager.normalizeModelURL(i[b]);this.load(m,a)}addModelsFromBucket(i,a){this.models[a]||(this.models[a]={});const m={};for(const b of i)this.hasModel(b,a)?this.models[a][b].numReferences++:m[b]=this.requestManager.normalizeModelURL(b);this.load(m,a)}removeModel(i,a){if(this.models[a]&&this.models[a][i]&&(this.models[a][i].numReferences--,this.models[a][i].numReferences===0)){const m=this.models[a][i].model;delete this.models[a][i],m.destroy()}}listModels(i){return this.models[i]||(this.models[i]={}),Object.keys(this.models[i])}upload(i,a){this.models[a]||(this.models[a]={});for(const m in this.models[a])this.models[a][m].model&&this.models[a][m].model.upload(i.context)}}const Zp=new r.a0({data:new r.a1(r._.colorTheme.data)}),ua=(p,i)=>at(p,i&&i.filter(a=>a.identifier!=="source.canvas")),Kd=r.ar(st,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),uu=r.ar(st,["setCenter","setZoom","setBearing","setPitch"]),B_={version:8,layers:[],sources:{}},F_={duration:300,delay:0};class ha extends r.E{constructor(i,a={}){super(),this.map=i,this.scope=a.scope||"",this.globalId=null,this.fragments=[],this.importDepth=a.importDepth||0,this.importsCache=a.importsCache||new Map,this.resolvedImports=a.resolvedImports||new Set,this.transition=r.l({},F_),this._buildingIndex=new Us(this),this.crossTileSymbolIndex=new le,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=a.styleChanges||new Ne,this.dispatcher=a.dispatcher?a.dispatcher:new r.cd(r.ce(),this),a.imageManager?this.imageManager=a.imageManager:(this.imageManager=new Et,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=a.glyphManager?a.glyphManager:new r.cf(i._requestManager,a.localFontFamily?r.cg.all:a.localIdeographFontFamily?r.cg.ideographs:r.cg.none,a.localFontFamily||a.localIdeographFontFamily),a.modelManager?this.modelManager=a.modelManager:(this.modelManager=new Tl(i._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null},this._styleColorThemeForScope={},this.options=a.configOptions?a.configOptions:new Map,this._configDependentLayers=a.configDependentLayers?a.configDependentLayers:new Set,this._config=a.config,this._initialConfig=a.initialConfig,this.dispatcher.broadcast("setReferrer",r.ch());const m=this;this._rtlTextPluginCallback=ha.registerForPluginStateChange(b=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:b.pluginStatus,pluginURL:b.pluginURL},(w,E)=>{if(r.ci(w),E&&E.every(R=>R))for(const R in m._sourceCaches){const z=m._sourceCaches[R],N=z.getSource().type;N!=="vector"&&N!=="geojson"||z.reload()}})}),this.on("data",b=>{if(b.dataType!=="source"||b.sourceDataType!=="metadata")return;const w=this.getOwnSource(b.sourceId);if(w&&w.vectorLayerIds)for(const E in this._layers){const R=this._layers[E];R.source===w.id&&this._validateLayer(R)}})}load(i){return i?(typeof i=="string"?this.loadURL(i):this.loadJSON(i),this):this}_getGlobalId(i){if(!i)return null;if(typeof i=="string"){if(r.f(i))return i;const a=r.cj(i);if(!a.startsWith("http"))try{return new URL(a,location.href).toString()}catch{return a}return a}return`json://${r.ck(JSON.stringify(i))}`}_diffStyle(i,a,m){this.globalId=this._getGlobalId(i);const b=(w,E)=>{try{E(null,this.setState(w,m))}catch(R){E(R,!1)}};if(typeof i=="string"){const w=this.map._requestManager.normalizeStyleURL(i),E=this.map._requestManager.transformRequest(w,r.R.Style);r.n(E,(R,z)=>{R?this.fire(new r.t(R)):z&&b(z,a)})}else typeof i=="object"&&b(i,a)}loadURL(i,a={}){this.fire(new r.x("dataloading",{dataType:"style"}));const m=typeof a.validate=="boolean"?a.validate:!r.f(i);this.globalId=this._getGlobalId(i),i=this.map._requestManager.normalizeStyleURL(i,a.accessToken),this.resolvedImports.add(i);const b=this.importsCache.get(i);if(b)return this._load(b,m);const w=this.map._requestManager.transformRequest(i,r.R.Style);this._request=r.n(w,(E,R)=>{if(this._request=null,E)this.fire(new r.t(E));else if(R)return this.importsCache.set(i,R),this._load(R,m)})}loadJSON(i,a={}){this.fire(new r.x("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(i),this._request=r.q.frame(()=>{this._request=null,this._load(i,a.validate!==!1)})}loadEmpty(){this.fire(new r.x("dataloading",{dataType:"style"})),this._load(B_,!1)}_loadImports(i,a,m){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const b=[];for(const w of i){const E=this._createFragmentStyle(w),R=new Promise(j=>{E.once("style.import.load",j),E.once("error",j)}).then(()=>this.mergeAll());if(b.push(R),this.resolvedImports.has(w.url)){E.loadEmpty();continue}const z=w.data||this.importsCache.get(w.url);z?(E.loadJSON(z,{validate:a}),this._isInternalStyle(z)&&(E.globalId=null)):w.url?E.loadURL(w.url,{validate:a}):E.loadEmpty();const N={style:E,id:w.id,config:w.config};if(m){const j=this.fragments.findIndex(({id:X})=>X===m);this.fragments=this.fragments.slice(0,j).concat(N).concat(this.fragments.slice(j))}else this.fragments.push(N)}return Promise.allSettled(b)}getImportGlobalIds(i=this,a=new Set){for(const m of i.fragments)m.style.globalId&&a.add(m.style.globalId),this.getImportGlobalIds(m.style,a);return[...a.values()]}_createFragmentStyle(i){const a=this.scope?r.av(i.id,this.scope):i.id;let m;const b=this._initialConfig&&this._initialConfig[a];(i.config||b)&&(m=r.l({},i.config,b));const w=new ha(this.map,{scope:a,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:m,configOptions:this.options,configDependentLayers:this._configDependentLayers});return w.setEventedParent(this.map,{style:w}),w}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(i){return this.isRootStyle()&&(i.fragment||!!i.schema&&i.fragment!==!1)}_load(i,a){const m=i.schema;if(this._isInternalStyle(i)){const E=r.l({},B_,{imports:[{id:"basemap",data:i,url:""}]});return void this._load(E,a)}if(this.updateConfig(this._config,m),a&&ua(this,To(i)))return;this._loaded=!0,this.stylesheet=r.cl(i);const b=()=>{for(const N in i.sources)this.addSource(N,i.sources[N],{validate:!1,isInitialLoad:!0});i.sprite?this._loadSprite(i.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(i.glyphs,this.scope);const E=bl(this.stylesheet.layers);if(this._order=E.map(N=>N.id),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const N=this.stylesheet.lights[0];this.light=new lt(N.properties,N.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new lt(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const N of E){const j=r.cq(N,this.scope,this._styleColorTheme.lut,this.options);j.configDependencies.size!==0&&this._configDependentLayers.add(j.fqid),j.setEventedParent(this,{layer:{id:j.id}}),this._layers[j.id]=j,this._serializedLayers[j.id]=j.serialize();const X=this.getOwnLayerSourceCache(j),K=!!this.directionalLight&&this.directionalLight.shadowsEnabled();X&&j.canCastShadows()&&K&&(X.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const R=this.stylesheet.terrain;R&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(R,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.x("data",{dataType:"style"}));const z=this.isRootStyle();i.imports?this._loadImports(i.imports,a).then(()=>{this._reloadImports(),this.fire(new r.x(z?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new r.x(z?"style.load":"style.import.load")))},w=this.stylesheet["color-theme"];if(this._styleColorTheme.colorTheme=w,w){const E=this._evaluateColorThemeData(w);this._loadColorTheme(E).then(()=>{b()}).catch(R=>{r.w(`Couldn't load color theme from the stylesheet: ${R}`),b()})}else this._styleColorTheme.lut=null,b()}isRootStyle(){return this.importDepth===0}mergeAll(){let i,a,m,b,w,E,R,z;const N={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(j=>{if(j.stylesheet){if(j.light!=null&&(i=j.light),j.stylesheet.lights)for(const X of j.stylesheet.lights)X.type==="ambient"&&j.ambientLight!=null&&(a=j.ambientLight),X.type==="directional"&&j.directionalLight!=null&&(m=j.directionalLight);b=this._prioritizeTerrain(b,j.terrain,j.stylesheet.terrain),j.stylesheet.fog&&j.fog!=null&&(w=j.fog),j.stylesheet.camera!=null&&(z=j.stylesheet.camera),j.stylesheet.projection!=null&&(E=j.stylesheet.projection),j.stylesheet.transition!=null&&(R=j.stylesheet.transition),N[j.scope]=j._styleColorTheme}}),this.light=i,this.ambientLight=a,this.directionalLight=m,this.fog=w,this._styleColorThemeForScope=N,b===null?delete this.terrain:this.terrain=b,this.camera=z||{"camera-projection":"perspective"},this.projection=E||{name:"mercator"},this.transition=r.l({},F_,R),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(i){const a=m=>{for(const b of m.fragments)a(b.style);i(m)};a(this)}_prioritizeTerrain(i,a,m){const b=i&&i.drapeRenderMode===0;return m===null?a&&a.drapeRenderMode===0?a:b?i:null:a!=null&&(!i||b||a&&a.drapeRenderMode===1)?a:i}mergeTerrain(){let i;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(a=>{i=this._prioritizeTerrain(i,a.terrain,a.stylesheet.terrain)}),i===null?delete this.terrain:this.terrain=i}mergeProjection(){let i;this.forEachFragmentStyle(a=>{a.stylesheet.projection!=null&&(i=a.stylesheet.projection)}),this.projection=i||{name:"mercator"}}mergeSources(){const i={},a={},m={};this.forEachFragmentStyle(b=>{for(const w in b._sourceCaches){const E=r.av(w,b.scope);i[E]=b._sourceCaches[w]}for(const w in b._otherSourceCaches){const E=r.av(w,b.scope);a[E]=b._otherSourceCaches[w]}for(const w in b._symbolSourceCaches){const E=r.av(w,b.scope);m[E]=b._symbolSourceCaches[w]}}),this._mergedSourceCaches=i,this._mergedOtherSourceCaches=a,this._mergedSymbolSourceCaches=m}mergeLayers(){const i={},a=[],m={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(w=>{for(const E of w._order){const R=w._layers[E];if(R.type==="slot"){const z=r.cm(E);if(i[z])continue;i[z]=[]}R.slot&&i[R.slot]?i[R.slot].push(R):a.push(R)}}),this._mergedOrder=[];const b=(w=[])=>{for(const E of w)if(E.type==="slot"){const R=r.cm(E.id);i[R]&&b(i[R]),this._mergedSlots.push(R)}else{const R=r.av(E.id,E.scope);this._mergedOrder.push(R),m[R]=E,E.is3D()&&(this._has3DLayers=!0),E.type==="circle"&&(this._hasCircleLayers=!0),E.type==="symbol"&&(this._hasSymbolLayers=!0),E.type==="clip"&&(this._clipLayerPresent=!0)}};b(a),this._mergedOrder.sort((w,E)=>{const R=m[w],z=m[E];return R.hasInitialOcclusionOpacityProperties?z.is3D()?1:0:R.is3D()&&z.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=m,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(i){return this.stylesheet.camera=r.l({},this.stylesheet.camera,i),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(i){return i.data?function(a,m,b){const w=r.l({},m);for(const R of Object.keys(r._.colorTheme))w[R]===void 0&&(w[R]=r._.colorTheme[R].default);const E=new r.$(Zp,a,new Map(b));return E.setTransitionOrValue(w,b),E.untransitioned().possiblyEvaluate(new r.a3(0))}(this.scope,i,this.options).get("data"):null}_loadColorTheme(i){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const a=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((m,b)=>{const w="data:image/png;base64,";if(!i||i.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void m();let E=i;E.startsWith(w)||(E=w+E);const R="mapbox-reserved-lut",z=new Image;z.src=E,z.onerror=()=>{this._styleColorTheme.lutLoading=!1,b(new Error("Failed to load image data"))},z.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==a)return void m();this._styleColorTheme.lutLoading=!1;const{width:N,height:j,data:X}=r.q.getImageData(z);if(j>32)return void b(new Error("The height of the image must be less than or equal to 32 pixels."));if(N!==j*j)return void b(new Error("The width of the image must be equal to the height squared."));this.getImage(R)&&this.removeImage(R),this.addImage(R,{data:new r.r({width:N,height:j},X),pixelRatio:1,sdf:!1,version:0});const K=this.imageManager.getImage(R,this.scope);K?(this._styleColorTheme.lut={image:K.data,data:i},m()):b(new Error("Missing LUT image."))}})}getLut(i){const a=this._styleColorThemeForScope[i];return a?a.lut:null}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(i){this._spriteRequest=function(a,m,b){let w,E,R;const z=r.q.devicePixelRatio>1?"@2x":"";let N=r.n(m.transformRequest(m.normalizeSpriteURL(a,z,".json"),r.R.SpriteJSON),(K,Q)=>{N=null,R||(R=K,w=Q,X())}),j=r.o(m.transformRequest(m.normalizeSpriteURL(a,z,".png"),r.R.SpriteImage),(K,Q)=>{j=null,R||(R=K,E=Q,X())});function X(){if(R)b(R);else if(w&&E){const K=r.q.getImageData(E),Q={};for(const he in w){const{width:me,height:_e,x:ve,y:ke,sdf:De,pixelRatio:Pe,stretchX:Fe,stretchY:ze,content:qe}=w[he],$e=new r.r({width:me,height:_e});r.r.copy(K,$e,{x:ve,y:ke},{x:0,y:0},{width:me,height:_e},null),Q[he]={data:$e,pixelRatio:Pe,sdf:De,stretchX:Fe,stretchY:ze,content:qe}}b(null,Q)}}return{cancel(){N&&(N.cancel(),N=null),j&&(j.cancel(),j=null)}}}(i,this.map._requestManager,(a,m)=>{if(this._spriteRequest=null,a)this.fire(new r.t(a));else if(m)for(const b in m)this.imageManager.addImage(b,this.scope,m[b]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.x("data",{dataType:"style"}))})}_validateLayer(i){const a=this.getOwnSource(i.source);if(!a)return;const m=i.sourceLayer;m&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(m)===-1)&&this.fire(new r.t(new Error(`Source layer "${m}" does not exist on source "${a.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:i}of this.fragments)if(!i.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((i,a)=>{const m=this.fragments[a];return m&&m.style&&(i.data=m.style.serialize()),i})}_serializeSources(){const i={};for(const a in this._sourceCaches){const m=this._sourceCaches[a].getSource();i[m.id]||(i[m.id]=m.serialize())}return i}_serializeLayers(i){const a=[];for(const m of i){const b=this._layers[m];b&&b.type!=="custom"&&a.push(b.serialize())}return a}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(i){return!!this.terrain&&i.isDraped(this.getLayerSourceCache(i))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(i){const a=this.getOwnLayer(i);if(a)return a;this.fire(new r.t(new Error(`The layer '${i}' does not exist in the map's style.`)))}_checkSource(i){const a=this.getOwnSource(i);if(a)return a;this.fire(new r.t(new Error(`The source '${i}' does not exist in the map's style.`)))}precompilePrograms(i,a){const m=this.map.painter;if(m)for(let b=i.minzoom||0;b<(i.maxzoom||25.5);b++){const w=i.getProgramIds();if(w)for(const E of w){const R=i.getDefaultProgramParams(E,a.zoom,this._styleColorTheme.lut);R&&(m.style=this,this.fog&&(m._fogVisible=!0,R.overrideFog=!0,m.getOrCreateProgram(E,R)),m._fogVisible=!1,R.overrideFog=!1,m.getOrCreateProgram(E,R),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(R.overrideRtt=!0,m.getOrCreateProgram(E,R)))}}}update(i){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(i),this.directionalLight&&this.directionalLight.recalculate(i);const a=this.calculateLightsBrightness();i.brightness=a||0,a!==this._brightness&&(this._brightness=a,this.dispatcher.broadcast("setBrightness",a));const m=this._changes.isDirty();let b=!1;if(this._changes.isDirty()){const E=this._changes.getLayerUpdatesByScope();for(const R in E){const{updatedIds:z,removedIds:N}=E[R];(z||N)&&(this._updateWorkerLayers(R,z,N),b=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(i),this.light&&this.light.updateTransitions(i),this.ambientLight&&this.ambientLight.updateTransitions(i),this.directionalLight&&this.directionalLight.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this._changes.reset()}const w={};for(const E in this._mergedSourceCaches){const R=this._mergedSourceCaches[E];w[E]=R.used,R.used=!1,R.tileCoverLift=0}for(const E of this._mergedOrder){const R=this._mergedLayers[E];if(R.recalculate(i,this._availableImages),!R.isHidden(i.zoom)){const z=this.getLayerSourceCache(R);z&&(z.used=!0,z.tileCoverLift=Math.max(z.tileCoverLift,R.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(R,i)}):this.precompilePrograms(R,i))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&b&&this.mergeLayers();for(const E in w){const R=this._mergedSourceCaches[E];w[E]!==R.used&&R.getSource().fire(new r.x("data",{sourceDataType:"visibility",dataType:"source",sourceId:R.getSource().id}))}this.light&&this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),m&&this.fire(new r.x("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=this._changes.getUpdatedImages();if(i.length){for(const a in this._sourceCaches)this._sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],i);this._changes.resetUpdatedImages()}}_updateWorkerLayers(i,a,m){const b=this.getFragmentStyle(i);b&&this.dispatcher.broadcast("updateLayers",{layers:a?b._serializeLayers(a):[],scope:i,removedIds:m||[],options:b.options})}setState(i,a){if(this._checkLoaded(),ua(this,To(i)))return!1;(i=r.cl(i)).layers=bl(i.layers);const m=function(E,R){if(!E)return[{command:st.setStyle,args:[R]}];let z=[];try{if(!r.bh(E.version,R.version))return[{command:st.setStyle,args:[R]}];if(r.bh(E.center,R.center)||z.push({command:st.setCenter,args:[R.center]}),r.bh(E.zoom,R.zoom)||z.push({command:st.setZoom,args:[R.zoom]}),r.bh(E.bearing,R.bearing)||z.push({command:st.setBearing,args:[R.bearing]}),r.bh(E.pitch,R.pitch)||z.push({command:st.setPitch,args:[R.pitch]}),r.bh(E.sprite,R.sprite)||z.push({command:st.setSprite,args:[R.sprite]}),r.bh(E.glyphs,R.glyphs)||z.push({command:st.setGlyphs,args:[R.glyphs]}),r.bh(E.imports,R.imports)||function(Q=[],he=[],me){he=he||[];const _e=(Q=Q||[]).map(Mr),ve=he.map(Mr),ke=Q.reduce(fr,{}),De=he.reduce(fr,{}),Pe=_e.slice();let Fe,ze,qe,$e;for(Fe=0,ze=0;Fe<_e.length;Fe++)qe=_e[Fe],De.hasOwnProperty(qe)?ze++:(me.push({command:st.removeImport,args:[qe]}),Pe.splice(Pe.indexOf(qe,ze),1));for(Fe=0,ze=0;Fe<ve.length;Fe++)qe=ve[ve.length-1-Fe],Pe[Pe.length-1-Fe]!==qe&&(ke.hasOwnProperty(qe)?(me.push({command:st.removeImport,args:[qe]}),Pe.splice(Pe.lastIndexOf(qe,Pe.length-ze),1)):ze++,$e=Pe[Pe.length-Fe],me.push({command:st.addImport,args:[De[qe],$e]}),Pe.splice(Pe.length-Fe,0,qe));for(const We of he){const nt=ke[We.id];nt&&!r.bh(nt,We)&&me.push({command:st.updateImport,args:[We.id,We]})}}(E.imports,R.imports,z),r.bh(E.transition,R.transition)||z.push({command:st.setTransition,args:[R.transition]}),r.bh(E.light,R.light)||z.push({command:st.setLight,args:[R.light]}),r.bh(E.fog,R.fog)||z.push({command:st.setFog,args:[R.fog]}),r.bh(E.projection,R.projection)||z.push({command:st.setProjection,args:[R.projection]}),r.bh(E.lights,R.lights)||z.push({command:st.setLights,args:[R.lights]}),r.bh(E.camera,R.camera)||z.push({command:st.setCamera,args:[R.camera]}),!r.bh(E["color-theme"],R["color-theme"]))return[{command:st.setStyle,args:[R]}];const N={},j=[];(function(Q,he,me,_e){let ve;for(ve in he=he||{},Q=Q||{})Q.hasOwnProperty(ve)&&(he.hasOwnProperty(ve)||tn(ve,me,_e));for(ve in he){if(!he.hasOwnProperty(ve))continue;const ke=he[ve];Q.hasOwnProperty(ve)?r.bh(Q[ve],ke)||(Q[ve].type==="geojson"&&ke.type==="geojson"&&In(Q,he,ve)?me.push({command:st.setGeoJSONSourceData,args:[ve,ke.data]}):xi(ve,he,me,_e)):en(ve,he,me)}})(E.sources,R.sources,j,N);const X=[];E.layers&&E.layers.forEach(Q=>{Q.source&&N[Q.source]?z.push({command:st.removeLayer,args:[Q.id]}):X.push(Q)});let K=E.terrain;K&&N[K.source]&&(z.push({command:st.setTerrain,args:[void 0]}),K=void 0),z=z.concat(j),r.bh(K,R.terrain)||z.push({command:st.setTerrain,args:[R.terrain]}),function(Q,he,me){he=he||[];const _e=(Q=Q||[]).map(Mr),ve=he.map(Mr),ke=Q.reduce(fr,{}),De=he.reduce(fr,{}),Pe=_e.slice(),Fe=Object.create(null);let ze,qe,$e,We,nt,Ke,Ye;for(ze=0,qe=0;ze<_e.length;ze++)$e=_e[ze],De.hasOwnProperty($e)?qe++:(me.push({command:st.removeLayer,args:[$e]}),Pe.splice(Pe.indexOf($e,qe),1));for(ze=0,qe=0;ze<ve.length;ze++)$e=ve[ve.length-1-ze],Pe[Pe.length-1-ze]!==$e&&(ke.hasOwnProperty($e)?(me.push({command:st.removeLayer,args:[$e]}),Pe.splice(Pe.lastIndexOf($e,Pe.length-qe),1)):qe++,Ke=Pe[Pe.length-ze],me.push({command:st.addLayer,args:[De[$e],Ke]}),Pe.splice(Pe.length-ze,0,$e),Fe[$e]=!0);for(ze=0;ze<ve.length;ze++)if($e=ve[ze],We=ke[$e],nt=De[$e],!Fe[$e]&&!r.bh(We,nt))if(r.bh(We.source,nt.source)&&r.bh(We["source-layer"],nt["source-layer"])&&r.bh(We.type,nt.type)){for(Ye in ar(We.layout,nt.layout,me,$e,null,st.setLayoutProperty),ar(We.paint,nt.paint,me,$e,null,st.setPaintProperty),r.bh(We.slot,nt.slot)||me.push({command:st.setSlot,args:[$e,nt.slot]}),r.bh(We.filter,nt.filter)||me.push({command:st.setFilter,args:[$e,nt.filter]}),r.bh(We.minzoom,nt.minzoom)&&r.bh(We.maxzoom,nt.maxzoom)||me.push({command:st.setLayerZoomRange,args:[$e,nt.minzoom,nt.maxzoom]}),We)We.hasOwnProperty(Ye)&&Ye!=="layout"&&Ye!=="paint"&&Ye!=="filter"&&Ye!=="metadata"&&Ye!=="minzoom"&&Ye!=="maxzoom"&&Ye!=="slot"&&(Ye.indexOf("paint.")===0?ar(We[Ye],nt[Ye],me,$e,Ye.slice(6),st.setPaintProperty):r.bh(We[Ye],nt[Ye])||me.push({command:st.setLayerProperty,args:[$e,Ye,nt[Ye]]}));for(Ye in nt)nt.hasOwnProperty(Ye)&&!We.hasOwnProperty(Ye)&&Ye!=="layout"&&Ye!=="paint"&&Ye!=="filter"&&Ye!=="metadata"&&Ye!=="minzoom"&&Ye!=="maxzoom"&&Ye!=="slot"&&(Ye.indexOf("paint.")===0?ar(We[Ye],nt[Ye],me,$e,Ye.slice(6),st.setPaintProperty):r.bh(We[Ye],nt[Ye])||me.push({command:st.setLayerProperty,args:[$e,Ye,nt[Ye]]}))}else me.push({command:st.removeLayer,args:[$e]}),Ke=Pe[Pe.lastIndexOf($e)+1],me.push({command:st.addLayer,args:[nt,Ke]})}(X,R.layers,z)}catch(N){console.warn("Unable to compute style diff:",N),z=[{command:st.setStyle,args:[R]}]}return z}(this.serialize(),i).filter(E=>!(E.command in uu));if(m.length===0)return!1;const b=m.filter(E=>!(E.command in Kd));if(b.length>0)throw new Error(`Unimplemented: ${b.map(E=>E.command).join(", ")}.`);const w=[];return m.forEach(E=>{w.push(this[E.command].apply(this,E.args))}),a&&Promise.all(w).then(a),this.stylesheet=i,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(i,a){return this.getImage(i)?this.fire(new r.t(new Error("An image with this name already exists."))):(this.imageManager.addImage(i,this.scope,a),this._afterImageUpdated(i),this)}updateImage(i,a){this.imageManager.updateImage(i,this.scope,a)}getImage(i){return this.imageManager.getImage(i,this.scope)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i,this.scope),this._afterImageUpdated(i),this):this.fire(new r.t(new Error("No image with this name exists.")))}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(i),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new r.x("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(i,a,m={}){return this._checkLoaded(),this._validate(Ze,`models.${i}`,a,null,m)||(this.modelManager.addModel(i,a,this.scope),this._changes.setDirty()),this}hasModel(i){return this.modelManager.hasModel(i,this.scope)}removeModel(i){return this.hasModel(i)?(this.modelManager.removeModel(i,this.scope),this):this.fire(new r.t(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(i,a,m={}){if(this._checkLoaded(),this.getOwnSource(i)!==void 0)throw new Error(`There is already a source with ID "${i}".`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(Eo,`sources.${i}`,a,null,m))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const b=Io(i,a,this.dispatcher,this);b.scope=this.scope,b.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(b.id),source:b.serialize(),sourceId:b.id}));const w=E=>{const R=(E?"symbol:":"other:")+b.id,z=r.av(R,this.scope),N=this._sourceCaches[R]=new to(z,b,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[b.id]=N,N.onAdd(this.map)};w(!1),a.type!=="vector"&&a.type!=="geojson"||w(!0),b.onAdd&&b.onAdd(this.map),m.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(i){this._checkLoaded();const a=this.getOwnSource(i);if(!a)throw new Error("There is no source with this ID");for(const b in this._layers)if(this._layers[b].source===i)return this.fire(new r.t(new Error(`Source "${i}" cannot be removed while layer "${b}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===i)return this.fire(new r.t(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const m=this.getOwnSourceCaches(i);for(const b of m){const w=r.cm(b.id);delete this._sourceCaches[w],this._changes.discardSourceCacheUpdate(b.id),b.fire(new r.x("data",{sourceDataType:"metadata",dataType:"source",sourceId:b.getSource().id})),b.setEventedParent(null),b.clearTiles()}return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],this.mergeSources(),a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(i,a){this._checkLoaded(),this.getOwnSource(i).setData(a),this._changes.setDirty()}getOwnSource(i){const a=this.getOwnSourceCache(i);return a&&a.getSource()}getOwnSources(){const i=[];for(const a in this._otherSourceCaches){const m=this.getOwnSourceCache(a);m&&i.push(m.getSource())}return i}areTilesLoaded(){const i=this._mergedSourceCaches;for(const a in i){const m=i[a]._tiles;for(const b in m){const w=m[b];if(w.state!=="loaded"&&w.state!=="errored")return!1}}return!0}setLights(i){if(this._checkLoaded(),!i)return delete this.ambientLight,void delete this.directionalLight;const a=this._getTransitionParameters();for(const b of i){if(this._validate(ys,"lights",b))return;switch(b.type){case"ambient":if(this.ambientLight){const w=this.ambientLight;w.set(b),w.updateTransitions(a)}else this.ambientLight=new Ri(b,ni||(ni=new r.a0({color:new r.a1(r._.properties_light_ambient.color),intensity:new r.a1(r._.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const w=this.directionalLight;w.set(b),w.updateTransitions(a)}else this.directionalLight=new Ri(b,Ai||(Ai=new r.a0({direction:new r.ad(r._.properties_light_directional.direction),color:new r.a1(r._.properties_light_directional.color),intensity:new r.a1(r._.properties_light_directional.intensity),"cast-shadows":new r.a1(r._.properties_light_directional["cast-shadows"]),"shadow-intensity":new r.a1(r._.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const m=new r.a3(this.z||0,a);this.ambientLight&&this.ambientLight.recalculate(m),this.directionalLight&&this.directionalLight.recalculate(m),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const i=this.directionalLight,a=this.ambientLight;if(!i||!a)return;const m=X=>.2126*(X[0]<=.03928?X[0]/12.92:Math.pow((X[0]+.055)/1.055,2.4))+.7152*(X[1]<=.03928?X[1]/12.92:Math.pow((X[1]+.055)/1.055,2.4))+.0722*(X[2]<=.03928?X[2]/12.92:Math.pow((X[2]+.055)/1.055,2.4)),b=i.properties.get("color").toRenderColor(null).toArray01(),w=i.properties.get("intensity"),E=i.properties.get("direction"),R=1-r.c7(E.x,E.y,E.z)[2]/90,z=m(b)*w*R,N=a.properties.get("color").toRenderColor(null).toArray01(),j=a.properties.get("intensity");return(z+m(N)*j)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const i=[];return this.directionalLight&&i.push(this.directionalLight.get()),this.ambientLight&&i.push(this.ambientLight.get()),i}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(i){if(!i)return this;if(r.cn(i)){const a=r.co(i),m=this.fragments.find(({id:w})=>w===a);if(!m)throw new Error(`Style import not found: ${i}`);const b=r.cm(i);return m.style.getFragmentStyle(b)}{const a=this.fragments.find(({id:m})=>m===i);if(!a)throw new Error(`Style import not found: ${i}`);return a.style}}getConfigProperty(i,a){const m=this.getFragmentStyle(i);if(!m)return null;const b=r.av(a,m.scope),w=m.options.get(b),E=w?w.value||w.default:null;return E?E.serialize():null}setConfigProperty(i,a,m){const b=this.getFragmentStyle(i);if(!b)return;const w=b.stylesheet.schema;if(!w||!w[a])return;const E=r.M(m);if(E.result!=="success")return void ua(this,E.value);const R=E.value.expression,z=r.av(a,b.scope),N=b.options.get(z);if(!N)return;let j;const{minValue:X,maxValue:K,stepValue:Q,type:he,values:me}=w[a],_e=r.M(w[a].default);_e.result==="success"&&(j=_e.value.expression),j?(this.options.set(z,{...N,value:R,default:j,minValue:X,maxValue:K,stepValue:Q,type:he,values:me}),this.updateConfigDependencies(a)):this.fire(new r.t(new Error(`No schema defined for the config option "${a}" in the "${i}" fragment.`)))}getConfig(i){const a=this.getFragmentStyle(i);if(!a)return null;const m=a.stylesheet.schema;if(!m)return null;const b={};for(const w in m){const E=r.av(w,a.scope),R=a.options.get(E),z=R?R.value||R.default:null;b[w]=z?z.serialize():null}return b}setConfig(i,a){const m=this.getFragmentStyle(i);m&&(m.updateConfig(a,m.stylesheet.schema),this.updateConfigDependencies())}getSchema(i){const a=this.getFragmentStyle(i);return a?a.stylesheet.schema:null}setSchema(i,a){const m=this.getFragmentStyle(i);m&&(m.stylesheet.schema=a,m.updateConfig(m._config,a),this.updateConfigDependencies())}updateConfig(i,a){if(this._config=i,i||a)if(a)for(const m in a){let b,w;const E=r.M(a[m].default);if(E.result==="success"&&(b=E.value.expression),i&&i[m]!==void 0){const K=r.M(i[m]);K.result==="success"&&(w=K.value.expression)}const{minValue:R,maxValue:z,stepValue:N,type:j,values:X}=a[m];if(b){const K=r.av(m,this.scope);this.options.set(K,{default:b,value:w,minValue:R,maxValue:z,stepValue:N,type:j,values:X})}else this.fire(new r.t(new Error(`No schema defined for config option "${m}".`)))}else this.fire(new r.t(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(i){for(const a of this._configDependentLayers){const m=this.getLayer(a);if(m){if(i&&!m.configDependencies.has(i))continue;m.possiblyEvaluateVisibility(),this._updateLayer(m)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.forEachFragmentStyle(a=>{if(a._styleColorTheme.colorTheme){const m=a._evaluateColorThemeData(a._styleColorTheme.colorTheme);(!a._styleColorTheme.lut&&m!==""||a._styleColorTheme.lut&&m!==a._styleColorTheme.lut.data)&&a.setColorTheme(a._styleColorTheme.colorTheme)}}),this._changes.setDirty()}addLayer(i,a,m={}){this._checkLoaded();const b=i.id;if(this._layers[b])return void this.fire(new r.t(new Error(`Layer with id "${b}" already exists on this map`)));let w;if(i.type==="custom"){if(ua(this,r.cp(i)))return;w=r.cq(i,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof i.source=="object"&&(this.addSource(b,i.source),i=r.cl(i),i=r.l(i,{source:b})),this._validate(vt,`layers.${b}`,i,{arrayIndex:-1},m))return;w=r.cq(i,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(w),w.setEventedParent(this,{layer:{id:b}}),this._serializedLayers[w.id]=w.serialize()}w.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid);let E=this._order.length;if(a){const j=this._order.indexOf(a);if(j===-1)return void this.fire(new r.t(new Error(`Layer with id "${a}" does not exist on this map.`)));w.slot===this._layers[a].slot?E=j:r.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(E,0,b),this._layerOrderChanged=!0,this._layers[b]=w;const R=this.getOwnLayerSourceCache(w),z=!!this.directionalLight&&this.directionalLight.shadowsEnabled();R&&w.canCastShadows()&&z&&(R.castsShadows=!0);const N=this._changes.getRemovedLayer(w);if(N&&w.source&&R&&w.type!=="custom"){this._changes.discardLayerRemoval(w);const j=r.av(w.source,w.scope);N.type!==w.type?this._changes.updateSourceCache(j,"clear"):(this._changes.updateSourceCache(j,"reload"),R.pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map),w.scope=this.scope,this.mergeLayers()}moveLayer(i,a){this._checkLoaded();const m=this._checkLayer(i);if(!m||i===a)return;const b=this._order.indexOf(i);this._order.splice(b,1);let w=this._order.length;if(a){const E=this._order.indexOf(a);if(E===-1)return void this.fire(new r.t(new Error(`Layer with id "${a}" does not exist on this map.`)));m.slot===this._layers[a].slot?w=E:r.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,i),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(i){this._checkLoaded();const a=this._checkLayer(i);if(!a)return;a.setEventedParent(null);const m=this._order.indexOf(i);this._order.splice(m,1),delete this._layers[i],delete this._serializedLayers[i],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(a.fqid),this._changes.removeLayer(a);const b=this.getOwnLayerSourceCache(a);if(b&&b.castsShadows){let w=!1;for(const E in this._layers)if(this._layers[E].source===a.source&&this._layers[E].canCastShadows()){w=!0;break}b.castsShadows=w}a.onRemove&&a.onRemove(this.map),this.mergeLayers()}getOwnLayer(i){return this._layers[i]}hasLayer(i){return i in this._mergedLayers}hasLayerType(i){for(const a in this._layers)if(this._layers[a].type===i)return!0;return!1}setLayerZoomRange(i,a,m){this._checkLoaded();const b=this._checkLayer(i);b&&(b.minzoom===a&&b.maxzoom===m||(a!=null&&(b.minzoom=a),m!=null&&(b.maxzoom=m),this._updateLayer(b)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(i,a){this._checkLoaded();const m=this._checkLayer(i);m&&m.slot!==a&&(m.slot=a,this._updateLayer(m))}setFilter(i,a,m={}){this._checkLoaded();const b=this._checkLayer(i);if(b&&!r.bh(b.filter,a))return a==null?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(ye,`layers.${b.id}.filter`,a,{layerType:b.type},m)||(b.filter=r.cl(a),this._updateLayer(b)))}getFilter(i){const a=this._checkLayer(i);if(a)return r.cl(a.filter)}setLayoutProperty(i,a,m,b={}){this._checkLoaded();const w=this._checkLayer(i);if(w&&!r.bh(w.getLayoutProperty(a),m)){if(m!=null&&(!b||b.validate!==!1)&&ua(w,Ve.call(To,{key:`layers.${i}.layout.${a}`,layerType:w.type,objectKey:a,value:m,styleSpec:r._,style:{glyphs:!0,sprite:!0}})))return;w.setLayoutProperty(a,m),w.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid),this._updateLayer(w)}}getLayoutProperty(i,a){const m=this._checkLayer(i);if(m)return m.getLayoutProperty(a)}setPaintProperty(i,a,m,b={}){this._checkLoaded();const w=this._checkLayer(i);if(!w||r.bh(w.getPaintProperty(a),m)||m!=null&&(!b||b.validate!==!1)&&ua(w,Te.call(To,{key:`layers.${i}.paint.${a}`,layerType:w.type,objectKey:a,value:m,styleSpec:r._})))return;const E=w.setPaintProperty(a,m);w.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid),E&&this._updateLayer(w),this._changes.updatePaintProperties(w)}getPaintProperty(i,a){const m=this._checkLayer(i);if(m)return m.getPaintProperty(a)}setFeatureState(i,a){this._checkLoaded();const m=i.source,b=i.sourceLayer,w=this._checkSource(m);if(!w)return;const E=w.type;if(E==="geojson"&&b)return void this.fire(new r.t(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(E==="vector"&&!b)return void this.fire(new r.t(new Error("The sourceLayer parameter must be provided for vector source types.")));i.id===void 0&&this.fire(new r.t(new Error("The feature id parameter must be provided.")));const R=this.getOwnSourceCaches(m);for(const z of R)z.setFeatureState(b,i.id,a)}removeFeatureState(i,a){this._checkLoaded();const m=i.source,b=this._checkSource(m);if(!b)return;const w=b.type,E=w==="vector"?i.sourceLayer:void 0;if(w==="vector"&&!E)return void this.fire(new r.t(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof i.id!="string"&&typeof i.id!="number")return void this.fire(new r.t(new Error("A feature id is required to remove its specific state property.")));const R=this.getOwnSourceCaches(m);for(const z of R)z.removeFeatureState(E,i.id,a)}getFeatureState(i){this._checkLoaded();const a=i.source,m=i.sourceLayer,b=this._checkSource(a);if(b){if(b.type!=="vector"||m)return i.id===void 0&&this.fire(new r.t(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(a)[0].getFeatureState(m,i.id);this.fire(new r.t(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(i){return this.stylesheet.transition=r.l({},this.stylesheet.transition,i),this.transition=this.stylesheet.transition,this}getTransition(){return r.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const i=this.getTerrain(),a=i&&this.terrain&&this.terrain.scope===this.scope?i:this.stylesheet.terrain;return r.cr({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:a,fog:this.stylesheet.fog,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},m=>m!==void 0)}_updateLayer(i){this._changes.updateLayer(i);const a=this.getLayerSourceCache(i),m=r.av(i.source,i.scope),b=this._changes.getUpdatedSourceCaches();i.source&&!b[m]&&a&&a.getSource().type!=="raster"&&(this._changes.updateSourceCache(m,"reload"),a.pause()),i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const a=R=>this._mergedLayers[R].is3D(),m=this.order,b={},w=[];for(let R=m.length-1;R>=0;R--){const z=m[R];if(a(z)){b[z]=R;for(const N of i){const j=N[z];if(j)for(const X of j)w.push(X)}}}w.sort((R,z)=>z.intersectionZ-R.intersectionZ);const E=[];for(let R=m.length-1;R>=0;R--){const z=m[R];if(a(z))for(let N=w.length-1;N>=0;N--){const j=w[N].feature;if(j.layer&&b[j.layer.id]<R)break;E.push(j),w.pop()}else for(const N of i){const j=N[z];if(j)for(const X of j)E.push(X.feature)}}return E}queryRenderedFeatures(i,a,m){a&&a.filter&&this._validate(ye,"queryRenderedFeatures.filter",a.filter,null,a),a.scope=this.scope,a.availableImages=this._availableImages,a.serializedLayers=this._serializedLayers;const b={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new r.t(new Error("parameters.layers must be an Array."))),[];for(const N of a.layers){const j=this._mergedLayers[N];if(!j)return this.fire(new r.t(new Error(`The layer '${N}' does not exist in the map's style and cannot be queried for features.`))),[];b[j.source]=!0}}const w=[],E=a.serializedLayers||{},R=a&&a.layers?a.layers.some(N=>{const j=this.getLayer(N);return j&&j.is3D()}):this.has3DLayers(),z=qi.createFromScreenPoints(i,m);for(const N in this._mergedSourceCaches){const j=this._mergedSourceCaches[N].getSource();if(!j||j.scope!==a.scope)continue;const X=this._mergedSourceCaches[N].getSource().id;a.layers&&!b[X]||w.push(xa(this._mergedSourceCaches[N],this._mergedLayers,E,z,a,m,R,!!this.map._showQueryGeometry))}return this.placement&&w.push(function(N,j,X,K,Q,he,me){const _e={},ve=he.queryRenderedSymbols(K),ke=[];for(const De of Object.keys(ve).map(Number))ke.push(me[De]);ke.sort(ta);for(const De of ke){const Pe=De.featureIndex.lookupSymbolFeatures(ve[De.bucketInstanceId],j,De.bucketIndex,De.sourceLayerIndex,Q.filter,Q.layers,Q.availableImages,N);for(const Fe in Pe){const ze=_e[Fe]=_e[Fe]||[],qe=Pe[Fe];qe.sort(($e,We)=>{const nt=De.featureSortOrder;if(nt){const Ke=nt.indexOf($e.featureIndex);return nt.indexOf(We.featureIndex)-Ke}return We.featureIndex-$e.featureIndex});for(const $e of qe)ze.push($e)}}for(const De in _e)_e[De].forEach(Pe=>{const Fe=Pe.feature,ze=X(N[De]);if(!ze)return;const qe=ze.getFeatureState(Fe.layer["source-layer"],Fe.id);Fe.source=Fe.layer.source,Fe.layer["source-layer"]&&(Fe.sourceLayer=Fe.layer["source-layer"]),Fe.state=qe});return _e}(this._mergedLayers,E,this.getLayerSourceCache.bind(this),z.screenGeometry,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(i,a){a&&a.filter&&this._validate(ye,"querySourceFeatures.filter",a.filter,null,a);const m=this.getOwnSourceCaches(i);let b=[];for(const w of m)b=b.concat(wa(w,a));return b}addSourceType(i,a,m){return ha.getSourceType(i)?m(new Error(`A source type called "${i}" already exists.`)):(ha.setSourceType(i,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:a.workerSourceURL},m):m(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(i,a,m={}){this._checkLoaded();const b=this.light.getLight();let w=!1;for(const R in i)if(!r.bh(i[R],b[R])){w=!0;break}if(!w)return;const E=this._getTransitionParameters();this.light.setLight(i,a,m),this.light.updateTransitions(E)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(i,a=1){if(this._checkLoaded(),!i)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),a===0&&delete this.terrain,i===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let m=i;const b=i.source==null;if(a===1){if(this.disableElevatedTerrain)return;if(typeof m.source=="object"){const R="terrain-dem-src";this.addSource(R,m.source),m=r.cl(m),m=r.l(m,{source:R})}const w=r.l({},m),E={};if(this.terrain&&b){w.source=this.terrain.get().source;const R=this.terrain?this.getFragmentStyle(this.terrain.scope):null;R&&(E.style=R.serialize())}if(this._validate(Qs,"terrain",w,E))return}if(!this.terrain||this.terrain.scope!==this.scope&&!b||this.terrain&&a!==this.terrain.drapeRenderMode){if(!m)return;this._createTerrain(m,a),this.fire(new r.x("data",{dataType:"style"}))}else{const w=this.terrain,E=w.get();for(const R of Object.keys(r._.terrain))!m.hasOwnProperty(R)&&r._.terrain[R].default&&(m[R]=r._.terrain[R].default);for(const R in i)if(!r.bh(i[R],E[R])){w.set(i,this.options),this.stylesheet.terrain=i;const z=this._getTransitionParameters({duration:0});w.updateTransitions(z),this.fire(new r.x("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const a=this.fog=new bi(i,this.map.transform,this.scope,this.options);this.stylesheet.fog=a.get();const m=this._getTransitionParameters({duration:0});a.updateTransitions(m)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const a=this.fog;if(!r.bh(a.get(),i)){a.set(i,this.options),this.stylesheet.fog=a.get();const m=this._getTransitionParameters({duration:0});a.updateTransitions(m)}}else this._createFog(i);this._markersNeedUpdate=!0}setColorTheme(i){this._checkLoaded();const a=()=>{for(const b in this._layers)this._layers[b].lut=this._styleColorTheme.lut;for(const b in this._sourceCaches)this._sourceCaches[b].clearTiles()};if(this._styleColorTheme.colorTheme=i,!i)return this._styleColorTheme.lut=null,void a();const m=this._evaluateColorThemeData(i);this._loadColorTheme(m).then(()=>{this.fire(new r.x("colorthemeset")),a()}).catch(b=>{r.w(`Couldn't set color theme: ${b}`)})}_getTransitionParameters(i){return{now:r.q.now(),transition:r.l(this.transition,i)}}updateDrapeFirstLayers(){if(!this.terrain)return;const i=[],a=[];for(const m of this._mergedOrder)this.isLayerDraped(this._mergedLayers[m])?i.push(m):a.push(m);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...a)}_createTerrain(i,a){const m=this.terrain=new Rt(i,a,this.scope,this.options);a===1&&(this.stylesheet.terrain=i),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const b=this._getTransitionParameters({duration:0});m.updateTransitions(b)}_force3DLayerUpdate(){for(const i in this._layers){const a=this._layers[i];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const a=this._layers[i];a.type==="symbol"&&this._updateLayer(a)}}_validate(i,a,m,b,w={}){if(w&&w.validate===!1)return!1;const E=r.l({},this.serialize());return ua(this,i.call(To,r.l({key:a,style:E,value:m,styleSpec:r._},b)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.cs.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._mergedLayers)this._mergedLayers[i].setEventedParent(null);for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles(),this._mergedSourceCaches[i].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(i){const a=this.getSourceCaches(i);for(const m of a)m.clearTiles()}clearSources(){for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles()}reloadSource(i){const a=this.getSourceCaches(i);for(const m of a)m.resume(),m.reload()}reloadSources(){for(const i of this.getSources())i.reload&&i.reload()}updateSources(i){let a;this.directionalLight&&(a=Zd(this.directionalLight));for(const m in this._mergedSourceCaches)this._mergedSourceCaches[m].update(i,void 0,void 0,a)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const a=this._sourceCaches[i];a.resume(),a.reload()}}_updatePlacement(i,a,m,b,w,E,R=!1){let z=!1,N=!1;const j={},X={};for(const K of this._mergedOrder){const Q=this._mergedLayers[K];if(Q.type!=="symbol")continue;const he=r.av(Q.source,Q.scope);let me=j[he];if(!me){const ve=this.getLayerSourceCache(Q);if(!ve)continue;const ke=ve.getRenderableIds(!0).map(De=>ve.getTileByID(De));X[he]=ke.slice(),me=j[he]=ke.sort((De,Pe)=>Pe.tileID.overscaledZ-De.tileID.overscaledZ||(De.tileID.isLessThan(Pe.tileID)?-1:1))}const _e=this.crossTileSymbolIndex.addLayer(Q,me,a.center.lng,a.projection);z=z||_e}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),R=R||this._layerOrderChanged||b===0,this._layerOrderChanged&&this.fire(new r.x("neworder")),(R||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.q.now(),a.zoom))&&(this.pauseablePlacement=new os(a,this._mergedOrder,R,m,b,w,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,j,X),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.q.now()),N=!0),z&&this.pauseablePlacement.placement.setStale()),N||z){this._buildingIndex.onNewFrame(a.zoom);for(let K=0;K<this._mergedOrder.length;K++){const Q=this._mergedLayers[this._mergedOrder[K]];if(Q.type!=="symbol")continue;const he=this.isLayerClipped(Q);this.placement.updateLayerOpacities(Q,j[r.av(Q.source,Q.scope)],K,he?E:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.q.now())}}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}addImport(i,a){this._checkLoaded();const m=this.stylesheet.imports=this.stylesheet.imports||[];if(m.findIndex(({id:w})=>w===i.id)!==-1)return void this.fire(new r.t(new Error(`Import with id '${i.id}' already exists in the map's style.`)));if(!a)return m.push(i),this._loadImports([i],!0);const b=m.findIndex(({id:w})=>w===a);return b===-1&&this.fire(new r.t(new Error(`Import with id "${a}" does not exist on this map.`))),this.stylesheet.imports=m.slice(0,b).concat(i).concat(m.slice(b)),this._loadImports([i],!0,a)}updateImport(i,a){this._checkLoaded();const m=this.stylesheet.imports||[],b=this.getImportIndex(i);return b===-1?this:typeof a=="string"?(this.setImportUrl(i,a),this):(a.url&&a.url!==m[b].url&&this.setImportUrl(i,a.url),r.bh(a.config,m[b].config)||this.setImportConfig(i,a.config),r.bh(a.data,m[b].data)||this.setImportData(i,a.data),this)}moveImport(i,a){this._checkLoaded();let m=this.stylesheet.imports||[];const b=this.getImportIndex(i);if(b===-1)return this;const w=this.getImportIndex(a);if(w===-1)return this;const E=m[b],R=this.fragments[b];return m=m.filter(({id:z})=>z!==i),this.fragments=this.fragments.filter(({id:z})=>z!==i),this.stylesheet.imports=m.slice(0,w).concat(E).concat(m.slice(w)),this.fragments=this.fragments.slice(0,w).concat(R).concat(this.fragments.slice(w)),this.mergeLayers(),this}setImportUrl(i,a){this._checkLoaded();const m=this.stylesheet.imports||[],b=this.getImportIndex(i);if(b===-1)return this;m[b].url=a;const w=this.fragments[b];return w.style=this._createFragmentStyle(m[b]),w.style.on("style.import.load",()=>this.mergeAll()),w.style.loadURL(a),this}setImportData(i,a){this._checkLoaded();const m=this.getImportIndex(i),b=this.stylesheet.imports||[];return m===-1?this:a?(this.fragments[m].style.setState(a),this._reloadImports(),this):(delete b[m].data,this.setImportUrl(i,b[m].url))}setImportConfig(i,a){this._checkLoaded();const m=this.getImportIndex(i),b=this.stylesheet.imports||[];if(m===-1)return this;a?b[m].config=a:delete b[m].config;const w=this.fragments[m],E=w.style.stylesheet&&w.style.stylesheet.schema;return w.config=a,w.style.updateConfig(a,E),this.updateConfigDependencies(),this}removeImport(i){this._checkLoaded();const a=this.stylesheet.imports||[],m=this.getImportIndex(i);m!==-1&&(a.splice(m,1),this.fragments[m].style._remove(),this.fragments.splice(m,1),this._reloadImports())}getImportIndex(i){const a=(this.stylesheet.imports||[]).findIndex(m=>m.id===i);return a===-1&&this.fire(new r.t(new Error(`Import '${i}' does not exist in the map's style and cannot be updated.`))),a}getLayer(i){return this._mergedLayers[i]}getSources(){const i=[];for(const a in this._mergedOtherSourceCaches){const m=this._mergedOtherSourceCaches[a];m&&i.push(m.getSource())}return i}getSource(i,a){const m=this.getSourceCache(i,a);return m&&m.getSource()}getLayerSource(i){const a=this.getLayerSourceCache(i);return a&&a.getSource()}getSourceCache(i,a){const m=r.av(i,a);return this._mergedOtherSourceCaches[m]}getLayerSourceCache(i){const a=r.av(i.source,i.scope);return i.type==="symbol"?this._mergedSymbolSourceCaches[a]:this._mergedOtherSourceCaches[a]}getSourceCaches(i){if(i==null)return Object.values(this._mergedSourceCaches);const a=[];return this._mergedOtherSourceCaches[i]&&a.push(this._mergedOtherSourceCaches[i]),this._mergedSymbolSourceCaches[i]&&a.push(this._mergedSymbolSourceCaches[i]),a}updateSourceCaches(){const i=this._changes.getUpdatedSourceCaches();for(const a in i){const m=i[a];m==="reload"?this.reloadSource(a):m==="clear"&&this.clearSource(a)}}updateLayers(i){const a=this._changes.getUpdatedPaintProperties();for(const m of a){const b=this.getLayer(m);b&&b.updateTransitions(i)}}getImages(i,a,m){this.imageManager.getImages(a.icons,a.scope,m),this._updateTilesForChangedImages();const b=w=>{w&&w.setDependencies(a.tileID.key,a.type,a.icons)};b(this._otherSourceCaches[a.source]),b(this._symbolSourceCaches[a.source])}getGlyphs(i,a,m){this.glyphManager.getGlyphs(a.stacks,a.scope,m)}getResource(i,a,m){return r.ct(a,m)}getOwnSourceCache(i){return this._otherSourceCaches[i]}getOwnLayerSourceCache(i){return i.type==="symbol"?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}getOwnSourceCaches(i){const a=[];return this._otherSourceCaches[i]&&a.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&a.push(this._symbolSourceCaches[i]),a}_isSourceCacheLoaded(i){const a=this.getOwnSourceCaches(i);return a.length===0?(this.fire(new r.t(new Error(`There is no source with ID '${i}'`))),!1):a.every(m=>m.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(i,a){if(!this._clipLayerPresent&&i.type!=="fill-extrusion")return!1;const m=i.type==="fill-extrusion"&&i.sourceLayer==="building";if(i.is3D()){if(m||a&&a.type==="batched-model"||i.type==="model")return!0}else if(i.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(i=>{i.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ha.getSourceType=function(p){return Ua[p]},ha.setSourceType=function(p,i){Ua[p]=i},ha.registerForPluginStateChange=r.cc;var V_=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Xp=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Yp=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Jd="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",N_=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,U_=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,j_=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,$_=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Kp=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,G_=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,vh=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Qd=[];Xl(V_,Qd),Xl(Yp,Qd),Xl(Xp,Qd);const yh={"_prelude_fog.vertex.glsl":U_,"_prelude_terrain.vertex.glsl":N_,"_prelude_shadow.vertex.glsl":G_,"_prelude_fog.fragment.glsl":j_,"_prelude_shadow.fragment.glsl":vh,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":$_,"_prelude_raster_particle.glsl":Kp},hu={};Ei("",N_),Ei(j_,U_),Ei(vh,G_),Ei($_,""),Ei(Kp,"");const bh=Ei(Xp,Yp),ef=V_;var Zl={background:Ei(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Ei(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Ei(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Ei("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ei(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Ei(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ei("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Ei("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Ei("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Ei(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Ei(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Ei(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Ei(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Ei(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Ei(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Ei(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Ei(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Ei(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Ei(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ei(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Ei(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=out_color.a;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trim_alpha,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Ei(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size/aspect;float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in float a_z_offset;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);
#ifdef ELEVATED_ROADS
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 halfCellProgress=normal.yx*32.0;float ele0=elevation(pos);float ele_line=max(ele0,max(elevation(pos+halfCellProgress),elevation(pos-halfCellProgress)));float ele1=elevation(pos+offsetTile);float ele2=elevation(pos-offsetTile);float ele_max=max(ele_line,0.5*(ele1+ele2));float ele=ele_max-ele0+ele1+a_z_offset ;gl_Position=u_matrix*vec4(pos+offsetTile,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*0.1*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width=floorwidth+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Ei(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Ei(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Ei("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Ei("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Ei(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Ei(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
}`),terrainRaster:Ei(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Ei("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Ei(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Jd),skyboxGradient:Ei(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Jd),skyboxCapture:Ei(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ei(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Ei(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Ei(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Ei(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Ei(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),occlusion:Ei("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Xl(p,i){const a=p.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let m of a)if(m=m.trim(),m[0]==="#"&&m.includes("if")&&!m.includes("endif")){m=m.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const b=m.split(" ");for(const w of b)i.includes(w)||i.push(w)}}function Ei(p,i){const a=/#include\s+"([^"]+)"/g,m=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let b=i.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);b&&(b=b.map(N=>{const j=N.split(" ");return j[j.length-1]}),b=[...new Set(b)]);const w={},E=[],R=[];if(p=p.replace(a,(N,j)=>(R.push(j),"")),(i=i.replace(a,(N,j)=>(E.push(j),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let z=[...Qd];Xl(p,z),Xl(i,z);for(const N of[...E,...R])yh[N]||console.error(`Undefined include: ${N}`),hu[N]||(hu[N]=[],Xl(yh[N],hu[N])),z=[...z,...hu[N]];return{fragmentSource:p=p.replace(m,(N,j,X,K,Q)=>(w[Q]=!0,j==="define"?`
#ifndef HAS_UNIFORM_u_${Q}
in ${X} ${K} ${Q};
#else
uniform ${X} ${K} u_${Q};
#endif
`:j==="initialize"?`
#ifdef HAS_UNIFORM_u_${Q}
    ${X} ${K} ${Q} = u_${Q};
#endif
`:j==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Q}
    in ${X} ${K} ${Q};
#endif
`:j==="initialize-attribute"?"":void 0)),vertexSource:i=i.replace(m,(N,j,X,K,Q)=>{const he=K==="float"?"vec2":K,me=Q.match(/color/)?"color":he;return j==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${Q}
in ${X} ${K} a_${Q};
#endif
`:w[Q]?j==="define"?`
#ifndef HAS_UNIFORM_u_${Q}
uniform lowp float u_${Q}_t;
in ${X} ${he} a_${Q};
out ${X} ${K} ${Q};
#else
uniform ${X} ${K} u_${Q};
#endif
`:j==="initialize"?me==="vec4"?`
#ifndef HAS_UNIFORM_u_${Q}
    ${Q} = a_${Q};
#else
    ${X} ${K} ${Q} = u_${Q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Q}
    ${Q} = unpack_mix_${me}(a_${Q}, u_${Q}_t);
#else
    ${X} ${K} ${Q} = u_${Q};
#endif
`:j==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Q}
    in ${X} ${K} a_${Q};
    out ${X} ${K} ${Q};
#endif
`:j==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Q}
    ${Q} = a_${Q};
#endif
`:void 0:j==="define"?`
#ifndef HAS_UNIFORM_u_${Q}
uniform lowp float u_${Q}_t;
in ${X} ${he} a_${Q};
#else
uniform ${X} ${K} u_${Q};
#endif
`:j==="define-instanced"?me==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${Q}0;
in vec4 a_${Q}1;
in vec4 a_${Q}2;
in vec4 a_${Q}3;
#else
uniform ${X} ${K} u_${Q};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${X} ${he} a_${Q};
#else
uniform ${X} ${K} u_${Q};
#endif
`:j==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${Q}
    ${X} ${K} ${Q} = a_${Q};
#endif
`:me==="vec4"?`
#ifndef HAS_UNIFORM_u_${Q}
    ${X} ${K} ${Q} = a_${Q};
#else
    ${X} ${K} ${Q} = u_${Q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Q}
    ${X} ${K} ${Q} = unpack_mix_${me}(a_${Q}, u_${Q}_t);
#else
    ${X} ${K} ${Q} = u_${Q};
#endif
`}),staticAttributes:b,usedDefines:z,vertexIncludes:E,fragmentIncludes:R}}class du{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(i,a,m,b,w,E,R,z){this.context=i;let N=this.boundPaintVertexBuffers.length!==b.length;for(let X=0;!N&&X<b.length;X++)this.boundPaintVertexBuffers[X]!==b[X]&&(N=!0);let j=this.boundDynamicVertexBuffers.length!==R.length;for(let X=0;!j&&X<R.length;X++)this.boundDynamicVertexBuffers[X]!==R[X]&&(j=!0);if(!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==m||N||j||this.boundIndexBuffer!==w||this.boundVertexOffset!==E)this.freshBind(a,m,b,w,E,R,z);else{i.bindVertexArrayOES.set(this.vao);for(const X of R)X&&(X.bind(),z&&X.instanceCount&&X.setVertexAttribDivisor(i.gl,a,z));w&&w.dynamicDraw&&w.bind()}}freshBind(i,a,m,b,w,E,R){const z=i.numAttributes,N=this.context,j=N.gl;this.vao&&this.destroy(),this.vao=N.gl.createVertexArray(),N.bindVertexArrayOES.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=b,this.boundVertexOffset=w,this.boundDynamicVertexBuffers=E,a.enableAttributes(j,i),a.bind(),a.setVertexAttribPointers(j,i,w);for(const X of m)X.enableAttributes(j,i),X.bind(),X.setVertexAttribPointers(j,i,w);for(const X of E)X&&(X.enableAttributes(j,i),X.bind(),X.setVertexAttribPointers(j,i,w),R&&X.instanceCount&&X.setVertexAttribDivisor(j,i,R));b&&b.bind(),N.currentNumAttributes=z}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function xh(p,i){const a=Math.pow(2,i.canonical.z),m=i.canonical.y;return[new r.a5(0,m/a).toLngLat().lat,new r.a5(0,(m+1)/a).toLngLat().lat]}function tf(p,i,a,m,b,w,E){const R=p.context,z=R.gl,N=a.hillshadeFBO;if(!N)return;p.prepareDrawTile();const j=p.isTileAffectedByFog(i),X=p.getOrCreateProgram("hillshade",{overrideFog:j});R.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,N.colorAttachment.get());const K=((_e,ve,ke,De)=>{const Pe=ke.paint.get("hillshade-shadow-color"),Fe=ke.paint.get("hillshade-highlight-color"),ze=ke.paint.get("hillshade-accent-color"),qe=ke.paint.get("hillshade-emissive-strength");let $e=r.bB(ke.paint.get("hillshade-illumination-direction"));if(ke.paint.get("hillshade-illumination-anchor")==="viewport")$e-=_e.transform.angle;else if(_e.style&&_e.style.enable3dLights()&&_e.style.directionalLight){const nt=_e.style.directionalLight.properties.get("direction"),Ke=r.c7(nt.x,nt.y,nt.z);$e=r.bB(Ke[1])}const We=!_e.options.moving;return{u_matrix:De||_e.transform.calculateProjMatrix(ve.tileID.toUnwrapped(),We),u_image:0,u_latrange:xh(0,ve.tileID),u_light:[ke.paint.get("hillshade-exaggeration"),$e],u_shadow:Pe.toRenderColor(ke.lut),u_highlight:Fe.toRenderColor(ke.lut),u_emissive_strength:qe,u_accent:ze.toRenderColor(ke.lut)}})(p,a,m,p.terrain?i.projMatrix:null);p.uploadCommonUniforms(R,X,i.toUnwrapped());const{tileBoundsBuffer:Q,tileBoundsIndexBuffer:he,tileBoundsSegments:me}=p.getTileBoundsBuffers(a);X.draw(p,z.TRIANGLES,b,w,E,Mn.disabled,K,m.id,Q,he,me)}function nf(p,i,a){if(!i.needsDEMTextureUpload)return;const m=p.context,b=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||p.getTileTexture(a.stride);const w=a.getPixels();i.demTexture?i.demTexture.update(w,{premultiply:!1}):i.demTexture=new r.T(m,w,b.R32F,{premultiply:!1}),i.needsDEMTextureUpload=!1}function wh(p,i,a){const m=p.context,b=m.gl;if(!i.dem)return;const w=i.dem;if(m.activeTexture.set(b.TEXTURE1),nf(p,i,w),!i.demTexture)return;i.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE);const E=w.dim;m.activeTexture.set(b.TEXTURE0);let R=i.hillshadeFBO;if(!R){const K=new r.T(m,{width:E,height:E,data:null},b.RGBA8);K.bind(b.LINEAR,b.CLAMP_TO_EDGE),R=i.hillshadeFBO=m.createFramebuffer(E,E,!0,"renderbuffer"),R.colorAttachment.set(K.texture)}m.bindFramebuffer.set(R.framebuffer),m.viewport.set([0,0,E,E]);const{tileBoundsBuffer:z,tileBoundsIndexBuffer:N,tileBoundsSegments:j}=p.getMercatorTileBoundsBuffers(),X=[];p.linearFloatFilteringSupported()&&X.push("TERRAIN_DEM_FLOAT_FORMAT"),p.getOrCreateProgram("hillshadePrepare",{defines:X}).draw(p,b.TRIANGLES,dt.disabled,Kt.disabled,Be.unblended,Mn.disabled,((K,Q)=>{const he=Q.stride,me=r.a6.mat4.create();return r.a6.mat4.ortho(me,0,r.ab,-r.ab,0,0,1),r.a6.mat4.translate(me,me,[0,-r.ab,0]),{u_matrix:me,u_image:1,u_dimension:[he,he],u_zoom:K.overscaledZ}})(i.tileID,w),a.id,z,N,j),i.needsHillshadePrepare=!1}class tr{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Jp extends tr{getDefault(){return r.bz.transparent}set(i){const a=this.current;(i.r!==a.r||i.g!==a.g||i.b!==a.b||i.a!==a.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class H_ extends tr{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class Qp extends tr{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class rf extends tr{getDefault(){return[!0,!0,!0,!0]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||i[2]!==a[2]||i[3]!==a[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Sh extends tr{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class q_ extends tr{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class W_ extends tr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const a=this.current;(i.func!==a.func||i.ref!==a.ref||i.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class Z_ extends tr{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||i[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class fu extends tr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;i?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=i,this.dirty=!1}}class X_ extends tr{getDefault(){return[0,1]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class Sb extends tr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;i?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=i,this.dirty=!1}}class Tb extends tr{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class Eb extends tr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;i?a.enable(a.BLEND):a.disable(a.BLEND),this.current=i,this.dirty=!1}}class em extends tr{getDefault(){const i=this.gl;return[i.ONE,i.ZERO,i.ONE,i.ZERO]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||i[2]!==a[2]||i[3]!==a[3]||this.dirty)&&(this.gl.blendFuncSeparate(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class tm extends tr{getDefault(){return r.bz.transparent}set(i){const a=this.current;(i.r!==a.r||i.g!==a.g||i.b!==a.b||i.a!==a.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class nm extends tr{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(i,i),this.current=i,this.dirty=!1)}}class im extends tr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;i?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=i,this.dirty=!1}}class Y_ extends tr{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class K_ extends tr{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}let Ib=class extends tr{getDefault(){return null}set(p){(p!==this.current||this.dirty)&&(this.gl.useProgram(p),this.current=p,this.dirty=!1)}};class Th extends tr{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class Eh extends tr{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const a=this.current;(i[0]!==a[0]||i[1]!==a[1]||i[2]!==a[2]||i[3]!==a[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class J_ extends tr{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class da extends tr{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class rm extends tr{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class of extends tr{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class sf extends tr{getDefault(){return null}set(i){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class om extends tr{getDefault(){return null}set(i){this.gl&&(i!==this.current||this.dirty)&&(this.gl.bindVertexArray(i),this.current=i,this.dirty=!1)}}class sm extends tr{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class af extends tr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class am extends tr{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class Ih extends tr{constructor(i,a){super(i),this.context=i,this.parent=a}getDefault(){return null}}class lf extends Ih{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class lm extends Ih{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Q_ extends Ih{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,this.attachment(),a.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class pu extends lm{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Cb=(p,i,a)=>({u_matrix:p,u_image0:0,u_skirt_height:i,u_ground_shadow_factor:a}),ev=(p,i,a,m,b,w,E,R,z,N,j,X,K,Q,he,me)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:i,u_normalize_matrix:Float32Array.from(m),u_merc_matrix:a,u_zoom_transition:b,u_merc_center:w,u_image0:0,u_frustum_tl:E,u_frustum_tr:R,u_frustum_br:z,u_frustum_bl:N,u_globe_pos:j,u_globe_radius:X,u_viewport:K,u_grid_matrix:me?Float32Array.from(me):new Float32Array(9),u_skirt_height:Q,u_far_z_cutoff:he});function tv(p,i){return p!=null&&i!=null&&!(!p.hasData()||!i.hasData())&&p.demTexture!=null&&i.demTexture!=null&&p.tileID.key!==i.tileID.key}const mu=new class{constructor(){this.operations={}}newMorphing(p,i,a,m,b){if(p in this.operations){const w=this.operations[p];w.to.tileID.key!==a.tileID.key&&(w.queued=a)}else this.operations[p]={startTime:m,phase:0,duration:b,from:i,to:a,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const i=this.operations[p];return{from:i.from,to:i.to,phase:i.phase}}update(p){for(const i in this.operations){const a=this.operations[i];for(a.phase=(p-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,p)){delete this.operations[i];break}}}_nextOp(p,i){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=i,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},nv={0:null,1:"TERRAIN_VERTEX_MORPHING"};function iv(p,i,a){if(i===0)return 0;const m=i<1&&a===514?.25/i:1;return 6*Math.pow(1.5,22-p)*Math.max(i,1)*m}function cm(p,i){const a=1<<p.z;return!i&&(p.x===0||p.x===a-1)||p.y===0||p.y===a-1}const Ch=p=>({u_matrix:p});function cf(p,i,a,m,b){if(b>0){const w=r.q.now(),E=(w-p.timeAdded)/b,R=i?(w-i.timeAdded)/b:-1,z=a.getSource(),N=m.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),j=!i||Math.abs(i.tileID.overscaledZ-N)>Math.abs(p.tileID.overscaledZ-N),X=j&&p.refreshedUponExpiration?1:r.ap(j?E:1-R,0,1);return p.refreshedUponExpiration&&E>=1&&(p.refreshedUponExpiration=!1),i?{opacity:1,mix:1-X}:{opacity:X,mix:0}}return{opacity:1,mix:0}}class gu extends to{constructor(i){const a={type:"raster-dem",maxzoom:i.transform.maxZoom},m=new r.cd(r.ce(),null),b=Io("mock-dem",a,m,i.style);super("mock-dem",b,!1),b.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,a){i.state="loaded",a(null)}}class rv extends to{constructor(i){const a=Io("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new r.cd(r.ce(),null),i.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,a,m){if(i.freezeTileCoverage)return;this.transform=i;const b=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((w,E)=>{if(w[E.key]="",!this._tiles[E.key]){const R=new cs(E,this._source.tileSize*E.overscaleFactor(),i.tileZoom);R.state="loaded",this._tiles[E.key]=R}return w},{});for(const w in this._tiles)w in b||(this.freeFBO(w),this._tiles[w].unloadVectorData(),delete this._tiles[w])}freeFBO(i){const a=this.proxyCachedFBO[i];if(a!==void 0){const m=Object.values(a);this.renderCachePool.push(...m),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class um extends r.aA{constructor(i,a,m){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=a,this.projMatrix=m}}class hm extends r.cE{constructor(i,a){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},i.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,b,w]=function(z){const N=new r.a_,j=new r.aO,X=131;N.reserve(17161),j.reserve(33800);const K=r.ab/128,Q=r.ab+K/2,he=Q+K;for(let _e=-K;_e<he;_e+=K)for(let ve=-K;ve<he;ve+=K){const ke=ve<0||ve>Q||_e<0||_e>Q?24575:0,De=r.ap(Math.round(ve),0,r.ab),Pe=r.ap(Math.round(_e),0,r.ab);N.emplaceBack(De+ke,Pe)}const me=(_e,ve)=>{const ke=ve*X+_e;j.emplaceBack(ke+1,ke,ke+X),j.emplaceBack(ke+X,ke+X+1,ke+1)};for(let _e=1;_e<129;_e++)for(let ve=1;ve<129;ve++)me(ve,_e);return[0,129].forEach(_e=>{for(let ve=0;ve<130;ve++)me(ve,_e),me(_e,ve)}),[N,j,32768]}(),E=i.context;this.gridBuffer=E.createVertexBuffer(m,r.b0.members),this.gridIndexBuffer=E.createIndexBuffer(b),this.gridSegments=r.b1.simpleSegment(0,0,m.length,b.length),this.gridNoSkirtSegments=r.b1.simpleSegment(0,0,m.length,w),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new rv(a.map),this.orthoMatrix=r.a6.mat4.create(),r.a6.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.ab,0,r.ab,0,1);const R=E.gl;this._overlapStencilMode=new Kt({func:R.GEQUAL,mask:255},0,255,R.KEEP,R.KEEP,R.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new gu(a.map),this._pendingGroundEffectLayers=[]}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),this._style=i,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(i,a,m){if(i&&i.terrain){this._style!==i&&(this.style=i,this._evaluationZoom=void 0);const b=i.terrain.properties,w=i.terrain.drapeRenderMode===0,E=i.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.q.now();const R=i.terrain&&i.terrain.scope,z=b.get("source"),N=w?this._mockSourceCache:i.getSourceCache(z,R);if(!N)return void r.w(`Couldn't find terrain source "${z}".`);if(this.sourceCache=N,this._exaggeration=E?this.calculateExaggeration(a):b.get("exaggeration"),!a.projection.requiresDraping&&E&&this._exaggeration===0)return void this._disable();this.enabled=!0;const j=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const X=this.getScaledDemTileSize();this.sourceCache.update(a,X,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,j(),this._initializing=!0),j(),a.updateElevation(!0,m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0,this._previousZoom=a.zoom}else this._disable()}calculateExaggeration(i){const a=this._previousCameraAltitude,m=i.getFreeCameraOptions().position.z/i.pixelsPerMeter*i.worldSize;this._previousCameraAltitude=m;const b=a!=null?m-a:Number.MAX_VALUE;if(Math.abs(b)<2)return this._exaggeration;const w=i.zoom,E=this._style.terrain;if(!this._previousUpdateTimestamp)return E.getExaggeration(w);let R=w-this._previousZoom;const z=this._previousUpdateTimestamp;let N=w;this._evaluationZoom!=null&&(N=this._evaluationZoom,Math.abs(w-N)>.5&&(R=.5*(w-N+R)),R*b<0&&(N+=R)),this._evaluationZoom=N;const j=E.getExaggeration(N),X=j===E.getExaggeration(Math.max(0,N-.1));if(X&&Math.abs(j-this._exaggeration)<.01)return j;let K=Math.min(.1,.00375*(this._updateTimestamp-z));return(X||j<.1||Math.abs(R)<1e-4)&&(K=Math.min(.2,4*K)),r.aa(this._exaggeration,j,K)}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(i){i.coord&&i.dataType==="source"?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):i.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._mergedSourceCaches)this._style._mergedSourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const a=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=m._centerAltitude===0&&this.getAtPointOrZero(r.a5.fromLngLat(m.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const b=this.proxyCoords=a.getIds().map(z=>{const N=a.getTileByID(z).tileID;return N.projMatrix=m.calculateProjMatrix(N.toUnwrapped()),N});(function(z,N){const j=N.transform.pointCoordinate(N.transform.getCameraPoint()),X=new r.P(j.x,j.y);z.sort((K,Q)=>{if(Q.overscaledZ-K.overscaledZ)return Q.overscaledZ-K.overscaledZ;const he=new r.P(K.canonical.x+(1<<K.canonical.z)*K.wrap,K.canonical.y),me=new r.P(Q.canonical.x+(1<<Q.canonical.z)*Q.wrap,Q.canonical.y),_e=X.mult(1<<K.canonical.z);return _e.x-=.5,_e.y-=.5,_e.distSqr(he)-_e.distSqr(me)})})(b,this.painter);const w=this.proxyToSource||{};this.proxyToSource={},b.forEach(z=>{this.proxyToSource[z.key]={}}),this.terrainTileForTile={};const E=this._style._mergedSourceCaches;for(const z in E){const N=E[z];if(!N.used||(N!==this.sourceCache&&this.resetTileLookupCache(N.id),this._setupProxiedCoordsForOrtho(N,i[z],w),N.usedForTerrain))continue;const j=i[z];N.getSource().reparseOverscaled&&this._assignTerrainTiles(j)}this.proxiedCoords[a.id]=b.map(z=>new um(z,z.key,this.orthoMatrix)),this._assignTerrainTiles(b),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(w),this.renderingToTexture=!1;const R={};this._visibleDemTiles=[];for(const z of this.proxyCoords){const N=this.terrainTileForTile[z.key];if(!N)continue;const j=N.tileID.key;j in R||(this._visibleDemTiles.push(N),R[j]=j)}}_assignTerrainTiles(i){this._initializing||i.forEach(a=>{if(this.terrainTileForTile[a.key])return;const m=this._findTileCoveringTileID(a,this.sourceCache);m&&(this.terrainTileForTile[a.key]=m)})}_prepareDEMTextures(){const i=this.painter.context,a=i.gl;for(const m in this.terrainTileForTile){const b=this.terrainTileForTile[m],w=b.dem;!w||b.demTexture&&!b.needsDEMTextureUpload||(i.activeTexture.set(a.TEXTURE1),nf(this.painter,b,w))}}_prepareDemTileUniforms(i,a,m,b){if(!a||a.demTexture==null)return!1;const w=i.tileID.canonical,E=Math.pow(2,a.tileID.canonical.z-w.z),R=b||"";return m[`u_dem_tl${R}`]=[w.x*E%1,w.y*E%1],m[`u_dem_scale${R}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let i=0;const a=this._visibleDemTiles.reduce((m,b)=>{if(!b.dem)return m;const w=b.dem.tree.minimums[0];return w>0&&i++,m+w},0);return i?a/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,a=i.gl;i.activeTexture.set(a.TEXTURE2);const m=this._getLoadedAreaMinimum(),b=new r.cF({width:1,height:1},new Float32Array([m]));this._emptyDEMTextureDirty=!1;let w=this._emptyDEMTexture;return w?w.update(b,{premultiply:!1}):w=this._emptyDEMTexture=new r.T(i,b,a.R32F,{premultiply:!1}),w}setupElevationDraw(i,a,m){const b=this.painter.context,w=b.gl,E={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};E.u_exaggeration=this.exaggeration();let R=null,z=null,N=1;if(m&&m.morphing&&this._useVertexMorphing){const Q=m.morphing.srcDemTile,he=m.morphing.dstDemTile;N=m.morphing.phase,Q&&he&&(this._prepareDemTileUniforms(i,Q,E,"_prev")&&(z=Q),this._prepareDemTileUniforms(i,he,E)&&(R=he))}const j=Q=>Q&&Q.demTexture&&this.painter.linearFloatFilteringSupported()?w.LINEAR:w.NEAREST;let X=null;var K;if(this.enabled?z&&R?(X=R.demTexture,b.activeTexture.set(w.TEXTURE4),z.demTexture.bind(j(z),w.CLAMP_TO_EDGE),E.u_dem_lerp=N):(R=this.terrainTileForTile[i.tileID.key],X=this._prepareDemTileUniforms(i,R,E)?R.demTexture:this.emptyDEMTexture):X=this.emptyDEMTexture,b.activeTexture.set(w.TEXTURE2),X&&(E.u_dem_size=(K=X).size[0]===1?1:K.size[0]-2,X.bind(j(R),w.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(m&&m.useDepthForOcclusion,a,E),m&&m.useMeterToDem&&R){const Q=(1<<R.tileID.canonical.z)*r.bD(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=Q}if(m&&m.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),a.setTerrainUniformValues(b,E),this.painter.transform.projection.name==="globe"){const Q=this.globeUniformValues(this.painter.transform,i.tileID.canonical,m&&m.useDenormalizedUpVectorScale);a.setGlobeUniformValues(b,Q)}}globeUniformValues(i,a,m){const b=i.projection;return{u_tile_tl_up:b.upVector(a,0,0),u_tile_tr_up:b.upVector(a,r.ab,0),u_tile_br_up:b.upVector(a,r.ab,r.ab),u_tile_bl_up:b.upVector(a,0,r.ab),u_tile_up_scale:m?r.cG(1):b.upVectorScale(a,i.center.lat,i.worldSize).metersToTile}}renderToBackBuffer(i){const a=this.painter,m=this.painter.context;i.length!==0&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(b,w,E,R,z){if(b.transform.projection.name==="globe")(function(N,j,X,K,Q){const he=N.context,me=he.gl;let _e,ve;const ke=N.transform,De=r.cx(N,he,ke),Pe=(ft,kt)=>{if(ve===kt)return;const jt=[nv[kt],"PROJECTION_GLOBE_VIEW"];De&&jt.push("CUSTOM_ANTIALIASING");const Pt=N.isTileAffectedByFog(ft);_e=N.getOrCreateProgram("globeRaster",{defines:jt,overrideFog:Pt}),ve=kt},Fe=N.colorModeForRenderPass(),ze=new dt(me.LEQUAL,dt.ReadWrite,N.depthRangeFor3D);mu.update(Q);const qe=r.cy(ke),$e=[r.am(ke.center.lng),r.at(ke.center.lat)],We=N.globeSharedBuffers,nt=[ke.width*r.q.devicePixelRatio,ke.height*r.q.devicePixelRatio],Ke=Float32Array.from(ke.globeMatrix),Ye={useDenormalizedUpVectorScale:!0};{const ft=N.transform,kt=iv(ft.zoom,j.exaggeration(),j.sourceCache._source.tileSize);ve=-1;const jt=me.TRIANGLES;for(const Pt of K){const nn=X.getTile(Pt),pt=Kt.disabled,Vt=j.prevTerrainTileForTile[Pt.key],zt=j.terrainTileForTile[Pt.key];tv(Vt,zt)&&mu.newMorphing(Pt.key,Vt,zt,Q,250),he.activeTexture.set(me.TEXTURE0),nn.texture&&nn.texture.bind(me.LINEAR,me.CLAMP_TO_EDGE);const sn=mu.getMorphValuesForProxy(Pt.key),ln=sn?1:0;sn&&r.C(Ye,{morphing:{srcDemTile:sn.from,dstDemTile:sn.to,phase:r.cw(sn.phase)}});const Ut=r.cz(Pt.canonical),qt=r.cA(Ut.getCenter().lat),Fn=r.cB(Pt.canonical,Ut,qt,ft.worldSize/ft._pixelsPerMercatorPixel),pn=r.b5(r.cC(Pt.canonical)),Cn=ev(ft.expandedFarZProjMatrix,Ke,qe,pn,r.a9(ft.zoom),$e,ft.frustumCorners.TL,ft.frustumCorners.TR,ft.frustumCorners.BR,ft.frustumCorners.BL,ft.globeCenterInViewSpace,ft.globeRadius,nt,kt,ft._farZ,Fn);if(Pe(Pt,ln),_e&&(j.setupElevationDraw(nn,_e,Ye),N.uploadCommonUniforms(he,_e,Pt.toUnwrapped()),We)){const[Yn,Dn,qn]=We.getGridBuffers(qt,kt!==0);_e.draw(N,jt,ze,pt,Fe,Mn.backCCW,Cn,"globe_raster",Yn,Dn,qn)}}}if(We&&(N.renderDefaultNorthPole||N.renderDefaultSouthPole)){const ft=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];De&&ft.push("CUSTOM_ANTIALIASING"),_e=N.getOrCreateProgram("globeRaster",{defines:ft});for(const kt of K){const{x:jt,y:Pt,z:nn}=kt.canonical,pt=Pt===0,Vt=Pt===(1<<nn)-1,[zt,sn,ln,Ut]=We.getPoleBuffers(nn,!1);if(Ut&&(pt||Vt)){const qt=X.getTile(kt);he.activeTexture.set(me.TEXTURE0),qt.texture&&qt.texture.bind(me.LINEAR,me.CLAMP_TO_EDGE);let Fn=r.cD(nn,jt,ke);const pn=r.b5(r.cC(kt.canonical)),Cn=(Yn,Dn)=>Yn.draw(N,me.TRIANGLES,ze,Kt.disabled,Fe,Mn.disabled,ev(ke.expandedFarZProjMatrix,Fn,Fn,pn,0,$e,ke.frustumCorners.TL,ke.frustumCorners.TR,ke.frustumCorners.BR,ke.frustumCorners.BL,ke.globeCenterInViewSpace,ke.globeRadius,nt,0,ke._farZ),"globe_pole_raster",Dn,ln,Ut);j.setupElevationDraw(qt,_e,Ye),N.uploadCommonUniforms(he,_e,kt.toUnwrapped()),pt&&N.renderDefaultNorthPole&&Cn(_e,zt),Vt&&N.renderDefaultSouthPole&&(Fn=r.a6.mat4.scale(r.a6.mat4.create(),Fn,[1,-1,1]),Cn(_e,sn))}}}})(b,w,E,R,z);else{const N=b.context,j=N.gl;let X,K;const Q=b.shadowRenderer,he=Sl(b,b.longestCutoffRange),me=Fe=>{if(K===Fe)return;const ze=[];ze.push(nv[Fe]),he.shouldRenderCutoff&&ze.push("RENDER_CUTOFF"),X=b.getOrCreateProgram("terrainRaster",{defines:ze}),K=Fe},_e=b.colorModeForRenderPass(),ve=new dt(j.LEQUAL,dt.ReadWrite,b.depthRangeFor3D);mu.update(z);const ke=b.transform,De=iv(ke.zoom,w.exaggeration(),w.sourceCache._source.tileSize);let Pe=[0,0,0];if(Q){const Fe=b.style.directionalLight,ze=b.style.ambientLight;Fe&&ze&&(Pe=Xd(b.style,Fe,ze))}{K=-1;const Fe=j.TRIANGLES,[ze,qe]=[w.gridIndexBuffer,w.gridSegments];for(const $e of R){const We=E.getTile($e),nt=Kt.disabled,Ke=w.prevTerrainTileForTile[$e.key],Ye=w.terrainTileForTile[$e.key];tv(Ke,Ye)&&mu.newMorphing($e.key,Ke,Ye,z,250),N.activeTexture.set(j.TEXTURE0),We.texture&&We.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const ft=mu.getMorphValuesForProxy($e.key),kt=ft?1:0;let jt;ft&&(jt={morphing:{srcDemTile:ft.from,dstDemTile:ft.to,phase:r.cw(ft.phase)}});const Pt=Cb($e.projMatrix,cm($e.canonical,ke.renderWorldCopies)?De/10:De,Pe);if(me(kt),!X)continue;w.setupElevationDraw(We,X,jt);const nn=$e.toUnwrapped();Q&&Q.setupShadows(nn,X),b.uploadCommonUniforms(N,X,nn,null,he),X.draw(b,Fe,ve,nt,_e,Mn.backCCW,Pt,"terrain_raster",w.gridBuffer,ze,qe)}}}}(a,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),i.splice(0,i.length))}renderBatch(i){if(this._drapedRenderBatches.length===0)return i+1;this.renderingToTexture=!0;const a=this.painter,m=this.painter.context,b=this.proxySourceCache,w=this.proxiedCoords[b.id],E=this._drapedRenderBatches.shift(),R=a.style.order,z=[];let N=0;for(const j of w){const X=b.getTileByID(j.proxyTileKey),K=b.proxyCachedFBO[j.key]?b.proxyCachedFBO[j.key][i]:void 0,Q=K!==void 0?b.renderCache[K]:this.pool[N++],he=K!==void 0;if(X.texture=Q.tex,he&&!Q.dirty){z.push(X.tileID);continue}let me;m.bindFramebuffer.set(Q.fb.framebuffer),this.renderedToTile=!1,Q.dirty&&(m.clear({color:r.bz.transparent,stencil:0}),Q.dirty=!1);for(let _e=E.start;_e<=E.end;++_e){const ve=a.style._mergedLayers[R[_e]];if(ve.isHidden(a.transform.zoom))continue;const ke=a.style.getLayerSourceCache(ve),De=ke?this.proxyToSource[j.key][ke.id]:[j];if(!De)continue;const Pe=De;m.viewport.set([0,0,Q.fb.width,Q.fb.height]),me!==(ke?ke.id:null)&&(this._setupStencil(Q,De,ve,ke),me=ke?ke.id:null),a.renderLayer(a,ke,ve,Pe)}if(this._drapedRenderBatches.length===0)for(const _e of this._pendingGroundEffectLayers){const ve=a.style._mergedLayers[R[_e]];if(ve.isHidden(a.transform.zoom))continue;const ke=a.style.getLayerSourceCache(ve),De=ke?this.proxyToSource[j.key][ke.id]:[j];if(!De)continue;const Pe=De;m.viewport.set([0,0,Q.fb.width,Q.fb.height]),me!==(ke?ke.id:null)&&(this._setupStencil(Q,De,ve,ke),me=ke?ke.id:null),a.renderLayer(a,ke,ve,Pe)}this.renderedToTile?(Q.dirty=!0,z.push(X.tileID)):he||--N,N===5&&(N=0,this.renderToBackBuffer(z))}return this.renderToBackBuffer(z),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,a.width,a.height]),E.end+1}postRender(){}isLayerOrderingCorrect(i){const a=i.order.length;let m=-1,b=a;for(let w=0;w<a;++w)this._style.isLayerDraped(i._mergedLayers[i.order[w]])?m=Math.max(m,w):b=Math.min(b,w);return b>m}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(a=>a.dem).forEach(a=>{i=Math.min(i,a.dem.tree.minimums[0])}),i===0?i:(i-30)*this._exaggeration}raycast(i,a,m){if(!this._visibleDemTiles)return null;const b=this._visibleDemTiles.filter(w=>w.dem).map(w=>{const E=w.tileID,R=1<<E.overscaledZ,{x:z,y:N}=E.canonical,j=z/R,X=(z+1)/R,K=N/R,Q=(N+1)/R;return{minx:j,miny:K,maxx:X,maxy:Q,t:w.dem.tree.raycastRoot(j,K,X,Q,i,a,m),tile:w}});b.sort((w,E)=>(w.t!==null?w.t:Number.MAX_VALUE)-(E.t!==null?E.t:Number.MAX_VALUE));for(const w of b){if(w.t==null)return null;const E=w.tile.dem.tree.raycast(w.minx,w.miny,w.maxx,w.maxy,i,a,m);if(E!=null)return E}return null}_createFBO(){const i=this.painter.context,a=i.gl,m=this.drapeBufferSize;i.activeTexture.set(a.TEXTURE0);const b=new r.T(i,{width:m[0],height:m[1],data:null},a.RGBA8);b.bind(a.LINEAR,a.CLAMP_TO_EDGE);const w=i.createFramebuffer(m[0],m[1],!0,null);return w.colorAttachment.set(b.texture),w.depthAttachment=new pu(i,w.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,w.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):w.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:w,tex:b,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const i in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const a=this._style._mergedLayers[i],m=a.isHidden(this.painter.transform.zoom);return a.type==="hillshade"||a.type==="custom"?!m&&a.shouldRedrape():!m&&a.hasTransition()})}_clearLineLayersFromRenderCache(){let i=!1;for(const m of this._style.getSources())if(m instanceof el){i=!0;break}if(!i)return;const a={};for(let m=0;m<this._style.order.length;++m){const b=this._style._mergedLayers[this._style.order[m]],w=this._style.getLayerSourceCache(b);if(w&&!a[w.id]&&!b.isHidden(this.painter.transform.zoom)&&b.type==="line"&&b.widthExpression()instanceof r.a4){a[w.id]=!0;for(const E of this.proxyCoords){const R=this.proxyToSource[E.key][w.id];if(R)for(const z of R)this._clearRenderCacheForTile(w.id,z)}}}}_clearRasterLayersFromRenderCache(){let i=!1;for(const m in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[m]._source instanceof Cs){i=!0;break}if(!i)return;const a={};for(let m=0;m<this._style.order.length;++m){const b=this._style._mergedLayers[this._style.order[m]],w=this._style.getLayerSourceCache(b);if(!w||a[w.id]||b.isHidden(this.painter.transform.zoom)||b.type!=="raster")continue;const E=b.paint.get("raster-fade-duration");for(const R of this.proxyCoords){const z=this.proxyToSource[R.key][w.id];if(z)for(const N of z){const j=cf(w.getTile(N),w.findLoadedParent(N,0),w,this.painter.transform,E);(j.opacity!==1||j.mix!==0)&&this._clearRenderCacheForTile(w.id,N)}}}}_setupDrapedRenderBatches(){const i=this._style.order,a=i.length;if(a===0)return;const m=[];this._pendingGroundEffectLayers=[];let b,w=0,E=this._style._mergedLayers[i[w]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++w<a;)E=this._style._mergedLayers[i[w]];for(;w<a;++w){const R=this._style._mergedLayers[i[w]];R.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(R)?b===void 0&&(b=w):(R.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(w),b!==void 0&&(m.push({start:b,end:w-1}),b=void 0)))}if(b!==void 0&&m.push({start:b,end:w-1}),m.length!==0){const R=m[m.length-1];this._pendingGroundEffectLayers.every(z=>z>R.end)||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=m}_setupRenderCache(i){const a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){const E=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let R=0;R<E.length;++R){const z=Object.values(E[R]);a.renderCachePool.push(...z)}}return}this._clearRasterLayersFromRenderCache();const m=this.proxyCoords,b=this._tilesDirty;for(let E=m.length-1;E>=0;E--){const R=m[E];if(a.getTileByID(R.key),a.proxyCachedFBO[R.key]!==void 0){const z=i[R.key],N=this.proxyToSource[R.key];let j=0;for(const X in N){const K=N[X],Q=z[X];if(!Q||Q.length!==K.length||K.some((he,me)=>he!==Q[me]||b[X]&&b[X].hasOwnProperty(he.key))){j=-1;break}++j}for(const X in a.proxyCachedFBO[R.key])a.renderCache[a.proxyCachedFBO[R.key][X]].dirty=j<0||j!==Object.values(z).length}}const w=[...this._drapedRenderBatches];w.sort((E,R)=>R.end-R.start-(E.end-E.start));for(const E of w)for(const R of m){if(a.proxyCachedFBO[R.key])continue;let z=a.renderCachePool.pop();z===void 0&&a.renderCache.length<50&&(z=a.renderCache.length,a.renderCache.push(this._createFBO())),z!==void 0&&(a.proxyCachedFBO[R.key]={},a.proxyCachedFBO[R.key][E.start]=z,a.renderCache[z].dirty=!0)}this._tilesDirty={}}_setupStencil(i,a,m,b){if(!b||!this._sourceTilesOverlap[b.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const w=this.painter.context,E=w.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let R;if(m.isTileClipped())R=a.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);R=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+R>255&&(w.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=R,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):Kt.disabled}_renderTileClippingMasks(i,a){const m=this.painter,b=this.painter.context,w=b.gl;m._tileClippingMaskIDs={},b.setColorMode(Be.disabled),b.setDepthMode(dt.disabled);const E=m.getOrCreateProgram("clippingMask");for(const R of i){const z=m._tileClippingMaskIDs[R.key]=--a;E.draw(m,w.TRIANGLES,dt.disabled,new Kt({func:w.ALWAYS,mask:0},z,255,w.KEEP,w.KEEP,w.REPLACE),Be.disabled,Mn.disabled,Ch(R.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(i){const a=this.painter.transform;if(i.x<0||i.x>a.width||i.y<0||i.y>a.height)return null;const m=[i.x,i.y,1,1];r.a6.vec4.transformMat4(m,m,a.pixelMatrixInverse),r.a6.vec4.scale(m,m,1/m[3]),m[0]/=a.worldSize,m[1]/=a.worldSize;const b=a._camera.position,w=r.bD(1,a.center.lat),E=[b[0],b[1],b[2]/w,0],R=r.a6.vec3.subtract([],m.slice(0,3),E);r.a6.vec3.normalize(R,R);const z=this.raycast(E,R,this._exaggeration);return z!==null&&z?(r.a6.vec3.scaleAndAdd(E,E,R,z),E[3]=E[2],E[2]*=w,E):null}_setupProxiedCoordsForOrtho(i,a,m){if(i.getSource()instanceof r.aD)return this._setupProxiedCoordsForImageSource(i,a,m);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const b=this.proxiedCoords[i.id]=[],w=this.proxyCoords;for(let z=0;z<w.length;z++){const N=w[z],j=this._findTileCoveringTileID(N,i);if(j){const X=this._createProxiedId(N,j,m[N.key]&&m[N.key][i.id]);b.push(X),this.proxyToSource[N.key][i.id]=[X]}}let E=!1;const R=new Set;for(let z=0;z<a.length;z++){const N=i.getTile(a[z]);if(!N||!N.hasData())continue;const j=this._findTileCoveringTileID(N.tileID,this.proxySourceCache);if(j&&j.tileID.canonical.z!==N.tileID.canonical.z){const X=this.proxyToSource[j.tileID.key][i.id],K=this._createProxiedId(j.tileID,N,m[j.tileID.key]&&m[j.tileID.key][i.id]);X?X.splice(X.length-1,0,K):this.proxyToSource[j.tileID.key][i.id]=[K];const Q=this.proxyToSource[j.tileID.key][i.id];R.has(Q)||R.add(Q),b.push(K),E=!0}}if(this._sourceTilesOverlap[i.id]=E,E&&this._debugParams.sortTilesHiZFirst)for(const z of R)z.sort((N,j)=>j.overscaledZ-N.overscaledZ)}_setupProxiedCoordsForImageSource(i,a,m){if(!i.getSource().loaded())return;const b=this.proxiedCoords[i.id]=[],w=this.proxyCoords,E=i.getSource(),R=E.tileID;if(!R)return;const z=new r.P(R.x,R.y)._div(1<<R.z),N=E.coordinates.map(r.a5.fromLngLat).reduce((X,K)=>(X.min.x=Math.min(X.min.x,K.x-z.x),X.min.y=Math.min(X.min.y,K.y-z.y),X.max.x=Math.max(X.max.x,K.x-z.x),X.max.y=Math.max(X.max.y,K.y-z.y),X),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),j=(X,K)=>{const Q=X.wrap+X.canonical.x/(1<<X.canonical.z),he=X.canonical.y/(1<<X.canonical.z),me=r.ab/(1<<X.canonical.z),_e=K.wrap+K.canonical.x/(1<<K.canonical.z),ve=K.canonical.y/(1<<K.canonical.z);return Q+me<_e+N.min.x||Q>_e+N.max.x||he+me<ve+N.min.y||he>ve+N.max.y};for(let X=0;X<w.length;X++){const K=w[X];for(let Q=0;Q<a.length;Q++){const he=i.getTile(a[Q]);if(!he||!he.hasData()||j(K,he.tileID))continue;const me=this._createProxiedId(K,he,m[K.key]&&m[K.key][i.id]),_e=this.proxyToSource[K.key][i.id];_e?_e.push(me):this.proxyToSource[K.key][i.id]=[me],b.push(me)}}}_createProxiedId(i,a,m){let b=this.orthoMatrix;if(m){const w=m.find(E=>E.key===a.tileID.key);if(w)return w}if(a.tileID.key!==i.key){const w=i.canonical.z-a.tileID.canonical.z;let E,R,z;b=r.a6.mat4.create();const N=a.tileID.wrap-i.wrap<<i.overscaledZ;w>0?(E=r.ab>>w,R=E*((a.tileID.canonical.x<<w)-i.canonical.x+N),z=E*((a.tileID.canonical.y<<w)-i.canonical.y)):(E=r.ab<<-w,R=r.ab*(a.tileID.canonical.x-(i.canonical.x+N<<-w)),z=r.ab*(a.tileID.canonical.y-(i.canonical.y<<-w))),r.a6.mat4.ortho(b,0,E,0,E,0,1),r.a6.mat4.translate(b,b,[R,z,0])}return new um(a.tileID,i.key,b)}_findTileCoveringTileID(i,a){let m=a.getTile(i);if(m&&m.hasData())return m;const b=this._findCoveringTileCache[a.id],w=b[i.key];if(m=w?a.getTileByID(w):null,m&&m.hasData()||w===null)return m;let E=m?m.tileID:i,R=E.overscaledZ;const z=a.getSource().minzoom,N=[];if(!w){const X=a.getSource().maxzoom;if(i.canonical.z>=X){const K=i.canonical.z-X;a.getSource().reparseOverscaled?(R=Math.max(i.canonical.z+2,a.transform.tileZoom),E=new r.aA(R,i.wrap,X,i.canonical.x>>K,i.canonical.y>>K)):K!==0&&(R=X,E=new r.aA(R,i.wrap,X,i.canonical.x>>K,i.canonical.y>>K))}E.key!==i.key&&(N.push(E.key),m=a.getTile(E))}const j=X=>{N.forEach(K=>{b[K]=X}),N.length=0};for(R-=1;R>=z&&(!m||!m.hasData());R--){m&&j(m.tileID.key);const X=E.calculateScaledKey(R);if(m=a.getTileByID(X),m&&m.hasData())break;const K=b[X];if(K===null)break;K===void 0?N.push(X):m=a.getTileByID(K)}return j(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,a){let m=this._tilesDirty[i];m||(m=this._tilesDirty[i]={}),m[a.key]=!0}}function dm(p,i,a){const m=function(R,z,N){const j=r.a6.vec3.dot(z,R),X=r.a6.vec3.dot(N,[.2126,.7152,.0722]),K=(he,me,_e)=>(1-_e)*he+_e*me,Q=K(1-.3*Math.min(X,1),1,Math.min(j+1,1));return K(.92,1,Math.asin(r.ap(z[2],-1,1))/Math.PI+.5)*Q}(p,[0,0,1],i),b=[0,0,0];r.a6.vec3.scale(b,a.slice(0,3),m);const w=[0,0,0];r.a6.vec3.scale(w,i.slice(0,3),p[2]);const E=[0,0,0];return r.a6.vec3.add(E,b,w),r.cb(E)}const Cc=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],ov=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class Yl{static cacheKey(i,a,m,b){let w=`${a}${b?b.cacheKey:""}`;for(const E of m)i.usedDefines.includes(E)&&(w+=`/${E}`);return w}constructor(i,a,m,b,w,E){const R=i.gl;this.program=R.createProgram(),this.configuration=b,this.name=a,this.fixedDefines=[...E];const z=b?b.getBinderAttributes():[],N=(m.staticAttributes||[]).concat(z);let j=b?b.defines():[];j=j.concat(E.map(_e=>`#define ${_e}`));const X=`#version 300 es
`;let K=X+j.concat("precision mediump float;",ef,bh.fragmentSource).join(`
`);for(const _e of m.fragmentIncludes)K+=`
${yh[_e]}`;K+=`
${m.fragmentSource}`;let Q=X+j.concat("precision highp float;",ef,bh.vertexSource).join(`
`);for(const _e of m.vertexIncludes)Q+=`
${yh[_e]}`;Q+=`
${m.vertexSource}`;const he=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);R.shaderSource(he,K),R.compileShader(he),R.attachShader(this.program,he);const me=R.createShader(R.VERTEX_SHADER);if(R.isContextLost())this.failedToCreate=!0;else{R.shaderSource(me,Q),R.compileShader(me),R.attachShader(this.program,me),this.attributes={},this.numAttributes=N.length;for(let _e=0;_e<this.numAttributes;_e++)if(N[_e]){const ve=N[_e].startsWith("a_")?N[_e]:`a_${N[_e]}`;R.bindAttribLocation(this.program,_e,ve),this.attributes[ve]=_e}R.linkProgram(this.program),R.deleteShader(me),R.deleteShader(he),this.fixedUniforms=w(i),this.binderUniforms=b?b.getUniforms(i):[],(E.includes("TERRAIN")||a.indexOf("symbol")!==-1||a.indexOf("circle")!==-1)&&(this.terrainUniforms=(_e=>({u_dem:new r.bJ(_e),u_dem_prev:new r.bJ(_e),u_dem_tl:new r.bG(_e),u_dem_scale:new r.bI(_e),u_dem_tl_prev:new r.bG(_e),u_dem_scale_prev:new r.bI(_e),u_dem_size:new r.bI(_e),u_dem_lerp:new r.bI(_e),u_exaggeration:new r.bI(_e),u_depth:new r.bJ(_e),u_depth_size_inv:new r.bG(_e),u_depth_range_unpack:new r.bG(_e),u_occluder_half_size:new r.bI(_e),u_occlusion_depth_offset:new r.bI(_e),u_meter_to_dem:new r.bI(_e),u_label_plane_matrix_inv:new r.bF(_e)}))(i)),E.includes("GLOBE")&&(this.globeUniforms=(_e=>({u_tile_tl_up:new r.bH(_e),u_tile_tr_up:new r.bH(_e),u_tile_br_up:new r.bH(_e),u_tile_bl_up:new r.bH(_e),u_tile_up_scale:new r.bI(_e)}))(i)),E.includes("FOG")&&(this.fogUniforms=(_e=>({u_fog_matrix:new r.bF(_e),u_fog_range:new r.bG(_e),u_fog_color:new r.c6(_e),u_fog_horizon_blend:new r.bI(_e),u_fog_vertical_limit:new r.bG(_e),u_fog_temporal_offset:new r.bI(_e),u_frustum_tl:new r.bH(_e),u_frustum_tr:new r.bH(_e),u_frustum_br:new r.bH(_e),u_frustum_bl:new r.bH(_e),u_globe_pos:new r.bH(_e),u_globe_radius:new r.bI(_e),u_globe_transition:new r.bI(_e),u_is_globe:new r.bJ(_e),u_viewport:new r.bG(_e)}))(i)),E.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(_e=>({u_cutoff_params:new r.c6(_e)}))(i)),E.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(_e=>({u_lighting_ambient_color:new r.bH(_e),u_lighting_directional_dir:new r.bH(_e),u_lighting_directional_color:new r.bH(_e),u_ground_radiance:new r.bH(_e)}))(i)),E.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(_e=>({u_light_matrix_0:new r.bF(_e),u_light_matrix_1:new r.bF(_e),u_fade_range:new r.bG(_e),u_shadow_normal_offset:new r.bH(_e),u_shadow_intensity:new r.bI(_e),u_shadow_texel_size:new r.bI(_e),u_shadow_map_resolution:new r.bI(_e),u_shadow_direction:new r.bH(_e),u_shadow_bias:new r.bH(_e),u_shadowmap_0:new r.bJ(_e),u_shadowmap_1:new r.bJ(_e)}))(i))}}setTerrainUniformValues(i,a){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const b in a)m[b]&&m[b].set(this.program,b,a[b])}}setGlobeUniformValues(i,a){if(!this.globeUniforms)return;const m=this.globeUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const b in a)m[b]&&m[b].set(this.program,b,a[b])}}setFogUniformValues(i,a){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const b in a)m[b].set(this.program,b,a[b])}}setCutoffUniformValues(i,a){if(!this.cutoffUniforms)return;const m=this.cutoffUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const b in a)m[b].set(this.program,b,a[b])}}setLightsUniformValues(i,a){if(!this.lightsUniforms)return;const m=this.lightsUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const b in a)m[b].set(this.program,b,a[b])}}setShadowUniformValues(i,a){if(this.failedToCreate||!this.shadowUniforms)return;const m=this.shadowUniforms;i.program.set(this.program);for(const b in a)m[b].set(this.program,b,a[b])}_drawDebugWireframe(i,a,m,b,w,E,R,z,N,j){const X=i.options.wireframe;if(X.terrain===!1&&X.layers2D===!1&&X.layers3D===!1)return;const K=i.context;if(!(!(!X.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!X.layers2D||i._terrain&&i._terrain.renderingToTexture||!Cc.includes(this.name))||!(!X.layers3D||!ov.includes(this.name))))return;const Q=K.gl,he=i.wireframeDebugCache.getLinesFromTrianglesBuffer(i.frameCounter,w,K);if(!he)return;const me=[...this.fixedDefines];me.push("DEBUG_WIREFRAME");const _e=i.getOrCreateProgram(this.name,{config:this.configuration,defines:me});K.program.set(_e.program);const ve=(Pe,Fe,ze)=>{if(Fe[Pe]&&ze[Pe])for(const qe in Fe[Pe])ze[Pe][qe]&&ze[Pe][qe].set(ze.program,qe,Fe[Pe][qe].current)};N&&N.setUniforms(_e.program,K,_e.binderUniforms,R,{zoom:z}),ve("fixedUniforms",this,_e),ve("terrainUniforms",this,_e),ve("globeUniforms",this,_e),ve("fogUniforms",this,_e),ve("lightsUniforms",this,_e),ve("shadowUniforms",this,_e),he.bind(),K.setColorMode(new Be([Q.ONE,Q.ONE_MINUS_SRC_ALPHA,Q.ZERO,Q.ONE],r.bz.transparent,[!0,!0,!0,!1])),K.setDepthMode(new dt(a.func===Q.LESS?Q.LEQUAL:a.func,dt.ReadOnly,a.range)),K.setStencilMode(Kt.disabled);const ke=3*E.primitiveLength*2,De=3*E.primitiveOffset*2*2;j&&j>1?Q.drawElementsInstanced(Q.LINES,ke,Q.UNSIGNED_SHORT,De,j):Q.drawElements(Q.LINES,ke,Q.UNSIGNED_SHORT,De),w.bind(),K.program.set(this.program),K.setDepthMode(a),K.setStencilMode(m),K.setColorMode(b)}draw(i,a,m,b,w,E,R,z,N,j,X,K,Q,he,me,_e){const ve=i.context,ke=ve.gl;if(this.failedToCreate)return;ve.program.set(this.program),ve.setDepthMode(m),ve.setStencilMode(b),ve.setColorMode(w),ve.setCullFace(E);for(const Fe of Object.keys(this.fixedUniforms))this.fixedUniforms[Fe].set(this.program,Fe,R[Fe]);he&&he.setUniforms(this.program,ve,this.binderUniforms,K,{zoom:Q});const De={[ke.POINTS]:1,[ke.LINES]:2,[ke.TRIANGLES]:3,[ke.LINE_STRIP]:1}[a],Pe=_e&&_e>0?1:void 0;for(const Fe of X.get()){const ze=Fe.vaos||(Fe.vaos={});(ze[z]||(ze[z]=new du)).bind(ve,this,N,he?he.getPaintVertexBuffers():[],j,Fe.vertexOffset,me||[],Pe),_e&&_e>1?ke.drawElementsInstanced(a,Fe.primitiveLength*De,ke.UNSIGNED_SHORT,Fe.primitiveOffset*De*2,_e):j?ke.drawElements(a,Fe.primitiveLength*De,ke.UNSIGNED_SHORT,Fe.primitiveOffset*De*2):ke.drawArrays(a,Fe.vertexOffset,Fe.vertexLength),a===ke.TRIANGLES&&j&&this._drawDebugWireframe(i,m,b,w,j,Fe,K,Q,he,_e)}}}function fm(p,i){const a=Math.pow(2,i.tileID.overscaledZ),m=i.tileSize*Math.pow(2,p.transform.tileZoom)/a,b=m*(i.tileID.canonical.x+i.tileID.wrap*a),w=m*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.ak(i,1,p.transform.tileZoom),u_pixel_coord_upper:[b>>16,w>>16],u_pixel_coord_lower:[65535&b,65535&w]}}const uf=r.a6.mat4.create(),pm=(p,i,a,m,b,w,E,R,z,N,j,X,K,Q,he,me)=>{const _e=i.style.light,ve=_e.properties.get("position"),ke=[ve.x,ve.y,ve.z],De=r.a6.mat3.create();_e.properties.get("anchor")==="viewport"&&(r.a6.mat3.fromRotation(De,-i.transform.angle),r.a6.vec3.transformMat3(ke,ke,De));const Pe=_e.properties.get("color"),Fe=i.transform,ze={u_matrix:p,u_lightpos:ke,u_lightintensity:_e.properties.get("intensity"),u_lightcolor:[Pe.r,Pe.g,Pe.b],u_vertical_gradient:+a,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:uf,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:b,u_edge_radius:w,u_width_scale:E,u_flood_light_color:K,u_vertical_scale:Q,u_flood_light_intensity:he,u_ground_shadow_factor:me};return Fe.projection.name==="globe"&&(ze.u_tile_id=[R.canonical.x,R.canonical.y,1<<R.canonical.z],ze.u_zoom_transition=N,ze.u_inv_rot_matrix=X,ze.u_merc_center=j,ze.u_up_dir=Fe.projection.upVector(new r.bP(0,0,0),j[0]*r.ab,j[1]*r.ab),ze.u_height_lift=z),ze},sv=(p,i,a,m)=>({u_matrix:p,u_edge_radius:i,u_width_scale:a,u_vertical_scale:m}),mm=(p,i,a,m,b,w,E,R,z,N,j,X,K,Q,he)=>{const me=pm(p,i,a,m,b,w,E,R,N,j,X,K,Q,he,1,[0,0,0]),_e={u_height_factor:-Math.pow(2,R.overscaledZ)/z.tileSize/8};return r.l(me,fm(i,z),_e)},hf=(p,i)=>({u_matrix:p,u_emissive_strength:i}),av=(p,i,a,m)=>r.l(hf(p,i),fm(a,m)),lv=(p,i,a)=>({u_matrix:p,u_world:a,u_emissive_strength:i}),Ah=(p,i,a,m,b)=>r.l(av(p,i,a,m),{u_world:b}),Ab=(p,i,a,m)=>{const b=r.ab/a.tileSize;return{u_matrix:p,u_camera_to_center_distance:i.getCameraToCenterDistance(m),u_extrude_scale:[i.pixelsToGLUnits[0]/b,i.pixelsToGLUnits[1]/b]}},cv=(p,i,a=1)=>({u_matrix:p,u_color:i.toRenderColor(null),u_overlay:0,u_overlay_scale:a}),uv=r.a6.mat4.create(),Pb=(p,i,a,m,b,w,E)=>{const R=p.transform,z=R.projection.name==="globe",N=z?r.cI(R.zoom,i.canonical)*R._pixelsPerMercatorPixel:r.ak(a,1,w),j={u_matrix:i.projMatrix,u_extrude_scale:N,u_intensity:E,u_inv_rot_matrix:uv,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(z){j.u_inv_rot_matrix=m,j.u_merc_center=b,j.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],j.u_zoom_transition=r.a9(R.zoom);const X=b[0]*r.ab,K=b[1]*r.ab;j.u_up_dir=R.projection.upVector(new r.bP(0,0,0),X,K)}return j};function df(p,[i,a,m,b],[w,E]){if(w===E)return[0,0,0,0];const R=255*(p-1)/(p*(E-w));return[i*R,a*R,m*R,b*R]}function ff(p,i,[a,m]){return a===m?0:.5/p+(i-a)*(p-1)/(p*(m-a))}const Ph=(p,i,a,m,b,w,E,R,z,N,j,X,K,Q,he,me,_e,ve,ke,De,Pe)=>({u_matrix:p,u_normalize_matrix:i,u_globe_matrix:a,u_merc_matrix:m,u_grid_matrix:b,u_tl_parent:w,u_scale_parent:N,u_fade_t:j.mix,u_opacity:j.opacity*X.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:X.paint.get("raster-brightness-min"),u_brightness_high:X.paint.get("raster-brightness-max"),u_saturation_factor:r.cJ(X.paint.get("raster-saturation")),u_contrast_factor:r.cK(X.paint.get("raster-contrast")),u_spin_weights:gm(X.paint.get("raster-hue-rotate")),u_perspective_transform:K,u_raster_elevation:Q,u_zoom_transition:E,u_merc_center:R,u_cutoff_params:z,u_colorization_mix:df(r.cL,me,ve),u_colorization_offset:ff(r.cL,_e,ve),u_color_ramp:he,u_texture_offset:[De/(ke+2*De),ke/(ke+2*De)],u_texture_res:[ke+2*De,ke+2*De],u_emissive_strength:Pe});function gm(p){p*=Math.PI/180;const i=Math.sin(p),a=Math.cos(p);return[(2*a+1)/3,(-Math.sqrt(3)*i-a+1)/3,(Math.sqrt(3)*i-a+1)/3]}const il=.05,hv=(p,i,a,m,b,w,E,R,z,N,j,X)=>({u_matrix:p,u_normalize_matrix:i,u_globe_matrix:a,u_merc_matrix:m,u_grid_matrix:b,u_tl_parent:w,u_scale_parent:N,u_fade_t:j.mix,u_opacity:j.opacity,u_image0:0,u_image1:1,u_raster_elevation:X,u_zoom_transition:E,u_merc_center:R,u_cutoff_params:z}),pf=(p,i,a,m,b,w,E,R,z,N)=>({u_particle_texture:p,u_particle_texture_side_len:i,u_tile_offset:a,u_velocity:m,u_color_ramp:w,u_velocity_res:b,u_max_speed:E,u_uv_offset:R,u_data_scale:[255*z[0],255*z[1]],u_data_offset:N,u_particle_pos_scale:1.1,u_particle_pos_offset:[il,il]}),mf=(p,i,a,m,b,w,E,R,z,N)=>({u_particle_texture:p,u_particle_texture_side_len:i,u_velocity:a,u_velocity_res:m,u_max_speed:b,u_speed_factor:w,u_reset_rate:E,u_rand_seed:Math.random(),u_uv_offset:R,u_data_scale:[255*z[0],255*z[1]],u_data_offset:N,u_particle_pos_scale:1.1,u_particle_pos_offset:[il,il]}),gf=r.a6.mat4.create(),_m=(p,i,a,m,b,w,E,R,z,N,j,X,K,Q,he,me,_e,ve,ke,De,Pe)=>{const Fe=b.transform,ze={u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:Fe.getCameraToCenterDistance(ke),u_rotate_symbol:+a,u_aspect_ratio:Fe.width/Fe.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:E,u_coord_matrix:R,u_is_text:+N,u_elevation_from_sea:z?1:0,u_pitch_with_map:+m,u_texsize:j,u_texsize_icon:X,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:gf,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:gf,u_up_vector:[0,-1,0],u_color_adj_mat:De,u_icon_transition:Pe||0,u_gamma_scale:m?b.transform.getCameraToCenterDistance(ke)*Math.cos(b.terrain?0:b.transform._pitch):1,u_device_pixel_ratio:r.q.devicePixelRatio,u_is_halo:+K};return ke.name==="globe"&&(ze.u_tile_id=[Q.canonical.x,Q.canonical.y,1<<Q.canonical.z],ze.u_zoom_transition=he,ze.u_inv_rot_matrix=_e,ze.u_merc_center=me,ze.u_camera_forward=Fe._camera.forward(),ze.u_ecef_origin=r.cM(Fe.globeMatrix,Q.toUnwrapped()),ze.u_tile_matrix=Float32Array.from(Fe.globeMatrix),ze.u_up_vector=ve),ze},dv=(p,i,a,m)=>({u_matrix:p,u_emissive_strength:i,u_opacity:a,u_color:m}),Ac=(p,i,a,m,b,w,E,R,z)=>r.l(function(N,j,X,K,Q,he){const{width:me,height:_e}=K.imageManager.getPixelSize(j),ve=Math.pow(2,he.tileID.overscaledZ),ke=he.tileSize*Math.pow(2,K.transform.tileZoom)/ve,De=ke*(he.tileID.canonical.x+he.tileID.wrap*ve),Pe=ke*he.tileID.canonical.y;return{u_image:0,u_pattern_tl:X.tl,u_pattern_br:X.br,u_texsize:[me,_e],u_pattern_size:X.displaySize,u_pattern_units_to_pixels:Q?[K.transform.width,-1*K.transform.height]:[1/r.ak(he,1,K.transform.tileZoom),1/r.ak(he,1,K.transform.tileZoom)],u_pixel_coord_upper:[De>>16,Pe>>16],u_pixel_coord_lower:[65535&De,65535&Pe]}}(0,w,E,m,R,z),{u_matrix:p,u_emissive_strength:i,u_opacity:a}),_u=new Float32Array(r.a6.mat4.identity([])),Pn=(p,i,a,m,b,w,E,R,z,N,j,X,K,Q=[0,0,0],he)=>{const me=b.style.light,_e=me.properties.get("position"),ve=[-_e.x,-_e.y,_e.z],ke=r.a6.mat3.create();me.properties.get("anchor")==="viewport"&&(r.a6.mat3.fromRotation(ke,-b.transform.angle),r.a6.vec3.transformMat3(ve,ve,ke));const De=j.alphaMode==="MASK",Pe=me.properties.get("color").toRenderColor(null),Fe=K.paint.get("model-ambient-occlusion-intensity"),ze=K.paint.get("model-color").constantOr(r.bz.white).toRenderColor(null),qe=K.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:p,u_lighting_matrix:i,u_normal_matrix:a,u_node_matrix:m||_u,u_lightpos:ve,u_lightintensity:me.properties.get("intensity"),u_lightcolor:[Pe.r,Pe.g,Pe.b],u_camera_pos:Q,u_opacity:w,u_baseTextureIsAlpha:0,u_alphaMask:+De,u_alphaCutoff:j.alphaCutoff,u_baseColorFactor:[E.r,E.g,E.b,E.a],u_emissiveFactor:[R[0],R[1],R[2],1],u_metallicFactor:z,u_roughnessFactor:N,u_baseColorTexture:Po.BaseColor,u_metallicRoughnessTexture:Po.MetallicRoughness,u_normalTexture:Po.Normal,u_occlusionTexture:Po.Occlusion,u_emissionTexture:Po.Emission,u_lutTexture:Po.LUT,u_color_mix:[ze.r,ze.g,ze.b,qe],u_aoIntensity:Fe,u_emissive_strength:X,u_occlusionTextureTransform:he||[0,0,0,0]}},vm=(p,i=_u,a=_u)=>({u_matrix:p,u_instance:i,u_node_matrix:a}),fv={fillExtrusion:p=>({u_matrix:new r.bF(p),u_lightpos:new r.bH(p),u_lightintensity:new r.bI(p),u_lightcolor:new r.bH(p),u_vertical_gradient:new r.bI(p),u_opacity:new r.bI(p),u_edge_radius:new r.bI(p),u_width_scale:new r.bI(p),u_ao:new r.bG(p),u_tile_id:new r.bH(p),u_zoom_transition:new r.bI(p),u_inv_rot_matrix:new r.bF(p),u_merc_center:new r.bG(p),u_up_dir:new r.bH(p),u_height_lift:new r.bI(p),u_flood_light_color:new r.bH(p),u_vertical_scale:new r.bI(p),u_flood_light_intensity:new r.bI(p),u_ground_shadow_factor:new r.bH(p)}),fillExtrusionDepth:p=>({u_matrix:new r.bF(p),u_edge_radius:new r.bI(p),u_width_scale:new r.bI(p),u_vertical_scale:new r.bI(p)}),fillExtrusionPattern:p=>({u_matrix:new r.bF(p),u_lightpos:new r.bH(p),u_lightintensity:new r.bI(p),u_lightcolor:new r.bH(p),u_vertical_gradient:new r.bI(p),u_height_factor:new r.bI(p),u_edge_radius:new r.bI(p),u_width_scale:new r.bI(p),u_ao:new r.bG(p),u_tile_id:new r.bH(p),u_zoom_transition:new r.bI(p),u_inv_rot_matrix:new r.bF(p),u_merc_center:new r.bG(p),u_up_dir:new r.bH(p),u_height_lift:new r.bI(p),u_image:new r.bJ(p),u_texsize:new r.bG(p),u_pixel_coord_upper:new r.bG(p),u_pixel_coord_lower:new r.bG(p),u_tile_units_to_pixels:new r.bI(p),u_opacity:new r.bI(p)}),fillExtrusionGroundEffect:p=>({u_matrix:new r.bF(p),u_opacity:new r.bI(p),u_ao_pass:new r.bI(p),u_meter_to_tile:new r.bI(p),u_ao:new r.bG(p),u_flood_light_intensity:new r.bI(p),u_flood_light_color:new r.bH(p),u_attenuation:new r.bI(p),u_edge_radius:new r.bI(p),u_fb:new r.bJ(p),u_fb_size:new r.bI(p),u_dynamic_offset:new r.bI(p)}),fill:p=>({u_matrix:new r.bF(p),u_emissive_strength:new r.bI(p)}),fillPattern:p=>({u_matrix:new r.bF(p),u_emissive_strength:new r.bI(p),u_image:new r.bJ(p),u_texsize:new r.bG(p),u_pixel_coord_upper:new r.bG(p),u_pixel_coord_lower:new r.bG(p),u_tile_units_to_pixels:new r.bI(p)}),fillOutline:p=>({u_matrix:new r.bF(p),u_emissive_strength:new r.bI(p),u_world:new r.bG(p)}),fillOutlinePattern:p=>({u_matrix:new r.bF(p),u_emissive_strength:new r.bI(p),u_world:new r.bG(p),u_image:new r.bJ(p),u_texsize:new r.bG(p),u_pixel_coord_upper:new r.bG(p),u_pixel_coord_lower:new r.bG(p),u_tile_units_to_pixels:new r.bI(p)}),circle:r.cN,collisionBox:p=>({u_matrix:new r.bF(p),u_camera_to_center_distance:new r.bI(p),u_extrude_scale:new r.bG(p)}),collisionCircle:p=>({u_matrix:new r.bF(p),u_inv_matrix:new r.bF(p),u_camera_to_center_distance:new r.bI(p),u_viewport_size:new r.bG(p)}),debug:p=>({u_color:new r.cu(p),u_matrix:new r.bF(p),u_overlay:new r.bJ(p),u_overlay_scale:new r.bI(p)}),clippingMask:p=>({u_matrix:new r.bF(p)}),heatmap:p=>({u_extrude_scale:new r.bI(p),u_intensity:new r.bI(p),u_matrix:new r.bF(p),u_inv_rot_matrix:new r.bF(p),u_merc_center:new r.bG(p),u_tile_id:new r.bH(p),u_zoom_transition:new r.bI(p),u_up_dir:new r.bH(p)}),heatmapTexture:p=>({u_image:new r.bJ(p),u_color_ramp:new r.bJ(p),u_opacity:new r.bI(p)}),hillshade:p=>({u_matrix:new r.bF(p),u_image:new r.bJ(p),u_latrange:new r.bG(p),u_light:new r.bG(p),u_shadow:new r.cu(p),u_highlight:new r.cu(p),u_emissive_strength:new r.bI(p),u_accent:new r.cu(p)}),hillshadePrepare:p=>({u_matrix:new r.bF(p),u_image:new r.bJ(p),u_dimension:new r.bG(p),u_zoom:new r.bI(p)}),line:r.cO,linePattern:r.cP,raster:p=>({u_matrix:new r.bF(p),u_normalize_matrix:new r.bF(p),u_globe_matrix:new r.bF(p),u_merc_matrix:new r.bF(p),u_grid_matrix:new r.cv(p),u_tl_parent:new r.bG(p),u_scale_parent:new r.bI(p),u_fade_t:new r.bI(p),u_opacity:new r.bI(p),u_image0:new r.bJ(p),u_image1:new r.bJ(p),u_brightness_low:new r.bI(p),u_brightness_high:new r.bI(p),u_saturation_factor:new r.bI(p),u_contrast_factor:new r.bI(p),u_spin_weights:new r.bH(p),u_perspective_transform:new r.bG(p),u_raster_elevation:new r.bI(p),u_zoom_transition:new r.bI(p),u_merc_center:new r.bG(p),u_cutoff_params:new r.c6(p),u_colorization_mix:new r.c6(p),u_colorization_offset:new r.bI(p),u_color_ramp:new r.bJ(p),u_texture_offset:new r.bG(p),u_texture_res:new r.bG(p),u_emissive_strength:new r.bI(p)}),rasterParticle:p=>({u_matrix:new r.bF(p),u_normalize_matrix:new r.bF(p),u_globe_matrix:new r.bF(p),u_merc_matrix:new r.bF(p),u_grid_matrix:new r.cv(p),u_tl_parent:new r.bG(p),u_scale_parent:new r.bI(p),u_fade_t:new r.bI(p),u_opacity:new r.bI(p),u_image0:new r.bJ(p),u_image1:new r.bJ(p),u_raster_elevation:new r.bI(p),u_zoom_transition:new r.bI(p),u_merc_center:new r.bG(p),u_cutoff_params:new r.c6(p)}),rasterParticleTexture:p=>({u_texture:new r.bJ(p),u_opacity:new r.bI(p)}),rasterParticleDraw:p=>({u_particle_texture:new r.bJ(p),u_particle_texture_side_len:new r.bI(p),u_tile_offset:new r.bG(p),u_velocity:new r.bJ(p),u_color_ramp:new r.bJ(p),u_velocity_res:new r.bG(p),u_max_speed:new r.bI(p),u_uv_offset:new r.bG(p),u_data_scale:new r.bG(p),u_data_offset:new r.bI(p),u_particle_pos_scale:new r.bI(p),u_particle_pos_offset:new r.bG(p)}),rasterParticleUpdate:p=>({u_particle_texture:new r.bJ(p),u_particle_texture_side_len:new r.bI(p),u_velocity:new r.bJ(p),u_velocity_res:new r.bG(p),u_max_speed:new r.bI(p),u_speed_factor:new r.bI(p),u_reset_rate:new r.bI(p),u_rand_seed:new r.bI(p),u_uv_offset:new r.bG(p),u_data_scale:new r.bG(p),u_data_offset:new r.bI(p),u_particle_pos_scale:new r.bI(p),u_particle_pos_offset:new r.bG(p)}),symbol:p=>({u_is_size_zoom_constant:new r.bJ(p),u_is_size_feature_constant:new r.bJ(p),u_size_t:new r.bI(p),u_size:new r.bI(p),u_camera_to_center_distance:new r.bI(p),u_rotate_symbol:new r.bJ(p),u_aspect_ratio:new r.bI(p),u_fade_change:new r.bI(p),u_matrix:new r.bF(p),u_label_plane_matrix:new r.bF(p),u_coord_matrix:new r.bF(p),u_is_text:new r.bJ(p),u_elevation_from_sea:new r.bJ(p),u_pitch_with_map:new r.bJ(p),u_texsize:new r.bG(p),u_texsize_icon:new r.bG(p),u_texture:new r.bJ(p),u_texture_icon:new r.bJ(p),u_gamma_scale:new r.bI(p),u_device_pixel_ratio:new r.bI(p),u_tile_id:new r.bH(p),u_zoom_transition:new r.bI(p),u_inv_rot_matrix:new r.bF(p),u_merc_center:new r.bG(p),u_camera_forward:new r.bH(p),u_tile_matrix:new r.bF(p),u_up_vector:new r.bH(p),u_ecef_origin:new r.bH(p),u_is_halo:new r.bJ(p),u_icon_transition:new r.bI(p),u_color_adj_mat:new r.bF(p)}),background:p=>({u_matrix:new r.bF(p),u_emissive_strength:new r.bI(p),u_opacity:new r.bI(p),u_color:new r.cu(p)}),backgroundPattern:p=>({u_matrix:new r.bF(p),u_emissive_strength:new r.bI(p),u_opacity:new r.bI(p),u_image:new r.bJ(p),u_pattern_tl:new r.bG(p),u_pattern_br:new r.bG(p),u_texsize:new r.bG(p),u_pattern_size:new r.bG(p),u_pixel_coord_upper:new r.bG(p),u_pixel_coord_lower:new r.bG(p),u_pattern_units_to_pixels:new r.bG(p)}),terrainRaster:p=>({u_matrix:new r.bF(p),u_image0:new r.bJ(p),u_skirt_height:new r.bI(p),u_ground_shadow_factor:new r.bH(p)}),skybox:p=>({u_matrix:new r.bF(p),u_sun_direction:new r.bH(p),u_cubemap:new r.bJ(p),u_opacity:new r.bI(p),u_temporal_offset:new r.bI(p)}),skyboxGradient:p=>({u_matrix:new r.bF(p),u_color_ramp:new r.bJ(p),u_center_direction:new r.bH(p),u_radius:new r.bI(p),u_opacity:new r.bI(p),u_temporal_offset:new r.bI(p)}),skyboxCapture:p=>({u_matrix_3f:new r.cv(p),u_sun_direction:new r.bH(p),u_sun_intensity:new r.bI(p),u_color_tint_r:new r.c6(p),u_color_tint_m:new r.c6(p),u_luminance:new r.bI(p)}),globeRaster:p=>({u_proj_matrix:new r.bF(p),u_globe_matrix:new r.bF(p),u_normalize_matrix:new r.bF(p),u_merc_matrix:new r.bF(p),u_zoom_transition:new r.bI(p),u_merc_center:new r.bG(p),u_image0:new r.bJ(p),u_grid_matrix:new r.cv(p),u_skirt_height:new r.bI(p),u_far_z_cutoff:new r.bI(p),u_frustum_tl:new r.bH(p),u_frustum_tr:new r.bH(p),u_frustum_br:new r.bH(p),u_frustum_bl:new r.bH(p),u_globe_pos:new r.bH(p),u_globe_radius:new r.bI(p),u_viewport:new r.bG(p)}),globeAtmosphere:p=>({u_frustum_tl:new r.bH(p),u_frustum_tr:new r.bH(p),u_frustum_br:new r.bH(p),u_frustum_bl:new r.bH(p),u_horizon:new r.bI(p),u_transition:new r.bI(p),u_fadeout_range:new r.bI(p),u_color:new r.c6(p),u_high_color:new r.c6(p),u_space_color:new r.c6(p),u_temporal_offset:new r.bI(p),u_horizon_angle:new r.bI(p)}),model:p=>({u_matrix:new r.bF(p),u_lighting_matrix:new r.bF(p),u_normal_matrix:new r.bF(p),u_node_matrix:new r.bF(p),u_lightpos:new r.bH(p),u_lightintensity:new r.bI(p),u_lightcolor:new r.bH(p),u_camera_pos:new r.bH(p),u_opacity:new r.bI(p),u_baseColorFactor:new r.c6(p),u_emissiveFactor:new r.c6(p),u_metallicFactor:new r.bI(p),u_roughnessFactor:new r.bI(p),u_baseTextureIsAlpha:new r.bJ(p),u_alphaMask:new r.bJ(p),u_alphaCutoff:new r.bI(p),u_baseColorTexture:new r.bJ(p),u_metallicRoughnessTexture:new r.bJ(p),u_normalTexture:new r.bJ(p),u_occlusionTexture:new r.bJ(p),u_emissionTexture:new r.bJ(p),u_lutTexture:new r.bJ(p),u_color_mix:new r.c6(p),u_aoIntensity:new r.bI(p),u_emissive_strength:new r.bI(p),u_occlusionTextureTransform:new r.c6(p)}),modelDepth:p=>({u_matrix:new r.bF(p),u_instance:new r.bF(p),u_node_matrix:new r.bF(p)}),groundShadow:p=>({u_matrix:new r.bF(p),u_ground_shadow_factor:new r.bH(p)}),stars:p=>({u_matrix:new r.bF(p),u_up:new r.bH(p),u_right:new r.bH(p),u_intensity_multiplier:new r.bI(p)}),occlusion:p=>({u_matrix:new r.bF(p),u_anchorPos:new r.bH(p),u_screenSizePx:new r.bG(p),u_occluderSizePx:new r.bG(p),u_color:new r.c6(p)})};class $s{constructor(i,a,m,b){this.id=$s.uniqueIdxCounter,$s.uniqueIdxCounter++,this.context=i;const w=i.gl;this.buffer=w.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||b||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){this.id=$s.uniqueIdxCounter,$s.uniqueIdxCounter++;const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}$s.uniqueIdxCounter=0;const Pc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ln{constructor(i,a,m,b,w,E){this.length=a.length,this.attributes=m,this.itemSize=a.bytesPerElement,this.dynamicDraw=b,this.instanceCount=E,this.context=i;const R=i.gl;this.buffer=R.createBuffer(),i.bindVertexBuffer.set(this.buffer),R.bufferData(R.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?R.DYNAMIC_DRAW:R.STATIC_DRAW),this.dynamicDraw||w||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,a){for(let m=0;m<this.attributes.length;m++){const b=a.attributes[this.attributes[m].name];b!==void 0&&i.enableVertexAttribArray(b)}}setVertexAttribPointers(i,a,m){for(let b=0;b<this.attributes.length;b++){const w=this.attributes[b],E=a.attributes[w.name];E!==void 0&&i.vertexAttribPointer(E,w.components,i[Pc[w.type]],!1,this.itemSize,w.offset+this.itemSize*(m||0))}}setVertexAttribDivisor(i,a,m){for(let b=0;b<this.attributes.length;b++){const w=a.attributes[this.attributes[b].name];w!==void 0&&this.instanceCount&&this.instanceCount>0&&i.vertexAttribDivisor(w,m)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class _f{constructor(i,a,m,b,w){this.context=i,this.width=a,this.height=m;const E=this.framebuffer=i.gl.createFramebuffer();b&&(this.colorAttachment=new lf(i,E)),w&&(this.depthAttachmentType=w,this.depthAttachment=w==="renderbuffer"?new lm(i,E):new Q_(i,E))}destroy(){const i=this.context.gl;if(this.colorAttachment){const a=this.colorAttachment.get();a&&i.deleteTexture(a)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const a=this.depthAttachment.get();a&&i.deleteRenderbuffer(a)}else{const a=this.depthAttachment.get();a&&i.deleteTexture(a)}i.deleteFramebuffer(this.framebuffer)}}class Mb{constructor(i,a){this.gl=i,this.clearColor=new Jp(this),this.clearDepth=new H_(this),this.clearStencil=new Qp(this),this.colorMask=new rf(this),this.depthMask=new Sh(this),this.stencilMask=new q_(this),this.stencilFunc=new W_(this),this.stencilOp=new Z_(this),this.stencilTest=new fu(this),this.depthRange=new X_(this),this.depthTest=new Sb(this),this.depthFunc=new Tb(this),this.blend=new Eb(this),this.blendFunc=new em(this),this.blendColor=new tm(this),this.blendEquation=new nm(this),this.cullFace=new im(this),this.cullFaceSide=new Y_(this),this.frontFace=new K_(this),this.program=new Ib(this),this.activeTexture=new Th(this),this.viewport=new Eh(this),this.bindFramebuffer=new J_(this),this.bindRenderbuffer=new da(this),this.bindTexture=new rm(this),this.bindVertexBuffer=new of(this),this.bindElementBuffer=new sf(this),this.bindVertexArrayOES=new om(this),this.pixelStoreUnpack=new sm(this),this.pixelStoreUnpackPremultiplyAlpha=new af(this),this.pixelStoreUnpackFlipY=new am(this),this.options=a?{...a}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=i.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=i.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=i.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=i.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),this.maxPointSize=i.getParameter(i.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,a,m){return new $s(this,i,a,m)}createVertexBuffer(i,a,m,b,w){return new Ln(this,i,a,m,b,w)}createRenderbuffer(i,a,m){const b=this.gl,w=b.createRenderbuffer();return this.bindRenderbuffer.set(w),b.renderbufferStorage(b.RENDERBUFFER,i,a,m),this.bindRenderbuffer.set(null),w}createFramebuffer(i,a,m,b){return new _f(this,i,a,m,b)}clear({color:i,depth:a,stencil:m,colorMask:b}){const w=this.gl;let E=0;i&&(E|=w.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set(b||[!0,!0,!0,!0])),a!==void 0&&(E|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),m!==void 0&&(E|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),w.clear(E)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){r.bh(i.blendFunction,Be.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor),i.blendEquation?this.blendEquation.set(i.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(i.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let vf;function yf(p,i,a,m,b,w,E){const R=p.context,z=R.gl,N=p.transform,j=p.getOrCreateProgram("collisionBox"),X=[];let K=0,Q=0;for(let Pe=0;Pe<m.length;Pe++){const Fe=m[Pe],ze=i.getTile(Fe),qe=ze.getBucket(a);if(!qe)continue;const $e=mr(Fe,qe,N);let We=$e;b[0]===0&&b[1]===0||(We=p.translatePosMatrix($e,ze,b,w));const nt=E?qe.textCollisionBox:qe.iconCollisionBox,Ke=qe.collisionCircleArray;if(Ke.length>0){const Ye=r.a6.mat4.create(),ft=We;r.a6.mat4.mul(Ye,qe.placementInvProjMatrix,N.glCoordMatrix),r.a6.mat4.mul(Ye,Ye,qe.placementViewportMatrix),X.push({circleArray:Ke,circleOffset:Q,transform:ft,invTransform:Ye,projection:qe.getProjection()}),K+=Ke.length/4,Q=K}nt&&(p.terrain&&p.terrain.setupElevationDraw(ze,j),j.draw(p,z.LINES,dt.disabled,Kt.disabled,p.colorModeForRenderPass(),Mn.disabled,Ab(We,N,ze,qe.getProjection()),a.id,nt.layoutVertexBuffer,nt.indexBuffer,nt.segments,null,N.zoom,null,[nt.collisionVertexBuffer,nt.collisionVertexBufferExt]))}if(!E||!X.length)return;const he=p.getOrCreateProgram("collisionCircle"),me=new r.cQ;me.resize(4*K),me._trim();let _e=0;for(const Pe of X)for(let Fe=0;Fe<Pe.circleArray.length/4;Fe++){const ze=4*Fe,qe=Pe.circleArray[ze+0],$e=Pe.circleArray[ze+1],We=Pe.circleArray[ze+2],nt=Pe.circleArray[ze+3];me.emplace(_e++,qe,$e,We,nt,0),me.emplace(_e++,qe,$e,We,nt,1),me.emplace(_e++,qe,$e,We,nt,2),me.emplace(_e++,qe,$e,We,nt,3)}(!vf||vf.length<2*K)&&(vf=function(Pe){const Fe=2*Pe,ze=new r.aO;ze.resize(Fe),ze._trim();for(let qe=0;qe<Fe;qe++){const $e=6*qe;ze.uint16[$e+0]=4*qe+0,ze.uint16[$e+1]=4*qe+1,ze.uint16[$e+2]=4*qe+2,ze.uint16[$e+3]=4*qe+2,ze.uint16[$e+4]=4*qe+3,ze.uint16[$e+5]=4*qe+0}return ze}(K));const ve=R.createIndexBuffer(vf,!0),ke=R.createVertexBuffer(me,r.cR.members,!0);for(const Pe of X){const Fe={u_matrix:Pe.transform,u_inv_matrix:Pe.invTransform,u_camera_to_center_distance:(De=N).getCameraToCenterDistance(Pe.projection),u_viewport_size:[De.width,De.height]};he.draw(p,z.TRIANGLES,dt.disabled,Kt.disabled,p.colorModeForRenderPass(),Mn.disabled,Fe,a.id,ke,ve,r.b1.simpleSegment(0,2*Pe.circleOffset,Pe.circleArray.length,Pe.circleArray.length/2),null,N.zoom)}var De;ke.destroy(),ve.destroy()}const Mh=r.a6.mat4.create();function ym(p){const i=p._camera.getWorldToCamera(p.worldSize,1),a=r.a6.mat4.multiply([],i,p.globeMatrix);r.a6.mat4.invert(a,a);const m=[0,0,0],b=[0,1,0,0];return r.a6.vec4.transformMat4(b,b,a),m[0]=b[0],m[1]=b[1],m[2]=b[2],r.a6.vec3.normalize(m,m),m}function kb({width:p,height:i,anchor:a,textOffset:m,textScale:b},w){const{horizontalAlign:E,verticalAlign:R}=r.bx(a),z=-(E-.5)*p,N=-(R-.5)*i,j=r.bw(a,m);return new r.P((z/b+j[0])*w,(N/b+j[1])*w)}function Rb(p,i,a,m,b,w,E,R,z,N,j){const X=p.text.placedSymbolArray,K=p.text.dynamicLayoutVertexArray,Q=p.icon.dynamicLayoutVertexArray,he={},me=p.getProjection(),_e=Kr(R,me,w),ve=w.elevation,ke=me.upVectorScale(R.canonical,w.center.lat,w.worldSize).metersToTile;K.clear();for(let De=0;De<X.length;De++){const Pe=X.get(De),{tileAnchorX:Fe,tileAnchorY:ze,numGlyphs:qe}=Pe,$e=Pe.hidden||!Pe.crossTileID||p.allowVerticalPlacement&&!Pe.placedOrientation?null:m[Pe.crossTileID];if($e){let We=0,nt=0,Ke=0;if(ve){const zt=ve?ve.getAtTileOffset(R,Fe,ze):0,[sn,ln,Ut]=me.upVector(R.canonical,Fe,ze);We=zt*sn*ke,nt=zt*ln*ke,Ke=zt*Ut*ke}let[Ye,ft,kt,jt]=kr(Pe.projectedAnchorX+We,Pe.projectedAnchorY+nt,Pe.projectedAnchorZ+Ke,a?_e:E);const Pt=ri(w.getCameraToCenterDistance(me),jt);let nn=b.evaluateSizeForFeature(p.textSizeData,N,Pe)*Pt/r.bq;a&&(nn*=p.tilePixelRatio/z);const pt=kb($e,nn);a?({x:Ye,y:ft,z:kt}=me.projectTilePoint(Fe+pt.x,ze+pt.y,R.canonical),[Ye,ft,kt]=kr(Ye+We,ft+nt,kt+Ke,E)):(i&&pt._rotate(-w.angle),Ye+=pt.x,ft+=pt.y,kt=0);const Vt=p.allowVerticalPlacement&&Pe.placedOrientation===r.bk.vertical?Math.PI/2:0;for(let zt=0;zt<qe;zt++)r.bn(K,Ye,ft,kt,Vt);j&&Pe.associatedIconIndex>=0&&(he[Pe.associatedIconIndex]={x:Ye,y:ft,z:kt,angle:Vt})}else zi(qe,K)}if(j){Q.clear();const De=p.icon.placedSymbolArray;for(let Pe=0;Pe<De.length;Pe++){const Fe=De.get(Pe),{numGlyphs:ze}=Fe,qe=he[Pe];if(Fe.hidden||!qe)zi(ze,Q);else{const{x:$e,y:We,z:nt,angle:Ke}=qe;for(let Ye=0;Ye<ze;Ye++)r.bn(Q,$e,We,nt,Ke)}}p.icon.dynamicLayoutVertexBuffer.updateData(Q)}p.text.dynamicLayoutVertexBuffer.updateData(K)}function kh(p,i,a,m,b,w,E={}){const R=a.paint.get("icon-translate"),z=a.paint.get("text-translate"),N=a.paint.get("icon-translate-anchor"),j=a.paint.get("text-translate-anchor"),X=a.layout.get("icon-rotation-alignment"),K=a.layout.get("text-rotation-alignment"),Q=a.layout.get("icon-pitch-alignment"),he=a.layout.get("text-pitch-alignment"),me=a.layout.get("icon-keep-upright"),_e=a.layout.get("text-keep-upright"),ve=a.paint.get("icon-color-saturation"),ke=a.paint.get("icon-color-contrast"),De=a.paint.get("icon-color-brightness-min"),Pe=a.paint.get("icon-color-brightness-max"),Fe=a.paint.get("symbol-elevation-reference")==="sea",ze=a.paint.get("text-occlusion-opacity").constantOr(0),qe=p.context,$e=qe.gl,We=p.transform,nt=X==="map",Ke=K==="map",Ye=Q==="map",ft=he==="map",kt=a.layout.get("symbol-sort-key").constantOr(1)!==void 0;let jt=!1;const Pt=p.depthModeForSublayer(0,dt.ReadOnly),nn=[r.am(We.center.lng),r.at(We.center.lat)],pt=a.layout.get("text-variable-anchor"),Vt=We.projection.name==="globe",zt=[],sn=[0,-1,0];for(const ln of m){const Ut=i.getTile(ln),qt=Ut.getBucket(a);if(!qt||qt.projection.name==="mercator"&&Vt||qt.fullyClipped)continue;const Fn=qt.projection.name==="globe",pn=Fn?r.a9(We.zoom):0,Cn=Kr(ln,qt.getProjection(),We),Yn=We.calculatePixelsToTileUnitsMatrix(Ut),Dn=pt&&qt.hasTextData(),qn=qt.hasIconTextFit()&&Dn&&qt.hasIconData(),di=qt.getProjection().createInversionMatrix(We,ln.canonical),ai=Zi=>{We.depthOcclusionForSymbolsAndCircles&&(a.hasInitialOcclusionOpacityProperties||p.terrain)&&(Zi.push("DEPTH_D24"),Zi.push("DEPTH_OCCLUSION"))},Hi=()=>{const Zi=nt&&a.layout.get("symbol-placement")!=="point",li=[];ai(li);const Oi=Zi||qn,Ui=a.paint.get("icon-image-cross-fade").constantOr(0);p.terrainRenderModeElevated()&&Ye&&li.push("PITCH_WITH_MAP_TERRAIN"),Fn&&(li.push("PROJECTION_GLOBE_VIEW"),Oi&&li.push("PROJECTED_POS_ON_VIEWPORT")),Ui>0&&li.push("ICON_TRANSITION"),qt.icon.zOffsetVertexBuffer&&li.push("Z_OFFSET"),ve===0&&ke===0&&De===0&&Pe===1||li.push("COLOR_ADJUSTMENT"),qt.sdfIcons&&li.push("RENDER_SDF");const Zr=qt.icon.programConfigurations.get(a.id),oo=p.getOrCreateProgram("symbol",{config:Zr,defines:li}),Ii=Ut.imageAtlasTexture?Ut.imageAtlasTexture.size:[0,0],Mo=qt.iconSizeData,jo=r.bj(Mo,We.zoom),ko=Ye||We.pitch!==0,cr=fi(Cn,Ut.tileID.canonical,Ye,nt,We,qt.getProjection(),Yn),ks=no(Cn,Ut.tileID.canonical,Ye,nt,We,qt.getProjection(),Yn),Rs=p.translatePosMatrix(ks,Ut,R,N,!0),Ca=p.translatePosMatrix(Cn,Ut,R,N),pa=Oi?Mh:cr,Hs=nt&&!Ye&&!Zi;let Aa=sn;!Vt&&!We.mercatorFromTransition||nt||(Aa=ym(We));const Pl=Fn?Aa:sn,ic=a.getColorAdjustmentMatrix(ve,ke,De,Pe),al=_m(Mo.kind,jo,Hs,Ye,p,Ca,pa,Rs,Fe,!1,Ii,[0,0],!0,ln,pn,nn,di,Pl,qt.getProjection(),ic,Ui),Au=Ut.imageAtlasTexture?Ut.imageAtlasTexture:null,Pu=a.layout.get("icon-size").constantOr(0)!==1||qt.iconsNeedLinear,zf=qt.sdfIcons||p.options.rotating||p.options.zooming||Pu||ko?$e.LINEAR:$e.NEAREST,Mu=qt.sdfIcons&&a.paint.get("icon-halo-width").constantOr(1)!==0,ur=p.terrain&&Ye&&Zi?r.a6.mat4.invert(r.a6.mat4.create(),cr):Mh;if(Zi&&qt.icon){const Lc=We.elevation,Wb=Lc?Lc.getAtTileOffsetFunc(ln,We.center.lat,We.worldSize,qt.getProjection()):null,Rv=hi(Cn,Ut.tileID.canonical,Ye,nt,We,qt.getProjection(),Yn);us(qt,Cn,p,!1,Rv,ks,Ye,me,Wb,ln)}return{program:oo,buffers:qt.icon,uniformValues:al,atlasTexture:Au,atlasTextureIcon:null,atlasInterpolation:zf,atlasInterpolationIcon:null,isSDF:qt.sdfIcons,hasHalo:Mu,tile:Ut,labelPlaneMatrixInv:ur}},nr=()=>{const Zi=Ke&&a.layout.get("symbol-placement")!=="point",li=[],Oi=Zi||pt||qn;p.terrainRenderModeElevated()&&ft&&li.push("PITCH_WITH_MAP_TERRAIN"),Fn&&(li.push("PROJECTION_GLOBE_VIEW"),Oi&&li.push("PROJECTED_POS_ON_VIEWPORT")),qt.text.zOffsetVertexBuffer&&li.push("Z_OFFSET"),qt.iconsInText&&li.push("RENDER_TEXT_AND_SYMBOL"),li.push("RENDER_SDF"),ai(li);const Ui=qt.text.programConfigurations.get(a.id),Zr=p.getOrCreateProgram("symbol",{config:Ui,defines:li});let oo,Ii=[0,0],Mo=null;const jo=qt.textSizeData;qt.iconsInText&&(Ii=Ut.imageAtlasTexture?Ut.imageAtlasTexture.size:[0,0],Mo=Ut.imageAtlasTexture?Ut.imageAtlasTexture:null,oo=ft||We.pitch!==0||p.options.rotating||p.options.zooming||jo.kind==="composite"||jo.kind==="camera"?$e.LINEAR:$e.NEAREST);const ko=Ut.glyphAtlasTexture?Ut.glyphAtlasTexture.size:[0,0],cr=r.bj(jo,We.zoom),ks=fi(Cn,Ut.tileID.canonical,ft,Ke,We,qt.getProjection(),Yn),Rs=no(Cn,Ut.tileID.canonical,ft,Ke,We,qt.getProjection(),Yn),Ca=p.translatePosMatrix(Rs,Ut,z,j,!0),pa=p.translatePosMatrix(Cn,Ut,z,j),Hs=Oi?Mh:ks,Aa=Ke&&!ft&&!Zi;let Pl=sn;!Vt&&!We.mercatorFromTransition||Ke||(Pl=ym(We));const ic=_m(jo.kind,cr,Aa,ft,p,pa,Hs,Ca,Fe,!0,ko,Ii,!0,ln,pn,nn,di,Fn?Pl:sn,qt.getProjection(),ze),al=Ut.glyphAtlasTexture?Ut.glyphAtlasTexture:null,Au=$e.LINEAR,Pu=a.paint.get("text-halo-width").constantOr(1)!==0,zf=p.terrain&&ft&&Zi?r.a6.mat4.invert(r.a6.mat4.create(),ks):Mh;if(Zi&&qt.text){const Mu=We.elevation,ur=Mu?Mu.getAtTileOffsetFunc(ln,We.center.lat,We.worldSize,qt.getProjection()):null,Lc=hi(Cn,Ut.tileID.canonical,ft,Ke,We,qt.getProjection(),Yn);us(qt,Cn,p,!0,Lc,Rs,ft,_e,ur,ln)}return{program:Zr,buffers:qt.text,uniformValues:ic,atlasTexture:al,atlasTextureIcon:Mo,atlasInterpolation:Au,atlasInterpolationIcon:oo,isSDF:!0,hasHalo:Pu,tile:Ut,labelPlaneMatrixInv:zf}},gr=qt.icon.segments.get().length,Ia=qt.text.segments.get().length,ro=gr&&!E.onlyText?Hi():null,vi=Ia&&!E.onlyIcons?nr():null,Yi=a.paint.get("icon-opacity").constantOr(1),Lr=a.paint.get("text-opacity").constantOr(1);if(kt&&qt.canOverlap){jt=!0;const Zi=Yi&&!E.onlyText?qt.icon.segments.get():[],li=Lr&&!E.onlyIcons?qt.text.segments.get():[];for(const Oi of Zi)zt.push({segments:new r.b1([Oi]),sortKey:Oi.sortKey,state:ro});for(const Oi of li)zt.push({segments:new r.b1([Oi]),sortKey:Oi.sortKey,state:vi})}else E.onlyText||zt.push({segments:Yi?qt.icon.segments:new r.b1([]),sortKey:0,state:ro}),E.onlyIcons||zt.push({segments:Lr?qt.text.segments:new r.b1([]),sortKey:0,state:vi})}jt&&zt.sort((ln,Ut)=>ln.sortKey-Ut.sortKey);for(const ln of zt){const Ut=ln.state;if(Ut)if(p.terrain?p.terrain.setupElevationDraw(Ut.tile,Ut.program,{useDepthForOcclusion:We.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Ut.labelPlaneMatrixInv}):p.setupDepthForOcclusion(We.depthOcclusionForSymbolsAndCircles,Ut.program),qe.activeTexture.set($e.TEXTURE0),Ut.atlasTexture&&Ut.atlasTexture.bind(Ut.atlasInterpolation,$e.CLAMP_TO_EDGE,!0),Ut.atlasTextureIcon&&(qe.activeTexture.set($e.TEXTURE1),Ut.atlasTextureIcon&&Ut.atlasTextureIcon.bind(Ut.atlasInterpolationIcon,$e.CLAMP_TO_EDGE,!0)),p.uploadCommonLightUniforms(p.context,Ut.program),Ut.hasHalo){const qt=Ut.uniformValues;qt.u_is_halo=1,Rh(Ut.buffers,ln.segments,a,p,Ut.program,Pt,b,w,qt,2),qt.u_is_halo=0}else{if(Ut.isSDF){const qt=Ut.uniformValues;Ut.hasHalo&&(qt.u_is_halo=1,Rh(Ut.buffers,ln.segments,a,p,Ut.program,Pt,b,w,qt,1)),qt.u_is_halo=0}Rh(Ut.buffers,ln.segments,a,p,Ut.program,Pt,b,w,Ut.uniformValues,1)}}}function Rh(p,i,a,m,b,w,E,R,z,N){const j=[p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer,p.iconTransitioningVertexBuffer,p.globeExtVertexBuffer,p.zOffsetVertexBuffer];b.draw(m,m.context.gl.TRIANGLES,w,E,R,Mn.disabled,z,a.id,p.layoutVertexBuffer,p.indexBuffer,i,a.paint,m.transform.zoom,p.programConfigurations.get(a.id),j,N)}function bf(p,i,a,m,b,w,E){const R=p.context.gl,z=a.paint.get("fill-pattern"),N=a.is3D(),j=N?p.stencilModeFor3D():Kt.disabled,X=z&&z.constantOr(1);let K,Q,he,me,_e;E?(Q=X&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",K=R.LINES):(Q=X?"fillPattern":"fill",K=R.TRIANGLES);for(const ve of m){const ke=i.getTile(ve);if(X&&!ke.patternsLoaded())continue;const De=ke.getBucket(a);if(!De)continue;p.prepareDrawTile();const Pe=De.programConfigurations.get(a.id),Fe=p.isTileAffectedByFog(ve),ze=p.getOrCreateProgram(Q,{config:Pe,overrideFog:Fe});X&&(p.context.activeTexture.set(R.TEXTURE0),ke.imageAtlasTexture&&ke.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),Pe.updatePaintBuffers());const qe=z.constantOr(null);if(qe&&ke.imageAtlas){const nt=ke.imageAtlas.patternPositions[qe.toString()];nt&&Pe.setConstantPatternPositions(nt)}const $e=p.translatePosMatrix(ve.projMatrix,ke,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor")),We=a.paint.get("fill-emissive-strength");if(E){me=De.indexBuffer2,_e=De.segments2;const nt=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[R.drawingBufferWidth,R.drawingBufferHeight];he=Q==="fillOutlinePattern"&&X?Ah($e,We,p,ke,nt):lv($e,We,nt)}else me=De.indexBuffer,_e=De.segments,he=X?av($e,We,p,ke):hf($e,We);p.uploadCommonUniforms(p.context,ze,ve.toUnwrapped()),ze.draw(p,K,b,N?j:p.stencilModeForClipping(ve),w,Mn.disabled,he,a.id,De.layoutVertexBuffer,me,_e,a.paint,p.transform.zoom,Pe,void 0)}}function vu(p,i,a,m,b,w,E,R){a.resetLayerRenderingStats(p);const z=p.context,N=z.gl,j=p.transform,X=a.paint.get("fill-extrusion-pattern"),K=X.constantOr(1),Q=a.paint.get("fill-extrusion-opacity"),he=p.style.enable3dLights(),me=a.paint.get(he&&!K?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),_e=[a.paint.get("fill-extrusion-ambient-occlusion-intensity"),me],ve=a.layout.get("fill-extrusion-edge-radius"),ke=ve>0&&!a.paint.get("fill-extrusion-rounded-roof"),De=ke?0:ve,Pe=j.projection.name==="globe"?r.c_():0,Fe=j.projection.name==="globe",ze=Fe?r.a9(j.zoom):0,qe=[r.am(j.center.lng),r.at(j.center.lat)],$e=a.paint.get("fill-extrusion-flood-light-color").toRenderColor(a.lut).toArray01().slice(0,3),We=a.paint.get("fill-extrusion-flood-light-intensity"),nt=a.paint.get("fill-extrusion-vertical-scale"),Ke=a.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Ye=Sl(p,a.paint.get("fill-extrusion-cutoff-fade-range")),ft=[];let kt;Fe&&ft.push("PROJECTION_GLOBE_VIEW"),_e[0]>0&&ft.push("FAUX_AO"),ke&&ft.push("ZERO_ROOF_RADIUS"),R&&ft.push("HAS_CENTROID"),We>0&&ft.push("FLOOD_LIGHT"),Ye.shouldRenderCutoff&&ft.push("RENDER_CUTOFF"),Ke&&ft.push("RENDER_WALL_MODE");const jt=p.renderPass==="shadow",Pt=p.shadowRenderer,nn=jt&&!!Pt;p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!0);let pt=[0,0,0];if(Pt){const sn=p.style.directionalLight,ln=p.style.ambientLight;sn&&ln&&(pt=Xd(p.style,sn,ln)),kt=ft.concat(["SHADOWS_SINGLE_CASCADE"])}const Vt=nn?"fillExtrusionDepth":K?"fillExtrusionPattern":"fillExtrusion",zt=a.getLayerRenderingStats();for(const sn of m){const ln=i.getTile(sn),Ut=ln.getBucket(a);if(!Ut||Ut.projection.name!==j.projection.name)continue;let qt=!1;Pt&&(qt=Pt.getMaxCascadeForTile(sn.toUnwrapped())===0);const Fn=p.isTileAffectedByFog(sn),pn=Ut.programConfigurations.get(a.id),Cn=p.getOrCreateProgram(Vt,{config:pn,defines:qt?kt:ft,overrideFog:Fn});if(p.terrain&&p.terrain.setupElevationDraw(ln,Cn,{useMeterToDem:!0}),!Ut.centroidVertexBuffer){const nr=Cn.attributes.a_centroid_pos;nr!==void 0&&N.vertexAttrib2f(nr,0,0)}!jt&&Pt&&Pt.setupShadows(ln.tileID.toUnwrapped(),Cn,"vector-tile",ln.tileID.overscaledZ),K&&(p.context.activeTexture.set(N.TEXTURE0),ln.imageAtlasTexture&&ln.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),pn.updatePaintBuffers());const Yn=X.constantOr(null);if(Yn&&ln.imageAtlas){const nr=ln.imageAtlas.patternPositions[Yn.toString()];nr&&pn.setConstantPatternPositions(nr)}const Dn=a.paint.get("fill-extrusion-vertical-gradient"),qn=1/Ut.tileToMeter;let di;if(jt&&Pt){if(wm(ln.tileID,Ut,p))continue;const nr=Pt.calculateShadowPassMatrixFromTile(ln.tileID.toUnwrapped());di=sv(nr,De,qn,nt)}else{const nr=p.translatePosMatrix(sn.expandedProjMatrix,ln,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),gr=j.projection.createInversionMatrix(j,sn.canonical);di=K?mm(nr,p,Dn,Q,_e,De,qn,sn,ln,Pe,ze,qe,gr,$e,nt):pm(nr,p,Dn,Q,_e,De,qn,sn,Pe,ze,qe,gr,$e,nt,We,pt)}p.uploadCommonUniforms(z,Cn,sn.toUnwrapped(),null,Ye);let ai=Ut.segments;if(j.projection.name==="mercator"&&!jt&&(ai=Ut.getVisibleSegments(ln.tileID,p.terrain,p.transform.getFrustum(0)),!ai.get().length))continue;if(zt)if(jt)for(const nr of ai.get())zt.numRenderedVerticesInShadowPass+=nr.primitiveLength;else for(const nr of ai.get())zt.numRenderedVerticesInTransparentPass+=nr.primitiveLength;const Hi=[];(p.terrain||R)&&Hi.push(Ut.centroidVertexBuffer),Fe&&Hi.push(Ut.layoutVertexExtBuffer),Ke&&Hi.push(Ut.wallVertexBuffer),Cn.draw(p,z.gl.TRIANGLES,b,w,E,Mn.backCCW,di,a.id,Ut.layoutVertexBuffer,Ut.indexBuffer,ai,a.paint,p.transform.zoom,pn,Hi)}p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!1)}function qo(p,i,a,m,b,w,E,R,z,N,j,X,K,Q,he,me,_e,ve,ke){const De=p.context,Pe=De.gl,Fe=p.transform,ze=p.transform.zoom,qe=[],$e=Sl(p,a.paint.get("fill-extrusion-cutoff-fade-range"));N==="clear"?(qe.push("CLEAR_SUBPASS"),ke&&(qe.push("CLEAR_FROM_TEXTURE"),De.activeTexture.set(Pe.TEXTURE0),ke.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE))):N==="sdf"&&qe.push("SDF_SUBPASS"),_e&&qe.push("HAS_CENTROID"),$e.shouldRenderCutoff&&qe.push("RENDER_CUTOFF");const We=a.layout.get("fill-extrusion-edge-radius"),nt=(Ke,Ye,ft,kt,jt)=>{const Pt=Ye.programConfigurations.get(a.id),nn=p.isTileAffectedByFog(Ke),pt=p.getOrCreateProgram("fillExtrusionGroundEffect",{config:Pt,defines:qe,overrideFog:nn}),Vt=((sn,ln,Ut,qt,Fn,pn,Cn,Yn,Dn,qn,di)=>({u_matrix:ln,u_opacity:Ut,u_ao_pass:qt?1:0,u_meter_to_tile:Fn,u_ao:pn,u_flood_light_intensity:Cn,u_flood_light_color:Yn,u_attenuation:Dn,u_edge_radius:qn,u_fb:0,u_fb_size:di,u_dynamic_offset:1}))(0,kt,j,z,jt,[X,K*jt],Q,he,me,ze>=17?0:We*jt,ke?ke.size[0]:0),zt=[];_e&&zt.push(Ye.hiddenByLandmarkVertexBuffer),p.uploadCommonUniforms(De,pt,Ke.toUnwrapped(),null,$e),pt.draw(p,De.gl.TRIANGLES,b,w,E,R,Vt,a.id,Ye.vertexBuffer,Ye.indexBuffer,ft,a.paint,ze,Pt,zt)};for(const Ke of m){const Ye=i.getTile(Ke),ft=Ye.getBucket(a);if(!ft||ft.projection.name!==Fe.projection.name||!ft.groundEffect||ft.groundEffect&&!ft.groundEffect.hasData())continue;const kt=ft.groundEffect,jt=1/ft.tileToMeter;{const Pt=p.translatePosMatrix(Ke.projMatrix,Ye,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),nn=kt.getDefaultSegment();nt(Ke,kt,nn,Pt,jt)}if(ve)for(let Pt=0;Pt<4;Pt++){const nn=r.c$[Pt](Ke),pt=i.getTile(nn);if(!pt)continue;const Vt=pt.getBucket(a);if(!Vt||Vt.projection.name!==Fe.projection.name||!Vt.groundEffect||Vt.groundEffect&&!Vt.groundEffect.hasData())continue;const zt=Vt.groundEffect;let sn,ln;Pt===0?(sn=[-r.ab,0,0],ln=1):Pt===1?(sn=[r.ab,0,0],ln=0):Pt===2?(sn=[0,-r.ab,0],ln=3):(sn=[0,r.ab,0],ln=2);const Ut=zt.regionSegments[ln];if(!Ut)continue;const qt=new Float32Array(16);r.a6.mat4.translate(qt,Ke.projMatrix,sn),nt(Ke,zt,Ut,p.translatePosMatrix(qt,Ye,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),jt)}}}function Kl(p,i,a,m,b,w,E){m.centroidVertexArray.length===0&&m.createCentroidsBuffer();const R=w?w.findDEMTileFor(a):null;if(!(R&&R.dem||E))return;const z=ve=>new r.P(Math.ceil((ve+r.d2)*r.d3),0),N=ve=>{const ke=i.getSource().minzoom,De=Fe=>{const ze=i.getTileByID(Fe);if(ze&&ze.hasData())return ze.getBucket(b)},Pe=[0,-1,1];for(const Fe of Pe){if(ve.overscaledZ+Fe<ke)continue;const ze=De(ve.calculateScaledKey(ve.overscaledZ+Fe));if(ze)return ze}},j=[0,0,0],X=(ve,ke)=>(j[0]=Math.min(ve.min.y,ke.min.y),j[1]=Math.max(ve.max.y,ke.max.y),j[2]=r.ab-ke.min.x>ve.max.x?ke.min.x-r.ab:ve.max.x,j),K=(ve,ke)=>(j[0]=Math.min(ve.min.x,ke.min.x),j[1]=Math.max(ve.max.x,ke.max.x),j[2]=r.ab-ke.min.y>ve.max.y?ke.min.y-r.ab:ve.max.y,j),Q=[(ve,ke)=>X(ve,ke),(ve,ke)=>X(ke,ve),(ve,ke)=>K(ve,ke),(ve,ke)=>K(ke,ve)],he=(ve,ke,De,Pe,Fe,ze,qe)=>{if(!w)return 0;const $e=[[ze?De:ve,ze?ve:De,0],[ze?De:ke,ze?ke:De,0]],We=qe<0?r.ab+qe:qe,nt=[ze?We:(ve+ke)/2,ze?(ve+ke)/2:We,0];return De===0&&qe<0||De!==0&&qe>0?w.getForTilePoints(Fe,[nt],!0,Pe):$e.push(nt),w.getForTilePoints(a,$e,!0,R),Math.max($e[0][2],$e[1][2],nt[2])/w.exaggeration()};for(let ve=0;ve<4;ve++){const ke=m.borderFeatureIndices[ve];if(ke.length===0)continue;const De=r.c$[ve](a),Pe=N(De);if(!(Pe&&Pe instanceof r.d0)||m.borderDoneWithNeighborZ[ve]===Pe.canonical.z)continue;Pe.centroidVertexArray.length===0&&Pe.createCentroidsBuffer();const Fe=w?w.findDEMTileFor(De):null;if(!(Fe&&Fe.dem||E))continue;const ze=(ve<2?1:5)-ve,qe=Pe.borderDoneWithNeighborZ[ze]!==m.canonical.z,$e=Pe.borderFeatureIndices[ze];let We=0;if(m.canonical.z!==Pe.canonical.z){for(const nt of ke)m.showCentroid(m.featuresOnBorder[nt]);if(qe)for(const nt of $e)Pe.showCentroid(Pe.featuresOnBorder[nt]);m.borderDoneWithNeighborZ[ve]=Pe.canonical.z,Pe.borderDoneWithNeighborZ[ze]=m.canonical.z}for(const nt of ke){const Ke=m.featuresOnBorder[nt],Ye=m.centroidData[Ke.centroidDataIndex],ft=Ke.borders[ve];let kt;for(;We<$e.length;){kt=Pe.featuresOnBorder[$e[We]];const jt=kt.borders[ze];if(jt[1]>ft[0]+3||jt[0]>ft[0]-3)break;Pe.showCentroid(kt),We++}if(kt&&We<$e.length){const jt=We;let Pt=0;for(;!(kt.borders[ze][0]>ft[1]-3)&&(Pt++,++We!==$e.length);)kt=Pe.featuresOnBorder[$e[We]];kt=Pe.featuresOnBorder[$e[jt]];let nn=!1;if(Pt>=1){const zt=kt.borders[ze];Math.abs(ft[0]-zt[0])<3&&Math.abs(ft[1]-zt[1])<3&&(Pt=1,nn=!0,We=jt+1)}else if(Pt===0){m.showCentroid(Ke);continue}const pt=Pe.centroidData[kt.centroidDataIndex];E&&nn&&(((me=Ye).flags|(_e=pt).flags)&r.d1?(me.flags|=r.d1,_e.flags|=r.d1):(me.flags&=~r.d1,_e.flags&=~r.d1));const Vt=Ke.intersectsCount()>1||kt.intersectsCount()>1;if(Pt>1)We=jt,Ye.centroidXY=pt.centroidXY=new r.P(0,0);else if(Fe&&Fe.dem&&!Vt){const zt=Q[ve](Ye,pt),sn=ve%2?r.ab-1:0,ln=he(zt[0],Math.min(r.ab-1,zt[1]),sn,Fe,De,ve<2,zt[2]);Ye.centroidXY=pt.centroidXY=z(ln)}else Vt?Ye.centroidXY=pt.centroidXY=new r.P(0,0):(Ye.centroidXY=m.encodeBorderCentroid(Ke),pt.centroidXY=Pe.encodeBorderCentroid(kt));m.writeCentroidToBuffer(Ye),Pe.writeCentroidToBuffer(pt)}else m.showCentroid(Ke)}m.borderDoneWithNeighborZ[ve]=Pe.canonical.z,Pe.borderDoneWithNeighborZ[ze]=m.canonical.z}var me,_e;(m.needsCentroidUpdate||!m.centroidVertexBuffer&&m.centroidVertexArray.length!==0)&&m.uploadCentroid(p)}const pv=[1,0,0],bm=[0,1,0],xm=[0,0,1];function wm(p,i,a){const m=a.transform,b=a.shadowRenderer;if(!b)return!0;const w=p.toUnwrapped(),E=m.tileSize*b._cascades[a.currentShadowCascade].scale;let R=i.maxHeight;if(m.elevation){const me=m.elevation.getMinMaxForTile(p);me&&(R+=me.max)}const z=[...b.shadowDirection];z[2]=-z[2];const N=b.computeSimplifiedTileShadowVolume(w,R,E,z);if(!N)return!1;const j=[pv,bm,xm,z,[z[0],0,z[2]],[0,z[1],z[2]]],X=m.projection.name==="globe",K=m.scaleZoom(E),Q=r.bN.fromInvProjectionMatrix(m.invProjMatrix,m.worldSize,K,!X),he=b.getCurrentCascadeFrustum();return Q.intersectsPrecise(N.vertices,N.planes,j)===0||he.intersectsPrecise(N.vertices,N.planes,j)===0}function Sm(p){return[p[0]*r.d4,p[1]*r.d4,p[2]*r.d4,0]}function Gs(p,i,a,m,b,w,E,R,z){const N=m.getSource(),j=a.globeSharedBuffers;if(!j)return;let X,K,Q;if(i&&(X=m.getTile(i)),N instanceof r.aD?(K=N.texture,Q=r.cD(0,0,a.transform)):X&&i&&(K=X.texture,Q=r.cD(i.canonical.z,i.canonical.x,a.transform)),!K||!Q)return;p||(Q=r.a6.mat4.scale(r.a6.mat4.create(),Q,[1,-1,1]));const he=a.context,me=he.gl,_e=b.paint.get("raster-resampling")==="nearest"?me.NEAREST:me.LINEAR,ve=a.colorModeForDrapableLayerRenderPass(w),ke=E.defines;ke.push("GLOBE_POLES");const De=new dt(me.LEQUAL,dt.ReadWrite,a.depthRangeFor3D),Pe=Float32Array.from(a.transform.expandedFarZProjMatrix),Fe=Float32Array.from(r.b5(r.cC(new r.bP(0,0,0))));a.terrain&&a.terrain.prepareDrawTile(),he.activeTexture.set(me.TEXTURE0),K.bind(_e,me.CLAMP_TO_EDGE),he.activeTexture.set(me.TEXTURE1),K.bind(_e,me.CLAMP_TO_EDGE),K.useMipmap&&he.extTextureFilterAnisotropic&&a.transform.pitch>20&&me.texParameterf(me.TEXTURE_2D,he.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,he.extTextureFilterAnisotropicMax);const[ze,qe,$e,We]=i?j.getPoleBuffers(i.canonical.z,!1):j.getPoleBuffers(0,!0),nt=b.paint.get("raster-elevation");let Ke;p?(Ke=ze,a.renderDefaultNorthPole=nt!==0):(Ke=qe,a.renderDefaultSouthPole=nt!==0);const Ye=Sm(E.mix),ft=((jt,Pt,nn,pt,Vt,zt,sn,ln,Ut,qt,Fn,pn,Cn)=>Ph(jt,Pt,nn,new Float32Array(16),new Float32Array(9),[0,0],pt,[0,0],[0,0,0,0],1,{opacity:1,mix:0},zt,[0,0],ln,2,qt,Fn,pn,1,0,Cn))(Pe,Fe,Q,r.a9(a.transform.zoom),0,b,0,nt,0,Ye,E.offset,E.range,w),kt=a.getOrCreateProgram("raster",{defines:ke});a.uploadCommonUniforms(he,kt,null),kt.draw(a,me.TRIANGLES,De,z,ve,R,ft,b.id,Ke,$e,We)}function qr(p){const i=p._nearZ,a=p.projection.farthestPixelDistance(p),m=a-i,b=.2*p.height,w=i+b;return[i,a,(w-b-i)/m,(w-i)/m]}function xf(p,i,a,m){if(p)return i instanceof ea&&p instanceof sr?i.getTextureDescriptor(p,a,!0):{texture:p.texture,mix:Sm(m.mix),offset:m.offset,buffer:0,tileSize:1}}var Tm=r.d5([{name:"a_index",type:"Int16",components:1}]);class mv{constructor(i,a,m,b){const w={width:m[0],height:m[1],data:null},E=i.gl;this.targetColorTexture=new r.T(i,w,E.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new r.T(i,w,E.RGBA8,{useMipmap:!1}),this.context=i,this.updateParticleTexture(a,b),this.lastInvalidatedAt=0}updateParticleTexture(i,a){if(this.particleTextureDimension===a.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const m=this.context.gl,b=a.width*a.height;this.particleTexture0=new r.T(this.context,a,m.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,a,m.RGBA8,{premultiply:!1,useMipmap:!1});const w=new r.d6;w.reserve(b);for(let E=0;E<b;E++)w.emplaceBack(E);this.particleIndexBuffer=this.context.createVertexBuffer(w,Tm.members,!0),this.particleSegment=r.b1.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=a.width}update(i){return!(this.lastInvalidatedAt<i&&(this.lastInvalidatedAt=r.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function gv(p,i,a){if(!p)return null;const m=i.getTextureDescriptor(p,a,!0);if(!m)return null;let{texture:b,mix:w,offset:E,tileSize:R,buffer:z,format:N}=m;if(!b||!N)return null;let j=!1;return N==="uint32"&&(j=!0,w[3]=0,w=df(r.d7,w,[0,a.paint.get("raster-particle-max-speed")]),E=ff(r.d7,E,[0,a.paint.get("raster-particle-max-speed")])),{texture:b,textureOffset:[z/(R+2*z),R/(R+2*z)],tileSize:R,scalarData:j,scale:w,offset:E,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[N]]}}function _v(p){const i=p._nearZ,a=p.projection.farthestPixelDistance(p),m=a-i,b=.2*p.height,w=i+b;return[i,a,(w-b-i)/m,(w-i)/m]}const Db=new r.bz(1,0,0,1),yu=new r.bz(0,1,0,1),bu=new r.bz(0,0,1,1),un=new r.bz(1,0,1,1),zn=new r.bz(0,1,1,1);function Ga(p,i,a,m,b,w,E){const R=p.context,z=p.transform,N=R.gl,j=z.projection.name==="globe",X=j?["PROJECTION_GLOBE_VIEW"]:[];let K=r.a6.mat4.clone(a.projMatrix);if(j&&r.a9(z.zoom)>0){const Ye=r.b4(a.canonical,z),ft=r.d8(Ye);K=r.a6.mat4.multiply(new Float32Array(16),z.globeMatrix,ft),r.a6.mat4.multiply(K,z.projMatrix,K)}const Q=r.a6.mat4.create();Q[12]+=2*b/(r.q.devicePixelRatio*z.width),Q[13]+=2*w/(r.q.devicePixelRatio*z.height),r.a6.mat4.multiply(K,Q,K);const he=p.getOrCreateProgram("debug",{defines:X}),me=i.getTileByID(a.key);p.terrain&&p.terrain.setupElevationDraw(me,he);const _e=dt.disabled,ve=Kt.disabled,ke=p.colorModeForRenderPass(),De="$debug";R.activeTexture.set(N.TEXTURE0),p.emptyTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),j?me._makeGlobeTileDebugBuffers(p.context,z):me._makeDebugTileBoundsBuffers(p.context,z.projection);const Pe=me._tileDebugBuffer||p.debugBuffer,Fe=me._tileDebugIndexBuffer||p.debugIndexBuffer,ze=me._tileDebugSegments||p.debugSegments;if(he.draw(p,N.LINE_STRIP,_e,ve,ke,Mn.disabled,cv(K,m),De,Pe,Fe,ze,null,null,null,[me._globeTileDebugBorderBuffer]),E){const Ye=me.latestRawTileData,ft=Math.floor((Ye&&Ye.byteLength||0)/1024);let kt=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(kt+=` => ${a.overscaledZ}`),kt+=` ${me.state}`,kt+=` ${ft}kb`,function(jt,Pt){jt.initDebugOverlayCanvas();const nn=jt.debugOverlayCanvas,pt=jt.context.gl,Vt=jt.debugOverlayCanvas.getContext("2d");Vt.clearRect(0,0,nn.width,nn.height),Vt.shadowColor="white",Vt.shadowBlur=2,Vt.lineWidth=1.5,Vt.strokeStyle="white",Vt.textBaseline="top",Vt.font="bold 36px Open Sans, sans-serif",Vt.fillText(Pt,5,5),Vt.strokeText(Pt,5,5),jt.debugOverlayTexture.update(nn),jt.debugOverlayTexture.bind(pt.LINEAR,pt.CLAMP_TO_EDGE)}(p,kt)}const qe=i.getTile(a).tileSize,$e=512/Math.min(qe,512)*(a.overscaledZ/z.zoom)*.5,We=me._tileDebugTextBuffer||p.debugBuffer,nt=me._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,Ke=me._tileDebugTextSegments||p.debugSegments;he.draw(p,N.TRIANGLES,_e,ve,Be.alphaBlended,Mn.disabled,cv(K,r.bz.transparent,$e),De,We,nt,Ke,null,null,null,[me._globeTileDebugTextBuffer])}function Or(p,i,a,m){Dh(p,0,i+a/2,p.transform.width,a,m)}function _t(p,i,a,m){Dh(p,i-a/2,0,a,p.transform.height,m)}function Dh(p,i,a,m,b,w){const E=p.context,R=E.gl;R.enable(R.SCISSOR_TEST),R.scissor(i*r.q.devicePixelRatio,a*r.q.devicePixelRatio,m*r.q.devicePixelRatio,b*r.q.devicePixelRatio),E.clear({color:w}),R.disable(R.SCISSOR_TEST)}const wf=r.d5([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Em}=wf;function Ha(p,i,a,m){p.emplaceBack(i,a,m)}class Im{constructor(i){this.vertexArray=new r.d9,this.indices=new r.aO,Ha(this.vertexArray,-1,-1,1),Ha(this.vertexArray,1,-1,1),Ha(this.vertexArray,-1,1,1),Ha(this.vertexArray,1,1,1),Ha(this.vertexArray,-1,-1,-1),Ha(this.vertexArray,1,-1,-1),Ha(this.vertexArray,-1,1,-1),Ha(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,Em),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=r.b1.simpleSegment(0,0,36,12)}}function Mc(p,i,a,m,b,w){const E=p.context.gl,R=i.paint.get("sky-atmosphere-color"),z=i.paint.get("sky-atmosphere-halo-color"),N=i.paint.get("sky-atmosphere-sun-intensity"),j=((X,K,Q,he,me)=>({u_matrix_3f:X,u_sun_direction:K,u_sun_intensity:Q,u_color_tint_r:[he.r,he.g,he.b,he.a],u_color_tint_m:[me.r,me.g,me.b,me.a],u_luminance:5e-5}))(r.a6.mat3.fromMat4(r.a6.mat3.create(),m),b,N,R,z);E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+w,i.skyboxTexture,0),a.draw(p,E.TRIANGLES,dt.disabled,Kt.disabled,Be.unblended,Mn.frontCW,j,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const xu=r.d5([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Ob{constructor(i){const a=new r.da;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);const m=new r.aO;m.emplaceBack(0,1,2),m.emplaceBack(2,3,0),this.vertexBuffer=i.createVertexBuffer(a,xu.members),this.indexBuffer=i.createIndexBuffer(m),this.segments=r.b1.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Lb=r.d5([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class vv{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Sf{constructor(i){this.colorModeAlphaBlendedWriteRGB=new Be([1,xe,1,xe],r.bz.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Be([1,0,1,0],r.bz.transparent,[!1,!1,!1,!0]),this.params=new vv,this.updateNeeded=!0,i.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),i.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(i){const a=i.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Ob(a);const m=this.params.sizeRange,b=this.params.intensityRange,w=function(j){const X=r.dd(30),K=[];for(let Q=0;Q<j;++Q){const he=2*Math.PI*X(),me=Math.acos(1-2*X())-.5*Math.PI;K.push(r.a6.vec3.fromValues(Math.cos(me)*Math.cos(he),Math.cos(me)*Math.sin(he),Math.sin(me)))}return K}(this.params.starsCount),E=r.dd(300),R=new r.db,z=new r.aO;let N=0;for(let j=0;j<w.length;++j){const X=r.a6.vec3.scale([],w[j],200),K=Math.max(0,1+.01*m*(1*E()-.5)),Q=Math.max(0,1+.01*b*(1*E()-.5));R.emplaceBack(X[0],X[1],X[2],-1,-1,K,Q),R.emplaceBack(X[0],X[1],X[2],1,-1,K,Q),R.emplaceBack(X[0],X[1],X[2],1,1,K,Q),R.emplaceBack(X[0],X[1],X[2],-1,1,K,Q),z.emplaceBack(N+0,N+1,N+2),z.emplaceBack(N+0,N+2,N+3),N+=4}this.starsVx=a.createVertexBuffer(R,Lb.members),this.starsIdx=a.createIndexBuffer(z),this.starsSegments=r.b1.simpleSegment(0,0,R.length,z.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(i,a){const m=i.context,b=m.gl,w=i.transform,E=new dt(b.LEQUAL,dt.ReadOnly,[0,1]),R=r.a9(w.zoom),z=i.style.getLut(a.scope),N=a.properties.get("color").toRenderColor(z).toArray01(),j=a.properties.get("high-color").toRenderColor(z).toArray01(),X=a.properties.get("space-color").toRenderColor(z).toArray01PremultipliedAlpha(),K=5e-4,Q=r.dc(a.properties.get("horizon-blend"),0,1,K,.25),he=r.cx(i,m,w)&&Q===K?w.worldSize/(2*Math.PI*1.025)-1:w.globeRadius,me=i.frameCounter/1e3%1,_e=r.a6.vec3.length(w.globeCenterInViewSpace),ve=Math.sqrt(Math.pow(_e,2)-Math.pow(he,2)),ke=Math.acos(ve/_e),De=Pe=>{const Fe=w.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Pe&&Fe.push("ALPHA_PASS");const ze=i.getOrCreateProgram("globeAtmosphere",{defines:Fe}),qe=((We,nt,Ke,Ye,ft,kt,jt,Pt,nn,pt,Vt,zt)=>({u_frustum_tl:We,u_frustum_tr:nt,u_frustum_br:Ke,u_frustum_bl:Ye,u_horizon:ft,u_transition:kt,u_fadeout_range:jt,u_color:Pt,u_high_color:nn,u_space_color:pt,u_temporal_offset:Vt,u_horizon_angle:zt}))(w.frustumCorners.TL,w.frustumCorners.TR,w.frustumCorners.BR,w.frustumCorners.BL,w.frustumCorners.horizon,R,Q,N,j,X,me,ke);i.uploadCommonUniforms(m,ze);const $e=this.atmosphereBuffer;$e&&ze.draw(i,b.TRIANGLES,E,Kt.disabled,Pe?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Mn.backCW,qe,Pe?"atmosphere_glow_alpha":"atmosphere_glow",$e.vertexBuffer,$e.indexBuffer,$e.segments)};De(!1),De(!0)}drawStars(i,a){const m=r.ap(a.properties.get("star-intensity"),0,1);if(m===0)return;const b=i.context,w=b.gl,E=i.transform,R=i.getOrCreateProgram("stars"),z=r.a6.quat.identity([]);r.a6.quat.rotateX(z,z,-E._pitch),r.a6.quat.rotateZ(z,z,-E.angle),r.a6.quat.rotateX(z,z,r.bB(E._center.lat)),r.a6.quat.rotateY(z,z,-r.bB(E._center.lng));const N=r.a6.mat4.fromQuat(new Float32Array(16),z),j=r.a6.mat4.multiply([],E.starsProjMatrix,N),X=r.a6.mat3.fromMat4([],N),K=r.a6.mat3.invert([],X),Q=[0,1,0];r.a6.vec3.transformMat3(Q,Q,K),r.a6.vec3.scale(Q,Q,this.params.sizeMultiplier);const he=[1,0,0];r.a6.vec3.transformMat3(he,he,K),r.a6.vec3.scale(he,he,this.params.sizeMultiplier);const me=(_e=Q,ve=he,ke=m,{u_matrix:Float32Array.from(j),u_up:_e,u_right:ve,u_intensity_multiplier:ke});var _e,ve,ke;i.uploadCommonUniforms(b,R),this.starsVx&&this.starsIdx&&R.draw(i,w.TRIANGLES,dt.disabled,Kt.disabled,this.colorModeAlphaBlendedWriteRGB,Mn.disabled,me,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Tf(p,i){const a=[...p],m=i.cameraWorldSizeForFog/i.worldSize,b=r.a6.mat4.identity([]);return r.a6.mat4.scale(b,b,[m,m,1]),r.a6.mat4.multiply(a,b,a),r.a6.mat4.multiply(a,i.worldToFogMatrix,a),a}function Ef(p,i,a,m,b){const w=a.material,E=m.context,{baseColorTexture:R,metallicRoughnessTexture:z}=w.pbrMetallicRoughness,{normalTexture:N,occlusionTexture:j,emissionTexture:X}=w;function K(Q,he,me){if(Q&&(p.push(he),E.activeTexture.set(E.gl.TEXTURE0+me),Q.gfxTexture)){const{minFilter:_e,magFilter:ve,wrapS:ke,wrapT:De}=Q.sampler;Q.gfxTexture.bindExtraParam(_e,ve,ke,De)}}K(R,"HAS_TEXTURE_u_baseColorTexture",Po.BaseColor),K(z,"HAS_TEXTURE_u_metallicRoughnessTexture",Po.MetallicRoughness),K(N,"HAS_TEXTURE_u_normalTexture",Po.Normal),K(j,"HAS_TEXTURE_u_occlusionTexture",Po.Occlusion),K(X,"HAS_TEXTURE_u_emissionTexture",Po.Emission),b&&(b.texture||(b.texture=new r.df(m.context,b.image,[b.image.height,b.image.height,b.image.height],E.gl.RGBA8)),E.activeTexture.set(E.gl.TEXTURE0+Po.LUT),b.texture&&b.texture.bind(E.gl.LINEAR,E.gl.CLAMP_TO_EDGE),p.push("APPLY_LUT_ON_GPU")),a.texcoordBuffer&&(p.push("HAS_ATTRIBUTE_a_uv_2f"),i.push(a.texcoordBuffer)),a.colorBuffer&&(p.push(a.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),i.push(a.colorBuffer)),a.normalBuffer&&(p.push("HAS_ATTRIBUTE_a_normal_3f"),i.push(a.normalBuffer)),a.pbrBuffer&&(p.push("HAS_ATTRIBUTE_a_pbr"),p.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),i.push(a.pbrBuffer)),w.alphaMode!=="OPAQUE"&&w.alphaMode!=="MASK"||p.push("UNPREMULT_TEXTURE_IN_SHADER"),w.defined||p.push("DIFFUSE_SHADED"),p.push("USE_STANDARD_DERIVATIVES")}function Oh(p,i,a,m,b,w){const E=a.paint.get("model-opacity"),R=i.context,z=new dt(i.context.gl.LEQUAL,dt.ReadWrite,i.depthRangeFor3D),N=i.transform,j=p.mesh,X=j.material,K=X.pbrMetallicRoughness,Q=i.style.fog;let he;he=i.transform.projection.zAxisUnit==="pixels"?[...p.nodeModelMatrix]:r.a6.mat4.multiply([],m.zScaleMatrix,p.nodeModelMatrix),r.a6.mat4.multiply(he,m.negCameraPosMatrix,he);const me=r.a6.mat4.invert([],he);r.a6.mat4.transpose(me,me);const _e=a.paint.get("model-emissive-strength").constantOr(0),ve=Pn(new Float32Array(p.worldViewProjection),new Float32Array(he),new Float32Array(me),null,i,E,K.baseColorFactor.toRenderColor(null),X.emissiveFactor,K.metallicFactor,K.roughnessFactor,X,_e,a),ke={defines:[]},De=[];Ef(ke.defines,De,j,i,a.lut);const Pe=i.shadowRenderer;Pe&&(Pe.useNormalOffset=!1);let Fe=null;if(Q){const $e=Tf(p.nodeModelMatrix,i.transform);if(Fe=new Float32Array($e),N.projection.name!=="globe"){const We=j.aabb.min,nt=j.aabb.max,[Ke,Ye]=Q.getOpacityForBounds($e,We[0],We[1],nt[0],nt[1]);ke.overrideFog=Ke>=xn||Ye>=xn}}const ze=Sl(i,a.paint.get("model-cutoff-fade-range"));ze.shouldRenderCutoff&&ke.defines.push("RENDER_CUTOFF");const qe=i.getOrCreateProgram("model",ke);i.uploadCommonUniforms(R,qe,null,Fe,ze),i.renderPass!=="shadow"&&Pe&&Pe.setupShadowsFromMatrix(p.nodeModelMatrix,qe),qe.draw(i,R.gl.TRIANGLES,z,b,w,j.material.doubleSided?Mn.disabled:Mn.backCCW,ve,a.id,j.vertexBuffer,j.indexBuffer,j.segments,a.paint,i.transform.zoom,void 0,De)}function Lh(p,i,a,m,b,w,E){let R;R=p.projection.name==="globe"?r.dg(a,p):[...a],r.a6.mat4.multiply(R,R,i.matrix);const z=r.a6.mat4.multiply([],m,R);if(i.meshes)for(const N of i.meshes){if(N.material.alphaMode!=="BLEND"){E.push({mesh:N,depth:0,modelIndex:b,worldViewProjection:z,nodeModelMatrix:R});continue}const j=r.a6.vec3.transformMat4([],N.centroid,z);j[2]>0&&w.push({mesh:N,depth:j[2],modelIndex:b,worldViewProjection:z,nodeModelMatrix:R})}if(i.children)for(const N of i.children)Lh(p,N,a,m,b,w,E)}function wu(p,i,a,m){const b=a.shadowRenderer;if(!b)return;const w=b.getShadowPassDepthMode(),E=b.getShadowPassColorMode(),R=b.calculateShadowPassMatrixFromMatrix(i),z=vm(R);a.getOrCreateProgram("modelDepth",{defines:a._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(a,a.context.gl.TRIANGLES,w,Kt.disabled,E,Mn.backCCW,z,m.id,p.vertexBuffer,p.indexBuffer,p.segments,m.paint,a.transform.zoom,void 0,void 0)}function yv(p,i,a){const m=i.updateZoomBasedPaintProperties(),b=function(w,E,R){let z,N,j,X=w.terrain?w.terrain.exaggeration():0;if(w.terrain&&X>0){const K=w.terrain,Q=K.findDEMTileFor(R);Q&&Q.dem?z=r.di.create(K,R,Q):X=0}if(X===0&&(E.terrainElevationMin=0,E.terrainElevationMax=0),X===E.validForExaggeration&&(X===0||z&&z._demTile&&z._demTile.tileID===E.validForDEMTile.id&&z._dem._timestamp===E.validForDEMTile.timestamp))return!1;for(const K in E.instancesPerModel){const Q=E.instancesPerModel[K];for(let he=0;he<Q.instancedDataArray.length;++he){const me=(z?X*z.getElevationAt(0|Q.instancedDataArray.float32[16*he],0|Q.instancedDataArray.float32[16*he+1],!0,!0):0)+Q.instancesEvaluatedElevation[he];Q.instancedDataArray.float32[16*he+6]=me,N=N?Math.min(E.terrainElevationMin,me):me,j=j?Math.max(E.terrainElevationMax,me):me}}return E.terrainElevationMin=N||0,E.terrainElevationMax=j||0,E.validForExaggeration=X,E.validForDEMTile=z&&z._demTile?{id:z._demTile.tileID,timestamp:z._dem._timestamp}:{id:void 0,timestamp:0},!0}(p,i,a);(m||b)&&(i.uploaded=!1,i.upload(p.context))}const qa={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.c9([0,0,0],[r.ab,r.ab,0])};function zb(p,i){const a=1<<p.canonical.z,m=i.getFreeCameraOptions().position,b=i.elevation,w=p.canonical.x/a,E=(p.canonical.x+1)/a,R=p.canonical.y/a,z=(p.canonical.y+1)/a;let N=i._centerAltitude;if(b){const Q=b.getMinMaxForTile(p);Q&&Q.max>N&&(N=Q.max)}const j=r.ap(m.x,w,E)-m.x,X=r.ap(m.y,R,z)-m.y,K=r.bD(N,i.center.lat)-m.z;return i._zoomFromMercatorZ(Math.sqrt(j*j+X*X+K*K))}function xs(p,i,a,m,b,w,E){const R=p.context,z=p.renderPass==="shadow",N=p.shadowRenderer,j=z&&N?N.getShadowPassDepthMode():new dt(R.gl.LEQUAL,dt.ReadWrite,p.depthRangeFor3D),X=p.isTileAffectedByFog(w);if(a.meshes)for(const K of a.meshes){const Q=["MODEL_POSITION_ON_GPU"],he=[];let me,_e,ve;m.instancedDataArray.length>20&&Q.push("INSTANCED_ARRAYS");const ke=Sl(p,i.paint.get("model-cutoff-fade-range"));if(ke.shouldRenderCutoff&&Q.push("RENDER_CUTOFF"),z&&N)me=p.getOrCreateProgram("modelDepth",{defines:Q}),_e=vm(E.shadowTileMatrix,E.shadowTileMatrix,Float32Array.from(a.matrix)),ve=N.getShadowPassColorMode();else{Ef(Q,he,K,p,i.lut),me=p.getOrCreateProgram("model",{defines:Q,overrideFog:X});const Pe=K.material,Fe=Pe.pbrMetallicRoughness,ze=i.paint.get("model-opacity"),qe=i.paint.get("model-emissive-strength").constantOr(0);_e=Pn(w.expandedProjMatrix,Float32Array.from(a.matrix),new Float32Array(16),null,p,ze,Fe.baseColorFactor.toRenderColor(null),Pe.emissiveFactor,Fe.metallicFactor,Fe.roughnessFactor,Pe,qe,i,b),N&&(E.shadowUniformsInitialized?me.setShadowUniformValues(R,N.getShadowUniformValues()):(N.setupShadows(w.toUnwrapped(),me,"model-tile",w.overscaledZ),E.shadowUniformsInitialized=!0)),ve=ke.shouldRenderCutoff||ze<1||Pe.alphaMode!=="OPAQUE"?Be.alphaBlended:Be.unblended}p.uploadCommonUniforms(R,me,w.toUnwrapped(),null,ke);const De=K.material.doubleSided?Mn.disabled:Mn.backCCW;if(m.instancedDataArray.length>20)he.push(m.instancedDataBuffer),me.draw(p,R.gl.TRIANGLES,j,Kt.disabled,ve,De,_e,i.id,K.vertexBuffer,K.indexBuffer,K.segments,i.paint,p.transform.zoom,void 0,he,m.instancedDataArray.length);else{const Pe=z?"u_instance":"u_normal_matrix";for(let Fe=0;Fe<m.instancedDataArray.length;++Fe)_e[Pe]=new Float32Array(m.instancedDataArray.arrayBuffer,64*Fe,16),me.draw(p,R.gl.TRIANGLES,j,Kt.disabled,ve,De,_e,i.id,K.vertexBuffer,K.indexBuffer,K.segments,i.paint,p.transform.zoom,void 0,he)}}if(a.children)for(const K of a.children)xs(p,i,K,m,b,w,E)}const Bb=[1,-1,1];function zh(p,i,a,m){if(!a.modelManager)return!0;const b=a.modelManager;if(!a.shadowRenderer)return!0;const w=a.shadowRenderer,E=i.aabb;let R=!0,z=p.maxHeight;if(z===0){let j=0;for(const X in p.instancesPerModel){const K=b.getModel(X,m);K?j=Math.max(j,Math.max(Math.max(K.aabb.max[0],K.aabb.max[1]),K.aabb.max[2])):R=!1}z=p.maxScale*j*1.41+p.maxVerticalOffset,R&&(p.maxHeight=z)}E.max[2]=z,E.min[2]+=p.terrainElevationMin,E.max[2]+=p.terrainElevationMax,r.a6.vec3.transformMat4(E.min,E.min,i.tileMatrix),r.a6.vec3.transformMat4(E.max,E.max,i.tileMatrix);const N=E.intersects(w.getCurrentCascadeFrustum());return a.currentShadowCascade===0&&(p.isInsideFirstShadowMapFrustum=N===2),N===0}function Cr(p,i){const a=p.uniformValues.u_cutoff_params[0],m=p.uniformValues.u_cutoff_params[1],b=p.uniformValues.u_cutoff_params[2],w=p.uniformValues.u_cutoff_params[3];return m===a||w===b?1:r.ap(((i-a)/(m-a)-b)/(w-b),0,1)}function Di(p,i,a,m){if(i.pitch<20)return 1;const b=i.getWorldToCameraMatrix();r.a6.mat4.multiply(b,b,p);const w=r.a6.vec4.fromValues(a.min[0],a.min[1],a.min[2],1);let E=r.a6.vec4.transformMat4(r.a6.vec4.create(),w,b),R=E,z=E;w[1]=a.max[1],E=r.a6.vec4.transformMat4(r.a6.vec4.create(),w,b),R=E[1]<R[1]?E:R,z=E[1]>z[1]?E:z,w[0]=a.max[0],E=r.a6.vec4.transformMat4(r.a6.vec4.create(),w,b),R=E[1]<R[1]?E:R,z=E[1]>z[1]?E:z,w[1]=a.min[1],E=r.a6.vec4.transformMat4(r.a6.vec4.create(),w,b),R=E[1]<R[1]?E:R,z=E[1]>z[1]?E:z;const N=r.ap(m[0],0,1),j=100*i.pixelsPerMeter*r.ap(m[1],0,1),X=r.ap(m[2],0,1),K=r.a6.vec4.lerp(r.a6.vec4.create(),R,z,N),Q=Math.tan(.5*i.fovX),he=-K[2]*Q;if(j===0)return K[1]<-Math.abs(he)?X:1;const me=(-Math.abs(he)-K[1])/j,_e=(ke,De,Pe)=>(1-Pe)*ke+Pe*De,ve=r.ap(_e(1,X,me),X,1);return _e(1,ve,r.ap((i.pitch-20)/20,0,1))}class bv{}class Jl{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(i,a,m){{const X=this._storage.get(a.id);if(X)return X.lastUsedFrameIdx=i,X.buf}const b=m.gl,w=b.getBufferParameter(b.ELEMENT_ARRAY_BUFFER,b.BUFFER_SIZE),E=new ArrayBuffer(w),R=new Int16Array(E);b.getBufferSubData(b.ELEMENT_ARRAY_BUFFER,0,new Int16Array(E));const z=new r.dk;for(let X=0;X<w/2;X+=3){const K=R[X],Q=R[X+1],he=R[X+2];z.emplaceBack(K,Q),z.emplaceBack(Q,he),z.emplaceBack(he,K)}const N=m.bindVertexArrayOES.current,j=new bv;return j.buf=new $s(m,z),j.lastUsedFrameIdx=i,this._storage.set(a.id,j),m.bindVertexArrayOES.set(N),j.buf}update(i){for(const[a,m]of this._storage)i-m.lastUsedFrameIdx>30&&(m.buf.destroy(),this._storage.delete(a))}destroy(){for(const[i,a]of this._storage)a.buf.destroy(),this._storage.delete(i)}}class If{constructor(i){this.occluderSize=30,this.depthOffset=-1e-4,i.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),i.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Ql={symbol:function(p,i,a,m,b){if(p.renderPass!=="translucent")return;const w=Kt.disabled,E=p.colorModeForRenderPass();a.layout.get("text-variable-anchor")&&function(N,j,X,K,Q,he,me){const _e=j.transform,ve=Q==="map",ke=he==="map";for(const De of N){const Pe=K.getTile(De),Fe=Pe.getBucket(X);if(!Fe||!Fe.text||!Fe.text.segments.get().length)continue;const ze=r.bj(Fe.textSizeData,_e.zoom),qe=Kr(De,Fe.getProjection(),_e),$e=_e.calculatePixelsToTileUnitsMatrix(Pe),We=fi(qe,Pe.tileID.canonical,ke,ve,_e,Fe.getProjection(),$e),nt=Fe.hasIconTextFit()&&Fe.hasIconData();if(ze){const Ke=Math.pow(2,_e.zoom-Pe.tileID.overscaledZ);Rb(Fe,ve,ke,me,r.cS,_e,We,De,Ke,ze,nt)}}}(m,p,a,i,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),b);const R=a.paint.get("icon-opacity").constantOr(1)!==0,z=a.paint.get("text-opacity").constantOr(1)!==0;a.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(R||z)?kh(p,i,a,m,w,E):(R&&kh(p,i,a,m,w,E,{onlyIcons:!0}),z&&kh(p,i,a,m,w,E,{onlyText:!0})),i.map.showCollisionBoxes&&(yf(p,i,a,m,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),yf(p,i,a,m,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(p,i,a,m){if(p.renderPass!=="translucent")return;const b=a.paint.get("circle-opacity"),w=a.paint.get("circle-stroke-width"),E=a.paint.get("circle-stroke-opacity"),R=a.layout.get("circle-sort-key").constantOr(1)!==void 0,z=a.paint.get("circle-emissive-strength");if(b.constantOr(1)===0&&(w.constantOr(1)===0||E.constantOr(1)===0))return;const N=p.context,j=N.gl,X=p.transform,K=p.depthModeForSublayer(0,dt.ReadOnly),Q=Kt.disabled,he=p.colorModeForDrapableLayerRenderPass(z),me=X.projection.name==="globe",_e=[r.am(X.center.lng),r.at(X.center.lat)],ve=[];for(let De=0;De<m.length;De++){const Pe=m[De],Fe=i.getTile(Pe),ze=Fe.getBucket(a);if(!ze||ze.projection.name!==X.projection.name)continue;const qe=ze.programConfigurations.get(a.id),$e=r.cT(a),We=p.isTileAffectedByFog(Pe);me&&$e.push("PROJECTION_GLOBE_VIEW"),$e.push("DEPTH_D24"),p.terrain&&X.depthOcclusionForSymbolsAndCircles&&$e.push("DEPTH_OCCLUSION");const nt=p.getOrCreateProgram("circle",{config:qe,defines:$e,overrideFog:We}),Ke=ze.layoutVertexBuffer,Ye=ze.globeExtVertexBuffer,ft=ze.indexBuffer,kt=X.projection.createInversionMatrix(X,Pe.canonical),jt={programConfiguration:qe,program:nt,layoutVertexBuffer:Ke,globeExtVertexBuffer:Ye,indexBuffer:ft,uniformValues:r.cU(p,Pe,Fe,kt,_e,a),tile:Fe};if(R){const Pt=ze.segments.get();for(const nn of Pt)ve.push({segments:new r.b1([nn]),sortKey:nn.sortKey,state:jt})}else ve.push({segments:ze.segments,sortKey:0,state:jt})}R&&ve.sort((De,Pe)=>De.sortKey-Pe.sortKey);const ke={useDepthForOcclusion:X.depthOcclusionForSymbolsAndCircles};for(const De of ve){const{programConfiguration:Pe,program:Fe,layoutVertexBuffer:ze,globeExtVertexBuffer:qe,indexBuffer:$e,uniformValues:We,tile:nt}=De.state,Ke=De.segments;p.terrain&&p.terrain.setupElevationDraw(nt,Fe,ke),p.uploadCommonUniforms(N,Fe,nt.tileID.toUnwrapped()),Fe.draw(p,j.TRIANGLES,K,Q,he,Mn.disabled,We,a.id,ze,$e,Ke,a.paint,X.zoom,Pe,[qe])}},heatmap:function(p,i,a,m){if(a.paint.get("heatmap-opacity")!==0)if(p.renderPass==="offscreen"){const b=p.context,w=b.gl,E=Kt.disabled,R=new Be([w.ONE,w.ONE,w.ONE,w.ONE],r.bz.transparent,[!0,!0,!0,!0]);(function(Q,he,me,_e){const ve=Q.gl,ke=he.width*_e,De=he.height*_e;Q.activeTexture.set(ve.TEXTURE1),Q.viewport.set([0,0,ke,De]);let Pe=me.heatmapFbo;if(!Pe||Pe&&(Pe.width!==ke||Pe.height!==De)){Pe&&Pe.destroy();const Fe=ve.createTexture();ve.bindTexture(ve.TEXTURE_2D,Fe),ve.texParameteri(ve.TEXTURE_2D,ve.TEXTURE_WRAP_S,ve.CLAMP_TO_EDGE),ve.texParameteri(ve.TEXTURE_2D,ve.TEXTURE_WRAP_T,ve.CLAMP_TO_EDGE),ve.texParameteri(ve.TEXTURE_2D,ve.TEXTURE_MIN_FILTER,ve.LINEAR),ve.texParameteri(ve.TEXTURE_2D,ve.TEXTURE_MAG_FILTER,ve.LINEAR),Pe=me.heatmapFbo=Q.createFramebuffer(ke,De,!0,null),function(ze,qe,$e,We,nt,Ke){const Ye=ze.gl;Ye.texImage2D(Ye.TEXTURE_2D,0,ze.extRenderToTextureHalfFloat?Ye.RGBA16F:Ye.RGBA,nt,Ke,0,Ye.RGBA,ze.extRenderToTextureHalfFloat?Ye.HALF_FLOAT:Ye.UNSIGNED_BYTE,null),We.colorAttachment.set($e)}(Q,0,Fe,Pe,ke,De)}else ve.bindTexture(ve.TEXTURE_2D,Pe.colorAttachment.get()),Q.bindFramebuffer.set(Pe.framebuffer)})(b,p,a,p.transform.projection.name==="globe"?.5:.25),b.clear({color:r.bz.transparent});const z=p.transform,N=z.projection.name==="globe",j=N?["PROJECTION_GLOBE_VIEW"]:[],X=N?Mn.frontCCW:Mn.disabled,K=[r.am(z.center.lng),r.at(z.center.lat)];for(let Q=0;Q<m.length;Q++){const he=m[Q];if(i.hasRenderableParent(he))continue;const me=i.getTile(he),_e=me.getBucket(a);if(!_e||_e.projection.name!==z.projection.name)continue;const ve=p.isTileAffectedByFog(he),ke=_e.programConfigurations.get(a.id),De=p.getOrCreateProgram("heatmap",{config:ke,defines:j,overrideFog:ve}),{zoom:Pe}=p.transform;p.terrain&&p.terrain.setupElevationDraw(me,De),p.uploadCommonUniforms(b,De,he.toUnwrapped());const Fe=z.projection.createInversionMatrix(z,he.canonical);De.draw(p,w.TRIANGLES,dt.disabled,E,R,X,Pb(p,he,me,Fe,K,Pe,a.paint.get("heatmap-intensity")),a.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,a.paint,p.transform.zoom,ke,N?[_e.globeExtVertexBuffer]:null)}b.viewport.set([0,0,p.width,p.height])}else p.renderPass==="translucent"&&(p.context.setColorMode(p.colorModeForRenderPass()),function(b,w){const E=b.context,R=E.gl,z=w.heatmapFbo;if(!z)return;E.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,z.colorAttachment.get()),E.activeTexture.set(R.TEXTURE1);let N=w.colorRampTexture;N||(N=w.colorRampTexture=new r.T(E,w.colorRamp,R.RGBA8)),N.bind(R.LINEAR,R.CLAMP_TO_EDGE),b.getOrCreateProgram("heatmapTexture").draw(b,R.TRIANGLES,dt.disabled,Kt.disabled,b.colorModeForRenderPass(),Mn.disabled,((j,X,K,Q)=>({u_image:0,u_color_ramp:1,u_opacity:X.paint.get("heatmap-opacity")}))(0,w),w.id,b.viewportBuffer,b.quadTriangleIndexBuffer,b.viewportSegments,w.paint,b.transform.zoom)}(p,a))},line:function(p,i,a,m){if(p.renderPass!=="translucent")return;const b=a.paint.get("line-opacity"),w=a.paint.get("line-width");if(b.constantOr(1)===0||w.constantOr(1)===0)return;const E=a.paint.get("line-emissive-strength"),R=a.paint.get("line-occlusion-opacity"),z=p.context,N=z.gl,j=a.layout.get("line-z-offset"),X=!j.isConstant()||!!j.constantOr(0),K=X?new dt(p.depthOcclusion?N.GREATER:N.LEQUAL,dt.ReadOnly,p.depthRangeFor3D):p.depthModeForSublayer(0,dt.ReadOnly),Q=p.colorModeForDrapableLayerRenderPass(E),he=p.terrain&&p.terrain.renderingToTexture,me=he?1:r.q.devicePixelRatio,_e=a.paint.get("line-dasharray"),ve=_e.constantOr(1),ke=a.layout.get("line-cap"),De=_e.constantOr(null),Pe=ke.constantOr(null),Fe=a.paint.get("line-pattern"),ze=Fe.constantOr(1),qe=Fe.constantOr(null),$e=a.paint.get("line-opacity").constantOr(1);let We=!ze&&$e!==1||p.depthOcclusion&&R>0&&R<1;const nt=a.paint.get("line-gradient"),Ke=ze?"linePattern":"line",Ye=r.cV(a);let ft;if(he&&p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(We=!1),R!==0&&p.depthOcclusion){const jt=a.paint._values["line-opacity"];jt&&jt.value&&jt.value.kind==="constant"?ft=jt.value:r.w(`Occlusion opacity for layer ${a.id} is supported only when line-opacity isn't data-driven.`)}if(X&&(p.forceTerrainMode=!0),!X&&R!==0&&p.terrain&&!he)return void r.w(`Occlusion opacity for layer ${a.id} is supported on terrain only if the layer has non-zero line-z-offset.`);const kt=We&&X?p.stencilModeFor3D():Kt.disabled;for(const jt of m){const Pt=i.getTile(jt);if(ze&&!Pt.patternsLoaded())continue;const nn=Pt.getBucket(a);if(!nn)continue;p.prepareDrawTile();const pt=nn.programConfigurations.get(a.id),Vt=p.isTileAffectedByFog(jt),zt=p.getOrCreateProgram(Ke,{config:pt,defines:X?[...Ye,"ELEVATED"]:Ye,overrideFog:Vt});if(qe&&Pt.imageAtlas){const pn=Pt.imageAtlas.patternPositions[qe.toString()];pn&&pt.setConstantPatternPositions(pn)}if(!ze&&De&&Pe&&Pt.lineAtlas){const pn=Pt.lineAtlas.getDash(De,Pe);pn&&pt.setConstantPatternPositions(pn)}let[sn,ln]=a.paint.get("line-trim-offset");(Pe==="round"||Pe==="square")&&sn!==ln&&(sn===0&&(sn-=1),ln===1&&(ln+=1));const Ut=he?jt.projMatrix:null,qt=ze?r.cW(p,Pt,a,Ut,me,[sn,ln]):r.cX(p,Pt,a,Ut,nn.lineClipsArray.length,me,[sn,ln]);if(nt){const pn=nn.gradients[a.id];let Cn=pn.texture;if(a.gradientVersion!==pn.version){let Yn=256;if(a.stepInterpolant){const Dn=i.getSource().maxzoom,qn=jt.canonical.z===Dn?Math.ceil(1<<p.transform.maxZoom-jt.canonical.z):1;Yn=r.ap(r.cY(nn.maxLineLength/r.ab*1024*qn),256,z.maxTextureSize)}pn.gradient=r.cZ({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:Yn,image:pn.gradient||void 0,clips:nn.lineClipsArray}),pn.texture?pn.texture.update(pn.gradient):pn.texture=new r.T(z,pn.gradient,N.RGBA8),pn.version=a.gradientVersion,Cn=pn.texture}z.activeTexture.set(N.TEXTURE1),Cn.bind(a.stepInterpolant?N.NEAREST:N.LINEAR,N.CLAMP_TO_EDGE)}ve&&(z.activeTexture.set(N.TEXTURE0),Pt.lineAtlasTexture&&Pt.lineAtlasTexture.bind(N.LINEAR,N.REPEAT),pt.updatePaintBuffers()),ze&&(z.activeTexture.set(N.TEXTURE0),Pt.imageAtlasTexture&&Pt.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),pt.updatePaintBuffers()),X&&p.terrain.setupElevationDraw(Pt,zt),p.uploadCommonUniforms(z,zt,jt.toUnwrapped());const Fn=pn=>{ft!=null&&(ft.value=$e*R),zt.draw(p,N.TRIANGLES,K,pn,Q,Mn.disabled,qt,a.id,nn.layoutVertexBuffer,nn.indexBuffer,nn.segments,a.paint,p.transform.zoom,pt,[nn.layoutVertexBuffer2,nn.patternVertexBuffer,nn.zOffsetVertexBuffer]),ft!=null&&(ft.value=$e)};if(We&&!X){const pn=p.stencilModeForClipping(jt).ref;pn===0&&he&&z.clear({stencil:0});const Cn={func:N.EQUAL,mask:255};qt.u_alpha_discard_threshold=.8,Fn(new Kt(Cn,pn,255,N.KEEP,N.KEEP,N.INVERT)),qt.u_alpha_discard_threshold=0,Fn(new Kt(Cn,pn,255,N.KEEP,N.KEEP,N.KEEP))}else We&&X&&(qt.u_alpha_discard_threshold=.001),Fn(X?kt:p.stencilModeForClipping(jt))}We&&(p.resetStencilClippingMasks(),he&&z.clear({stencil:0})),R===0||p.depthOcclusion||he||p.layersWithOcclusionOpacity.push(p.currentLayer),X&&(p.forceTerrainMode=!1)},fill:function(p,i,a,m){const b=a.paint.get("fill-color"),w=a.paint.get("fill-opacity"),E=a.is3D(),R=new dt(p.context.gl.LEQUAL,dt.ReadWrite,p.depthRangeFor3D);if(w.constantOr(1)===0)return;const z=a.paint.get("fill-emissive-strength"),N=p.colorModeForDrapableLayerRenderPass(z),j=a.paint.get("fill-pattern"),X=p.opaquePassEnabledForLayer()&&!j.constantOr(1)&&b.constantOr(r.bz.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(p.renderPass===X){const K=E?R:p.depthModeForSublayer(1,p.renderPass==="opaque"?dt.ReadWrite:dt.ReadOnly);bf(p,i,a,m,K,N,!1)}if(!E&&p.renderPass==="translucent"&&a.paint.get("fill-antialias")){const K=E?R:p.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,dt.ReadOnly);bf(p,i,a,m,K,N,!0)}},"fill-extrusion":function(p,i,a,m){const b=a.paint.get("fill-extrusion-opacity"),w=p.context,E=w.gl,R=p.terrain,z=R&&R.renderingToTexture;if(b===0)return;const N=p.conflationActive&&p.style.isLayerClipped(a,i.getSource()),j=p.style.order.indexOf(a.fqid);if(N&&function(X,K,Q,he,me){for(const _e of he){const ve=K.getTile(_e).getBucket(Q);ve&&(ve.updateReplacement(_e,X.replacementSource,me),ve.uploadCentroid(X.context))}}(p,i,a,m,j),R||N)for(const X of m){const K=i.getTile(X).getBucket(a);K&&Kl(p.context,i,X,K,a,R,N)}if(p.renderPass==="shadow"&&p.shadowRenderer){const X=p.shadowRenderer;if(R&&b<.65&&a._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.a4)return;const K=X.getShadowPassDepthMode(),Q=X.getShadowPassColorMode();vu(p,i,a,m,K,Kt.disabled,Q,N)}else if(p.renderPass==="translucent"){const X=!a.paint.get("fill-extrusion-pattern").constantOr(1),K=a.paint.get("fill-extrusion-color").constantOr(r.bz.white);if(!z&&K.a!==0){const Q=new dt(p.context.gl.LEQUAL,dt.ReadWrite,p.depthRangeFor3D);b===1&&X?vu(p,i,a,m,Q,Kt.disabled,Be.unblended,N):(vu(p,i,a,m,Q,Kt.disabled,Be.disabled,N),vu(p,i,a,m,Q,p.stencilModeFor3D(),p.colorModeForRenderPass(),N),p.resetStencilClippingMasks())}if(p.style.enable3dLights()&&X&&(!R&&p.transform.projection.name!=="globe"||z)){const Q=a.paint.get("fill-extrusion-opacity"),he=a.paint.get("fill-extrusion-ambient-occlusion-intensity"),me=a.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),_e=a.paint.get("fill-extrusion-flood-light-intensity"),ve=a.paint.get("fill-extrusion-flood-light-color").toRenderColor(a.lut).toArray01().slice(0,3),ke=he>0&&me>0,De=_e>0,Pe=(ze,qe,$e)=>(1-$e)*ze+$e*qe,Fe=ze=>{const qe=p.depthModeForSublayer(1,dt.ReadOnly,E.LEQUAL,!0),$e=a.paint.get(ze?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),We=Pe(.1,3,$e),nt=p._showOverdrawInspector;if(!nt){const Ke=new Kt({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),Ye=new Be([E.ONE,E.ONE,E.ONE,E.ONE],r.bz.transparent,[!1,!1,!1,!0],E.MIN);qo(p,i,a,m,qe,Ke,Ye,Mn.disabled,ze,"sdf",Q,he,me,_e,ve,We,N,!1)}{const Ke=nt?Kt.disabled:new Kt({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),Ye=nt?p.colorModeForRenderPass():new Be([E.ONE_MINUS_DST_ALPHA,E.DST_ALPHA,E.ONE,E.ONE],r.bz.transparent,[!0,!0,!0,!0]);qo(p,i,a,m,qe,Ke,Ye,Mn.disabled,ze,"color",Q,he,me,_e,ve,We,N,!1)}};if(z){const ze=(qe,$e,We)=>{const nt=p.depthModeForSublayer(1,dt.ReadOnly,E.LEQUAL,!1),Ke=a.paint.get(qe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ye=Pe(.1,3,Ke);{const ft=new Be([E.ONE,E.ONE,E.ONE,E.ONE],r.bz.transparent,[!1,!1,!1,!0]);qo(p,i,a,m,nt,Kt.disabled,ft,Mn.disabled,qe,"clear",Q,he,me,_e,ve,Ye,N,$e)}{const ft=new Kt({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),kt=new Be([E.ONE,E.ONE,E.ONE,E.ONE],r.bz.transparent,[!1,!1,!1,!0],E.MIN);qo(p,i,a,m,nt,ft,kt,Mn.disabled,qe,"sdf",Q,he,me,_e,ve,Ye,N,$e)}{const ft=qe?E.ZERO:E.ONE_MINUS_DST_ALPHA,kt=new Kt({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),jt=new Be([ft,E.DST_ALPHA,E.ONE_MINUS_DST_ALPHA,E.ZERO],r.bz.transparent,[!0,!0,!0,!0]);qo(p,i,a,m,nt,kt,jt,Mn.disabled,qe,"color",Q,he,me,_e,ve,Ye,N,$e)}{const ft=new Be([E.ONE,E.ONE,E.ONE,qe?E.ZERO:E.ONE],r.bz.transparent,[!1,!1,!1,!0],qe?E.FUNC_ADD:E.MAX);qo(p,i,a,m,nt,Kt.disabled,ft,Mn.disabled,qe,"clear",Q,he,me,_e,ve,Ye,N,$e,We)}};if(ke||De){let qe;if(p.prepareDrawTile(),R){const $e=R.drapeBufferSize[0],We=R.drapeBufferSize[1];qe=R.framebufferCopyTexture,qe&&(!qe||qe.size[0]===$e&&qe.size[1]===We)||(qe&&qe.destroy(),qe=R.framebufferCopyTexture=new r.T(w,new r.r({width:$e,height:We}),E.RGBA8)),qe.bind(E.LINEAR,E.CLAMP_TO_EDGE),E.copyTexImage2D(E.TEXTURE_2D,0,E.RGBA,0,0,$e,We,0)}ke&&ze(!0,!1,qe),De&&ze(!1,!0,qe)}}else ke&&Fe(!0),De&&Fe(!1),(ke||De)&&p.resetStencilClippingMasks()}}},hillshade:function(p,i,a,m){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent"||p.style.disableElevatedTerrain)return;const b=p.context,w=p.terrain&&p.terrain.renderingToTexture,[E,R]=p.renderPass!=="translucent"||w?[{},m]:p.stencilConfigForOverlap(m);for(const z of R){const N=i.getTile(z);if(N.needsHillshadePrepare&&p.renderPass==="offscreen")wh(p,N,a);else if(p.renderPass==="translucent"){const j=p.depthModeForSublayer(0,dt.ReadOnly),X=a.paint.get("hillshade-emissive-strength"),K=p.colorModeForDrapableLayerRenderPass(X),Q=w&&p.terrain?p.terrain.stencilModeForRTTOverlap(z):E[z.overscaledZ];tf(p,z,N,a,j,Q,K)}}b.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,i,a,m,b,w){if(p.renderPass!=="translucent"||a.paint.get("raster-opacity")===0)return;const E=p.transform.projection.name==="globe",R=a.paint.get("raster-elevation")!==0,z=R&&E;if(p.renderElevatedRasterBackface&&!z)return;const N=p.context,j=N.gl,X=i.getSource(),K=function(ze,qe,$e,We){const nt=qe.paint.get("raster-color"),Ke=ze.type==="raster-array",Ye=[],ft=qe.paint.get("raster-resampling"),kt=qe.paint.get("raster-color-mix");let jt=qe.paint.get("raster-color-range");const Pt=[kt[0],kt[1],kt[2],0],nn=kt[3];let pt=ft==="nearest"?We.NEAREST:We.LINEAR;if(Ke&&(Ye.push("RASTER_ARRAY"),nt||Ye.push("RASTER_COLOR"),ft==="linear"&&Ye.push("RASTER_ARRAY_LINEAR"),pt=We.NEAREST,!jt&&ze.rasterLayers)){const Vt=ze.rasterLayers.find(({id:zt})=>zt===qe.sourceLayer);Vt&&Vt.fields&&Vt.fields.range&&(jt=Vt.fields.range)}if(jt=jt||[0,1],nt){Ye.push("RASTER_COLOR"),$e.activeTexture.set(We.TEXTURE2),qe.updateColorRamp(jt);let Vt=qe.colorRampTexture;Vt||(Vt=qe.colorRampTexture=new r.T($e,qe.colorRamp,We.RGBA8)),Vt.bind(We.LINEAR,We.CLAMP_TO_EDGE)}return{mix:Pt,range:jt,offset:nn,defines:Ye,resampling:pt}}(X,a,N,j);if(X instanceof r.aD&&!m.length&&!E)return;const Q=a.paint.get("raster-emissive-strength"),he=p.colorModeForDrapableLayerRenderPass(Q),me=p.terrain&&p.terrain.renderingToTexture,_e=!p.options.moving,ve=a.paint.get("raster-resampling")==="nearest"?j.NEAREST:j.LINEAR;if(X instanceof r.aD&&!m.length&&(X.onNorthPole||X.onSouthPole)){const ze=R?p.stencilModeFor3D():Kt.disabled;return void Gs(!!X.onNorthPole,null,p,i,a,Q,K,Mn.disabled,ze)}if(!m.length)return;const[ke,De]=X instanceof r.aD||me?[{},m]:p.stencilConfigForOverlap(m),Pe=De[De.length-1].overscaledZ;z&&K.defines.push("PROJECTION_GLOBE_VIEW"),R&&K.defines.push("RENDER_CUTOFF");const Fe=(ze,qe,$e)=>{for(const We of ze){const nt=We.toUnwrapped(),Ke=i.getTile(We);if(me&&(!Ke||!Ke.hasData()))continue;N.activeTexture.set(j.TEXTURE0);const Ye=xf(Ke,X,a,K);if(!Ye||!Ye.texture)continue;const{texture:ft,mix:kt,offset:jt,tileSize:Pt,buffer:nn}=Ye;let pt,Vt;me?(pt=dt.disabled,Vt=We.projMatrix):R?(pt=new dt(j.LEQUAL,dt.ReadWrite,p.depthRangeFor3D),Vt=E?Float32Array.from(p.transform.expandedFarZProjMatrix):p.transform.calculateProjMatrix(nt,_e)):(pt=p.depthModeForSublayer(We.overscaledZ-Pe,a.paint.get("raster-opacity")===1?dt.ReadWrite:dt.ReadOnly,j.LESS),Vt=p.transform.calculateProjMatrix(nt,_e));const zt=p.terrain&&me?p.terrain.stencilModeForRTTOverlap(We):ke[We.overscaledZ],sn=w?0:a.paint.get("raster-fade-duration");Ke.registerFadeDuration(sn);const ln=i.findLoadedParent(We,0),Ut=cf(Ke,ln,i,p.transform,sn);let qt,Fn;p.terrain&&p.terrain.prepareDrawTile(),N.activeTexture.set(j.TEXTURE0),ft.bind(ve,j.CLAMP_TO_EDGE),N.activeTexture.set(j.TEXTURE1),ln?(ln.texture&&ln.texture.bind(ve,j.CLAMP_TO_EDGE),qt=Math.pow(2,ln.tileID.overscaledZ-Ke.tileID.overscaledZ),Fn=[Ke.tileID.canonical.x*qt%1,Ke.tileID.canonical.y*qt%1]):ft.bind(ve,j.CLAMP_TO_EDGE),ft.useMipmap&&N.extTextureFilterAnisotropic&&p.transform.pitch>20&&j.texParameterf(j.TEXTURE_2D,N.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,N.extTextureFilterAnisotropicMax);const pn=p.transform;let Cn;const Yn=R?qr(pn):[0,0,0,0];let Dn,qn,di,ai,Hi,nr=0;if(z&&X instanceof r.aD&&X.coordinates.length>3)Dn=Float32Array.from(r.b5(r.cC(new r.bP(0,0,0)))),qn=Float32Array.from(pn.globeMatrix),di=Float32Array.from(r.cy(pn)),ai=[r.am(pn.center.lng),r.at(pn.center.lat)],Cn=X.elevatedGlobePerspectiveTransform,Hi=X.elevatedGlobeGridMatrix||new Float32Array(9);else if(z){const vi=r.cz(We.canonical);nr=r.cA(vi.getCenter().lat),Dn=Float32Array.from(r.b5(r.cC(We.canonical))),qn=Float32Array.from(pn.globeMatrix),di=Float32Array.from(r.cy(pn)),ai=[r.am(pn.center.lng),r.at(pn.center.lat)],Cn=[0,0],Hi=Float32Array.from(r.cB(We.canonical,vi,nr,pn.worldSize/pn._pixelsPerMercatorPixel))}else Cn=X instanceof r.aD?X.perspectiveTransform:[0,0],Dn=new Float32Array(16),qn=new Float32Array(9),di=new Float32Array(16),ai=[0,0],Hi=new Float32Array(9);const gr=Ph(Vt,Dn,qn,di,Hi,Fn||[0,0],r.a9(p.transform.zoom),ai,Yn,qt||1,Ut,a,Cn,R?a.paint.get("raster-elevation"):0,2,kt,jt,K.range,Pt,nn,Q),Ia=p.isTileAffectedByFog(We),ro=p.getOrCreateProgram("raster",{defines:K.defines,overrideFog:Ia});if(p.uploadCommonUniforms(N,ro,nt),X instanceof r.aD){const vi=X.elevatedGlobeVertexBuffer,Yi=X.elevatedGlobeIndexBuffer;if(me||!E)X.boundsBuffer&&X.boundsSegments&&ro.draw(p,j.TRIANGLES,pt,Kt.disabled,he,Mn.disabled,gr,a.id,X.boundsBuffer,p.quadTriangleIndexBuffer,X.boundsSegments);else if(vi&&Yi){const Lr=pn.zoom<=r.c2?X.elevatedGlobeSegments:X.getSegmentsForLongitude(pn.center.lng);Lr&&ro.draw(p,j.TRIANGLES,pt,Kt.disabled,he,qe,gr,a.id,vi,Yi,Lr)}}else if(z){pt=new dt(j.LEQUAL,dt.ReadOnly,p.depthRangeFor3D);const vi=p.globeSharedBuffers;if(vi){const[Yi,Lr,Zi]=vi.getGridBuffers(nr,!1);ro.draw(p,j.TRIANGLES,pt,$e||zt,p.colorModeForRenderPass(),qe,gr,a.id,Yi,Lr,Zi)}}else{const{tileBoundsBuffer:vi,tileBoundsIndexBuffer:Yi,tileBoundsSegments:Lr}=p.getTileBoundsBuffers(Ke);ro.draw(p,j.TRIANGLES,pt,zt,he,Mn.disabled,gr,a.id,vi,Yi,Lr)}}if(!(X instanceof r.aD)&&z)for(const We of ze){const nt=We.canonical.y===(1<<We.canonical.z)-1;We.canonical.y===0&&Gs(!0,We,p,i,a,Q,K,qe,$e||Kt.disabled),nt&&Gs(!1,We,p,i,a,Q,K,qe===Mn.frontCW?Mn.backCW:Mn.frontCW,$e||Kt.disabled)}};z?Fe(De,p.renderElevatedRasterBackface?Mn.backCW:Mn.frontCW,p.stencilModeFor3D()):Fe(De,Mn.disabled,void 0),p.resetStencilClippingMasks()},"raster-particle":function(p,i,a,m,b,w){p.renderPass==="offscreen"&&function(E,R,z,N){if(!N.length)return;const j=E.context,X=j.gl,K=R.getSource();if(!(K instanceof ea))return;const Q=Math.ceil(Math.sqrt(z.paint.get("raster-particle-count")));let he=z.particlePositionRGBAImage;if(!he||he.width!==Q){const De=function(Pe){const Fe=Pe*Pe,ze=new Uint8Array(4*Fe),qe=function(We){return We|=0,We=Math.imul(2747636419^We,2654435769),We=Math.imul(We^We>>>16,2654435769),((We=Math.imul(We^We>>>16,2654435769))>>>0)/4294967296},$e=1/1.1;for(let We=0;We<Fe;We++){const nt=$e*(qe(2*We+0)+il),Ke=$e*(qe(2*We+1)+il),Ye=255*nt%1,ft=255*Ke%1,kt=Ye,jt=Ke-ft/255,Pt=ft;ze[4*We+0]=255*(nt-Ye/255),ze[4*We+1]=255*kt,ze[4*We+2]=255*jt,ze[4*We+3]=255*Pt}return ze}(Q);he=z.particlePositionRGBAImage=new r.r({width:Q,height:Q},De)}let me=z.particleFramebuffer;me?me.width!==Q&&(me.destroy(),me=z.particleFramebuffer=j.createFramebuffer(Q,Q,!0,null)):me=z.particleFramebuffer=j.createFramebuffer(Q,Q,!0,null);const _e=[];for(const De of N){const Pe=R.getTile(De);if(!(Pe instanceof sr))continue;const Fe=gv(Pe,K,z);if(!Fe)continue;const ze=[Pe.tileSize,Pe.tileSize];let qe=z.tileFramebuffer;qe||(qe=z.tileFramebuffer=j.createFramebuffer(ze[0],ze[1],!0,null));let $e=Pe.rasterParticleState;$e||($e=Pe.rasterParticleState=new mv(j,De,ze,he));const We=$e.update(z.lastInvalidatedAt);$e.particleTextureDimension!==Q&&$e.updateParticleTexture(De,he);const nt=$e.targetColorTexture;$e.targetColorTexture=$e.backgroundColorTexture,$e.backgroundColorTexture=nt;const Ke=$e.particleTexture0;$e.particleTexture0=$e.particleTexture1,$e.particleTexture1=Ke,_e.push([De,Fe,$e,We])}if(_e.length===0)return;const ve=r.q.now(),ke=z.previousDrawTimestamp?.001*(ve-z.previousDrawTimestamp):.0167;if(z.previousDrawTimestamp=ve,z.hasColorMap()){j.activeTexture.set(X.TEXTURE0+2);let De=z.colorRampTexture;De||(De=z.colorRampTexture=new r.T(j,z.colorRamp,X.RGBA8)),De.bind(X.LINEAR,X.CLAMP_TO_EDGE)}j.bindFramebuffer.set(z.tileFramebuffer.framebuffer),function(De,Pe,Fe){const ze=De.context,qe=ze.gl,$e=Pe.tileFramebuffer;ze.activeTexture.set(qe.TEXTURE0);const We={u_texture:0,u_opacity:1.05*(Ke=Pe.paint.get("raster-particle-fade-opacity-factor"))/(Ke+.05)},nt=De.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Ke;for(const Ye of Fe){const[,,ft,kt]=Ye;$e.colorAttachment.set(ft.targetColorTexture.texture),ze.viewport.set([0,0,$e.width,$e.height]),ze.clear({color:r.bz.transparent}),kt&&(ft.backgroundColorTexture.bind(qe.NEAREST,qe.CLAMP_TO_EDGE),nt.draw(De,qe.TRIANGLES,dt.disabled,Kt.disabled,Be.alphaBlended,Mn.disabled,We,Pe.id,De.viewportBuffer,De.quadTriangleIndexBuffer,De.viewportSegments))}}(E,z,_e),function(De,Pe,Fe,ze){const qe=De.context,$e=qe.gl,We=Fe.tileFramebuffer,nt=De.transform.projection.name==="globe",Ke=Fe.paint.get("raster-particle-max-speed");for(const Ye of ze){const[ft,kt,jt]=Ye;qe.activeTexture.set($e.TEXTURE0+0),kt.texture.bind($e.LINEAR,$e.CLAMP_TO_EDGE),We.colorAttachment.set(jt.targetColorTexture.texture);const Pt=De.getOrCreateProgram("rasterParticleDraw",{defines:kt.defines,overrideFog:!1});qe.activeTexture.set($e.TEXTURE0+1);const nn=kt.scalarData?[]:[0,1,2,3].map(zt=>r.c$[zt](ft));nn.push(ft);const pt=ft.canonical.x,Vt=ft.canonical.y;for(const zt of nn){const sn=Pe.getTile(nt?zt.wrapped():zt);if(!sn)continue;const ln=sn.rasterParticleState;if(!ln)continue;const Ut=zt.canonical.x+(1<<zt.canonical.z)*(zt.wrap-ft.wrap),qt=zt.canonical.y;ln.particleTexture0.bind($e.NEAREST,$e.CLAMP_TO_EDGE);const Fn=pf(1,ln.particleTexture0.size[0],[Ut-pt,qt-Vt],0,kt.texture.size,2,Ke,kt.textureOffset,kt.scale,kt.offset);Pt.draw(De,$e.POINTS,dt.disabled,Kt.disabled,Be.alphaBlended,Mn.disabled,Fn,Fe.id,ln.particleIndexBuffer,void 0,ln.particleSegment)}}}(E,R,z,_e),j.bindFramebuffer.set(z.particleFramebuffer.framebuffer),function(De,Pe,Fe,ze){const qe=De.context,$e=qe.gl,We=Pe.paint.get("raster-particle-max-speed"),nt=ze*Pe.paint.get("raster-particle-speed-factor")*.15,Ke=function(ft){return Math.pow(ft,6)}(.01+1*Pe.paint.get("raster-particle-reset-rate-factor")),Ye=Pe.particleFramebuffer;qe.viewport.set([0,0,Ye.width,Ye.height]);for(const ft of Fe){const[,kt,jt]=ft;qe.activeTexture.set($e.TEXTURE0+0),kt.texture.bind($e.LINEAR,$e.CLAMP_TO_EDGE),qe.activeTexture.set($e.TEXTURE0+1);const Pt=jt.particleTexture0;Pt.bind($e.NEAREST,$e.CLAMP_TO_EDGE);const nn=mf(1,Pt.size[0],0,kt.texture.size,We,nt,Ke,kt.textureOffset,kt.scale,kt.offset);Ye.colorAttachment.set(jt.particleTexture1.texture),qe.clear({color:r.bz.transparent}),De.getOrCreateProgram("rasterParticleUpdate",{defines:kt.defines}).draw(De,$e.TRIANGLES,dt.disabled,Kt.disabled,Be.unblended,Mn.disabled,nn,Pe.id,De.viewportBuffer,De.quadTriangleIndexBuffer,De.viewportSegments)}}(E,z,_e,ke)}(p,i,a,m),p.renderPass==="translucent"&&(function(E,R,z,N,j){const X=E.context,K=X.gl,Q=R.getSource().tileSize,he=5*(1-r.a7(r.bU,r.bU+1,E.transform.zoom))*Q+z.paint.get("raster-particle-elevation"),me=!E.options.moving,_e=E.transform.projection.name==="globe";if(!N.length)return;const[ve,ke]=E.stencilConfigForOverlap(N),De=[];_e&&De.push("PROJECTION_GLOBE_VIEW");const Pe=E.stencilModeFor3D();for(const Fe of ke){const ze=Fe.toUnwrapped(),qe=R.getTile(Fe);if(!qe.rasterParticleState)continue;const $e=qe.rasterParticleState,We=100;qe.registerFadeDuration(We);const nt=R.findLoadedParent(Fe,0),Ke=cf(qe,nt,R,E.transform,We);let Ye,ft;E.terrain&&E.terrain.prepareDrawTile(),X.activeTexture.set(K.TEXTURE0),$e.targetColorTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),X.activeTexture.set(K.TEXTURE1),nt&&nt.rasterParticleState?(nt.rasterParticleState.targetColorTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),Ye=Math.pow(2,nt.tileID.overscaledZ-qe.tileID.overscaledZ),ft=[qe.tileID.canonical.x*Ye%1,qe.tileID.canonical.y*Ye%1]):$e.targetColorTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE);const kt=_e?Float32Array.from(E.transform.expandedFarZProjMatrix):E.transform.calculateProjMatrix(ze,me),jt=E.transform,Pt=_v(jt),nn=r.cz(Fe.canonical),pt=r.cA(nn.getCenter().lat);let Vt,zt,sn,ln,Ut;_e?(Vt=Float32Array.from(r.b5(r.cC(Fe.canonical))),zt=Float32Array.from(jt.globeMatrix),sn=Float32Array.from(r.cy(jt)),ln=[r.am(jt.center.lng),r.at(jt.center.lat)],Ut=Float32Array.from(r.cB(Fe.canonical,nn,pt,jt.worldSize/jt._pixelsPerMercatorPixel))):(Vt=new Float32Array(16),zt=new Float32Array(9),sn=new Float32Array(16),ln=[0,0],Ut=new Float32Array(9));const qt=hv(kt,Vt,zt,sn,Ut,ft||[0,0],r.a9(E.transform.zoom),ln,Pt,Ye||1,Ke,he),Fn=E.isTileAffectedByFog(Fe),pn=E.getOrCreateProgram("rasterParticle",{defines:De,overrideFog:Fn});if(E.uploadCommonUniforms(X,pn,ze),_e){const Cn=new dt(K.LEQUAL,dt.ReadOnly,E.depthRangeFor3D),Yn=0,Dn=E.globeSharedBuffers;if(Dn){const[qn,di,ai]=Dn.getGridBuffers(pt,Yn!==0);pn.draw(E,K.TRIANGLES,Cn,Pe,Be.alphaBlended,E.renderElevatedRasterBackface?Mn.frontCCW:Mn.backCCW,qt,z.id,qn,di,ai)}}else{const Cn=E.depthModeForSublayer(0,dt.ReadOnly),Yn=ve[Fe.overscaledZ],{tileBoundsBuffer:Dn,tileBoundsIndexBuffer:qn,tileBoundsSegments:di}=E.getTileBoundsBuffers(qe);pn.draw(E,K.TRIANGLES,Cn,Yn,Be.alphaBlended,Mn.disabled,qt,z.id,Dn,qn,di)}}E.resetStencilClippingMasks()}(p,i,a,m),p.style.map.triggerRepaint())},background:function(p,i,a,m){const b=a.paint.get("background-color"),w=a.paint.get("background-opacity"),E=a.paint.get("background-emissive-strength"),R=a.paint.get("background-pitch-alignment")==="viewport";if(w===0)return;const z=p.context,N=z.gl,j=p.transform,X=j.tileSize,K=a.paint.get("background-pattern");let Q;if(K!==void 0&&(K===null||(Q=p.imageManager.getPattern(K.toString(),a.scope,p.style.getLut(a.scope)),!Q)))return;const he=!K&&b.a===1&&w===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==he)return;const me=Kt.disabled,_e=p.depthModeForSublayer(0,he==="opaque"?dt.ReadWrite:dt.ReadOnly),ve=p.colorModeForDrapableLayerRenderPass(E),ke=K?"backgroundPattern":"background";let De,Pe=m;if(Pe||(De=p.getBackgroundTiles(),Pe=Object.values(De).map(Fe=>Fe.tileID)),K&&(z.activeTexture.set(N.TEXTURE0),p.imageManager.bind(p.context,a.scope)),R){const Fe=p.getOrCreateProgram(ke,{overrideFog:!1,overrideRtt:!0}),ze=new Float32Array(r.a6.mat4.identity([])),qe=new r.aA(0,0,0,0,0),$e=K?Ac(ze,E,w,p,0,a.scope,Q,R,{tileID:qe,tileSize:X}):dv(ze,E,w,b.toRenderColor(a.lut));Fe.draw(p,N.TRIANGLES,_e,me,ve,Mn.disabled,$e,a.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments)}else for(const Fe of Pe){const ze=p.isTileAffectedByFog(Fe),qe=p.getOrCreateProgram(ke,{overrideFog:ze}),$e=Fe.toUnwrapped(),We=m?Fe.projMatrix:p.transform.calculateProjMatrix($e);p.prepareDrawTile();const nt=i?i.getTile(Fe):De?De[Fe.key]:new cs(Fe,X,j.zoom,p),Ke=K?Ac(We,E,w,p,0,a.scope,Q,R,{tileID:Fe,tileSize:X}):dv(We,E,w,b.toRenderColor(a.lut));p.uploadCommonUniforms(z,qe,$e);const{tileBoundsBuffer:Ye,tileBoundsIndexBuffer:ft,tileBoundsSegments:kt}=p.getTileBoundsBuffers(nt);qe.draw(p,N.TRIANGLES,_e,me,ve,Mn.disabled,Ke,a.id,Ye,ft,kt)}},sky:function(p,i,a){const m=p._atmosphere?r.a9(p.transform.zoom):1,b=a.paint.get("sky-opacity")*m;if(b===0)return;const w=p.context,E=a.paint.get("sky-type"),R=new dt(w.gl.LEQUAL,dt.ReadOnly,[0,1]),z=p.frameCounter/1e3%1;E==="atmosphere"?p.renderPass==="offscreen"?a.needsSkyboxCapture(p)&&(function(N,j,X,K){const Q=N.context,he=Q.gl;let me=j.skyboxFbo;if(!me){me=j.skyboxFbo=Q.createFramebuffer(32,32,!0,null),j.skyboxGeometry=new Im(Q),j.skyboxTexture=Q.gl.createTexture(),he.bindTexture(he.TEXTURE_CUBE_MAP,j.skyboxTexture),he.texParameteri(he.TEXTURE_CUBE_MAP,he.TEXTURE_WRAP_S,he.CLAMP_TO_EDGE),he.texParameteri(he.TEXTURE_CUBE_MAP,he.TEXTURE_WRAP_T,he.CLAMP_TO_EDGE),he.texParameteri(he.TEXTURE_CUBE_MAP,he.TEXTURE_MIN_FILTER,he.LINEAR),he.texParameteri(he.TEXTURE_CUBE_MAP,he.TEXTURE_MAG_FILTER,he.LINEAR);for(let De=0;De<6;++De)he.texImage2D(he.TEXTURE_CUBE_MAP_POSITIVE_X+De,0,he.RGBA,32,32,0,he.RGBA,he.UNSIGNED_BYTE,null)}Q.bindFramebuffer.set(me.framebuffer),Q.viewport.set([0,0,32,32]);const _e=j.getCenter(N,!0),ve=N.getOrCreateProgram("skyboxCapture"),ke=new Float64Array(16);r.a6.mat4.identity(ke),r.a6.mat4.rotateY(ke,ke,.5*-Math.PI),Mc(N,j,ve,ke,_e,0),r.a6.mat4.identity(ke),r.a6.mat4.rotateY(ke,ke,.5*Math.PI),Mc(N,j,ve,ke,_e,1),r.a6.mat4.identity(ke),r.a6.mat4.rotateX(ke,ke,.5*-Math.PI),Mc(N,j,ve,ke,_e,2),r.a6.mat4.identity(ke),r.a6.mat4.rotateX(ke,ke,.5*Math.PI),Mc(N,j,ve,ke,_e,3),r.a6.mat4.identity(ke),Mc(N,j,ve,ke,_e,4),r.a6.mat4.identity(ke),r.a6.mat4.rotateY(ke,ke,Math.PI),Mc(N,j,ve,ke,_e,5),Q.viewport.set([0,0,N.width,N.height])}(p,a),a.markSkyboxValid(p)):p.renderPass==="sky"&&function(N,j,X,K,Q){const he=N.context,me=he.gl,_e=N.transform,ve=N.getOrCreateProgram("skybox");he.activeTexture.set(me.TEXTURE0),me.bindTexture(me.TEXTURE_CUBE_MAP,j.skyboxTexture);const ke=((De,Pe,Fe,ze,qe)=>({u_matrix:De,u_sun_direction:Pe,u_cubemap:0,u_opacity:ze,u_temporal_offset:qe}))(_e.skyboxMatrix,j.getCenter(N,!1),0,K,Q);N.uploadCommonUniforms(he,ve),ve.draw(N,me.TRIANGLES,X,Kt.disabled,N.colorModeForRenderPass(),Mn.backCW,ke,"skybox",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(p,a,R,b,z):E==="gradient"&&p.renderPass==="sky"&&function(N,j,X,K,Q){const he=N.context,me=he.gl,_e=N.transform,ve=N.getOrCreateProgram("skyboxGradient");j.skyboxGeometry||(j.skyboxGeometry=new Im(he)),he.activeTexture.set(me.TEXTURE0);let ke=j.colorRampTexture;ke||(ke=j.colorRampTexture=new r.T(he,j.colorRamp,me.RGBA8)),ke.bind(me.LINEAR,me.CLAMP_TO_EDGE);const De=((Pe,Fe,ze,qe,$e)=>({u_matrix:Pe,u_color_ramp:0,u_center_direction:Fe,u_radius:r.bB(ze),u_opacity:qe,u_temporal_offset:$e}))(_e.skyboxMatrix,j.getCenter(N,!1),j.paint.get("sky-gradient-radius"),K,Q);N.uploadCommonUniforms(he,ve),ve.draw(N,me.TRIANGLES,X,Kt.disabled,N.colorModeForRenderPass(),Mn.backCW,De,"skyboxGradient",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(p,a,R,b,z)},debug:function(p,i,a,m,b,w){for(let E=0;E<a.length;E++)if(b){const N=new r.bz(m.r*.8,m.g*.8,m.b*.8,1);Ga(p,i,a[E],m,-1,-1,w),Ga(p,i,a[E],m,-1,1,w),Ga(p,i,a[E],m,1,1,w),Ga(p,i,a[E],m,1,-1,w),Ga(p,i,a[E],N,0,0,w)}else Ga(p,i,a[E],m,0,0,w)},custom:function(p,i,a,m){const b=p.context,w=a.implementation;if(!p.transform.projection.unsupportedLayers||!p.transform.projection.unsupportedLayers.includes("custom")||p.terrain&&(p.terrain.renderingToTexture||p.renderPass==="offscreen")&&a.isDraped(i)){if(p.renderPass==="offscreen"){const E=w.prerender;if(E){if(p.setCustomLayerDefaults(),b.setColorMode(p.colorModeForRenderPass()),p.transform.projection.name==="globe"){const R=p.transform.pointMerc;E.call(w,b.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),r.a9(p.transform.zoom),[R.x,R.y],p.transform.pixelsPerMeterRatio)}else E.call(w,b.gl,p.transform.customLayerMatrix());b.setDirty(),p.setBaseState()}}else if(p.renderPass==="translucent"){if(p.terrain&&p.terrain.renderingToTexture){const R=w.renderToTile;if(R){const z=m[0].canonical,N=new r.a5(z.x+m[0].wrap*(1<<z.z),z.y,z.z);b.setDepthMode(dt.disabled),b.setStencilMode(Kt.disabled),b.setColorMode(p.colorModeForRenderPass()),p.setCustomLayerDefaults(),R.call(w,b.gl,N),b.setDirty(),p.setBaseState()}return}p.setCustomLayerDefaults(),b.setColorMode(p.colorModeForRenderPass()),b.setStencilMode(Kt.disabled);const E=w.renderingMode==="3d"?new dt(p.context.gl.LEQUAL,dt.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,dt.ReadOnly);if(b.setDepthMode(E),p.transform.projection.name==="globe"){const R=p.transform.pointMerc;w.render(b.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),r.a9(p.transform.zoom),[R.x,R.y],p.transform.pixelsPerMeterRatio)}else w.render(b.gl,p.transform.customLayerMatrix());b.setDirty(),p.setBaseState(),b.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(p,i,a,m){if(p.renderPass==="opaque")return;const b=a.paint.get("model-opacity");if(b===0)return;const w=a.paint.get("model-cast-shadows");if(p.renderPass==="shadow"&&(!w||p.terrain&&b<.65&&a._transitionablePaint._values["model-opacity"].value.expression instanceof r.a4))return;const E=p.shadowRenderer,R=a.paint.get("model-receive-shadows");E&&(E.useNormalOffset=!0,R||(E.enabled=!1));const z=()=>{E&&(E.useNormalOffset=!0,R||(E.enabled=!0))},N=i.getSource();if(p.renderPass==="light-beam"&&N.type!=="batched-model")return;if(N.type==="vector"||N.type==="geojson")return function(ve,ke,De,Pe,Fe){const ze=ve.transform;if(ze.projection.name!=="mercator")return void r.w(`Drawing 3D models for ${ze.projection.name} projection is not yet implemented`);const qe=ze.getFreeCameraOptions().position;if(!ve.modelManager)return;const $e=ve.modelManager;De.modelManager=$e;const We=ve.shadowRenderer;if(!De._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const nt=De._unevaluatedLayout._values["model-id"],Ke={...De.layout.get("model-id").parameters},Ye=ve.style.order.indexOf(De.fqid);for(const ft of Pe){const kt=ke.getTile(ft).getBucket(De);if(!kt||kt.projection.name!==ze.projection.name)continue;const jt=kt.getModelUris();jt&&!kt.modelsRequested&&($e.addModelsFromBucket(jt,Fe),kt.modelsRequested=!0);const Pt=zb(ft,ze);Ke.zoom=Pt;const nn=nt.possiblyEvaluate(Ke);if(yv(ve,kt,ft),qa.shadowUniformsInitialized=!1,qa.useSingleShadowCascade=!!We&&We.getMaxCascadeForTile(ft.toUnwrapped())===0,ve.renderPass==="shadow"&&We){if(ve.currentShadowCascade===1&&kt.isInsideFirstShadowMapFrustum)continue;const zt=ze.calculatePosMatrix(ft.toUnwrapped(),ze.worldSize);if(qa.tileMatrix.set(zt),qa.shadowTileMatrix=Float32Array.from(We.calculateShadowPassMatrixFromMatrix(zt)),qa.aabb.min.fill(0),qa.aabb.max[0]=qa.aabb.max[1]=r.ab,qa.aabb.max[2]=0,zh(kt,qa,ve,De.scope))continue}const pt=1<<ft.canonical.z,Vt=[((qe.x-ft.wrap)*pt-ft.canonical.x)*r.ab,(qe.y*pt-ft.canonical.y)*r.ab,qe.z*pt*r.ab];ve.conflationActive&&Object.keys(kt.instancesPerModel).length>0&&ve.style.isLayerClipped(De,ke.getSource())&&kt.updateReplacement(ft,ve.replacementSource,Ye,Fe)&&(kt.uploaded=!1,kt.upload(ve.context));for(let zt in kt.instancesPerModel){const sn=kt.instancesPerModel[zt];sn.features.length>0&&(zt=nn.evaluate(sn.features[0].feature,{}));const ln=$e.getModel(zt,Fe);if(ln&&ln.uploaded)for(const Ut of ln.nodes)xs(ve,De,Ut,sn,Vt,ft,qa)}}}(p,i,a,m,N.type==="vector"?a.scope:""),void z();if(!N.loaded())return;if(N.type==="batched-model")return function(ve,ke,De,Pe){De.resetLayerRenderingStats(ve);const Fe=ve.context,ze=ve.transform,qe=ve.style.fog,$e=ve.shadowRenderer;if(ze.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${ze.projection.name} projection is not yet implemented`);const We=ve.transform.getFreeCameraOptions().position,nt=r.a6.vec3.scale([],[We.x,We.y,We.z],ve.transform.worldSize),Ke=r.a6.vec3.negate([],nt),Ye=r.a6.mat4.identity([]),ft=r.de(ze.center.lat,ze.zoom),kt=r.a6.mat4.fromScaling([],[1,1,1/ft]);r.a6.mat4.translate(Ye,Ye,Ke);const jt=De.paint.get("model-opacity"),Pt=new dt(Fe.gl.LEQUAL,dt.ReadWrite,ve.depthRangeFor3D),nn=new dt(Fe.gl.LEQUAL,dt.ReadOnly,ve.depthRangeFor3D),pt=new r.c9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Vt=ve.renderPass==="shadow",zt=Vt&&$e?$e.getCurrentCascadeFrustum():ze.getFrustum(ze.scaleZoom(ze.worldSize)),sn=De.paint.get("model-front-cutoff"),ln=sn[2]<1,Ut=Sl(ve,De.paint.get("model-cutoff-fade-range")),qt=De.getLayerRenderingStats();(function(Fn,pn,Cn,Yn){const Dn=Fn.terrain?Fn.terrain.exaggeration():0,qn=Fn.transform.zoom;for(const di of Yn){const ai=pn.getTile(di).getBucket(Cn);ai&&(Fn.conflationActive&&ai.updateReplacement(di,Fn.replacementSource),ai.evaluateScale(Fn,Cn),Fn.terrain&&Dn>0&&ai.elevationUpdate(Fn.terrain,Dn,di,Cn.source),ai.needsReEvaluation(Fn,qn,Cn)&&ai.evaluate(Cn))}})(ve,ke,De,Pe),function(){let Fn,pn,Cn;ln?(Fn=Pe.length-1,pn=-1,Cn=-1):(Fn=0,pn=Pe.length,Cn=1);const Yn=new Float64Array(16),Dn=r.a6.vec3.create(),qn=new r.P(0,0);for(let di=Fn;di!==pn;di+=Cn){const ai=Pe[di],Hi=ke.getTile(ai).getBucket(De);if(!Hi||!Hi.uploaded)continue;let nr=!1;$e&&(nr=$e.getMaxCascadeForTile(ai.toUnwrapped())===0);const gr=ze.calculatePosMatrix(ai.toUnwrapped(),ze.worldSize),Ia=Hi.modelTraits;!Vt&&ln&&(r.a6.mat4.invert(Yn,gr),r.a6.vec3.transformMat4(Dn,nt,Yn),qn.x=Dn[0],qn.y=Dn[1]);const ro=[];for(const vi of Hi.getNodesInfo()){if(vi.hiddenByReplacement||!vi.node.meshes)continue;const Yi=vi.node;let Lr=0;ve.terrain&&Yi.elevation&&(Lr=Yi.elevation*ve.terrain.exaggeration());const Zi=(()=>{const cr=vi.aabb;return pt.min=[...cr.min],pt.max=[...cr.max],pt.min[2]+=Lr,pt.max[2]+=Lr,r.a6.vec3.transformMat4(pt.min,pt.min,gr),r.a6.vec3.transformMat4(pt.max,pt.max,gr),pt})(),li=vi.evaluatedScale;if(li[0]<=1&&li[1]<=1&&li[2]<=1&&Zi.intersects(zt)===0)continue;if(!Vt&&ln){const cr=.16666666666666666;vi.cameraCollisionOpacity=nt[0]>Zi.min[0]&&nt[0]<Zi.max[0]&&nt[1]>Zi.min[1]&&nt[1]<Zi.max[1]&&nt[2]*ft<Zi.max[2]&&Yi.footprint&&r.bu(qn,Yi.footprint)?Math.max(vi.cameraCollisionOpacity-cr,0):Math.min(1,vi.cameraCollisionOpacity+cr)}const Oi=[...gr],Ui=Yi.anchor?Yi.anchor[0]:0,Zr=Yi.anchor?Yi.anchor[1]:0;r.a6.mat4.translate(Oi,Oi,[Ui*(li[0]-1),Zr*(li[1]-1),Lr]),r.a6.vec3.exactEquals(li,r.dh)||r.a6.mat4.scale(Oi,Oi,li);const oo=r.a6.mat4.multiply([],Oi,Yi.matrix),Ii=r.a6.mat4.multiply([],ze.expandedFarZProjMatrix,oo),Mo=r.a6.mat4.multiply([],ze.expandedFarZProjMatrix,Oi),jo=r.a6.vec4.transformMat4([],[Ui,Zr,Lr,1],Ii)[2];Yi.hidden=!1;let ko=jt;Vt||(ln&&(ko*=vi.cameraCollisionOpacity,ko*=Di(Oi,ze,vi.aabb,sn)),ko*=Cr(Ut,jo)),ko!==0?ro.push({nodeInfo:vi,depth:jo,opacity:ko,wvpForNode:Ii,wvpForTile:Mo,nodeModelMatrix:oo,tileModelMatrix:Oi}):Yi.hidden=!0}Vt||ro.sort((vi,Yi)=>!ln||vi.opacity===1&&Yi.opacity===1?vi.depth<Yi.depth?-1:1:vi.opacity===1?-1:Yi.opacity===1?1:vi.depth>Yi.depth?-1:1);for(const vi of ro){const Yi=vi.nodeInfo,Lr=Yi.node;let Zi=r.a6.mat4.multiply([],kt,vi.tileModelMatrix);r.a6.mat4.multiply(Zi,Ye,Zi);const li=r.a6.mat4.invert([],Zi);r.a6.mat4.transpose(li,li),r.a6.mat4.scale(li,li,Bb),Zi=r.a6.mat4.multiply(Zi,Zi,Lr.matrix);const Oi=ve.renderPass==="light-beam",Ui=Ia&r.dj.HasMapboxMeshFeatures,Zr=Ui?0:Yi.evaluatedRMEA[0][2];for(let oo=0;oo<Lr.meshes.length;++oo){const Ii=Lr.meshes[oo],Mo=oo===Lr.lightMeshIndex;let jo=vi.wvpForNode;if(Mo){if(!Oi&&!ve.terrain&&ve.shadowRenderer){ve.currentLayer<ve.firstLightBeamLayer&&(ve.firstLightBeamLayer=ve.currentLayer);continue}jo=vi.wvpForTile}else if(Oi)continue;const ko={defines:[]},cr=[];if(Ef(ko.defines,cr,Ii,ve,De.lut),Ui||ko.defines.push("DIFFUSE_SHADED"),nr&&ko.defines.push("SHADOWS_SINGLE_CASCADE"),qt&&(Vt?qt.numRenderedVerticesInShadowPass+=Ii.vertexArray.length:qt.numRenderedVerticesInTransparentPass+=Ii.vertexArray.length),Vt){wu(Ii,vi.nodeModelMatrix,ve,De);continue}let ks=null;if(qe){const Pl=Tf(vi.nodeModelMatrix,ve.transform);if(ks=new Float32Array(Pl),ze.projection.name!=="globe"){const ic=Ii.aabb.min,al=Ii.aabb.max,[Au,Pu]=qe.getOpacityForBounds(Pl,ic[0],ic[1],al[0],al[1]);ko.overrideFog=Au>=xn||Pu>=xn}}const Rs=Ii.material;let Ca;Rs.occlusionTexture&&Rs.occlusionTexture.offsetScale&&(Ca=Rs.occlusionTexture.offsetScale,ko.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!Vt&&$e&&($e.useNormalOffset=!!Ii.normalBuffer);const pa=ve.getOrCreateProgram("model",ko);!Vt&&$e&&$e.setupShadowsFromMatrix(vi.tileModelMatrix,pa,$e.useNormalOffset),ve.uploadCommonUniforms(Fe,pa,null,ks);const Hs=Rs.pbrMetallicRoughness;Hs.metallicFactor=.9,Hs.roughnessFactor=.5;const Aa=Pn(new Float32Array(jo),new Float32Array(Zi),new Float32Array(li),new Float32Array(Lr.matrix),ve,vi.opacity,Hs.baseColorFactor.toRenderColor(null),Rs.emissiveFactor,Hs.metallicFactor,Hs.roughnessFactor,Rs,Zr,De,[0,0,0],Ca);!Mo&&(Yi.hasTranslucentParts||vi.opacity<1)&&pa.draw(ve,Fe.gl.TRIANGLES,Pt,Kt.disabled,Be.disabled,Mn.backCCW,Aa,De.id,Ii.vertexBuffer,Ii.indexBuffer,Ii.segments,De.paint,ve.transform.zoom,void 0,cr),pa.draw(ve,Fe.gl.TRIANGLES,Mo?nn:Pt,Kt.disabled,Mo||vi.opacity<1||Yi.hasTranslucentParts?Be.alphaBlended:Be.unblended,Mn.backCCW,Aa,De.id,Ii.vertexBuffer,Ii.indexBuffer,Ii.segments,De.paint,ve.transform.zoom,void 0,cr)}}}}()}(p,i,a,m),void z();if(N.type!=="model")return;const j=N.getModels(),X=[],K=p.transform.getFreeCameraOptions().position,Q=r.a6.vec3.scale([],[K.x,K.y,K.z],p.transform.worldSize);r.a6.vec3.negate(Q,Q);const he=[],me=[];let _e=0;for(const ve of j){const ke=a.paint.get("model-rotation").constantOr(null),De=a.paint.get("model-scale").constantOr(null),Pe=a.paint.get("model-translation").constantOr(null);ve.computeModelMatrix(p,ke,De,Pe,!0,!0,!1);const Fe=r.a6.mat4.identity([]),ze=r.de(ve.position.lat,p.transform.zoom),qe=r.a6.mat4.fromScaling([],[1,1,1/ze]);r.a6.mat4.translate(Fe,Fe,Q),X.push({zScaleMatrix:qe,negCameraPosMatrix:Fe});for(const $e of ve.nodes)Lh(p.transform,$e,ve.matrix,p.transform.expandedFarZProjMatrix,_e,he,me);_e++}if(he.sort((ve,ke)=>ke.depth-ve.depth),p.renderPass!=="shadow"){if(b===1)for(const ve of me)Oh(ve,p,a,X[ve.modelIndex],Kt.disabled,p.colorModeForRenderPass());else{for(const ve of me)Oh(ve,p,a,X[ve.modelIndex],Kt.disabled,Be.disabled);for(const ve of me)Oh(ve,p,a,X[ve.modelIndex],p.stencilModeFor3D(),p.colorModeForRenderPass());p.resetStencilClippingMasks()}for(const ve of he)Oh(ve,p,a,X[ve.modelIndex],Kt.disabled,p.colorModeForRenderPass());z()}else{for(const ve of me)wu(ve.mesh,ve.nodeModelMatrix,p,a);for(const ve of he)wu(ve.mesh,ve.nodeModelMatrix,p,a);z()}}},Cf={model:function(p,i,a){const m=i.getSource();if(!m.loaded())return;if(m.type==="vector"||m.type==="geojson")return void(a.modelManager&&a.modelManager.upload(a,m.type==="vector"?p.scope:""));if(m.type==="batched-model"||m.type!=="model")return;const b=m.getModels();for(const w of b)w.upload(a.context)},raster:function(p,i,a){const m=i.getSource();if(!(m instanceof ea&&m.loaded()))return;const b=p.sourceLayer||m.rasterLayerIds&&m.rasterLayerIds[0];if(!b)return;const w=p.paint.get("raster-array-band")||m.getInitialBand(b);if(w==null)return;const E=i.getIds().map(R=>i.getTileByID(R));for(const R of E)R.updateNeeded(b,w)&&m.prepareTile(R,b,w)},"raster-particle":function(p,i,a){const m=i.getSource();if(!(m instanceof ea&&m.loaded()))return;const b=p.sourceLayer||m.rasterLayerIds&&m.rasterLayerIds[0];if(!b)return;const w=p.paint.get("raster-particle-array-band")||m.getInitialBand(b);if(w==null)return;const E=i.getIds().map(R=>i.getTileByID(R));for(const R of E)R.updateNeeded(b,w)&&m.prepareTile(R,b,w)}};class Cm{constructor(i,a,m,b){this.context=new Mb(i,a),this.transform=m,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=b,this._timeStamp=r.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const w=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const R of w)this._debugParams.enabledLayers[R]=!0;b.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),b.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),b.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),b.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const R of w)b.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],R);this.occlusionParams=new If(b),this.setup(),this.numSublayers=to.maxUnderzooming+to.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.dl,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new z_(this),this._wireframeDebugCache=new Jl,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const E=new r.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new r.T(this.context,E,i.RGBA8),this._clippingActiveLastFrame=!1}updateTerrain(i,a){const m=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new hm(this,i));const b=this._terrain;this.transform.elevation=m?b:null,b.update(i,this.transform,a),this.transform.elevation&&!b.enabled&&(this.transform.elevation=null)}_updateFog(i){const a=i.fog;if(!a||this.transform.projection.name==="globe"||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,b]=a.getFovAdjustedRange(this.transform._fov);if(m>b)return void(this.transform.fogCullDistSq=null);const w=m+.78*(b-m);this.transform.fogCullDistSq=w*w}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(i){i&&!this._terrain&&(this._terrain=new hm(this,this.style)),this._forceTerrainMode=i}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(i,a){if(this.width=i*r.q.devicePixelRatio,this.height=a*r.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._mergedLayers[m].resize()}setup(){const i=this.context,a=new r.a_;a.emplaceBack(0,0),a.emplaceBack(r.ab,0),a.emplaceBack(0,r.ab),a.emplaceBack(r.ab,r.ab),this.tileExtentBuffer=i.createVertexBuffer(a,r.b0.members),this.tileExtentSegments=r.b1.simpleSegment(0,0,4,2);const m=new r.a_;m.emplaceBack(0,0),m.emplaceBack(r.ab,0),m.emplaceBack(0,r.ab),m.emplaceBack(r.ab,r.ab),this.debugBuffer=i.createVertexBuffer(m,r.b0.members),this.debugSegments=r.b1.simpleSegment(0,0,4,5);const b=new r.a_;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(-1,1),b.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(b,r.b0.members),this.viewportSegments=r.b1.simpleSegment(0,0,4,2);const w=new r.aN;w.emplaceBack(0,0,0,0),w.emplaceBack(r.ab,0,r.ab,0),w.emplaceBack(0,r.ab,0,r.ab),w.emplaceBack(r.ab,r.ab,r.ab,r.ab),this.mercatorBoundsBuffer=i.createVertexBuffer(w,r.b3.members),this.mercatorBoundsSegments=r.b1.simpleSegment(0,0,4,2);const E=new r.aO;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(E);const R=new r.a$;for(const N of[0,1,3,2,0])R.emplaceBack(N);this.debugIndexBuffer=i.createIndexBuffer(R),this.emptyTexture=new r.T(i,new r.r({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA8),this.identityMat=r.a6.mat4.create();const z=this.context.gl;this.stencilClearMode=new Kt({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,i.TRIANGLES,dt.disabled,this.stencilClearMode,Be.disabled,Mn.disabled,Ch(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,a,m){if(!a||this.currentStencilSource===a.id||!i.isTileClipped()||!m||m.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let R=!1;for(const z of m)if(this._tileClippingMaskIDs[z.key]===void 0){R=!0;break}if(!R)return}this.currentStencilSource=a.id;const b=this.context,w=b.gl;this.nextStencilID+m.length>256&&this.clearStencil(),b.setColorMode(Be.disabled),b.setDepthMode(dt.disabled);const E=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const R of m){const z=a.getTile(R),N=this._tileClippingMaskIDs[R.key]=this.nextStencilID++,{tileBoundsBuffer:j,tileBoundsIndexBuffer:X,tileBoundsSegments:K}=this.getTileBoundsBuffers(z);E.draw(this,w.TRIANGLES,dt.disabled,new Kt({func:w.ALWAYS,mask:0},N,255,w.KEEP,w.KEEP,w.REPLACE),Be.disabled,Mn.disabled,Ch(R.projMatrix),"$clipping",j,X,K)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,a=this.context.gl;return new Kt({func:a.NOTEQUAL,mask:255},i,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const a=this.context.gl;return new Kt({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(i){const a=this.context.gl,m=i.sort((E,R)=>R.overscaledZ-E.overscaledZ),b=m[m.length-1].overscaledZ,w=m[0].overscaledZ-b+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const E={};for(let R=0;R<w;R++)E[R+b]=new Kt({func:a.GEQUAL,mask:255},R+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=w,[E,m]}return[{[b]:Kt.disabled},m]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new Be([i.CONSTANT_COLOR,i.ONE,i.CONSTANT_COLOR,i.ONE],new r.bz(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Be.unblended:Be.alphaBlended}colorModeForDrapableLayerRenderPass(i){const a=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Be([a.ONE,a.ONE_MINUS_SRC_ALPHA,a.CONSTANT_ALPHA,a.ONE_MINUS_SRC_ALPHA],new r.bz(0,0,0,i===void 0?0:i),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(i,a,m,b=!1){if(this.depthOcclusion)return new dt(this.context.gl.GREATER,dt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!b)return dt.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new dt(m||this.context.gl.LEQUAL,a,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const i=this.context.gl,a=Math.ceil(this.width),m=Math.ceil(this.height),b=this.context.bindFramebuffer.get(),w=i.getParameter(i.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===a&&this.depthFBO.height===m||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),a!==0&&m!==0&&(this.depthFBO=new _f(this.context,a,m,!1,"texture"),this.depthTexture=new r.T(this.context,{width:a,height:m,data:null},i.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(b),i.bindTexture(i.TEXTURE_2D,w),this.depthFBO&&(i.bindFramebuffer(i.READ_FRAMEBUFFER,null),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),i.blitFramebuffer(0,0,a,m,0,0,a,m,i.DEPTH_BUFFER_BIT,i.NEAREST),i.bindFramebuffer(i.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((i,a)=>i+a/this._fpsHistory.length,0))}render(i,a){const m=r.q.now();this._dt=m-this._timeStamp,this._timeStamp=m,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=i.map.repaint,this.style=i,this.options=a;const b=this.style._mergedLayers,w=this.style.order.filter(Ke=>{const Ye=b[Ke];return!(Ye.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ye.type]});let E=!1,R=!1;for(const Ke of w){const Ye=b[Ke];Ye.type==="circle"&&(E=!0),Ye.type==="symbol"&&(Ye.hasInitialOcclusionOpacityProperties?R=!0:E=!0)}const z=w.map(Ke=>b[Ke]),N=this.style._mergedSourceCaches;this.imageManager=i.imageManager,this.modelManager=i.modelManager,this.symbolFadeChange=i.placement.symbolFadeChange(r.q.now()),this.imageManager.beginFrame();let j=0,X=!1;for(const Ke in N){const Ye=N[Ke];Ye.used&&(Ye.prepare(this.context),Ye.getSource().usedInConflation&&++j)}let K=!1;for(const Ke of z)Ke.isHidden(this.transform.zoom)||(Ke.type==="clip"&&(K=!0),this.prepareLayer(Ke));const Q={},he={},me={},_e={},ve={};for(const Ke in N){const Ye=N[Ke];Q[Ke]=Ye.getVisibleCoordinates(),he[Ke]=Q[Ke].slice().reverse(),me[Ke]=Ye.getVisibleCoordinates(!0).reverse(),_e[Ke]=Ye.getShadowCasterCoordinates(),ve[Ke]=Ye.sortCoordinatesByDistance(Q[Ke])}const ke=Ke=>{const Ye=this.style.getLayerSourceCache(Ke);return Ye&&Ye.used?Ye.getSource():null};if(j||K||this._clippingActiveLastFrame){const Ke=[],Ye=[];let ft=0;for(const kt of z)this.isSourceForClippingOrConflation(kt,ke(kt))&&(Ke.push(kt),Ye.push(ft)),ft++;if(Ke&&(K||Ke.length>1)||this._clippingActiveLastFrame){K=!1;const kt=[];for(let jt=0;jt<Ke.length;jt++){const Pt=Ke[jt],nn=Ye[jt],pt=this.style.getLayerSourceCache(Pt);if(!pt||!pt.used||!pt.getSource().usedInConflation&&Pt.type!=="clip")continue;let Vt=r.dn,zt=r.bs.None;const sn=[];let ln=!0;if(Pt.type==="clip"){Vt=nn;for(const Ut of Pt.layout.get("clip-layer-types"))zt|=Ut==="model"?r.bs.Model:Ut==="symbol"?r.bs.Symbol:r.bs.FillExtrusion;for(const Ut of Pt.layout.get("clip-layer-scope"))sn.push(Ut);Pt.isHidden(this.transform.zoom)?ln=!1:K=!0}ln&&kt.push({layer:Pt.fqid,cache:pt,order:Vt,clipMask:zt,clipScope:sn})}this.replacementSource.setSources(kt),X=!0}}this._clippingActiveLastFrame=K,X||this.replacementSource.clear(),this.conflationActive=X,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Ke=0;Ke<z.length;Ke++){const Ye=z[Ke],ft=Ye.cutoffRange();if(this.longestCutoffRange=Math.max(ft,this.longestCutoffRange),ft>0){const kt=ke(Ye);kt&&(this.minCutoffZoom=Math.max(kt.minzoom,this.minCutoffZoom)),Ye.minzoom&&(this.minCutoffZoom=Math.max(Ye.minzoom,this.minCutoffZoom))}Ye.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Ke),this._lastOcclusionLayer=Ke)}const De=this.style&&this.style.fog;De?(this._fogVisible=De.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=De.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(me),this.opaquePassCutoff=0);const Pe=this._shadowRenderer;if(Pe){Pe.updateShadowParameters(this.transform,this.style.directionalLight);for(const Ke in N)for(const Ye of Q[Ke]){let ft={min:0,max:0};this.terrain&&(ft=this.terrain.getMinMaxForTile(Ye)||ft),Pe.addShadowReceiver(Ye.toUnwrapped(),ft.min,ft.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.dm(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Sf(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!gn.has(this.context.gl))return;this.renderPass="offscreen";for(const Ke of z){const Ye=i.getLayerSourceCache(Ke);if(!Ke.hasOffscreenPass()||Ke.isHidden(this.transform.zoom))continue;const ft=Ye?he[Ye.id]:void 0;(Ke.type==="custom"||Ke.type==="raster"||Ke.type==="raster-particle"||Ke.isSky()||ft&&ft.length)&&this.renderLayer(this,Ye,Ke,ft)}this.depthRangeFor3D=[0,1-(z.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,_e)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Fe=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ze=(()=>{if(a.showOverdrawInspector)return r.bz.black;const Ke=this.style.fog;if(Ke&&this.transform.projection.supportsFog){const Ye=this.style.getLut(Ke.scope);if(!Fe){const ft=Ke.properties.get("color").toRenderColor(Ye).toArray01();return new r.bz(...ft)}if(Fe){const ft=Ke.properties.get("space-color").toRenderColor(Ye).toArray01();return new r.bz(...ft)}}return r.bz.transparent})();if(this.context.clear({color:ze,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Fe&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=w.length-1;this.currentLayer>=0;this.currentLayer--){const Ke=z[this.currentLayer],Ye=i.getLayerSourceCache(Ke);if(Ke.isSky())continue;const ft=Ye?(Ke.is3D()?ve:he)[Ye.id]:void 0;this._renderTileClippingMasks(Ke,Ye,ft),this.renderLayer(this,Ye,Ke,ft)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Fe&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.a9(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<w.length;this.currentLayer++){const Ke=z[this.currentLayer],Ye=i.getLayerSourceCache(Ke);Ke.isSky()&&this.renderLayer(this,Ye,Ke,Ye?he[Ye.id]:void 0)}function qe(Ke,Ye){let ft;return Ye&&(ft=(Ke.type==="symbol"?me:Ke.is3D()?ve:he)[Ye.id]),ft}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<w.length;){const Ke=z[this.currentLayer];if(Ke.type==="raster"||Ke.type==="raster-particle"){const Ye=i.getLayerSourceCache(Ke);this.renderLayer(this,Ye,Ke,qe(Ke,Ye))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let $e=0;Pe&&($e=Pe.getShadowCastingLayerCount());let We=!1,nt=-1;for(let Ke=0;Ke<w.length;++Ke){const Ye=z[Ke];Ye.isHidden(this.transform.zoom)||Ye.is3D()&&(nt=Ke)}for(R&&nt===-1&&(E=!0);this.currentLayer<w.length;){const Ke=z[this.currentLayer],Ye=i.getLayerSourceCache(Ke);if(Ke.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Ke)){if(Ke.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(E&&!We&&this.terrain&&!this.transform.isOrthographic&&(We=!0,this.blitDepth()),R&&nt!==-1&&this.currentLayer===nt+1&&!this.transform.isOrthographic&&this.blitDepth(),Ke.is3D()||this.terrain||this._renderTileClippingMasks(Ke,Ye,Ye?Q[Ye.id]:void 0),this.renderLayer(this,Ye,Ke,qe(Ke,Ye)),!this.terrain&&Pe&&$e>0&&Ke.hasShadowPass()&&--$e==0&&(Pe.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const ft=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ft;this.currentLayer++){const kt=z[this.currentLayer];if(!kt.hasLightBeamPass())continue;const jt=i.getLayerSourceCache(kt);this.renderLayer(this,jt,kt,jt?he[jt.id]:void 0)}this.currentLayer=ft,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const ft=this.currentLayer;this.depthOcclusion=!0;for(const kt of this.layersWithOcclusionOpacity){this.currentLayer=kt;const jt=z[this.currentLayer],Pt=i.getLayerSourceCache(jt),nn=Pt?he[Pt.id]:void 0;jt.is3D()||this.terrain||this._renderTileClippingMasks(jt,Pt,Pt?Q[Pt.id]:void 0),this.renderLayer(this,Pt,jt,nn)}this.depthOcclusion=!1,this.currentLayer=ft,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Ke=null;z.forEach(Ye=>{const ft=i.getLayerSourceCache(Ye);ft&&!Ye.isHidden(this.transform.zoom)&&ft.getVisibleCoordinates().length&&(!Ke||Ke.getSource().maxzoom<ft.getSource().maxzoom)&&(Ke=ft)}),Ke&&this.options.showTileBoundaries&&Ql.debug(this,Ke,Ke.getVisibleCoordinates(),r.bz.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Ql.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.bz(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Ke){const Ye=Ke.transform.padding;Or(Ke,Ke.transform.height-(Ye.top||0),3,Db),Or(Ke,Ye.bottom||0,3,yu),_t(Ke,Ye.left||0,3,bu),_t(Ke,Ke.transform.width-(Ye.right||0),3,un);const ft=Ke.transform.centerPoint;(function(kt,jt,Pt,nn){Dh(kt,jt-1,Pt-10,2,20,nn),Dh(kt,jt-10,Pt-1,20,2,nn)})(Ke,ft.x,Ke.transform.height-ft.y,zn)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),X||(this.conflationActive=!1)}prepareLayer(i){this.gpuTimingStart(i);const{unsupportedLayers:a}=this.transform.projection,m=!a||!a.includes(i.type);if(Cf[i.type]&&(m||this.terrain&&i.type==="custom")){const b=this.style.getLayerSourceCache(i);Cf[i.type](i,b,this)}this.gpuTimingEnd()}renderLayer(i,a,m,b){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="sky"||m.type==="custom"||m.type==="model"||m.type==="raster"||m.type==="raster-particle"||b&&b.length)&&(this.id=m.id,this.gpuTimingStart(m),i.transform.projection.unsupportedLayers&&i.transform.projection.unsupportedLayers.includes(m.type)&&(!i.terrain||m.type!=="custom")||m.type==="clip"||Ql[m.type](i,a,m,b,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery,m=this.context.gl;let b=this.gpuTimers[i.id];b||(b=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:m.createQuery()}),b.calls++,m.beginQuery(a.TIME_ELAPSED_EXT,b.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const i=this.context.extTimerQuery,a=this.context.gl,m=a.createQuery();this.deferredRenderGpuTimeQueries.push(m),a.beginQuery(i.TIME_ELAPSED_EXT,m)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}collectDeferredRenderGpuQueries(){const i=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],i}queryGpuTimers(i){const a={};for(const m in i){const b=i[m],w=this.context.extTimerQuery,E=w.getQueryParameter(b.query,this.context.gl.QUERY_RESULT)/1e6;w.deleteQueryEXT(b.query),a[m]=E}return a}queryGpuTimeDeferredRender(i){if(!this.options.gpuTimingDeferredRender)return 0;const a=this.context.extTimerQuery,m=this.context.gl;let b=0;for(const w of i)b+=a.getQueryParameter(w,m.QUERY_RESULT)/1e6,a.deleteQueryEXT(w);return b}translatePosMatrix(i,a,m,b,w){if(!m[0]&&!m[1])return i;const E=w?b==="map"?this.transform.angle:0:b==="viewport"?-this.transform.angle:0;if(E){const N=Math.sin(E),j=Math.cos(E);m=[m[0]*j-m[1]*N,m[0]*N+m[1]*j]}const R=[w?m[0]:r.ak(a,m[0],this.transform.zoom),w?m[1]:r.ak(a,m[1],this.transform.zoom),0],z=new Float32Array(16);return r.a6.mat4.translate(z,i,R),z}saveTileTexture(i){const a=i.size[0],m=this._tileTextures[a];m?m.push(i):this._tileTextures[a]=[i]}getTileTexture(i){const a=this._tileTextures[i];return a&&a.length>0?a.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(i,a,m){const b=m===void 0?this.terrain&&this.terrain.renderingToTexture:m,w=[];return this.style&&this.style.enable3dLights()&&(i==="globeRaster"||i==="terrainRaster"?(w.push("LIGHTING_3D_MODE"),w.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):b||w.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||w.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?w.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):w.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(w.push("TERRAIN"),this.linearFloatFilteringSupported()&&w.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&w.push("GLOBE"),!this._fogVisible||b||a!==void 0&&!a||w.push("FOG","FOG_DITHERING"),b&&w.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&w.push("OVERDRAW_INSPECTOR"),w}getOrCreateProgram(i,a){this.cache=this.cache||{};const m=a&&a.defines||[],b=a&&a.config,w=this.currentGlobalDefines(i,a&&a.overrideFog,a&&a.overrideRtt).concat(m),E=Yl.cacheKey(Zl[i],i,w,b);return this.cache[E]||(this.cache[E]=new Yl(this.context,i,Zl[i],b,fv[i],w)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(i,a){if(this.style.enable3dLights()){const m=this.style.directionalLight,b=this.style.ambientLight;if(m&&b){const w=((E,R,z)=>{const N=E.properties.get("direction"),j=E.properties.get("color").toRenderColor(z.getLut(E.scope)).toArray01(),X=E.properties.get("intensity"),K=R.properties.get("color").toRenderColor(z.getLut(R.scope)).toArray01(),Q=R.properties.get("intensity"),he=[N.x,N.y,N.z],me=r.cH(K,Q),_e=r.cH(j,X);return{u_lighting_ambient_color:me,u_lighting_directional_dir:he,u_lighting_directional_color:_e,u_ground_radiance:dm(he,_e,me)}})(m,b,this.style);a.setLightsUniformValues(i,w)}}}uploadCommonUniforms(i,a,m,b,w){if(this.uploadCommonLightUniforms(i,a),this.terrain&&this.terrain.renderingToTexture)return;const E=this.style.fog;if(E){const R=E.getOpacity(this.transform.pitch),z=((N,j,X,K,Q,he,me,_e,ve,ke,De,Pe)=>{const Fe=N.transform,ze=j.properties.get("color").toRenderColor(N.style.getLut(j.scope)).toArray01();ze[3]=K;const qe=N.frameCounter/1e3%1,[$e,We]=j.properties.get("vertical-range");return{u_fog_matrix:X?Fe.calculateFogTileMatrix(X):Pe||N.identityMat,u_fog_range:j.getFovAdjustedRange(Fe._fov),u_fog_color:ze,u_fog_horizon_blend:j.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min($e,We),We],u_fog_temporal_offset:qe,u_frustum_tl:Q,u_frustum_tr:he,u_frustum_br:me,u_frustum_bl:_e,u_globe_pos:ve,u_globe_radius:ke,u_viewport:De,u_globe_transition:r.a9(Fe.zoom),u_is_globe:+(Fe.projection.name==="globe")}})(this,E,m,R,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.q.devicePixelRatio,this.transform.height*r.q.devicePixelRatio],b);a.setFogUniformValues(i,z)}w&&a.setCutoffUniformValues(i,w.uniformValues)}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){const i=this.canvasCopy();i&&(this.frameCopies.push(i),this.tileLoaded=!1)}canvasCopy(){const i=this.context.gl,a=i.createTexture();return i.bindTexture(i.TEXTURE_2D,a),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&i.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const i=this._backgroundTiles,a=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const b of m)a[b.key]=i[b.key]||new cs(b,512,this.transform.tileZoom,this);return a}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(i,a){return!(!i.is3D()||i.type!=="clip"&&(i.minzoom&&i.minzoom>this.transform.zoom||(this.style._clipLayerPresent||i.sourceLayer!=="building")&&(!a||a.type!=="batched-model")))}isTileAffectedByFog(i){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let a=this._cachedTileFogOpacities[i.key];return a||(this._cachedTileFogOpacities[i.key]=a=this.style.fog.getOpacityForTile(i)),a[0]>=xn||a[1]>=xn}setupDepthForOcclusion(i,a,m){const b=this.context,w=b.gl,E=!!m;var R;m||(m={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),b.activeTexture.set(w.TEXTURE3),i&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),m.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],m.u_depth_range_unpack=[2/((R=this.depthRangeFor3D)[1]-R[0]),-1-2*R[0]/(R[1]-R[0])],m.u_occluder_half_size=.5*this.occlusionParams.occluderSize,m.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),b.activeTexture.set(w.TEXTURE0),E||a.setTerrainUniformValues(b,m)}}function El(p,i){let a=!1,m=null;const b=()=>{m=null,a&&(p(),m=setTimeout(b,i),a=!1)};return()=>(a=!0,m||b(),m)}class ec{constructor(i){this._hashName=i&&encodeURIComponent(i),r.aJ(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=El(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const i=this._map;if(!i)return"";const a=Il(i);if(this._hashName){const m=this._hashName;let b=!1;const w=location.hash.slice(1).split("&").map(E=>{const R=E.split("=")[0];return R===m?(b=!0,`${R}=${a}`):E}).filter(E=>E);return b||w.push(`${m}=${a}`),`#${w.join("&")}`}return`#${a}`}_getCurrentHash(){const i=location.hash.replace("#","");if(this._hashName){let a;return i.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(a=m)}),(a&&a[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._map;if(!i)return!1;const a=this._getCurrentHash();if(a.length>=3&&!a.some(m=>isNaN(m))){const m=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(a[3]||0):i.getBearing();return i.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:m,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Il(p,i){const a=p.getCenter(),m=Math.round(100*p.getZoom())/100,b=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,b),E=Math.round(a.lng*w)/w,R=Math.round(a.lat*w)/w,z=p.getBearing(),N=p.getPitch();let j=i?`/${E}/${R}/${m}`:`${m}/${R}/${E}`;return(z||N)&&(j+="/"+Math.round(10*z)/10),N&&(j+=`/${Math.round(N)}`),j}const kc={linearity:.3,easing:r.dp(0,0,.3,1)},Af=r.l({deceleration:2500,maxSpeed:1400},kc),Am=r.l({deceleration:20,maxSpeed:1400},kc),Pm=r.l({deceleration:1e3,maxSpeed:360},kc),Mm=r.l({deceleration:1e3,maxSpeed:90},kc);class tc{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.q.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,a=r.q.now();for(;i.length>0&&a-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const a={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)a.zoom+=w.zoomDelta||0,a.bearing+=w.bearingDelta||0,a.pitch+=w.pitchDelta||0,w.panDelta&&a.pan._add(w.panDelta),w.around&&(a.around=w.around),w.pinchAround&&(a.pinchAround=w.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(a.pan.mag()){const w=Rc(a.pan.mag(),m,r.l({},Af,i||{}));b.offset=a.pan.mult(w.amount/a.pan.mag()),b.center=this._map.transform.center,Su(b,w)}if(a.zoom){const w=Rc(a.zoom,m,Am);b.zoom=this._map.transform.zoom+w.amount,Su(b,w)}if(a.bearing){const w=Rc(a.bearing,m,Pm);b.bearing=this._map.transform.bearing+r.ap(w.amount,-179,179),Su(b,w)}if(a.pitch){const w=Rc(a.pitch,m,Mm);b.pitch=this._map.transform.pitch+w.amount,Su(b,w)}if(b.zoom||b.bearing){const w=a.pinchAround===void 0?a.around:a.pinchAround;b.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),b.noMoveStart=!0,b}}function Su(p,i){(!p.duration||p.duration<i.duration)&&(p.duration=i.duration,p.easing=i.easing)}function Rc(p,i,a){const{maxSpeed:m,linearity:b,deceleration:w}=a,E=r.ap(p*b/(i/1e3),-m,m),R=Math.abs(E)/(w*b);return{easing:a.easing,duration:1e3*R,amount:E*(R/2)}}class Ms extends r.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,a,m,b={}){const w=Y(a.getCanvasContainer(),m),E=a.unproject(w);super(i,r.l({point:w,lngLat:E,originalEvent:m},b)),this._defaultPrevented=!1,this.target=a}}class Tu extends r.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,a,m){const b=i==="touchend"?m.changedTouches:m.touches,w=ie(a.getCanvasContainer(),b),E=w.map(z=>a.unproject(z)),R=w.reduce((z,N,j,X)=>z.add(N.div(X.length)),new r.P(0,0));super(i,{points:w,point:R,lngLats:E,lngLat:a.unproject(R),originalEvent:m}),this._defaultPrevented=!1}}class ss extends r.x{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,a){super("wheel",{originalEvent:a}),this._defaultPrevented=!1}}class km{constructor(i,a){this._map=i,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new ss(this._map,i))}mousedown(i,a){return this._mousedownPos=a,this._firePreventable(new Ms(i.type,this._map,i))}mouseup(i){this._map.fire(new Ms(i.type,this._map,i))}preclick(i){const a=r.l({},i);a.type="preclick",this._map.fire(new Ms(a.type,this._map,a))}click(i,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(i),this._map.fire(new Ms(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new Ms(i.type,this._map,i))}mouseover(i){this._map.fire(new Ms(i.type,this._map,i))}mouseout(i){this._map.fire(new Ms(i.type,this._map,i))}touchstart(i){return this._firePreventable(new Tu(i.type,this._map,i))}touchmove(i){this._map.fire(new Tu(i.type,this._map,i))}touchend(i){this._map.fire(new Tu(i.type,this._map,i))}touchcancel(i){this._map.fire(new Tu(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Rm{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new Ms(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ms("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new Ms(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Eu{constructor(i,a){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,a){this.isEnabled()&&i.shiftKey&&i.button===0&&(ge(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(i,a){if(!this._active)return;const m=a,b=this._startPos,w=this._lastPos;if(!b||!w||w.equals(m)||!this._box&&m.dist(b)<this._clickTolerance)return;this._lastPos=m,this._box||(this._box=ne("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const E=Math.min(b.x,m.x),R=Math.max(b.x,m.x),z=Math.min(b.y,m.y),N=Math.max(b.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${E}px,${z}px)`,this._box.style.width=R-E+"px",this._box.style.height=N-z+"px")})}mouseupWindow(i,a){if(!this._active)return;const m=this._startPos,b=a;if(m&&i.button===0){if(this.reset(),re(),m.x!==b.x||m.y!==b.y)return this._map.fire(new r.x("boxzoomend",{originalEvent:i})),{cameraAnimation:w=>w.fitScreenCoordinates(m,b,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Ee(),delete this._startPos,delete this._lastPos}_fireEvent(i,a){return this._map.fire(new r.x(i,{originalEvent:a}))}}function Cl(p,i){const a={};for(let m=0;m<p.length;m++)a[p[m].identifier]=i[m];return a}class Dm{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,a,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=i.timeStamp),m.length===this.numTouches&&(this.centroid=function(b){const w=new r.P(0,0);for(const E of b)w._add(E);return w.div(b.length)}(a),this.touches=Cl(m,a)))}touchmove(i,a,m){if(this.aborted||!this.centroid)return;const b=Cl(m,a);for(const w in this.touches){const E=b[w];(!E||E.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(i,a,m){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class Bh{constructor(i){this.singleTap=new Dm(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,a,m){this.singleTap.touchstart(i,a,m)}touchmove(i,a,m){this.singleTap.touchmove(i,a,m)}touchend(i,a,m){const b=this.singleTap.touchend(i,a,m);if(b){const w=i.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(b)<30;if(w&&E||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class Om{constructor(){this._zoomIn=new Bh({numTouches:1,numTaps:2}),this._zoomOut=new Bh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,a,m){this._zoomIn.touchstart(i,a,m),this._zoomOut.touchstart(i,a,m)}touchmove(i,a,m){this._zoomIn.touchmove(i,a,m),this._zoomOut.touchmove(i,a,m)}touchend(i,a,m){const b=this._zoomIn.touchend(i,a,m),w=this._zoomOut.touchend(i,a,m);return b?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(b)},{originalEvent:i})}):w?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(w)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Fh={0:1,2:2};class Vh{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,a){return!1}_move(i,a){return{}}mousedown(i,a){if(this._lastPoint)return;const m=te(i);this._correctButton(i,m)&&(this._lastPoint=a,this._eventButton=m)}mousemoveWindow(i,a){const m=this._lastPoint;if(m){if(i.preventDefault(),this._eventButton!=null&&function(b,w){const E=Fh[w];return b.buttons===void 0||(b.buttons&E)!==E}(i,this._eventButton))this.reset();else if(this._moved||!(a.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(m,a)}}mouseupWindow(i){this._lastPoint&&te(i)===this._eventButton&&(this._moved&&re(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Pf extends Vh{mousedown(i,a){super.mousedown(i,a),this._lastPoint&&(this._active=!0)}_correctButton(i,a){return a===0&&!i.ctrlKey}_move(i,a){return{around:a,panDelta:a.sub(i)}}}class Mf extends Vh{_correctButton(i,a){return a===0&&i.ctrlKey||a===2}_move(i,a){const m=.8*(a.x-i.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(i){i.preventDefault()}}class kf extends Vh{_correctButton(i,a){return a===0&&i.ctrlKey||a===2}_move(i,a){const m=-.5*(a.y-i.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(i){i.preventDefault()}}class xv{constructor(i,a){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),r.aJ(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(i,a,m){return this._calculateTransform(i,a,m)}touchmove(i,a,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(m.length===1&&!r.dq())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.cancelable&&i.preventDefault(),this._calculateTransform(i,a,m)}}touchend(i,a,m){this._calculateTransform(i,a,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,a,m){m.length>0&&(this._active=!0);const b=Cl(m,a),w=new r.P(0,0),E=new r.P(0,0);let R=0;for(const N in b){const j=b[N],X=this._touches[N];X&&(w._add(j),E._add(j.sub(X)),R++,b[N]=j)}if(this._touches=b,R<this._minTouches||!E.mag())return;const z=E.div(R);return this._sum._add(z),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(R),panDelta:z}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ne("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Rf{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,a,m){return{}}touchstart(i,a,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([a[0],a[1]]))}touchmove(i,a,m){const b=this._firstTwoTouches;if(!b)return;i.preventDefault();const[w,E]=b,R=Nh(m,a,w),z=Nh(m,a,E);if(!R||!z)return;const N=this._aroundCenter?null:R.add(z).div(2);return this._move([R,z],N,i)}touchend(i,a,m){if(!this._firstTwoTouches)return;const[b,w]=this._firstTwoTouches,E=Nh(m,a,b),R=Nh(m,a,w);E&&R||(this._active&&re(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Nh(p,i,a){for(let m=0;m<p.length;m++)if(p[m].identifier===a)return i[m]}function Lm(p,i){return Math.log(p/i)/Math.LN2}class wv extends Rf{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,a){const m=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(Lm(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Lm(this._distance,m),pinchAround:a}}}function zm(p,i){return 180*p.angleWith(i)/Math.PI}class Sv extends Rf{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,a){const m=this._vector;if(this._vector=i[0].sub(i[1]),m&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:zm(this._vector,m),pinchAround:a}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const a=25/(Math.PI*this._minDiameter)*360,m=this._startVector;if(!m)return!1;const b=zm(i,m);return Math.abs(b)<a}}function Df(p){return Math.abs(p.y)>Math.abs(p.x)}class Tv extends Rf{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,Df(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,a,m){const b=this._lastPoints;if(!b)return;const w=i[0].sub(b[0]),E=i[1].sub(b[1]);return this._map._cooperativeGestures&&!r.dq()&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(w,E,m.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(w.y+E.y)/2*-.5})}gestureBeginsVertically(i,a,m){if(this._valid!==void 0)return this._valid;const b=i.mag()>=2,w=a.mag()>=2;if(!b&&!w)return;if(!b||!w)return this._firstMove==null&&(this._firstMove=m),m-this._firstMove<100&&void 0;const E=i.y>0==a.y>0;return Df(i)&&Df(a)&&E}}const Ev={panStep:100,bearingStep:15,pitchStep:10};class Iv{constructor(){const i=Ev;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let a=0,m=0,b=0,w=0,E=0;switch(i.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:i.shiftKey?m=-1:(i.preventDefault(),w=-1);break;case 39:i.shiftKey?m=1:(i.preventDefault(),w=1);break;case 38:i.shiftKey?b=1:(i.preventDefault(),E=-1);break;case 40:i.shiftKey?b=-1:(i.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(m=0,b=0),{cameraAnimation:R=>{const z=R.getZoom();R.easeTo({duration:300,easeId:"keyboardHandler",easing:Cv,zoom:a?Math.round(z)+a*(i.shiftKey?2:1):z,bearing:R.getBearing()+m*this._bearingStep,pitch:R.getPitch()+b*this._pitchStep,offset:[-w*this._panStep,-E*this._panStep],center:R.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Cv(p){return p*(2-p)}const Bm=4.000244140625,Fb=1/450;class Vb{constructor(i,a){this._map=i,this._el=i.getCanvasContainer(),this._handler=a,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Fb,r.aJ(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||r.dq()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const m=r.q.now(),b=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,a!==0&&a%Bm==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=a,this._timeout=window.setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(b*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),i.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=i,this._delta-=a,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=Y(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform;this._type==="wheel"&&i.projection.wrap&&(i._center.lng>=180||i._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const a=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(this._delta!==0){const N=this._type==="wheel"&&Math.abs(this._delta)>Bm?this._wheelZoomRate:this._defaultZoomRate;let j=2/(1+Math.exp(-Math.abs(this._delta*N)));this._delta<0&&j!==0&&(j=1/j);const X=a(),K=Math.pow(2,X),Q=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):K;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(Q*j))),this._type==="wheel"&&(this._startZoom=X,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const m=typeof this._targetZoom=="number"?this._targetZoom:a(),b=this._startZoom,w=this._easing;let E,R=!1;if(this._type==="wheel"&&b&&w){const N=Math.min((r.q.now()-this._lastWheelEventTime)/200,1),j=w(N);E=r.aa(b,m,j),N<1?this._frameId||(this._frameId=!0):R=!0}else E=m,R=!0;this._active=!0,R&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let z=E-a();return z*this._lastDelta<0&&(z=0),{noInertia:!0,needsRenderFrame:!R,zoomDelta:z,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let a=r.dr;if(this._prevEase){const m=this._prevEase,b=(r.q.now()-m.start)/m.duration,w=m.easing(b+.01)-m.easing(b),E=.27/Math.sqrt(w*w+1e-4)*.01,R=Math.sqrt(.0729-E*E);a=r.dp(E,R,.25,1)}return this._prevEase={start:r.q.now(),duration:i,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ne("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Wr{constructor(i,a){this._clickZoom=i,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Av{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,a){return i.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(i.shiftKey?-1:1),around:m.unproject(a)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Nb{constructor(){this._tap=new Bh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,a,m){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=a[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(i,a,m))}touchmove(i,a,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const b=a[0],w=b.y-this._swipePoint.y;return this._swipePoint=b,i.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(i,a,m)}touchend(i,a,m){this._tapTime?this._swipePoint&&m.length===0&&this.reset():this._tap.touchend(i,a,m)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ub{constructor(i,a,m){this._el=i,this._mousePan=a,this._touchPan=m}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Uh{constructor(i,a,m){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=a,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Pv{constructor(i,a,m,b){this._el=i,this._touchZoom=a,this._touchRotate=m,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Iu=p=>p.zoom||p.drag||p.pitch||p.rotate;class Of extends r.x{}class Al{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,a){const m=r.a6.vec3.sub([],a,i);this.radius=r.a6.vec3.length(m[2]<0?r.a6.vec3.div([],m,this.constants):[m[0],m[1],0])}projectRay(i){r.a6.vec3.div(i,i,this.constants),r.a6.vec3.normalize(i,i),r.a6.vec3.mul(i,i,this.constants);const a=r.a6.vec3.scale([],i,this.radius);if(a[2]>0){const m=r.a6.vec3.scale([],[0,0,1],r.a6.vec3.dot(a,[0,0,1])),b=r.a6.vec3.scale([],r.a6.vec3.normalize([],[a[0],a[1],0]),this.radius),w=r.a6.vec3.add([],a,r.a6.vec3.scale([],r.a6.vec3.sub([],r.a6.vec3.add([],b,m),a),2));a[0]=w[0],a[1]=w[1]}return a}}function Dc(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class ws{constructor(i,a){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new tc(i),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Al,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),r.aJ(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[window,"blur",void 0]];for(const[b,w,E]of this._listeners){const R=b===document?this.handleWindowEvent:this.handleEvent;b.addEventListener(w,R,E)}}destroy(){for(const[i,a,m]of this._listeners){const b=i===document?this.handleWindowEvent:this.handleEvent;i.removeEventListener(a,b,m)}}_addDefaultHandlers(i){const a=this._map,m=a.getCanvasContainer();this._add("mapEvent",new km(a,i));const b=a.boxZoom=new Eu(a,i);this._add("boxZoom",b);const w=new Om,E=new Av;a.doubleClickZoom=new Wr(E,w),this._add("tapZoom",w),this._add("clickZoom",E);const R=new Nb;this._add("tapDragZoom",R);const z=a.touchPitch=new Tv(a);this._add("touchPitch",z);const N=new Mf(i),j=new kf(i);a.dragRotate=new Uh(i,N,j),this._add("mouseRotate",N,["mousePitch"]),this._add("mousePitch",j,["mouseRotate"]);const X=new Pf(i),K=new xv(a,i);a.dragPan=new Ub(m,X,K),this._add("mousePan",X),this._add("touchPan",K,["touchZoom","touchRotate"]);const Q=new Sv,he=new wv;a.touchZoomRotate=new Pv(m,he,Q,R),this._add("touchRotate",Q,["touchPan","touchZoom"]),this._add("touchZoom",he,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Rm(a));const me=a.scrollZoom=new Vb(a,this);this._add("scrollZoom",me,["mousePan"]);const _e=a.keyboard=new Iv;this._add("keyboard",_e);for(const ve of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[ve]&&a[ve].enable(i[ve])}_add(i,a,m){this._handlers.push({handlerName:i,handler:a,allowed:m}),this._handlersById[i]=a}stop(i){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Iu(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(i,a,m){for(const b in i)if(b!==m&&(!a||a.indexOf(b)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const a=[];for(const m of i)this._el.contains(m.target)&&a.push(m);return a}handleEvent(i,a){this._updatingCamera=!0;const m=i.type==="renderFrame",b=m?void 0:i,w={needsRenderFrame:!1},E={},R={},z=i.touches?this._getMapTouches(i.touches):void 0,N=z?ie(this._el,z):m?void 0:Y(this._el,i);for(const{handlerName:K,handler:Q,allowed:he}of this._handlers){if(!Q.isEnabled())continue;let me;this._blockedByActive(R,he,K)?Q.reset():Q[a||i.type]&&(me=Q[a||i.type](i,N,z),this.mergeHandlerResult(w,E,me,K,b),me&&me.needsRenderFrame&&this._triggerRenderFrame()),(me||Q.isActive())&&(R[K]=Q)}const j={};for(const K in this._previousActiveHandlers)R[K]||(j[K]=b);this._previousActiveHandlers=R,(Object.keys(j).length||Dc(w))&&(this._changes.push([w,E,j]),this._triggerRenderFrame()),(Object.keys(R).length||Dc(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:X}=w;X&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],X(this._map))}mergeHandlerResult(i,a,m,b,w){if(!m)return;r.l(i,m);const E={handlerName:b,originalEvent:m.originalEvent||w};m.zoomDelta!==void 0&&(a.zoom=E),m.panDelta!==void 0&&(a.drag=E),m.pitchDelta!==void 0&&(a.pitch=E),m.bearingDelta!==void 0&&(a.rotate=E)}_applyChanges(){const i={},a={},m={};for(const[b,w,E]of this._changes)b.panDelta&&(i.panDelta=(i.panDelta||new r.P(0,0))._add(b.panDelta)),b.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+b.pitchDelta),b.around!==void 0&&(i.around=b.around),b.aroundCoord!==void 0&&(i.aroundCoord=b.aroundCoord),b.pinchAround!==void 0&&(i.pinchAround=b.pinchAround),b.noInertia&&(i.noInertia=b.noInertia),r.l(a,w),r.l(m,E);this._updateMapTransform(i,a,m),this._changes=[]}_updateMapTransform(i,a,m){const b=this._map,w=b.transform,E=ke=>[ke.x,ke.y,ke.z];if((ke=>{const De=this._eventsInProgress.drag;return De&&!this._handlersById[De.handlerName].isActive()})()&&!Dc(i)){const ke=w.zoom;w.cameraElevationReference="sea",this._originalZoom!=null&&w._orthographicProjectionAtLowPitch&&w.projection.name!=="globe"&&w.pitch===0?(w.cameraElevationReference="ground",w.zoom=this._originalZoom):(w.recenterOnTerrain(),w.cameraElevationReference="ground"),ke!==w.zoom&&this._map._update(!0)}if(w._isCameraConstrained&&b._stop(!0),!Dc(i))return void this._fireEvents(a,m,!0);let{panDelta:R,zoomDelta:z,bearingDelta:N,pitchDelta:j,around:X,aroundCoord:K,pinchAround:Q}=i;w._isCameraConstrained&&(z>0&&(z=0),w._isCameraConstrained=!1),Q!==void 0&&(X=Q),(z||(ke=>a[ke]&&!this._eventsInProgress[ke])("drag"))&&X&&(this._dragOrigin=E(w.pointCoordinate3D(X)),this._originalZoom=w.zoom,this._trackingEllipsoid.setup(w._camera.position,this._dragOrigin)),w.cameraElevationReference="sea",b._stop(!0),X=X||b.transform.centerPoint,N&&(w.bearing+=N),j&&(w.pitch+=j),w._updateCameraState();const he=[0,0,0];if(R)if(w.projection.name==="mercator"){const ke=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(X).dir),De=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(X.sub(R)).dir);he[0]=De[0]-ke[0],he[1]=De[1]-ke[1]}else{const ke=w.pointCoordinate(X);if(w.projection.name==="globe"){R=R.rotate(-w.angle);const De=w._pixelsPerMercatorPixel/w.worldSize;he[0]=-R.x*r.ds(r.aM(ke.y))*De,he[1]=-R.y*r.ds(w.center.lat)*De}else{const De=w.pointCoordinate(X.sub(R));ke&&De&&(he[0]=De.x-ke.x,he[1]=De.y-ke.y)}}const me=w.zoom,_e=[0,0,0];if(z){const ke=E(K||w.pointCoordinate3D(X)),De={dir:r.a6.vec3.normalize([],r.a6.vec3.sub([],ke,w._camera.position))};if(De.dir[2]<0){const Pe=w.zoomDeltaToMovement(ke,z);r.a6.vec3.scale(_e,De.dir,Pe)}}const ve=r.a6.vec3.add(he,he,_e);w._translateCameraConstrained(ve),z&&Math.abs(w.zoom-me)>1e-4&&w.recenterOnTerrain(),w.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(a,m,!0)}_fireEvents(i,a,m){const b=Iu(this._eventsInProgress),w=Iu(i),E={};for(const j in i){const{originalEvent:X}=i[j];this._eventsInProgress[j]||(E[`${j}start`]=X),this._eventsInProgress[j]=i[j]}!b&&w&&this._fireEvent("movestart",w.originalEvent);for(const j in E)this._fireEvent(j,E[j]);w&&this._fireEvent("move",w.originalEvent);for(const j in i){const{originalEvent:X}=i[j];this._fireEvent(j,X)}const R={};let z;for(const j in this._eventsInProgress){const{handlerName:X,originalEvent:K}=this._eventsInProgress[j];this._handlersById[X].isActive()||(delete this._eventsInProgress[j],z=a[X]||K,R[`${j}end`]=z)}for(const j in R)this._fireEvent(j,R[j]);const N=Iu(this._eventsInProgress);if(m&&(b||w)&&!N){this._updatingCamera=!0;const j=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),X=K=>K!==0&&-this._bearingSnap<K&&K<this._bearingSnap;j?(X(j.bearing||this._map.getBearing())&&(j.bearing=0),this._map.easeTo(j,{originalEvent:z})):(this._map.fire(new r.x("moveend",{originalEvent:z})),X(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,a){this._map.fire(new r.x(i,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{this._frameId=void 0,this.handleEvent(new Of("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const rl="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Fm extends r.E{constructor(i,a){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=a.bearingSnap,this._respectPrefersReducedMotion=a.respectPrefersReducedMotion!==!1,r.aJ(["_renderFrameCallback"],this)}getCenter(){return new r.bK(this.transform.center.lng,this.transform.center.lat)}setCenter(i,a){return this.jumpTo({center:i},a)}panBy(i,a,m){return i=r.P.convert(i).mult(-1),this.panTo(this.transform.center,r.l({offset:i},a),m)}panTo(i,a,m){return this.easeTo(r.l({center:i},a),m)}getZoom(){return this.transform.zoom}setZoom(i,a){return this.jumpTo({zoom:i},a),this}zoomTo(i,a,m){return this.easeTo(r.l({zoom:i},a),m)}zoomIn(i,a){return this.zoomTo(this.getZoom()+1,i,a),this}zoomOut(i,a){return this.zoomTo(this.getZoom()-1,i,a),this}getBearing(){return this.transform.bearing}setBearing(i,a){return this.jumpTo({bearing:i},a),this}getPadding(){return this.transform.padding}setPadding(i,a){return this.jumpTo({padding:i},a),this}rotateTo(i,a,m){return this.easeTo(r.l({bearing:i},a),m)}resetNorth(i,a){return this.rotateTo(0,r.l({duration:1e3},i),a),this}resetNorthPitch(i,a){return this.easeTo(r.l({bearing:0,pitch:0,duration:1e3},i),a),this}snapToNorth(i,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,a):this}getPitch(){return this.transform.pitch}setPitch(i,a){return this.jumpTo({pitch:i},a),this}cameraForBounds(i,a){i=r.as.convert(i);const m=a&&a.bearing||0,b=a&&a.pitch||0,w=i.getNorthWest(),E=i.getSouthEast();return this._cameraForBounds(this.transform,w,E,m,b,a)}_extendPadding(i){const a={top:0,right:0,bottom:0,left:0};return i==null?r.l({},a,this.transform.padding):typeof i=="number"?{top:i,bottom:i,right:i,left:i}:r.l({},a,i)}_extendCameraOptions(i){return(i=r.l({offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding=this._extendPadding(i.padding),i}_minimumAABBFrustumDistance(i,a){const m=a.max[0]-a.min[0],b=a.max[1]-a.min[1];return m/b>i.aspect?m/(2*Math.tan(.5*i.fovX)*i.aspect):b/(2*Math.tan(.5*i.fovY)*i.aspect)}_cameraForBoundsOnGlobe(i,a,m,b,w,E){const R=i.clone(),z=this._extendCameraOptions(E);R.bearing=b,R.pitch=w;const N=r.bK.convert(a),j=r.bK.convert(m),X=.5*(N.lat+j.lat),K=.5*(N.lng+j.lng),Q=r.dt(X,K),he=r.a6.vec3.normalize([],Q),me=r.a6.vec3.normalize([],r.a6.vec3.cross([],he,[0,1,0])),_e=r.a6.vec3.cross([],me,he),ve=[me[0],me[1],me[2],0,_e[0],_e[1],_e[2],0,he[0],he[1],he[2],0,0,0,0,1],ke=[Q,r.dt(N.lat,N.lng),r.dt(j.lat,N.lng),r.dt(j.lat,j.lng),r.dt(N.lat,j.lng),r.dt(X,N.lng),r.dt(X,j.lng),r.dt(N.lat,K),r.dt(j.lat,K)];let De=r.c9.fromPoints(ke.map(zt=>[r.a6.vec3.dot(me,zt),r.a6.vec3.dot(_e,zt),r.a6.vec3.dot(he,zt)]));const Pe=r.a6.vec3.transformMat4([],De.center,ve);r.a6.vec3.squaredLength(Pe)===0&&r.a6.vec3.set(Pe,0,0,1),r.a6.vec3.normalize(Pe,Pe),r.a6.vec3.scale(Pe,Pe,r.aq),R.center=r.du(Pe);const Fe=R.getWorldToCameraMatrix(),ze=r.a6.mat4.invert(new Float64Array(16),Fe);De=r.c9.applyTransform(De,r.a6.mat4.multiply([],Fe,ve));const qe=this._extendAABB(De,R,z,b);if(!qe)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");De=qe,r.a6.vec3.transformMat4(Pe,Pe,Fe);const $e=.5*(De.max[2]-De.min[2]),We=this._minimumAABBFrustumDistance(R,De),nt=r.a6.vec3.scale([],[0,0,1],$e),Ke=r.a6.vec3.add(nt,Pe,nt),Ye=We+(R.pitch===0?0:r.a6.vec3.distance(Pe,Ke)),ft=R.globeCenterInViewSpace,kt=r.a6.vec3.sub([],Pe,[ft[0],ft[1],ft[2]]);r.a6.vec3.normalize(kt,kt),r.a6.vec3.scale(kt,kt,Ye);const jt=r.a6.vec3.add([],Pe,kt);r.a6.vec3.transformMat4(jt,jt,ze);const Pt=r.dw/r.aq,nn=r.a6.vec3.length(jt),pt=r.bD(Math.max(nn*Pt-r.dw,Number.EPSILON),0),Vt=Math.min(R.zoomFromMercatorZAdjusted(pt),z.maxZoom);return Vt>.5*(r.c2+r.bU)?(R.setProjection({name:"mercator"}),R.zoom=Vt,this._cameraForBounds(R,a,m,b,w,E)):{center:R.center,zoom:Vt,bearing:b,pitch:w}}_extendAABB(i,a,m,b){const w=.5*((m.padding.left||0)+(m.padding.right||0)),E=.5*((m.padding.top||0)+(m.padding.bottom||0)),R=E,z=w,N=w,j=E,X=a.width-(z+N),K=a.height-(R+j),Q=r.a6.vec3.sub([],i.max,i.min),he=Math.min(X/Q[0],K/Q[1]),me=Math.min(a.scaleZoom(a.scale*he),m.maxZoom);if(isNaN(me))return null;const _e=a.scale/a.zoomScale(me),ve=new r.c9([i.min[0]-z*_e,i.min[1]-j*_e,i.min[2]],[i.max[0]+N*_e,i.max[1]+R*_e,i.max[2]]),ke=(typeof m.offset.x=="number"&&typeof m.offset.y=="number"?new r.P(m.offset.x,m.offset.y):r.P.convert(m.offset)).rotate(-r.bB(b));return ve.center[0]-=ke.x*_e,ve.center[1]+=ke.y*_e,ve}queryTerrainElevation(i,a){const m=this.transform.elevation;return m?(a=r.l({},{exaggerated:!0},a),m.getAtPoint(r.a5.fromLngLat(i),null,a.exaggerated)):null}_cameraForBounds(i,a,m,b,w,E){if(i.projection.name==="globe")return this._cameraForBoundsOnGlobe(i,a,m,b,w,E);const R=i.clone(),z=this._extendCameraOptions(E);R.bearing=b,R.pitch=w;const N=r.bK.convert(a),j=r.bK.convert(m),X=new r.bK(N.lng,j.lat),K=new r.bK(j.lng,N.lat),Q=R.project(N),he=R.project(j),me=this.queryTerrainElevation(N),_e=this.queryTerrainElevation(j),ve=this.queryTerrainElevation(X),ke=this.queryTerrainElevation(K),De=[[Q.x,Q.y,Math.min(me||0,_e||0,ve||0,ke||0)],[he.x,he.y,Math.max(me||0,_e||0,ve||0,ke||0)]];let Pe=r.c9.fromPoints(De);const Fe=R.getWorldToCameraMatrix(),ze=r.a6.mat4.invert(new Float64Array(16),Fe);Pe=r.c9.applyTransform(Pe,Fe);const qe=this._extendAABB(Pe,R,z,b);if(!qe)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Pe=qe;const $e=.5*r.a6.vec3.sub([],Pe.max,Pe.min)[2],We=this._minimumAABBFrustumDistance(R,Pe),nt=[0,0,1,0];r.a6.vec4.transformMat4(nt,nt,Fe),r.a6.vec4.normalize(nt,nt);const Ke=r.a6.vec3.scale([],nt,We+$e),Ye=r.a6.vec3.add([],Pe.center,Ke);r.a6.vec3.transformMat4(Pe.center,Pe.center,ze),r.a6.vec3.transformMat4(Ye,Ye,ze);const ft=R.unproject(new r.P(Pe.center[0],Pe.center[1])),kt=r.dv(R.projection,ft),jt=Math.pow(2,kt),Pt=Math.min(R._zoomFromMercatorZ(Ye[2]*R.pixelsPerMeter*jt/R.worldSize),z.maxZoom);return R.mercatorFromTransition&&Pt<.5*(r.c2+r.bU)?(R.setProjection({name:"globe"}),R.zoom=Pt,this._cameraForBounds(R,a,m,b,w,E)):{center:ft,zoom:Pt,bearing:b,pitch:w}}fitBounds(i,a,m){const b=this.cameraForBounds(i,a);return this._fitInternal(b,a,m)}fitScreenCoordinates(i,a,m,b,w){const E=r.P.convert(i),R=r.P.convert(a),z=new r.P(Math.min(E.x,R.x),Math.min(E.y,R.y)),N=new r.P(Math.max(E.x,R.x),Math.max(E.y,R.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(E,R))return this;const j=this.transform.pointLocation3D(z),X=this.transform.pointLocation3D(N),K=this.transform.pointLocation3D(new r.P(z.x,N.y)),Q=this.transform.pointLocation3D(new r.P(N.x,z.y)),he=[Math.min(j.lng,X.lng,K.lng,Q.lng),Math.min(j.lat,X.lat,K.lat,Q.lat)],me=[Math.max(j.lng,X.lng,K.lng,Q.lng),Math.max(j.lat,X.lat,K.lat,Q.lat)],_e=b&&b.pitch?b.pitch:this.getPitch(),ve=this._cameraForBounds(this.transform,he,me,m,_e,b);return this._fitInternal(ve,b,w)}_fitInternal(i,a,m){return i?(a=r.l(i,a)).linear?this.easeTo(a,m):this.flyTo(a,m):this}jumpTo(i,a){this.stop();const m=i.preloadOnly?this.transform.clone():this.transform;let b=!1,w=!1,E=!1;"zoom"in i&&m.zoom!==+i.zoom&&(b=!0,m.zoom=+i.zoom),i.center!==void 0&&(m.center=r.bK.convert(i.center)),"bearing"in i&&m.bearing!==+i.bearing&&(w=!0,m.bearing=+i.bearing),"pitch"in i&&m.pitch!==+i.pitch&&(E=!0,m.pitch=+i.pitch);const R=typeof i.padding=="number"?this._extendPadding(i.padding):i.padding;if(i.padding!=null&&!m.isPaddingEqual(R))if(i.retainPadding===!1){const z=m.clone();z.padding=R,m.setLocationAtPoint(m.center,z.centerPoint)}else m.padding=R;return i.preloadOnly?(this._preloadTiles(m),this):(this.fire(new r.x("movestart",a)).fire(new r.x("move",a)),b&&this.fire(new r.x("zoomstart",a)).fire(new r.x("zoom",a)).fire(new r.x("zoomend",a)),w&&this.fire(new r.x("rotatestart",a)).fire(new r.x("rotate",a)).fire(new r.x("rotateend",a)),E&&this.fire(new r.x("pitchstart",a)).fire(new r.x("pitch",a)).fire(new r.x("pitchend",a)),this.fire(new r.x("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(rl),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,a){const m=this.transform;if(!m.projection.supportsFreeCamera)return r.w(rl),this;this.stop();const b=m.zoom,w=m.pitch,E=m.bearing;m.setFreeCameraOptions(i);const R=b!==m.zoom,z=w!==m.pitch,N=E!==m.bearing;return this.fire(new r.x("movestart",a)).fire(new r.x("move",a)),R&&this.fire(new r.x("zoomstart",a)).fire(new r.x("zoom",a)).fire(new r.x("zoomend",a)),N&&this.fire(new r.x("rotatestart",a)).fire(new r.x("rotate",a)).fire(new r.x("rotateend",a)),z&&this.fire(new r.x("pitchstart",a)).fire(new r.x("pitch",a)).fire(new r.x("pitchend",a)),this.fire(new r.x("moveend",a)),this}easeTo(i,a){this._stop(!1,i.easeId),((i=r.l({offset:[0,0],duration:500,easing:r.dr},i)).animate===!1||this._prefersReducedMotion(i))&&(i.duration=0);const m=this.transform,b=this.getZoom(),w=this.getBearing(),E=this.getPitch(),R=this.getPadding(),z="zoom"in i?+i.zoom:b,N="bearing"in i?this._normalizeBearing(i.bearing,w):w,j="pitch"in i?+i.pitch:E,X=this._extendPadding(i.padding),K=r.P.convert(i.offset);let Q,he,me;if(m.projection.name==="globe"){const nt=r.a5.fromLngLat(m.center),Ke=K.rotate(-m.angle);nt.x+=Ke.x/m.worldSize,nt.y+=Ke.y/m.worldSize;const Ye=nt.toLngLat(),ft=r.bK.convert(i.center||Ye);this._normalizeCenter(ft),Q=m.centerPoint.add(Ke),he=new r.P(nt.x,nt.y).mult(m.worldSize),me=new r.P(r.am(ft.lng),r.at(ft.lat)).mult(m.worldSize).sub(he)}else{Q=m.centerPoint.add(K);const nt=m.pointLocation(Q),Ke=r.bK.convert(i.center||nt);this._normalizeCenter(Ke),he=m.project(nt),me=m.project(Ke).sub(he)}const _e=m.zoomScale(z-b);let ve,ke;i.around&&(ve=r.bK.convert(i.around),ke=m.locationPoint(ve));const De=this._zooming||z!==b,Pe=this._rotating||w!==N,Fe=this._pitching||j!==E,ze=!m.isPaddingEqual(X),qe=i.retainPadding===!1?m.clone():m,$e=nt=>Ke=>{if(De&&(nt.zoom=r.aa(b,z,Ke)),Pe&&(nt.bearing=r.aa(w,N,Ke)),Fe&&(nt.pitch=r.aa(E,j,Ke)),ze&&(qe.interpolatePadding(R,X,Ke),Q=qe.centerPoint.add(K)),ve)nt.setLocationAtPoint(ve,ke);else{const Ye=nt.zoomScale(nt.zoom-b),ft=z>b?Math.min(2,_e):Math.max(.5,_e),kt=Math.pow(ft,1-Ke),jt=nt.unproject(he.add(me.mult(Ke*kt)).mult(Ye));nt.setLocationAtPoint(nt.renderWorldCopies?jt.wrap():jt,Q)}return i.preloadOnly||this._fireMoveEvents(a),nt};if(i.preloadOnly){const nt=this._emulate($e,i.duration,m);return this._preloadTiles(nt),this}const We={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=De,this._rotating=Pe,this._pitching=Fe,this._padding=ze,this._easeId=i.easeId,this._prepareEase(a,i.noMoveStart,We),this._ease($e(m),nt=>{m.cameraElevationReference==="sea"&&m.recenterOnTerrain(),this._afterEase(a,nt)},i),this}_prepareEase(i,a,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),a||m.moving||this.fire(new r.x("movestart",i)),this._zooming&&!m.zooming&&this.fire(new r.x("zoomstart",i)),this._rotating&&!m.rotating&&this.fire(new r.x("rotatestart",i)),this._pitching&&!m.pitching&&this.fire(new r.x("pitchstart",i))}_fireMoveEvents(i){this.fire(new r.x("move",i)),this._zooming&&this.fire(new r.x("zoom",i)),this._rotating&&this.fire(new r.x("rotate",i)),this._pitching&&this.fire(new r.x("pitch",i))}_afterEase(i,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const m=this._zooming,b=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new r.x("zoomend",i)),b&&this.fire(new r.x("rotateend",i)),w&&this.fire(new r.x("pitchend",i)),this.fire(new r.x("moveend",i))}flyTo(i,a){if(this._prefersReducedMotion(i)){const zt=r.ar(i,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(zt,a)}this.stop(),i=r.l({offset:[0,0],speed:1.2,curve:1.42,easing:r.dr},i);const m=this.transform,b=this.getZoom(),w=this.getBearing(),E=this.getPitch(),R=this.getPadding(),z="zoom"in i?r.ap(+i.zoom,m.minZoom,m.maxZoom):b,N="bearing"in i?this._normalizeBearing(i.bearing,w):w,j="pitch"in i?+i.pitch:E,X=this._extendPadding(i.padding),K=m.zoomScale(z-b),Q=r.P.convert(i.offset);let he=m.centerPoint.add(Q);const me=m.pointLocation(he),_e=r.bK.convert(i.center||me);this._normalizeCenter(_e);const ve=m.project(me),ke=m.project(_e).sub(ve);let De=i.curve;const Pe=Math.max(m.width,m.height),Fe=Pe/K,ze=ke.mag();if("minZoom"in i){const zt=r.ap(Math.min(i.minZoom,b,z),m.minZoom,m.maxZoom),sn=Pe/m.zoomScale(zt-b);De=Math.sqrt(sn/ze*2)}const qe=De*De;function $e(zt){const sn=(Fe*Fe-Pe*Pe+(zt?-1:1)*qe*qe*ze*ze)/(2*(zt?Fe:Pe)*qe*ze);return Math.log(Math.sqrt(sn*sn+1)-sn)}function We(zt){return(Math.exp(zt)-Math.exp(-zt))/2}function nt(zt){return(Math.exp(zt)+Math.exp(-zt))/2}const Ke=$e(0);let Ye=function(zt){return nt(Ke)/nt(Ke+De*zt)},ft=function(zt){return Pe*((nt(Ke)*(We(sn=Ke+De*zt)/nt(sn))-We(Ke))/qe)/ze;var sn},kt=($e(1)-Ke)/De;if(Math.abs(ze)<1e-6||!isFinite(kt)){if(Math.abs(Pe-Fe)<1e-6)return this.easeTo(i,a);const zt=Fe<Pe?-1:1;kt=Math.abs(Math.log(Fe/Pe))/De,ft=function(){return 0},Ye=function(sn){return Math.exp(zt*De*sn)}}i.duration="duration"in i?+i.duration:1e3*kt/("screenSpeed"in i?+i.screenSpeed/De:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const jt=w!==N,Pt=j!==E,nn=!m.isPaddingEqual(X),pt=i.retainPadding===!1?m.clone():m,Vt=zt=>sn=>{const ln=sn*kt,Ut=1/Ye(ln);zt.zoom=sn===1?z:b+zt.scaleZoom(Ut),jt&&(zt.bearing=r.aa(w,N,sn)),Pt&&(zt.pitch=r.aa(E,j,sn)),nn&&(pt.interpolatePadding(R,X,sn),he=pt.centerPoint.add(Q));const qt=sn===1?_e:zt.unproject(ve.add(ke.mult(ft(ln))).mult(Ut));return zt.setLocationAtPoint(zt.renderWorldCopies?qt.wrap():qt,he),zt._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(a),zt};if(i.preloadOnly){const zt=this._emulate(Vt,i.duration,m);return this._preloadTiles(zt),this}return this._zooming=!0,this._rotating=jt,this._pitching=Pt,this._padding=nn,this._prepareEase(a,!1),this._ease(Vt(m),()=>this._afterEase(a),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(i){}_cancelRenderFrame(i){}_stop(i,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,a)}if(!i){const m=this.handlers;m&&m.stop(!1)}return this}_ease(i,a,m){m.animate===!1||m.duration===0?(i(1),a()):(this._easeStart=r.q.now(),this._easeOptions=m,this._onEaseFrame=i,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((r.q.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,a){i=r.bA(i,-180,180);const m=Math.abs(i-a);return Math.abs(i-360-a)<m&&(i-=360),Math.abs(i+360-a)<m&&(i+=360),i}_normalizeCenter(i){const a=this.transform;if(a.maxBounds||a.projection.name!=="globe"&&!a.renderWorldCopies)return;const m=i.lng-a.center.lng;i.lng+=m>180?-360:m<-180?360:0}_prefersReducedMotion(i){return this._respectPrefersReducedMotion&&r.q.prefersReducedMotion&&!(i&&i.essential)}_emulate(i,a,m){const b=Math.ceil(15*a/1e3),w=[],E=i(m.clone());for(let R=0;R<=b;R++){const z=E(R/b);w.push(z.clone())}return w}_preloadTiles(i,a){}}class Lf{constructor(i={}){this.options=i,r.aJ(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const a=this.options&&this.options.compact,m=i._getUIString("AttributionControl.ToggleAttribution");this._map=i,this._container=ne("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ne("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",m);const b=ne("span","mapboxgl-ctrl-icon",this._compactButton);return b.setAttribute("aria-hidden","true"),b.setAttribute("title",m),this._innerContainer=ne("div","mapboxgl-ctrl-attrib-inner",this._container),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.e.ACCESS_TOKEN}];if(i){const m=a.reduce((b,w,E)=>(w.value&&(b+=`${w.key}=${w.value}${E<a.length-1?"&":""}`),b),"?");i.href=`${r.e.FEEDBACK_URL}/${m}#${Il(this._map,!0)}`,i.rel="noopener nofollow"}}_updateData(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const a=this._map.style._mergedSourceCaches;for(const b in a){const w=a[b];if(w.used){const E=w.getSource();E.attribution&&i.indexOf(E.attribution)<0&&i.push(E.attribution)}}i.sort((b,w)=>b.length-w.length),i=i.filter((b,w)=>{for(let E=w+1;E<i.length;E++)if(i[E].indexOf(b)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const m=i.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,i.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Vm{constructor(){r.aJ(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=ne("div","mapboxgl-ctrl");const a=ne("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(Object.entries(i).length===0)return!0;for(const a in i){const m=i[a].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const a=i[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class Mv{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const a=++this._id;return this._queue.push({callback:i,id:a,cancelled:!1}),a}remove(i){const a=this._currentlyRunning,m=a?this._queue.concat(a):this._queue;for(const b of m)if(b.id===i)return void(b.cancelled=!0)}run(i=0){const a=this._currentlyRunning=this._queue;this._queue=[];for(const m of a)if(!m.cancelled&&(m.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class jh{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const a=r.cw((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,a,m){this._start=this.getValue(a),this._end=i,this._startTime=a,this._endTime=a+m}}const jb={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class $b{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Nm{constructor(i){this.map=i,this.interactionsByType=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this)}add(i,a){if(this.typeById.has(i))throw new Error(`Interaction id "${i}" already exists.`);const{type:m,filter:b}=a;if(b){const E=r.M(b,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(E.result==="error")throw new Error(E.value.map(R=>`${R.key}: ${R.message}`).join(", "));this.filters.set(i,E.value)}const w=this.interactionsByType.get(m)||new Map;w.size===0&&(this.map.on(m,this.handleType),this.interactionsByType.set(m,w)),w.set(i,a),this.typeById.set(i,m)}remove(i){const a=this.typeById.get(i);if(!a)return;this.typeById.delete(i),this.filters.delete(i);const m=this.interactionsByType.get(a);m&&(m.delete(i),m.size===0&&this.map.off(a,this.handleType))}handleType(i){const a=i.features||this.map.queryRenderedFeatures(i.point);if(!a)return;const m=this.interactionsByType.get(i.type),b={zoom:0};for(const[w,E]of m){const R=this.filters.get(w),{handler:z,layers:N}=E;for(const j of a)if((!N||N.includes(j.layer.id))&&(!R||R.evaluate(b,j))&&z({id:w,feature:j,interaction:E})!==!1)break}}}const Um={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0},$h={showCompass:!0,showZoom:!0,visualizePitch:!1};class Cu{constructor(i,a,m=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new Mf({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,m&&(this.mousePitch=new kf({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),r.aJ(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(i,a){this.mouseRotate.mousedown(i,a),this.mousePitch&&this.mousePitch.mousedown(i,a),ge()}move(i,a){const m=this.map,b=this.mouseRotate.mousemoveWindow(i,a),w=b&&b.bearingDelta;if(w&&m.setBearing(m.getBearing()+w),this.mousePitch){const E=this.mousePitch.mousemoveWindow(i,a),R=E&&E.pitchDelta;R&&m.setPitch(m.getPitch()+R)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Ee(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(r.l({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),Y(this.element,i)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,Y(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ie(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){i.targetTouches.length!==1?this.reset():(this._lastPos=ie(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function ol(p,i,a){if(p=new r.bK(p.lng,p.lat),i){const m=new r.bK(p.lng-360,p.lat),b=new r.bK(p.lng+360,p.lat),w=360*Math.ceil(Math.abs(p.lng-a.center.lng)/360),E=a.locationPoint(p).distSqr(i),R=i.x<0||i.y<0||i.x>a.width||i.y>a.height;a.locationPoint(m).distSqr(i)<E&&(R||Math.abs(m.lng-a.center.lng)<w)?p=m:a.locationPoint(b).distSqr(i)<E&&(R||Math.abs(b.lng-a.center.lng)<w)&&(p=b)}for(;Math.abs(p.lng-a.center.lng)>180;){const m=a.locationPoint(p);if(m.x>=0&&m.y>=0&&m.x<=a.width&&m.y<=a.height)break;p.lng>a.center.lng?p.lng-=360:p.lng+=360}return p}const fa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class sl extends r.E{constructor(i,a){if(super(),(i instanceof HTMLElement||a)&&(i=r.l({element:i},a)),r.aJ(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=i&&i.occludedOpacity||.2,i&&i.element)this._element=i.element,this._offset=r.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=ne("div");const w=41,E=27,R=ce("svg",{display:"block",height:w*this._scale+"px",width:E*this._scale+"px",viewBox:`0 0 ${E} ${w}`},this._element),z=ce("radialGradient",{id:"shadowGradient"},ce("defs",{},R));ce("stop",{offset:"10%","stop-opacity":.4},z),ce("stop",{offset:"100%","stop-opacity":.05},z),ce("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},R),ce("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},R),ce("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},R),ce("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},R),this._offset=r.P.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",w=>{w.preventDefault()}),this._element.addEventListener("mousedown",w=>{w.preventDefault()});const m=this._element.classList;for(const w in fa)m.remove(`mapboxgl-marker-anchor-${w}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`);const b=i&&i.className?i.className.trim().split(/\s+/):[];m.add(...b),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){const i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=r.bK.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const b=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(38.1-13.5+b)],"bottom-right":[-b,-1*(38.1-13.5+b)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,i._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const a=i.code,m=i.charCode||i.keyCode;a!=="Space"&&a!=="Enter"&&m!==32&&m!==13||this.togglePopup()}_onMapClick(i){const a=i.originalEvent.target,m=this._element;this._popup&&(a===m||m.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const i=this._map,a=this._pos;if(!i||!a)return!1;const m=i.unproject(a),b=i.getFreeCameraOptions();if(!b.position)return!1;const w=b.position.toLngLat();return w.distanceTo(m)<.9*w.distanceTo(this._lngLat)}_evaluateOpacity(){const i=this._map;if(!i)return;const a=this._pos;if(!a||a.x<0||a.x>i.transform.width||a.y<0||a.y>i.transform.height)return void this._clearFadeTimer();const m=i.unproject(a);let b;i._showingGlobe()&&r.dz(i.transform,this._lngLat)?b=0:(b=1-i._queryFogOpacity(m),i.transform._terrainEnabled()&&i.getTerrain()&&this._behindTerrain()&&(b*=this._occludedOpacity)),this._element.style.opacity=`${b}`,this._element.style.pointerEvents=b>0?"auto":"none",this._popup&&this._popup._setOpacity(b),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const i=this._pos;if(!i||!this._map)return;const a=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${i.x}px,${i.y}px)
            ${fa[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${a.x}px,${a.y}px)
        `}_calculateXYTransform(){const i=this._pos,a=this._map,m=this.getPitchAlignment();if(!a||!i||m!=="map")return"";if(!a._showingGlobe()){const z=a.getPitch();return z?`rotateX(${z}deg)`:""}const b=r.c0(r.dA(a.transform,this._lngLat)),w=i.sub(r.dB(a.transform)),E=Math.abs(w.x)+Math.abs(w.y);if(E===0)return"";const R=b/E;return`rotateX(${-w.y*R}deg) rotateY(${w.x*R}deg)`}_calculateZTransform(){const i=this._pos,a=this._map;if(!a||!i)return"";let m=0;const b=this.getRotationAlignment();if(b==="map")if(a._showingGlobe()){const w=a.project(new r.bK(this._lngLat.lng,this._lngLat.lat+.001)),E=a.project(new r.bK(this._lngLat.lng,this._lngLat.lat-.001)).sub(w);m=r.c0(Math.atan2(E.y,E.x))-90}else m=-a.getBearing();else if(b==="horizon"){const w=r.a7(4,6,a.getZoom()),E=r.dB(a.transform);E.y+=w*a.transform.height;const R=i.sub(E),z=r.c0(Math.atan2(R.y,R.x));m=(z>90?z-270:z+90)*(1-w)}return m+=this._rotation,m?`rotateZ(${m}deg)`:""}_update(i){cancelAnimationFrame(this._updateFrameId);const a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=ol(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat),i===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),a._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._showingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=r.P.convert(i),this._update(),this}addClassName(i){return this._element.classList.add(i),this}removeClassName(i){return this._element.classList.remove(i),this}toggleClassName(i){return this._element.classList.toggle(i)}_onMove(i){const a=this._map;if(!a)return;const m=this._pointerdownPos,b=this._positionDelta;if(m&&b){if(!this._isDragging){const w=this._clickTolerance||a._clickTolerance;if(i.point.dist(m)<w)return;this._isDragging=!0}this._pos=i.point.sub(b),this._lngLat=a.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.x("dragstart"))),this.fire(new r.x("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.x("dragend")),this._state="inactive"}_addDragHandler(i){const a=this._map,m=this._pos;a&&m&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(m),this._pointerdownPos=i.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;const a=this._map;return a&&(i?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(i){return this._occludedOpacity=i||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Oc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},nc={maxWidth:100,unit:"metric"},Gb={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Hb={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},qb=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function kv(p=new r.P(0,0),i="bottom"){if(typeof p=="number"){const a=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(i){case"top":return new r.P(0,p);case"top-left":return new r.P(a,a);case"top-right":return new r.P(-a,a);case"bottom":return new r.P(0,-p);case"bottom-left":return new r.P(a,-a);case"bottom-right":return new r.P(-a,-a);case"left":return new r.P(p,0);case"right":return new r.P(-p,0)}return new r.P(0,0)}return p instanceof r.P||Array.isArray(p)?r.P.convert(p):r.P.convert(p[i]||[0,0])}return{version:D,supported:q.supported,setRTLTextPlugin:r.dC,getRTLTextPluginStatus:r.dD,Map:class extends Fm{constructor(p){B.mark(L.create);const i=p;if((p=r.l({},Um,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&r.dx(window)&&(p.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Wd(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),p),this._repaint=!!p.repaint,this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._collectResourceTiming=p.collectResourceTiming,this._language=this._parseLanguage(p.language),this._worldview=p.worldview,this._renderTaskQueue=new Mv,this._domRenderTaskQueue=new Mv,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.aP(),this._locale=r.l({},jb,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._performanceMetricsCollection=p.performanceMetricsCollection,this._tessellationStep=p.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=p.precompilePrograms,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new jh(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._requestManager=new tt(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,this._contextCreateOptions=p.contextCreateOptions?{...p.contextCreateOptions}:{},typeof p.container=="string"){const a=document.getElementById(p.container);if(!a)throw new Error(`Container '${p.container.toString()}' not found.`);this._container=a}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),r.aJ(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new $b),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new ws(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,(p.style||!p.testMode)&&this.setStyle(p.style||r.e.DEFAULT_STYLE,{config:p.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),p.hash&&(this._hash=new ec(typeof p.hash=="string"&&p.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){i.center==null&&i.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch});const a=p.bounds;a&&(this.resize(),this.fitBounds(a,r.l({},p.fitBoundsOptions,{duration:0})))}this.resize(),p.attributionControl&&this.addControl(new Lf({customAttribution:p.customAttribution})),this._logoControl=new Vm,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new r.x(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new r.x(`${a.dataType}dataloading`,a))}),this._interactions=new Nm(this)}_getMapId(){return this._mapId}addControl(p,i){if(i===void 0&&(i=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new r.t(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=p.onAdd(this);this._controls.push(p);const m=this._controlPositions[i];return i.indexOf("bottom")!==-1?m.insertBefore(a,m.firstChild):m.appendChild(a),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new r.t(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(p);return i>-1&&this._controls.splice(i,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new r.x("movestart",p)).fire(new r.x("move",p)),this.fire(new r.x("resize",p)),i&&this.fire(new r.x("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(r.as.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new r.x("zoomstart")).fire(new r.x("zoom")).fire(new r.x("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new r.x("zoomstart")).fire(new r.x("zoom")).fire(new r.x("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new r.x("pitchstart")).fire(new r.x("pitch")).fire(new r.x("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new r.x("pitchstart")).fire(new r.x("pitch")).fire(new r.x("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(p){return p==="auto"?navigator.language:Array.isArray(p)?p.length===0?void 0:p.map(i=>i==="auto"?navigator.language:i):p}setLanguage(p){const i=this._parseLanguage(p);if(!this.style||i===this._language)return this;this._language=i,this.style.reloadSources();for(const a of this._controls)a._setLanguage&&a._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(p){return this.style&&p!==this._worldview?(this._worldview=p,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(p){return this._lazyInitEmptyStyle(),p?typeof p=="string"&&(p={name:p}):p=null,this._useExplicitProjection=!!p,this._prioritizeAndUpdateProjection(p,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const p=this.transform,i=p.projection.name;let a;i==="globe"&&p.zoom>=r.bU?(p.setMercatorFromTransition(),a=!0):i==="mercator"&&p.zoom<r.bU&&(p.setProjection({name:"globe"}),a=!0),a&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(p,i){return this._updateProjection(p||i||{name:"mercator"})}_updateProjection(p){let i;return i=p.name==="globe"&&this.transform.zoom>=r.bU?this.transform.setMercatorFromTransition():this.transform.setProjection(p),this.style.applyProjectionUpdate(),i&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(p){return this.transform.locationPoint3D(r.bK.convert(p))}unproject(p){return this.transform.pointLocation3D(r.P.convert(p))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(p,i,a){if(p==="mouseenter"||p==="mouseover"){let m=!1;const b=E=>{const R=i.filter(N=>this.getLayer(N)),z=R.length?this.queryRenderedFeatures(E.point,{layers:R}):[];z.length?m||(m=!0,a.call(this,new Ms(p,this,E.originalEvent,{features:z}))):m=!1},w=()=>{m=!1};return{layers:new Set(i),listener:a,delegates:{mousemove:b,mouseout:w}}}if(p==="mouseleave"||p==="mouseout"){let m=!1;const b=E=>{const R=i.filter(z=>this.getLayer(z));(R.length?this.queryRenderedFeatures(E.point,{layers:R}):[]).length?m=!0:m&&(m=!1,a.call(this,new Ms(p,this,E.originalEvent)))},w=E=>{m&&(m=!1,a.call(this,new Ms(p,this,E.originalEvent)))};return{layers:new Set(i),listener:a,delegates:{mousemove:b,mouseout:w}}}{const m=b=>{const w=i.filter(R=>this.getLayer(R)),E=w.length?this.queryRenderedFeatures(b.point,{layers:w}):[];E.length&&(b.features=E,a.call(this,b),delete b.features)};return{layers:new Set(i),listener:a,delegates:{[p]:m}}}}on(p,i,a){if(typeof i=="function"||a===void 0)return super.on(p,i);if(Array.isArray(i)||(i=[i]),i){for(const b of i)if(!this._isValidId(b))return this}const m=this._createDelegatedListener(p,i,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(m);for(const b in m.delegates)this.on(b,m.delegates[b]);return this}once(p,i,a){if(typeof i=="function"||a===void 0)return super.once(p,i);if(Array.isArray(i)||(i=[i]),i){for(const b of i)if(!this._isValidId(b))return this}const m=this._createDelegatedListener(p,i,a);for(const b in m.delegates)this.once(b,m.delegates[b]);return this}off(p,i,a){if(typeof i=="function"||a===void 0)return super.off(p,i);const m=new Set(Array.isArray(i)?i:[i]);for(const E of m)if(!this._isValidId(E))return this;const b=(E,R)=>{if(E.size!==R.size)return!1;for(const z of E)if(!R.has(z))return!1;return!0},w=this._delegatedListeners?this._delegatedListeners[p]:void 0;return w&&(E=>{for(let R=0;R<E.length;R++){const z=E[R];if(z.listener===a&&b(z.layers,m)){for(const N in z.delegates)this.off(N,z.delegates[N]);return E.splice(R,1),this}}})(w),this}queryRenderedFeatures(p,i){if(!this.style)return[];if(i!==void 0||p===void 0||p instanceof r.P||Array.isArray(p)||(i=p,p=void 0),p=p||[[0,0],[this.transform.width,this.transform.height]],(i=i||{}).layers&&Array.isArray(i.layers)){for(const a of i.layers)if(!this._isValidId(a))return[]}return this.style.queryRenderedFeatures(p,i,this.transform)}querySourceFeatures(p,i){return this._isValidId(p)?this.style.querySourceFeatures(p,i):[]}isPointOnSurface(p){const{name:i}=this.transform.projection;return i!=="globe"&&i!=="mercator"&&r.w(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(p))}addInteraction(p,i){return this._interactions.add(p,i),this}removeInteraction(p){return this._interactions.remove(p),this}setStyle(p,i){return i=r.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i),this.style&&p&&i.diff!==!1&&i.localFontFamily===this._localFontFamily&&i.localIdeographFontFamily===this._localIdeographFontFamily&&!i.config?(this.style._diffStyle(p,(a,m)=>{a?(r.w(`Unable to perform style diff: ${String(a.message||a.error||a)}. Rebuilding the style from scratch.`),this._updateStyle(p,i)):m&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(p,i))}_getUIString(p){const i=this._locale[p];if(i==null)throw new Error(`Missing UI string '${p}'`);return i}_updateStyle(p,i){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p){const a=r.l({},i);i&&i.config&&(a.initialConfig=i.config,delete a.config),this.style=new ha(this,a).load(p),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ha(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(p){return p==null?(this.fire(new r.t(new Error("IDs can't be empty."))),!1):!r.cn(p)||(this.fire(new r.t(new Error(`IDs can't contain special symbols: "${p}".`))),!1)}addSource(p,i){return this._isValidId(p)?(this._lazyInitEmptyStyle(),this.style.addSource(p,i),this._update(!0)):this}isSourceLoaded(p){return!!this._isValidId(p)&&!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(p,i,a){this._lazyInitEmptyStyle(),this.style.addSourceType(p,i,a)}removeSource(p){return this._isValidId(p)?(this.style.removeSource(p),this._updateTerrain(),this._update(!0)):this}getSource(p){return this._isValidId(p)?this.style.getOwnSource(p):null}addImage(p,i,{pixelRatio:a=1,sdf:m=!1,stretchX:b,stretchY:w,content:E}={}){if(this._lazyInitEmptyStyle(),i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap){const{width:R,height:z,data:N}=r.q.getImageData(i);this.style.addImage(p,{data:new r.r({width:R,height:z},N),pixelRatio:a,stretchX:b,stretchY:w,content:E,sdf:m,version:0})}else if(i.width===void 0||i.height===void 0)this.fire(new r.t(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:R,height:z}=i,N=i;this.style.addImage(p,{data:new r.r({width:R,height:z},new Uint8Array(N.data)),pixelRatio:a,stretchX:b,stretchY:w,content:E,sdf:m,version:0,userImage:N}),N.onAdd&&N.onAdd(this,p)}}updateImage(p,i){this._lazyInitEmptyStyle();const a=this.style.getImage(p);if(!a)return void this.fire(new r.t(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap?r.q.getImageData(i):i,{width:b,height:w,data:E}=m;if(b===void 0||w===void 0)return void this.fire(new r.t(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==a.data.width||w!==a.data.height)return void this.fire(new r.t(new Error(`The width and height of the updated image (${b}, ${w})
                must be that same as the previous version of the image
                (${a.data.width}, ${a.data.height})`)));const R=!(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap);a.data.replace(E,R),this.style.updateImage(p,a)}hasImage(p){return p?!!this.style&&!!this.style.getImage(p):(this.fire(new r.t(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,i){r.o(this._requestManager.transformRequest(p,r.R.Image),(a,m)=>{i(a,m instanceof HTMLImageElement?r.q.getImageData(m):m)})}listImages(){return this.style.listImages()}addModel(p,i){this._lazyInitEmptyStyle(),this.style.addModel(p,i)}hasModel(p){return p?this.style.hasModel(p):(this.fire(new r.t(new Error("Missing required model id"))),!1)}removeModel(p){this.style.removeModel(p)}listModels(){return this.style.listModels()}addLayer(p,i){return this._isValidId(p.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(p,i),this._update(!0)):this}getSlot(p){const i=this.getLayer(p);return i&&i.slot||null}setSlot(p,i){return this.style.setSlot(p,i),this.style.mergeLayers(),this._update(!0)}addImport(p,i){return this.style.addImport(p,i),this}updateImport(p,i){return typeof i!="string"&&i.id!==p?(this.removeImport(p),this.addImport(i)):(this.style.updateImport(p,i),this._update(!0))}removeImport(p){return this.style.removeImport(p),this}moveImport(p,i){return this.style.moveImport(p,i),this._update(!0)}moveLayer(p,i){return this._isValidId(p)?(this.style.moveLayer(p,i),this._update(!0)):this}removeLayer(p){return this._isValidId(p)?(this.style.removeLayer(p),this._update(!0)):this}getLayer(p){if(!this._isValidId(p))return null;const i=this.style.getOwnLayer(p);return i?i.type==="custom"?i.implementation:i.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(p,i,a){return this._isValidId(p)?(this.style.setLayerZoomRange(p,i,a),this._update(!0)):this}setFilter(p,i,a={}){return this._isValidId(p)?(this.style.setFilter(p,i,a),this._update(!0)):this}getFilter(p){return this._isValidId(p)?this.style.getFilter(p):null}setPaintProperty(p,i,a,m={}){return this._isValidId(p)?(this.style.setPaintProperty(p,i,a,m),this._update(!0)):this}getPaintProperty(p,i){return this._isValidId(p)?this.style.getPaintProperty(p,i):null}setLayoutProperty(p,i,a,m={}){return this._isValidId(p)?(this.style.setLayoutProperty(p,i,a,m),this._update(!0)):this}getLayoutProperty(p,i){return this._isValidId(p)?this.style.getLayoutProperty(p,i):null}getSchema(p){return this.style.getSchema(p)}setSchema(p,i){return this.style.setSchema(p,i),this._update(!0)}getConfig(p){return this.style.getConfig(p)}setConfig(p,i){return this.style.setConfig(p,i),this._update(!0)}getConfigProperty(p,i){return this.style.getConfigProperty(p,i)}setConfigProperty(p,i,a){return this.style.setConfigProperty(p,i,a),this._update(!0)}setLights(p){if(this._lazyInitEmptyStyle(),p&&p.length===1&&p[0].type==="flat"){const i=p[0];i.properties?this.style.setFlatLight(i.properties,i.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(p),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const p=this.style.getLights()||[];return p.length===0&&p.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),p}setLight(p,i={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:p}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setColorTheme(p){return this._lazyInitEmptyStyle(),this.style.setColorTheme(p),this._update(!0)}setCamera(p){return this.style.setCamera(p),this._triggerCameraUpdate(p)}_triggerCameraUpdate(p){return this._update(this.transform.setOrthographicProjectionAtLowPitch(p["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.bK.convert(p),this.transform):0}setFeatureState(p,i){return this._isValidId(p.source)?(this.style.setFeatureState(p,i),this._update()):this}removeFeatureState(p,i){return this._isValidId(p.source)?(this.style.removeFeatureState(p,i),this._update()):this}getFeatureState(p){return this._isValidId(p.source)?this.style.getFeatureState(p):null}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let a,m,b,w=this._container;for(;w&&(!m||!b);){const E=window.getComputedStyle(w).transform;E&&E!=="none"&&(a=E.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&a[0]!=="0"&&a[0]!=="1"&&(m=a[0]),a[3]&&a[3]!=="0"&&a[3]!=="1"&&(b=a[3])),w=w.parentElement}this._containerWidth=m?Math.abs(p/m):p,this._containerHeight=b?Math.abs(i/b):i}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=ne("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=ne("div","mapboxgl-canvas-container",p);this._canvas=ne("canvas","mapboxgl-canvas",i),this._interactive&&(i.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const a=this._controlContainer=ne("div","mapboxgl-control-container",p),m=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(b=>{m[b]=ne("div",`mapboxgl-ctrl-${b}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,i){const a=r.q.devicePixelRatio||1;this._canvas.width=a*Math.ceil(p),this._canvas.height=a*Math.ceil(i),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${i}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const i=this._markers.indexOf(p);i!==-1&&this._markers.splice(i,1)}_addPopup(p){this._popups.push(p)}_removePopup(p){const i=this._popups.indexOf(p);i!==-1&&this._popups.splice(i,1)}_setupPainter(){const p=r.l({},q.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl2",p);i?(Ae(i,!0),this.painter=new Cm(i,this._contextCreateOptions,this.transform,this._tp),this.on("data",a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.m.testSupport(i)):this.fire(new r.t(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.x("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.resize(),this._update(),this.fire(new r.x("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let i;this.fire(new r.x("renderstart")),++this._frameId;const a=this.painter.context.extTimerQuery,m=r.q.now(),b=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(i=b.createQuery(),b.beginQuery(a.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;this._updateProjectionTransition();const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const N=this.transform.zoom,j=this.transform.pitch,X=r.q.now(),K=new r.a3(N,{now:X,fadeDuration:w,pitch:j,transition:this.style.transition});this.style.update(K)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let E=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),E=this._updateAverageElevation(m),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):E=this._updateAverageElevation(m);const R=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions,this.painter.replacementSource);if(R&&(this._placementDirty=R.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.x("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,B.mark(L.load),this.fire(new r.x("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const N=r.q.now()-m;b.endQuery(a.TIME_ELAPSED_EXT),setTimeout(()=>{const j=b.getQueryParameter(i,b.QUERY_RESULT)/1e6;b.deleteQuery(i),this.fire(new r.x("gpu-timing-frame",{cpuTime:N,gpuTime:j}))},50)}if(this.listens("gpu-timing-layer")){const N=this.painter.collectGpuTimers();setTimeout(()=>{const j=this.painter.queryGpuTimers(N);this.fire(new r.x("gpu-timing-layer",{layerTimes:j}))},50)}if(this.listens("gpu-timing-deferred-render")){const N=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const j=this.painter.queryGpuTimeDeferredRender(N);this.fire(new r.x("gpu-timing-deferred-render",{gpuTime:j}))},50)}const z=this._sourcesDirty||this._styleDirty||this._placementDirty||E;if(z||this._repaint)this.triggerRepaint();else{const N=this.idle();if(N&&(E=this._updateAverageElevation(m,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),N&&(this.fire(new r.x("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const j=this._calculateSpeedIndex();this.fire(new r.x("speedindexcompleted",{speedIndex:j})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||z||(this._fullyLoaded=!0,B.mark(L.fullLoad),this._performanceMetricsCollection&&St(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(p){for(const i of this._markers)p&&!this.getRenderWorldCopies()&&(i._lngLat=i._lngLat.wrap()),i._update();for(const i of this._popups)!p||this.getRenderWorldCopies()||i._trackPointer||(i._lngLat=i._lngLat.wrap()),i._update()}_updateAverageElevation(p,i=!1){const a=b=>(this.transform.averageElevation=b,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);const m=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(m||(i||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const b=this.transform.averageElevation;let w=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(w)?w=0:this._averageElevationLastSampledAt=p;const E=Math.abs(b-w);if(E>1){if(this._isInitialLoad||m)return this._averageElevation.jumpTo(w),a(w);this._averageElevation.easeTo(w,p,300)}else if(E>1e-4)return this._averageElevation.jumpTo(w),a(w)}return!!this._averageElevation.isEasing(p)&&a(this._averageElevation.getValue(p))}_authenticate(){Ie(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===Le||p.status===401)){const i=this.painter.context.gl;Ae(i,!1),this._logoControl instanceof Vm&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.t(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),ht(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&et(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const p=this._isDragging();this.painter.updateTerrain(this.style,p)}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const a=this.painter.context.gl,m=a.createFramebuffer();function b(w){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,w,0);const E=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,E),E}return a.bindFramebuffer(a.FRAMEBUFFER,m),this._canvasPixelComparison(b(p),i.canvasCopies.map(b),i.timeStamps)}_canvasPixelComparison(p,i,a){let m=a[1]-a[0];const b=p.length/4;for(let w=0;w<i.length;w++){const E=i[w];let R=0;for(let z=0;z<E.length;z+=4)E[z]===p[z]&&E[z+1]===p[z+1]&&E[z+2]===p[z+2]&&E[z+3]===p[z+3]&&(R+=1);m+=(a[w+2]-a[w+1])*(1-R/b)}return m}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),gn.delete(this.painter.context.gl),Xt.remove(),Bt.remove(),this._removed=!0,this.fire(new r.x("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=r.q.frame(i=>{const a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(i)}))}_preloadTiles(p){const i=this.style?this.style.getSourceCaches():[];return r.bf(i,(a,m)=>a._preloadTiles(p,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(p){this._showParseStatus!==p&&(this._showParseStatus=p,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(p){this._showLayers2DWireframe!==p&&(this._showLayers2DWireframe=p,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(p){this._showLayers3DWireframe!==p&&(this._showLayers3DWireframe=p,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,this._tp.refreshUI(),p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(p){this._showTileAABBs!==p&&(this._showTileAABBs=p,this._tp.refreshUI(),p&&this._update())}_setCacheLimits(p,i){r.dy(p,i)}get version(){return D}},NavigationControl:class{constructor(p={}){this.options=r.l({},$h,p),this._container=ne("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(r.aJ(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>{this._map&&this._map.zoomIn({},{originalEvent:i})}),ne("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>{this._map&&this._map.zoomOut({},{originalEvent:i})}),ne("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.aJ(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{const a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:i}):a.resetNorth({},{originalEvent:i}))}),this._compassIcon=ne("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const p=this._map;if(!p)return;const i=p.getZoom(),a=i===p.getMaxZoom(),m=i===p.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){const p=this._map;if(!p)return;const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Cu(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){const p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,i){const a=ne("button",p,this._container);return a.type="button",a.addEventListener("click",i),a}_setButtonTitle(p,i){if(!this._map)return;const a=this._map._getUIString(`NavigationControl.${i}`);p.setAttribute("aria-label",a),p.firstElementChild&&p.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends r.E{constructor(p={}){super();const i=navigator.geolocation;this.options=r.l({geolocation:i},Oc,p),r.aJ(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=El(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(p){return this._map=p,this._container=ne("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(p){const i=(a=!!this.options.geolocation)=>{this._supportsGeolocation=a,p(a)};this._supportsGeolocation!==void 0?p(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(a=>i(a.state!=="denied")).catch(()=>i()):i()}_isOutOfMapMaxBounds(p){const i=this._map.getMaxBounds(),a=p.coords;return!!i&&(a.longitude<i.getWest()||a.longitude>i.getEast()||a.latitude<i.getSouth()||a.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new r.x("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(p),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(p),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.x("geolocate",p)),this._finish()}}_updateCamera(p){const i=new r.bK(p.coords.longitude,p.coords.latitude),a=p.coords.accuracy,m=this._map.getBearing(),b=r.l({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(a),b,{geolocateSource:!0})}_updateMarker(p){if(p){const i=new r.bK(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map.transform,i=r.bD(1,p._center.lat)*p.worldSize,a=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(p.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(p.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.x("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=ne("button","mapboxgl-ctrl-geolocate",this._container),ne("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",p===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ne("div","mapboxgl-user-location"),this._dotElement.appendChild(ne("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ne("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new sl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ne("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new sl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.x("trackuserlocationend")))})}}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:p.absolute===!0&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.x("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.x("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.x("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(p={maximumAge:6e5,timeout:0},this._noTimeout=!0):(p=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(i=>{i==="granted"&&p()}).catch(console.error):p()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Lf,ScaleControl:class{constructor(p={}){this.options=r.l({},nc,p),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),r.aJ(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const p=this.options.maxWidth||100,i=this._map,a=i._containerHeight/2,m=i._containerWidth/2-p/2,b=i.unproject([m,a]),w=i.unproject([m+p,a]),E=b.distanceTo(w);if(this.options.unit==="imperial"){const R=3.2808*E;R>5280?this._setScale(p,R/5280,"mile"):this._setScale(p,R,"foot")}else this.options.unit==="nautical"?this._setScale(p,E/1852,"nautical-mile"):E>=1e3?this._setScale(p,E/1e3,"kilometer"):this._setScale(p,E,"meter")}_setScale(p,i,a){this._map._requestDomTask(()=>{const m=function(w){const E=Math.pow(10,`${Math.floor(w)}`.length-1);let R=w/E;return R=R>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(z){const N=Math.pow(10,Math.ceil(-Math.log(z)/Math.LN10));return Math.round(z*N)/N}(R),E*R}(i),b=m/i;this._container.innerHTML=this._isNumberFormatSupported&&a!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:a}).format(m):`${m}&nbsp;${Gb[a]}`,this._container.style.width=p*b+"px"})}onAdd(p){return this._map=p,this._language=p.getLanguage(),this._container=ne("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(p){this._language=p,this._update()}setUnit(p){this.options.unit=p,this._update()}},FullscreenControl:class{constructor(p={}){this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:r.w("Full screen control 'container' must be a DOM element.")),r.aJ(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=ne("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=ne("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ne("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends r.E{constructor(p){super(),this.options=r.l(Object.create(Hb),p),r.aJ(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),p._addPopup(this),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new r.x("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),p._canvasContainer&&p._canvasContainer.classList.remove("mapboxgl-track-pointer"),p._removePopup(this),this._map=void 0),this.fire(new r.x("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=r.bK.convert(p),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const i=document.createDocumentFragment(),a=document.createElement("body");let m;for(a.innerHTML=p;m=a.firstChild,m;)i.appendChild(m);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=ne("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(p),this.options.closeButton){const a=this._closeButton=ne("button","mapboxgl-popup-close-button",i);a.type="button",a.setAttribute("aria-label","Close popup"),a.setAttribute("aria-hidden","true"),a.innerHTML="&#215;",a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let i;return this._classList.delete(p)?i=!1:(this._classList.add(p),i=!0),this._updateClassList(),i}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const i=this._map,a=this._container,m=this._pos;if(!i||!a||!m)return"bottom";const b=a.offsetWidth,w=a.offsetHeight,E=m.x<b/2,R=m.x>i.transform.width-b/2;if(m.y+p<w)return E?"top-left":R?"top-right":"top";if(m.y>i.transform.height-w){if(E)return"bottom-left";if(R)return"bottom-right"}return E?"left":R?"right":"bottom"}_updateClassList(){const p=this._container;if(!p)return;const i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),p.className=i.join(" ")}_update(p){const i=this._map,a=this._content;if(!i||!this._lngLat&&!this._trackPointer||!a)return;let m=this._container;if(m||(m=this._container=ne("div","mapboxgl-popup",i.getContainer()),this._tip=ne("div","mapboxgl-popup-tip",m),m.appendChild(a)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ol(this._lngLat,this._pos,i.transform)),!this._trackPointer||p){const b=this._pos=this._trackPointer&&p instanceof r.P?p:i.project(this._lngLat),w=kv(this.options.offset),E=this._anchor=this._getAnchor(w.y),R=kv(this.options.offset,E),z=b.add(R).round();i._requestDomTask(()=>{this._container&&E&&(this._container.style.transform=`${fa[E]} translate(${z.x}px,${z.y}px)`)})}if(!this._marker&&i._showingGlobe()){const b=r.dz(i.transform,this._lngLat)?0:1;this._setOpacity(b)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(qb);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._container&&(this._container.style.opacity=`${p}`),this._content&&(this._content.style.pointerEvents=p?"auto":"none")}},Marker:sl,Style:ha,LngLat:r.bK,LngLatBounds:r.as,Point:r.P,MercatorCoordinate:r.a5,FreeCameraOptions:Uo,Evented:r.E,config:r.e,prewarm:r.dE,clearPrewarmedResources:r.dF,get accessToken(){return r.e.ACCESS_TOKEN},set accessToken(p){r.e.ACCESS_TOKEN=p},get baseApiUrl(){return r.e.API_URL},set baseApiUrl(p){r.e.API_URL=p},get workerCount(){return r.dG.workerCount},set workerCount(p){r.dG.workerCount=p},get maxParallelImageRequests(){return r.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){r.e.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){r.dH(p)},get workerUrl(){return r.dI.workerUrl},set workerUrl(p){r.dI.workerUrl=p},get workerClass(){return r.dI.workerClass},set workerClass(p){r.dI.workerClass=p},get workerParams(){return r.dI.workerParams},set workerParams(p){r.dI.workerParams=p},get dracoUrl(){return r.dJ()},set dracoUrl(p){r.dK(p)},get meshoptUrl(){return r.dL()},set meshoptUrl(p){r.dM(p)},setNow:r.q.setNow,restoreNow:r.q.restoreNow}});var T=v;return T})})(xO);var o8=xO.exports;const nd=nT(o8);var Vp=a8,s8=Object.prototype.hasOwnProperty;function a8(){for(var e={},t=0;t<arguments.length;t++){var o=arguments[t];for(var c in o)s8.call(o,c)&&(e[c]=o[c])}return e}var SO={exports:{}};(function(e,t){(function(){var o={};e.exports=o,o.simpleFilter=function(c,d){return d.filter(function(v){return o.test(c,v)})},o.test=function(c,d){return o.match(c,d)!==null},o.match=function(c,d,v){v=v||{};var y=0,T=[],r=d.length,D=0,L=0,B=v.pre||"",U=v.post||"",$=v.caseSensitive&&d||d.toLowerCase(),W;c=v.caseSensitive&&c||c.toLowerCase();for(var q=0;q<r;q++)W=d[q],$[q]===c[y]?(W=B+W+U,y+=1,L+=1+L):L=0,D+=L,T[T.length]=W;return y===c.length?(D=$===c?1/0:D,{rendered:T.join(""),score:D}):null},o.filter=function(c,d,v){return!d||d.length===0?[]:typeof c!="string"?d:(v=v||{},d.reduce(function(y,T,r,D){var L=T;v.extract&&(L=v.extract(T));var B=o.match(c,L,v);return B!=null&&(y[y.length]={string:B.rendered,score:B.score,index:r,original:T}),y},[]).sort(function(y,T){var r=T.score-y.score;return r||y.index-T.index}))}})()})(SO);var l8=SO.exports,Fa=function(e){return this.component=e,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,e.el.parentNode.insertBefore(this.wrapper,e.el.nextSibling),this};Fa.prototype.show=function(){this.element.style.display="block"};Fa.prototype.hide=function(){this.element.style.display="none"};Fa.prototype.add=function(e){this.items.push(e)};Fa.prototype.clear=function(){this.items=[],this.active=0};Fa.prototype.isEmpty=function(){return!this.items.length};Fa.prototype.isVisible=function(){return this.element.style.display==="block"};Fa.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var e=0;e<this.items.length;e++)this.drawItem(this.items[e],this.active===e);this.show()};Fa.prototype.drawItem=function(e,t){var o=document.createElement("li"),c=document.createElement("a");t&&(o.className+=" active"),c.innerHTML=e.string,o.appendChild(c),this.element.appendChild(o),o.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),o.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,e)}).bind(this))};Fa.prototype.handleMouseUp=function(e){this.selectingListItem=!1,this.component.value(e.original),this.clear(),this.draw()};Fa.prototype.move=function(e){this.active=e,this.draw()};Fa.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};Fa.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};Fa.prototype.drawError=function(e){var t=document.createElement("li");t.innerHTML=e,this.element.appendChild(t),this.show()};var c8=Fa,u8=Vp,h8=l8,d8=c8,Ks=function(e,t,o){return o=o||{},this.options=u8({minLength:2,limit:5,filter:!0,hideOnBlur:!0},o),this.el=e,this.data=t||[],this.list=new d8(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(c){this.handleKeyUp(c.keyCode)}).bind(this),!1),this.el.addEventListener("keydown",(function(c){this.handleKeyDown(c)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(c){this.handlePaste(c)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};Ks.prototype.handleKeyUp=function(e){e===40||e===38||e===27||e===13||e===9||this.handleInputChange(this.el.value)};Ks.prototype.handleKeyDown=function(e){switch(e.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&e.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};Ks.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};Ks.prototype.handlePaste=function(e){if(e.clipboardData)this.handleInputChange(e.clipboardData.getData("Text"));else{var t=this;setTimeout(function(){t.handleInputChange(e.target.value)},100)}};Ks.prototype.handleInputChange=function(e){if(this.query=this.normalize(e),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(t){for(var o=0;o<t.length&&(this.list.add(t[o]),o!==this.options.limit-1);o++);this.list.draw()}).bind(this))};Ks.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};Ks.prototype.update=function(e){this.data=e,this.handleKeyUp()};Ks.prototype.clear=function(){this.data=[],this.list.clear()};Ks.prototype.normalize=function(e){return e=e.toLowerCase(),e};Ks.prototype.match=function(e,t){return e.indexOf(t)>-1};Ks.prototype.value=function(e){if(this.selected=e,this.el.value=this.getItemValue(e),document.createEvent){var t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!1),this.el.dispatchEvent(t)}else this.el.fireEvent("onchange")};Ks.prototype.getCandidates=function(e){var t={pre:"<strong>",post:"</strong>",extract:(function(c){return this.getItemValue(c)}).bind(this)},o;this.options.filter?(o=h8.filter(this.query,this.data,t),o=o.map((function(c){return{original:c.original,string:this.render(c.original,c.string)}}).bind(this))):o=this.data.map((function(c){var d=this.render(c);return{original:c,string:d}}).bind(this)),e(o)};Ks.prototype.getItemValue=function(e){return e};Ks.prototype.render=function(e,t){if(t)return t;for(var o=e.original?this.getItemValue(e.original):this.getItemValue(e),c=this.normalize(o),d=c.lastIndexOf(this.query);d>-1;){var v=d+this.query.length;o=o.slice(0,d)+"<strong>"+o.slice(d,v)+"</strong>"+o.slice(v),d=c.slice(0,d).lastIndexOf(this.query)}return o};Ks.prototype.renderError=function(e){this.list.drawError(e)};var f8=Ks,TO=f8,p8=TO;typeof window<"u"&&(window.Suggestions=TO);var m8="Expected a function",gM=NaN,g8="[object Symbol]",_8=/^\s+|\s+$/g,v8=/^[-+]0x[0-9a-f]+$/i,y8=/^0b[01]+$/i,b8=/^0o[0-7]+$/i,x8=parseInt,w8=typeof ps=="object"&&ps&&ps.Object===Object&&ps,S8=typeof self=="object"&&self&&self.Object===Object&&self,T8=w8||S8||Function("return this")(),E8=Object.prototype,I8=E8.toString,C8=Math.max,A8=Math.min,k1=function(){return T8.Date.now()};function P8(e,t,o){var c,d,v,y,T,r,D=0,L=!1,B=!1,U=!0;if(typeof e!="function")throw new TypeError(m8);t=_M(t)||0,Ew(o)&&(L=!!o.leading,B="maxWait"in o,v=B?C8(_M(o.maxWait)||0,t):v,U="trailing"in o?!!o.trailing:U);function $(Ee){var de=c,re=d;return c=d=void 0,D=Ee,y=e.apply(re,de),y}function W(Ee){return D=Ee,T=setTimeout(ce,t),L?$(Ee):y}function q(Ee){var de=Ee-r,re=Ee-D,Y=t-de;return B?A8(Y,v-re):Y}function ne(Ee){var de=Ee-r,re=Ee-D;return r===void 0||de>=t||de<0||B&&re>=v}function ce(){var Ee=k1();if(ne(Ee))return oe(Ee);T=setTimeout(ce,q(Ee))}function oe(Ee){return T=void 0,U&&c?$(Ee):(c=d=void 0,y)}function fe(){T!==void 0&&clearTimeout(T),D=0,c=r=d=T=void 0}function be(){return T===void 0?y:oe(k1())}function ge(){var Ee=k1(),de=ne(Ee);if(c=arguments,d=this,r=Ee,de){if(T===void 0)return W(r);if(B)return T=setTimeout(ce,t),$(r)}return T===void 0&&(T=setTimeout(ce,t)),y}return ge.cancel=fe,ge.flush=be,ge}function Ew(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function M8(e){return!!e&&typeof e=="object"}function k8(e){return typeof e=="symbol"||M8(e)&&I8.call(e)==g8}function _M(e){if(typeof e=="number")return e;if(k8(e))return gM;if(Ew(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Ew(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(_8,"");var o=y8.test(e);return o||b8.test(e)?x8(e.slice(2),o?2:8):v8.test(e)?gM:+e}var R8=P8,iT={exports:{}},xp=typeof Reflect=="object"?Reflect:null,vM=xp&&typeof xp.apply=="function"?xp.apply:function(t,o,c){return Function.prototype.apply.call(t,o,c)},jy;xp&&typeof xp.ownKeys=="function"?jy=xp.ownKeys:Object.getOwnPropertySymbols?jy=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:jy=function(t){return Object.getOwnPropertyNames(t)};function D8(e){console&&console.warn&&console.warn(e)}var EO=Number.isNaN||function(t){return t!==t};function Xr(){Xr.init.call(this)}iT.exports=Xr;iT.exports.once=B8;Xr.EventEmitter=Xr;Xr.prototype._events=void 0;Xr.prototype._eventsCount=0;Xr.prototype._maxListeners=void 0;var yM=10;function U0(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}Object.defineProperty(Xr,"defaultMaxListeners",{enumerable:!0,get:function(){return yM},set:function(e){if(typeof e!="number"||e<0||EO(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");yM=e}});Xr.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Xr.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||EO(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function IO(e){return e._maxListeners===void 0?Xr.defaultMaxListeners:e._maxListeners}Xr.prototype.getMaxListeners=function(){return IO(this)};Xr.prototype.emit=function(t){for(var o=[],c=1;c<arguments.length;c++)o.push(arguments[c]);var d=t==="error",v=this._events;if(v!==void 0)d=d&&v.error===void 0;else if(!d)return!1;if(d){var y;if(o.length>0&&(y=o[0]),y instanceof Error)throw y;var T=new Error("Unhandled error."+(y?" ("+y.message+")":""));throw T.context=y,T}var r=v[t];if(r===void 0)return!1;if(typeof r=="function")vM(r,this,o);else for(var D=r.length,L=kO(r,D),c=0;c<D;++c)vM(L[c],this,o);return!0};function CO(e,t,o,c){var d,v,y;if(U0(o),v=e._events,v===void 0?(v=e._events=Object.create(null),e._eventsCount=0):(v.newListener!==void 0&&(e.emit("newListener",t,o.listener?o.listener:o),v=e._events),y=v[t]),y===void 0)y=v[t]=o,++e._eventsCount;else if(typeof y=="function"?y=v[t]=c?[o,y]:[y,o]:c?y.unshift(o):y.push(o),d=IO(e),d>0&&y.length>d&&!y.warned){y.warned=!0;var T=new Error("Possible EventEmitter memory leak detected. "+y.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");T.name="MaxListenersExceededWarning",T.emitter=e,T.type=t,T.count=y.length,D8(T)}return e}Xr.prototype.addListener=function(t,o){return CO(this,t,o,!1)};Xr.prototype.on=Xr.prototype.addListener;Xr.prototype.prependListener=function(t,o){return CO(this,t,o,!0)};function O8(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function AO(e,t,o){var c={fired:!1,wrapFn:void 0,target:e,type:t,listener:o},d=O8.bind(c);return d.listener=o,c.wrapFn=d,d}Xr.prototype.once=function(t,o){return U0(o),this.on(t,AO(this,t,o)),this};Xr.prototype.prependOnceListener=function(t,o){return U0(o),this.prependListener(t,AO(this,t,o)),this};Xr.prototype.removeListener=function(t,o){var c,d,v,y,T;if(U0(o),d=this._events,d===void 0)return this;if(c=d[t],c===void 0)return this;if(c===o||c.listener===o)--this._eventsCount===0?this._events=Object.create(null):(delete d[t],d.removeListener&&this.emit("removeListener",t,c.listener||o));else if(typeof c!="function"){for(v=-1,y=c.length-1;y>=0;y--)if(c[y]===o||c[y].listener===o){T=c[y].listener,v=y;break}if(v<0)return this;v===0?c.shift():L8(c,v),c.length===1&&(d[t]=c[0]),d.removeListener!==void 0&&this.emit("removeListener",t,T||o)}return this};Xr.prototype.off=Xr.prototype.removeListener;Xr.prototype.removeAllListeners=function(t){var o,c,d;if(c=this._events,c===void 0)return this;if(c.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):c[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete c[t]),this;if(arguments.length===0){var v=Object.keys(c),y;for(d=0;d<v.length;++d)y=v[d],y!=="removeListener"&&this.removeAllListeners(y);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(o=c[t],typeof o=="function")this.removeListener(t,o);else if(o!==void 0)for(d=o.length-1;d>=0;d--)this.removeListener(t,o[d]);return this};function PO(e,t,o){var c=e._events;if(c===void 0)return[];var d=c[t];return d===void 0?[]:typeof d=="function"?o?[d.listener||d]:[d]:o?z8(d):kO(d,d.length)}Xr.prototype.listeners=function(t){return PO(this,t,!0)};Xr.prototype.rawListeners=function(t){return PO(this,t,!1)};Xr.listenerCount=function(e,t){return typeof e.listenerCount=="function"?e.listenerCount(t):MO.call(e,t)};Xr.prototype.listenerCount=MO;function MO(e){var t=this._events;if(t!==void 0){var o=t[e];if(typeof o=="function")return 1;if(o!==void 0)return o.length}return 0}Xr.prototype.eventNames=function(){return this._eventsCount>0?jy(this._events):[]};function kO(e,t){for(var o=new Array(t),c=0;c<t;++c)o[c]=e[c];return o}function L8(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function z8(e){for(var t=new Array(e.length),o=0;o<t.length;++o)t[o]=e[o].listener||e[o];return t}function B8(e,t){return new Promise(function(o,c){function d(y){e.removeListener(t,v),c(y)}function v(){typeof e.removeListener=="function"&&e.removeListener("error",d),o([].slice.call(arguments))}RO(e,t,v,{once:!0}),t!=="error"&&F8(e,d,{once:!0})})}function F8(e,t,o){typeof e.on=="function"&&RO(e,"error",t,o)}function RO(e,t,o,c){if(typeof e.on=="function")c.once?e.once(t,o):e.on(t,o);else if(typeof e.addEventListener=="function")e.addEventListener(t,function d(v){c.once&&e.removeEventListener(t,d),o(v)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}var V8=iT.exports,N8={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};function U8(e){var t=e.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return t?{key:t[1],value:t[2]}:null}function j8(e){var t=e.match(/<?([^>]*)>(.*)/);if(!t)return null;var o=t[1],c=t[2].split(";"),d=null,v=c.reduce(function(y,T){var r=U8(T);return r?r.key==="rel"?(d||(d=r.value),y):(y[r.key]=r.value,y):y},{});return d?{url:o,rel:d,params:v}:null}function $8(e){return e?e.split(/,\s*</).reduce(function(t,o){var c=j8(o);if(!c)return t;var d=c.rel.split(/\s+/);return d.forEach(function(v){t[v]||(t[v]={url:c.url,params:c.params})}),t},{}):{}}var G8=$8,H8=G8;function rT(e,t){this.request=e,this.headers=t.headers,this.rawBody=t.body,this.statusCode=t.statusCode;try{this.body=JSON.parse(t.body||"{}")}catch{this.body=t.body}this.links=H8(this.headers.link)}rT.prototype.hasNextPage=function(){return!!this.links.next};rT.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var q8=rT,j0={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},bM=j0;function W8(e){var t=e.type||bM.ERROR_HTTP,o;if(e.body)try{o=JSON.parse(e.body)}catch{o=e.body}else o=null;var c=e.message||null;c||(typeof o=="string"?c=o:o&&typeof o.message=="string"?c=o.message:t===bM.ERROR_REQUEST_ABORTED&&(c="Request aborted")),this.message=c,this.type=t,this.statusCode=e.statusCode||null,this.request=e.request,this.body=o}var Z8=W8;function X8(e){var t=e.indexOf(":"),o=e.substring(0,t).trim().toLowerCase(),c=e.substring(t+1).trim();return{name:o,value:c}}function Y8(e){var t={};return e&&e.trim().split(/[\r|\n]+/).forEach(function(o){var c=X8(o);t[c.name]=c.value}),t}var K8=Y8,J8=q8,xM=Z8,R1=j0,Q8=K8,h0={};function e9(e){var t=h0[e.id];t&&(t.abort(),delete h0[e.id])}function t9(e,t){return new J8(e,{body:t.response,headers:Q8(t.getAllResponseHeaders()),statusCode:t.status})}function wM(e){var t=e.total,o=e.loaded,c=100*o/t;return{total:t,transferred:o,percent:c}}function DO(e,t){return new Promise(function(o,c){t.onprogress=function(y){e.emitter.emit(R1.EVENT_PROGRESS_DOWNLOAD,wM(y))};var d=e.file;d&&(t.upload.onprogress=function(y){e.emitter.emit(R1.EVENT_PROGRESS_UPLOAD,wM(y))}),t.onerror=function(y){c(y)},t.onabort=function(){var y=new xM({request:e,type:R1.ERROR_REQUEST_ABORTED});c(y)},t.onload=function(){if(delete h0[e.id],t.status<200||t.status>=400){var y=new xM({request:e,body:t.response,statusCode:t.status});c(y);return}o(t)};var v=e.body;typeof v=="string"?t.send(v):v?t.send(JSON.stringify(v)):d?t.send(d):t.send(),h0[e.id]=t}).then(function(o){return t9(e,o)})}function OO(e,t){var o=e.url(t),c=new window.XMLHttpRequest;return c.open(e.method,o),Object.keys(e.headers).forEach(function(d){c.setRequestHeader(d,e.headers[d])}),c}function n9(e){return Promise.resolve().then(function(){var t=OO(e,e.client.accessToken);return DO(e,t)})}var i9={browserAbort:e9,sendRequestXhr:DO,browserSend:n9,createRequestXhr:OO},d0={exports:{}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */d0.exports;(function(e,t){(function(o){var c=t,d=e&&e.exports==c&&e,v=typeof ps=="object"&&ps;(v.global===v||v.window===v)&&(o=v);var y=function(W){this.message=W};y.prototype=new Error,y.prototype.name="InvalidCharacterError";var T=function(W){throw new y(W)},r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",D=/[\t\n\f\r ]/g,L=function(W){W=String(W).replace(D,"");var q=W.length;q%4==0&&(W=W.replace(/==?$/,""),q=W.length),(q%4==1||/[^+a-zA-Z0-9/]/.test(W))&&T("Invalid character: the string to be decoded is not correctly encoded.");for(var ne=0,ce,oe,fe="",be=-1;++be<q;)oe=r.indexOf(W.charAt(be)),ce=ne%4?ce*64+oe:oe,ne++%4&&(fe+=String.fromCharCode(255&ce>>(-2*ne&6)));return fe},B=function(W){W=String(W),/[^\0-\xFF]/.test(W)&&T("The string to be encoded contains characters outside of the Latin1 range.");for(var q=W.length%3,ne="",ce=-1,oe,fe,be,ge,Ee=W.length-q;++ce<Ee;)oe=W.charCodeAt(ce)<<16,fe=W.charCodeAt(++ce)<<8,be=W.charCodeAt(++ce),ge=oe+fe+be,ne+=r.charAt(ge>>18&63)+r.charAt(ge>>12&63)+r.charAt(ge>>6&63)+r.charAt(ge&63);return q==2?(oe=W.charCodeAt(ce)<<8,fe=W.charCodeAt(++ce),ge=oe+fe,ne+=r.charAt(ge>>10)+r.charAt(ge>>4&63)+r.charAt(ge<<2&63)+"="):q==1&&(ge=W.charCodeAt(ce),ne+=r.charAt(ge>>2)+r.charAt(ge<<4&63)+"=="),ne},U={encode:B,decode:L,version:"0.1.0"};if(c&&!c.nodeType)if(d)d.exports=U;else for(var $ in U)U.hasOwnProperty($)&&(c[$]=U[$]);else o.base64=U})(ps)})(d0,d0.exports);var r9=d0.exports,o9=r9,D1={};function s9(e){if(D1[e])return D1[e];var t=e.split("."),o=t[0],c=t[1];if(!c)throw new Error("Invalid token");var d=a9(c),v={usage:o,user:d.u};return id(d,"a")&&(v.authorization=d.a),id(d,"exp")&&(v.expires=d.exp*1e3),id(d,"iat")&&(v.created=d.iat*1e3),id(d,"scopes")&&(v.scopes=d.scopes),id(d,"client")&&(v.client=d.client),id(d,"ll")&&(v.lastLogin=d.ll),id(d,"iu")&&(v.impersonator=d.iu),D1[e]=v,v}function a9(e){try{return JSON.parse(o9.decode(e))}catch{throw new Error("Invalid token")}}function id(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var LO=s9,zO={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,o="~";function c(){}Object.create&&(c.prototype=Object.create(null),new c().__proto__||(o=!1));function d(r,D,L){this.fn=r,this.context=D,this.once=L||!1}function v(r,D,L,B,U){if(typeof L!="function")throw new TypeError("The listener must be a function");var $=new d(L,B||r,U),W=o?o+D:D;return r._events[W]?r._events[W].fn?r._events[W]=[r._events[W],$]:r._events[W].push($):(r._events[W]=$,r._eventsCount++),r}function y(r,D){--r._eventsCount===0?r._events=new c:delete r._events[D]}function T(){this._events=new c,this._eventsCount=0}T.prototype.eventNames=function(){var D=[],L,B;if(this._eventsCount===0)return D;for(B in L=this._events)t.call(L,B)&&D.push(o?B.slice(1):B);return Object.getOwnPropertySymbols?D.concat(Object.getOwnPropertySymbols(L)):D},T.prototype.listeners=function(D){var L=o?o+D:D,B=this._events[L];if(!B)return[];if(B.fn)return[B.fn];for(var U=0,$=B.length,W=new Array($);U<$;U++)W[U]=B[U].fn;return W},T.prototype.listenerCount=function(D){var L=o?o+D:D,B=this._events[L];return B?B.fn?1:B.length:0},T.prototype.emit=function(D,L,B,U,$,W){var q=o?o+D:D;if(!this._events[q])return!1;var ne=this._events[q],ce=arguments.length,oe,fe;if(ne.fn){switch(ne.once&&this.removeListener(D,ne.fn,void 0,!0),ce){case 1:return ne.fn.call(ne.context),!0;case 2:return ne.fn.call(ne.context,L),!0;case 3:return ne.fn.call(ne.context,L,B),!0;case 4:return ne.fn.call(ne.context,L,B,U),!0;case 5:return ne.fn.call(ne.context,L,B,U,$),!0;case 6:return ne.fn.call(ne.context,L,B,U,$,W),!0}for(fe=1,oe=new Array(ce-1);fe<ce;fe++)oe[fe-1]=arguments[fe];ne.fn.apply(ne.context,oe)}else{var be=ne.length,ge;for(fe=0;fe<be;fe++)switch(ne[fe].once&&this.removeListener(D,ne[fe].fn,void 0,!0),ce){case 1:ne[fe].fn.call(ne[fe].context);break;case 2:ne[fe].fn.call(ne[fe].context,L);break;case 3:ne[fe].fn.call(ne[fe].context,L,B);break;case 4:ne[fe].fn.call(ne[fe].context,L,B,U);break;default:if(!oe)for(ge=1,oe=new Array(ce-1);ge<ce;ge++)oe[ge-1]=arguments[ge];ne[fe].fn.apply(ne[fe].context,oe)}}return!0},T.prototype.on=function(D,L,B){return v(this,D,L,B,!1)},T.prototype.once=function(D,L,B){return v(this,D,L,B,!0)},T.prototype.removeListener=function(D,L,B,U){var $=o?o+D:D;if(!this._events[$])return this;if(!L)return y(this,$),this;var W=this._events[$];if(W.fn)W.fn===L&&(!U||W.once)&&(!B||W.context===B)&&y(this,$);else{for(var q=0,ne=[],ce=W.length;q<ce;q++)(W[q].fn!==L||U&&!W[q].once||B&&W[q].context!==B)&&ne.push(W[q]);ne.length?this._events[$]=ne.length===1?ne[0]:ne:y(this,$)}return this},T.prototype.removeAllListeners=function(D){var L;return D?(L=o?o+D:D,this._events[L]&&y(this,L)):(this._events=new c,this._eventsCount=0),this},T.prototype.off=T.prototype.removeListener,T.prototype.addListener=T.prototype.on,T.prefixed=o,T.EventEmitter=T,e.exports=T})(zO);var l9=zO.exports;function c9(e){return e.map(encodeURIComponent).join(",")}function BO(e){return Array.isArray(e)?c9(e):encodeURIComponent(String(e))}function FO(e,t,o){if(o===!1||o===null)return e;var c=/\?/.test(e)?"&":"?",d=encodeURIComponent(t);return o!==void 0&&o!==""&&o!==!0&&(d+="="+BO(o)),""+e+c+d}function u9(e,t){if(!t)return e;var o=e;return Object.keys(t).forEach(function(c){var d=t[c];d!==void 0&&(Array.isArray(d)&&(d=d.filter(function(v){return v!=null}).join(",")),o=FO(o,c,d))}),o}function h9(e,t){if(!t||e.slice(0,4)==="http")return e;var o=e[0]==="/"?"":"/";return""+t.replace(/\/$/,"")+o+e}function d9(e,t){return t?e.replace(/\/:([a-zA-Z0-9]+)/g,function(o,c){var d=t[c];if(d===void 0)throw new Error("Unspecified route parameter "+c);var v=BO(d);return"/"+v}):e}var f9={appendQueryObject:u9,appendQueryParam:FO,prependOrigin:h9,interpolateRouteParams:d9},p9=LO,oT=Vp,m9=l9,Iy=f9,SM=j0,g9=1;function sh(e,t){if(!e)throw new Error("MapiRequest requires a client");if(!t||!t.path||!t.method)throw new Error("MapiRequest requires an options object with path and method properties");var o={};t.body&&(o["content-type"]="application/json");var c=oT(o,t.headers),d=Object.keys(c).reduce(function(v,y){return v[y.toLowerCase()]=c[y],v},{});this.id=g9++,this._options=t,this.emitter=new m9,this.client=e,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=t.path,this.method=t.method,this.origin=t.origin||e.origin,this.query=t.query||{},this.params=t.params||{},this.body=t.body||null,this.file=t.file||null,this.encoding=t.encoding||"utf8",this.sendFileAs=t.sendFileAs||null,this.headers=d}sh.prototype.url=function(t){var o=Iy.prependOrigin(this.path,this.origin);o=Iy.appendQueryObject(o,this.query);var c=this.params,d=t??this.client.accessToken;if(d){o=Iy.appendQueryParam(o,"access_token",d);var v=p9(d).user;c=oT({ownerId:v},c)}return o=Iy.interpolateRouteParams(o,c),o};sh.prototype.send=function(){var t=this;if(t.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return t.sent=!0,t.client.sendRequest(t).then(function(o){return t.response=o,t.emitter.emit(SM.EVENT_RESPONSE,o),o},function(o){throw t.error=o,t.emitter.emit(SM.EVENT_ERROR,o),o})};sh.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};sh.prototype.eachPage=function(t){var o=this;function c(y){function T(){delete o._nextPageRequest;var r=y.nextPage();r&&(o._nextPageRequest=r,v(r))}t(null,y,T)}function d(y){t(y,null,function(){})}function v(y){y.send().then(c,d)}v(this)};sh.prototype.clone=function(){return this._extend()};sh.prototype._extend=function(t){var o=oT(this._options,t);return new sh(this.client,o)};var _9=sh,v9=LO,y9=_9,b9=j0;function VO(e){if(!e||!e.accessToken)throw new Error("Cannot create a client without an access token");v9(e.accessToken),this.accessToken=e.accessToken,this.origin=e.origin||b9.API_ORIGIN}VO.prototype.createRequest=function(t){return new y9(this,t)};var NO=VO,UO=i9,jO=NO;function Pp(e){jO.call(this,e)}Pp.prototype=Object.create(jO.prototype);Pp.prototype.constructor=Pp;Pp.prototype.sendRequest=UO.browserSend;Pp.prototype.abortRequest=UO.browserAbort;function x9(e){return new Pp(e)}var $O=x9,w9=$O,S9=w9,T9=Object.prototype.toString,E9=function(e){var t;return T9.call(e)==="[object Object]"&&(t=Object.getPrototypeOf(e),t===null||t===Object.getPrototypeOf({}))},I9=E9,C9=Vp,GO="value",O1=`
  `,ao={};ao.assert=function(e,t){return t=t||{},function(o){var c=ah(e,o);if(c){var d=sT(c,t);throw t.apiName&&(d=t.apiName+": "+d),new Error(d)}}};ao.shape=function(t){var o=k9(t);return function(d){var v=ah(ao.plainObject,d);if(v)return v;for(var y,T,r=[],D=0;D<o.length;D++)y=o[D].key,T=o[D].value,v=ah(T,d[y]),v&&r.push([y].concat(v));return r.length<2?r[0]:function(L){r=r.map(function($){var W=$[0],q=sT($,L).split(`
`).join(O1);return"- "+W+": "+q});var B=L.path.join("."),U=B===GO?"":" of "+B;return"The following properties"+U+" have invalid values:"+O1+r.join(O1)}}};ao.strictShape=function(t){var o=ao.shape(t);return function(d){var v=o(d);if(v)return v;var y=Object.keys(d).reduce(function(T,r){return t[r]===void 0&&T.push(r),T},[]);if(y.length!==0)return function(){return"The following keys are invalid: "+y.join(", ")}}};ao.arrayOf=function(t){return HO(t)};ao.tuple=function(){var t=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return HO(t)};function HO(e){var t=Array.isArray(e),o=function(c){return t?e[c]:e};return function(d){var v=ah(ao.plainArray,d);if(v)return v;if(t&&d.length!==e.length)return"an array with "+e.length+" items";for(var y=0;y<d.length;y++)if(v=ah(o(y),d[y]),v)return[y].concat(v)}}ao.required=function(t){function o(c){return c==null?function(d){return qO(d,WO(d.path)?"cannot be undefined/null.":"is required.")}:t.apply(this,arguments)}return o.__required=!0,o};ao.oneOfType=function(){var t=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(c){var d=t.map(function(v){return ah(v,c)}).filter(Boolean);if(d.length===t.length)return d.every(function(v){return v.length===1&&typeof v[0]=="string"})?A9(d.map(function(v){return v[0]})):d.reduce(function(v,y){return y.length>v.length?y:v})}};ao.equal=function(t){return function(c){if(c!==t)return JSON.stringify(t)}};ao.oneOf=function(){var t=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),o=t.map(function(c){return ao.equal(c)});return ao.oneOfType.apply(this,o)};ao.range=function(t){var o=t[0],c=t[1];return function(v){var y=ah(ao.number,v);if(y||v<o||v>c)return"number between "+o+" & "+c+" (inclusive)"}};ao.any=function(){};ao.boolean=function(t){if(typeof t!="boolean")return"boolean"};ao.number=function(t){if(typeof t!="number")return"number"};ao.plainArray=function(t){if(!Array.isArray(t))return"array"};ao.plainObject=function(t){if(!I9(t))return"object"};ao.string=function(t){if(typeof t!="string")return"string"};ao.func=function(t){if(typeof t!="function")return"function"};function ah(e,t){if(!(t==null&&!e.hasOwnProperty("__required"))){var o=e(t);if(o)return Array.isArray(o)?o:[o]}}function sT(e,t){var o=e.length,c=e[o-1],d=e.slice(0,o-1);return d.length===0&&(d=[GO]),t=C9(t,{path:d}),typeof c=="function"?c(t):qO(t,P9(c))}function A9(e){return e.length<2?e[0]:e.length===2?e.join(" or "):e.slice(0,-1).join(", ")+", or "+e.slice(-1)}function P9(e){return"must be "+M9(e)+"."}function M9(e){return/^an? /.test(e)?e:/^[aeiou]/i.test(e)?"an "+e:/^[a-z]/i.test(e)?"a "+e:e}function qO(e,t){var o=WO(e.path),c=e.path.join(".")+" "+t,d=o?"Item at position ":"";return d+c}function WO(e){return typeof e[e.length-1]=="number"||typeof e[0]=="number"}function k9(e){return Object.keys(e||{}).map(function(t){return{key:t,value:e[t]}})}ao.validate=ah;ao.processMessage=sT;var R9=ao,D9=Vp,wp=R9;function O9(e){if(typeof window<"u")return e instanceof ps.Blob||e instanceof ps.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof e=="string"||e.pipe!==void 0))return"Filename or Readable stream"}function L9(e,t){return wp.assert(wp.strictShape(e),t)}function z9(e){var t="date";if(typeof e=="boolean")return t;try{var o=new Date(e);if(o.getTime&&isNaN(o.getTime()))return t}catch{return t}}function B9(e){return wp.tuple(wp.number,wp.number)(e)}var F9=D9(wp,{file:O9,date:z9,coordinates:B9,assertShape:L9});function V9(e,t){var o=function(c,d){return t.indexOf(c)!==-1&&d!==void 0};return typeof t=="function"&&(o=t),Object.keys(e).filter(function(c){return o(c,e[c])}).reduce(function(c,d){return c[d]=e[d],c},{})}var N9=V9;function U9(e,t){return Object.keys(e).reduce(function(o,c){return o[c]=t(c,e[c]),o},{})}var j9=U9,$9=j9;function G9(e){return $9(e,function(t,o){return typeof o=="boolean"?JSON.stringify(o):o})}var H9=G9,q9=NO,W9=$O;function Z9(e){return function(t){var o;q9.prototype.isPrototypeOf(t)?o=t:o=W9(t);var c=Object.create(e);return c.client=o,c}}var X9=Z9,ZO=Vp,rr=F9,f0=N9,XO=H9,Y9=X9,aT={},YO=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];aT.forwardGeocode=function(e){rr.assertShape({query:rr.required(rr.string),mode:rr.oneOf("mapbox.places","mapbox.places-permanent"),countries:rr.arrayOf(rr.string),proximity:rr.oneOf(rr.coordinates,"ip"),types:rr.arrayOf(rr.oneOf(YO)),autocomplete:rr.boolean,bbox:rr.arrayOf(rr.number),limit:rr.number,language:rr.arrayOf(rr.string),routing:rr.boolean,fuzzyMatch:rr.boolean,worldview:rr.string,session_token:rr.string})(e),e.mode=e.mode||"mapbox.places";var t=XO(ZO({country:e.countries},f0(e,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview","session_token"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:f0(e,["mode","query"]),query:t})};aT.reverseGeocode=function(e){rr.assertShape({query:rr.required(rr.coordinates),mode:rr.oneOf("mapbox.places","mapbox.places-permanent"),countries:rr.arrayOf(rr.string),types:rr.arrayOf(rr.oneOf(YO)),bbox:rr.arrayOf(rr.number),limit:rr.number,language:rr.arrayOf(rr.string),reverseMode:rr.oneOf("distance","score"),routing:rr.boolean,worldview:rr.string,session_token:rr.string})(e),e.mode=e.mode||"mapbox.places";var t=XO(ZO({country:e.countries},f0(e,["country","types","bbox","limit","language","reverseMode","routing","worldview","session_token"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:f0(e,["mode","query"]),query:t})};var K9=Y9(aT);let J9="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",KO=e=>crypto.getRandomValues(new Uint8Array(e)),JO=(e,t,o)=>{let c=(2<<Math.log(e.length-1)/Math.LN2)-1,d=-~(1.6*c*t/e.length);return(v=t)=>{let y="";for(;;){let T=o(d),r=d;for(;r--;)if(y+=e[T[r]&c]||"",y.length===v)return y}}},Q9=(e,t=21)=>JO(e,t,KO),eH=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((t,o)=>(o&=63,o<36?t+=o.toString(36):o<62?t+=(o-26).toString(36).toUpperCase():o>62?t+="-":t+="_",t),"");const tH=Object.freeze(Object.defineProperty({__proto__:null,customAlphabet:Q9,customRandom:JO,nanoid:eH,random:KO,urlAlphabet:J9},Symbol.toStringTag,{value:"Module"})),nH=r8(tH);var iH=nH.nanoid;function QO(e){this.origin=e.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=e.accessToken,this.version="0.3.0",this.pluginSessionID=this.generateSessionID(),this.sessionIncrementer=0,this.userAgent=this.getUserAgent(),this.options=e,this.send=this.send.bind(this),this.countries=e.countries?e.countries.split(","):null,this.types=e.types?e.types.split(","):null,this.bbox=e.bbox?e.bbox:null,this.language=e.language?e.language.split(","):null,this.limit=e.limit?+e.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(e),this.eventQueue=new Array,this.flushInterval=e.flushInterval||1e3,this.maxQueueSize=e.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}QO.prototype={select:function(e,t){var o=this.getEventPayload("search.select",t,{selectedFeature:e});if(o&&!(o.resultIndex===this.lastSentIndex&&o.queryString===this.lastSentInput||o.resultIndex==-1))return this.lastSentIndex=o.resultIndex,this.lastSentInput=o.queryString,this.push(o)},start:function(e){var t=this.getEventPayload("search.start",e);if(t)return this.push(t)},keyevent:function(e,t){if(e.key&&!(e.metaKey||[9,27,37,39,13,38,40].indexOf(e.keyCode)!==-1)){var o=this.getEventPayload("search.keystroke",t,{key:e.key});if(o)return this.push(o)}},send:function(e,t){if(!this.enableEventLogging)return t?t():void 0;var o=this.getRequestOptions(e);this.request(o,(function(c){if(c)return this.handleError(c,t);if(t)return t()}).bind(this))},getRequestOptions:function(e){Array.isArray(e)||(e=[e]);var t={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};return t},getEventPayload:function(e,t,o={}){if(e==="search.select"&&!o.selectedFeature||e==="search.keystroke"&&!o.key)return null;var c;if(!t.options.proximity)c=null;else if(typeof t.options.proximity=="object")c=[t.options.proximity.longitude,t.options.proximity.latitude];else if(t.options.proximity==="ip"){var d=t._headers?t._headers["ip-proximity"]:null;d&&typeof d=="string"?c=d.split(",").map(parseFloat):c=[999,999]}else c=t.options.proximity;var v=t._map?t._map.getZoom():void 0,y={event:e,version:this.getEventSchemaVersion(e),created:+new Date,sessionIdentifier:this.getSessionId(),country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:t.options.autocomplete,fuzzyMatch:t.options.fuzzyMatch,proximity:c,limit:t.options.limit,routing:t.options.routing,worldview:t.options.worldview,mapZoom:v,keyboardLocale:this.locale};if(e==="search.select"?y.queryString=t.inputString:e!="search.select"&&t._inputEl?y.queryString=t._inputEl.value:y.queryString=t.inputString,["search.keystroke","search.select"].includes(e)&&(y.path="geocoding/v5/mapbox.places"),e==="search.keystroke"&&o.key)y.lastAction=o.key;else if(e==="search.select"&&o.selectedFeature){var T=o.selectedFeature,r=this.getSelectedIndex(T,t);if(y.resultIndex=r,y.resultPlaceName=T.place_name,y.resultId=T.id,T.properties&&(y.resultMapboxId=T.properties.mapbox_id),t._typeahead){var D=t._typeahead.data;D&&D.length>0&&(y.suggestionIds=this.getSuggestionIds(D),y.suggestionNames=this.getSuggestionNames(D),y.suggestionTypes=this.getSuggestionTypes(D),y.suggestionSources=this.getSuggestionSources(D))}}return this.validatePayload(y)?y:null},request:function(e,t){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(this.readyState==4)return this.status==204?t(null):t(this.statusText)},o.open(e.method,e.host+"/"+e.path,!0);for(var c in e.headers){var d=e.headers[c];o.setRequestHeader(c,d)}o.send(e.body)},handleError:function(e,t){if(t)return t(e)},generateSessionID:function(){return iH()},getSessionId:function(){return this.pluginSessionID+"."+this.sessionIncrementer},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(e,t){if(t._typeahead){var o=t._typeahead.data,c=e.id,d=o.map(function(y){return y.id}),v=d.indexOf(c);return v}},getSuggestionIds:function(e){return e.map(function(t){return t.properties?t.properties.mapbox_id||"":t.id||""})},getSuggestionNames:function(e){return e.map(function(t){return t.place_name||""})},getSuggestionTypes:function(e){return e.map(function(t){return t.place_type&&Array.isArray(t.place_type)&&t.place_type[0]||""})},getSuggestionSources:function(e){return e.map(function(t){return t._source||""})},getEventSchemaVersion:function(e){return["search.keystroke","search.select"].includes(e)?"2.2":"2.0"},validatePayload:function(e){if(!e||!e.event)return!1;var t=["event","created","sessionIdentifier","queryString"],o=["event","created","sessionIdentifier","queryString","lastAction"],c=["event","created","sessionIdentifier","queryString","resultIndex","path","suggestionIds"],d=e.event;return d==="search.start"?this.objectHasRequiredProps(e,t):d==="search.keystroke"?this.objectHasRequiredProps(e,o):d==="search.select"?this.objectHasRequiredProps(e,c):!0},objectHasRequiredProps:function(e,t){return t.every(function(o){return o==="queryString"?typeof e[o]=="string"&&e[o].length>0:e[o]!==void 0})},shouldEnableLogging:function(e){return!(e.enableEventLogging===!1||e.origin&&e.origin!=="https://api.mapbox.com")},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(e,t){this.eventQueue.push(e),(this.eventQueue.length>=this.maxQueueSize||t)&&this.flush()},remove:function(){this.flush()}};var rH=QO,oH={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"",ja:"",lv:"Meklt",pt:"Procurar",sr:"",zh:"",cs:"Vyhledvn",hu:"Keress",ka:"",nb:"Ske",sk:"Vyhadvanie",th:"",fi:"Hae",is:"Leita",ko:"",pl:"Szukaj",sl:"Iskanje",fa:"",ru:""},sH={placeholder:oH},eL={exports:{}};(function(e){(function(t,o,c){e.exports?e.exports=c():t[o]=c()})(ps,"subtag",function(){var t="",o=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function c(r){return r.match(o)||[]}function d(r){return c(r).filter(function(D,L){return D&&L})}function v(r){return r=c(r),{language:r[1]||t,extlang:r[2]||t,script:r[3]||t,region:r[4]||t}}function y(r,D,L){Object.defineProperty(r,D,{value:L,enumerable:!0})}function T(r,D,L){function B(U){return c(U)[r]||t}y(B,"pattern",D),y(v,L,B)}return T(1,/^[a-zA-Z]{2,3}$/,"language"),T(2,/^[a-zA-Z]{3}$/,"extlang"),T(3,/^[a-zA-Z]{4}$/,"script"),T(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),y(v,"split",d),v})})(eL);var aH=eL.exports;function tL(){}tL.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){const e={enableHighAccuracy:!0};return new Promise(function(t,o){window.navigator.geolocation.getCurrentPosition(t,o,e)})}};var lH=tL;function cH(e,t){const o=nL(e),c=["address","street","place","country"];var d;if(typeof t=="function")return t(o);const v=c.indexOf(t);return v===-1?d=c:d=c.slice(v),d.reduce(function(y,T){return o[T]?(y!==""&&(y=y+", "),y+o[T]):y},"")}function nL(e){const t=e.address||"",o=e.text||"",c=e.place_name||"",v={address:c.split(",")[0],houseNumber:t,street:o,placeName:c};return e.context.forEach(function(y){const T=y.id.split(".")[0];v[T]=y.text}),v}const uH=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/;var hH={transformFeatureToGeolocationText:cH,getAddressInfo:nL,REVERSE_GEOCODE_COORD_RGX:uH},dH=p8,fH=R8,ld=Vp,pH=V8.EventEmitter,TM=N8,L1=S9,z1=K9,mH=rH,gH=sH,_H=aH,vH=lH,EM=hH;const Gu={FORWARD:0,LOCAL:1,REVERSE:2};function yH(){var e=document.createElement("div");return e.className="mapboxgl-ctrl-geocoder--powered-by",e.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',e}function iL(e){this._eventEmitter=new pH,this.options=ld({},this.options,e),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new vH}iL.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(e){return e.place_name},render:function(e){var t=e.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+t[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+t.splice(1,t.length).join(",")+"</div></div>"}},_headers:{},addTo:function(e){function t(o,c){if(!document.body.contains(c))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const d=o.onAdd();c.appendChild(d)}if(e._controlContainer)e.addControl(this);else if(e instanceof HTMLElement)t(this,e);else if(typeof e=="string"){const o=document.querySelectorAll(e);if(o.length===0)throw new Error("Element ",e,"not found.");if(o.length>1)throw new Error("Geocoder can only be added to a single html element");t(this,o[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(e){if(e&&typeof e!="string"&&(this._map=e),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=z1(L1({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new mH(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var t=this.container=document.createElement("div");t.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var o=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",fH(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",(function(D){this.eventManager.keyevent(D,this)}).bind(this));var c=document.createElement("div");c.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var d=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(d),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),c.appendChild(this._clearEl),c.appendChild(this._loadingEl),t.appendChild(o),t.appendChild(this._inputEl),t.appendChild(c),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var v=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(v),c.appendChild(this._geolocateEl),this._showGeolocateButton()}var y=this._typeahead=new dH(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),y.getItemValue=this.options.getItemValue;var T=y.list.draw,r=this._footerNode=yH();return y.list.draw=function(){T.call(this),r.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),r.addEventListener("mouseup",(function(){this.selectingListItem=!1}).bind(this)),this.element.appendChild(r)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),t},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then((function(e){this._hideLoadingIcon();const t={geometry:{type:"Point",coordinates:[e.coords.longitude,e.coords.latitude]}};this._handleMarker(t),this._fly(t),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(t),this._showClearButton(),this.fresh=!1;const o={limit:1,language:[this.options.language],query:t.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){const c=t.geometry.coordinates[0]+","+t.geometry.coordinates[1];this._setInputValue(c),this._eventEmitter.emit("result",{result:t})}else this.geocoderService.reverseGeocode(o).send().then((function(c){const d=c.body.features[0];if(d){const v=EM.transformFeatureToGeolocationText(d,this.options.addressAccuracy);this._setInputValue(v),d.user_coordinates=t.geometry.coordinates,this._eventEmitter.emit("result",{result:d})}else this._eventEmitter.emit("result",{result:{user_coordinates:t.geometry.coordinates}})}).bind(this))}).bind(this)).catch((function(e){e.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}).bind(this))},createIcon:function(e,t){var o=document.createElementNS("http://www.w3.org/2000/svg","svg");return o.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+e),o.setAttribute("viewBox","0 0 18 18"),o.setAttribute("xml:space","preserve"),o.setAttribute("width",18),o.setAttribute("height",18),o.innerHTML=t,o},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(e){this._inputEl.value=e,setTimeout((function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}).bind(this),1)},_onPaste:function(e){var t=(e.clipboardData||window.clipboardData).getData("text");t.length>=this.options.minLength&&this._geocode(t)},_onKeyDown:function(e){var t=27,o=9;if(e.keyCode===t&&this.options.clearAndBlurOnEsc)return this._clear(e),this._inputEl.blur();var c=e.target&&e.target.shadowRoot?e.target.shadowRoot.activeElement:e.target,d=c?c.value:"";if(!d)return this.fresh=!0,e.keyCode!==o&&this.clear(e),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(e.metaKey||[o,t,37,39,13,38,40].indexOf(e.keyCode)!==-1)&&c.value.length>=this.options.minLength&&this._geocode(c.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(e){this.options.clearOnBlur&&this._clearOnBlur(e),this.options.collapsed&&this._collapse()},_onChange:function(){var e=this._typeahead.selected;e&&JSON.stringify(e)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(e),this.options.marker&&this._mapboxgl&&this._handleMarker(e),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(e),this._eventEmitter.emit("result",{result:e}),this.eventManager.select(e,this))},_fly:function(e){var t;if(e.properties&&TM[e.properties.short_code])t=ld({},this.options.flyTo),this._map&&this._map.fitBounds(TM[e.properties.short_code].bbox,t);else if(e.bbox){var o=e.bbox;t=ld({},this.options.flyTo),this._map&&this._map.fitBounds([[o[0],o[1]],[o[2],o[3]]],t)}else{var c={zoom:this.options.zoom};t=ld({},c,this.options.flyTo),e.center?t.center=e.center:e.geometry&&e.geometry.type&&e.geometry.type==="Point"&&e.geometry.coordinates&&(t.center=e.geometry.coordinates),this._map&&this._map.flyTo(t)}},_requestType:function(e,t){var o;return e.localGeocoderOnly?o=Gu.LOCAL:e.reverseGeocode&&EM.REVERSE_GEOCODE_COORD_RGX.test(t)?o=Gu.REVERSE:o=Gu.FORWARD,o},_setupConfig:function(e,t){const o=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],c=/[\s,]+/;var d=this,v=o.reduce(function(T,r){if(d.options[r]===void 0||d.options[r]===null)return T;["countries","types","language"].indexOf(r)>-1?T[r]=d.options[r].split(c):T[r]=d.options[r];const D=typeof d.options[r].longitude=="number"&&typeof d.options[r].latitude=="number";if(r==="proximity"&&D){const L=d.options[r].longitude,B=d.options[r].latitude;T[r]=[L,B]}return T},{});switch(e){case Gu.REVERSE:{var y=t.split(c).map(function(T){return parseFloat(T,10)});d.options.flipCoordinates||y.reverse(),v.types&&v.types[0],v=ld(v,{query:y,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(T){T in v&&delete v[T]})}break;case Gu.FORWARD:{const T=t.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(T)&&(t=t.replace(/,/g," ")),v=ld(v,{query:t})}break}return v.session_token=this.eventManager.getSessionId(),v},_geocode:function(e){this.inputString=e,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:e});const t=this._requestType(this.options,e),o=this._setupConfig(t,e);var c;switch(t){case Gu.LOCAL:c=Promise.resolve();break;case Gu.FORWARD:c=this.geocoderService.forwardGeocode(o).send();break;case Gu.REVERSE:c=this.geocoderService.reverseGeocode(o).send();break}var d=this.options.localGeocoder?this.options.localGeocoder(e)||[]:[],v=[],y=null;return c.catch((function(T){y=T}).bind(this)).then((function(T){this._hideLoadingIcon();var r={};return T?T.statusCode=="200"&&(r=T.body,r.request=T.request,r.headers=T.headers,this._headers=T.headers):r={type:"FeatureCollection",features:[]},r.config=o,this.fresh&&(this.eventManager.start(this),this.fresh=!1),r.features&&r.features.length&&r.features.map(function(D){D._source="mapbox"}),r.features=r.features?d.concat(r.features):d,this.options.externalGeocoder?(v=this.options.externalGeocoder(e,r.features)||Promise.resolve([]),v.then(function(D){return r.features=r.features?D.concat(r.features):D,r},function(){return r})):r}).bind(this)).then((function(T){if(y)throw y;this.options.filter&&T.features.length&&(T.features=T.features.filter(this.options.filter)),T.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",T),this._typeahead.update(T.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",T))}).bind(this)).catch((function(T){this._hideLoadingIcon(),this._hideAttribution(),d.length&&this.options.localGeocoder||v.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(d)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:d}),this._eventEmitter.emit("error",{error:T})}).bind(this)),c},_clear:function(e){e&&e.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this.eventManager.sessionIncrementer++,this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(e){this._clear(e),this._inputEl.focus()},_clearOnBlur:function(e){var t=this;e.relatedTarget&&t._clear(e)},_onQueryResult:function(e){var t=e.body;if(t.features.length){var o=t.features[0];this._typeahead.selected=o,this._inputEl.value=o.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var e=this._map.getCenter().wrap();this.setProximity({longitude:e.lng,latitude:e.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(e){return this._geocode(e).then(this._onQueryResult),this},_renderError:function(){var e="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(e)},_renderLocationError:function(){var e="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(e)},_renderNoResults:function(){var e="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(e)},_renderUserDeniedGeolocationError:function(){var e="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(e)},_renderMessage:function(e){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(e)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var e=this.options.language.split(",")[0],t=_H.language(e),o=gH.placeholder[t];if(o)return o}return"Search"},setInput:function(e,t){return t===void 0&&(t=!1),this._inputEl.value=e,this._typeahead.selected=null,this._typeahead.clear(),e.length>=this.options.minLength&&(t?this._geocode(e):this._onChange()),this},setProximity:function(e,t=!0){return this.options.proximity=e,t&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(e){return e&&typeof e=="function"&&(this._typeahead.render=e),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(e){var t=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=e||this.options.language||t,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(e){return this.options.zoom=e,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(e){return this.options.flyTo=e,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(e){return this.options.placeholder=e||this._getPlaceholderText(),this._inputEl.placeholder=this.options.placeholder,this._inputEl.setAttribute("aria-label",this.options.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(e){return this.options.bbox=e,this},getCountries:function(){return this.options.countries},setCountries:function(e){return this.options.countries=e,this},getTypes:function(){return this.options.types},setTypes:function(e){return this.options.types=e,this},getMinLength:function(){return this.options.minLength},setMinLength:function(e){return this.options.minLength=e,this._typeahead&&(this._typeahead.options.minLength=e),this},getLimit:function(){return this.options.limit},setLimit:function(e){return this.options.limit=e,this._typeahead&&(this._typeahead.options.limit=e),this},getFilter:function(){return this.options.filter},setFilter:function(e){return this.options.filter=e,this},setOrigin:function(e){return this.options.origin=e,this.geocoderService=z1(L1({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(e){return this.options.accessToken=e,this.geocoderService=z1(L1({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(e){return this.options.autocomplete=e,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(e){return this.options.fuzzyMatch=e,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(e){return this.options.routing=e,this},getRouting:function(){return this.options.routing},setWorldview:function(e){return this.options.worldview=e,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(e){if(this._map){this._removeMarker();var t={color:"#4668F2"},o=ld({},t,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(o),e.center?this.mapMarker.setLngLat(e.center).addTo(this._map):e.geometry&&e.geometry.type&&e.geometry.type==="Point"&&e.geometry.coordinates&&this.mapMarker.setLngLat(e.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(e,t){return this._eventEmitter.on(e,t),this},off:function(e,t){return this._eventEmitter.removeListener(e,t),this.eventManager.remove(),this}};var bH=iL;const xH=nT(bH);function Cy(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var rL={exports:{}};(function(e,t){(function(o){e.exports=o()})(function(){return function(){function o(c,d,v){function y(D,L){if(!d[D]){if(!c[D]){var B=typeof Cy=="function"&&Cy;if(!L&&B)return B(D,!0);if(T)return T(D,!0);var U=new Error("Cannot find module '"+D+"'");throw U.code="MODULE_NOT_FOUND",U}var $=d[D]={exports:{}};c[D][0].call($.exports,function(W){var q=c[D][1][W];return y(q||W)},$,$.exports,o,c,d,v)}return d[D].exports}for(var T=typeof Cy=="function"&&Cy,r=0;r<v.length;r++)y(v[r]);return y}return o}()({1:[function(o,c,d){var v=o("./toPropertyKey.js");function y(T,r,D){return r=v(r),r in T?Object.defineProperty(T,r,{value:D,enumerable:!0,configurable:!0,writable:!0}):T[r]=D,T}c.exports=y,c.exports.__esModule=!0,c.exports.default=c.exports},{"./toPropertyKey.js":4}],2:[function(o,c,d){var v=o("./defineProperty.js");function y(r,D){var L=Object.keys(r);if(Object.getOwnPropertySymbols){var B=Object.getOwnPropertySymbols(r);D&&(B=B.filter(function(U){return Object.getOwnPropertyDescriptor(r,U).enumerable})),L.push.apply(L,B)}return L}function T(r){for(var D=1;D<arguments.length;D++){var L=arguments[D]!=null?arguments[D]:{};D%2?y(Object(L),!0).forEach(function(B){v(r,B,L[B])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(L)):y(Object(L)).forEach(function(B){Object.defineProperty(r,B,Object.getOwnPropertyDescriptor(L,B))})}return r}c.exports=T,c.exports.__esModule=!0,c.exports.default=c.exports},{"./defineProperty.js":1}],3:[function(o,c,d){var v=o("./typeof.js").default;function y(T,r){if(v(T)!=="object"||T===null)return T;var D=T[Symbol.toPrimitive];if(D!==void 0){var L=D.call(T,r||"default");if(v(L)!=="object")return L;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(T)}c.exports=y,c.exports.__esModule=!0,c.exports.default=c.exports},{"./typeof.js":5}],4:[function(o,c,d){var v=o("./typeof.js").default,y=o("./toPrimitive.js");function T(r){var D=y(r,"string");return v(D)==="symbol"?D:String(D)}c.exports=T,c.exports.__esModule=!0,c.exports.default=c.exports},{"./toPrimitive.js":3,"./typeof.js":5}],5:[function(o,c,d){function v(y){"@babel/helpers - typeof";return c.exports=v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},c.exports.__esModule=!0,c.exports.default=c.exports,v(y)}c.exports=v,c.exports.__esModule=!0,c.exports.default=c.exports},{}],6:[function(o,c,d){var v={};function y(D){return Math.floor(Math.abs(D)+.5)*(D>=0?1:-1)}function T(D,L,B){D=y(D*B),L=y(L*B);var U=D-L;U<<=1,D-L<0&&(U=~U);for(var $="";U>=32;)$+=String.fromCharCode((32|U&31)+63),U>>=5;return $+=String.fromCharCode(U+63),$}v.decode=function(D,L){for(var B=0,U=0,$=0,W=[],q=0,ne=0,ce=null,oe,fe,be=Math.pow(10,Number.isInteger(L)?L:5);B<D.length;){ce=null,q=0,ne=0;do ce=D.charCodeAt(B++)-63,ne|=(ce&31)<<q,q+=5;while(ce>=32);oe=ne&1?~(ne>>1):ne>>1,q=ne=0;do ce=D.charCodeAt(B++)-63,ne|=(ce&31)<<q,q+=5;while(ce>=32);fe=ne&1?~(ne>>1):ne>>1,U+=oe,$+=fe,W.push([U/be,$/be])}return W},v.encode=function(D,L){if(!D.length)return"";for(var B=Math.pow(10,Number.isInteger(L)?L:5),U=T(D[0][0],0,B)+T(D[0][1],0,B),$=1;$<D.length;$++){var W=D[$],q=D[$-1];U+=T(W[0],q[0],B),U+=T(W[1],q[1],B)}return U};function r(D){for(var L=[],B=0;B<D.length;B++){var U=D[B].slice();L.push([U[1],U[0]])}return L}v.fromGeoJSON=function(D,L){if(D&&D.type==="Feature"&&(D=D.geometry),!D||D.type!=="LineString")throw new Error("Input must be a GeoJSON LineString");return v.encode(r(D.coordinates),L)},v.toGeoJSON=function(D,L){var B=v.decode(D,L);return{type:"LineString",coordinates:r(B)}},typeof c=="object"&&c.exports&&(c.exports=v)},{}],7:[function(o,c,d){var v=typeof Reflect=="object"?Reflect:null,y=v&&typeof v.apply=="function"?v.apply:function(ie,te,ae){return Function.prototype.apply.call(ie,te,ae)},T;v&&typeof v.ownKeys=="function"?T=v.ownKeys:Object.getOwnPropertySymbols?T=function(ie){return Object.getOwnPropertyNames(ie).concat(Object.getOwnPropertySymbols(ie))}:T=function(ie){return Object.getOwnPropertyNames(ie)};function r(Y){console&&console.warn&&console.warn(Y)}var D=Number.isNaN||function(ie){return ie!==ie};function L(){L.init.call(this)}c.exports=L,c.exports.once=Ee,L.EventEmitter=L,L.prototype._events=void 0,L.prototype._eventsCount=0,L.prototype._maxListeners=void 0;var B=10;function U(Y){if(typeof Y!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof Y)}Object.defineProperty(L,"defaultMaxListeners",{enumerable:!0,get:function(){return B},set:function(Y){if(typeof Y!="number"||Y<0||D(Y))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+Y+".");B=Y}}),L.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},L.prototype.setMaxListeners=function(ie){if(typeof ie!="number"||ie<0||D(ie))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+ie+".");return this._maxListeners=ie,this};function $(Y){return Y._maxListeners===void 0?L.defaultMaxListeners:Y._maxListeners}L.prototype.getMaxListeners=function(){return $(this)},L.prototype.emit=function(ie){for(var te=[],ae=1;ae<arguments.length;ae++)te.push(arguments[ae]);var pe=ie==="error",Le=this._events;if(Le!==void 0)pe=pe&&Le.error===void 0;else if(!pe)return!1;if(pe){var tt;if(te.length>0&&(tt=te[0]),tt instanceof Error)throw tt;var Je=new Error("Unhandled error."+(tt?" ("+tt.message+")":""));throw Je.context=tt,Je}var Mt=Le[ie];if(Mt===void 0)return!1;if(typeof Mt=="function")y(Mt,this,te);else for(var Lt=Mt.length,yt=fe(Mt,Lt),ae=0;ae<Lt;++ae)y(yt[ae],this,te);return!0};function W(Y,ie,te,ae){var pe,Le,tt;if(U(te),Le=Y._events,Le===void 0?(Le=Y._events=Object.create(null),Y._eventsCount=0):(Le.newListener!==void 0&&(Y.emit("newListener",ie,te.listener?te.listener:te),Le=Y._events),tt=Le[ie]),tt===void 0)tt=Le[ie]=te,++Y._eventsCount;else if(typeof tt=="function"?tt=Le[ie]=ae?[te,tt]:[tt,te]:ae?tt.unshift(te):tt.push(te),pe=$(Y),pe>0&&tt.length>pe&&!tt.warned){tt.warned=!0;var Je=new Error("Possible EventEmitter memory leak detected. "+tt.length+" "+String(ie)+" listeners added. Use emitter.setMaxListeners() to increase limit");Je.name="MaxListenersExceededWarning",Je.emitter=Y,Je.type=ie,Je.count=tt.length,r(Je)}return Y}L.prototype.addListener=function(ie,te){return W(this,ie,te,!1)},L.prototype.on=L.prototype.addListener,L.prototype.prependListener=function(ie,te){return W(this,ie,te,!0)};function q(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function ne(Y,ie,te){var ae={fired:!1,wrapFn:void 0,target:Y,type:ie,listener:te},pe=q.bind(ae);return pe.listener=te,ae.wrapFn=pe,pe}L.prototype.once=function(ie,te){return U(te),this.on(ie,ne(this,ie,te)),this},L.prototype.prependOnceListener=function(ie,te){return U(te),this.prependListener(ie,ne(this,ie,te)),this},L.prototype.removeListener=function(ie,te){var ae,pe,Le,tt,Je;if(U(te),pe=this._events,pe===void 0)return this;if(ae=pe[ie],ae===void 0)return this;if(ae===te||ae.listener===te)--this._eventsCount===0?this._events=Object.create(null):(delete pe[ie],pe.removeListener&&this.emit("removeListener",ie,ae.listener||te));else if(typeof ae!="function"){for(Le=-1,tt=ae.length-1;tt>=0;tt--)if(ae[tt]===te||ae[tt].listener===te){Je=ae[tt].listener,Le=tt;break}if(Le<0)return this;Le===0?ae.shift():be(ae,Le),ae.length===1&&(pe[ie]=ae[0]),pe.removeListener!==void 0&&this.emit("removeListener",ie,Je||te)}return this},L.prototype.off=L.prototype.removeListener,L.prototype.removeAllListeners=function(ie){var te,ae,pe;if(ae=this._events,ae===void 0)return this;if(ae.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):ae[ie]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete ae[ie]),this;if(arguments.length===0){var Le=Object.keys(ae),tt;for(pe=0;pe<Le.length;++pe)tt=Le[pe],tt!=="removeListener"&&this.removeAllListeners(tt);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(te=ae[ie],typeof te=="function")this.removeListener(ie,te);else if(te!==void 0)for(pe=te.length-1;pe>=0;pe--)this.removeListener(ie,te[pe]);return this};function ce(Y,ie,te){var ae=Y._events;if(ae===void 0)return[];var pe=ae[ie];return pe===void 0?[]:typeof pe=="function"?te?[pe.listener||pe]:[pe]:te?ge(pe):fe(pe,pe.length)}L.prototype.listeners=function(ie){return ce(this,ie,!0)},L.prototype.rawListeners=function(ie){return ce(this,ie,!1)},L.listenerCount=function(Y,ie){return typeof Y.listenerCount=="function"?Y.listenerCount(ie):oe.call(Y,ie)},L.prototype.listenerCount=oe;function oe(Y){var ie=this._events;if(ie!==void 0){var te=ie[Y];if(typeof te=="function")return 1;if(te!==void 0)return te.length}return 0}L.prototype.eventNames=function(){return this._eventsCount>0?T(this._events):[]};function fe(Y,ie){for(var te=new Array(ie),ae=0;ae<ie;++ae)te[ae]=Y[ae];return te}function be(Y,ie){for(;ie+1<Y.length;ie++)Y[ie]=Y[ie+1];Y.pop()}function ge(Y){for(var ie=new Array(Y.length),te=0;te<ie.length;++te)ie[te]=Y[te].listener||Y[te];return ie}function Ee(Y,ie){return new Promise(function(te,ae){function pe(tt){Y.removeListener(ie,Le),ae(tt)}function Le(){typeof Y.removeListener=="function"&&Y.removeListener("error",pe),te([].slice.call(arguments))}re(Y,ie,Le,{once:!0}),ie!=="error"&&de(Y,pe,{once:!0})})}function de(Y,ie,te){typeof Y.on=="function"&&re(Y,"error",ie,te)}function re(Y,ie,te,ae){if(typeof Y.on=="function")ae.once?Y.once(ie,te):Y.on(ie,te);else if(typeof Y.addEventListener=="function")Y.addEventListener(ie,function pe(Le){ae.once&&Y.removeEventListener(ie,pe),te(Le)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof Y)}},{}],8:[function(o,c,d){(function(){var v=this,y={};typeof d<"u"?c.exports=y:v.fuzzy=y,y.simpleFilter=function(T,r){return r.filter(function(D){return y.test(T,D)})},y.test=function(T,r){return y.match(T,r)!==null},y.match=function(T,r,D){D=D||{};var L=0,B=[],U=r.length,$=0,W=0,q=D.pre||"",ne=D.post||"",ce=D.caseSensitive&&r||r.toLowerCase(),oe;T=D.caseSensitive&&T||T.toLowerCase();for(var fe=0;fe<U;fe++)oe=r[fe],ce[fe]===T[L]?(oe=q+oe+ne,L+=1,W+=1+W):W=0,$+=W,B[B.length]=oe;return L===T.length?($=ce===T?1/0:$,{rendered:B.join(""),score:$}):null},y.filter=function(T,r,D){return!r||r.length===0?[]:typeof T!="string"?r:(D=D||{},r.reduce(function(L,B,U,$){var W=B;D.extract&&(W=D.extract(B));var q=y.match(T,W,D);return q!=null&&(L[L.length]={string:q.rendered,score:q.score,index:U,original:B}),L},[]).sort(function(L,B){var U=B.score-L.score;return U||L.index-B.index}))}})()},{}],9:[function(o,c,d){var v=/<%=([\s\S]+?)%>/g;c.exports=v},{}],10:[function(o,c,d){(function(v){(function(){var y="Expected a function",T=NaN,r="[object Symbol]",D=/^\s+|\s+$/g,L=/^[-+]0x[0-9a-f]+$/i,B=/^0b[01]+$/i,U=/^0o[0-7]+$/i,$=parseInt,W=typeof v=="object"&&v&&v.Object===Object&&v,q=typeof self=="object"&&self&&self.Object===Object&&self,ne=W||q||Function("return this")(),ce=Object.prototype,oe=ce.toString,fe=Math.max,be=Math.min,ge=function(){return ne.Date.now()};function Ee(te,ae,pe){var Le,tt,Je,Mt,Lt,yt,rt=0,mt=!1,Ft=!1,bn=!0;if(typeof te!="function")throw new TypeError(y);ae=ie(ae)||0,de(pe)&&(mt=!!pe.leading,Ft="maxWait"in pe,Je=Ft?fe(ie(pe.maxWait)||0,ae):Je,bn="trailing"in pe?!!pe.trailing:bn);function Bt(Ae){var Ne=Le,Ue=tt;return Le=tt=void 0,rt=Ae,Mt=te.apply(Ue,Ne),Mt}function ht(Ae){return rt=Ae,Lt=setTimeout(Nt,ae),mt?Bt(Ae):Mt}function gt(Ae){var Ne=Ae-yt,Ue=Ae-rt,Et=ae-Ne;return Ft?be(Et,Je-Ue):Et}function et(Ae){var Ne=Ae-yt,Ue=Ae-rt;return yt===void 0||Ne>=ae||Ne<0||Ft&&Ue>=Je}function Nt(){var Ae=ge();if(et(Ae))return St(Ae);Lt=setTimeout(Nt,gt(Ae))}function St(Ae){return Lt=void 0,bn&&Le?Bt(Ae):(Le=tt=void 0,Mt)}function Xt(){Lt!==void 0&&clearTimeout(Lt),rt=0,Le=yt=tt=Lt=void 0}function Ie(){return Lt===void 0?Mt:St(ge())}function gn(){var Ae=ge(),Ne=et(Ae);if(Le=arguments,tt=this,yt=Ae,Ne){if(Lt===void 0)return ht(yt);if(Ft)return Lt=setTimeout(Nt,ae),Bt(yt)}return Lt===void 0&&(Lt=setTimeout(Nt,ae)),Mt}return gn.cancel=Xt,gn.flush=Ie,gn}function de(te){var ae=typeof te;return!!te&&(ae=="object"||ae=="function")}function re(te){return!!te&&typeof te=="object"}function Y(te){return typeof te=="symbol"||re(te)&&oe.call(te)==r}function ie(te){if(typeof te=="number")return te;if(Y(te))return T;if(de(te)){var ae=typeof te.valueOf=="function"?te.valueOf():te;te=de(ae)?ae+"":ae}if(typeof te!="string")return te===0?te:+te;te=te.replace(D,"");var pe=B.test(te);return pe||U.test(te)?$(te.slice(2),pe?2:8):L.test(te)?T:+te}c.exports=Ee}).call(this)}).call(this,typeof ps<"u"?ps:typeof self<"u"?self:typeof window<"u"?window:{})},{}],11:[function(o,c,d){(function(v){(function(){var y=200,T="__lodash_hash_undefined__",r=1,D=2,L=9007199254740991,B="[object Arguments]",U="[object Array]",$="[object AsyncFunction]",W="[object Boolean]",q="[object Date]",ne="[object Error]",ce="[object Function]",oe="[object GeneratorFunction]",fe="[object Map]",be="[object Number]",ge="[object Null]",Ee="[object Object]",de="[object Promise]",re="[object Proxy]",Y="[object RegExp]",ie="[object Set]",te="[object String]",ae="[object Symbol]",pe="[object Undefined]",Le="[object WeakMap]",tt="[object ArrayBuffer]",Je="[object DataView]",Mt="[object Float32Array]",Lt="[object Float64Array]",yt="[object Int8Array]",rt="[object Int16Array]",mt="[object Int32Array]",Ft="[object Uint8Array]",bn="[object Uint8ClampedArray]",Bt="[object Uint16Array]",ht="[object Uint32Array]",gt=/[\\^$.*+?()[\]{}|]/g,et=/^\[object .+?Constructor\]$/,Nt=/^(?:0|[1-9]\d*)$/,St={};St[Mt]=St[Lt]=St[yt]=St[rt]=St[mt]=St[Ft]=St[bn]=St[Bt]=St[ht]=!0,St[B]=St[U]=St[tt]=St[W]=St[Je]=St[q]=St[ne]=St[ce]=St[fe]=St[be]=St[Ee]=St[Y]=St[ie]=St[te]=St[Le]=!1;var Xt=typeof v=="object"&&v&&v.Object===Object&&v,Ie=typeof self=="object"&&self&&self.Object===Object&&self,gn=Xt||Ie||Function("return this")(),Ae=typeof d=="object"&&d&&!d.nodeType&&d,Ne=Ae&&typeof c=="object"&&c&&!c.nodeType&&c,Ue=Ne&&Ne.exports===Ae,Et=Ue&&Xt.process,Ct=function(){try{return Et&&Et.binding&&Et.binding("util")}catch{}}(),Qt=Ct&&Ct.isTypedArray;function Gt(Xe,Dt){for(var Sn=-1,Hn=Xe==null?0:Xe.length,zi=0,yi=[];++Sn<Hn;){var Ti=Xe[Sn];Dt(Ti,Sn,Xe)&&(yi[zi++]=Ti)}return yi}function Yt(Xe,Dt){for(var Sn=-1,Hn=Dt.length,zi=Xe.length;++Sn<Hn;)Xe[zi+Sn]=Dt[Sn];return Xe}function vn(Xe,Dt){for(var Sn=-1,Hn=Xe==null?0:Xe.length;++Sn<Hn;)if(Dt(Xe[Sn],Sn,Xe))return!0;return!1}function dn(Xe,Dt){for(var Sn=-1,Hn=Array(Xe);++Sn<Xe;)Hn[Sn]=Dt(Sn);return Hn}function Wn(Xe){return function(Dt){return Xe(Dt)}}function Rn(Xe,Dt){return Xe.has(Dt)}function hn(Xe,Dt){return Xe==null?void 0:Xe[Dt]}function jn(Xe){var Dt=-1,Sn=Array(Xe.size);return Xe.forEach(function(Hn,zi){Sn[++Dt]=[zi,Hn]}),Sn}function ti(Xe,Dt){return function(Sn){return Xe(Dt(Sn))}}function ki(Xe){var Dt=-1,Sn=Array(Xe.size);return Xe.forEach(function(Hn){Sn[++Dt]=Hn}),Sn}var gi=Array.prototype,or=Function.prototype,wr=Object.prototype,Rr=gn["__core-js_shared__"],zr=or.toString,dr=wr.hasOwnProperty,Ho=function(){var Xe=/[^.]+$/.exec(Rr&&Rr.keys&&Rr.keys.IE_PROTO||"");return Xe?"Symbol(src)_1."+Xe:""}(),Sr=wr.toString,Tr=RegExp("^"+zr.call(dr).replace(gt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Bo=Ue?gn.Buffer:void 0,ii=gn.Symbol,Qo=gn.Uint8Array,vs=wr.propertyIsEnumerable,To=gi.splice,Eo=ii?ii.toStringTag:void 0,es=Object.getOwnPropertySymbols,ys=Bo?Bo.isBuffer:void 0,Qs=ti(Object.keys,Object),bs=Us(gn,"DataView"),vt=Us(gn,"Map"),ye=Us(gn,"Promise"),Te=Us(gn,"Set"),Ve=Us(gn,"WeakMap"),Ze=Us(Object,"create"),Ge=Mr(bs),at=Mr(vt),xt=Mr(ye),lt=Mr(Te),wt=Mr(Ve),Rt=ii?ii.prototype:void 0,Tt=Rt?Rt.valueOf:void 0;function Zt(Xe){var Dt=-1,Sn=Xe==null?0:Xe.length;for(this.clear();++Dt<Sn;){var Hn=Xe[Dt];this.set(Hn[0],Hn[1])}}function xn(){this.__data__=Ze?Ze(null):{},this.size=0}function wn(Xe){var Dt=this.has(Xe)&&delete this.__data__[Xe];return this.size-=Dt?1:0,Dt}function $n(Xe){var Dt=this.__data__;if(Ze){var Sn=Dt[Xe];return Sn===T?void 0:Sn}return dr.call(Dt,Xe)?Dt[Xe]:void 0}function Zn(Xe){var Dt=this.__data__;return Ze?Dt[Xe]!==void 0:dr.call(Dt,Xe)}function Xn(Xe,Dt){var Sn=this.__data__;return this.size+=this.has(Xe)?0:1,Sn[Xe]=Ze&&Dt===void 0?T:Dt,this}Zt.prototype.clear=xn,Zt.prototype.delete=wn,Zt.prototype.get=$n,Zt.prototype.has=Zn,Zt.prototype.set=Xn;function Un(Xe){var Dt=-1,Sn=Xe==null?0:Xe.length;for(this.clear();++Dt<Sn;){var Hn=Xe[Dt];this.set(Hn[0],Hn[1])}}function bi(){this.__data__=[],this.size=0}function Ri(Xe){var Dt=this.__data__,Sn=_o(Dt,Xe);if(Sn<0)return!1;var Hn=Dt.length-1;return Sn==Hn?Dt.pop():To.call(Dt,Sn,1),--this.size,!0}function ni(Xe){var Dt=this.__data__,Sn=_o(Dt,Xe);return Sn<0?void 0:Dt[Sn][1]}function Ai(Xe){return _o(this.__data__,Xe)>-1}function qi(Xe,Dt){var Sn=this.__data__,Hn=_o(Sn,Xe);return Hn<0?(++this.size,Sn.push([Xe,Dt])):Sn[Hn][1]=Dt,this}Un.prototype.clear=bi,Un.prototype.delete=Ri,Un.prototype.get=ni,Un.prototype.has=Ai,Un.prototype.set=qi;function Qi(Xe){var Dt=-1,Sn=Xe==null?0:Xe.length;for(this.clear();++Dt<Sn;){var Hn=Xe[Dt];this.set(Hn[0],Hn[1])}}function Pr(){this.size=0,this.__data__={hash:new Zt,map:new(vt||Un),string:new Zt}}function Dr(Xe){var Dt=As(this,Xe).delete(Xe);return this.size-=Dt?1:0,Dt}function uo(Xe){return As(this,Xe).get(Xe)}function ts(Xe){return As(this,Xe).has(Xe)}function el(Xe,Dt){var Sn=As(this,Xe),Hn=Sn.size;return Sn.set(Xe,Dt),this.size+=Sn.size==Hn?0:1,this}Qi.prototype.clear=Pr,Qi.prototype.delete=Dr,Qi.prototype.get=uo,Qi.prototype.has=ts,Qi.prototype.set=el;function Cs(Xe){var Dt=-1,Sn=Xe==null?0:Xe.length;for(this.__data__=new Qi;++Dt<Sn;)this.add(Xe[Dt])}function ea(Xe){return this.__data__.set(Xe,T),this}function Ua(Xe){return this.__data__.has(Xe)}Cs.prototype.add=Cs.prototype.push=ea,Cs.prototype.has=Ua;function Io(Xe){var Dt=this.__data__=new Un(Xe);this.size=Dt.size}function ja(){this.__data__=new Un,this.size=0}function xa(Xe){var Dt=this.__data__,Sn=Dt.delete(Xe);return this.size=Dt.size,Sn}function wa(Xe){return this.__data__.get(Xe)}function ta(Xe){return this.__data__.has(Xe)}function Fo(Xe,Dt){var Sn=this.__data__;if(Sn instanceof Un){var Hn=Sn.__data__;if(!vt||Hn.length<y-1)return Hn.push([Xe,Dt]),this.size=++Sn.size,this;Sn=this.__data__=new Qi(Hn)}return Sn.set(Xe,Dt),this.size=Sn.size,this}Io.prototype.clear=ja,Io.prototype.delete=xa,Io.prototype.get=wa,Io.prototype.has=ta,Io.prototype.set=Fo;function ns(Xe,Dt){var Sn=Er(Xe),Hn=!Sn&&Yr(Xe),zi=!Sn&&!Hn&&yn(Xe),yi=!Sn&&!Hn&&!zi&&oa(Xe),Ti=Sn||Hn||zi||yi,$i=Ti?dn(Xe.length,String):[],er=$i.length;for(var mr in Xe)dr.call(Xe,mr)&&!(Ti&&(mr=="length"||zi&&(mr=="offset"||mr=="parent")||yi&&(mr=="buffer"||mr=="byteLength"||mr=="byteOffset")||en(mr,er)))&&$i.push(mr);return $i}function _o(Xe,Dt){for(var Sn=Xe.length;Sn--;)if(fr(Xe[Sn][0],Dt))return Sn;return-1}function Co(Xe,Dt,Sn){var Hn=Dt(Xe);return Er(Xe)?Hn:Yt(Hn,Sn(Xe))}function Ur(Xe){return Xe==null?Xe===void 0?pe:ge:Eo&&Eo in Object(Xe)?ra(Xe):ar(Xe)}function ho(Xe){return ri(Xe)&&Ur(Xe)==B}function is(Xe,Dt,Sn,Hn,zi){return Xe===Dt?!0:Xe==null||Dt==null||!ri(Xe)&&!ri(Dt)?Xe!==Xe&&Dt!==Dt:Sa(Xe,Dt,Sn,Hn,is,zi)}function Sa(Xe,Dt,Sn,Hn,zi,yi){var Ti=Er(Xe),$i=Er(Dt),er=Ti?U:st(Xe),mr=$i?U:st(Dt);er=er==B?Ee:er,mr=mr==B?Ee:mr;var Kr=er==Ee,Ni=mr==Ee,Wi=er==mr;if(Wi&&yn(Xe)){if(!yn(Dt))return!1;Ti=!0,Kr=!1}if(Wi&&!Kr)return yi||(yi=new Io),Ti||oa(Xe)?na(Xe,Dt,Sn,Hn,zi,yi):to(Xe,Dt,er,Sn,Hn,zi,yi);if(!(Sn&r)){var jr=Kr&&dr.call(Xe,"__wrapped__"),Gi=Ni&&dr.call(Dt,"__wrapped__");if(jr||Gi){var js=jr?Xe.value():Xe,io=Gi?Dt.value():Dt;return yi||(yi=new Io),zi(js,io,Sn,Hn,yi)}}return Wi?(yi||(yi=new Io),Ns(Xe,Dt,Sn,Hn,zi,yi)):!1}function cs(Xe){if(!kr(Xe)||xi(Xe))return!1;var Dt=hi(Xe)?Tr:et;return Dt.test(Mr(Xe))}function sr(Xe){return ri(Xe)&&no(Xe.length)&&!!St[Ur(Xe)]}function $a(Xe){if(!In(Xe))return Qs(Xe);var Dt=[];for(var Sn in Object(Xe))dr.call(Xe,Sn)&&Sn!="constructor"&&Dt.push(Sn);return Dt}function na(Xe,Dt,Sn,Hn,zi,yi){var Ti=Sn&r,$i=Xe.length,er=Dt.length;if($i!=er&&!(Ti&&er>$i))return!1;var mr=yi.get(Xe);if(mr&&yi.get(Dt))return mr==Dt;var Kr=-1,Ni=!0,Wi=Sn&D?new Cs:void 0;for(yi.set(Xe,Dt),yi.set(Dt,Xe);++Kr<$i;){var jr=Xe[Kr],Gi=Dt[Kr];if(Hn)var js=Ti?Hn(Gi,jr,Kr,Dt,Xe,yi):Hn(jr,Gi,Kr,Xe,Dt,yi);if(js!==void 0){if(js)continue;Ni=!1;break}if(Wi){if(!vn(Dt,function(io,Vo){if(!Rn(Wi,Vo)&&(jr===io||zi(jr,io,Sn,Hn,yi)))return Wi.push(Vo)})){Ni=!1;break}}else if(!(jr===Gi||zi(jr,Gi,Sn,Hn,yi))){Ni=!1;break}}return yi.delete(Xe),yi.delete(Dt),Ni}function to(Xe,Dt,Sn,Hn,zi,yi,Ti){switch(Sn){case Je:if(Xe.byteLength!=Dt.byteLength||Xe.byteOffset!=Dt.byteOffset)return!1;Xe=Xe.buffer,Dt=Dt.buffer;case tt:return!(Xe.byteLength!=Dt.byteLength||!yi(new Qo(Xe),new Qo(Dt)));case W:case q:case be:return fr(+Xe,+Dt);case ne:return Xe.name==Dt.name&&Xe.message==Dt.message;case Y:case te:return Xe==Dt+"";case fe:var $i=jn;case ie:var er=Hn&r;if($i||($i=ki),Xe.size!=Dt.size&&!er)return!1;var mr=Ti.get(Xe);if(mr)return mr==Dt;Hn|=D,Ti.set(Xe,Dt);var Kr=na($i(Xe),$i(Dt),Hn,zi,yi,Ti);return Ti.delete(Xe),Kr;case ae:if(Tt)return Tt.call(Xe)==Tt.call(Dt)}return!1}function Ns(Xe,Dt,Sn,Hn,zi,yi){var Ti=Sn&r,$i=ia(Xe),er=$i.length,mr=ia(Dt),Kr=mr.length;if(er!=Kr&&!Ti)return!1;for(var Ni=er;Ni--;){var Wi=$i[Ni];if(!(Ti?Wi in Dt:dr.call(Dt,Wi)))return!1}var jr=yi.get(Xe);if(jr&&yi.get(Dt))return jr==Dt;var Gi=!0;yi.set(Xe,Dt),yi.set(Dt,Xe);for(var js=Ti;++Ni<er;){Wi=$i[Ni];var io=Xe[Wi],Vo=Dt[Wi];if(Hn)var sa=Ti?Hn(Vo,io,Wi,Dt,Xe,yi):Hn(io,Vo,Wi,Xe,Dt,yi);if(!(sa===void 0?io===Vo||zi(io,Vo,Sn,Hn,yi):sa)){Gi=!1;break}js||(js=Wi=="constructor")}if(Gi&&!js){var Ps=Xe.constructor,aa=Dt.constructor;Ps!=aa&&"constructor"in Xe&&"constructor"in Dt&&!(typeof Ps=="function"&&Ps instanceof Ps&&typeof aa=="function"&&aa instanceof aa)&&(Gi=!1)}return yi.delete(Xe),yi.delete(Dt),Gi}function ia(Xe){return Co(Xe,us,bl)}function As(Xe,Dt){var Sn=Xe.__data__;return tn(Dt)?Sn[typeof Dt=="string"?"string":"hash"]:Sn.map}function Us(Xe,Dt){var Sn=hn(Xe,Dt);return cs(Sn)?Sn:void 0}function ra(Xe){var Dt=dr.call(Xe,Eo),Sn=Xe[Eo];try{Xe[Eo]=void 0;var Hn=!0}catch{}var zi=Sr.call(Xe);return Hn&&(Dt?Xe[Eo]=Sn:delete Xe[Eo]),zi}var bl=es?function(Xe){return Xe==null?[]:(Xe=Object(Xe),Gt(es(Xe),function(Dt){return vs.call(Xe,Dt)}))}:pr,st=Ur;(bs&&st(new bs(new ArrayBuffer(1)))!=Je||vt&&st(new vt)!=fe||ye&&st(ye.resolve())!=de||Te&&st(new Te)!=ie||Ve&&st(new Ve)!=Le)&&(st=function(Xe){var Dt=Ur(Xe),Sn=Dt==Ee?Xe.constructor:void 0,Hn=Sn?Mr(Sn):"";if(Hn)switch(Hn){case Ge:return Je;case at:return fe;case xt:return de;case lt:return ie;case wt:return Le}return Dt});function en(Xe,Dt){return Dt=Dt??L,!!Dt&&(typeof Xe=="number"||Nt.test(Xe))&&Xe>-1&&Xe%1==0&&Xe<Dt}function tn(Xe){var Dt=typeof Xe;return Dt=="string"||Dt=="number"||Dt=="symbol"||Dt=="boolean"?Xe!=="__proto__":Xe===null}function xi(Xe){return!!Ho&&Ho in Xe}function In(Xe){var Dt=Xe&&Xe.constructor,Sn=typeof Dt=="function"&&Dt.prototype||wr;return Xe===Sn}function ar(Xe){return Sr.call(Xe)}function Mr(Xe){if(Xe!=null){try{return zr.call(Xe)}catch{}try{return Xe+""}catch{}}return""}function fr(Xe,Dt){return Xe===Dt||Xe!==Xe&&Dt!==Dt}var Yr=ho(function(){return arguments}())?ho:function(Xe){return ri(Xe)&&dr.call(Xe,"callee")&&!vs.call(Xe,"callee")},Er=Array.isArray;function rs(Xe){return Xe!=null&&no(Xe.length)&&!hi(Xe)}var yn=ys||vo;function fi(Xe,Dt){return is(Xe,Dt)}function hi(Xe){if(!kr(Xe))return!1;var Dt=Ur(Xe);return Dt==ce||Dt==oe||Dt==$||Dt==re}function no(Xe){return typeof Xe=="number"&&Xe>-1&&Xe%1==0&&Xe<=L}function kr(Xe){var Dt=typeof Xe;return Xe!=null&&(Dt=="object"||Dt=="function")}function ri(Xe){return Xe!=null&&typeof Xe=="object"}var oa=Qt?Wn(Qt):sr;function us(Xe){return rs(Xe)?ns(Xe):$a(Xe)}function pr(){return[]}function vo(){return!1}c.exports=fi}).call(this)}).call(this,typeof ps<"u"?ps:typeof self<"u"?self:typeof window<"u"?window:{})},{}],12:[function(o,c,d){(function(v){(function(){var y=o("lodash._reinterpolate"),T=o("lodash.templatesettings"),r=800,D=16,L=1/0,B=9007199254740991,U="[object Arguments]",$="[object Array]",W="[object AsyncFunction]",q="[object Boolean]",ne="[object Date]",ce="[object DOMException]",oe="[object Error]",fe="[object Function]",be="[object GeneratorFunction]",ge="[object Map]",Ee="[object Number]",de="[object Null]",re="[object Object]",Y="[object Proxy]",ie="[object RegExp]",te="[object Set]",ae="[object String]",pe="[object Symbol]",Le="[object Undefined]",tt="[object WeakMap]",Je="[object ArrayBuffer]",Mt="[object DataView]",Lt="[object Float32Array]",yt="[object Float64Array]",rt="[object Int8Array]",mt="[object Int16Array]",Ft="[object Int32Array]",bn="[object Uint8Array]",Bt="[object Uint8ClampedArray]",ht="[object Uint16Array]",gt="[object Uint32Array]",et=/\b__p \+= '';/g,Nt=/\b(__p \+=) '' \+/g,St=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Xt=/[\\^$.*+?()[\]{}|]/g,Ie=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,gn=/^\[object .+?Constructor\]$/,Ae=/^(?:0|[1-9]\d*)$/,Ne=/($^)/,Ue=/['\n\r\u2028\u2029\\]/g,Et={};Et[Lt]=Et[yt]=Et[rt]=Et[mt]=Et[Ft]=Et[bn]=Et[Bt]=Et[ht]=Et[gt]=!0,Et[U]=Et[$]=Et[Je]=Et[q]=Et[Mt]=Et[ne]=Et[oe]=Et[fe]=Et[ge]=Et[Ee]=Et[re]=Et[ie]=Et[te]=Et[ae]=Et[tt]=!1;var Ct={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Qt=typeof v=="object"&&v&&v.Object===Object&&v,Gt=typeof self=="object"&&self&&self.Object===Object&&self,Yt=Qt||Gt||Function("return this")(),vn=typeof d=="object"&&d&&!d.nodeType&&d,dn=vn&&typeof c=="object"&&c&&!c.nodeType&&c,Wn=dn&&dn.exports===vn,Rn=Wn&&Qt.process,hn=function(){try{var st=dn&&dn.require&&dn.require("util").types;return st||Rn&&Rn.binding&&Rn.binding("util")}catch{}}(),jn=hn&&hn.isTypedArray;function ti(st,en,tn){switch(tn.length){case 0:return st.call(en);case 1:return st.call(en,tn[0]);case 2:return st.call(en,tn[0],tn[1]);case 3:return st.call(en,tn[0],tn[1],tn[2])}return st.apply(en,tn)}function ki(st,en){for(var tn=-1,xi=st==null?0:st.length,In=Array(xi);++tn<xi;)In[tn]=en(st[tn],tn,st);return In}function gi(st,en){for(var tn=-1,xi=Array(st);++tn<st;)xi[tn]=en(tn);return xi}function or(st){return function(en){return st(en)}}function wr(st,en){return ki(en,function(tn){return st[tn]})}function Rr(st){return"\\"+Ct[st]}function zr(st,en){return st==null?void 0:st[en]}function dr(st,en){return function(tn){return st(en(tn))}}var Ho=Function.prototype,Sr=Object.prototype,Tr=Yt["__core-js_shared__"],Bo=Ho.toString,ii=Sr.hasOwnProperty,Qo=function(){var st=/[^.]+$/.exec(Tr&&Tr.keys&&Tr.keys.IE_PROTO||"");return st?"Symbol(src)_1."+st:""}(),vs=Sr.toString,To=Bo.call(Object),Eo=RegExp("^"+Bo.call(ii).replace(Xt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),es=Wn?Yt.Buffer:void 0,ys=Yt.Symbol,Qs=dr(Object.getPrototypeOf,Object),bs=Sr.propertyIsEnumerable,vt=ys?ys.toStringTag:void 0,ye=function(){try{var st=qi(Object,"defineProperty");return st({},"",{}),st}catch{}}(),Te=es?es.isBuffer:void 0,Ve=dr(Object.keys,Object),Ze=Math.max,Ge=Date.now,at=ys?ys.prototype:void 0,xt=at?at.toString:void 0;function lt(st,en){var tn=ta(st),xi=!tn&&wa(st),In=!tn&&!xi&&ns(st),ar=!tn&&!xi&&!In&&sr(st),Mr=tn||xi||In||ar,fr=Mr?gi(st.length,String):[],Yr=fr.length;for(var Er in st)(en||ii.call(st,Er))&&!(Mr&&(Er=="length"||In&&(Er=="offset"||Er=="parent")||ar&&(Er=="buffer"||Er=="byteLength"||Er=="byteOffset")||Pr(Er,Yr)))&&fr.push(Er);return fr}function wt(st,en,tn){var xi=st[en];(!(ii.call(st,en)&&xa(xi,tn))||tn===void 0&&!(en in st))&&Rt(st,en,tn)}function Rt(st,en,tn){en=="__proto__"&&ye?ye(st,en,{configurable:!0,enumerable:!0,value:tn,writable:!0}):st[en]=tn}function Tt(st){return st==null?st===void 0?Le:de:vt&&vt in Object(st)?Qi(st):Cs(st)}function Zt(st){return is(st)&&Tt(st)==U}function xn(st){if(!ho(st)||uo(st))return!1;var en=Co(st)?Eo:gn;return en.test(ja(st))}function wn(st){return is(st)&&Ur(st.length)&&!!Et[Tt(st)]}function $n(st){if(!ts(st))return Ve(st);var en=[];for(var tn in Object(st))ii.call(st,tn)&&tn!="constructor"&&en.push(tn);return en}function Zn(st){if(!ho(st))return el(st);var en=ts(st),tn=[];for(var xi in st)xi=="constructor"&&(en||!ii.call(st,xi))||tn.push(xi);return tn}function Xn(st,en){return Ua(ea(st,en,ra),st+"")}var Un=ye?function(st,en){return ye(st,"toString",{configurable:!0,enumerable:!1,value:Us(en),writable:!0})}:ra;function bi(st){if(typeof st=="string")return st;if(ta(st))return ki(st,bi)+"";if(cs(st))return xt?xt.call(st):"";var en=st+"";return en=="0"&&1/st==-L?"-0":en}function Ri(st,en,tn,xi){var In=!tn;tn||(tn={});for(var ar=-1,Mr=en.length;++ar<Mr;){var fr=en[ar],Yr=xi?xi(tn[fr],st[fr],fr,tn,st):void 0;Yr===void 0&&(Yr=st[fr]),In?Rt(tn,fr,Yr):wt(tn,fr,Yr)}return tn}function ni(st){return Xn(function(en,tn){var xi=-1,In=tn.length,ar=In>1?tn[In-1]:void 0,Mr=In>2?tn[2]:void 0;for(ar=st.length>3&&typeof ar=="function"?(In--,ar):void 0,Mr&&Dr(tn[0],tn[1],Mr)&&(ar=In<3?void 0:ar,In=1),en=Object(en);++xi<In;){var fr=tn[xi];fr&&st(en,fr,xi,ar)}return en})}function Ai(st,en,tn,xi){return st===void 0||xa(st,Sr[tn])&&!ii.call(xi,tn)?en:st}function qi(st,en){var tn=zr(st,en);return xn(tn)?tn:void 0}function Qi(st){var en=ii.call(st,vt),tn=st[vt];try{st[vt]=void 0;var xi=!0}catch{}var In=vs.call(st);return xi&&(en?st[vt]=tn:delete st[vt]),In}function Pr(st,en){var tn=typeof st;return en=en??B,!!en&&(tn=="number"||tn!="symbol"&&Ae.test(st))&&st>-1&&st%1==0&&st<en}function Dr(st,en,tn){if(!ho(tn))return!1;var xi=typeof en;return(xi=="number"?Fo(tn)&&Pr(en,tn.length):xi=="string"&&en in tn)?xa(tn[en],st):!1}function uo(st){return!!Qo&&Qo in st}function ts(st){var en=st&&st.constructor,tn=typeof en=="function"&&en.prototype||Sr;return st===tn}function el(st){var en=[];if(st!=null)for(var tn in Object(st))en.push(tn);return en}function Cs(st){return vs.call(st)}function ea(st,en,tn){return en=Ze(en===void 0?st.length-1:en,0),function(){for(var xi=arguments,In=-1,ar=Ze(xi.length-en,0),Mr=Array(ar);++In<ar;)Mr[In]=xi[en+In];In=-1;for(var fr=Array(en+1);++In<en;)fr[In]=xi[In];return fr[en]=tn(Mr),ti(st,this,fr)}}var Ua=Io(Un);function Io(st){var en=0,tn=0;return function(){var xi=Ge(),In=D-(xi-tn);if(tn=xi,In>0){if(++en>=r)return arguments[0]}else en=0;return st.apply(void 0,arguments)}}function ja(st){if(st!=null){try{return Bo.call(st)}catch{}try{return st+""}catch{}}return""}function xa(st,en){return st===en||st!==st&&en!==en}var wa=Zt(function(){return arguments}())?Zt:function(st){return is(st)&&ii.call(st,"callee")&&!bs.call(st,"callee")},ta=Array.isArray;function Fo(st){return st!=null&&Ur(st.length)&&!Co(st)}var ns=Te||bl;function _o(st){if(!is(st))return!1;var en=Tt(st);return en==oe||en==ce||typeof st.message=="string"&&typeof st.name=="string"&&!Sa(st)}function Co(st){if(!ho(st))return!1;var en=Tt(st);return en==fe||en==be||en==W||en==Y}function Ur(st){return typeof st=="number"&&st>-1&&st%1==0&&st<=B}function ho(st){var en=typeof st;return st!=null&&(en=="object"||en=="function")}function is(st){return st!=null&&typeof st=="object"}function Sa(st){if(!is(st)||Tt(st)!=re)return!1;var en=Qs(st);if(en===null)return!0;var tn=ii.call(en,"constructor")&&en.constructor;return typeof tn=="function"&&tn instanceof tn&&Bo.call(tn)==To}function cs(st){return typeof st=="symbol"||is(st)&&Tt(st)==pe}var sr=jn?or(jn):wn;function $a(st){return st==null?"":bi(st)}var na=ni(function(st,en,tn,xi){Ri(en,Ns(en),st,xi)});function to(st){return Fo(st)?lt(st):$n(st)}function Ns(st){return Fo(st)?lt(st,!0):Zn(st)}function ia(st,en,tn){var xi=T.imports._.templateSettings||T;tn&&Dr(st,en,tn)&&(en=void 0),st=$a(st),en=na({},en,xi,Ai);var In=na({},en.imports,xi.imports,Ai),ar=to(In),Mr=wr(In,ar),fr,Yr,Er=0,rs=en.interpolate||Ne,yn="__p += '",fi=RegExp((en.escape||Ne).source+"|"+rs.source+"|"+(rs===y?Ie:Ne).source+"|"+(en.evaluate||Ne).source+"|$","g"),hi=ii.call(en,"sourceURL")?"//# sourceURL="+(en.sourceURL+"").replace(/[\r\n]/g," ")+`
`:"";st.replace(fi,function(ri,oa,us,pr,vo,Xe){return us||(us=pr),yn+=st.slice(Er,Xe).replace(Ue,Rr),oa&&(fr=!0,yn+=`' +
__e(`+oa+`) +
'`),vo&&(Yr=!0,yn+=`';
`+vo+`;
__p += '`),us&&(yn+=`' +
((__t = (`+us+`)) == null ? '' : __t) +
'`),Er=Xe+ri.length,ri}),yn+=`';
`;var no=ii.call(en,"variable")&&en.variable;no||(yn=`with (obj) {
`+yn+`
}
`),yn=(Yr?yn.replace(et,""):yn).replace(Nt,"$1").replace(St,"$1;"),yn="function("+(no||"obj")+`) {
`+(no?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(fr?", __e = _.escape":"")+(Yr?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+yn+`return __p
}`;var kr=As(function(){return Function(ar,hi+"return "+yn).apply(void 0,Mr)});if(kr.source=yn,_o(kr))throw kr;return kr}var As=Xn(function(st,en){try{return ti(st,void 0,en)}catch(tn){return _o(tn)?tn:new Error(tn)}});function Us(st){return function(){return st}}function ra(st){return st}function bl(){return!1}c.exports=ia}).call(this)}).call(this,typeof ps<"u"?ps:typeof self<"u"?self:typeof window<"u"?window:{})},{"lodash._reinterpolate":9,"lodash.templatesettings":13}],13:[function(o,c,d){(function(v){(function(){var y=o("lodash._reinterpolate"),T=1/0,r="[object Symbol]",D=/[&<>"'`]/g,L=RegExp(D.source),B=/<%-([\s\S]+?)%>/g,U=/<%([\s\S]+?)%>/g,$={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},W=typeof v=="object"&&v&&v.Object===Object&&v,q=typeof self=="object"&&self&&self.Object===Object&&self,ne=W||q||Function("return this")();function ce(Le){return function(tt){return Le==null?void 0:Le[tt]}}var oe=ce($),fe=Object.prototype,be=fe.toString,ge=ne.Symbol,Ee=ge?ge.prototype:void 0,de=Ee?Ee.toString:void 0,re={escape:B,evaluate:U,interpolate:y,variable:"",imports:{_:{escape:pe}}};function Y(Le){if(typeof Le=="string")return Le;if(te(Le))return de?de.call(Le):"";var tt=Le+"";return tt=="0"&&1/Le==-T?"-0":tt}function ie(Le){return!!Le&&typeof Le=="object"}function te(Le){return typeof Le=="symbol"||ie(Le)&&be.call(Le)==r}function ae(Le){return Le==null?"":Y(Le)}function pe(Le){return Le=ae(Le),Le&&L.test(Le)?Le.replace(D,oe):Le}c.exports=re}).call(this)}).call(this,typeof ps<"u"?ps:typeof self<"u"?self:typeof window<"u"?window:{})},{"lodash._reinterpolate":9}],14:[function(o,c,d){const v=o("is-plain-obj"),{hasOwnProperty:y}=Object.prototype,{propertyIsEnumerable:T}=Object,r=(oe,fe,be)=>Object.defineProperty(oe,fe,{value:be,writable:!0,enumerable:!0,configurable:!0}),D=this,L={concatArrays:!1,ignoreUndefined:!1},B=oe=>{const fe=[];for(const be in oe)y.call(oe,be)&&fe.push(be);if(Object.getOwnPropertySymbols){const be=Object.getOwnPropertySymbols(oe);for(const ge of be)T.call(oe,ge)&&fe.push(ge)}return fe};function U(oe){return Array.isArray(oe)?$(oe):v(oe)?W(oe):oe}function $(oe){const fe=oe.slice(0,0);return B(oe).forEach(be=>{r(fe,be,U(oe[be]))}),fe}function W(oe){const fe=Object.getPrototypeOf(oe)===null?Object.create(null):{};return B(oe).forEach(be=>{r(fe,be,U(oe[be]))}),fe}const q=(oe,fe,be,ge)=>(be.forEach(Ee=>{typeof fe[Ee]>"u"&&ge.ignoreUndefined||(Ee in oe&&oe[Ee]!==Object.getPrototypeOf(oe)?r(oe,Ee,ce(oe[Ee],fe[Ee],ge)):r(oe,Ee,U(fe[Ee])))}),oe),ne=(oe,fe,be)=>{let ge=oe.slice(0,0),Ee=0;return[oe,fe].forEach(de=>{const re=[];for(let Y=0;Y<de.length;Y++)y.call(de,Y)&&(re.push(String(Y)),de===oe?r(ge,Ee++,de[Y]):r(ge,Ee++,U(de[Y])));ge=q(ge,de,B(de).filter(Y=>!re.includes(Y)),be)}),ge};function ce(oe,fe,be){return be.concatArrays&&Array.isArray(oe)&&Array.isArray(fe)?ne(oe,fe,be):!v(fe)||!v(oe)?U(fe):q(oe,fe,B(fe),be)}c.exports=function(...oe){const fe=ce(U(L),this!==D&&this||{},L);let be={_:{}};for(const ge of oe)if(ge!==void 0){if(!v(ge))throw new TypeError("`"+ge+"` is not an Option Object");be=ce(be,{_:ge},fe)}return be._}},{"is-plain-obj":15}],15:[function(o,c,d){c.exports=v=>{if(Object.prototype.toString.call(v)!=="[object Object]")return!1;const y=Object.getPrototypeOf(v);return y===null||y===Object.prototype}},{}],16:[function(o,c,d){var v=c.exports={},y,T;function r(){throw new Error("setTimeout has not been defined")}function D(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?y=setTimeout:y=r}catch{y=r}try{typeof clearTimeout=="function"?T=clearTimeout:T=D}catch{T=D}})();function L(be){if(y===setTimeout)return setTimeout(be,0);if((y===r||!y)&&setTimeout)return y=setTimeout,setTimeout(be,0);try{return y(be,0)}catch{try{return y.call(null,be,0)}catch{return y.call(this,be,0)}}}function B(be){if(T===clearTimeout)return clearTimeout(be);if((T===D||!T)&&clearTimeout)return T=clearTimeout,clearTimeout(be);try{return T(be)}catch{try{return T.call(null,be)}catch{return T.call(this,be)}}}var U=[],$=!1,W,q=-1;function ne(){!$||!W||($=!1,W.length?U=W.concat(U):q=-1,U.length&&ce())}function ce(){if(!$){var be=L(ne);$=!0;for(var ge=U.length;ge;){for(W=U,U=[];++q<ge;)W&&W[q].run();q=-1,ge=U.length}W=null,$=!1,B(be)}}v.nextTick=function(be){var ge=new Array(arguments.length-1);if(arguments.length>1)for(var Ee=1;Ee<arguments.length;Ee++)ge[Ee-1]=arguments[Ee];U.push(new oe(be,ge)),U.length===1&&!$&&L(ce)};function oe(be,ge){this.fun=be,this.array=ge}oe.prototype.run=function(){this.fun.apply(null,this.array)},v.title="browser",v.browser=!0,v.env={},v.argv=[],v.version="",v.versions={};function fe(){}v.on=fe,v.addListener=fe,v.once=fe,v.off=fe,v.removeListener=fe,v.removeAllListeners=fe,v.emit=fe,v.prependListener=fe,v.prependOnceListener=fe,v.listeners=function(be){return[]},v.binding=function(be){throw new Error("process.binding is not supported")},v.cwd=function(){return"/"},v.chdir=function(be){throw new Error("process.chdir is not supported")},v.umask=function(){return 0}},{}],17:[function(o,c,d){Object.defineProperty(d,"__esModule",{value:!0}),d.default=void 0;function v(r){var D=function(B){var U=B.dispatch,$=B.getState;return function(W){return function(q){return typeof q=="function"?q(U,$,r):W(q)}}};return D}var y=v();y.withExtraArgument=v;var T=y;d.default=T},{}],18:[function(o,c,d){(function(v){(function(){Object.defineProperty(d,"__esModule",{value:!0});var y=o("@babel/runtime/helpers/objectSpread2");function T(Le){return Le&&typeof Le=="object"&&"default"in Le?Le:{default:Le}}var r=T(y);function D(Le){return"Minified Redux error #"+Le+"; visit https://redux.js.org/Errors?code="+Le+" for the full message or use the non-minified dev environment for full errors. "}var L=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),B=function(){return Math.random().toString(36).substring(7).split("").join(".")},U={INIT:"@@redux/INIT"+B(),REPLACE:"@@redux/REPLACE"+B(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+B()}};function $(Le){if(typeof Le!="object"||Le===null)return!1;for(var tt=Le;Object.getPrototypeOf(tt)!==null;)tt=Object.getPrototypeOf(tt);return Object.getPrototypeOf(Le)===tt}function W(Le){if(Le===void 0)return"undefined";if(Le===null)return"null";var tt=typeof Le;switch(tt){case"boolean":case"string":case"number":case"symbol":case"function":return tt}if(Array.isArray(Le))return"array";if(ce(Le))return"date";if(ne(Le))return"error";var Je=q(Le);switch(Je){case"Symbol":case"Promise":case"WeakMap":case"WeakSet":case"Map":case"Set":return Je}return tt.slice(8,-1).toLowerCase().replace(/\s/g,"")}function q(Le){return typeof Le.constructor=="function"?Le.constructor.name:null}function ne(Le){return Le instanceof Error||typeof Le.message=="string"&&Le.constructor&&typeof Le.constructor.stackTraceLimit=="number"}function ce(Le){return Le instanceof Date?!0:typeof Le.toDateString=="function"&&typeof Le.getDate=="function"&&typeof Le.setDate=="function"}function oe(Le){var tt=typeof Le;return v.env.NODE_ENV!=="production"&&(tt=W(Le)),tt}function fe(Le,tt,Je){var Mt;if(typeof tt=="function"&&typeof Je=="function"||typeof Je=="function"&&typeof arguments[3]=="function")throw new Error(v.env.NODE_ENV==="production"?D(0):"It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function. See https://redux.js.org/tutorials/fundamentals/part-4-store#creating-a-store-with-enhancers for an example.");if(typeof tt=="function"&&typeof Je>"u"&&(Je=tt,tt=void 0),typeof Je<"u"){if(typeof Je!="function")throw new Error(v.env.NODE_ENV==="production"?D(1):"Expected the enhancer to be a function. Instead, received: '"+oe(Je)+"'");return Je(fe)(Le,tt)}if(typeof Le!="function")throw new Error(v.env.NODE_ENV==="production"?D(2):"Expected the root reducer to be a function. Instead, received: '"+oe(Le)+"'");var Lt=Le,yt=tt,rt=[],mt=rt,Ft=!1;function bn(){mt===rt&&(mt=rt.slice())}function Bt(){if(Ft)throw new Error(v.env.NODE_ENV==="production"?D(3):"You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return yt}function ht(St){if(typeof St!="function")throw new Error(v.env.NODE_ENV==="production"?D(4):"Expected the listener to be a function. Instead, received: '"+oe(St)+"'");if(Ft)throw new Error(v.env.NODE_ENV==="production"?D(5):"You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api/store#subscribelistener for more details.");var Xt=!0;return bn(),mt.push(St),function(){if(Xt){if(Ft)throw new Error(v.env.NODE_ENV==="production"?D(6):"You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api/store#subscribelistener for more details.");Xt=!1,bn();var gn=mt.indexOf(St);mt.splice(gn,1),rt=null}}}function gt(St){if(!$(St))throw new Error(v.env.NODE_ENV==="production"?D(7):"Actions must be plain objects. Instead, the actual type was: '"+oe(St)+"'. You may need to add middleware to your store setup to handle dispatching other values, such as 'redux-thunk' to handle dispatching functions. See https://redux.js.org/tutorials/fundamentals/part-4-store#middleware and https://redux.js.org/tutorials/fundamentals/part-6-async-logic#using-the-redux-thunk-middleware for examples.");if(typeof St.type>"u")throw new Error(v.env.NODE_ENV==="production"?D(8):'Actions may not have an undefined "type" property. You may have misspelled an action type string constant.');if(Ft)throw new Error(v.env.NODE_ENV==="production"?D(9):"Reducers may not dispatch actions.");try{Ft=!0,yt=Lt(yt,St)}finally{Ft=!1}for(var Xt=rt=mt,Ie=0;Ie<Xt.length;Ie++){var gn=Xt[Ie];gn()}return St}function et(St){if(typeof St!="function")throw new Error(v.env.NODE_ENV==="production"?D(10):"Expected the nextReducer to be a function. Instead, received: '"+oe(St));Lt=St,gt({type:U.REPLACE})}function Nt(){var St,Xt=ht;return St={subscribe:function(gn){if(typeof gn!="object"||gn===null)throw new Error(v.env.NODE_ENV==="production"?D(11):"Expected the observer to be an object. Instead, received: '"+oe(gn)+"'");function Ae(){gn.next&&gn.next(Bt())}Ae();var Ne=Xt(Ae);return{unsubscribe:Ne}}},St[L]=function(){return this},St}return gt({type:U.INIT}),Mt={dispatch:gt,subscribe:ht,getState:Bt,replaceReducer:et},Mt[L]=Nt,Mt}var be=fe;function ge(Le){typeof console<"u"&&typeof console.error=="function"&&console.error(Le);try{throw new Error(Le)}catch{}}function Ee(Le,tt,Je,Mt){var Lt=Object.keys(tt),yt=Je&&Je.type===U.INIT?"preloadedState argument passed to createStore":"previous state received by the reducer";if(Lt.length===0)return"Store does not have a valid reducer. Make sure the argument passed to combineReducers is an object whose values are reducers.";if(!$(Le))return"The "+yt+' has unexpected type of "'+oe(Le)+'". Expected argument to be an object with the following '+('keys: "'+Lt.join('", "')+'"');var rt=Object.keys(Le).filter(function(mt){return!tt.hasOwnProperty(mt)&&!Mt[mt]});if(rt.forEach(function(mt){Mt[mt]=!0}),!(Je&&Je.type===U.REPLACE)&&rt.length>0)return"Unexpected "+(rt.length>1?"keys":"key")+" "+('"'+rt.join('", "')+'" found in '+yt+". ")+"Expected to find one of the known reducer keys instead: "+('"'+Lt.join('", "')+'". Unexpected keys will be ignored.')}function de(Le){Object.keys(Le).forEach(function(tt){var Je=Le[tt],Mt=Je(void 0,{type:U.INIT});if(typeof Mt>"u")throw new Error(v.env.NODE_ENV==="production"?D(12):'The slice reducer for key "'+tt+`" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.`);if(typeof Je(void 0,{type:U.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(v.env.NODE_ENV==="production"?D(13):'The slice reducer for key "'+tt+'" returned undefined when probed with a random type. '+("Don't try to handle '"+U.INIT+`' or other actions in "redux/*" `)+"namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.")})}function re(Le){for(var tt=Object.keys(Le),Je={},Mt=0;Mt<tt.length;Mt++){var Lt=tt[Mt];v.env.NODE_ENV!=="production"&&typeof Le[Lt]>"u"&&ge('No reducer provided for key "'+Lt+'"'),typeof Le[Lt]=="function"&&(Je[Lt]=Le[Lt])}var yt=Object.keys(Je),rt;v.env.NODE_ENV!=="production"&&(rt={});var mt;try{de(Je)}catch(Ft){mt=Ft}return function(bn,Bt){if(bn===void 0&&(bn={}),mt)throw mt;if(v.env.NODE_ENV!=="production"){var ht=Ee(bn,Je,Bt,rt);ht&&ge(ht)}for(var gt=!1,et={},Nt=0;Nt<yt.length;Nt++){var St=yt[Nt],Xt=Je[St],Ie=bn[St],gn=Xt(Ie,Bt);if(typeof gn>"u"){var Ae=Bt&&Bt.type;throw new Error(v.env.NODE_ENV==="production"?D(14):"When called with an action of type "+(Ae?'"'+String(Ae)+'"':"(unknown type)")+', the slice reducer for key "'+St+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.')}et[St]=gn,gt=gt||gn!==Ie}return gt=gt||yt.length!==Object.keys(bn).length,gt?et:bn}}function Y(Le,tt){return function(){return tt(Le.apply(this,arguments))}}function ie(Le,tt){if(typeof Le=="function")return Y(Le,tt);if(typeof Le!="object"||Le===null)throw new Error(v.env.NODE_ENV==="production"?D(16):"bindActionCreators expected an object or a function, but instead received: '"+oe(Le)+`'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?`);var Je={};for(var Mt in Le){var Lt=Le[Mt];typeof Lt=="function"&&(Je[Mt]=Y(Lt,tt))}return Je}function te(){for(var Le=arguments.length,tt=new Array(Le),Je=0;Je<Le;Je++)tt[Je]=arguments[Je];return tt.length===0?function(Mt){return Mt}:tt.length===1?tt[0]:tt.reduce(function(Mt,Lt){return function(){return Mt(Lt.apply(void 0,arguments))}})}function ae(){for(var Le=arguments.length,tt=new Array(Le),Je=0;Je<Le;Je++)tt[Je]=arguments[Je];return function(Mt){return function(){var Lt=Mt.apply(void 0,arguments),yt=function(){throw new Error(v.env.NODE_ENV==="production"?D(15):"Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},rt={getState:Lt.getState,dispatch:function(){return yt.apply(void 0,arguments)}},mt=tt.map(function(Ft){return Ft(rt)});return yt=te.apply(void 0,mt)(Lt.dispatch),r.default(r.default({},Lt),{},{dispatch:yt})}}}function pe(){}v.env.NODE_ENV!=="production"&&typeof pe.name=="string"&&pe.name!=="isCrushed"&&ge('You are currently using minified code outside of NODE_ENV === "production". This means that you are running a slower development build of Redux. You can use loose-envify (https://github.com/zertosh/loose-envify) for browserify or setting mode to production in webpack (https://webpack.js.org/concepts/mode/) to ensure you have the correct code for your production build.'),d.__DO_NOT_USE__ActionTypes=U,d.applyMiddleware=ae,d.bindActionCreators=ie,d.combineReducers=re,d.compose=te,d.createStore=fe,d.legacy_createStore=be}).call(this)}).call(this,o("_process"))},{"@babel/runtime/helpers/objectSpread2":2,_process:16}],19:[function(o,c,d){var v=o("./src/suggestions");c.exports=v,typeof window<"u"&&(window.Suggestions=v)},{"./src/suggestions":21}],20:[function(o,c,d){var v=function(y){return this.component=y,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,y.el.parentNode.insertBefore(this.wrapper,y.el.nextSibling),this};v.prototype.show=function(){this.element.style.display="block"},v.prototype.hide=function(){this.element.style.display="none"},v.prototype.add=function(y){this.items.push(y)},v.prototype.clear=function(){this.items=[],this.active=0},v.prototype.isEmpty=function(){return!this.items.length},v.prototype.isVisible=function(){return this.element.style.display==="block"},v.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var y=0;y<this.items.length;y++)this.drawItem(this.items[y],this.active===y);this.show()},v.prototype.drawItem=function(y,T){var r=document.createElement("li"),D=document.createElement("a");T&&(r.className+=" active"),D.innerHTML=y.string,r.appendChild(D),this.element.appendChild(r),r.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),r.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,y)}).bind(this))},v.prototype.handleMouseUp=function(y){this.selectingListItem=!1,this.component.value(y.original),this.clear(),this.draw()},v.prototype.move=function(y){this.active=y,this.draw()},v.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)},v.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)},v.prototype.drawError=function(y){var T=document.createElement("li");T.innerHTML=y,this.element.appendChild(T),this.show()},c.exports=v},{}],21:[function(o,c,d){var v=o("xtend"),y=o("fuzzy"),T=o("./list"),r=function(D,L,B){return B=B||{},this.options=v({minLength:2,limit:5,filter:!0,hideOnBlur:!0},B),this.el=D,this.data=L||[],this.list=new T(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(U){this.handleKeyUp(U.keyCode)}).bind(this),!1),this.el.addEventListener("keydown",(function(U){this.handleKeyDown(U)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(U){this.handlePaste(U)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};r.prototype.handleKeyUp=function(D){D===40||D===38||D===27||D===13||D===9||this.handleInputChange(this.el.value)},r.prototype.handleKeyDown=function(D){switch(D.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&D.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}},r.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},r.prototype.handlePaste=function(D){if(D.clipboardData)this.handleInputChange(D.clipboardData.getData("Text"));else{var L=this;setTimeout(function(){L.handleInputChange(D.target.value)},100)}},r.prototype.handleInputChange=function(D){if(this.query=this.normalize(D),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(L){for(var B=0;B<L.length&&(this.list.add(L[B]),B!==this.options.limit-1);B++);this.list.draw()}).bind(this))},r.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},r.prototype.update=function(D){this.data=D,this.handleKeyUp()},r.prototype.clear=function(){this.data=[],this.list.clear()},r.prototype.normalize=function(D){return D=D.toLowerCase(),D},r.prototype.match=function(D,L){return D.indexOf(L)>-1},r.prototype.value=function(D){if(this.selected=D,this.el.value=this.getItemValue(D),document.createEvent){var L=document.createEvent("HTMLEvents");L.initEvent("change",!0,!1),this.el.dispatchEvent(L)}else this.el.fireEvent("onchange")},r.prototype.getCandidates=function(D){var L={pre:"<strong>",post:"</strong>",extract:(function(U){return this.getItemValue(U)}).bind(this)},B;this.options.filter?(B=y.filter(this.query,this.data,L),B=B.map((function(U){return{original:U.original,string:this.render(U.original,U.string)}}).bind(this))):B=this.data.map((function(U){var $=this.render(U);return{original:U,string:$}}).bind(this)),D(B)},r.prototype.getItemValue=function(D){return D},r.prototype.render=function(D,L){if(L)return L;for(var B=D.original?this.getItemValue(D.original):this.getItemValue(D),U=this.normalize(B),$=U.lastIndexOf(this.query);$>-1;){var W=$+this.query.length;B=B.slice(0,$)+"<strong>"+B.slice($,W)+"</strong>"+B.slice(W),$=U.slice(0,$).lastIndexOf(this.query)}return B},r.prototype.renderError=function(D){this.list.drawError(D)},c.exports=r},{"./list":20,fuzzy:8,xtend:24}],22:[function(o,c,d){var v=o("turf-meta").coordEach;c.exports=function(y){var T=[1/0,1/0,-1/0,-1/0];return v(y,function(r){T[0]>r[0]&&(T[0]=r[0]),T[1]>r[1]&&(T[1]=r[1]),T[2]<r[0]&&(T[2]=r[0]),T[3]<r[1]&&(T[3]=r[1])}),T}},{"turf-meta":23}],23:[function(o,c,d){function v(D,L,B){var U,$,W,q,ne,ce,oe,fe,be=0,ge,Ee=D.type==="FeatureCollection",de=D.type==="Feature",re=Ee?D.features.length:1;for(U=0;U<re;U++)for(fe=Ee?D.features[U].geometry:de?D.geometry:D,ge=fe.type==="GeometryCollection",ce=ge?fe.geometries.length:1,q=0;q<ce;q++)if(ne=ge?fe.geometries[q]:fe,oe=ne.coordinates,be=B&&(ne.type==="Polygon"||ne.type==="MultiPolygon")?1:0,ne.type==="Point")L(oe);else if(ne.type==="LineString"||ne.type==="MultiPoint")for($=0;$<oe.length;$++)L(oe[$]);else if(ne.type==="Polygon"||ne.type==="MultiLineString")for($=0;$<oe.length;$++)for(W=0;W<oe[$].length-be;W++)L(oe[$][W]);else if(ne.type==="MultiPolygon")for($=0;$<oe.length;$++)for(W=0;W<oe[$].length;W++)for(l=0;l<oe[$][W].length-be;l++)L(oe[$][W][l]);else throw new Error("Unknown Geometry Type")}c.exports.coordEach=v;function y(D,L,B,U){return v(D,function($){B=L(B,$)},U),B}c.exports.coordReduce=y;function T(D,L){var B;switch(D.type){case"FeatureCollection":for(features=D.features,B=0;B<D.features.length;B++)L(D.features[B].properties);break;case"Feature":L(D.properties);break}}c.exports.propEach=T;function r(D,L,B){return T(D,function(U){B=L(B,U)}),B}c.exports.propReduce=r},{}],24:[function(o,c,d){c.exports=y;var v=Object.prototype.hasOwnProperty;function y(){for(var T={},r=0;r<arguments.length;r++){var D=arguments[r];for(var L in D)v.call(D,L)&&(T[L]=D[L])}return T}},{}],25:[function(o,c,d){function v(ht){"@babel/helpers - typeof";return v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(gt){return typeof gt}:function(gt){return gt&&typeof Symbol=="function"&&gt.constructor===Symbol&&gt!==Symbol.prototype?"symbol":typeof gt},v(ht)}Object.defineProperty(d,"__esModule",{value:!0}),d.addWaypoint=rt,d.clearDestination=ie,d.clearOrigin=Y,d.createDestination=tt,d.createOrigin=Le,d.eventEmit=Bt,d.eventSubscribe=bn,d.hoverMarker=ae,d.queryDestination=Ee,d.queryDestinationCoordinates=re,d.queryOrigin=ge,d.queryOriginCoordinates=de,d.removeWaypoint=Ft,d.reverse=Mt,d.setDestinationFromCoordinates=yt,d.setOptions=te,d.setOriginFromCoordinates=Lt,d.setProfile=Je,d.setRouteIndex=pe,d.setWaypoint=mt;var y=L(o("../constants/action_types")),T=r(o("../utils"));function r(ht){return ht&&ht.__esModule?ht:{default:ht}}function D(ht){if(typeof WeakMap!="function")return null;var gt=new WeakMap,et=new WeakMap;return(D=function(St){return St?et:gt})(ht)}function L(ht,gt){if(ht&&ht.__esModule)return ht;if(ht===null||v(ht)!=="object"&&typeof ht!="function")return{default:ht};var et=D(gt);if(et&&et.has(ht))return et.get(ht);var Nt={},St=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Xt in ht)if(Xt!=="default"&&Object.prototype.hasOwnProperty.call(ht,Xt)){var Ie=St?Object.getOwnPropertyDescriptor(ht,Xt):null;Ie&&(Ie.get||Ie.set)?Object.defineProperty(Nt,Xt,Ie):Nt[Xt]=ht[Xt]}return Nt.default=ht,et&&et.set(ht,Nt),Nt}function B(ht){return function(gt){var et=T.default.createPoint(ht,{id:"origin","marker-symbol":"A"});gt({type:y.ORIGIN,origin:et}),gt(Bt("origin",{feature:et}))}}function U(ht){return function(gt){var et=T.default.createPoint(ht,{id:"destination","marker-symbol":"B"});gt({type:y.DESTINATION,destination:et}),gt(Bt("destination",{feature:et}))}}function $(ht){return function(gt){gt({type:y.DIRECTIONS_REQUEST_START,request:ht})}}function W(ht){return function(gt){gt({type:y.DIRECTIONS,directions:ht}),gt(Bt("route",{route:ht}))}}function q(ht){return{type:y.WAYPOINTS,waypoints:ht}}function ne(ht){return{type:y.HOVER_MARKER,hoverMarker:ht}}function ce(){return function(ht,gt){var et=gt(),Nt=et.api,St=et.accessToken,Xt=et.routeIndex,Ie=et.profile,gn=et.alternatives,Ae=et.congestion,Ne=et.destination,Ue=et.language,Et=et.exclude,Ct=et.fetchDirectionsRequest;if(Ne&&Ne.geometry){Ct&&Ct.abort();var Qt=oe(gt),Gt=[];Gt.push("geometries=polyline"),gn&&Gt.push("alternatives=true"),Ae&&Gt.push("annotations=congestion"),Gt.push("steps=true"),Gt.push("overview=full"),Ue&&Gt.push("language="+Ue),Et&&Gt.push("exclude="+Et),St&&Gt.push("access_token="+St);var Yt=new XMLHttpRequest;Yt.open("GET","".concat(Nt).concat(Ie,"/").concat(Qt,".json?").concat(Gt.join("&")),!0),ht($(Yt)),Yt.onload=function(){if(Yt.status>=200&&Yt.status<400){var vn=JSON.parse(Yt.responseText);if(vn.error)return ht(W([])),ht(be(vn.error));if(vn.message==="No route found")return ht(be("No route found"));ht(be(null)),vn.routes[Xt]||ht(pe(0)),ht(W(vn.routes)),ht(B(vn.waypoints[0].location)),ht(U(vn.waypoints[vn.waypoints.length-1].location))}else return ht(W([])),ht(be(JSON.parse(Yt.responseText).message))},Yt.onerror=function(){return ht(W([])),Yt.responseText?ht(be(JSON.parse(Yt.responseText).message)):ht(be("Error"))},Yt.send()}}}function oe(ht){var gt=ht(),et=gt.origin,Nt=gt.destination,St=gt.waypoints,Xt=[];return Xt.push(et.geometry.coordinates.join(",")),Xt.push(";"),St.length&&St.forEach(function(Ie){Xt.push(Ie.geometry.coordinates.join(",")),Xt.push(";")}),Xt.push(Nt.geometry.coordinates.join(",")),encodeURIComponent(Xt.join(""))}function fe(ht){var gt={id:"waypoint"};return Object.assign(ht,{properties:ht.properties?Object.assign(ht.properties,gt):gt})}function be(ht){return function(gt){gt({type:"ERROR",error:ht}),ht&&gt(Bt("error",{error:ht}))}}function ge(ht){return{type:y.ORIGIN_QUERY,query:ht}}function Ee(ht){return{type:y.DESTINATION_QUERY,query:ht}}function de(ht){return{type:y.ORIGIN_FROM_COORDINATES,coordinates:ht}}function re(ht){return{type:y.DESTINATION_FROM_COORDINATES,coordinates:ht}}function Y(){return function(ht){ht({type:y.ORIGIN_CLEAR}),ht(Bt("clear",{type:"origin"})),ht(be(null))}}function ie(){return function(ht,gt){var et=gt(),Nt=et.fetchDirectionsRequest;Nt&&Nt.abort(),ht({type:y.DESTINATION_CLEAR}),ht(Bt("clear",{type:"destination"})),ht(be(null))}}function te(ht){return{type:y.SET_OPTIONS,options:ht}}function ae(ht){return function(gt){var et=ht?T.default.createPoint(ht,{id:"hover"}):{};gt(ne(et))}}function pe(ht){return{type:y.ROUTE_INDEX,routeIndex:ht}}function Le(ht){return function(gt,et){var Nt=et(),St=Nt.destination;gt(B(ht)),St.geometry&&gt(ce())}}function tt(ht){return function(gt,et){var Nt=et(),St=Nt.origin;gt(U(ht)),St.geometry&&gt(ce())}}function Je(ht){return function(gt,et){var Nt=et(),St=Nt.origin,Xt=Nt.destination;gt({type:y.DIRECTIONS_PROFILE,profile:ht}),gt(Bt("profile",{profile:ht})),St.geometry&&Xt.geometry&&gt(ce())}}function Mt(){return function(ht,gt){var et=gt();et.destination.geometry&&ht(B(et.destination.geometry.coordinates)),et.origin.geometry&&ht(U(et.origin.geometry.coordinates)),et.origin.geometry&&et.destination.geometry&&ht(ce());for(var Nt=document.getElementsByClassName("suggestions"),St=0;St<Nt.length;St++)Nt[St].style.visibility="hidden"}}function Lt(ht){return function(gt){if(T.default.validCoords(ht)||(ht=[T.default.wrap(ht[0]),T.default.wrap(ht[1])]),isNaN(ht[0])&&isNaN(ht[1]))return gt(be(new Error("Coordinates are not valid")));gt(de(ht)),gt(Le(ht))}}function yt(ht){return function(gt){if(T.default.validCoords(ht)||(ht=[T.default.wrap(ht[0]),T.default.wrap(ht[1])]),isNaN(ht[0])&&isNaN(ht[1]))return gt(be(new Error("Coordinates are not valid")));gt(tt(ht)),gt(re(ht))}}function rt(ht,gt){return function(et,Nt){var St=Nt(),Xt=St.destination,Ie=St.waypoints;Ie.splice(ht,0,fe(gt)),et(q(Ie)),Xt.geometry&&et(ce())}}function mt(ht,gt){return function(et,Nt){var St=Nt(),Xt=St.destination,Ie=St.waypoints;Ie[ht]=fe(gt),et(q(Ie)),Xt.geometry&&et(ce())}}function Ft(ht){return function(gt,et){var Nt=et(),St=Nt.destination,Xt=Nt.waypoints;Xt=Xt.filter(function(Ie){return!T.default.coordinateMatch(Ie,ht)}),gt(q(Xt)),St.geometry&&gt(ce())}}function bn(ht,gt){return function(et,Nt){var St=Nt(),Xt=St.events;return Xt[ht]=Xt[ht]||[],Xt[ht].push(gt),{type:y.EVENTS,events:Xt}}}function Bt(ht,gt){var et=this;return function(Nt,St){var Xt=St(),Ie=Xt.events;if(!Ie[ht])return{type:y.EVENTS,events:Ie};for(var gn=Ie[ht].slice(),Ae=0;Ae<gn.length;Ae++)gn[Ae].call(et,gt)}}},{"../constants/action_types":26,"../utils":34}],26:[function(o,c,d){Object.defineProperty(d,"__esModule",{value:!0}),d.WAYPOINTS=d.SET_OPTIONS=d.ROUTE_INDEX=d.ORIGIN_QUERY=d.ORIGIN_FROM_COORDINATES=d.ORIGIN_CLEAR=d.ORIGIN=d.HOVER_MARKER=d.EVENTS=d.ERROR=d.DIRECTIONS_REQUEST_START=d.DIRECTIONS_PROFILE=d.DIRECTIONS=d.DESTINATION_QUERY=d.DESTINATION_FROM_COORDINATES=d.DESTINATION_CLEAR=d.DESTINATION=void 0;var v="DESTINATION";d.DESTINATION=v;var y="DESTINATION_CLEAR";d.DESTINATION_CLEAR=y;var T="DESTINATION_QUERY";d.DESTINATION_QUERY=T;var r="DESTINATION_FROM_COORDINATES";d.DESTINATION_FROM_COORDINATES=r;var D="DIRECTIONS";d.DIRECTIONS=D;var L="DIRECTIONS_REQUEST_START";d.DIRECTIONS_REQUEST_START=L;var B="DIRECTIONS_PROFILE";d.DIRECTIONS_PROFILE=B;var U="EVENTS";d.EVENTS=U;var $="ERROR";d.ERROR=$;var W="HOVER_MARKER";d.HOVER_MARKER=W;var q="ORIGIN";d.ORIGIN=q;var ne="ORIGIN_CLEAR";d.ORIGIN_CLEAR=ne;var ce="ORIGIN_QUERY";d.ORIGIN_QUERY=ce;var oe="ORIGIN_FROM_COORDINATES";d.ORIGIN_FROM_COORDINATES=oe;var fe="ROUTE_INDEX";d.ROUTE_INDEX=fe;var be="SET_OPTIONS";d.SET_OPTIONS=be;var ge="WAYPOINTS";d.WAYPOINTS=ge},{}],27:[function(o,c,d){Object.defineProperty(d,"__esModule",{value:!0}),d.default=void 0;var v=D(o("suggestions")),y=D(o("lodash.debounce")),T=o("events"),r=D(o("../utils"));function D(ce){return ce&&ce.__esModule?ce:{default:ce}}function L(ce){"@babel/helpers - typeof";return L=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(oe){return typeof oe}:function(oe){return oe&&typeof Symbol=="function"&&oe.constructor===Symbol&&oe!==Symbol.prototype?"symbol":typeof oe},L(ce)}function B(ce,oe){if(!(ce instanceof oe))throw new TypeError("Cannot call a class as a function")}function U(ce,oe){for(var fe=0;fe<oe.length;fe++){var be=oe[fe];be.enumerable=be.enumerable||!1,be.configurable=!0,"value"in be&&(be.writable=!0),Object.defineProperty(ce,W(be.key),be)}}function $(ce,oe,fe){return oe&&U(ce.prototype,oe),Object.defineProperty(ce,"prototype",{writable:!1}),ce}function W(ce){var oe=q(ce,"string");return L(oe)==="symbol"?oe:String(oe)}function q(ce,oe){if(L(ce)!=="object"||ce===null)return ce;var fe=ce[Symbol.toPrimitive];if(fe!==void 0){var be=fe.call(ce,oe);if(L(be)!=="object")return be;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(ce)}var ne=function(){function ce(oe){B(this,ce),this._ev=new T.EventEmitter,this.options=oe,this.api=oe&&oe.api||"https://api.mapbox.com/geocoding/v5/mapbox.places/"}return $(ce,[{key:"onAdd",value:function(fe){this._map=fe,this.request=new XMLHttpRequest;var be=document.createElement("div");be.className="mapboxgl-ctrl-geocoder";var ge=document.createElement("span");ge.className="geocoder-icon geocoder-icon-search";var Ee=this._inputEl=document.createElement("input");Ee.type="text",Ee.placeholder=this.options.placeholder,Ee.addEventListener("keydown",(0,y.default)((function(ie){if(!ie.target.value)return this._clearEl.classList.remove("active");ie.metaKey||[9,27,37,39,13,38,40].indexOf(ie.keyCode)!==-1||this._queryFromInput(ie.target.value)}).bind(this)),200),Ee.addEventListener("change",(function(ie){ie.target.value&&this._clearEl.classList.add("active");var te=this._typeahead.selected;if(te){if(this.options.flyTo)if(te.bbox&&te.context&&te.context.length<=3||te.bbox&&!te.context){var ae=te.bbox;fe.fitBounds([[ae[0],ae[1]],[ae[2],ae[3]]])}else fe.flyTo({center:te.center,zoom:this.options.zoom});this._input=te,this.fire("result",{result:te})}}).bind(this));var de=document.createElement("div");de.classList.add("geocoder-pin-right");var re=this._clearEl=document.createElement("button");re.className="geocoder-icon geocoder-icon-close",re.addEventListener("click",this._clear.bind(this));var Y=this._loadingEl=document.createElement("span");return Y.className="geocoder-icon geocoder-icon-loading",de.appendChild(re),de.appendChild(Y),be.appendChild(ge),be.appendChild(Ee),be.appendChild(de),this.options.container&&(this.options.position=!1),this._typeahead=new v.default(Ee,[],{filter:!1}),this._typeahead.getItemValue=function(ie){return ie.place_name},be}},{key:"_geocode",value:function(fe,be){this._loadingEl.classList.add("active"),this.fire("loading");var ge=this.options,Ee=["placeholder","zoom","flyTo","accessToken","api"],de=Object.keys(this.options).filter(function(Y){return Ee.indexOf(Y)===-1}).map(function(Y){return Y+"="+ge[Y]}),re=this.options.accessToken?this.options.accessToken:mapboxgl.accessToken;de.push("access_token="+re),this.request.abort(),this.request.open("GET",this.api+encodeURIComponent(fe.trim())+".json?"+de.join("&"),!0),this.request.onload=(function(){if(this._loadingEl.classList.remove("active"),this.request.status>=200&&this.request.status<400){var Y=JSON.parse(this.request.responseText);return Y.features.length?this._clearEl.classList.add("active"):(this._clearEl.classList.remove("active"),this._typeahead.selected=null),this.fire("results",{results:Y.features}),this._typeahead.update(Y.features),be(Y.features)}else this.fire("error",{error:JSON.parse(this.request.responseText).message})}).bind(this),this.request.onerror=(function(){this._loadingEl.classList.remove("active"),this.fire("error",{error:JSON.parse(this.request.responseText).message})}).bind(this),this.request.send()}},{key:"_queryFromInput",value:function(fe){fe=fe.trim(),fe||this._clear(),fe.length>2&&this._geocode(fe,(function(be){this._results=be}).bind(this))}},{key:"_change",value:function(){var fe=document.createEvent("HTMLEvents");fe.initEvent("change",!0,!1),this._inputEl.dispatchEvent(fe)}},{key:"_query",value:function(fe){fe&&(L(fe)==="object"&&fe.length&&(fe=[r.default.wrap(fe[0]),r.default.wrap(fe[1])].join()),this._geocode(fe,(function(be){if(be.length){var ge=be[0];this._results=be,this._typeahead.selected=ge,this._inputEl.value=ge.place_name,this._change()}}).bind(this)))}},{key:"_setInput",value:function(fe){fe&&(L(fe)==="object"&&fe.length&&(fe=[r.default.roundWithOriginalPrecision(r.default.wrap(fe[0]),fe[0]),r.default.roundWithOriginalPrecision(r.default.wrap(fe[1]),fe[1])].join()),this._inputEl.value=fe,this._input=null,this._typeahead.selected=null,this._typeahead.clear(),this._change())}},{key:"_clear",value:function(){this._input=null,this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._change(),this._inputEl.focus(),this._clearEl.classList.remove("active"),this.fire("clear")}},{key:"getResult",value:function(){return this._input}},{key:"query",value:function(fe){return this._query(fe),this}},{key:"setInput",value:function(fe){return this._setInput(fe),this}},{key:"on",value:function(fe,be){return this._ev.on(fe,be),this._ev.on("error",function(ge){console.log(ge)}),this}},{key:"fire",value:function(fe,be){return this._ev.emit(fe,be),this}},{key:"off",value:function(fe,be){return this._ev.removeListener(fe,be),this}}]),ce}();d.default=ne},{"../utils":34,events:7,"lodash.debounce":10,suggestions:19}],28:[function(o,c,d){Object.defineProperty(d,"__esModule",{value:!0}),d.default=void 0;var v=D(o("./geocoder")),y=D(o("lodash.template")),T=D(o("lodash.isequal")),r=D(o("turf-extent"));function D(oe){return oe&&oe.__esModule?oe:{default:oe}}function L(oe){"@babel/helpers - typeof";return L=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(fe){return typeof fe}:function(fe){return fe&&typeof Symbol=="function"&&fe.constructor===Symbol&&fe!==Symbol.prototype?"symbol":typeof fe},L(oe)}function B(oe,fe){if(!(oe instanceof fe))throw new TypeError("Cannot call a class as a function")}function U(oe,fe){for(var be=0;be<fe.length;be++){var ge=fe[be];ge.enumerable=ge.enumerable||!1,ge.configurable=!0,"value"in ge&&(ge.writable=!0),Object.defineProperty(oe,W(ge.key),ge)}}function $(oe,fe,be){return fe&&U(oe.prototype,fe),Object.defineProperty(oe,"prototype",{writable:!1}),oe}function W(oe){var fe=q(oe,"string");return L(fe)==="symbol"?fe:String(fe)}function q(oe,fe){if(L(oe)!=="object"||oe===null)return oe;var be=oe[Symbol.toPrimitive];if(be!==void 0){var ge=be.call(oe,fe);if(L(ge)!=="object")return ge;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(oe)}var ne=(0,y.default)(`<div class='mapbox-directions-component mapbox-directions-inputs'>
  <div class='mapbox-directions-component-keyline'>
    <div class='mapbox-directions-origin'>
      <label class='mapbox-form-label'>
        <span class='directions-icon directions-icon-depart'></span>
      </label>
      <div id='mapbox-directions-origin-input'></div>
    </div>

    <button
      class='directions-icon directions-icon-reverse directions-reverse js-reverse-inputs'
      title='Reverse origin &amp; destination'>
    </button>

    <div class='mapbox-directions-destination'>
      <label class='mapbox-form-label'>
        <span class='directions-icon directions-icon-arrive'></span>
      </label>
      <div id='mapbox-directions-destination-input'></div>
    </div>
  </div>

  <% if (controls.profileSwitcher) { %>
  <div class='mapbox-directions-profile mapbox-directions-component-keyline mapbox-directions-clearfix'><input
      id='mapbox-directions-profile-driving-traffic'
      type='radio'
      name='profile'
      value='mapbox/driving-traffic'
      <% if (profile === 'mapbox/driving-traffic') { %>checked<% } %>
    />
    <label for='mapbox-directions-profile-driving-traffic'>Traffic</label>
    <input
      id='mapbox-directions-profile-driving'
      type='radio'
      name='profile'
      value='mapbox/driving'
      <% if (profile === 'mapbox/driving') { %>checked<% } %>
    />
    <label for='mapbox-directions-profile-driving'>Driving</label>
    <input
      id='mapbox-directions-profile-walking'
      type='radio'
      name='profile'
      value='mapbox/walking'
      <% if (profile === 'mapbox/walking') { %>checked<% } %>
    />
    <label for='mapbox-directions-profile-walking'>Walking</label>
    <input
      id='mapbox-directions-profile-cycling'
      type='radio'
      name='profile'
      value='mapbox/cycling'
      <% if (profile === 'mapbox/cycling') { %>checked<% } %>
    />
    <label for='mapbox-directions-profile-cycling'>Cycling</label>
  </div>
  <% } %>
</div>
`),ce=function(){function oe(fe,be,ge,Ee){B(this,oe);var de=be.getState(),re=de.originQuery,Y=de.destinationQuery,ie=de.profile,te=de.controls;fe.innerHTML=ne({originQuery:re,destinationQuery:Y,profile:ie,controls:te}),this.container=fe,this.actions=ge,this.store=be,this._map=Ee,this.onAdd(),this.render()}return $(oe,[{key:"animateToCoordinates",value:function(be,ge){var Ee=this.store.getState(),de=Ee.origin,re=Ee.destination,Y=Ee.routePadding;if(de.geometry&&re.geometry&&!(0,T.default)(de.geometry,re.geometry)){var ie=(0,r.default)({type:"FeatureCollection",features:[de,re]});this._map.fitBounds([[ie[0],ie[1]],[ie[2],ie[3]]],{padding:Y})}else this._map.flyTo({center:ge})}},{key:"onAdd",value:function(){var be=this,ge=this.actions,Ee=ge.clearOrigin,de=ge.clearDestination,re=ge.createOrigin,Y=ge.createDestination,ie=ge.setProfile,te=ge.reverse,ae=this.store.getState(),pe=ae.geocoder,Le=ae.accessToken,tt=ae.flyTo,Je=ae.placeholderOrigin,Mt=ae.placeholderDestination,Lt=ae.zoom;this.originInput=new v.default(Object.assign({},{accessToken:Le},pe,{flyTo:tt,placeholder:Je,zoom:Lt}));var yt=this.originInput.onAdd(this._map),rt=this.container.querySelector("#mapbox-directions-origin-input");rt.appendChild(yt),this.destinationInput=new v.default(Object.assign({},{accessToken:Le},pe,{flyTo:tt,placeholder:Mt,zoom:Lt}));var mt=this.destinationInput.onAdd(this._map);this.container.querySelector("#mapbox-directions-destination-input").appendChild(mt),this.originInput.on("result",function(bn){var Bt=bn.result.center;re(Bt),be.animateToCoordinates("origin",Bt)}),this.originInput.on("clear",Ee),this.destinationInput.on("result",function(bn){var Bt=bn.result.center;Y(Bt),be.animateToCoordinates("destination",Bt)}),this.destinationInput.on("clear",de);var Ft=this.container.querySelectorAll('input[type="radio"]');Array.prototype.forEach.call(Ft,function(bn){bn.addEventListener("change",function(){ie(bn.value)})}),this.container.querySelector(".js-reverse-inputs").addEventListener("click",function(){var bn=be.store.getState(),Bt=bn.origin,ht=bn.destination;Bt&&be.actions.queryDestination(Bt.geometry.coordinates),ht&&be.actions.queryOrigin(ht.geometry.coordinates),te()})}},{key:"render",value:function(){var be=this;this.store.subscribe(function(){var ge=be.store.getState(),Ee=ge.originQuery,de=ge.destinationQuery,re=ge.originQueryCoordinates,Y=ge.destinationQueryCoordinates;Ee&&(be.originInput.query(Ee),be.actions.queryOrigin(null)),de&&(be.destinationInput.query(de),be.actions.queryDestination(null)),re&&(be.originInput.setInput(re),be.animateToCoordinates("origin",re),be.actions.queryOriginCoordinates(null)),Y&&(be.destinationInput.setInput(Y),be.animateToCoordinates("destination",Y),be.actions.queryDestinationCoordinates(null))})}}]),oe}();d.default=ce},{"./geocoder":27,"lodash.isequal":11,"lodash.template":12,"turf-extent":22}],29:[function(o,c,d){Object.defineProperty(d,"__esModule",{value:!0}),d.default=void 0;var v=r(o("../utils")),y=r(o("lodash.template")),T=r(o("lodash.isequal"));function r(oe){return oe&&oe.__esModule?oe:{default:oe}}function D(oe){"@babel/helpers - typeof";return D=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(fe){return typeof fe}:function(fe){return fe&&typeof Symbol=="function"&&fe.constructor===Symbol&&fe!==Symbol.prototype?"symbol":typeof fe},D(oe)}function L(oe,fe){if(!(oe instanceof fe))throw new TypeError("Cannot call a class as a function")}function B(oe,fe){for(var be=0;be<fe.length;be++){var ge=fe[be];ge.enumerable=ge.enumerable||!1,ge.configurable=!0,"value"in ge&&(ge.writable=!0),Object.defineProperty(oe,$(ge.key),ge)}}function U(oe,fe,be){return fe&&B(oe.prototype,fe),Object.defineProperty(oe,"prototype",{writable:!1}),oe}function $(oe){var fe=W(oe,"string");return D(fe)==="symbol"?fe:String(fe)}function W(oe,fe){if(D(oe)!=="object"||oe===null)return oe;var be=oe[Symbol.toPrimitive];if(be!==void 0){var ge=be.call(oe,fe);if(D(ge)!=="object")return ge;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(oe)}var q=(0,y.default)(`<div class='directions-control directions-control-directions'>
  <div class='mapbox-directions-component mapbox-directions-route-summary<% if (routes > 1) { %> mapbox-directions-multiple<% } %>'>
    <% if (routes > 1) { %>
    <div class='mapbox-directions-routes mapbox-directions-clearfix'>
      <% for (var i = 0; i < routes; i++) { %>
        <input type='radio' name='routes' id='<%= i %>' <% if (i === routeIndex) { %>checked<% } %>>
        <label for='<%= i %>' class='mapbox-directions-route'><%= i + 1 %></label>
      <% } %>
    </div>
    <% } %>
    <h1><%- duration %></h1>
    <span><%- distance %></span>
  </div>

  <div class='mapbox-directions-instructions'>
    <div class='mapbox-directions-instructions-wrapper'>
      <ol class='mapbox-directions-steps'>
        <% steps.forEach(function(step) { %>
          <%
            var distance = step.distance ? format(step.distance) : false;
            var icon = step.maneuver.modifier ? step.maneuver.modifier.replace(/\\s+/g, '-').toLowerCase() : step.maneuver.type.replace(/\\s+/g, '-').toLowerCase();

            if (['arrive', 'depart', 'waypoint'].includes(step.maneuver.type)) {
              icon = step.maneuver.type;
            }

            if (step.maneuver.type === 'roundabout' || step.maneuver.type === 'rotary') {
              icon = 'roundabout';
            }

            var lng = step.maneuver.location[0];
            var lat = step.maneuver.location[1];
          %>
          <li
            data-lat='<%= lat %>'
            data-lng='<%= lng %>'
            class='mapbox-directions-step'>
            <span class='directions-icon directions-icon-<%= icon %>'></span>
            <div class='mapbox-directions-step-maneuver'>
              <%= step.maneuver.instruction %>
            </div>
            <% if (distance) { %>
              <div class='mapbox-directions-step-distance'>
                <%= distance %>
              </div>
            <% } %>
          </li>
        <% }); %>
      </ol>
    </div>
  </div>
</div>
`),ne=(0,y.default)(`<div class='directions-control directions-control-directions'>
  <div class='mapbox-directions-error'>
    <%= error %>
  </div>
</div>
`),ce=function(){function oe(fe,be,ge,Ee){L(this,oe),this.container=fe,this.actions=ge,this.store=be,this._map=Ee,this.directions={},this.render()}return U(oe,[{key:"render",value:function(){var be=this;this.store.subscribe(function(){var ge=be.actions,Ee=ge.hoverMarker,de=ge.setRouteIndex,re=be.store.getState(),Y=re.routeIndex,ie=re.unit,te=re.directions,ae=re.error,pe=re.compile,Le=re.instructions,tt=!(0,T.default)(te[Y],be.directions);if(ae){be.container.innerHTML=ne({error:ae});return}var Je=Le.showWaypointInstructions?void 0:function(mt){return mt.maneuver.type!=="waypoint"};if(te.length&&tt){var Mt=be.directions=te[Y],Lt=v.default.getAllSteps(Mt,Je);pe&&Mt.legs.forEach(function(mt){mt.steps.forEach(function(Ft){Ft.maneuver.instruction=pe("en",Ft)})}),be.container.innerHTML=q({routeIndex:Y,routes:te.length,steps:Lt,format:v.default.format[ie],duration:v.default.format.duration(Mt.duration),distance:v.default.format[ie](Mt.distance)});var yt=be.container.querySelectorAll(".mapbox-directions-step");Array.prototype.forEach.call(yt,function(mt){var Ft=mt.getAttribute("data-lng"),bn=mt.getAttribute("data-lat");mt.addEventListener("mouseover",function(){Ee([Ft,bn])}),mt.addEventListener("mouseout",function(){Ee(null)}),mt.addEventListener("click",function(){be._map.flyTo({center:[Ft,bn],zoom:16})})});var rt=be.container.querySelectorAll('input[type="radio"]');Array.prototype.forEach.call(rt,function(mt){mt.addEventListener("change",function(Ft){de(parseInt(Ft.target.id,10))})})}else be.container.innerHTML&&tt&&(be.container.innerHTML="")})}}]),oe}();d.default=ce},{"../utils":34,"lodash.isequal":11,"lodash.template":12}],30:[function(o,c,d){Object.defineProperty(d,"__esModule",{value:!0}),d.default=void 0;var v=o("redux"),y=ne(o("redux-thunk")),T=o("@mapbox/polyline"),r=ne(o("./utils")),D=ne(o("./reducers")),L=q(o("./actions")),B=ne(o("./directions_style")),U=ne(o("./controls/inputs")),$=ne(o("./controls/instructions"));function W(re){if(typeof WeakMap!="function")return null;var Y=new WeakMap,ie=new WeakMap;return(W=function(ae){return ae?ie:Y})(re)}function q(re,Y){if(re&&re.__esModule)return re;if(re===null||ce(re)!=="object"&&typeof re!="function")return{default:re};var ie=W(Y);if(ie&&ie.has(re))return ie.get(re);var te={},ae=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var pe in re)if(pe!=="default"&&Object.prototype.hasOwnProperty.call(re,pe)){var Le=ae?Object.getOwnPropertyDescriptor(re,pe):null;Le&&(Le.get||Le.set)?Object.defineProperty(te,pe,Le):te[pe]=re[pe]}return te.default=re,ie&&ie.set(re,te),te}function ne(re){return re&&re.__esModule?re:{default:re}}function ce(re){"@babel/helpers - typeof";return ce=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Y){return typeof Y}:function(Y){return Y&&typeof Symbol=="function"&&Y.constructor===Symbol&&Y!==Symbol.prototype?"symbol":typeof Y},ce(re)}function oe(re,Y){if(!(re instanceof Y))throw new TypeError("Cannot call a class as a function")}function fe(re,Y){for(var ie=0;ie<Y.length;ie++){var te=Y[ie];te.enumerable=te.enumerable||!1,te.configurable=!0,"value"in te&&(te.writable=!0),Object.defineProperty(re,ge(te.key),te)}}function be(re,Y,ie){return Y&&fe(re.prototype,Y),Object.defineProperty(re,"prototype",{writable:!1}),re}function ge(re){var Y=Ee(re,"string");return ce(Y)==="symbol"?Y:String(Y)}function Ee(re,Y){if(ce(re)!=="object"||re===null)return re;var ie=re[Symbol.toPrimitive];if(ie!==void 0){var te=ie.call(re,Y);if(ce(te)!=="object")return te;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(re)}var de=function(){function re(Y){oe(this,re),this._directions=null,this._stateSnapshot=null,this._store=this._initStore(),this.actions=(0,v.bindActionCreators)(L,this._store.dispatch),this.actions.setOptions(Y||{}),this.options=Y||{},this.onDragDown=this._onDragDown.bind(this),this.onDragMove=this._onDragMove.bind(this),this.onDragUp=this._onDragUp.bind(this),this.move=this._move.bind(this),this.onClick=this._clickHandler().bind(this)}return be(re,[{key:"onAdd",value:function(ie){var te=this;this._map=ie;var ae=this._store.getState(),pe=ae.controls,Le=this.container=document.createElement("div");Le.className="mapboxgl-ctrl-directions mapboxgl-ctrl";var tt=document.createElement("div");tt.className="directions-control directions-control-inputs",new U.default(tt,this._store,this.actions,this._map);var Je=document.createElement("div");return Je.className="directions-control directions-control-instructions",new $.default(Je,this._store,{hoverMarker:this.actions.hoverMarker,setRouteIndex:this.actions.setRouteIndex},this._map),pe.inputs&&Le.appendChild(tt),pe.instructions&&Le.appendChild(Je),this.subscribedActions(),this._map.loaded()?this.mapState():this._map.on("load",function(){return te.mapState()}),Le}},{key:"onRemove",value:function(ie){return this.container.parentNode.removeChild(this.container),this.removeRoutes(),ie.off("mousedown",this.onDragDown),ie.off("mousemove",this.move),ie.off("touchstart",this.onDragDown),ie.off("touchstart",this.move),ie.off("click",this.onClick),this.storeUnsubscribe&&(this.storeUnsubscribe(),delete this.storeUnsubscribe),B.default.forEach(function(te){ie.getLayer(te.id)&&ie.removeLayer(te.id)}),ie.getSource("directions")&&ie.removeSource("directions"),ie.getSource("directions:markers")&&ie.removeSource("directions:markers"),this._map=null,this}},{key:"mapState",value:function(){var ie=this,te=this._store.getState(),ae=te.profile;te.alternatives,te.congestion;var pe=te.styles,Le=te.interactive;te.compile,this.actions.eventEmit("profile",{profile:ae});var tt={type:"geojson",data:{type:"FeatureCollection",features:[]}};this._map.addSource("directions",tt),this._map.addSource("directions:markers",tt),pe&&pe.length&&pe.forEach(function(Je){return ie._map.addLayer(Je)}),B.default.forEach(function(Je){ie._map.getLayer(Je.id)||ie._map.addLayer(Je)}),Le&&(this._map.on("mousedown",this.onDragDown),this._map.on("mousemove",this.move),this._map.on("click",this.onClick),this._map.on("touchstart",this.move),this._map.on("touchstart",this.onDragDown))}},{key:"_areMarkersChangedOnly",value:function(ie){var te=this,ae=[];return this._stateSnapshot?(re.SUBSCRIPTION_FIELDS.forEach(function(pe){te._stateSnapshot[pe]!==ie[pe]&&ae.push(pe)}),ae.length<=re.MARKER_FIELDS.length&&ae.every(function(pe){return re.MARKER_FIELDS.includes(pe)})):!1}},{key:"subscribedActions",value:function(){var ie=this;this.storeUnsubscribe=this._store.subscribe(function(){var te=ie._store.getState(),ae=te.origin,pe=te.destination,Le=te.hoverMarker,tt=te.directions,Je=te.routeIndex,Mt=ie._areMarkersChangedOnly(te);ie._stateSnapshot=te;var Lt={type:"FeatureCollection",features:[ae,pe,Le].filter(function(rt){return rt.geometry})};if(ie._map.style&&ie._map.getSource("directions:markers")&&ie._map.getSource("directions:markers").setData(Lt),!Mt){var yt={type:"FeatureCollection",features:[]};tt.length&&tt.forEach(function(rt,mt){var Ft=[],bn=(0,T.decode)(rt.geometry,5).map(function(ht){return ht.reverse()}),Bt=r.default.getAllSteps(rt);bn.forEach(function(ht,gt){var et=Ft[Ft.length-1],Nt=rt.legs[0].annotation&&rt.legs[0].annotation.congestion&&rt.legs[0].annotation.congestion[gt-1];if(et&&(!Nt||et.properties.congestion===Nt))et.geometry.coordinates.push(ht);else{var St={geometry:{type:"LineString",coordinates:[]},properties:{"route-index":mt,route:mt===Je?"selected":"alternate"}};et&&St.geometry.coordinates.push(et.geometry.coordinates[et.geometry.coordinates.length-1]),St.geometry.coordinates.push(ht),Nt&&(St.properties.congestion=rt.legs[0].annotation.congestion[gt-1]),Ft.push(St)}}),yt.features=yt.features.concat(Ft),mt===Je&&Bt.forEach(function(ht){ht.maneuver.type==="waypoint"&&yt.features.push({type:"Feature",geometry:{type:"Point",coordinates:ht.maneuver.location},properties:{id:"waypoint"}})})}),ie._map.style&&ie._map.getSource("directions")&&ie._map.getSource("directions").setData(yt)}})}},{key:"_initStore",value:function(){var ie=(0,v.applyMiddleware)(y.default)(v.createStore);return ie(D.default)}},{key:"_clickHandler",value:function(){var ie=null,te=250;return function(ae){if(ie)clearTimeout(ie),ie=null,this._map.zoomIn();else{var pe=this._onSingleClick.bind(this);ie=setTimeout(function(){pe(ae),ie=null},te)}}}},{key:"_onSingleClick",value:function(ie){var te=this,ae=this._store.getState(),pe=ae.origin,Le=[ie.lngLat.lng,ie.lngLat.lat];if(!pe.geometry)this.actions.setOriginFromCoordinates(Le);else{var tt=this._map.queryRenderedFeatures(ie.point,{layers:["directions-origin-point","directions-destination-point","directions-waypoint-point","directions-route-line-alt"]});if(tt.length){if(tt.forEach(function(Mt){Mt.layer.id==="directions-waypoint-point"&&te.actions.removeWaypoint(Mt)}),tt[0].properties.route==="alternate"){var Je=tt[0].properties["route-index"];this.actions.setRouteIndex(Je)}}else this.actions.setDestinationFromCoordinates(Le),this._map.flyTo({center:Le})}}},{key:"_move",value:function(ie){var te=this,ae=this._store.getState(),pe=ae.hoverMarker,Le=this._map.queryRenderedFeatures(ie.point,{layers:["directions-route-line-alt","directions-route-line","directions-origin-point","directions-destination-point","directions-hover-point"]});this._map.getCanvas().style.cursor=Le.length?"pointer":"",Le.length?(this.isCursorOverPoint=Le[0],this._map.dragPan.disable(),Le.forEach(function(tt){tt.layer.id==="directions-route-line"?te.actions.hoverMarker([ie.lngLat.lng,ie.lngLat.lat]):pe.geometry&&te.actions.hoverMarker(null)})):this.isCursorOverPoint&&(this.isCursorOverPoint=!1,this._map.dragPan.enable())}},{key:"_onDragDown",value:function(){this.isCursorOverPoint&&(this.isDragging=this.isCursorOverPoint,this._map.getCanvas().style.cursor="grab",this._map.on("mousemove",this.onDragMove),this._map.on("mouseup",this.onDragUp),this._map.on("touchmove",this.onDragMove),this._map.on("touchend",this.onDragUp))}},{key:"_onDragMove",value:function(ie){if(this.isDragging){var te=[ie.lngLat.lng,ie.lngLat.lat];switch(this.isDragging.layer.id){case"directions-origin-point":this.actions.createOrigin(te);break;case"directions-destination-point":this.actions.createDestination(te);break;case"directions-hover-point":this.actions.hoverMarker(te);break}}}},{key:"_onDragUp",value:function(){if(this.isDragging){var ie=this._store.getState(),te=ie.hoverMarker,ae=ie.origin,pe=ie.destination;switch(this.isDragging.layer.id){case"directions-origin-point":this.actions.setOriginFromCoordinates(ae.geometry.coordinates);break;case"directions-destination-point":this.actions.setDestinationFromCoordinates(pe.geometry.coordinates);break;case"directions-hover-point":te.geometry&&!r.default.coordinateMatch(this.isDragging,te)&&this.actions.addWaypoint(0,te);break}this.isDragging=!1,this._map.getCanvas().style.cursor="",this._map.off("touchmove",this.onDragMove),this._map.off("touchend",this.onDragUp),this._map.off("mousemove",this.onDragMove),this._map.off("mouseup",this.onDragUp)}}},{key:"interactive",value:function(ie){return ie?(this._map.on("touchstart",this.move),this._map.on("touchstart",this.onDragDown),this._map.on("mousedown",this.onDragDown),this._map.on("mousemove",this.move),this._map.on("click",this.onClick)):(this._map.off("touchstart",this.move),this._map.off("touchstart",this.onDragDown),this._map.off("mousedown",this.onDragDown),this._map.off("mousemove",this.move),this._map.off("click",this.onClick)),this}},{key:"getOrigin",value:function(){return this._store.getState().origin}},{key:"setOrigin",value:function(ie){return typeof ie=="string"?this.actions.queryOrigin(ie):this.actions.setOriginFromCoordinates(ie),this}},{key:"getDestination",value:function(){return this._store.getState().destination}},{key:"setDestination",value:function(ie){return typeof ie=="string"?this.actions.queryDestination(ie):this.actions.setDestinationFromCoordinates(ie),this}},{key:"reverse",value:function(){return this.actions.reverse(),this}},{key:"addWaypoint",value:function(ie,te){return te.type||(te=r.default.createPoint(te,{id:"waypoint"})),this.actions.addWaypoint(ie,te),this}},{key:"setWaypoint",value:function(ie,te){return te.type||(te=r.default.createPoint(te,{id:"waypoint"})),this.actions.setWaypoint(ie,te),this}},{key:"removeWaypoint",value:function(ie){var te=this._store.getState(),ae=te.waypoints;return this.actions.removeWaypoint(ae[ie]),this}},{key:"getWaypoints",value:function(){return this._store.getState().waypoints}},{key:"removeRoutes",value:function(){return this.actions.clearOrigin(),this.actions.clearDestination(),this}},{key:"on",value:function(ie,te){return this.actions.eventSubscribe(ie,te),this}}]),re}();d.default=de,de.MARKER_FIELDS=["origin","destination","hoverMarker"],de.SUBSCRIPTION_FIELDS=["origin","destination","hovedMarker","directions","routeIndex"]},{"./actions":25,"./controls/inputs":28,"./controls/instructions":29,"./directions_style":31,"./reducers":33,"./utils":34,"@mapbox/polyline":6,redux:18,"redux-thunk":17}],31:[function(o,c,d){Object.defineProperty(d,"__esModule",{value:!0}),d.default=void 0;var v=[{id:"directions-route-line-alt",type:"line",source:"directions",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#bbb","line-width":4},filter:["all",["in","$type","LineString"],["in","route","alternate"]]},{id:"directions-route-line-casing",type:"line",source:"directions",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#2d5f99","line-width":12},filter:["all",["in","$type","LineString"],["in","route","selected"]]},{id:"directions-route-line",type:"line",source:"directions",layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":{property:"congestion",type:"categorical",default:"#4882c5",stops:[["unknown","#4882c5"],["low","#4882c5"],["moderate","#f09a46"],["heavy","#e34341"],["severe","#8b2342"]]},"line-width":7},filter:["all",["in","$type","LineString"],["in","route","selected"]]},{id:"directions-hover-point-casing",type:"circle",source:"directions:markers",paint:{"circle-radius":8,"circle-color":"#fff"},filter:["all",["in","$type","Point"],["in","id","hover"]]},{id:"directions-hover-point",type:"circle",source:"directions:markers",paint:{"circle-radius":6,"circle-color":"#3bb2d0"},filter:["all",["in","$type","Point"],["in","id","hover"]]},{id:"directions-waypoint-point-casing",type:"circle",source:"directions:markers",paint:{"circle-radius":8,"circle-color":"#fff"},filter:["all",["in","$type","Point"],["in","id","waypoint"]]},{id:"directions-waypoint-point",type:"circle",source:"directions:markers",paint:{"circle-radius":6,"circle-color":"#8a8bc9"},filter:["all",["in","$type","Point"],["in","id","waypoint"]]},{id:"directions-origin-point",type:"circle",source:"directions:markers",paint:{"circle-radius":18,"circle-color":"#3bb2d0"},filter:["all",["in","$type","Point"],["in","marker-symbol","A"]]},{id:"directions-origin-label",type:"symbol",source:"directions:markers",layout:{"text-field":"A","text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"#fff"},filter:["all",["in","$type","Point"],["in","marker-symbol","A"]]},{id:"directions-destination-point",type:"circle",source:"directions:markers",paint:{"circle-radius":18,"circle-color":"#8a8bc9"},filter:["all",["in","$type","Point"],["in","marker-symbol","B"]]},{id:"directions-destination-label",type:"symbol",source:"directions:markers",layout:{"text-field":"B","text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"#fff"},filter:["all",["in","$type","Point"],["in","marker-symbol","B"]]}],y=v;d.default=y},{}],32:[function(o,c,d){var v=y(o("./directions"));function y(T){return T&&T.__esModule?T:{default:T}}c.exports=v.default},{"./directions":30}],33:[function(o,c,d){function v(W){"@babel/helpers - typeof";return v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(q){return typeof q}:function(q){return q&&typeof Symbol=="function"&&q.constructor===Symbol&&q!==Symbol.prototype?"symbol":typeof q},v(W)}Object.defineProperty(d,"__esModule",{value:!0}),d.default=void 0;var y=L(o("../constants/action_types.js")),T=r(o("merge-options"));function r(W){return W&&W.__esModule?W:{default:W}}function D(W){if(typeof WeakMap!="function")return null;var q=new WeakMap,ne=new WeakMap;return(D=function(oe){return oe?ne:q})(W)}function L(W,q){if(W&&W.__esModule)return W;if(W===null||v(W)!=="object"&&typeof W!="function")return{default:W};var ne=D(q);if(ne&&ne.has(W))return ne.get(W);var ce={},oe=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var fe in W)if(fe!=="default"&&Object.prototype.hasOwnProperty.call(W,fe)){var be=oe?Object.getOwnPropertyDescriptor(W,fe):null;be&&(be.get||be.set)?Object.defineProperty(ce,fe,be):ce[fe]=W[fe]}return ce.default=W,ne&&ne.set(W,ce),ce}var B=function(){return{api:"https://api.mapbox.com/directions/v5/",profile:"mapbox/driving-traffic",alternatives:!1,congestion:!1,unit:"imperial",flyTo:!0,placeholderOrigin:"Choose a starting place",placeholderDestination:"Choose destination",zoom:16,language:"en",compile:null,proximity:!1,styles:[],controls:{profileSwitcher:!0,inputs:!0,instructions:!0},instructions:{showWaypointInstructions:!0},geocoder:{},interactive:!0,events:{},origin:{},destination:{},hoverMarker:{},waypoints:[],originQuery:null,destinationQuery:null,originQueryCoordinates:null,destinationQueryCoordinates:null,directions:[],fetchDirectionsRequest:null,routeIndex:0,routePadding:80}};function U(){var W=arguments.length>0&&arguments[0]!==void 0?arguments[0]:B(),q=arguments.length>1?arguments[1]:void 0;switch(q.type){case y.SET_OPTIONS:return(0,T.default)({},W,q.options);case y.DIRECTIONS_PROFILE:return Object.assign({},W,{profile:q.profile});case y.ORIGIN:return Object.assign({},W,{origin:q.origin,hoverMarker:{}});case y.DESTINATION:return Object.assign({},W,{destination:q.destination,hoverMarker:{}});case y.HOVER_MARKER:return Object.assign({},W,{hoverMarker:q.hoverMarker});case y.WAYPOINTS:return Object.assign({},W,{waypoints:q.waypoints});case y.ORIGIN_QUERY:return Object.assign({},W,{originQuery:q.query});case y.DESTINATION_QUERY:return Object.assign({},W,{destinationQuery:q.query});case y.ORIGIN_FROM_COORDINATES:return Object.assign({},W,{originQueryCoordinates:q.coordinates});case y.DESTINATION_FROM_COORDINATES:return Object.assign({},W,{destinationQueryCoordinates:q.coordinates});case y.ORIGIN_CLEAR:return Object.assign({},W,{origin:{},originQuery:"",waypoints:[],directions:[]});case y.DESTINATION_CLEAR:return Object.assign({},W,{destination:{},destinationQuery:"",waypoints:[],directions:[]});case y.DIRECTIONS_REQUEST_START:return Object.assign({},W,{fetchDirectionsRequest:q.request});case y.DIRECTIONS:return Object.assign({},W,{directions:q.directions,fetchDirectionsRequest:null});case y.ROUTE_INDEX:return Object.assign({},W,{routeIndex:q.routeIndex});case y.ERROR:return Object.assign({},W,{error:q.error});default:return W}}var $=U;d.default=$},{"../constants/action_types.js":26,"merge-options":14}],34:[function(o,c,d){Object.defineProperty(d,"__esModule",{value:!0}),d.default=void 0;function v($){return $[0]>=-180&&$[0]<=180&&$[1]>=-90&&$[1]<=90}function y($,W){return $=$.geometry.coordinates,W=W.geometry.coordinates,$.join()===W.join()||$[0].toFixed(3)===W[0].toFixed(3)&&$[1].toFixed(3)===W[1].toFixed(3)}function T($){var W=360,q=(($- -180)%W+W)%W+-180;return q===-180?180:q}function r($,W){var q=0;return Math.floor(W)!==W&&(q=W.toString().split(".")[1].length),$.toFixed(Math.min(q,5))}function D($,W){return{type:"Feature",geometry:{type:"Point",coordinates:$},properties:W||{}}}function L($,W){return $.legs.reduce(function(q,ne,ce){ce>0&&(q[q.length-1].maneuver.type="waypoint",ne.steps[0].maneuver.type="");var oe=q.concat(ne.steps);return W?oe.filter(W):oe},[])}var B={duration:function(W){var q=Math.floor(W/60),ne=Math.floor(q/60);return W%=60,q%=60,ne===0&&q===0?W+"s":ne===0?q+"min":ne+"h "+q+"min"},imperial:function(W){var q=W/1609.344;return q>=100?q.toFixed(0)+"mi":q>=10?q.toFixed(1)+"mi":q>=.1?q.toFixed(2)+"mi":(q*5280).toFixed(0)+"ft"},metric:function(W){return W>=1e5?(W/1e3).toFixed(0)+"km":W>=1e4?(W/1e3).toFixed(1)+"km":W>=100?(W/1e3).toFixed(2)+"km":W.toFixed(0)+"m"}},U={format:B,coordinateMatch:y,createPoint:D,validCoords:v,wrap:T,roundWithOriginalPrecision:r,getAllSteps:L};d.default=U},{}]},{},[32])(32)})})(rL);var wH=rL.exports;const SH=nT(wH),TH={id:"map",style:{width:"100%",height:"500px"}},EH={__name:"Map",setup(e){return ms(()=>{nd.accessToken="pk.eyJ1IjoieHlpbjAwMjQiLCJhIjoiY20yN2J4MW9pMGszdDJpcXQ3MWdqZmg0ZiJ9.eUrddyFmAqZJ-LDW2zZxeg";const t=new nd.Map({container:"map",style:"mapbox://styles/mapbox/streets-v11",center:[-74.5,40],zoom:9});t.addControl(new nd.NavigationControl),t.addControl(new nd.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserLocation:!0}));const o=new xH({accessToken:nd.accessToken,mapboxgl:nd,placeholder:"Search for places",marker:!0});t.addControl(o);const c=new SH({accessToken:nd.accessToken,unit:"metric",profile:"mapbox/driving"});t.addControl(c,"top-left")}),(t,o)=>(Vi(),Xi("div",TH))}},IH=xc(EH,[["__scopeId","data-v-9be41492"]]),CH={class:"table-container"},AH={key:0},PH=["onUpdate:modelValue","placeholder"],MH={key:1},kH=["onUpdate:modelValue","placeholder"],RH={key:2},DH={__name:"ExportCSV",setup(e){const t=rn(0),o=rn([]),c=rn([]),d=rn([]),v=rn([]),y=()=>{o.value=Array(t.value).fill(""),v.value=Array(t.value).fill("")},T=()=>{c.value=[...o.value]},r=()=>{d.value.push([...v.value]),v.value=Array(t.value).fill("")},D=()=>{let L="data:text/csv;charset=utf-8,";L+=c.value.join(",")+`
`,d.value.forEach($=>{L+=$.join(",")+`
`});const B=encodeURI(L),U=document.createElement("a");U.setAttribute("href",B),U.setAttribute("download","table_data.csv"),document.body.appendChild(U),U.click(),document.body.removeChild(U)};return(L,B)=>(Vi(),Xi("div",CH,[B[7]||(B[7]=Qn("h1",null,"Create Table and Export to CSV",-1)),Qn("form",{onSubmit:nh(y,["prevent"])},[B[1]||(B[1]=Qn("label",{for:"numColumns"},"Enter number of columns:",-1)),lr(Qn("input",{"onUpdate:modelValue":B[0]||(B[0]=U=>t.value=U),type:"number",id:"numColumns",min:"1",required:""},null,512),[[pl,t.value,void 0,{number:!0}]]),B[2]||(B[2]=Qn("button",{type:"submit"},"Set Columns",-1))],32),o.value.length?(Vi(),Xi("div",AH,[B[4]||(B[4]=Qn("h2",null,"Enter Column Headers",-1)),Qn("form",{onSubmit:nh(T,["prevent"])},[(Vi(!0),Xi(Gn,null,op(o.value,U=>(Vi(),Xi("div",{key:U},[lr(Qn("input",{"onUpdate:modelValue":$=>o.value[U]=$,placeholder:"Enter header for column "+(U+1),required:""},null,8,PH),[[pl,o.value[U]]])]))),128)),B[3]||(B[3]=Qn("button",{type:"submit"},"Set Headers",-1))],32)])):Os("",!0),c.value.length?(Vi(),Xi("div",MH,[B[6]||(B[6]=Qn("h2",null,"Enter Table Data",-1)),Qn("form",{onSubmit:nh(r,["prevent"])},[(Vi(!0),Xi(Gn,null,op(c.value,(U,$)=>(Vi(),Xi("div",{key:$},[lr(Qn("input",{"onUpdate:modelValue":W=>v.value[$]=W,placeholder:"Enter "+U,required:""},null,8,kH),[[pl,v.value[$]]])]))),128)),B[5]||(B[5]=Qn("button",{type:"submit"},"Add Row",-1))],32)])):Os("",!0),d.value.length?(Vi(),Xi("table",RH,[Qn("thead",null,[Qn("tr",null,[(Vi(!0),Xi(Gn,null,op(c.value,U=>(Vi(),Xi("th",{key:U},_c(U),1))),128))])]),Qn("tbody",null,[(Vi(!0),Xi(Gn,null,op(d.value,(U,$)=>(Vi(),Xi("tr",{key:$},[(Vi(!0),Xi(Gn,null,op(U,(W,q)=>(Vi(),Xi("td",{key:q},_c(W),1))),128))]))),128))])])):Os("",!0),d.value.length?(Vi(),Xi("button",{key:3,onClick:D},"Export to CSV")):Os("",!0)]))}},OH=xc(DH,[["__scopeId","data-v-6e43e0af"]]),LH={class:"chatbot-container"},zH={class:"chat-log"},BH={__name:"ChatBot",setup(e){const t=rn(""),o=rn([]),c=F0(),d=async()=>{o.value.push({type:"user",content:t.value});try{const y=await u0(c,"getOpenAIResponse")({prompt:t.value});o.value.push({type:"bot",content:y.data.response})}catch{o.value.push({type:"bot",content:"Error communicating with the AI. Please try again later."})}t.value=""};return(v,y)=>(Vi(),Xi("div",LH,[y[2]||(y[2]=Qn("h2",null,"AI Chatbot",-1)),Qn("div",zH,[(Vi(!0),Xi(Gn,null,op(o.value,(T,r)=>(Vi(),Xi("div",{key:r,class:d_(T.type)},[Qn("strong",null,_c(T.type==="user"?"You":"Bot")+":",1),$o(" "+_c(T.content),1)],2))),128))]),Qn("form",{onSubmit:nh(d,["prevent"])},[lr(Qn("input",{"onUpdate:modelValue":y[0]||(y[0]=T=>t.value=T),type:"text",placeholder:"Ask me anything...",required:""},null,512),[[pl,t.value]]),y[1]||(y[1]=Qn("button",{type:"submit"},"Send",-1))],32)]))}},FH=xc(BH,[["__scopeId","data-v-c4332a9c"]]);var VH={};const NH=[{path:"/",component:kG},{path:"/admin",component:VG},{path:"/FireLogin",name:"FireLogin",component:$G},{path:"/FireRegister",name:"FireRegister",component:ZG},{path:"/email",name:"SendEmail",component:KG},{path:"/table",name:"Table",component:i8},{path:"/map",name:"Map",component:IH},{path:"/csv",name:"CSV Exporter",component:OH},{path:"/chat",name:"ChatGPT",component:FH}],oL=IG({history:nG(VH.BASE_URL),routes:NH});oL.beforeEach((e,t,o)=>{const c=localStorage.getItem("user")!==null,d=JSON.parse(localStorage.getItem("user")),v=d?d.role:null;e.meta.requiresAuth&&!c||e.meta.requiresAuth&&e.meta.roles&&!e.meta.roles.includes(v)?o("/login"):c?v==="admin"&&e.path!=="/admin"?o("/admin"):v==="user"&&e.path==="/admin"?o("/"):o():o()});/*!
 * vuex v4.1.0
 * (c) 2022 Evan You
 * @license MIT
 */var UH="store";function Np(e,t){Object.keys(e).forEach(function(o){return t(e[o],o)})}function jH(e){return e!==null&&typeof e=="object"}function $H(e){return e&&typeof e.then=="function"}function GH(e,t){return function(){return e(t)}}function sL(e,t,o){return t.indexOf(e)<0&&(o&&o.prepend?t.unshift(e):t.push(e)),function(){var c=t.indexOf(e);c>-1&&t.splice(c,1)}}function aL(e,t){e._actions=Object.create(null),e._mutations=Object.create(null),e._wrappedGetters=Object.create(null),e._modulesNamespaceMap=Object.create(null);var o=e.state;$0(e,o,[],e._modules.root,!0),lT(e,o,t)}function lT(e,t,o){var c=e._state,d=e._scope;e.getters={},e._makeLocalGettersCache=Object.create(null);var v=e._wrappedGetters,y={},T={},r=A0(!0);r.run(function(){Np(v,function(D,L){y[L]=GH(D,e),T[L]=Se(function(){return y[L]()}),Object.defineProperty(e.getters,L,{get:function(){return T[L].value},enumerable:!0})})}),e._state=Ls({data:t}),e._scope=r,e.strict&&XH(e),c&&o&&e._withCommit(function(){c.data=null}),d&&d.stop()}function $0(e,t,o,c,d){var v=!o.length,y=e._modules.getNamespace(o);if(c.namespaced&&(e._modulesNamespaceMap[y],e._modulesNamespaceMap[y]=c),!v&&!d){var T=cT(t,o.slice(0,-1)),r=o[o.length-1];e._withCommit(function(){T[r]=c.state})}var D=c.context=HH(e,y,o);c.forEachMutation(function(L,B){var U=y+B;qH(e,U,L,D)}),c.forEachAction(function(L,B){var U=L.root?B:y+B,$=L.handler||L;WH(e,U,$,D)}),c.forEachGetter(function(L,B){var U=y+B;ZH(e,U,L,D)}),c.forEachChild(function(L,B){$0(e,t,o.concat(B),L,d)})}function HH(e,t,o){var c=t==="",d={dispatch:c?e.dispatch:function(v,y,T){var r=p0(v,y,T),D=r.payload,L=r.options,B=r.type;return(!L||!L.root)&&(B=t+B),e.dispatch(B,D)},commit:c?e.commit:function(v,y,T){var r=p0(v,y,T),D=r.payload,L=r.options,B=r.type;(!L||!L.root)&&(B=t+B),e.commit(B,D,L)}};return Object.defineProperties(d,{getters:{get:c?function(){return e.getters}:function(){return lL(e,t)}},state:{get:function(){return cT(e.state,o)}}}),d}function lL(e,t){if(!e._makeLocalGettersCache[t]){var o={},c=t.length;Object.keys(e.getters).forEach(function(d){if(d.slice(0,c)===t){var v=d.slice(c);Object.defineProperty(o,v,{get:function(){return e.getters[d]},enumerable:!0})}}),e._makeLocalGettersCache[t]=o}return e._makeLocalGettersCache[t]}function qH(e,t,o,c){var d=e._mutations[t]||(e._mutations[t]=[]);d.push(function(y){o.call(e,c.state,y)})}function WH(e,t,o,c){var d=e._actions[t]||(e._actions[t]=[]);d.push(function(y){var T=o.call(e,{dispatch:c.dispatch,commit:c.commit,getters:c.getters,state:c.state,rootGetters:e.getters,rootState:e.state},y);return $H(T)||(T=Promise.resolve(T)),e._devtoolHook?T.catch(function(r){throw e._devtoolHook.emit("vuex:error",r),r}):T})}function ZH(e,t,o,c){e._wrappedGetters[t]||(e._wrappedGetters[t]=function(v){return o(c.state,c.getters,v.state,v.getters)})}function XH(e){On(function(){return e._state.data},function(){},{deep:!0,flush:"sync"})}function cT(e,t){return t.reduce(function(o,c){return o[c]},e)}function p0(e,t,o){return jH(e)&&e.type&&(o=t,t=e,e=e.type),{type:e,payload:t,options:o}}var YH="vuex bindings",IM="vuex:mutations",B1="vuex:actions",Qf="vuex",KH=0;function JH(e,t){E3({id:"org.vuejs.vuex",app:e,label:"Vuex",homepage:"https://next.vuex.vuejs.org/",logo:"https://vuejs.org/images/icons/favicon-96x96.png",packageName:"vuex",componentStateTypes:[YH]},function(o){o.addTimelineLayer({id:IM,label:"Vuex Mutations",color:CM}),o.addTimelineLayer({id:B1,label:"Vuex Actions",color:CM}),o.addInspector({id:Qf,label:"Vuex",icon:"storage",treeFilterPlaceholder:"Filter stores..."}),o.on.getInspectorTree(function(c){if(c.app===e&&c.inspectorId===Qf)if(c.filter){var d=[];dL(d,t._modules.root,c.filter,""),c.rootNodes=d}else c.rootNodes=[hL(t._modules.root,"")]}),o.on.getInspectorState(function(c){if(c.app===e&&c.inspectorId===Qf){var d=c.nodeId;lL(t,d),c.state=tq(iq(t._modules,d),d==="root"?t.getters:t._makeLocalGettersCache,d)}}),o.on.editInspectorState(function(c){if(c.app===e&&c.inspectorId===Qf){var d=c.nodeId,v=c.path;d!=="root"&&(v=d.split("/").filter(Boolean).concat(v)),t._withCommit(function(){c.set(t._state.data,v,c.state.value)})}}),t.subscribe(function(c,d){var v={};c.payload&&(v.payload=c.payload),v.state=d,o.notifyComponentUpdate(),o.sendInspectorTree(Qf),o.sendInspectorState(Qf),o.addTimelineEvent({layerId:IM,event:{time:Date.now(),title:c.type,data:v}})}),t.subscribeAction({before:function(c,d){var v={};c.payload&&(v.payload=c.payload),c._id=KH++,c._time=Date.now(),v.state=d,o.addTimelineEvent({layerId:B1,event:{time:c._time,title:c.type,groupId:c._id,subtitle:"start",data:v}})},after:function(c,d){var v={},y=Date.now()-c._time;v.duration={_custom:{type:"duration",display:y+"ms",tooltip:"Action duration",value:y}},c.payload&&(v.payload=c.payload),v.state=d,o.addTimelineEvent({layerId:B1,event:{time:Date.now(),title:c.type,groupId:c._id,subtitle:"end",data:v}})}})})}var CM=8702998,QH=6710886,eq=16777215,cL={label:"namespaced",textColor:eq,backgroundColor:QH};function uL(e){return e&&e!=="root"?e.split("/").slice(-2,-1)[0]:"Root"}function hL(e,t){return{id:t||"root",label:uL(t),tags:e.namespaced?[cL]:[],children:Object.keys(e._children).map(function(o){return hL(e._children[o],t+o+"/")})}}function dL(e,t,o,c){c.includes(o)&&e.push({id:c||"root",label:c.endsWith("/")?c.slice(0,c.length-1):c||"Root",tags:t.namespaced?[cL]:[]}),Object.keys(t._children).forEach(function(d){dL(e,t._children[d],o,c+d+"/")})}function tq(e,t,o){t=o==="root"?t:t[o];var c=Object.keys(t),d={state:Object.keys(e.state).map(function(y){return{key:y,editable:!0,value:e.state[y]}})};if(c.length){var v=nq(t);d.getters=Object.keys(v).map(function(y){return{key:y.endsWith("/")?uL(y):y,editable:!1,value:Iw(function(){return v[y]})}})}return d}function nq(e){var t={};return Object.keys(e).forEach(function(o){var c=o.split("/");if(c.length>1){var d=t,v=c.pop();c.forEach(function(y){d[y]||(d[y]={_custom:{value:{},display:y,tooltip:"Module",abstract:!0}}),d=d[y]._custom.value}),d[v]=Iw(function(){return e[o]})}else t[o]=Iw(function(){return e[o]})}),t}function iq(e,t){var o=t.split("/").filter(function(c){return c});return o.reduce(function(c,d,v){var y=c[d];if(!y)throw new Error('Missing module "'+d+'" for path "'+t+'".');return v===o.length-1?y:y._children},t==="root"?e:e.root._children)}function Iw(e){try{return e()}catch(t){return t}}var ql=function(t,o){this.runtime=o,this._children=Object.create(null),this._rawModule=t;var c=t.state;this.state=(typeof c=="function"?c():c)||{}},fL={namespaced:{configurable:!0}};fL.namespaced.get=function(){return!!this._rawModule.namespaced};ql.prototype.addChild=function(t,o){this._children[t]=o};ql.prototype.removeChild=function(t){delete this._children[t]};ql.prototype.getChild=function(t){return this._children[t]};ql.prototype.hasChild=function(t){return t in this._children};ql.prototype.update=function(t){this._rawModule.namespaced=t.namespaced,t.actions&&(this._rawModule.actions=t.actions),t.mutations&&(this._rawModule.mutations=t.mutations),t.getters&&(this._rawModule.getters=t.getters)};ql.prototype.forEachChild=function(t){Np(this._children,t)};ql.prototype.forEachGetter=function(t){this._rawModule.getters&&Np(this._rawModule.getters,t)};ql.prototype.forEachAction=function(t){this._rawModule.actions&&Np(this._rawModule.actions,t)};ql.prototype.forEachMutation=function(t){this._rawModule.mutations&&Np(this._rawModule.mutations,t)};Object.defineProperties(ql.prototype,fL);var kd=function(t){this.register([],t,!1)};kd.prototype.get=function(t){return t.reduce(function(o,c){return o.getChild(c)},this.root)};kd.prototype.getNamespace=function(t){var o=this.root;return t.reduce(function(c,d){return o=o.getChild(d),c+(o.namespaced?d+"/":"")},"")};kd.prototype.update=function(t){pL([],this.root,t)};kd.prototype.register=function(t,o,c){var d=this;c===void 0&&(c=!0);var v=new ql(o,c);if(t.length===0)this.root=v;else{var y=this.get(t.slice(0,-1));y.addChild(t[t.length-1],v)}o.modules&&Np(o.modules,function(T,r){d.register(t.concat(r),T,c)})};kd.prototype.unregister=function(t){var o=this.get(t.slice(0,-1)),c=t[t.length-1],d=o.getChild(c);d&&d.runtime&&o.removeChild(c)};kd.prototype.isRegistered=function(t){var o=this.get(t.slice(0,-1)),c=t[t.length-1];return o?o.hasChild(c):!1};function pL(e,t,o){if(t.update(o),o.modules)for(var c in o.modules){if(!t.getChild(c))return;pL(e.concat(c),t.getChild(c),o.modules[c])}}function rq(e){return new Va(e)}var Va=function(t){var o=this;t===void 0&&(t={});var c=t.plugins;c===void 0&&(c=[]);var d=t.strict;d===void 0&&(d=!1);var v=t.devtools;this._committing=!1,this._actions=Object.create(null),this._actionSubscribers=[],this._mutations=Object.create(null),this._wrappedGetters=Object.create(null),this._modules=new kd(t),this._modulesNamespaceMap=Object.create(null),this._subscribers=[],this._makeLocalGettersCache=Object.create(null),this._scope=null,this._devtools=v;var y=this,T=this,r=T.dispatch,D=T.commit;this.dispatch=function(U,$){return r.call(y,U,$)},this.commit=function(U,$,W){return D.call(y,U,$,W)},this.strict=d;var L=this._modules.root.state;$0(this,L,[],this._modules.root),lT(this,L),c.forEach(function(B){return B(o)})},uT={state:{configurable:!0}};Va.prototype.install=function(t,o){t.provide(o||UH,this),t.config.globalProperties.$store=this;var c=this._devtools!==void 0?this._devtools:!1;c&&JH(t,this)};uT.state.get=function(){return this._state.data};uT.state.set=function(e){};Va.prototype.commit=function(t,o,c){var d=this,v=p0(t,o,c),y=v.type,T=v.payload,r={type:y,payload:T},D=this._mutations[y];D&&(this._withCommit(function(){D.forEach(function(B){B(T)})}),this._subscribers.slice().forEach(function(L){return L(r,d.state)}))};Va.prototype.dispatch=function(t,o){var c=this,d=p0(t,o),v=d.type,y=d.payload,T={type:v,payload:y},r=this._actions[v];if(r){try{this._actionSubscribers.slice().filter(function(L){return L.before}).forEach(function(L){return L.before(T,c.state)})}catch{}var D=r.length>1?Promise.all(r.map(function(L){return L(y)})):r[0](y);return new Promise(function(L,B){D.then(function(U){try{c._actionSubscribers.filter(function($){return $.after}).forEach(function($){return $.after(T,c.state)})}catch{}L(U)},function(U){try{c._actionSubscribers.filter(function($){return $.error}).forEach(function($){return $.error(T,c.state,U)})}catch{}B(U)})})}};Va.prototype.subscribe=function(t,o){return sL(t,this._subscribers,o)};Va.prototype.subscribeAction=function(t,o){var c=typeof t=="function"?{before:t}:t;return sL(c,this._actionSubscribers,o)};Va.prototype.watch=function(t,o,c){var d=this;return On(function(){return t(d.state,d.getters)},o,Object.assign({},c))};Va.prototype.replaceState=function(t){var o=this;this._withCommit(function(){o._state.data=t})};Va.prototype.registerModule=function(t,o,c){c===void 0&&(c={}),typeof t=="string"&&(t=[t]),this._modules.register(t,o),$0(this,this.state,t,this._modules.get(t),c.preserveState),lT(this,this.state)};Va.prototype.unregisterModule=function(t){var o=this;typeof t=="string"&&(t=[t]),this._modules.unregister(t),this._withCommit(function(){var c=cT(o.state,t.slice(0,-1));delete c[t[t.length-1]]}),aL(this)};Va.prototype.hasModule=function(t){return typeof t=="string"&&(t=[t]),this._modules.isRegistered(t)};Va.prototype.hotUpdate=function(t){this._modules.update(t),aL(this,!0)};Va.prototype._withCommit=function(t){var o=this._committing;this._committing=!0,t(),this._committing=o};Object.defineProperties(Va.prototype,uT);const oq=rq({state:{isLoggedIn:!1,email:null},mutations:{setUser(e,t){e.isLoggedIn=!0,e.email=t},clearUser(e){e.isLoggedIn=!1,e.email=null}},actions:{initAuthState({commit:e}){$D(Zc,t=>{t?e("setUser",t.email):e("clearUser")})},logout({commit:e}){Zc.signOut().then(()=>{e("clearUser")})}},getters:{isLoggedIn:e=>e.isLoggedIn,getEmail:e=>e.email}});function za(e,t){let o;function c(){o=A0(),o.run(()=>t.length?t(()=>{o==null||o.stop(),c()}):t())}On(e,d=>{d&&!o?c():d||(o==null||o.stop(),o=void 0)},{immediate:!0}),Ys(()=>{o==null||o.stop()})}const Ar=typeof window<"u",hT=Ar&&"IntersectionObserver"in window,sq=Ar&&("ontouchstart"in window||window.navigator.maxTouchPoints>0),AM=Ar&&"EyeDropper"in window;function PM(e,t,o){aq(e,t),t.set(e,o)}function aq(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function lq(e,t,o){return e.set(mL(e,t),o),o}function rd(e,t){return e.get(mL(e,t))}function mL(e,t,o){if(typeof e=="function"?e===t:e.has(t))return arguments.length<3?t:o;throw new TypeError("Private element is not present on this object")}function gL(e,t,o){const c=t.length-1;if(c<0)return e===void 0?o:e;for(let d=0;d<c;d++){if(e==null)return o;e=e[t[d]]}return e==null||e[t[c]]===void 0?o:e[t[c]]}function wc(e,t){if(e===t)return!0;if(e instanceof Date&&t instanceof Date&&e.getTime()!==t.getTime()||e!==Object(e)||t!==Object(t))return!1;const o=Object.keys(e);return o.length!==Object.keys(t).length?!1:o.every(c=>wc(e[c],t[c]))}function bd(e,t,o){return e==null||!t||typeof t!="string"?o:e[t]!==void 0?e[t]:(t=t.replace(/\[(\w+)\]/g,".$1"),t=t.replace(/^\./,""),gL(e,t.split("."),o))}function as(e,t,o){if(t===!0)return e===void 0?o:e;if(t==null||typeof t=="boolean")return o;if(e!==Object(e)){if(typeof t!="function")return o;const d=t(e,o);return typeof d>"u"?o:d}if(typeof t=="string")return bd(e,t,o);if(Array.isArray(t))return gL(e,t,o);if(typeof t!="function")return o;const c=t(e,o);return typeof c>"u"?o:c}function dc(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return Array.from({length:e},(o,c)=>t+c)}function Bn(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"px";if(!(e==null||e===""))return isNaN(+e)?String(e):isFinite(+e)?`${Number(e)}${t}`:void 0}function Qg(e){return e!==null&&typeof e=="object"&&!Array.isArray(e)}function dT(e){if(e&&"$el"in e){const t=e.$el;return(t==null?void 0:t.nodeType)===Node.TEXT_NODE?t.nextElementSibling:t}return e}const MM=Object.freeze({enter:13,tab:9,delete:46,esc:27,space:32,up:38,down:40,left:37,right:39,end:35,home:36,del:46,backspace:8,insert:45,pageup:33,pagedown:34,shift:16}),Cw=Object.freeze({enter:"Enter",tab:"Tab",delete:"Delete",esc:"Escape",space:"Space",up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight",end:"End",home:"Home",del:"Delete",backspace:"Backspace",insert:"Insert",pageup:"PageUp",pagedown:"PageDown",shift:"Shift"});function _L(e){return Object.keys(e)}function cd(e,t){return t.every(o=>e.hasOwnProperty(o))}function fT(e,t){const o={},c=new Set(Object.keys(e));for(const d of t)c.has(d)&&(o[d]=e[d]);return o}function Aw(e,t,o){const c=Object.create(null),d=Object.create(null);for(const v in e)t.some(y=>y instanceof RegExp?y.test(v):y===v)&&!(o!=null&&o.some(y=>y===v))?c[v]=e[v]:d[v]=e[v];return[c,d]}function Yo(e,t){const o={...e};return t.forEach(c=>delete o[c]),o}function G0(e,t){const o={};return t.forEach(c=>o[c]=e[c]),o}const vL=/^on[^a-z]/,H0=e=>vL.test(e),cq=["onAfterscriptexecute","onAnimationcancel","onAnimationend","onAnimationiteration","onAnimationstart","onAuxclick","onBeforeinput","onBeforescriptexecute","onChange","onClick","onCompositionend","onCompositionstart","onCompositionupdate","onContextmenu","onCopy","onCut","onDblclick","onFocusin","onFocusout","onFullscreenchange","onFullscreenerror","onGesturechange","onGestureend","onGesturestart","onGotpointercapture","onInput","onKeydown","onKeypress","onKeyup","onLostpointercapture","onMousedown","onMousemove","onMouseout","onMouseover","onMouseup","onMousewheel","onPaste","onPointercancel","onPointerdown","onPointerenter","onPointerleave","onPointermove","onPointerout","onPointerover","onPointerup","onReset","onSelect","onSubmit","onTouchcancel","onTouchend","onTouchmove","onTouchstart","onTransitioncancel","onTransitionend","onTransitionrun","onTransitionstart","onWheel"],uq=["ArrowUp","ArrowDown","ArrowRight","ArrowLeft","Enter","Escape","Tab"," "];function hq(e){return e.isComposing&&uq.includes(e.key)}function ph(e){const[t,o]=Aw(e,[vL]),c=Yo(t,cq),[d,v]=Aw(o,["class","style","id",/^data-/]);return Object.assign(d,t),Object.assign(v,c),[d,v]}function go(e){return e==null?[]:Array.isArray(e)?e:[e]}function dq(e,t){let o=0;const c=function(){for(var d=arguments.length,v=new Array(d),y=0;y<d;y++)v[y]=arguments[y];clearTimeout(o),o=setTimeout(()=>e(...v),Zo(t))};return c.clear=()=>{clearTimeout(o)},c.immediate=e,c}function Go(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return Math.max(t,Math.min(o,e))}function kM(e){const t=e.toString().trim();return t.includes(".")?t.length-t.indexOf(".")-1:0}function RM(e,t){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"0";return e+o.repeat(Math.max(0,t-e.length))}function DM(e,t){return(arguments.length>2&&arguments[2]!==void 0?arguments[2]:"0").repeat(Math.max(0,t-e.length))+e}function fq(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const o=[];let c=0;for(;c<e.length;)o.push(e.substr(c,t)),c+=t;return o}function OM(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;if(e<t)return`${e} B`;const o=t===1024?["Ki","Mi","Gi"]:["k","M","G"];let c=-1;for(;Math.abs(e)>=t&&c<o.length-1;)e/=t,++c;return`${e.toFixed(1)} ${o[c]}B`}function Zs(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;const c={};for(const d in e)c[d]=e[d];for(const d in t){const v=e[d],y=t[d];if(Qg(v)&&Qg(y)){c[d]=Zs(v,y,o);continue}if(Array.isArray(v)&&Array.isArray(y)&&o){c[d]=o(v,y);continue}c[d]=y}return c}function yL(e){return e.map(t=>t.type===Gn?yL(t.children):t).flat()}function dd(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";if(dd.cache.has(e))return dd.cache.get(e);const t=e.replace(/[^a-z]/gi,"-").replace(/\B([A-Z])/g,"-$1").toLowerCase();return dd.cache.set(e,t),t}dd.cache=new Map;function cp(e,t){if(!t||typeof t!="object")return[];if(Array.isArray(t))return t.map(o=>cp(e,o)).flat(1);if(t.suspense)return cp(e,t.ssContent);if(Array.isArray(t.children))return t.children.map(o=>cp(e,o)).flat(1);if(t.component){if(Object.getOwnPropertySymbols(t.component.provides).includes(e))return[t.component];if(t.component.subTree)return cp(e,t.component.subTree).flat(1)}return[]}var Ay=new WeakMap,ep=new WeakMap;class pq{constructor(t){PM(this,Ay,[]),PM(this,ep,0),this.size=t}push(t){rd(Ay,this)[rd(ep,this)]=t,lq(ep,this,(rd(ep,this)+1)%this.size)}values(){return rd(Ay,this).slice(rd(ep,this)).concat(rd(Ay,this).slice(0,rd(ep,this)))}}function mq(e){return"touches"in e?{clientX:e.touches[0].clientX,clientY:e.touches[0].clientY}:{clientX:e.clientX,clientY:e.clientY}}function pT(e){const t=Ls({}),o=Se(e);return Oo(()=>{for(const c in o.value)t[c]=o.value[c]},{flush:"sync"}),Pd(t)}function m0(e,t){return e.includes(t)}function bL(e){return e[2].toLowerCase()+e.slice(3)}const Ss=()=>[Function,Array];function LM(e,t){return t="on"+yc(t),!!(e[t]||e[`${t}Once`]||e[`${t}Capture`]||e[`${t}OnceCapture`]||e[`${t}CaptureOnce`])}function mT(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),c=1;c<t;c++)o[c-1]=arguments[c];if(Array.isArray(e))for(const d of e)d(...o);else typeof e=="function"&&e(...o)}function e_(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;const o=["button","[href]",'input:not([type="hidden"])',"select","textarea","[tabindex]"].map(c=>`${c}${t?':not([tabindex="-1"])':""}:not([disabled])`).join(", ");return[...e.querySelectorAll(o)]}function xL(e,t,o){let c,d=e.indexOf(document.activeElement);const v=t==="next"?1:-1;do d+=v,c=e[d];while((!c||c.offsetParent==null||!((o==null?void 0:o(c))??!0))&&d<e.length&&d>=0);return c}function Mp(e,t){var c,d,v,y;const o=e_(e);if(!t)(e===document.activeElement||!e.contains(document.activeElement))&&((c=o[0])==null||c.focus());else if(t==="first")(d=o[0])==null||d.focus();else if(t==="last")(v=o.at(-1))==null||v.focus();else if(typeof t=="number")(y=o[t])==null||y.focus();else{const T=xL(o,t);T?T.focus():Mp(e,t==="next"?"first":"last")}}function Py(e){return e==null||typeof e=="string"&&e.trim()===""}function wL(){}function kp(e,t){if(!(Ar&&typeof CSS<"u"&&typeof CSS.supports<"u"&&CSS.supports(`selector(${t})`)))return null;try{return!!e&&e.matches(t)}catch{return null}}function q0(e){return e.some(t=>Tp(t)?t.type===zs?!1:t.type!==Gn||q0(t.children):!0)?e:null}function gq(e,t){if(!Ar||e===0)return t(),()=>{};const o=window.setTimeout(t,e);return()=>window.clearTimeout(o)}function zM(e,t){const o=kn();return Oo(()=>{o.value=e()},{flush:"sync",...t}),zp(o)}function _q(e,t){const o=e.clientX,c=e.clientY,d=t.getBoundingClientRect(),v=d.left,y=d.top,T=d.right,r=d.bottom;return o>=v&&o<=T&&c>=y&&c<=r}function g0(){const e=kn(),t=o=>{e.value=o};return Object.defineProperty(t,"value",{enumerable:!0,get:()=>e.value,set:o=>e.value=o}),Object.defineProperty(t,"el",{enumerable:!0,get:()=>dT(e.value)}),t}function _0(e){const t=e.key.length===1,o=!e.ctrlKey&&!e.metaKey&&!e.altKey;return t&&o}const SL=["top","bottom"],vq=["start","end","left","right"];function Pw(e,t){let[o,c]=e.split(" ");return c||(c=m0(SL,o)?"start":m0(vq,o)?"top":"center"),{side:Mw(o,t),align:Mw(c,t)}}function Mw(e,t){return e==="start"?t?"right":"left":e==="end"?t?"left":"right":e}function F1(e){return{side:{center:"center",top:"bottom",bottom:"top",left:"right",right:"left"}[e.side],align:e.align}}function V1(e){return{side:e.side,align:{center:"center",top:"bottom",bottom:"top",left:"right",right:"left"}[e.align]}}function BM(e){return{side:e.align,align:e.side}}function FM(e){return m0(SL,e.side)?"y":"x"}class fd{constructor(t){let{x:o,y:c,width:d,height:v}=t;this.x=o,this.y=c,this.width=d,this.height=v}get top(){return this.y}get bottom(){return this.y+this.height}get left(){return this.x}get right(){return this.x+this.width}}function VM(e,t){return{x:{before:Math.max(0,t.left-e.left),after:Math.max(0,e.right-t.right)},y:{before:Math.max(0,t.top-e.top),after:Math.max(0,e.bottom-t.bottom)}}}function TL(e){return Array.isArray(e)?new fd({x:e[0],y:e[1],width:0,height:0}):e.getBoundingClientRect()}function gT(e){const t=e.getBoundingClientRect(),o=getComputedStyle(e),c=o.transform;if(c){let d,v,y,T,r;if(c.startsWith("matrix3d("))d=c.slice(9,-1).split(/, /),v=+d[0],y=+d[5],T=+d[12],r=+d[13];else if(c.startsWith("matrix("))d=c.slice(7,-1).split(/, /),v=+d[0],y=+d[3],T=+d[4],r=+d[5];else return new fd(t);const D=o.transformOrigin,L=t.x-T-(1-v)*parseFloat(D),B=t.y-r-(1-y)*parseFloat(D.slice(D.indexOf(" ")+1)),U=v?t.width/v:e.offsetWidth+1,$=y?t.height/y:e.offsetHeight+1;return new fd({x:L,y:B,width:U,height:$})}else return new fd(t)}function ud(e,t,o){if(typeof e.animate>"u")return{finished:Promise.resolve()};let c;try{c=e.animate(t,o)}catch{return{finished:Promise.resolve()}}return typeof c.finished>"u"&&(c.finished=new Promise(d=>{c.onfinish=()=>{d(c)}})),c}const $y=new WeakMap;function yq(e,t){Object.keys(t).forEach(o=>{if(H0(o)){const c=bL(o),d=$y.get(e);if(t[o]==null)d==null||d.forEach(v=>{const[y,T]=v;y===c&&(e.removeEventListener(c,T),d.delete(v))});else if(!d||![...d].some(v=>v[0]===c&&v[1]===t[o])){e.addEventListener(c,t[o]);const v=d||new Set;v.add([c,t[o]]),$y.has(e)||$y.set(e,v)}}else t[o]==null?e.removeAttribute(o):e.setAttribute(o,t[o])})}function bq(e,t){Object.keys(t).forEach(o=>{if(H0(o)){const c=bL(o),d=$y.get(e);d==null||d.forEach(v=>{const[y,T]=v;y===c&&(e.removeEventListener(c,T),d.delete(v))})}else e.removeAttribute(o)})}const tp=2.4,NM=.2126729,UM=.7151522,jM=.072175,xq=.55,wq=.58,Sq=.57,Tq=.62,My=.03,$M=1.45,Eq=5e-4,Iq=1.25,Cq=1.25,GM=.078,HM=12.82051282051282,ky=.06,qM=.001;function WM(e,t){const o=(e.r/255)**tp,c=(e.g/255)**tp,d=(e.b/255)**tp,v=(t.r/255)**tp,y=(t.g/255)**tp,T=(t.b/255)**tp;let r=o*NM+c*UM+d*jM,D=v*NM+y*UM+T*jM;if(r<=My&&(r+=(My-r)**$M),D<=My&&(D+=(My-D)**$M),Math.abs(D-r)<Eq)return 0;let L;if(D>r){const B=(D**xq-r**wq)*Iq;L=B<qM?0:B<GM?B-B*HM*ky:B-ky}else{const B=(D**Tq-r**Sq)*Cq;L=B>-qM?0:B>-GM?B-B*HM*ky:B+ky}return L*100}function Aq(e,t){t=Array.isArray(t)?t.slice(0,-1).map(o=>`'${o}'`).join(", ")+` or '${t.at(-1)}'`:`'${t}'`}const v0=.20689655172413793,Pq=e=>e>v0**3?Math.cbrt(e):e/(3*v0**2)+4/29,Mq=e=>e>v0?e**3:3*v0**2*(e-4/29);function EL(e){const t=Pq,o=t(e[1]);return[116*o-16,500*(t(e[0]/.95047)-o),200*(o-t(e[2]/1.08883))]}function IL(e){const t=Mq,o=(e[0]+16)/116;return[t(o+e[1]/500)*.95047,t(o),t(o-e[2]/200)*1.08883]}const kq=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]],Rq=e=>e<=.0031308?e*12.92:1.055*e**(1/2.4)-.055,Dq=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],Oq=e=>e<=.04045?e/12.92:((e+.055)/1.055)**2.4;function CL(e){const t=Array(3),o=Rq,c=kq;for(let d=0;d<3;++d)t[d]=Math.round(Go(o(c[d][0]*e[0]+c[d][1]*e[1]+c[d][2]*e[2]))*255);return{r:t[0],g:t[1],b:t[2]}}function _T(e){let{r:t,g:o,b:c}=e;const d=[0,0,0],v=Oq,y=Dq;t=v(t/255),o=v(o/255),c=v(c/255);for(let T=0;T<3;++T)d[T]=y[T][0]*t+y[T][1]*o+y[T][2]*c;return d}function kw(e){return!!e&&/^(#|var\(--|(rgb|hsl)a?\()/.test(e)}function Lq(e){return kw(e)&&!/^((rgb|hsl)a?\()?var\(--/.test(e)}const ZM=/^(?<fn>(?:rgb|hsl)a?)\((?<values>.+)\)/,zq={rgb:(e,t,o,c)=>({r:e,g:t,b:o,a:c}),rgba:(e,t,o,c)=>({r:e,g:t,b:o,a:c}),hsl:(e,t,o,c)=>XM({h:e,s:t,l:o,a:c}),hsla:(e,t,o,c)=>XM({h:e,s:t,l:o,a:c}),hsv:(e,t,o,c)=>Jc({h:e,s:t,v:o,a:c}),hsva:(e,t,o,c)=>Jc({h:e,s:t,v:o,a:c})};function dl(e){if(typeof e=="number")return{r:(e&16711680)>>16,g:(e&65280)>>8,b:e&255};if(typeof e=="string"&&ZM.test(e)){const{groups:t}=e.match(ZM),{fn:o,values:c}=t,d=c.split(/,\s*/).map(v=>v.endsWith("%")&&["hsl","hsla","hsv","hsva"].includes(o)?parseFloat(v)/100:parseFloat(v));return zq[o](...d)}else if(typeof e=="string"){let t=e.startsWith("#")?e.slice(1):e;return[3,4].includes(t.length)?t=t.split("").map(o=>o+o).join(""):[6,8].includes(t.length),RL(t)}else if(typeof e=="object"){if(cd(e,["r","g","b"]))return e;if(cd(e,["h","s","l"]))return Jc(vT(e));if(cd(e,["h","s","v"]))return Jc(e)}throw new TypeError(`Invalid color: ${e==null?e:String(e)||e.constructor.name}
Expected #hex, #hexa, rgb(), rgba(), hsl(), hsla(), object or number`)}function Jc(e){const{h:t,s:o,v:c,a:d}=e,v=T=>{const r=(T+t/60)%6;return c-c*o*Math.max(Math.min(r,4-r,1),0)},y=[v(5),v(3),v(1)].map(T=>Math.round(T*255));return{r:y[0],g:y[1],b:y[2],a:d}}function XM(e){return Jc(vT(e))}function W0(e){if(!e)return{h:0,s:1,v:1,a:1};const t=e.r/255,o=e.g/255,c=e.b/255,d=Math.max(t,o,c),v=Math.min(t,o,c);let y=0;d!==v&&(d===t?y=60*(0+(o-c)/(d-v)):d===o?y=60*(2+(c-t)/(d-v)):d===c&&(y=60*(4+(t-o)/(d-v)))),y<0&&(y=y+360);const T=d===0?0:(d-v)/d,r=[y,T,d];return{h:r[0],s:r[1],v:r[2],a:e.a}}function AL(e){const{h:t,s:o,v:c,a:d}=e,v=c-c*o/2,y=v===1||v===0?0:(c-v)/Math.min(v,1-v);return{h:t,s:y,l:v,a:d}}function vT(e){const{h:t,s:o,l:c,a:d}=e,v=c+o*Math.min(c,1-c),y=v===0?0:2-2*c/v;return{h:t,s:y,v,a:d}}function PL(e){let{r:t,g:o,b:c,a:d}=e;return d===void 0?`rgb(${t}, ${o}, ${c})`:`rgba(${t}, ${o}, ${c}, ${d})`}function ML(e){return PL(Jc(e))}function Ry(e){const t=Math.round(e).toString(16);return("00".substr(0,2-t.length)+t).toUpperCase()}function kL(e){let{r:t,g:o,b:c,a:d}=e;return`#${[Ry(t),Ry(o),Ry(c),d!==void 0?Ry(Math.round(d*255)):""].join("")}`}function RL(e){e=Bq(e);let[t,o,c,d]=fq(e,2).map(v=>parseInt(v,16));return d=d===void 0?d:d/255,{r:t,g:o,b:c,a:d}}function DL(e){const t=RL(e);return W0(t)}function OL(e){return kL(Jc(e))}function Bq(e){return e.startsWith("#")&&(e=e.slice(1)),e=e.replace(/([^0-9a-f])/gi,"F"),(e.length===3||e.length===4)&&(e=e.split("").map(t=>t+t).join("")),e.length!==6&&(e=RM(RM(e,6),8,"F")),e}function Fq(e,t){const o=EL(_T(e));return o[0]=o[0]+t*10,CL(IL(o))}function Vq(e,t){const o=EL(_T(e));return o[0]=o[0]-t*10,CL(IL(o))}function Rw(e){const t=dl(e);return _T(t)[1]}function Nq(e,t){const o=Rw(e),c=Rw(t),d=Math.max(o,c),v=Math.min(o,c);return(d+.05)/(v+.05)}function LL(e){const t=Math.abs(WM(dl(0),dl(e)));return Math.abs(WM(dl(16777215),dl(e)))>Math.min(t,50)?"#fff":"#000"}function At(e,t){return o=>Object.keys(e).reduce((c,d)=>{const y=typeof e[d]=="object"&&e[d]!=null&&!Array.isArray(e[d])?e[d]:{type:e[d]};return o&&d in o?c[d]={...y,default:o[d]}:c[d]=y,t&&!c[d].source&&(c[d].source=t),c},{})}const Nn=At({class:[String,Array,Object],style:{type:[String,Array,Object],default:null}},"component");function Lo(e,t){const o=LS();if(!o)throw new Error(`[Vuetify] ${e} must be called from inside a setup function`);return o}function Sc(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"composables";const t=Lo(e).type;return dd((t==null?void 0:t.aliasName)||(t==null?void 0:t.name))}let zL=0,Gy=new WeakMap;function Es(){const e=Lo("getUid");if(Gy.has(e))return Gy.get(e);{const t=zL++;return Gy.set(e,t),t}}Es.reset=()=>{zL=0,Gy=new WeakMap};function Uq(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Lo("injectSelf");const{provides:o}=t;if(o&&e in o)return o[e]}const Rp=Symbol.for("vuetify:defaults");function jq(e){return rn(e)}function yT(){const e=Mi(Rp);if(!e)throw new Error("[Vuetify] Could not find defaults instance");return e}function wo(e,t){const o=yT(),c=rn(e),d=Se(()=>{if(Zo(t==null?void 0:t.disabled))return o.value;const y=Zo(t==null?void 0:t.scoped),T=Zo(t==null?void 0:t.reset),r=Zo(t==null?void 0:t.root);if(c.value==null&&!(y||T||r))return o.value;let D=Zs(c.value,{prev:o.value});if(y)return D;if(T||r){const L=Number(T||1/0);for(let B=0;B<=L&&!(!D||!("prev"in D));B++)D=D.prev;return D&&typeof r=="string"&&r in D&&(D=Zs(Zs(D,{prev:D}),D[r])),D}return D.prev?Zs(D.prev,D):D});return Vr(Rp,d),d}function $q(e,t){var o,c;return typeof((o=e.props)==null?void 0:o[t])<"u"||typeof((c=e.props)==null?void 0:c[dd(t)])<"u"}function Gq(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:yT();const c=Lo("useDefaults");if(t=t??c.type.name??c.type.__name,!t)throw new Error("[Vuetify] Could not determine component name");const d=Se(()=>{var r;return(r=o.value)==null?void 0:r[e._as??t]}),v=new Proxy(e,{get(r,D){var B,U,$,W,q,ne,ce;const L=Reflect.get(r,D);return D==="class"||D==="style"?[(B=d.value)==null?void 0:B[D],L].filter(oe=>oe!=null):typeof D=="string"&&!$q(c.vnode,D)?((U=d.value)==null?void 0:U[D])!==void 0?($=d.value)==null?void 0:$[D]:((q=(W=o.value)==null?void 0:W.global)==null?void 0:q[D])!==void 0?(ce=(ne=o.value)==null?void 0:ne.global)==null?void 0:ce[D]:L:L}}),y=kn();Oo(()=>{if(d.value){const r=Object.entries(d.value).filter(D=>{let[L]=D;return L.startsWith(L[0].toUpperCase())});y.value=r.length?Object.fromEntries(r):void 0}else y.value=void 0});function T(){const r=Uq(Rp,c);Vr(Rp,Se(()=>y.value?Zs((r==null?void 0:r.value)??{},y.value):r==null?void 0:r.value))}return{props:v,provideSubDefaults:T}}function Ka(e){if(e._setup=e._setup??e.setup,!e.name)return e;if(e._setup){e.props=At(e.props??{},e.name)();const t=Object.keys(e.props).filter(o=>o!=="class"&&o!=="style");e.filterProps=function(c){return fT(c,t)},e.props._as=String,e.setup=function(c,d){const v=yT();if(!v.value)return e._setup(c,d);const{props:y,provideSubDefaults:T}=Gq(c,c._as??e.name,v),r=e._setup(y,d);return T(),r}}return e}function Jt(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return t=>(e?Ka:wS)(t)}function Hq(e,t){return t.props=e,t}function Tc(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"div",o=arguments.length>2?arguments[2]:void 0;return Jt()({name:o??yc(Ba(e.replace(/__/g,"-"))),props:{tag:{type:String,default:t},...Nn()},setup(c,d){let{slots:v}=d;return()=>{var y;return Gl(c.tag,{class:[e,c.class],style:c.style},(y=v.default)==null?void 0:y.call(v))}}})}function BL(e){if(typeof e.getRootNode!="function"){for(;e.parentNode;)e=e.parentNode;return e!==document?null:document}const t=e.getRootNode();return t!==document&&t.getRootNode({composed:!0})!==document?null:t}const t_="cubic-bezier(0.4, 0, 0.2, 1)",qq="cubic-bezier(0.0, 0, 0.2, 1)",Wq="cubic-bezier(0.4, 0, 1, 1)";function YM(e,t,o){return Object.keys(e).filter(c=>H0(c)&&c.endsWith(t)).reduce((c,d)=>(c[d.slice(0,-t.length)]=v=>e[d](v,o(v)),c),{})}function bT(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;for(;e;){if(t?Zq(e):xT(e))return e;e=e.parentElement}return document.scrollingElement}function y0(e,t){const o=[];if(t&&e&&!t.contains(e))return o;for(;e&&(xT(e)&&o.push(e),e!==t);)e=e.parentElement;return o}function xT(e){if(!e||e.nodeType!==Node.ELEMENT_NODE)return!1;const t=window.getComputedStyle(e);return t.overflowY==="scroll"||t.overflowY==="auto"&&e.scrollHeight>e.clientHeight}function Zq(e){if(!e||e.nodeType!==Node.ELEMENT_NODE)return!1;const t=window.getComputedStyle(e);return["scroll","auto"].includes(t.overflowY)}function Xq(e){for(;e;){if(window.getComputedStyle(e).position==="fixed")return!0;e=e.offsetParent}return!1}function cn(e){const t=Lo("useRender");t.render=e}function ei(e,t,o){let c=arguments.length>3&&arguments[3]!==void 0?arguments[3]:B=>B,d=arguments.length>4&&arguments[4]!==void 0?arguments[4]:B=>B;const v=Lo("useProxiedModel"),y=rn(e[t]!==void 0?e[t]:o),T=dd(t),D=Se(T!==t?()=>{var B,U,$,W;return e[t],!!(((B=v.vnode.props)!=null&&B.hasOwnProperty(t)||(U=v.vnode.props)!=null&&U.hasOwnProperty(T))&&(($=v.vnode.props)!=null&&$.hasOwnProperty(`onUpdate:${t}`)||(W=v.vnode.props)!=null&&W.hasOwnProperty(`onUpdate:${T}`)))}:()=>{var B,U;return e[t],!!((B=v.vnode.props)!=null&&B.hasOwnProperty(t)&&((U=v.vnode.props)!=null&&U.hasOwnProperty(`onUpdate:${t}`)))});za(()=>!D.value,()=>{On(()=>e[t],B=>{y.value=B})});const L=Se({get(){const B=e[t];return c(D.value?B:y.value)},set(B){const U=d(B),$=ui(D.value?e[t]:y.value);$===U||c($)===B||(y.value=U,v==null||v.emit(`update:${t}`,U))}});return Object.defineProperty(L,"externalValue",{get:()=>D.value?e[t]:y.value}),L}const Yq={badge:"Badge",open:"Open",close:"Close",dismiss:"Dismiss",confirmEdit:{ok:"OK",cancel:"Cancel"},dataIterator:{noResultsText:"No matching records found",loadingText:"Loading items..."},dataTable:{itemsPerPageText:"Rows per page:",ariaLabel:{sortDescending:"Sorted descending.",sortAscending:"Sorted ascending.",sortNone:"Not sorted.",activateNone:"Activate to remove sorting.",activateDescending:"Activate to sort descending.",activateAscending:"Activate to sort ascending."},sortBy:"Sort by"},dataFooter:{itemsPerPageText:"Items per page:",itemsPerPageAll:"All",nextPage:"Next page",prevPage:"Previous page",firstPage:"First page",lastPage:"Last page",pageText:"{0}-{1} of {2}"},dateRangeInput:{divider:"to"},datePicker:{itemsSelected:"{0} selected",range:{title:"Select dates",header:"Enter dates"},title:"Select date",header:"Enter date",input:{placeholder:"Enter date"}},noDataText:"No data available",carousel:{prev:"Previous visual",next:"Next visual",ariaLabel:{delimiter:"Carousel slide {0} of {1}"}},calendar:{moreEvents:"{0} more",today:"Today"},input:{clear:"Clear {0}",prependAction:"{0} prepended action",appendAction:"{0} appended action",otp:"Please enter OTP character {0}"},fileInput:{counter:"{0} files",counterSize:"{0} files ({1} in total)"},timePicker:{am:"AM",pm:"PM",title:"Select Time"},pagination:{ariaLabel:{root:"Pagination Navigation",next:"Next page",previous:"Previous page",page:"Go to page {0}",currentPage:"Page {0}, Current page",first:"First page",last:"Last page"}},stepper:{next:"Next",prev:"Previous"},rating:{ariaLabel:{item:"Rating {0} of {1}"}},loading:"Loading...",infiniteScroll:{loadMore:"Load more",empty:"No more"}},KM="$vuetify.",JM=(e,t)=>e.replace(/\{(\d+)\}/g,(o,c)=>String(t[+c])),FL=(e,t,o)=>function(c){for(var d=arguments.length,v=new Array(d>1?d-1:0),y=1;y<d;y++)v[y-1]=arguments[y];if(!c.startsWith(KM))return JM(c,v);const T=c.replace(KM,""),r=e.value&&o.value[e.value],D=t.value&&o.value[t.value];let L=bd(r,T,null);return L||(`${c}${e.value}`,L=bd(D,T,null)),L||(L=c),typeof L!="string"&&(L=c),JM(L,v)};function VL(e,t){return(o,c)=>new Intl.NumberFormat([e.value,t.value],c).format(o)}function N1(e,t,o){const c=ei(e,t,e[t]??o.value);return c.value=e[t]??o.value,On(o,d=>{e[t]==null&&(c.value=o.value)}),c}function NL(e){return t=>{const o=N1(t,"locale",e.current),c=N1(t,"fallback",e.fallback),d=N1(t,"messages",e.messages);return{name:"vuetify",current:o,fallback:c,messages:d,t:FL(o,c,d),n:VL(o,c),provide:NL({current:o,fallback:c,messages:d})}}}function Kq(e){const t=kn((e==null?void 0:e.locale)??"en"),o=kn((e==null?void 0:e.fallback)??"en"),c=rn({en:Yq,...e==null?void 0:e.messages});return{name:"vuetify",current:t,fallback:o,messages:c,t:FL(t,o,c),n:VL(t,o),provide:NL({current:t,fallback:o,messages:c})}}const Dp=Symbol.for("vuetify:locale");function Jq(e){return e.name!=null}function Qq(e){const t=e!=null&&e.adapter&&Jq(e==null?void 0:e.adapter)?e==null?void 0:e.adapter:Kq(e),o=n7(t,e);return{...t,...o}}function zo(){const e=Mi(Dp);if(!e)throw new Error("[Vuetify] Could not find injected locale instance");return e}function e7(e){const t=Mi(Dp);if(!t)throw new Error("[Vuetify] Could not find injected locale instance");const o=t.provide(e),c=i7(o,t.rtl,e),d={...o,...c};return Vr(Dp,d),d}function t7(){return{af:!1,ar:!0,bg:!1,ca:!1,ckb:!1,cs:!1,de:!1,el:!1,en:!1,es:!1,et:!1,fa:!0,fi:!1,fr:!1,hr:!1,hu:!1,he:!0,id:!1,it:!1,ja:!1,km:!1,ko:!1,lv:!1,lt:!1,nl:!1,no:!1,pl:!1,pt:!1,ro:!1,ru:!1,sk:!1,sl:!1,srCyrl:!1,srLatn:!1,sv:!1,th:!1,tr:!1,az:!1,uk:!1,vi:!1,zhHans:!1,zhHant:!1}}function n7(e,t){const o=rn((t==null?void 0:t.rtl)??t7()),c=Se(()=>o.value[e.current.value]??!1);return{isRtl:c,rtl:o,rtlClasses:Se(()=>`v-locale--is-${c.value?"rtl":"ltr"}`)}}function i7(e,t,o){const c=Se(()=>o.rtl??t.value[e.current.value]??!1);return{isRtl:c,rtl:t,rtlClasses:Se(()=>`v-locale--is-${c.value?"rtl":"ltr"}`)}}function gs(){const e=Mi(Dp);if(!e)throw new Error("[Vuetify] Could not find injected rtl instance");return{isRtl:e.isRtl,rtlClasses:e.rtlClasses}}const Z0={"001":1,AD:1,AE:6,AF:6,AG:0,AI:1,AL:1,AM:1,AN:1,AR:1,AS:0,AT:1,AU:1,AX:1,AZ:1,BA:1,BD:0,BE:1,BG:1,BH:6,BM:1,BN:1,BR:0,BS:0,BT:0,BW:0,BY:1,BZ:0,CA:0,CH:1,CL:1,CM:1,CN:1,CO:0,CR:1,CY:1,CZ:1,DE:1,DJ:6,DK:1,DM:0,DO:0,DZ:6,EC:1,EE:1,EG:6,ES:1,ET:0,FI:1,FJ:1,FO:1,FR:1,GB:1,"GB-alt-variant":0,GE:1,GF:1,GP:1,GR:1,GT:0,GU:0,HK:0,HN:0,HR:1,HU:1,ID:0,IE:1,IL:0,IN:0,IQ:6,IR:6,IS:1,IT:1,JM:0,JO:6,JP:0,KE:0,KG:1,KH:0,KR:0,KW:6,KZ:1,LA:0,LB:1,LI:1,LK:1,LT:1,LU:1,LV:1,LY:6,MC:1,MD:1,ME:1,MH:0,MK:1,MM:0,MN:1,MO:0,MQ:1,MT:0,MV:5,MX:0,MY:1,MZ:0,NI:0,NL:1,NO:1,NP:0,NZ:1,OM:6,PA:0,PE:0,PH:0,PK:0,PL:1,PR:0,PT:0,PY:0,QA:6,RE:1,RO:1,RS:1,RU:1,SA:0,SD:6,SE:1,SG:0,SI:1,SK:1,SM:1,SV:0,SY:6,TH:0,TJ:1,TM:1,TR:1,TT:0,TW:0,UA:1,UM:0,US:0,UY:1,UZ:1,VA:1,VE:0,VI:0,VN:1,WS:0,XK:1,YE:0,ZA:0,ZW:0};function r7(e,t,o){const c=[];let d=[];const v=UL(e),y=jL(e),T=o??Z0[t.slice(-2).toUpperCase()]??0,r=(v.getDay()-T+7)%7,D=(y.getDay()-T+7)%7;for(let L=0;L<r;L++){const B=new Date(v);B.setDate(B.getDate()-(r-L)),d.push(B)}for(let L=1;L<=y.getDate();L++){const B=new Date(e.getFullYear(),e.getMonth(),L);d.push(B),d.length===7&&(c.push(d),d=[])}for(let L=1;L<7-D;L++){const B=new Date(y);B.setDate(B.getDate()+L),d.push(B)}return d.length>0&&c.push(d),c}function o7(e,t,o){const c=o??Z0[t.slice(-2).toUpperCase()]??0,d=new Date(e);for(;d.getDay()!==c;)d.setDate(d.getDate()-1);return d}function s7(e,t){const o=new Date(e),c=((Z0[t.slice(-2).toUpperCase()]??0)+6)%7;for(;o.getDay()!==c;)o.setDate(o.getDate()+1);return o}function UL(e){return new Date(e.getFullYear(),e.getMonth(),1)}function jL(e){return new Date(e.getFullYear(),e.getMonth()+1,0)}function a7(e){const t=e.split("-").map(Number);return new Date(t[0],t[1]-1,t[2])}const l7=/^([12]\d{3}-([1-9]|0[1-9]|1[0-2])-([1-9]|0[1-9]|[12]\d|3[01]))$/;function $L(e){if(e==null)return new Date;if(e instanceof Date)return e;if(typeof e=="string"){let t;if(l7.test(e))return a7(e);if(t=Date.parse(e),!isNaN(t))return new Date(t)}return null}const QM=new Date(2e3,0,2);function c7(e,t){const o=t??Z0[e.slice(-2).toUpperCase()]??0;return dc(7).map(c=>{const d=new Date(QM);return d.setDate(QM.getDate()+o+c),new Intl.DateTimeFormat(e,{weekday:"narrow"}).format(d)})}function u7(e,t,o,c){const d=$L(e)??new Date,v=c==null?void 0:c[t];if(typeof v=="function")return v(d,t,o);let y={};switch(t){case"fullDate":y={year:"numeric",month:"long",day:"numeric"};break;case"fullDateWithWeekday":y={weekday:"long",year:"numeric",month:"long",day:"numeric"};break;case"normalDate":const T=d.getDate(),r=new Intl.DateTimeFormat(o,{month:"long"}).format(d);return`${T} ${r}`;case"normalDateWithWeekday":y={weekday:"short",day:"numeric",month:"short"};break;case"shortDate":y={month:"short",day:"numeric"};break;case"year":y={year:"numeric"};break;case"month":y={month:"long"};break;case"monthShort":y={month:"short"};break;case"monthAndYear":y={month:"long",year:"numeric"};break;case"monthAndDate":y={month:"long",day:"numeric"};break;case"weekday":y={weekday:"long"};break;case"weekdayShort":y={weekday:"short"};break;case"dayOfMonth":return new Intl.NumberFormat(o).format(d.getDate());case"hours12h":y={hour:"numeric",hour12:!0};break;case"hours24h":y={hour:"numeric",hour12:!1};break;case"minutes":y={minute:"numeric"};break;case"seconds":y={second:"numeric"};break;case"fullTime":y={hour:"numeric",minute:"numeric",second:"numeric",hour12:!0};break;case"fullTime12h":y={hour:"numeric",minute:"numeric",second:"numeric",hour12:!0};break;case"fullTime24h":y={hour:"numeric",minute:"numeric",second:"numeric",hour12:!1};break;case"fullDateTime":y={year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!0};break;case"fullDateTime12h":y={year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!0};break;case"fullDateTime24h":y={year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!1};break;case"keyboardDate":y={year:"numeric",month:"2-digit",day:"2-digit"};break;case"keyboardDateTime":y={year:"numeric",month:"2-digit",day:"2-digit",hour:"numeric",minute:"numeric",second:"numeric",hour12:!1};break;case"keyboardDateTime12h":y={year:"numeric",month:"2-digit",day:"2-digit",hour:"numeric",minute:"numeric",second:"numeric",hour12:!0};break;case"keyboardDateTime24h":y={year:"numeric",month:"2-digit",day:"2-digit",hour:"numeric",minute:"numeric",second:"numeric",hour12:!1};break;default:y=v??{timeZone:"UTC",timeZoneName:"short"}}return new Intl.DateTimeFormat(o,y).format(d)}function h7(e,t){const o=e.toJsDate(t),c=o.getFullYear(),d=DM(String(o.getMonth()+1),2,"0"),v=DM(String(o.getDate()),2,"0");return`${c}-${d}-${v}`}function d7(e){const[t,o,c]=e.split("-").map(Number);return new Date(t,o-1,c)}function f7(e,t){const o=new Date(e);return o.setMinutes(o.getMinutes()+t),o}function p7(e,t){const o=new Date(e);return o.setHours(o.getHours()+t),o}function m7(e,t){const o=new Date(e);return o.setDate(o.getDate()+t),o}function g7(e,t){const o=new Date(e);return o.setDate(o.getDate()+t*7),o}function _7(e,t){const o=new Date(e);return o.setDate(1),o.setMonth(o.getMonth()+t),o}function v7(e){return e.getFullYear()}function y7(e){return e.getMonth()}function b7(e){return e.getDate()}function x7(e){return new Date(e.getFullYear(),e.getMonth()+1,1)}function w7(e){return new Date(e.getFullYear(),e.getMonth()-1,1)}function S7(e){return e.getHours()}function T7(e){return e.getMinutes()}function E7(e){return new Date(e.getFullYear(),0,1)}function I7(e){return new Date(e.getFullYear(),11,31)}function C7(e,t){return b0(e,t[0])&&M7(e,t[1])}function A7(e){const t=new Date(e);return t instanceof Date&&!isNaN(t.getTime())}function b0(e,t){return e.getTime()>t.getTime()}function P7(e,t){return b0(Dw(e),Dw(t))}function M7(e,t){return e.getTime()<t.getTime()}function ek(e,t){return e.getTime()===t.getTime()}function k7(e,t){return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()}function R7(e,t){return e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()}function D7(e,t){return e.getFullYear()===t.getFullYear()}function O7(e,t,o){const c=new Date(e),d=new Date(t);switch(o){case"years":return c.getFullYear()-d.getFullYear();case"quarters":return Math.floor((c.getMonth()-d.getMonth()+(c.getFullYear()-d.getFullYear())*12)/4);case"months":return c.getMonth()-d.getMonth()+(c.getFullYear()-d.getFullYear())*12;case"weeks":return Math.floor((c.getTime()-d.getTime())/(1e3*60*60*24*7));case"days":return Math.floor((c.getTime()-d.getTime())/(1e3*60*60*24));case"hours":return Math.floor((c.getTime()-d.getTime())/(1e3*60*60));case"minutes":return Math.floor((c.getTime()-d.getTime())/(1e3*60));case"seconds":return Math.floor((c.getTime()-d.getTime())/1e3);default:return c.getTime()-d.getTime()}}function L7(e,t){const o=new Date(e);return o.setHours(t),o}function z7(e,t){const o=new Date(e);return o.setMinutes(t),o}function B7(e,t){const o=new Date(e);return o.setMonth(t),o}function F7(e,t){const o=new Date(e);return o.setDate(t),o}function V7(e,t){const o=new Date(e);return o.setFullYear(t),o}function Dw(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0)}function N7(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),23,59,59,999)}class U7{constructor(t){this.locale=t.locale,this.formats=t.formats}date(t){return $L(t)}toJsDate(t){return t}toISO(t){return h7(this,t)}parseISO(t){return d7(t)}addMinutes(t,o){return f7(t,o)}addHours(t,o){return p7(t,o)}addDays(t,o){return m7(t,o)}addWeeks(t,o){return g7(t,o)}addMonths(t,o){return _7(t,o)}getWeekArray(t,o){return r7(t,this.locale,o?Number(o):void 0)}startOfWeek(t,o){return o7(t,this.locale,o?Number(o):void 0)}endOfWeek(t){return s7(t,this.locale)}startOfMonth(t){return UL(t)}endOfMonth(t){return jL(t)}format(t,o){return u7(t,o,this.locale,this.formats)}isEqual(t,o){return ek(t,o)}isValid(t){return A7(t)}isWithinRange(t,o){return C7(t,o)}isAfter(t,o){return b0(t,o)}isAfterDay(t,o){return P7(t,o)}isBefore(t,o){return!b0(t,o)&&!ek(t,o)}isSameDay(t,o){return k7(t,o)}isSameMonth(t,o){return R7(t,o)}isSameYear(t,o){return D7(t,o)}setMinutes(t,o){return z7(t,o)}setHours(t,o){return L7(t,o)}setMonth(t,o){return B7(t,o)}setDate(t,o){return F7(t,o)}setYear(t,o){return V7(t,o)}getDiff(t,o,c){return O7(t,o,c)}getWeekdays(t){return c7(this.locale,t?Number(t):void 0)}getYear(t){return v7(t)}getMonth(t){return y7(t)}getDate(t){return b7(t)}getNextMonth(t){return x7(t)}getPreviousMonth(t){return w7(t)}getHours(t){return S7(t)}getMinutes(t){return T7(t)}startOfDay(t){return Dw(t)}endOfDay(t){return N7(t)}startOfYear(t){return E7(t)}endOfYear(t){return I7(t)}}const GL=Symbol.for("vuetify:date-options"),tk=Symbol.for("vuetify:date-adapter");function j7(e,t){const o=Zs({adapter:U7,locale:{af:"af-ZA",bg:"bg-BG",ca:"ca-ES",ckb:"",cs:"cs-CZ",de:"de-DE",el:"el-GR",en:"en-US",et:"et-EE",fa:"fa-IR",fi:"fi-FI",hr:"hr-HR",hu:"hu-HU",he:"he-IL",id:"id-ID",it:"it-IT",ja:"ja-JP",ko:"ko-KR",lv:"lv-LV",lt:"lt-LT",nl:"nl-NL",no:"no-NO",pl:"pl-PL",pt:"pt-PT",ro:"ro-RO",ru:"ru-RU",sk:"sk-SK",sl:"sl-SI",srCyrl:"sr-SP",srLatn:"sr-SP",sv:"sv-SE",th:"th-TH",tr:"tr-TR",az:"az-AZ",uk:"uk-UA",vi:"vi-VN",zhHans:"zh-CN",zhHant:"zh-TW"}},e);return{options:o,instance:HL(o,t)}}function HL(e,t){const o=Ls(typeof e.adapter=="function"?new e.adapter({locale:e.locale[t.current.value]??t.current.value,formats:e.formats}):e.adapter);return On(t.current,c=>{o.locale=e.locale[c]??c??o.locale}),o}function T_(){const e=Mi(GL);if(!e)throw new Error("[Vuetify] Could not find injected date options");const t=zo();return HL(e,t)}function $7(e,t){const o=e.toJsDate(t);let c=o.getFullYear(),d=new Date(c,0,1);if(o<d)c=c-1,d=new Date(c,0,1);else{const T=new Date(c+1,0,1);o>=T&&(c=c+1,d=T)}const v=Math.abs(o.getTime()-d.getTime()),y=Math.ceil(v/(1e3*60*60*24));return Math.floor(y/7)+1}const X0=["sm","md","lg","xl","xxl"],Ow=Symbol.for("vuetify:display"),nk={mobileBreakpoint:"lg",thresholds:{xs:0,sm:600,md:960,lg:1280,xl:1920,xxl:2560}},G7=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:nk;return Zs(nk,e)};function ik(e){return Ar&&!e?window.innerWidth:typeof e=="object"&&e.clientWidth||0}function rk(e){return Ar&&!e?window.innerHeight:typeof e=="object"&&e.clientHeight||0}function ok(e){const t=Ar&&!e?window.navigator.userAgent:"ssr";function o(W){return!!t.match(W)}const c=o(/android/i),d=o(/iphone|ipad|ipod/i),v=o(/cordova/i),y=o(/electron/i),T=o(/chrome/i),r=o(/edge/i),D=o(/firefox/i),L=o(/opera/i),B=o(/win/i),U=o(/mac/i),$=o(/linux/i);return{android:c,ios:d,cordova:v,electron:y,chrome:T,edge:r,firefox:D,opera:L,win:B,mac:U,linux:$,touch:sq,ssr:t==="ssr"}}function H7(e,t){const{thresholds:o,mobileBreakpoint:c}=G7(e),d=kn(rk(t)),v=kn(ok(t)),y=Ls({}),T=kn(ik(t));function r(){d.value=rk(),T.value=ik()}function D(){r(),v.value=ok()}return Oo(()=>{const L=T.value<o.sm,B=T.value<o.md&&!L,U=T.value<o.lg&&!(B||L),$=T.value<o.xl&&!(U||B||L),W=T.value<o.xxl&&!($||U||B||L),q=T.value>=o.xxl,ne=L?"xs":B?"sm":U?"md":$?"lg":W?"xl":"xxl",ce=typeof c=="number"?c:o[c],oe=T.value<ce;y.xs=L,y.sm=B,y.md=U,y.lg=$,y.xl=W,y.xxl=q,y.smAndUp=!L,y.mdAndUp=!(L||B),y.lgAndUp=!(L||B||U),y.xlAndUp=!(L||B||U||$),y.smAndDown=!(U||$||W||q),y.mdAndDown=!($||W||q),y.lgAndDown=!(W||q),y.xlAndDown=!q,y.name=ne,y.height=d.value,y.width=T.value,y.mobile=oe,y.mobileBreakpoint=c,y.platform=v.value,y.thresholds=o}),Ar&&window.addEventListener("resize",r,{passive:!0}),{...Pd(y),update:D,ssr:!!t}}const Rd=At({mobile:{type:Boolean,default:!1},mobileBreakpoint:[Number,String]},"display");function _l(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Sc();const o=Mi(Ow);if(!o)throw new Error("Could not find Vuetify display injection");const c=Se(()=>{if(e.mobile!=null)return e.mobile;if(!e.mobileBreakpoint)return o.mobile.value;const v=typeof e.mobileBreakpoint=="number"?e.mobileBreakpoint:o.thresholds.value[e.mobileBreakpoint];return o.width.value<v}),d=Se(()=>t?{[`${t}--mobile`]:c.value}:{});return{...o,displayClasses:d,mobile:c}}const qL=Symbol.for("vuetify:goto");function WL(){return{container:void 0,duration:300,layout:!1,offset:0,easing:"easeInOutCubic",patterns:{linear:e=>e,easeInQuad:e=>e**2,easeOutQuad:e=>e*(2-e),easeInOutQuad:e=>e<.5?2*e**2:-1+(4-2*e)*e,easeInCubic:e=>e**3,easeOutCubic:e=>--e**3+1,easeInOutCubic:e=>e<.5?4*e**3:(e-1)*(2*e-2)*(2*e-2)+1,easeInQuart:e=>e**4,easeOutQuart:e=>1- --e**4,easeInOutQuart:e=>e<.5?8*e**4:1-8*--e**4,easeInQuint:e=>e**5,easeOutQuint:e=>1+--e**5,easeInOutQuint:e=>e<.5?16*e**5:1+16*--e**5}}}function q7(e){return wT(e)??(document.scrollingElement||document.body)}function wT(e){return typeof e=="string"?document.querySelector(e):dT(e)}function U1(e,t,o){if(typeof e=="number")return t&&o?-e:e;let c=wT(e),d=0;for(;c;)d+=t?c.offsetLeft:c.offsetTop,c=c.offsetParent;return d}function W7(e,t){return{rtl:t.isRtl,options:Zs(WL(),e)}}async function sk(e,t,o,c){const d=o?"scrollLeft":"scrollTop",v=Zs((c==null?void 0:c.options)??WL(),t),y=c==null?void 0:c.rtl.value,T=(typeof e=="number"?e:wT(e))??0,r=v.container==="parent"&&T instanceof HTMLElement?T.parentElement:q7(v.container),D=typeof v.easing=="function"?v.easing:v.patterns[v.easing];if(!D)throw new TypeError(`Easing function "${v.easing}" not found.`);let L;if(typeof T=="number")L=U1(T,o,y);else if(L=U1(T,o,y)-U1(r,o,y),v.layout){const W=window.getComputedStyle(T).getPropertyValue("--v-layout-top");W&&(L-=parseInt(W,10))}L+=v.offset,L=X7(r,L,!!y,!!o);const B=r[d]??0;if(L===B)return Promise.resolve(L);const U=performance.now();return new Promise($=>requestAnimationFrame(function W(q){const ce=(q-U)/v.duration,oe=Math.floor(B+(L-B)*D(Go(ce,0,1)));if(r[d]=oe,ce>=1&&Math.abs(oe-r[d])<10)return $(L);if(ce>2)return $(r[d]);requestAnimationFrame(W)}))}function Z7(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=Mi(qL),{isRtl:o}=gs();if(!t)throw new Error("[Vuetify] Could not find injected goto instance");const c={...t,rtl:Se(()=>t.rtl.value||o.value)};async function d(v,y){return sk(v,Zs(e,y),!1,c)}return d.horizontal=async(v,y)=>sk(v,Zs(e,y),!0,c),d}function X7(e,t,o,c){const{scrollWidth:d,scrollHeight:v}=e,[y,T]=e===document.scrollingElement?[window.innerWidth,window.innerHeight]:[e.offsetWidth,e.offsetHeight];let r,D;return c?o?(r=-(d-y),D=0):(r=0,D=d-y):(r=0,D=v+-T),Math.max(Math.min(t,D),r)}const Y7={collapse:"mdi-chevron-up",complete:"mdi-check",cancel:"mdi-close-circle",close:"mdi-close",delete:"mdi-close-circle",clear:"mdi-close-circle",success:"mdi-check-circle",info:"mdi-information",warning:"mdi-alert-circle",error:"mdi-close-circle",prev:"mdi-chevron-left",next:"mdi-chevron-right",checkboxOn:"mdi-checkbox-marked",checkboxOff:"mdi-checkbox-blank-outline",checkboxIndeterminate:"mdi-minus-box",delimiter:"mdi-circle",sortAsc:"mdi-arrow-up",sortDesc:"mdi-arrow-down",expand:"mdi-chevron-down",menu:"mdi-menu",subgroup:"mdi-menu-down",dropdown:"mdi-menu-down",radioOn:"mdi-radiobox-marked",radioOff:"mdi-radiobox-blank",edit:"mdi-pencil",ratingEmpty:"mdi-star-outline",ratingFull:"mdi-star",ratingHalf:"mdi-star-half-full",loading:"mdi-cached",first:"mdi-page-first",last:"mdi-page-last",unfold:"mdi-unfold-more-horizontal",file:"mdi-paperclip",plus:"mdi-plus",minus:"mdi-minus",calendar:"mdi-calendar",treeviewCollapse:"mdi-menu-down",treeviewExpand:"mdi-menu-right",eyeDropper:"mdi-eyedropper"},K7={component:e=>Gl(TT,{...e,class:"mdi"})},mi=[String,Function,Object,Array],Lw=Symbol.for("vuetify:icons"),Y0=At({icon:{type:mi},tag:{type:String,required:!0}},"icon"),zw=Jt()({name:"VComponentIcon",props:Y0(),setup(e,t){let{slots:o}=t;return()=>{const c=e.icon;return Z(e.tag,null,{default:()=>{var d;return[e.icon?Z(c,null,null):(d=o.default)==null?void 0:d.call(o)]}})}}}),ST=Ka({name:"VSvgIcon",inheritAttrs:!1,props:Y0(),setup(e,t){let{attrs:o}=t;return()=>Z(e.tag,fn(o,{style:null}),{default:()=>[Z("svg",{class:"v-icon__svg",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",role:"img","aria-hidden":"true"},[Array.isArray(e.icon)?e.icon.map(c=>Array.isArray(c)?Z("path",{d:c[0],"fill-opacity":c[1]},null):Z("path",{d:c},null)):Z("path",{d:e.icon},null)])]})}}),J7=Ka({name:"VLigatureIcon",props:Y0(),setup(e){return()=>Z(e.tag,null,{default:()=>[e.icon]})}}),TT=Ka({name:"VClassIcon",props:Y0(),setup(e){return()=>Z(e.tag,{class:e.icon},null)}});function Q7(){return{svg:{component:ST},class:{component:TT}}}function eW(e){const t=Q7(),o=(e==null?void 0:e.defaultSet)??"mdi";return o==="mdi"&&!t.mdi&&(t.mdi=K7),Zs({defaultSet:o,sets:t,aliases:{...Y7,vuetify:["M8.2241 14.2009L12 21L22 3H14.4459L8.2241 14.2009Z",["M7.26303 12.4733L7.00113 12L2 3H12.5261C12.5261 3 12.5261 3 12.5261 3L7.26303 12.4733Z",.6]],"vuetify-outline":"svg:M7.26 12.47 12.53 3H2L7.26 12.47ZM14.45 3 8.22 14.2 12 21 22 3H14.45ZM18.6 5 12 16.88 10.51 14.2 15.62 5ZM7.26 8.35 5.4 5H9.13L7.26 8.35Z","vuetify-play":["m6.376 13.184-4.11-7.192C1.505 4.66 2.467 3 4.003 3h8.532l-.953 1.576-.006.01-.396.677c-.429.732-.214 1.507.194 2.015.404.503 1.092.878 1.869.806a3.72 3.72 0 0 1 1.005.022c.276.053.434.143.523.237.138.146.38.635-.25 2.09-.893 1.63-1.553 1.722-1.847 1.677-.213-.033-.468-.158-.756-.406a4.95 4.95 0 0 1-.8-.927c-.39-.564-1.04-.84-1.66-.846-.625-.006-1.316.27-1.693.921l-.478.826-.911 1.506Z",["M9.093 11.552c.046-.079.144-.15.32-.148a.53.53 0 0 1 .43.207c.285.414.636.847 1.046 1.2.405.35.914.662 1.516.754 1.334.205 2.502-.698 3.48-2.495l.014-.028.013-.03c.687-1.574.774-2.852-.005-3.675-.37-.391-.861-.586-1.333-.676a5.243 5.243 0 0 0-1.447-.044c-.173.016-.393-.073-.54-.257-.145-.18-.127-.316-.082-.392l.393-.672L14.287 3h5.71c1.536 0 2.499 1.659 1.737 2.992l-7.997 13.996c-.768 1.344-2.706 1.344-3.473 0l-3.037-5.314 1.377-2.278.004-.006.004-.007.481-.831Z",.6]]}},e)}const tW=e=>{const t=Mi(Lw);if(!t)throw new Error("Missing Vuetify Icons provide!");return{iconData:Se(()=>{var r;const c=Zo(e);if(!c)return{component:zw};let d=c;if(typeof d=="string"&&(d=d.trim(),d.startsWith("$")&&(d=(r=t.aliases)==null?void 0:r[d.slice(1)])),Array.isArray(d))return{component:ST,icon:d};if(typeof d!="string")return{component:zw,icon:d};const v=Object.keys(t.sets).find(D=>typeof d=="string"&&d.startsWith(`${D}:`)),y=v?d.slice(v.length+1):d;return{component:t.sets[v??t.defaultSet].component,icon:y}})}},n_=Symbol.for("vuetify:theme"),Ji=At({theme:String},"theme");function ak(){return{defaultTheme:"light",variations:{colors:[],lighten:0,darken:0},themes:{light:{dark:!1,colors:{background:"#FFFFFF",surface:"#FFFFFF","surface-bright":"#FFFFFF","surface-light":"#EEEEEE","surface-variant":"#424242","on-surface-variant":"#EEEEEE",primary:"#1867C0","primary-darken-1":"#1F5592",secondary:"#48A9A6","secondary-darken-1":"#018786",error:"#B00020",info:"#2196F3",success:"#4CAF50",warning:"#FB8C00"},variables:{"border-color":"#000000","border-opacity":.12,"high-emphasis-opacity":.87,"medium-emphasis-opacity":.6,"disabled-opacity":.38,"idle-opacity":.04,"hover-opacity":.04,"focus-opacity":.12,"selected-opacity":.08,"activated-opacity":.12,"pressed-opacity":.12,"dragged-opacity":.08,"theme-kbd":"#212529","theme-on-kbd":"#FFFFFF","theme-code":"#F5F5F5","theme-on-code":"#000000"}},dark:{dark:!0,colors:{background:"#121212",surface:"#212121","surface-bright":"#ccbfd6","surface-light":"#424242","surface-variant":"#a3a3a3","on-surface-variant":"#424242",primary:"#2196F3","primary-darken-1":"#277CC1",secondary:"#54B6B2","secondary-darken-1":"#48A9A6",error:"#CF6679",info:"#2196F3",success:"#4CAF50",warning:"#FB8C00"},variables:{"border-color":"#FFFFFF","border-opacity":.12,"high-emphasis-opacity":1,"medium-emphasis-opacity":.7,"disabled-opacity":.5,"idle-opacity":.1,"hover-opacity":.04,"focus-opacity":.12,"selected-opacity":.08,"activated-opacity":.12,"pressed-opacity":.16,"dragged-opacity":.08,"theme-kbd":"#212529","theme-on-kbd":"#FFFFFF","theme-code":"#343434","theme-on-code":"#CCCCCC"}}}}}function nW(){var c,d;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ak();const t=ak();if(!e)return{...t,isDisabled:!0};const o={};for(const[v,y]of Object.entries(e.themes??{})){const T=y.dark||v==="dark"?(c=t.themes)==null?void 0:c.dark:(d=t.themes)==null?void 0:d.light;o[v]=Zs(T,y)}return Zs(t,{...e,themes:o})}function iW(e){const t=nW(e),o=rn(t.defaultTheme),c=rn(t.themes),d=Se(()=>{const L={};for(const[B,U]of Object.entries(c.value)){const $=L[B]={...U,colors:{...U.colors}};if(t.variations)for(const W of t.variations.colors){const q=$.colors[W];if(q)for(const ne of["lighten","darken"]){const ce=ne==="lighten"?Fq:Vq;for(const oe of dc(t.variations[ne],1))$.colors[`${W}-${ne}-${oe}`]=kL(ce(dl(q),oe))}}for(const W of Object.keys($.colors)){if(/^on-[a-z]/.test(W)||$.colors[`on-${W}`])continue;const q=`on-${W}`,ne=dl($.colors[W]);$.colors[q]=LL(ne)}}return L}),v=Se(()=>d.value[o.value]),y=Se(()=>{var W;const L=[];(W=v.value)!=null&&W.dark&&od(L,":root",["color-scheme: dark"]),od(L,":root",lk(v.value));for(const[q,ne]of Object.entries(d.value))od(L,`.v-theme--${q}`,[`color-scheme: ${ne.dark?"dark":"normal"}`,...lk(ne)]);const B=[],U=[],$=new Set(Object.values(d.value).flatMap(q=>Object.keys(q.colors)));for(const q of $)/^on-[a-z]/.test(q)?od(U,`.${q}`,[`color: rgb(var(--v-theme-${q})) !important`]):(od(B,`.bg-${q}`,[`--v-theme-overlay-multiplier: var(--v-theme-${q}-overlay-multiplier)`,`background-color: rgb(var(--v-theme-${q})) !important`,`color: rgb(var(--v-theme-on-${q})) !important`]),od(U,`.text-${q}`,[`color: rgb(var(--v-theme-${q})) !important`]),od(U,`.border-${q}`,[`--v-border-color: var(--v-theme-${q})`]));return L.push(...B,...U),L.map((q,ne)=>ne===0?q:`    ${q}`).join("")});function T(){return{style:[{children:y.value,id:"vuetify-theme-stylesheet",nonce:t.cspNonce||!1}]}}function r(L){if(t.isDisabled)return;const B=L._context.provides.usehead;if(B)if(B.push){const $=B.push(T);Ar&&On(y,()=>{$.patch(T)})}else Ar?(B.addHeadObjs(Se(T)),Oo(()=>B.updateDOM())):B.addHeadObjs(T());else{let W=function(){if(typeof document<"u"&&!$){const q=document.createElement("style");q.type="text/css",q.id="vuetify-theme-stylesheet",t.cspNonce&&q.setAttribute("nonce",t.cspNonce),$=q,document.head.appendChild($)}$&&($.innerHTML=y.value)};var U=W;let $=Ar?document.getElementById("vuetify-theme-stylesheet"):null;Ar?On(y,W,{immediate:!0}):W()}}const D=Se(()=>t.isDisabled?void 0:`v-theme--${o.value}`);return{install:r,isDisabled:t.isDisabled,name:o,themes:c,current:v,computedThemes:d,themeClasses:D,styles:y,global:{name:o,current:v}}}function xr(e){Lo("provideTheme");const t=Mi(n_,null);if(!t)throw new Error("Could not find Vuetify theme injection");const o=Se(()=>e.theme??t.name.value),c=Se(()=>t.themes.value[o.value]),d=Se(()=>t.isDisabled?void 0:`v-theme--${o.value}`),v={...t,name:o,current:c,themeClasses:d};return Vr(n_,v),v}function ZL(){Lo("useTheme");const e=Mi(n_,null);if(!e)throw new Error("Could not find Vuetify theme injection");return e}function od(e,t,o){e.push(`${t} {
`,...o.map(c=>`  ${c};
`),`}
`)}function lk(e){const t=e.dark?2:1,o=e.dark?1:2,c=[];for(const[d,v]of Object.entries(e.colors)){const y=dl(v);c.push(`--v-theme-${d}: ${y.r},${y.g},${y.b}`),d.startsWith("on-")||c.push(`--v-theme-${d}-overlay-multiplier: ${Rw(v)>.18?t:o}`)}for(const[d,v]of Object.entries(e.variables)){const y=typeof v=="string"&&v.startsWith("#")?dl(v):void 0,T=y?`${y.r}, ${y.g}, ${y.b}`:void 0;c.push(`--v-${d}: ${T??v}`)}return c}function $l(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"content";const o=g0(),c=rn();if(Ar){const d=new ResizeObserver(v=>{e==null||e(v,d),v.length&&(t==="content"?c.value=v[0].contentRect:c.value=v[0].target.getBoundingClientRect())});Ts(()=>{d.disconnect()}),On(()=>o.el,(v,y)=>{y&&(d.unobserve(y),c.value=void 0),v&&d.observe(v)},{flush:"post"})}return{resizeRef:o,contentRect:zp(c)}}const i_=Symbol.for("vuetify:layout"),XL=Symbol.for("vuetify:layout-item"),ck=1e3,YL=At({overlaps:{type:Array,default:()=>[]},fullHeight:Boolean},"layout"),Dd=At({name:{type:String},order:{type:[Number,String],default:0},absolute:Boolean},"layout-item");function KL(){const e=Mi(i_);if(!e)throw new Error("[Vuetify] Could not find injected layout");return{layoutIsReady:Ki(),getLayoutItem:e.getLayoutItem,mainRect:e.mainRect,mainStyles:e.mainStyles}}function Od(e){const t=Mi(i_);if(!t)throw new Error("[Vuetify] Could not find injected layout");const o=e.id??`layout-item-${Es()}`,c=Lo("useLayoutItem");Vr(XL,{id:o});const d=kn(!1);SS(()=>d.value=!0),SR(()=>d.value=!1);const v=Ki(),{layoutItemStyles:y,layoutItemScrimStyles:T}=t.register(c,{...e,active:Se(()=>d.value?!1:e.active.value),id:o});return Ts(()=>t.unregister(o)),{layoutItemStyles:y,layoutRect:t.layoutRect,layoutItemScrimStyles:T,layoutIsReady:v}}const rW=(e,t,o,c)=>{let d={top:0,left:0,right:0,bottom:0};const v=[{id:"",layer:{...d}}];for(const y of e){const T=t.get(y),r=o.get(y),D=c.get(y);if(!T||!r||!D)continue;const L={...d,[T.value]:parseInt(d[T.value],10)+(D.value?parseInt(r.value,10):0)};v.push({id:y,layer:L}),d=L}return v};function JL(e){const t=Mi(i_,null),o=Se(()=>t?t.rootZIndex.value-100:ck),c=rn([]),d=Ls(new Map),v=Ls(new Map),y=Ls(new Map),T=Ls(new Map),r=Ls(new Map),{resizeRef:D,contentRect:L}=$l(),B=zM(()=>{const ge=[...new Set([...y.values()].map(de=>de.value))].sort((de,re)=>de-re),Ee=[];for(const de of ge){const re=c.value.filter(Y=>{var ie;return((ie=y.get(Y))==null?void 0:ie.value)===de});Ee.push(...re)}return rW(Ee,d,v,T)}),U=Se(()=>!Array.from(r.values()).some(ge=>ge.value)),$=Se(()=>B.value[B.value.length-1].layer),W=Se(()=>({"--v-layout-left":Bn($.value.left),"--v-layout-right":Bn($.value.right),"--v-layout-top":Bn($.value.top),"--v-layout-bottom":Bn($.value.bottom),...U.value?void 0:{transition:"none"}})),q=zM(()=>B.value.slice(1).map((ge,Ee)=>{let{id:de}=ge;const{layer:re}=B.value[Ee],Y=v.get(de),ie=d.get(de);return{id:de,...re,size:Number(Y.value),position:ie.value}})),ne=ge=>q.value.find(Ee=>Ee.id===ge),ce=Lo("createLayout"),oe=Ki();Vr(i_,{register:(ge,Ee)=>{let{id:de,order:re,position:Y,layoutSize:ie,elementSize:te,active:ae,disableTransitions:pe,absolute:Le}=Ee;y.set(de,re),d.set(de,Y),v.set(de,ie),T.set(de,ae),pe&&r.set(de,pe);const Je=cp(XL,ce==null?void 0:ce.vnode).indexOf(ge);Je>-1?c.value.splice(Je,0,de):c.value.push(de);const Mt=Se(()=>q.value.findIndex(mt=>mt.id===de)),Lt=Se(()=>o.value+B.value.length*2-Mt.value*2),yt=Se(()=>{const mt=Y.value==="left"||Y.value==="right",Ft=Y.value==="right",bn=Y.value==="bottom",Bt=te.value??ie.value,ht=Bt===0?"%":"px",gt={[Y.value]:0,zIndex:Lt.value,transform:`translate${mt?"X":"Y"}(${(ae.value?0:-(Bt===0?100:Bt))*(Ft||bn?-1:1)}${ht})`,position:Le.value||o.value!==ck?"absolute":"fixed",...U.value?void 0:{transition:"none"}};if(Mt.value<0)throw new Error(`Layout item "${de}" is missing`);const et=q.value[Mt.value];if(!et)throw new Error(`[Vuetify] Could not find layout item "${de}"`);return{...gt,height:mt?`calc(100% - ${et.top}px - ${et.bottom}px)`:te.value?`${te.value}px`:void 0,left:Ft?void 0:`${et.left}px`,right:Ft?`${et.right}px`:void 0,top:Y.value!=="bottom"?`${et.top}px`:void 0,bottom:Y.value!=="top"?`${et.bottom}px`:void 0,width:mt?te.value?`${te.value}px`:void 0:`calc(100% - ${et.left}px - ${et.right}px)`}}),rt=Se(()=>({zIndex:Lt.value-1}));return{layoutItemStyles:yt,layoutItemScrimStyles:rt,zIndex:Lt}},unregister:ge=>{y.delete(ge),d.delete(ge),v.delete(ge),T.delete(ge),r.delete(ge),c.value=c.value.filter(Ee=>Ee!==ge)},mainRect:$,mainStyles:W,getLayoutItem:ne,items:q,layoutRect:L,rootZIndex:o,layoutIsReady:oe});const fe=Se(()=>["v-layout",{"v-layout--full-height":e.fullHeight}]),be=Se(()=>({zIndex:t?o.value:void 0,position:t?"relative":void 0,overflow:t?"hidden":void 0}));return{layoutClasses:fe,layoutStyles:be,getLayoutItem:ne,items:q,layoutRect:L,layoutIsReady:oe,layoutRef:D}}function QL(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{blueprint:t,...o}=e,c=Zs(t,o),{aliases:d={},components:v={},directives:y={}}=c,T=jq(c.defaults),r=H7(c.display,c.ssr),D=iW(c.theme),L=eW(c.icons),B=Qq(c.locale),U=j7(c.date,B),$=W7(c.goTo,B);return{install:q=>{for(const ne in y)q.directive(ne,y[ne]);for(const ne in v)q.component(ne,v[ne]);for(const ne in d)q.component(ne,Ka({...d[ne],name:ne,aliasName:d[ne].name}));if(D.install(q),q.provide(Rp,T),q.provide(Ow,r),q.provide(n_,D),q.provide(Lw,L),q.provide(Dp,B),q.provide(GL,U.options),q.provide(tk,U.instance),q.provide(qL,$),Ar&&c.ssr)if(q.$nuxt)q.$nuxt.hook("app:suspense:resolve",()=>{r.update()});else{const{mount:ne}=q;q.mount=function(){const ce=ne(...arguments);return Ki(()=>r.update()),q.mount=ne,ce}}Es.reset(),q.mixin({computed:{$vuetify(){return Ls({defaults:np.call(this,Rp),display:np.call(this,Ow),theme:np.call(this,n_),icons:np.call(this,Lw),locale:np.call(this,Dp),date:np.call(this,tk)})}}})},defaults:T,display:r,theme:D,icons:L,locale:B,date:U,goTo:$}}const oW="3.7.0-beta.1";QL.version=oW;function np(e){var c,d;const t=this.$,o=((c=t.parent)==null?void 0:c.provides)??((d=t.vnode.appContext)==null?void 0:d.provides);if(o&&e in o)return o[e]}const sW=At({...Nn(),...YL({fullHeight:!0}),...Ji()},"VApp"),aW=Jt()({name:"VApp",props:sW(),setup(e,t){let{slots:o}=t;const c=xr(e),{layoutClasses:d,getLayoutItem:v,items:y,layoutRef:T}=JL(e),{rtlClasses:r}=gs();return cn(()=>Z("div",{ref:T,class:["v-application",c.themeClasses.value,d.value,r.value,e.class],style:[e.style]},[Z("div",{class:"v-application__wrap"},[Z(UR,null,{default:()=>{var D;return[Z(Gn,null,[(D=o.default)==null?void 0:D.call(o)])]}})])])),{getLayoutItem:v,items:y,theme:c}}}),Si=At({tag:{type:String,default:"div"}},"tag"),ez=At({text:String,...Nn(),...Si()},"VToolbarTitle"),ET=Jt()({name:"VToolbarTitle",props:ez(),setup(e,t){let{slots:o}=t;return cn(()=>{const c=!!(o.default||o.text||e.text);return Z(e.tag,{class:["v-toolbar-title",e.class],style:e.style},{default:()=>{var d;return[c&&Z("div",{class:"v-toolbar-title__placeholder"},[o.text?o.text():e.text,(d=o.default)==null?void 0:d.call(o)])]}})}),{}}}),lW=At({disabled:Boolean,group:Boolean,hideOnLeave:Boolean,leaveAbsolute:Boolean,mode:String,origin:String},"transition");function Ja(e,t,o){return Jt()({name:e,props:lW({mode:o,origin:t}),setup(c,d){let{slots:v}=d;const y={onBeforeEnter(T){c.origin&&(T.style.transformOrigin=c.origin)},onLeave(T){if(c.leaveAbsolute){const{offsetTop:r,offsetLeft:D,offsetWidth:L,offsetHeight:B}=T;T._transitionInitialStyles={position:T.style.position,top:T.style.top,left:T.style.left,width:T.style.width,height:T.style.height},T.style.position="absolute",T.style.top=`${r}px`,T.style.left=`${D}px`,T.style.width=`${L}px`,T.style.height=`${B}px`}c.hideOnLeave&&T.style.setProperty("display","none","important")},onAfterLeave(T){if(c.leaveAbsolute&&(T!=null&&T._transitionInitialStyles)){const{position:r,top:D,left:L,width:B,height:U}=T._transitionInitialStyles;delete T._transitionInitialStyles,T.style.position=r||"",T.style.top=D||"",T.style.left=L||"",T.style.width=B||"",T.style.height=U||""}}};return()=>{const T=c.group?zS:Nl;return Gl(T,{name:c.disabled?"":e,css:!c.disabled,...c.group?void 0:{mode:c.mode},...c.disabled?{}:y},v.default)}}})}function tz(e,t){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"in-out";return Jt()({name:e,props:{mode:{type:String,default:o},disabled:Boolean,group:Boolean},setup(c,d){let{slots:v}=d;const y=c.group?zS:Nl;return()=>Gl(y,{name:c.disabled?"":e,css:!c.disabled,...c.disabled?{}:t},v.default)}})}function nz(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";const o=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1)?"width":"height",c=Ba(`offset-${o}`);return{onBeforeEnter(y){y._parent=y.parentNode,y._initialStyle={transition:y.style.transition,overflow:y.style.overflow,[o]:y.style[o]}},onEnter(y){const T=y._initialStyle;y.style.setProperty("transition","none","important"),y.style.overflow="hidden";const r=`${y[c]}px`;y.style[o]="0",y.offsetHeight,y.style.transition=T.transition,e&&y._parent&&y._parent.classList.add(e),requestAnimationFrame(()=>{y.style[o]=r})},onAfterEnter:v,onEnterCancelled:v,onLeave(y){y._initialStyle={transition:"",overflow:y.style.overflow,[o]:y.style[o]},y.style.overflow="hidden",y.style[o]=`${y[c]}px`,y.offsetHeight,requestAnimationFrame(()=>y.style[o]="0")},onAfterLeave:d,onLeaveCancelled:d};function d(y){e&&y._parent&&y._parent.classList.remove(e),v(y)}function v(y){const T=y._initialStyle[o];y.style.overflow=y._initialStyle.overflow,T!=null&&(y.style[o]=T),delete y._initialStyle}}const cW=At({target:[Object,Array]},"v-dialog-transition"),K0=Jt()({name:"VDialogTransition",props:cW(),setup(e,t){let{slots:o}=t;const c={onBeforeEnter(d){d.style.pointerEvents="none",d.style.visibility="hidden"},async onEnter(d,v){var U;await new Promise($=>requestAnimationFrame($)),await new Promise($=>requestAnimationFrame($)),d.style.visibility="";const{x:y,y:T,sx:r,sy:D,speed:L}=hk(e.target,d),B=ud(d,[{transform:`translate(${y}px, ${T}px) scale(${r}, ${D})`,opacity:0},{}],{duration:225*L,easing:qq});(U=uk(d))==null||U.forEach($=>{ud($,[{opacity:0},{opacity:0,offset:.33},{}],{duration:225*2*L,easing:t_})}),B.finished.then(()=>v())},onAfterEnter(d){d.style.removeProperty("pointer-events")},onBeforeLeave(d){d.style.pointerEvents="none"},async onLeave(d,v){var U;await new Promise($=>requestAnimationFrame($));const{x:y,y:T,sx:r,sy:D,speed:L}=hk(e.target,d);ud(d,[{},{transform:`translate(${y}px, ${T}px) scale(${r}, ${D})`,opacity:0}],{duration:125*L,easing:Wq}).finished.then(()=>v()),(U=uk(d))==null||U.forEach($=>{ud($,[{},{opacity:0,offset:.2},{opacity:0}],{duration:125*2*L,easing:t_})})},onAfterLeave(d){d.style.removeProperty("pointer-events")}};return()=>e.target?Z(Nl,fn({name:"dialog-transition"},c,{css:!1}),o):Z(Nl,{name:"dialog-transition"},o)}});function uk(e){var o;const t=(o=e.querySelector(":scope > .v-card, :scope > .v-sheet, :scope > .v-list"))==null?void 0:o.children;return t&&[...t]}function hk(e,t){const o=TL(e),c=gT(t),[d,v]=getComputedStyle(t).transformOrigin.split(" ").map(ce=>parseFloat(ce)),[y,T]=getComputedStyle(t).getPropertyValue("--v-overlay-anchor-origin").split(" ");let r=o.left+o.width/2;y==="left"||T==="left"?r-=o.width/2:(y==="right"||T==="right")&&(r+=o.width/2);let D=o.top+o.height/2;y==="top"||T==="top"?D-=o.height/2:(y==="bottom"||T==="bottom")&&(D+=o.height/2);const L=o.width/c.width,B=o.height/c.height,U=Math.max(1,L,B),$=L/U||0,W=B/U||0,q=c.width*c.height/(window.innerWidth*window.innerHeight),ne=q>.12?Math.min(1.5,(q-.12)*10+1):1;return{x:r-(d+c.left),y:D-(v+c.top),sx:$,sy:W,speed:ne}}const uW=Ja("fab-transition","center center","out-in"),hW=Ja("dialog-bottom-transition"),dW=Ja("dialog-top-transition"),r_=Ja("fade-transition"),IT=Ja("scale-transition"),fW=Ja("scroll-x-transition"),pW=Ja("scroll-x-reverse-transition"),mW=Ja("scroll-y-transition"),gW=Ja("scroll-y-reverse-transition"),_W=Ja("slide-x-transition"),vW=Ja("slide-x-reverse-transition"),CT=Ja("slide-y-transition"),yW=Ja("slide-y-reverse-transition"),J0=tz("expand-transition",nz()),AT=tz("expand-x-transition",nz("",!0)),bW=At({defaults:Object,disabled:Boolean,reset:[Number,String],root:[Boolean,String],scoped:Boolean},"VDefaultsProvider"),Li=Jt(!1)({name:"VDefaultsProvider",props:bW(),setup(e,t){let{slots:o}=t;const{defaults:c,disabled:d,reset:v,root:y,scoped:T}=Pd(e);return wo(c,{reset:v,root:y,scoped:T,disabled:d}),()=>{var r;return(r=o.default)==null?void 0:r.call(o)}}}),Ko=At({height:[Number,String],maxHeight:[Number,String],maxWidth:[Number,String],minHeight:[Number,String],minWidth:[Number,String],width:[Number,String]},"dimension");function Jo(e){return{dimensionStyles:Se(()=>{const o={},c=Bn(e.height),d=Bn(e.maxHeight),v=Bn(e.maxWidth),y=Bn(e.minHeight),T=Bn(e.minWidth),r=Bn(e.width);return c!=null&&(o.height=c),d!=null&&(o.maxHeight=d),v!=null&&(o.maxWidth=v),y!=null&&(o.minHeight=y),T!=null&&(o.minWidth=T),r!=null&&(o.width=r),o})}}function xW(e){return{aspectStyles:Se(()=>{const t=Number(e.aspectRatio);return t?{paddingBottom:String(1/t*100)+"%"}:void 0})}}const iz=At({aspectRatio:[String,Number],contentClass:null,inline:Boolean,...Nn(),...Ko()},"VResponsive"),Bw=Jt()({name:"VResponsive",props:iz(),setup(e,t){let{slots:o}=t;const{aspectStyles:c}=xW(e),{dimensionStyles:d}=Jo(e);return cn(()=>{var v;return Z("div",{class:["v-responsive",{"v-responsive--inline":e.inline},e.class],style:[d.value,e.style]},[Z("div",{class:"v-responsive__sizer",style:c.value},null),(v=o.additional)==null?void 0:v.call(o),o.default&&Z("div",{class:["v-responsive__content",e.contentClass]},[o.default()])])}),{}}});function PT(e){return pT(()=>{const t=[],o={};if(e.value.background)if(kw(e.value.background)){if(o.backgroundColor=e.value.background,!e.value.text&&Lq(e.value.background)){const c=dl(e.value.background);if(c.a==null||c.a===1){const d=LL(c);o.color=d,o.caretColor=d}}}else t.push(`bg-${e.value.background}`);return e.value.text&&(kw(e.value.text)?(o.color=e.value.text,o.caretColor=e.value.text):t.push(`text-${e.value.text}`)),{colorClasses:t,colorStyles:o}})}function Fs(e,t){const o=Se(()=>({text:xo(e)?e.value:t?e[t]:null})),{colorClasses:c,colorStyles:d}=PT(o);return{textColorClasses:c,textColorStyles:d}}function Nr(e,t){const o=Se(()=>({background:xo(e)?e.value:t?e[t]:null})),{colorClasses:c,colorStyles:d}=PT(o);return{backgroundColorClasses:c,backgroundColorStyles:d}}const co=At({rounded:{type:[Boolean,Number,String],default:void 0},tile:Boolean},"rounded");function So(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Sc();return{roundedClasses:Se(()=>{const c=xo(e)?e.value:e.rounded,d=xo(e)?e.value:e.tile,v=[];if(c===!0||c==="")v.push(`${t}--rounded`);else if(typeof c=="string"||c===0)for(const y of String(c).split(" "))v.push(`rounded-${y}`);else(d||c===!1)&&v.push("rounded-0");return v})}}const Wl=At({transition:{type:[Boolean,String,Object],default:"fade-transition",validator:e=>e!==!0}},"transition"),Xs=(e,t)=>{let{slots:o}=t;const{transition:c,disabled:d,group:v,...y}=e,{component:T=v?zS:Nl,...r}=typeof c=="object"?c:{};return Gl(T,fn(typeof c=="string"?{name:d?"":c}:r,typeof c=="string"?{}:Object.fromEntries(Object.entries({disabled:d,group:v}).filter(D=>{let[L,B]=D;return B!==void 0})),y),o)};function wW(e,t){if(!hT)return;const o=t.modifiers||{},c=t.value,{handler:d,options:v}=typeof c=="object"?c:{handler:c,options:{}},y=new IntersectionObserver(function(){var B;let T=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],r=arguments.length>1?arguments[1]:void 0;const D=(B=e._observe)==null?void 0:B[t.instance.$.uid];if(!D)return;const L=T.some(U=>U.isIntersecting);d&&(!o.quiet||D.init)&&(!o.once||L||D.init)&&d(L,T,r),L&&o.once?rz(e,t):D.init=!0},v);e._observe=Object(e._observe),e._observe[t.instance.$.uid]={init:!1,observer:y},y.observe(e)}function rz(e,t){var c;const o=(c=e._observe)==null?void 0:c[t.instance.$.uid];o&&(o.observer.unobserve(e),delete e._observe[t.instance.$.uid])}const E_={mounted:wW,unmounted:rz},oz=At({absolute:Boolean,alt:String,cover:Boolean,color:String,draggable:{type:[Boolean,String],default:void 0},eager:Boolean,gradient:String,lazySrc:String,options:{type:Object,default:()=>({root:void 0,rootMargin:void 0,threshold:void 0})},sizes:String,src:{type:[String,Object],default:""},crossorigin:String,referrerpolicy:String,srcset:String,position:String,...iz(),...Nn(),...co(),...Wl()},"VImg"),Qc=Jt()({name:"VImg",directives:{intersect:E_},props:oz(),emits:{loadstart:e=>!0,load:e=>!0,error:e=>!0},setup(e,t){let{emit:o,slots:c}=t;const{backgroundColorClasses:d,backgroundColorStyles:v}=Nr(Ht(e,"color")),{roundedClasses:y}=So(e),T=Lo("VImg"),r=kn(""),D=rn(),L=kn(e.eager?"loading":"idle"),B=kn(),U=kn(),$=Se(()=>e.src&&typeof e.src=="object"?{src:e.src.src,srcset:e.srcset||e.src.srcset,lazySrc:e.lazySrc||e.src.lazySrc,aspect:Number(e.aspectRatio||e.src.aspect||0)}:{src:e.src,srcset:e.srcset,lazySrc:e.lazySrc,aspect:Number(e.aspectRatio||0)}),W=Se(()=>$.value.aspect||B.value/U.value||0);On(()=>e.src,()=>{q(L.value!=="idle")}),On(W,(ae,pe)=>{!ae&&pe&&D.value&&be(D.value)}),TS(()=>q());function q(ae){if(!(e.eager&&ae)&&!(hT&&!ae&&!e.eager)){if(L.value="loading",$.value.lazySrc){const pe=new Image;pe.src=$.value.lazySrc,be(pe,null)}$.value.src&&Ki(()=>{var pe;o("loadstart",((pe=D.value)==null?void 0:pe.currentSrc)||$.value.src),setTimeout(()=>{var Le;if(!T.isUnmounted)if((Le=D.value)!=null&&Le.complete){if(D.value.naturalWidth||ce(),L.value==="error")return;W.value||be(D.value,null),L.value==="loading"&&ne()}else W.value||be(D.value),oe()})})}}function ne(){var ae;T.isUnmounted||(oe(),be(D.value),L.value="loaded",o("load",((ae=D.value)==null?void 0:ae.currentSrc)||$.value.src))}function ce(){var ae;T.isUnmounted||(L.value="error",o("error",((ae=D.value)==null?void 0:ae.currentSrc)||$.value.src))}function oe(){const ae=D.value;ae&&(r.value=ae.currentSrc||ae.src)}let fe=-1;Ts(()=>{clearTimeout(fe)});function be(ae){let pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;const Le=()=>{if(clearTimeout(fe),T.isUnmounted)return;const{naturalHeight:tt,naturalWidth:Je}=ae;tt||Je?(B.value=Je,U.value=tt):!ae.complete&&L.value==="loading"&&pe!=null?fe=window.setTimeout(Le,pe):(ae.currentSrc.endsWith(".svg")||ae.currentSrc.startsWith("data:image/svg+xml"))&&(B.value=1,U.value=1)};Le()}const ge=Se(()=>({"v-img__img--cover":e.cover,"v-img__img--contain":!e.cover})),Ee=()=>{var Le;if(!$.value.src||L.value==="idle")return null;const ae=Z("img",{class:["v-img__img",ge.value],style:{objectPosition:e.position},src:$.value.src,srcset:$.value.srcset,alt:e.alt,crossorigin:e.crossorigin,referrerpolicy:e.referrerpolicy,draggable:e.draggable,sizes:e.sizes,ref:D,onLoad:ne,onError:ce},null),pe=(Le=c.sources)==null?void 0:Le.call(c);return Z(Xs,{transition:e.transition,appear:!0},{default:()=>[lr(pe?Z("picture",{class:"v-img__picture"},[pe,ae]):ae,[[Hl,L.value==="loaded"]])]})},de=()=>Z(Xs,{transition:e.transition},{default:()=>[$.value.lazySrc&&L.value!=="loaded"&&Z("img",{class:["v-img__img","v-img__img--preload",ge.value],style:{objectPosition:e.position},src:$.value.lazySrc,alt:e.alt,crossorigin:e.crossorigin,referrerpolicy:e.referrerpolicy,draggable:e.draggable},null)]}),re=()=>c.placeholder?Z(Xs,{transition:e.transition,appear:!0},{default:()=>[(L.value==="loading"||L.value==="error"&&!c.error)&&Z("div",{class:"v-img__placeholder"},[c.placeholder()])]}):null,Y=()=>c.error?Z(Xs,{transition:e.transition,appear:!0},{default:()=>[L.value==="error"&&Z("div",{class:"v-img__error"},[c.error()])]}):null,ie=()=>e.gradient?Z("div",{class:"v-img__gradient",style:{backgroundImage:`linear-gradient(${e.gradient})`}},null):null,te=kn(!1);{const ae=On(W,pe=>{pe&&(requestAnimationFrame(()=>{requestAnimationFrame(()=>{te.value=!0})}),ae())})}return cn(()=>{const ae=Bw.filterProps(e);return lr(Z(Bw,fn({class:["v-img",{"v-img--absolute":e.absolute,"v-img--booting":!te.value},d.value,y.value,e.class],style:[{width:Bn(e.width==="auto"?B.value:e.width)},v.value,e.style]},ae,{aspectRatio:W.value,"aria-label":e.alt,role:e.alt?"img":void 0}),{additional:()=>Z(Gn,null,[Z(Ee,null,null),Z(de,null,null),Z(ie,null,null),Z(re,null,null),Z(Y,null,null)]),default:c.default}),[[Ya("intersect"),{handler:q,options:e.options},null,{once:!0}]])}),{currentSrc:r,image:D,state:L,naturalWidth:B,naturalHeight:U}}}),Na=At({border:[Boolean,Number,String]},"border");function Qa(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Sc();return{borderClasses:Se(()=>{const c=xo(e)?e.value:e.border,d=[];if(c===!0||c==="")d.push(`${t}--border`);else if(typeof c=="string"||c===0)for(const v of String(c).split(" "))d.push(`border-${v}`);return d})}}const ls=At({elevation:{type:[Number,String],validator(e){const t=parseInt(e);return!isNaN(t)&&t>=0&&t<=24}}},"elevation");function Is(e){return{elevationClasses:Se(()=>{const o=xo(e)?e.value:e.elevation,c=[];return o==null||c.push(`elevation-${o}`),c})}}const SW=[null,"prominent","default","comfortable","compact"],sz=At({absolute:Boolean,collapse:Boolean,color:String,density:{type:String,default:"default",validator:e=>SW.includes(e)},extended:Boolean,extensionHeight:{type:[Number,String],default:48},flat:Boolean,floating:Boolean,height:{type:[Number,String],default:64},image:String,title:String,...Na(),...Nn(),...ls(),...co(),...Si({tag:"header"}),...Ji()},"VToolbar"),Fw=Jt()({name:"VToolbar",props:sz(),setup(e,t){var $;let{slots:o}=t;const{backgroundColorClasses:c,backgroundColorStyles:d}=Nr(Ht(e,"color")),{borderClasses:v}=Qa(e),{elevationClasses:y}=Is(e),{roundedClasses:T}=So(e),{themeClasses:r}=xr(e),{rtlClasses:D}=gs(),L=kn(!!(e.extended||($=o.extension)!=null&&$.call(o))),B=Se(()=>parseInt(Number(e.height)+(e.density==="prominent"?Number(e.height):0)-(e.density==="comfortable"?8:0)-(e.density==="compact"?16:0),10)),U=Se(()=>L.value?parseInt(Number(e.extensionHeight)+(e.density==="prominent"?Number(e.extensionHeight):0)-(e.density==="comfortable"?4:0)-(e.density==="compact"?8:0),10):0);return wo({VBtn:{variant:"text"}}),cn(()=>{var ce;const W=!!(e.title||o.title),q=!!(o.image||e.image),ne=(ce=o.extension)==null?void 0:ce.call(o);return L.value=!!(e.extended||ne),Z(e.tag,{class:["v-toolbar",{"v-toolbar--absolute":e.absolute,"v-toolbar--collapse":e.collapse,"v-toolbar--flat":e.flat,"v-toolbar--floating":e.floating,[`v-toolbar--density-${e.density}`]:!0},c.value,v.value,y.value,T.value,r.value,D.value,e.class],style:[d.value,e.style]},{default:()=>[q&&Z("div",{key:"image",class:"v-toolbar__image"},[o.image?Z(Li,{key:"image-defaults",disabled:!e.image,defaults:{VImg:{cover:!0,src:e.image}}},o.image):Z(Qc,{key:"image-img",cover:!0,src:e.image},null)]),Z(Li,{defaults:{VTabs:{height:Bn(B.value)}}},{default:()=>{var oe,fe,be;return[Z("div",{class:"v-toolbar__content",style:{height:Bn(B.value)}},[o.prepend&&Z("div",{class:"v-toolbar__prepend"},[(oe=o.prepend)==null?void 0:oe.call(o)]),W&&Z(ET,{key:"title",text:e.title},{text:o.title}),(fe=o.default)==null?void 0:fe.call(o),o.append&&Z("div",{class:"v-toolbar__append"},[(be=o.append)==null?void 0:be.call(o)])])]}}),Z(Li,{defaults:{VTabs:{height:Bn(U.value)}}},{default:()=>[Z(J0,null,{default:()=>[L.value&&Z("div",{class:"v-toolbar__extension",style:{height:Bn(U.value)}},[ne])]})]})]})}),{contentHeight:B,extensionHeight:U}}}),TW=At({scrollTarget:{type:String},scrollThreshold:{type:[String,Number],default:300}},"scroll");function EW(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{canScroll:o}=t;let c=0,d=0;const v=rn(null),y=kn(0),T=kn(0),r=kn(0),D=kn(!1),L=kn(!1),B=Se(()=>Number(e.scrollThreshold)),U=Se(()=>Go((B.value-y.value)/B.value||0)),$=()=>{const W=v.value;if(!W||o&&!o.value)return;c=y.value,y.value="window"in W?W.pageYOffset:W.scrollTop;const q=W instanceof Window?document.documentElement.scrollHeight:W.scrollHeight;if(d!==q){d=q;return}L.value=y.value<c,r.value=Math.abs(y.value-B.value)};return On(L,()=>{T.value=T.value||y.value}),On(D,()=>{T.value=0}),ms(()=>{On(()=>e.scrollTarget,W=>{var ne;const q=W?document.querySelector(W):window;q&&q!==v.value&&((ne=v.value)==null||ne.removeEventListener("scroll",$),v.value=q,v.value.addEventListener("scroll",$,{passive:!0}))},{immediate:!0})}),Ts(()=>{var W;(W=v.value)==null||W.removeEventListener("scroll",$)}),o&&On(o,$,{immediate:!0}),{scrollThreshold:B,currentScroll:y,currentThreshold:r,isScrollActive:D,scrollRatio:U,isScrollingUp:L,savedScroll:T}}function Ld(){const e=kn(!1);return ms(()=>{window.requestAnimationFrame(()=>{e.value=!0})}),{ssrBootStyles:Se(()=>e.value?void 0:{transition:"none !important"}),isBooted:zp(e)}}const IW=At({scrollBehavior:String,modelValue:{type:Boolean,default:!0},location:{type:String,default:"top",validator:e=>["top","bottom"].includes(e)},...sz(),...Dd(),...TW(),height:{type:[Number,String],default:64}},"VAppBar"),CW=Jt()({name:"VAppBar",props:IW(),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:o}=t;const c=rn(),d=ei(e,"modelValue"),v=Se(()=>{var be;const fe=new Set(((be=e.scrollBehavior)==null?void 0:be.split(" "))??[]);return{hide:fe.has("hide"),fullyHide:fe.has("fully-hide"),inverted:fe.has("inverted"),collapse:fe.has("collapse"),elevate:fe.has("elevate"),fadeImage:fe.has("fade-image")}}),y=Se(()=>{const fe=v.value;return fe.hide||fe.fullyHide||fe.inverted||fe.collapse||fe.elevate||fe.fadeImage||!d.value}),{currentScroll:T,scrollThreshold:r,isScrollingUp:D,scrollRatio:L}=EW(e,{canScroll:y}),B=Se(()=>v.value.hide||v.value.fullyHide),U=Se(()=>e.collapse||v.value.collapse&&(v.value.inverted?L.value>0:L.value===0)),$=Se(()=>e.flat||v.value.fullyHide&&!d.value||v.value.elevate&&(v.value.inverted?T.value>0:T.value===0)),W=Se(()=>v.value.fadeImage?v.value.inverted?1-L.value:L.value:void 0),q=Se(()=>{var ge,Ee;const fe=Number(((ge=c.value)==null?void 0:ge.contentHeight)??e.height),be=Number(((Ee=c.value)==null?void 0:Ee.extensionHeight)??0);return B.value?T.value<r.value||v.value.fullyHide?fe+be:fe:fe+be});za(Se(()=>!!e.scrollBehavior),()=>{Oo(()=>{B.value?v.value.inverted?d.value=T.value>r.value:d.value=D.value||T.value<r.value:d.value=!0})});const{ssrBootStyles:ne}=Ld(),{layoutItemStyles:ce,layoutIsReady:oe}=Od({id:e.name,order:Se(()=>parseInt(e.order,10)),position:Ht(e,"location"),layoutSize:q,elementSize:kn(void 0),active:d,absolute:Ht(e,"absolute")});return cn(()=>{const fe=Fw.filterProps(e);return Z(Fw,fn({ref:c,class:["v-app-bar",{"v-app-bar--bottom":e.location==="bottom"},e.class],style:[{...ce.value,"--v-toolbar-image-opacity":W.value,height:void 0,...ne.value},e.style]},fe,{collapse:U.value,flat:$.value}),o)}),oe}}),AW=[null,"default","comfortable","compact"],_s=At({density:{type:String,default:"default",validator:e=>AW.includes(e)}},"density");function Js(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Sc();return{densityClasses:Se(()=>`${t}--density-${e.density}`)}}const PW=["elevated","flat","tonal","outlined","text","plain"];function mh(e,t){return Z(Gn,null,[e&&Z("span",{key:"overlay",class:`${t}__overlay`},null),Z("span",{key:"underlay",class:`${t}__underlay`},null)])}const vl=At({color:String,variant:{type:String,default:"elevated",validator:e=>PW.includes(e)}},"variant");function zd(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Sc();const o=Se(()=>{const{variant:v}=Zo(e);return`${t}--variant-${v}`}),{colorClasses:c,colorStyles:d}=PT(Se(()=>{const{variant:v,color:y}=Zo(e);return{[["elevated","flat"].includes(v)?"background":"text"]:y}}));return{colorClasses:c,colorStyles:d,variantClasses:o}}const az=At({baseColor:String,divided:Boolean,...Na(),...Nn(),..._s(),...ls(),...co(),...Si(),...Ji(),...vl()},"VBtnGroup"),Vw=Jt()({name:"VBtnGroup",props:az(),setup(e,t){let{slots:o}=t;const{themeClasses:c}=xr(e),{densityClasses:d}=Js(e),{borderClasses:v}=Qa(e),{elevationClasses:y}=Is(e),{roundedClasses:T}=So(e);wo({VBtn:{height:"auto",baseColor:Ht(e,"baseColor"),color:Ht(e,"color"),density:Ht(e,"density"),flat:!0,variant:Ht(e,"variant")}}),cn(()=>Z(e.tag,{class:["v-btn-group",{"v-btn-group--divided":e.divided},c.value,v.value,d.value,y.value,T.value,e.class],style:e.style},o))}}),Bd=At({modelValue:{type:null,default:void 0},multiple:Boolean,mandatory:[Boolean,String],max:Number,selectedClass:String,disabled:Boolean},"group"),Fd=At({value:null,disabled:Boolean,selectedClass:String},"group-item");function Vd(e,t){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const c=Lo("useGroupItem");if(!c)throw new Error("[Vuetify] useGroupItem composable must be used inside a component setup function");const d=Es();Vr(Symbol.for(`${t.description}:id`),d);const v=Mi(t,null);if(!v){if(!o)return v;throw new Error(`[Vuetify] Could not find useGroup injection with symbol ${t.description}`)}const y=Ht(e,"value"),T=Se(()=>!!(v.disabled.value||e.disabled));v.register({id:d,value:y,disabled:T},c),Ts(()=>{v.unregister(d)});const r=Se(()=>v.isSelected(d)),D=Se(()=>v.items.value[0].id===d),L=Se(()=>v.items.value[v.items.value.length-1].id===d),B=Se(()=>r.value&&[v.selectedClass.value,e.selectedClass]);return On(r,U=>{c.emit("group:selected",{value:U})},{flush:"sync"}),{id:d,isSelected:r,isFirst:D,isLast:L,toggle:()=>v.select(d,!r.value),select:U=>v.select(d,U),selectedClass:B,value:y,disabled:T,group:v}}function gh(e,t){let o=!1;const c=Ls([]),d=ei(e,"modelValue",[],U=>U==null?[]:lz(c,go(U)),U=>{const $=kW(c,U);return e.multiple?$:$[0]}),v=Lo("useGroup");function y(U,$){const W=U,q=Symbol.for(`${t.description}:id`),ce=cp(q,v==null?void 0:v.vnode).indexOf($);Zo(W.value)==null&&(W.value=ce,W.useIndexAsValue=!0),ce>-1?c.splice(ce,0,W):c.push(W)}function T(U){if(o)return;r();const $=c.findIndex(W=>W.id===U);c.splice($,1)}function r(){const U=c.find($=>!$.disabled);U&&e.mandatory==="force"&&!d.value.length&&(d.value=[U.id])}ms(()=>{r()}),Ts(()=>{o=!0}),ES(()=>{for(let U=0;U<c.length;U++)c[U].useIndexAsValue&&(c[U].value=U)});function D(U,$){const W=c.find(q=>q.id===U);if(!($&&(W!=null&&W.disabled)))if(e.multiple){const q=d.value.slice(),ne=q.findIndex(oe=>oe===U),ce=~ne;if($=$??!ce,ce&&e.mandatory&&q.length<=1||!ce&&e.max!=null&&q.length+1>e.max)return;ne<0&&$?q.push(U):ne>=0&&!$&&q.splice(ne,1),d.value=q}else{const q=d.value.includes(U);if(e.mandatory&&q)return;d.value=$??!q?[U]:[]}}function L(U){if(e.multiple,d.value.length){const $=d.value[0],W=c.findIndex(ce=>ce.id===$);let q=(W+U)%c.length,ne=c[q];for(;ne.disabled&&q!==W;)q=(q+U)%c.length,ne=c[q];if(ne.disabled)return;d.value=[c[q].id]}else{const $=c.find(W=>!W.disabled);$&&(d.value=[$.id])}}const B={register:y,unregister:T,selected:d,select:D,disabled:Ht(e,"disabled"),prev:()=>L(c.length-1),next:()=>L(1),isSelected:U=>d.value.includes(U),selectedClass:Se(()=>e.selectedClass),items:Se(()=>c),getItemIndex:U=>MW(c,U)};return Vr(t,B),B}function MW(e,t){const o=lz(e,[t]);return o.length?e.findIndex(c=>c.id===o[0]):-1}function lz(e,t){const o=[];return t.forEach(c=>{const d=e.find(y=>wc(c,y.value)),v=e[c];(d==null?void 0:d.value)!=null?o.push(d.id):v!=null&&o.push(v.id)}),o}function kW(e,t){const o=[];return t.forEach(c=>{const d=e.findIndex(v=>v.id===c);if(~d){const v=e[d];o.push(v.value!=null?v.value:d)}}),o}const MT=Symbol.for("vuetify:v-btn-toggle"),RW=At({...az(),...Bd()},"VBtnToggle"),DW=Jt()({name:"VBtnToggle",props:RW(),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:o}=t;const{isSelected:c,next:d,prev:v,select:y,selected:T}=gh(e,MT);return cn(()=>{const r=Vw.filterProps(e);return Z(Vw,fn({class:["v-btn-toggle",e.class]},r,{style:e.style}),{default:()=>{var D;return[(D=o.default)==null?void 0:D.call(o,{isSelected:c,next:d,prev:v,select:y,selected:T})]}})}),{next:d,prev:v,select:y}}}),OW=["x-small","small","default","large","x-large"],Ec=At({size:{type:[String,Number],default:"default"}},"size");function Up(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Sc();return pT(()=>{let o,c;return m0(OW,e.size)?o=`${t}--size-${e.size}`:e.size&&(c={width:Bn(e.size),height:Bn(e.size)}),{sizeClasses:o,sizeStyles:c}})}const LW=At({color:String,disabled:Boolean,start:Boolean,end:Boolean,icon:mi,...Nn(),...Ec(),...Si({tag:"i"}),...Ji()},"VIcon"),br=Jt()({name:"VIcon",props:LW(),setup(e,t){let{attrs:o,slots:c}=t;const d=rn(),{themeClasses:v}=xr(e),{iconData:y}=tW(Se(()=>d.value||e.icon)),{sizeClasses:T}=Up(e),{textColorClasses:r,textColorStyles:D}=Fs(Ht(e,"color"));return cn(()=>{var U,$;const L=(U=c.default)==null?void 0:U.call(c);L&&(d.value=($=yL(L).filter(W=>W.type===m_&&W.children&&typeof W.children=="string")[0])==null?void 0:$.children);const B=!!(o.onClick||o.onClickOnce);return Z(y.value.component,{tag:e.tag,icon:y.value.icon,class:["v-icon","notranslate",v.value,T.value,r.value,{"v-icon--clickable":B,"v-icon--disabled":e.disabled,"v-icon--start":e.start,"v-icon--end":e.end},e.class],style:[T.value?void 0:{fontSize:Bn(e.size),height:Bn(e.size),width:Bn(e.size)},D.value,e.style],role:B?"button":void 0,"aria-hidden":!B,tabindex:B?e.disabled?-1:0:void 0},{default:()=>[L]})}),{}}});function Q0(e,t){const o=rn(),c=kn(!1);if(hT){const d=new IntersectionObserver(v=>{e==null||e(v,d),c.value=!!v.find(y=>y.isIntersecting)},t);Ts(()=>{d.disconnect()}),On(o,(v,y)=>{y&&(d.unobserve(y),c.value=!1),v&&d.observe(v)},{flush:"post"})}return{intersectionRef:o,isIntersecting:c}}const zW=At({bgColor:String,color:String,indeterminate:[Boolean,String],modelValue:{type:[Number,String],default:0},rotate:{type:[Number,String],default:0},width:{type:[Number,String],default:4},...Nn(),...Ec(),...Si({tag:"div"}),...Ji()},"VProgressCircular"),Op=Jt()({name:"VProgressCircular",props:zW(),setup(e,t){let{slots:o}=t;const c=20,d=2*Math.PI*c,v=rn(),{themeClasses:y}=xr(e),{sizeClasses:T,sizeStyles:r}=Up(e),{textColorClasses:D,textColorStyles:L}=Fs(Ht(e,"color")),{textColorClasses:B,textColorStyles:U}=Fs(Ht(e,"bgColor")),{intersectionRef:$,isIntersecting:W}=Q0(),{resizeRef:q,contentRect:ne}=$l(),ce=Se(()=>Math.max(0,Math.min(100,parseFloat(e.modelValue)))),oe=Se(()=>Number(e.width)),fe=Se(()=>r.value?Number(e.size):ne.value?ne.value.width:Math.max(oe.value,32)),be=Se(()=>c/(1-oe.value/fe.value)*2),ge=Se(()=>oe.value/fe.value*be.value),Ee=Se(()=>Bn((100-ce.value)/100*d));return Oo(()=>{$.value=v.value,q.value=v.value}),cn(()=>Z(e.tag,{ref:v,class:["v-progress-circular",{"v-progress-circular--indeterminate":!!e.indeterminate,"v-progress-circular--visible":W.value,"v-progress-circular--disable-shrink":e.indeterminate==="disable-shrink"},y.value,T.value,D.value,e.class],style:[r.value,L.value,e.style],role:"progressbar","aria-valuemin":"0","aria-valuemax":"100","aria-valuenow":e.indeterminate?void 0:ce.value},{default:()=>[Z("svg",{style:{transform:`rotate(calc(-90deg + ${Number(e.rotate)}deg))`},xmlns:"http://www.w3.org/2000/svg",viewBox:`0 0 ${be.value} ${be.value}`},[Z("circle",{class:["v-progress-circular__underlay",B.value],style:U.value,fill:"transparent",cx:"50%",cy:"50%",r:c,"stroke-width":ge.value,"stroke-dasharray":d,"stroke-dashoffset":0},null),Z("circle",{class:"v-progress-circular__overlay",fill:"transparent",cx:"50%",cy:"50%",r:c,"stroke-width":ge.value,"stroke-dasharray":d,"stroke-dashoffset":Ee.value},null)]),o.default&&Z("div",{class:"v-progress-circular__content"},[o.default({value:ce.value})])]})),{}}}),dk={center:"center",top:"bottom",bottom:"top",left:"right",right:"left"},iu=At({location:String},"location");function Nd(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,o=arguments.length>2?arguments[2]:void 0;const{isRtl:c}=gs();return{locationStyles:Se(()=>{if(!e.location)return{};const{side:v,align:y}=Pw(e.location.split(" ").length>1?e.location:`${e.location} center`,c.value);function T(D){return o?o(D):0}const r={};return v!=="center"&&(t?r[dk[v]]=`calc(100% - ${T(v)}px)`:r[v]=0),y!=="center"?t?r[dk[y]]=`calc(100% - ${T(y)}px)`:r[y]=0:(v==="center"?r.top=r.left="50%":r[{top:"left",bottom:"left",left:"top",right:"top"}[v]]="50%",r.transform={top:"translateX(-50%)",bottom:"translateX(-50%)",left:"translateY(-50%)",right:"translateY(-50%)",center:"translate(-50%, -50%)"}[v]),r})}}const BW=At({absolute:Boolean,active:{type:Boolean,default:!0},bgColor:String,bgOpacity:[Number,String],bufferValue:{type:[Number,String],default:0},bufferColor:String,bufferOpacity:[Number,String],clickable:Boolean,color:String,height:{type:[Number,String],default:4},indeterminate:Boolean,max:{type:[Number,String],default:100},modelValue:{type:[Number,String],default:0},opacity:[Number,String],reverse:Boolean,stream:Boolean,striped:Boolean,roundedBar:Boolean,...Nn(),...iu({location:"top"}),...co(),...Si(),...Ji()},"VProgressLinear"),eb=Jt()({name:"VProgressLinear",props:BW(),emits:{"update:modelValue":e=>!0},setup(e,t){var te;let{slots:o}=t;const c=ei(e,"modelValue"),{isRtl:d,rtlClasses:v}=gs(),{themeClasses:y}=xr(e),{locationStyles:T}=Nd(e),{textColorClasses:r,textColorStyles:D}=Fs(e,"color"),{backgroundColorClasses:L,backgroundColorStyles:B}=Nr(Se(()=>e.bgColor||e.color)),{backgroundColorClasses:U,backgroundColorStyles:$}=Nr(Se(()=>e.bufferColor||e.bgColor||e.color)),{backgroundColorClasses:W,backgroundColorStyles:q}=Nr(e,"color"),{roundedClasses:ne}=So(e),{intersectionRef:ce,isIntersecting:oe}=Q0(),fe=Se(()=>parseFloat(e.max)),be=Se(()=>parseFloat(e.height)),ge=Se(()=>Go(parseFloat(e.bufferValue)/fe.value*100,0,100)),Ee=Se(()=>Go(parseFloat(c.value)/fe.value*100,0,100)),de=Se(()=>d.value!==e.reverse),re=Se(()=>e.indeterminate?"fade-transition":"slide-x-transition"),Y=Ar&&((te=window.matchMedia)==null?void 0:te.call(window,"(forced-colors: active)").matches);function ie(ae){if(!ce.value)return;const{left:pe,right:Le,width:tt}=ce.value.getBoundingClientRect(),Je=de.value?tt-ae.clientX+(Le-tt):ae.clientX-pe;c.value=Math.round(Je/tt*fe.value)}return cn(()=>Z(e.tag,{ref:ce,class:["v-progress-linear",{"v-progress-linear--absolute":e.absolute,"v-progress-linear--active":e.active&&oe.value,"v-progress-linear--reverse":de.value,"v-progress-linear--rounded":e.rounded,"v-progress-linear--rounded-bar":e.roundedBar,"v-progress-linear--striped":e.striped},ne.value,y.value,v.value,e.class],style:[{bottom:e.location==="bottom"?0:void 0,top:e.location==="top"?0:void 0,height:e.active?Bn(be.value):0,"--v-progress-linear-height":Bn(be.value),...e.absolute?T.value:{}},e.style],role:"progressbar","aria-hidden":e.active?"false":"true","aria-valuemin":"0","aria-valuemax":e.max,"aria-valuenow":e.indeterminate?void 0:Ee.value,onClick:e.clickable&&ie},{default:()=>[e.stream&&Z("div",{key:"stream",class:["v-progress-linear__stream",r.value],style:{...D.value,[de.value?"left":"right"]:Bn(-be.value),borderTop:`${Bn(be.value/2)} dotted`,opacity:parseFloat(e.bufferOpacity),top:`calc(50% - ${Bn(be.value/4)})`,width:Bn(100-ge.value,"%"),"--v-progress-linear-stream-to":Bn(be.value*(de.value?1:-1))}},null),Z("div",{class:["v-progress-linear__background",Y?void 0:L.value],style:[B.value,{opacity:parseFloat(e.bgOpacity),width:e.stream?0:void 0}]},null),Z("div",{class:["v-progress-linear__buffer",Y?void 0:U.value],style:[$.value,{opacity:parseFloat(e.bufferOpacity),width:Bn(ge.value,"%")}]},null),Z(Nl,{name:re.value},{default:()=>[e.indeterminate?Z("div",{class:"v-progress-linear__indeterminate"},[["long","short"].map(ae=>Z("div",{key:ae,class:["v-progress-linear__indeterminate",ae,Y?void 0:W.value],style:q.value},null))]):Z("div",{class:["v-progress-linear__determinate",Y?void 0:W.value],style:[q.value,{width:Bn(Ee.value,"%")}]},null)]}),o.default&&Z("div",{class:"v-progress-linear__content"},[o.default({value:Ee.value,buffer:ge.value})])]})),{}}}),tb=At({loading:[Boolean,String]},"loader");function I_(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Sc();return{loaderClasses:Se(()=>({[`${t}--loading`]:e.loading}))}}function C_(e,t){var c;let{slots:o}=t;return Z("div",{class:`${e.name}__loader`},[((c=o.default)==null?void 0:c.call(o,{color:e.color,isActive:e.active}))||Z(eb,{absolute:e.absolute,active:e.active,color:e.color,height:"2",indeterminate:!0},null)])}const FW=["static","relative","fixed","absolute","sticky"],jp=At({position:{type:String,validator:e=>FW.includes(e)}},"position");function $p(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Sc();return{positionClasses:Se(()=>e.position?`${t}--${e.position}`:void 0)}}function VW(){const e=Lo("useRoute");return Se(()=>{var t;return(t=e==null?void 0:e.proxy)==null?void 0:t.$route})}function cz(){var e,t;return(t=(e=Lo("useRouter"))==null?void 0:e.proxy)==null?void 0:t.$router}function A_(e,t){var D,L;const o=r5("RouterLink"),c=Se(()=>!!(e.href||e.to)),d=Se(()=>(c==null?void 0:c.value)||LM(t,"click")||LM(e,"click"));if(typeof o=="string"||!("useLink"in o))return{isLink:c,isClickable:d,href:Ht(e,"href")};const v=Se(()=>({...e,to:Ht(()=>e.to||"")})),y=o.useLink(v.value),T=Se(()=>e.to?y:void 0),r=VW();return{isLink:c,isClickable:d,route:(D=T.value)==null?void 0:D.route,navigate:(L=T.value)==null?void 0:L.navigate,isActive:Se(()=>{var B,U,$;return T.value?e.exact?r.value?(($=T.value.isExactActive)==null?void 0:$.value)&&wc(T.value.route.value.query,r.value.query):((U=T.value.isExactActive)==null?void 0:U.value)??!1:((B=T.value.isActive)==null?void 0:B.value)??!1:!1}),href:Se(()=>{var B;return e.to?(B=T.value)==null?void 0:B.route.value.href:e.href})}}const P_=At({href:String,replace:Boolean,to:[String,Object],exact:Boolean},"router");let j1=!1;function NW(e,t){let o=!1,c,d;Ar&&(Ki(()=>{window.addEventListener("popstate",v),c=e==null?void 0:e.beforeEach((y,T,r)=>{j1?o?t(r):r():setTimeout(()=>o?t(r):r()),j1=!0}),d=e==null?void 0:e.afterEach(()=>{j1=!1})}),Ys(()=>{window.removeEventListener("popstate",v),c==null||c(),d==null||d()}));function v(y){var T;(T=y.state)!=null&&T.replaced||(o=!0,setTimeout(()=>o=!1))}}function UW(e,t){On(()=>{var o;return(o=e.isActive)==null?void 0:o.value},o=>{e.isLink.value&&o&&t&&Ki(()=>{t(!0)})},{immediate:!0})}const Nw=Symbol("rippleStop"),jW=80;function fk(e,t){e.style.transform=t,e.style.webkitTransform=t}function Uw(e){return e.constructor.name==="TouchEvent"}function uz(e){return e.constructor.name==="KeyboardEvent"}const $W=function(e,t){var B;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},c=0,d=0;if(!uz(e)){const U=t.getBoundingClientRect(),$=Uw(e)?e.touches[e.touches.length-1]:e;c=$.clientX-U.left,d=$.clientY-U.top}let v=0,y=.3;(B=t._ripple)!=null&&B.circle?(y=.15,v=t.clientWidth/2,v=o.center?v:v+Math.sqrt((c-v)**2+(d-v)**2)/4):v=Math.sqrt(t.clientWidth**2+t.clientHeight**2)/2;const T=`${(t.clientWidth-v*2)/2}px`,r=`${(t.clientHeight-v*2)/2}px`,D=o.center?T:`${c-v}px`,L=o.center?r:`${d-v}px`;return{radius:v,scale:y,x:D,y:L,centerX:T,centerY:r}},x0={show(e,t){var $;let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!(($=t==null?void 0:t._ripple)!=null&&$.enabled))return;const c=document.createElement("span"),d=document.createElement("span");c.appendChild(d),c.className="v-ripple__container",o.class&&(c.className+=` ${o.class}`);const{radius:v,scale:y,x:T,y:r,centerX:D,centerY:L}=$W(e,t,o),B=`${v*2}px`;d.className="v-ripple__animation",d.style.width=B,d.style.height=B,t.appendChild(c);const U=window.getComputedStyle(t);U&&U.position==="static"&&(t.style.position="relative",t.dataset.previousPosition="static"),d.classList.add("v-ripple__animation--enter"),d.classList.add("v-ripple__animation--visible"),fk(d,`translate(${T}, ${r}) scale3d(${y},${y},${y})`),d.dataset.activated=String(performance.now()),setTimeout(()=>{d.classList.remove("v-ripple__animation--enter"),d.classList.add("v-ripple__animation--in"),fk(d,`translate(${D}, ${L}) scale3d(1,1,1)`)},0)},hide(e){var v;if(!((v=e==null?void 0:e._ripple)!=null&&v.enabled))return;const t=e.getElementsByClassName("v-ripple__animation");if(t.length===0)return;const o=t[t.length-1];if(o.dataset.isHiding)return;o.dataset.isHiding="true";const c=performance.now()-Number(o.dataset.activated),d=Math.max(250-c,0);setTimeout(()=>{o.classList.remove("v-ripple__animation--in"),o.classList.add("v-ripple__animation--out"),setTimeout(()=>{var T;e.getElementsByClassName("v-ripple__animation").length===1&&e.dataset.previousPosition&&(e.style.position=e.dataset.previousPosition,delete e.dataset.previousPosition),((T=o.parentNode)==null?void 0:T.parentNode)===e&&e.removeChild(o.parentNode)},300)},d)}};function hz(e){return typeof e>"u"||!!e}function o_(e){const t={},o=e.currentTarget;if(!(!(o!=null&&o._ripple)||o._ripple.touched||e[Nw])){if(e[Nw]=!0,Uw(e))o._ripple.touched=!0,o._ripple.isTouch=!0;else if(o._ripple.isTouch)return;if(t.center=o._ripple.centered||uz(e),o._ripple.class&&(t.class=o._ripple.class),Uw(e)){if(o._ripple.showTimerCommit)return;o._ripple.showTimerCommit=()=>{x0.show(e,o,t)},o._ripple.showTimer=window.setTimeout(()=>{var c;(c=o==null?void 0:o._ripple)!=null&&c.showTimerCommit&&(o._ripple.showTimerCommit(),o._ripple.showTimerCommit=null)},jW)}else x0.show(e,o,t)}}function pk(e){e[Nw]=!0}function Xa(e){const t=e.currentTarget;if(t!=null&&t._ripple){if(window.clearTimeout(t._ripple.showTimer),e.type==="touchend"&&t._ripple.showTimerCommit){t._ripple.showTimerCommit(),t._ripple.showTimerCommit=null,t._ripple.showTimer=window.setTimeout(()=>{Xa(e)});return}window.setTimeout(()=>{t._ripple&&(t._ripple.touched=!1)}),x0.hide(t)}}function dz(e){const t=e.currentTarget;t!=null&&t._ripple&&(t._ripple.showTimerCommit&&(t._ripple.showTimerCommit=null),window.clearTimeout(t._ripple.showTimer))}let s_=!1;function fz(e){!s_&&(e.keyCode===MM.enter||e.keyCode===MM.space)&&(s_=!0,o_(e))}function pz(e){s_=!1,Xa(e)}function mz(e){s_&&(s_=!1,Xa(e))}function gz(e,t,o){const{value:c,modifiers:d}=t,v=hz(c);if(v||x0.hide(e),e._ripple=e._ripple??{},e._ripple.enabled=v,e._ripple.centered=d.center,e._ripple.circle=d.circle,Qg(c)&&c.class&&(e._ripple.class=c.class),v&&!o){if(d.stop){e.addEventListener("touchstart",pk,{passive:!0}),e.addEventListener("mousedown",pk);return}e.addEventListener("touchstart",o_,{passive:!0}),e.addEventListener("touchend",Xa,{passive:!0}),e.addEventListener("touchmove",dz,{passive:!0}),e.addEventListener("touchcancel",Xa),e.addEventListener("mousedown",o_),e.addEventListener("mouseup",Xa),e.addEventListener("mouseleave",Xa),e.addEventListener("keydown",fz),e.addEventListener("keyup",pz),e.addEventListener("blur",mz),e.addEventListener("dragstart",Xa,{passive:!0})}else!v&&o&&_z(e)}function _z(e){e.removeEventListener("mousedown",o_),e.removeEventListener("touchstart",o_),e.removeEventListener("touchend",Xa),e.removeEventListener("touchmove",dz),e.removeEventListener("touchcancel",Xa),e.removeEventListener("mouseup",Xa),e.removeEventListener("mouseleave",Xa),e.removeEventListener("keydown",fz),e.removeEventListener("keyup",pz),e.removeEventListener("dragstart",Xa),e.removeEventListener("blur",mz)}function GW(e,t){gz(e,t,!1)}function HW(e){delete e._ripple,_z(e)}function qW(e,t){if(t.value===t.oldValue)return;const o=hz(t.oldValue);gz(e,t,o)}const ru={mounted:GW,unmounted:HW,updated:qW},nb=At({active:{type:Boolean,default:void 0},activeColor:String,baseColor:String,symbol:{type:null,default:MT},flat:Boolean,icon:[Boolean,String,Function,Object],prependIcon:mi,appendIcon:mi,block:Boolean,readonly:Boolean,slim:Boolean,stacked:Boolean,ripple:{type:[Boolean,Object],default:!0},text:String,...Na(),...Nn(),..._s(),...Ko(),...ls(),...Fd(),...tb(),...iu(),...jp(),...co(),...P_(),...Ec(),...Si({tag:"button"}),...Ji(),...vl({variant:"elevated"})},"VBtn"),yr=Jt()({name:"VBtn",props:nb(),emits:{"group:selected":e=>!0},setup(e,t){let{attrs:o,slots:c}=t;const{themeClasses:d}=xr(e),{borderClasses:v}=Qa(e),{densityClasses:y}=Js(e),{dimensionStyles:T}=Jo(e),{elevationClasses:r}=Is(e),{loaderClasses:D}=I_(e),{locationStyles:L}=Nd(e),{positionClasses:B}=$p(e),{roundedClasses:U}=So(e),{sizeClasses:$,sizeStyles:W}=Up(e),q=Vd(e,e.symbol,!1),ne=A_(e,o),ce=Se(()=>{var te;return e.active!==void 0?e.active:ne.isLink.value?(te=ne.isActive)==null?void 0:te.value:q==null?void 0:q.isSelected.value}),oe=Se(()=>ce.value?e.activeColor??e.color:e.color),fe=Se(()=>{var ae,pe;return{color:(q==null?void 0:q.isSelected.value)&&(!ne.isLink.value||((ae=ne.isActive)==null?void 0:ae.value))||!q||((pe=ne.isActive)==null?void 0:pe.value)?oe.value??e.baseColor:e.baseColor,variant:e.variant}}),{colorClasses:be,colorStyles:ge,variantClasses:Ee}=zd(fe),de=Se(()=>(q==null?void 0:q.disabled.value)||e.disabled),re=Se(()=>e.variant==="elevated"&&!(e.disabled||e.flat||e.border)),Y=Se(()=>{if(!(e.value===void 0||typeof e.value=="symbol"))return Object(e.value)===e.value?JSON.stringify(e.value,null,0):e.value});function ie(te){var ae;de.value||ne.isLink.value&&(te.metaKey||te.ctrlKey||te.shiftKey||te.button!==0||o.target==="_blank")||((ae=ne.navigate)==null||ae.call(ne,te),q==null||q.toggle())}return UW(ne,q==null?void 0:q.select),cn(()=>{const te=ne.isLink.value?"a":e.tag,ae=!!(e.prependIcon||c.prepend),pe=!!(e.appendIcon||c.append),Le=!!(e.icon&&e.icon!==!0);return lr(Z(te,{type:te==="a"?void 0:"button",class:["v-btn",q==null?void 0:q.selectedClass.value,{"v-btn--active":ce.value,"v-btn--block":e.block,"v-btn--disabled":de.value,"v-btn--elevated":re.value,"v-btn--flat":e.flat,"v-btn--icon":!!e.icon,"v-btn--loading":e.loading,"v-btn--readonly":e.readonly,"v-btn--slim":e.slim,"v-btn--stacked":e.stacked},d.value,v.value,be.value,y.value,r.value,D.value,B.value,U.value,$.value,Ee.value,e.class],style:[ge.value,T.value,L.value,W.value,e.style],"aria-busy":e.loading?!0:void 0,disabled:de.value||void 0,href:ne.href.value,tabindex:e.loading||e.readonly?-1:void 0,onClick:ie,value:Y.value},{default:()=>{var tt;return[mh(!0,"v-btn"),!e.icon&&ae&&Z("span",{key:"prepend",class:"v-btn__prepend"},[c.prepend?Z(Li,{key:"prepend-defaults",disabled:!e.prependIcon,defaults:{VIcon:{icon:e.prependIcon}}},c.prepend):Z(br,{key:"prepend-icon",icon:e.prependIcon},null)]),Z("span",{class:"v-btn__content","data-no-activator":""},[!c.default&&Le?Z(br,{key:"content-icon",icon:e.icon},null):Z(Li,{key:"content-defaults",disabled:!Le,defaults:{VIcon:{icon:e.icon}}},{default:()=>{var Je;return[((Je=c.default)==null?void 0:Je.call(c))??e.text]}})]),!e.icon&&pe&&Z("span",{key:"append",class:"v-btn__append"},[c.append?Z(Li,{key:"append-defaults",disabled:!e.appendIcon,defaults:{VIcon:{icon:e.appendIcon}}},c.append):Z(br,{key:"append-icon",icon:e.appendIcon},null)]),!!e.loading&&Z("span",{key:"loader",class:"v-btn__loader"},[((tt=c.loader)==null?void 0:tt.call(c))??Z(Op,{color:typeof e.loading=="boolean"?void 0:e.loading,indeterminate:!0,width:"2"},null)])]}}),[[ru,!de.value&&!!e.ripple,"",{center:!!e.icon}]])}),{group:q}}}),WW=At({...nb({icon:"$menu",variant:"text"})},"VAppBarNavIcon"),ZW=Jt()({name:"VAppBarNavIcon",props:WW(),setup(e,t){let{slots:o}=t;return cn(()=>Z(yr,fn(e,{class:["v-app-bar-nav-icon"]}),o)),{}}}),XW=Jt()({name:"VAppBarTitle",props:ez(),setup(e,t){let{slots:o}=t;return cn(()=>Z(ET,fn(e,{class:"v-app-bar-title"}),o)),{}}}),vz=Tc("v-alert-title"),YW=["success","info","warning","error"],KW=At({border:{type:[Boolean,String],validator:e=>typeof e=="boolean"||["top","end","bottom","start"].includes(e)},borderColor:String,closable:Boolean,closeIcon:{type:mi,default:"$close"},closeLabel:{type:String,default:"$vuetify.close"},icon:{type:[Boolean,String,Function,Object],default:null},modelValue:{type:Boolean,default:!0},prominent:Boolean,title:String,text:String,type:{type:String,validator:e=>YW.includes(e)},...Nn(),..._s(),...Ko(),...ls(),...iu(),...jp(),...co(),...Si(),...Ji(),...vl({variant:"flat"})},"VAlert"),JW=Jt()({name:"VAlert",props:KW(),emits:{"click:close":e=>!0,"update:modelValue":e=>!0},setup(e,t){let{emit:o,slots:c}=t;const d=ei(e,"modelValue"),v=Se(()=>{if(e.icon!==!1)return e.type?e.icon??`$${e.type}`:e.icon}),y=Se(()=>({color:e.color??e.type,variant:e.variant})),{themeClasses:T}=xr(e),{colorClasses:r,colorStyles:D,variantClasses:L}=zd(y),{densityClasses:B}=Js(e),{dimensionStyles:U}=Jo(e),{elevationClasses:$}=Is(e),{locationStyles:W}=Nd(e),{positionClasses:q}=$p(e),{roundedClasses:ne}=So(e),{textColorClasses:ce,textColorStyles:oe}=Fs(Ht(e,"borderColor")),{t:fe}=zo(),be=Se(()=>({"aria-label":fe(e.closeLabel),onClick(ge){d.value=!1,o("click:close",ge)}}));return()=>{const ge=!!(c.prepend||v.value),Ee=!!(c.title||e.title),de=!!(c.close||e.closable);return d.value&&Z(e.tag,{class:["v-alert",e.border&&{"v-alert--border":!!e.border,[`v-alert--border-${e.border===!0?"start":e.border}`]:!0},{"v-alert--prominent":e.prominent},T.value,r.value,B.value,$.value,q.value,ne.value,L.value,e.class],style:[D.value,U.value,W.value,e.style],role:"alert"},{default:()=>{var re,Y;return[mh(!1,"v-alert"),e.border&&Z("div",{key:"border",class:["v-alert__border",ce.value],style:oe.value},null),ge&&Z("div",{key:"prepend",class:"v-alert__prepend"},[c.prepend?Z(Li,{key:"prepend-defaults",disabled:!v.value,defaults:{VIcon:{density:e.density,icon:v.value,size:e.prominent?44:28}}},c.prepend):Z(br,{key:"prepend-icon",density:e.density,icon:v.value,size:e.prominent?44:28},null)]),Z("div",{class:"v-alert__content"},[Ee&&Z(vz,{key:"title"},{default:()=>{var ie;return[((ie=c.title)==null?void 0:ie.call(c))??e.title]}}),((re=c.text)==null?void 0:re.call(c))??e.text,(Y=c.default)==null?void 0:Y.call(c)]),c.append&&Z("div",{key:"append",class:"v-alert__append"},[c.append()]),de&&Z("div",{key:"close",class:"v-alert__close"},[c.close?Z(Li,{key:"close-defaults",defaults:{VBtn:{icon:e.closeIcon,size:"x-small",variant:"text"}}},{default:()=>{var ie;return[(ie=c.close)==null?void 0:ie.call(c,{props:be.value})]}}):Z(yr,fn({key:"close-btn",icon:e.closeIcon,size:"x-small",variant:"text"},be.value),null)])]}})}}}),QW=At({start:Boolean,end:Boolean,icon:mi,image:String,text:String,...Na(),...Nn(),..._s(),...co(),...Ec(),...Si(),...Ji(),...vl({variant:"flat"})},"VAvatar"),ml=Jt()({name:"VAvatar",props:QW(),setup(e,t){let{slots:o}=t;const{themeClasses:c}=xr(e),{borderClasses:d}=Qa(e),{colorClasses:v,colorStyles:y,variantClasses:T}=zd(e),{densityClasses:r}=Js(e),{roundedClasses:D}=So(e),{sizeClasses:L,sizeStyles:B}=Up(e);return cn(()=>Z(e.tag,{class:["v-avatar",{"v-avatar--start":e.start,"v-avatar--end":e.end},c.value,d.value,v.value,r.value,D.value,L.value,T.value,e.class],style:[y.value,B.value,e.style]},{default:()=>[o.default?Z(Li,{key:"content-defaults",defaults:{VImg:{cover:!0,image:e.image},VIcon:{icon:e.icon}}},{default:()=>[o.default()]}):e.image?Z(Qc,{key:"image",src:e.image,alt:"",cover:!0},null):e.icon?Z(br,{key:"icon",icon:e.icon},null):e.text,mh(!1,"v-avatar")]})),{}}}),eZ=At({text:String,onClick:Ss(),...Nn(),...Ji()},"VLabel"),Gp=Jt()({name:"VLabel",props:eZ(),setup(e,t){let{slots:o}=t;return cn(()=>{var c;return Z("label",{class:["v-label",{"v-label--clickable":!!e.onClick},e.class],style:e.style,onClick:e.onClick},[e.text,(c=o.default)==null?void 0:c.call(o)])}),{}}}),yz=Symbol.for("vuetify:selection-control-group"),kT=At({color:String,disabled:{type:Boolean,default:null},defaultsTarget:String,error:Boolean,id:String,inline:Boolean,falseIcon:mi,trueIcon:mi,ripple:{type:[Boolean,Object],default:!0},multiple:{type:Boolean,default:null},name:String,readonly:{type:Boolean,default:null},modelValue:null,type:String,valueComparator:{type:Function,default:wc},...Nn(),..._s(),...Ji()},"SelectionControlGroup"),tZ=At({...kT({defaultsTarget:"VSelectionControl"})},"VSelectionControlGroup"),bz=Jt()({name:"VSelectionControlGroup",props:tZ(),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:o}=t;const c=ei(e,"modelValue"),d=Es(),v=Se(()=>e.id||`v-selection-control-group-${d}`),y=Se(()=>e.name||v.value),T=new Set;return Vr(yz,{modelValue:c,forceUpdate:()=>{T.forEach(r=>r())},onForceUpdate:r=>{T.add(r),Ys(()=>{T.delete(r)})}}),wo({[e.defaultsTarget]:{color:Ht(e,"color"),disabled:Ht(e,"disabled"),density:Ht(e,"density"),error:Ht(e,"error"),inline:Ht(e,"inline"),modelValue:c,multiple:Se(()=>!!e.multiple||e.multiple==null&&Array.isArray(c.value)),name:y,falseIcon:Ht(e,"falseIcon"),trueIcon:Ht(e,"trueIcon"),readonly:Ht(e,"readonly"),ripple:Ht(e,"ripple"),type:Ht(e,"type"),valueComparator:Ht(e,"valueComparator")}}),cn(()=>{var r;return Z("div",{class:["v-selection-control-group",{"v-selection-control-group--inline":e.inline},e.class],style:e.style,role:e.type==="radio"?"radiogroup":void 0},[(r=o.default)==null?void 0:r.call(o)])}),{}}}),ib=At({label:String,baseColor:String,trueValue:null,falseValue:null,value:null,...Nn(),...kT()},"VSelectionControl");function nZ(e){const t=Mi(yz,void 0),{densityClasses:o}=Js(e),c=ei(e,"modelValue"),d=Se(()=>e.trueValue!==void 0?e.trueValue:e.value!==void 0?e.value:!0),v=Se(()=>e.falseValue!==void 0?e.falseValue:!1),y=Se(()=>!!e.multiple||e.multiple==null&&Array.isArray(c.value)),T=Se({get(){const $=t?t.modelValue.value:c.value;return y.value?go($).some(W=>e.valueComparator(W,d.value)):e.valueComparator($,d.value)},set($){if(e.readonly)return;const W=$?d.value:v.value;let q=W;y.value&&(q=$?[...go(c.value),W]:go(c.value).filter(ne=>!e.valueComparator(ne,d.value))),t?t.modelValue.value=q:c.value=q}}),{textColorClasses:r,textColorStyles:D}=Fs(Se(()=>{if(!(e.error||e.disabled))return T.value?e.color:e.baseColor})),{backgroundColorClasses:L,backgroundColorStyles:B}=Nr(Se(()=>T.value&&!e.error&&!e.disabled?e.color:e.baseColor)),U=Se(()=>T.value?e.trueIcon:e.falseIcon);return{group:t,densityClasses:o,trueValue:d,falseValue:v,model:T,textColorClasses:r,textColorStyles:D,backgroundColorClasses:L,backgroundColorStyles:B,icon:U}}const lh=Jt()({name:"VSelectionControl",directives:{Ripple:ru},inheritAttrs:!1,props:ib(),emits:{"update:modelValue":e=>!0},setup(e,t){let{attrs:o,slots:c}=t;const{group:d,densityClasses:v,icon:y,model:T,textColorClasses:r,textColorStyles:D,backgroundColorClasses:L,backgroundColorStyles:B,trueValue:U}=nZ(e),$=Es(),W=kn(!1),q=kn(!1),ne=rn(),ce=Se(()=>e.id||`input-${$}`),oe=Se(()=>!e.disabled&&!e.readonly);d==null||d.onForceUpdate(()=>{ne.value&&(ne.value.checked=T.value)});function fe(de){oe.value&&(W.value=!0,kp(de.target,":focus-visible")!==!1&&(q.value=!0))}function be(){W.value=!1,q.value=!1}function ge(de){de.stopPropagation()}function Ee(de){if(!oe.value){ne.value&&(ne.value.checked=T.value);return}e.readonly&&d&&Ki(()=>d.forceUpdate()),T.value=de.target.checked}return cn(()=>{var te,ae;const de=c.label?c.label({label:e.label,props:{for:ce.value}}):e.label,[re,Y]=ph(o),ie=Z("input",fn({ref:ne,checked:T.value,disabled:!!e.disabled,id:ce.value,onBlur:be,onFocus:fe,onInput:Ee,"aria-disabled":!!e.disabled,"aria-label":e.label,type:e.type,value:U.value,name:e.name,"aria-checked":e.type==="checkbox"?T.value:void 0},Y),null);return Z("div",fn({class:["v-selection-control",{"v-selection-control--dirty":T.value,"v-selection-control--disabled":e.disabled,"v-selection-control--error":e.error,"v-selection-control--focused":W.value,"v-selection-control--focus-visible":q.value,"v-selection-control--inline":e.inline},v.value,e.class]},re,{style:e.style}),[Z("div",{class:["v-selection-control__wrapper",r.value],style:D.value},[(te=c.default)==null?void 0:te.call(c,{backgroundColorClasses:L,backgroundColorStyles:B}),lr(Z("div",{class:["v-selection-control__input"]},[((ae=c.input)==null?void 0:ae.call(c,{model:T,textColorClasses:r,textColorStyles:D,backgroundColorClasses:L,backgroundColorStyles:B,inputNode:ie,icon:y.value,props:{onFocus:fe,onBlur:be,id:ce.value}}))??Z(Gn,null,[y.value&&Z(br,{key:"icon",icon:y.value},null),ie])]),[[Ya("ripple"),e.ripple&&[!e.disabled&&!e.readonly,null,["center","circle"]]]])]),de&&Z(Gp,{for:ce.value,onClick:ge},{default:()=>[de]})])}),{isFocused:W,input:ne}}}),xz=At({indeterminate:Boolean,indeterminateIcon:{type:mi,default:"$checkboxIndeterminate"},...ib({falseIcon:"$checkboxOff",trueIcon:"$checkboxOn"})},"VCheckboxBtn"),eu=Jt()({name:"VCheckboxBtn",props:xz(),emits:{"update:modelValue":e=>!0,"update:indeterminate":e=>!0},setup(e,t){let{slots:o}=t;const c=ei(e,"indeterminate"),d=ei(e,"modelValue");function v(r){c.value&&(c.value=!1)}const y=Se(()=>c.value?e.indeterminateIcon:e.falseIcon),T=Se(()=>c.value?e.indeterminateIcon:e.trueIcon);return cn(()=>{const r=Yo(lh.filterProps(e),["modelValue"]);return Z(lh,fn(r,{modelValue:d.value,"onUpdate:modelValue":[D=>d.value=D,v],class:["v-checkbox-btn",e.class],style:e.style,type:"checkbox",falseIcon:y.value,trueIcon:T.value,"aria-checked":c.value?"mixed":void 0}),o)}),{}}});function wz(e){const{t}=zo();function o(c){let{name:d}=c;const v={prepend:"prependAction",prependInner:"prependAction",append:"appendAction",appendInner:"appendAction",clear:"clear"}[d],y=e[`onClick:${d}`],T=y&&v?t(`$vuetify.input.${v}`,e.label??""):void 0;return Z(br,{icon:e[`${d}Icon`],"aria-label":T,onClick:y},null)}return{InputIcon:o}}const iZ=At({active:Boolean,color:String,messages:{type:[Array,String],default:()=>[]},...Nn(),...Wl({transition:{component:CT,leaveAbsolute:!0,group:!0}})},"VMessages"),Sz=Jt()({name:"VMessages",props:iZ(),setup(e,t){let{slots:o}=t;const c=Se(()=>go(e.messages)),{textColorClasses:d,textColorStyles:v}=Fs(Se(()=>e.color));return cn(()=>Z(Xs,{transition:e.transition,tag:"div",class:["v-messages",d.value,e.class],style:[v.value,e.style],role:"alert","aria-live":"polite"},{default:()=>[e.active&&c.value.map((y,T)=>Z("div",{class:"v-messages__message",key:`${T}-${c.value}`},[o.message?o.message({message:y}):y]))]})),{}}}),M_=At({focused:Boolean,"onUpdate:focused":Ss()},"focus");function ou(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Sc();const o=ei(e,"focused"),c=Se(()=>({[`${t}--focused`]:o.value}));function d(){o.value=!0}function v(){o.value=!1}return{focusClasses:c,isFocused:o,focus:d,blur:v}}const Tz=Symbol.for("vuetify:form"),rZ=At({disabled:Boolean,fastFail:Boolean,readonly:Boolean,modelValue:{type:Boolean,default:null},validateOn:{type:String,default:"input"}},"form");function oZ(e){const t=ei(e,"modelValue"),o=Se(()=>e.disabled),c=Se(()=>e.readonly),d=kn(!1),v=rn([]),y=rn([]);async function T(){const L=[];let B=!0;y.value=[],d.value=!0;for(const U of v.value){const $=await U.validate();if($.length>0&&(B=!1,L.push({id:U.id,errorMessages:$})),!B&&e.fastFail)break}return y.value=L,d.value=!1,{valid:B,errors:y.value}}function r(){v.value.forEach(L=>L.reset())}function D(){v.value.forEach(L=>L.resetValidation())}return On(v,()=>{let L=0,B=0;const U=[];for(const $ of v.value)$.isValid===!1?(B++,U.push({id:$.id,errorMessages:$.errorMessages})):$.isValid===!0&&L++;y.value=U,t.value=B>0?!1:L===v.value.length?!0:null},{deep:!0,flush:"post"}),Vr(Tz,{register:L=>{let{id:B,vm:U,validate:$,reset:W,resetValidation:q}=L;v.value.some(ne=>ne.id===B),v.value.push({id:B,validate:$,reset:W,resetValidation:q,vm:oR(U),isValid:null,errorMessages:[]})},unregister:L=>{v.value=v.value.filter(B=>B.id!==L)},update:(L,B,U)=>{const $=v.value.find(W=>W.id===L);$&&($.isValid=B,$.errorMessages=U)},isDisabled:o,isReadonly:c,isValidating:d,isValid:t,items:v,validateOn:Ht(e,"validateOn")}),{errors:y,isDisabled:o,isReadonly:c,isValidating:d,isValid:t,items:v,validate:T,reset:r,resetValidation:D}}function rb(){return Mi(Tz,null)}const Ez=At({disabled:{type:Boolean,default:null},error:Boolean,errorMessages:{type:[Array,String],default:()=>[]},maxErrors:{type:[Number,String],default:1},name:String,label:String,readonly:{type:Boolean,default:null},rules:{type:Array,default:()=>[]},modelValue:null,validateOn:String,validationValue:null,...M_()},"validation");function Iz(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Sc(),o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Es();const c=ei(e,"modelValue"),d=Se(()=>e.validationValue===void 0?c.value:e.validationValue),v=rb(),y=rn([]),T=kn(!0),r=Se(()=>!!(go(c.value===""?null:c.value).length||go(d.value===""?null:d.value).length)),D=Se(()=>!!(e.disabled??(v==null?void 0:v.isDisabled.value))),L=Se(()=>!!(e.readonly??(v==null?void 0:v.isReadonly.value))),B=Se(()=>{var ge;return(ge=e.errorMessages)!=null&&ge.length?go(e.errorMessages).concat(y.value).slice(0,Math.max(0,+e.maxErrors)):y.value}),U=Se(()=>{let ge=(e.validateOn??(v==null?void 0:v.validateOn.value))||"input";ge==="lazy"&&(ge="input lazy"),ge==="eager"&&(ge="input eager");const Ee=new Set((ge==null?void 0:ge.split(" "))??[]);return{input:Ee.has("input"),blur:Ee.has("blur")||Ee.has("input")||Ee.has("invalid-input"),invalidInput:Ee.has("invalid-input"),lazy:Ee.has("lazy"),eager:Ee.has("eager")}}),$=Se(()=>{var ge;return e.error||(ge=e.errorMessages)!=null&&ge.length?!1:e.rules.length?T.value?y.value.length||U.value.lazy?null:!0:!y.value.length:!0}),W=kn(!1),q=Se(()=>({[`${t}--error`]:$.value===!1,[`${t}--dirty`]:r.value,[`${t}--disabled`]:D.value,[`${t}--readonly`]:L.value})),ne=Lo("validation"),ce=Se(()=>e.name??Zo(o));TS(()=>{v==null||v.register({id:ce.value,vm:ne,validate:be,reset:oe,resetValidation:fe})}),Ts(()=>{v==null||v.unregister(ce.value)}),ms(async()=>{U.value.lazy||await be(!U.value.eager),v==null||v.update(ce.value,$.value,B.value)}),za(()=>U.value.input||U.value.invalidInput&&$.value===!1,()=>{On(d,()=>{if(d.value!=null)be();else if(e.focused){const ge=On(()=>e.focused,Ee=>{Ee||be(),ge()})}})}),za(()=>U.value.blur,()=>{On(()=>e.focused,ge=>{ge||be()})}),On([$,B],()=>{v==null||v.update(ce.value,$.value,B.value)});async function oe(){c.value=null,await Ki(),await fe()}async function fe(){T.value=!0,U.value.lazy?y.value=[]:await be(!U.value.eager)}async function be(){let ge=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;const Ee=[];W.value=!0;for(const de of e.rules){if(Ee.length>=+(e.maxErrors??1))break;const Y=await(typeof de=="function"?de:()=>de)(d.value);if(Y!==!0){if(Y!==!1&&typeof Y!="string"){console.warn(`${Y} is not a valid value. Rule functions must return boolean true or a string.`);continue}Ee.push(Y||"")}}return y.value=Ee,W.value=!1,T.value=ge,y.value}return{errorMessages:B,isDirty:r,isDisabled:D,isReadonly:L,isPristine:T,isValid:$,isValidating:W,reset:oe,resetValidation:fe,validate:be,validationClasses:q}}const su=At({id:String,appendIcon:mi,centerAffix:{type:Boolean,default:!0},prependIcon:mi,hideDetails:[Boolean,String],hideSpinButtons:Boolean,hint:String,persistentHint:Boolean,messages:{type:[Array,String],default:()=>[]},direction:{type:String,default:"horizontal",validator:e=>["horizontal","vertical"].includes(e)},"onClick:prepend":Ss(),"onClick:append":Ss(),...Nn(),..._s(),...G0(Ko(),["maxWidth","minWidth","width"]),...Ji(),...Ez()},"VInput"),Vs=Jt()({name:"VInput",props:{...su()},emits:{"update:modelValue":e=>!0},setup(e,t){let{attrs:o,slots:c,emit:d}=t;const{densityClasses:v}=Js(e),{dimensionStyles:y}=Jo(e),{themeClasses:T}=xr(e),{rtlClasses:r}=gs(),{InputIcon:D}=wz(e),L=Es(),B=Se(()=>e.id||`input-${L}`),U=Se(()=>`${B.value}-messages`),{errorMessages:$,isDirty:W,isDisabled:q,isReadonly:ne,isPristine:ce,isValid:oe,isValidating:fe,reset:be,resetValidation:ge,validate:Ee,validationClasses:de}=Iz(e,"v-input",B),re=Se(()=>({id:B,messagesId:U,isDirty:W,isDisabled:q,isReadonly:ne,isPristine:ce,isValid:oe,isValidating:fe,reset:be,resetValidation:ge,validate:Ee})),Y=Se(()=>{var ie;return(ie=e.errorMessages)!=null&&ie.length||!ce.value&&$.value.length?$.value:e.hint&&(e.persistentHint||e.focused)?e.hint:e.messages});return cn(()=>{var Le,tt,Je,Mt;const ie=!!(c.prepend||e.prependIcon),te=!!(c.append||e.appendIcon),ae=Y.value.length>0,pe=!e.hideDetails||e.hideDetails==="auto"&&(ae||!!c.details);return Z("div",{class:["v-input",`v-input--${e.direction}`,{"v-input--center-affix":e.centerAffix,"v-input--hide-spin-buttons":e.hideSpinButtons},v.value,T.value,r.value,de.value,e.class],style:[y.value,e.style]},[ie&&Z("div",{key:"prepend",class:"v-input__prepend"},[(Le=c.prepend)==null?void 0:Le.call(c,re.value),e.prependIcon&&Z(D,{key:"prepend-icon",name:"prepend"},null)]),c.default&&Z("div",{class:"v-input__control"},[(tt=c.default)==null?void 0:tt.call(c,re.value)]),te&&Z("div",{key:"append",class:"v-input__append"},[e.appendIcon&&Z(D,{key:"append-icon",name:"append"},null),(Je=c.append)==null?void 0:Je.call(c,re.value)]),pe&&Z("div",{class:"v-input__details"},[Z(Sz,{id:U.value,active:ae,messages:Y.value},{message:c.message}),(Mt=c.details)==null?void 0:Mt.call(c,re.value)])])}),{reset:be,resetValidation:ge,validate:Ee,isValid:oe,errorMessages:$}}}),sZ=At({...su(),...Yo(xz(),["inline"])},"VCheckbox"),aZ=Jt()({name:"VCheckbox",inheritAttrs:!1,props:sZ(),emits:{"update:modelValue":e=>!0,"update:focused":e=>!0},setup(e,t){let{attrs:o,slots:c}=t;const d=ei(e,"modelValue"),{isFocused:v,focus:y,blur:T}=ou(e),r=Es(),D=Se(()=>e.id||`checkbox-${r}`);return cn(()=>{const[L,B]=ph(o),U=Vs.filterProps(e),$=eu.filterProps(e);return Z(Vs,fn({class:["v-checkbox",e.class]},L,U,{modelValue:d.value,"onUpdate:modelValue":W=>d.value=W,id:D.value,focused:v.value,style:e.style}),{...c,default:W=>{let{id:q,messagesId:ne,isDisabled:ce,isReadonly:oe,isValid:fe}=W;return Z(eu,fn($,{id:q.value,"aria-describedby":ne.value,disabled:ce.value,readonly:oe.value},B,{error:fe.value===!1,modelValue:d.value,"onUpdate:modelValue":be=>d.value=be,onFocus:y,onBlur:T}),c)}})}),{}}});function lZ(e){let{selectedElement:t,containerElement:o,isRtl:c,isHorizontal:d}=e;const v=a_(d,o),y=Cz(d,c,o),T=a_(d,t),r=Az(d,t),D=T*.4;return y>r?r-D:y+v<r+T?r-v+T+D:y}function cZ(e){let{selectedElement:t,containerElement:o,isHorizontal:c}=e;const d=a_(c,o),v=Az(c,t),y=a_(c,t);return v-d/2+y/2}function mk(e,t){const o=e?"scrollWidth":"scrollHeight";return(t==null?void 0:t[o])||0}function uZ(e,t){const o=e?"clientWidth":"clientHeight";return(t==null?void 0:t[o])||0}function Cz(e,t,o){if(!o)return 0;const{scrollLeft:c,offsetWidth:d,scrollWidth:v}=o;return e?t?v-d+c:c:o.scrollTop}function a_(e,t){const o=e?"offsetWidth":"offsetHeight";return(t==null?void 0:t[o])||0}function Az(e,t){const o=e?"offsetLeft":"offsetTop";return(t==null?void 0:t[o])||0}const Pz=Symbol.for("vuetify:v-slide-group"),RT=At({centerActive:Boolean,direction:{type:String,default:"horizontal"},symbol:{type:null,default:Pz},nextIcon:{type:mi,default:"$next"},prevIcon:{type:mi,default:"$prev"},showArrows:{type:[Boolean,String],validator:e=>typeof e=="boolean"||["always","desktop","mobile"].includes(e)},...Nn(),...Rd({mobile:null}),...Si(),...Bd({selectedClass:"v-slide-group-item--active"})},"VSlideGroup"),l_=Jt()({name:"VSlideGroup",props:RT(),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:o}=t;const{isRtl:c}=gs(),{displayClasses:d,mobile:v}=_l(e),y=gh(e,e.symbol),T=kn(!1),r=kn(0),D=kn(0),L=kn(0),B=Se(()=>e.direction==="horizontal"),{resizeRef:U,contentRect:$}=$l(),{resizeRef:W,contentRect:q}=$l(),ne=Z7(),ce=Se(()=>({container:U.el,duration:200,easing:"easeOutQuart"})),oe=Se(()=>y.selected.value.length?y.items.value.findIndex(rt=>rt.id===y.selected.value[0]):-1),fe=Se(()=>y.selected.value.length?y.items.value.findIndex(rt=>rt.id===y.selected.value[y.selected.value.length-1]):-1);if(Ar){let rt=-1;On(()=>[y.selected.value,$.value,q.value,B.value],()=>{cancelAnimationFrame(rt),rt=requestAnimationFrame(()=>{if($.value&&q.value){const mt=B.value?"width":"height";D.value=$.value[mt],L.value=q.value[mt],T.value=D.value+1<L.value}if(oe.value>=0&&W.el){const mt=W.el.children[fe.value];ge(mt,e.centerActive)}})})}const be=kn(!1);function ge(rt,mt){let Ft=0;mt?Ft=cZ({containerElement:U.el,isHorizontal:B.value,selectedElement:rt}):Ft=lZ({containerElement:U.el,isHorizontal:B.value,isRtl:c.value,selectedElement:rt}),Ee(Ft)}function Ee(rt){if(!Ar||!U.el)return;const mt=a_(B.value,U.el),Ft=Cz(B.value,c.value,U.el);if(!(mk(B.value,U.el)<=mt||Math.abs(rt-Ft)<16)){if(B.value&&c.value&&U.el){const{scrollWidth:Bt,offsetWidth:ht}=U.el;rt=Bt-ht-rt}B.value?ne.horizontal(rt,ce.value):ne(rt,ce.value)}}function de(rt){const{scrollTop:mt,scrollLeft:Ft}=rt.target;r.value=B.value?Ft:mt}function re(rt){if(be.value=!0,!(!T.value||!W.el)){for(const mt of rt.composedPath())for(const Ft of W.el.children)if(Ft===mt){ge(Ft);return}}}function Y(rt){be.value=!1}let ie=!1;function te(rt){var mt;!ie&&!be.value&&!(rt.relatedTarget&&((mt=W.el)!=null&&mt.contains(rt.relatedTarget)))&&Le(),ie=!1}function ae(){ie=!0}function pe(rt){if(!W.el)return;function mt(Ft){rt.preventDefault(),Le(Ft)}B.value?rt.key==="ArrowRight"?mt(c.value?"prev":"next"):rt.key==="ArrowLeft"&&mt(c.value?"next":"prev"):rt.key==="ArrowDown"?mt("next"):rt.key==="ArrowUp"&&mt("prev"),rt.key==="Home"?mt("first"):rt.key==="End"&&mt("last")}function Le(rt){var Ft,bn;if(!W.el)return;let mt;if(!rt)mt=e_(W.el)[0];else if(rt==="next"){if(mt=(Ft=W.el.querySelector(":focus"))==null?void 0:Ft.nextElementSibling,!mt)return Le("first")}else if(rt==="prev"){if(mt=(bn=W.el.querySelector(":focus"))==null?void 0:bn.previousElementSibling,!mt)return Le("last")}else rt==="first"?mt=W.el.firstElementChild:rt==="last"&&(mt=W.el.lastElementChild);mt&&mt.focus({preventScroll:!0})}function tt(rt){const mt=B.value&&c.value?-1:1,Ft=(rt==="prev"?-mt:mt)*D.value;let bn=r.value+Ft;if(B.value&&c.value&&U.el){const{scrollWidth:Bt,offsetWidth:ht}=U.el;bn+=Bt-ht}Ee(bn)}const Je=Se(()=>({next:y.next,prev:y.prev,select:y.select,isSelected:y.isSelected})),Mt=Se(()=>{switch(e.showArrows){case"always":return!0;case"desktop":return!v.value;case!0:return T.value||Math.abs(r.value)>0;case"mobile":return v.value||T.value||Math.abs(r.value)>0;default:return!v.value&&(T.value||Math.abs(r.value)>0)}}),Lt=Se(()=>Math.abs(r.value)>1),yt=Se(()=>{if(!U.value)return!1;const rt=mk(B.value,U.el),mt=uZ(B.value,U.el);return rt-mt-Math.abs(r.value)>1});return cn(()=>Z(e.tag,{class:["v-slide-group",{"v-slide-group--vertical":!B.value,"v-slide-group--has-affixes":Mt.value,"v-slide-group--is-overflowing":T.value},d.value,e.class],style:e.style,tabindex:be.value||y.selected.value.length?-1:0,onFocus:te},{default:()=>{var rt,mt,Ft;return[Mt.value&&Z("div",{key:"prev",class:["v-slide-group__prev",{"v-slide-group__prev--disabled":!Lt.value}],onMousedown:ae,onClick:()=>Lt.value&&tt("prev")},[((rt=o.prev)==null?void 0:rt.call(o,Je.value))??Z(r_,null,{default:()=>[Z(br,{icon:c.value?e.nextIcon:e.prevIcon},null)]})]),Z("div",{key:"container",ref:U,class:"v-slide-group__container",onScroll:de},[Z("div",{ref:W,class:"v-slide-group__content",onFocusin:re,onFocusout:Y,onKeydown:pe},[(mt=o.default)==null?void 0:mt.call(o,Je.value)])]),Mt.value&&Z("div",{key:"next",class:["v-slide-group__next",{"v-slide-group__next--disabled":!yt.value}],onMousedown:ae,onClick:()=>yt.value&&tt("next")},[((Ft=o.next)==null?void 0:Ft.call(o,Je.value))??Z(r_,null,{default:()=>[Z(br,{icon:c.value?e.prevIcon:e.nextIcon},null)]})])]}})),{selected:y.selected,scrollTo:tt,scrollOffset:r,focus:Le,hasPrev:Lt,hasNext:yt}}}),Mz=Symbol.for("vuetify:v-chip-group"),hZ=At({column:Boolean,filter:Boolean,valueComparator:{type:Function,default:wc},...RT(),...Nn(),...Bd({selectedClass:"v-chip--selected"}),...Si(),...Ji(),...vl({variant:"tonal"})},"VChipGroup"),dZ=Jt()({name:"VChipGroup",props:hZ(),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:o}=t;const{themeClasses:c}=xr(e),{isSelected:d,select:v,next:y,prev:T,selected:r}=gh(e,Mz);return wo({VChip:{color:Ht(e,"color"),disabled:Ht(e,"disabled"),filter:Ht(e,"filter"),variant:Ht(e,"variant")}}),cn(()=>{const D=l_.filterProps(e);return Z(l_,fn(D,{class:["v-chip-group",{"v-chip-group--column":e.column},c.value,e.class],style:e.style}),{default:()=>{var L;return[(L=o.default)==null?void 0:L.call(o,{isSelected:d,select:v,next:y,prev:T,selected:r.value})]}})}),{}}}),fZ=At({activeClass:String,appendAvatar:String,appendIcon:mi,closable:Boolean,closeIcon:{type:mi,default:"$delete"},closeLabel:{type:String,default:"$vuetify.close"},draggable:Boolean,filter:Boolean,filterIcon:{type:String,default:"$complete"},label:Boolean,link:{type:Boolean,default:void 0},pill:Boolean,prependAvatar:String,prependIcon:mi,ripple:{type:[Boolean,Object],default:!0},text:String,modelValue:{type:Boolean,default:!0},onClick:Ss(),onClickOnce:Ss(),...Na(),...Nn(),..._s(),...ls(),...Fd(),...co(),...P_(),...Ec(),...Si({tag:"span"}),...Ji(),...vl({variant:"tonal"})},"VChip"),Hp=Jt()({name:"VChip",directives:{Ripple:ru},props:fZ(),emits:{"click:close":e=>!0,"update:modelValue":e=>!0,"group:selected":e=>!0,click:e=>!0},setup(e,t){let{attrs:o,emit:c,slots:d}=t;const{t:v}=zo(),{borderClasses:y}=Qa(e),{colorClasses:T,colorStyles:r,variantClasses:D}=zd(e),{densityClasses:L}=Js(e),{elevationClasses:B}=Is(e),{roundedClasses:U}=So(e),{sizeClasses:$}=Up(e),{themeClasses:W}=xr(e),q=ei(e,"modelValue"),ne=Vd(e,Mz,!1),ce=A_(e,o),oe=Se(()=>e.link!==!1&&ce.isLink.value),fe=Se(()=>!e.disabled&&e.link!==!1&&(!!ne||e.link||ce.isClickable.value)),be=Se(()=>({"aria-label":v(e.closeLabel),onClick(de){de.preventDefault(),de.stopPropagation(),q.value=!1,c("click:close",de)}}));function ge(de){var re;c("click",de),fe.value&&((re=ce.navigate)==null||re.call(ce,de),ne==null||ne.toggle())}function Ee(de){(de.key==="Enter"||de.key===" ")&&(de.preventDefault(),ge(de))}return()=>{const de=ce.isLink.value?"a":e.tag,re=!!(e.appendIcon||e.appendAvatar),Y=!!(re||d.append),ie=!!(d.close||e.closable),te=!!(d.filter||e.filter)&&ne,ae=!!(e.prependIcon||e.prependAvatar),pe=!!(ae||d.prepend),Le=!ne||ne.isSelected.value;return q.value&&lr(Z(de,{class:["v-chip",{"v-chip--disabled":e.disabled,"v-chip--label":e.label,"v-chip--link":fe.value,"v-chip--filter":te,"v-chip--pill":e.pill},W.value,y.value,Le?T.value:void 0,L.value,B.value,U.value,$.value,D.value,ne==null?void 0:ne.selectedClass.value,e.class],style:[Le?r.value:void 0,e.style],disabled:e.disabled||void 0,draggable:e.draggable,href:ce.href.value,tabindex:fe.value?0:void 0,onClick:ge,onKeydown:fe.value&&!oe.value&&Ee},{default:()=>{var tt;return[mh(fe.value,"v-chip"),te&&Z(AT,{key:"filter"},{default:()=>[lr(Z("div",{class:"v-chip__filter"},[d.filter?Z(Li,{key:"filter-defaults",disabled:!e.filterIcon,defaults:{VIcon:{icon:e.filterIcon}}},d.filter):Z(br,{key:"filter-icon",icon:e.filterIcon},null)]),[[Hl,ne.isSelected.value]])]}),pe&&Z("div",{key:"prepend",class:"v-chip__prepend"},[d.prepend?Z(Li,{key:"prepend-defaults",disabled:!ae,defaults:{VAvatar:{image:e.prependAvatar,start:!0},VIcon:{icon:e.prependIcon,start:!0}}},d.prepend):Z(Gn,null,[e.prependIcon&&Z(br,{key:"prepend-icon",icon:e.prependIcon,start:!0},null),e.prependAvatar&&Z(ml,{key:"prepend-avatar",image:e.prependAvatar,start:!0},null)])]),Z("div",{class:"v-chip__content","data-no-activator":""},[((tt=d.default)==null?void 0:tt.call(d,{isSelected:ne==null?void 0:ne.isSelected.value,selectedClass:ne==null?void 0:ne.selectedClass.value,select:ne==null?void 0:ne.select,toggle:ne==null?void 0:ne.toggle,value:ne==null?void 0:ne.value.value,disabled:e.disabled}))??e.text]),Y&&Z("div",{key:"append",class:"v-chip__append"},[d.append?Z(Li,{key:"append-defaults",disabled:!re,defaults:{VAvatar:{end:!0,image:e.appendAvatar},VIcon:{end:!0,icon:e.appendIcon}}},d.append):Z(Gn,null,[e.appendIcon&&Z(br,{key:"append-icon",end:!0,icon:e.appendIcon},null),e.appendAvatar&&Z(ml,{key:"append-avatar",end:!0,image:e.appendAvatar},null)])]),ie&&Z("button",fn({key:"close",class:"v-chip__close",type:"button"},be.value),[d.close?Z(Li,{key:"close-defaults",defaults:{VIcon:{icon:e.closeIcon,size:"x-small"}}},d.close):Z(br,{key:"close-icon",icon:e.closeIcon,size:"x-small"},null)])]}}),[[Ya("ripple"),fe.value&&e.ripple,null]])}}}),jw=Symbol.for("vuetify:list");function kz(){const e=Mi(jw,{hasPrepend:kn(!1),updateHasPrepend:()=>null}),t={hasPrepend:kn(!1),updateHasPrepend:o=>{o&&(t.hasPrepend.value=o)}};return Vr(jw,t),e}function Rz(){return Mi(jw,null)}const DT=e=>{const t={activate:o=>{let{id:c,value:d,activated:v}=o;return c=ui(c),e&&!d&&v.size===1&&v.has(c)||(d?v.add(c):v.delete(c)),v},in:(o,c,d)=>{let v=new Set;if(o!=null)for(const y of go(o))v=t.activate({id:y,value:!0,activated:new Set(v),children:c,parents:d});return v},out:o=>Array.from(o)};return t},Dz=e=>{const t=DT(e);return{activate:c=>{let{activated:d,id:v,...y}=c;v=ui(v);const T=d.has(v)?new Set([v]):new Set;return t.activate({...y,id:v,activated:T})},in:(c,d,v)=>{let y=new Set;if(c!=null){const T=go(c);T.length&&(y=t.in(T.slice(0,1),d,v))}return y},out:(c,d,v)=>t.out(c,d,v)}},pZ=e=>{const t=DT(e);return{activate:c=>{let{id:d,activated:v,children:y,...T}=c;return d=ui(d),y.has(d)?v:t.activate({id:d,activated:v,children:y,...T})},in:t.in,out:t.out}},mZ=e=>{const t=Dz(e);return{activate:c=>{let{id:d,activated:v,children:y,...T}=c;return d=ui(d),y.has(d)?v:t.activate({id:d,activated:v,children:y,...T})},in:t.in,out:t.out}},gZ={open:e=>{let{id:t,value:o,opened:c,parents:d}=e;if(o){const v=new Set;v.add(t);let y=d.get(t);for(;y!=null;)v.add(y),y=d.get(y);return v}else return c.delete(t),c},select:()=>null},Oz={open:e=>{let{id:t,value:o,opened:c,parents:d}=e;if(o){let v=ui(d.get(t));for(c.add(t);v!=null&&v!==t;)c.add(v),v=ui(d.get(v));return c}else c.delete(t);return c},select:()=>null},_Z={open:Oz.open,select:e=>{let{id:t,value:o,opened:c,parents:d}=e;if(!o)return c;const v=[];let y=d.get(t);for(;y!=null;)v.push(y),y=d.get(y);return new Set(v)}},OT=e=>{const t={select:o=>{let{id:c,value:d,selected:v}=o;if(c=ui(c),e&&!d){const y=Array.from(v.entries()).reduce((T,r)=>{let[D,L]=r;return L==="on"&&T.push(D),T},[]);if(y.length===1&&y[0]===c)return v}return v.set(c,d?"on":"off"),v},in:(o,c,d)=>{let v=new Map;for(const y of o||[])v=t.select({id:y,value:!0,selected:new Map(v),children:c,parents:d});return v},out:o=>{const c=[];for(const[d,v]of o.entries())v==="on"&&c.push(d);return c}};return t},Lz=e=>{const t=OT(e);return{select:c=>{let{selected:d,id:v,...y}=c;v=ui(v);const T=d.has(v)?new Map([[v,d.get(v)]]):new Map;return t.select({...y,id:v,selected:T})},in:(c,d,v)=>{let y=new Map;return c!=null&&c.length&&(y=t.in(c.slice(0,1),d,v)),y},out:(c,d,v)=>t.out(c,d,v)}},vZ=e=>{const t=OT(e);return{select:c=>{let{id:d,selected:v,children:y,...T}=c;return d=ui(d),y.has(d)?v:t.select({id:d,selected:v,children:y,...T})},in:t.in,out:t.out}},yZ=e=>{const t=Lz(e);return{select:c=>{let{id:d,selected:v,children:y,...T}=c;return d=ui(d),y.has(d)?v:t.select({id:d,selected:v,children:y,...T})},in:t.in,out:t.out}},bZ=e=>{const t={select:o=>{let{id:c,value:d,selected:v,children:y,parents:T}=o;c=ui(c);const r=new Map(v),D=[c];for(;D.length;){const B=D.shift();v.set(ui(B),d?"on":"off"),y.has(B)&&D.push(...y.get(B))}let L=ui(T.get(c));for(;L;){const B=y.get(L),U=B.every(W=>v.get(ui(W))==="on"),$=B.every(W=>!v.has(ui(W))||v.get(ui(W))==="off");v.set(L,U?"on":$?"off":"indeterminate"),L=ui(T.get(L))}return e&&!d&&Array.from(v.entries()).reduce((U,$)=>{let[W,q]=$;return q==="on"&&U.push(W),U},[]).length===0?r:v},in:(o,c,d)=>{let v=new Map;for(const y of o||[])v=t.select({id:y,value:!0,selected:new Map(v),children:c,parents:d});return v},out:(o,c)=>{const d=[];for(const[v,y]of o.entries())y==="on"&&!c.has(v)&&d.push(v);return d}};return t},c_=Symbol.for("vuetify:nested"),zz={id:kn(),root:{register:()=>null,unregister:()=>null,parents:rn(new Map),children:rn(new Map),open:()=>null,openOnSelect:()=>null,activate:()=>null,select:()=>null,activatable:rn(!1),selectable:rn(!1),opened:rn(new Set),activated:rn(new Set),selected:rn(new Map),selectedValues:rn([])}},xZ=At({activatable:Boolean,selectable:Boolean,activeStrategy:[String,Function,Object],selectStrategy:[String,Function,Object],openStrategy:[String,Object],opened:null,activated:null,selected:null,mandatory:Boolean},"nested"),wZ=e=>{let t=!1;const o=rn(new Map),c=rn(new Map),d=ei(e,"opened",e.opened,$=>new Set(ui($)),$=>[...$.values()]),v=Se(()=>{if(typeof e.activeStrategy=="object")return e.activeStrategy;if(typeof e.activeStrategy=="function")return e.activeStrategy(e.mandatory);switch(e.activeStrategy){case"leaf":return pZ(e.mandatory);case"single-leaf":return mZ(e.mandatory);case"independent":return DT(e.mandatory);case"single-independent":default:return Dz(e.mandatory)}}),y=Se(()=>{if(typeof e.selectStrategy=="object")return e.selectStrategy;if(typeof e.selectStrategy=="function")return e.selectStrategy(e.mandatory);switch(e.selectStrategy){case"single-leaf":return yZ(e.mandatory);case"leaf":return vZ(e.mandatory);case"independent":return OT(e.mandatory);case"single-independent":return Lz(e.mandatory);case"classic":default:return bZ(e.mandatory)}}),T=Se(()=>{if(typeof e.openStrategy=="object")return e.openStrategy;switch(e.openStrategy){case"list":return _Z;case"single":return gZ;case"multiple":default:return Oz}}),r=ei(e,"activated",e.activated,$=>v.value.in($,o.value,c.value),$=>v.value.out($,o.value,c.value)),D=ei(e,"selected",e.selected,$=>y.value.in($,o.value,c.value),$=>y.value.out($,o.value,c.value));Ts(()=>{t=!0});function L($){const W=[];let q=$;for(;q!=null;)W.unshift(q),q=c.value.get(q);return W}const B=Lo("nested"),U={id:kn(),root:{opened:d,activatable:Ht(e,"activatable"),selectable:Ht(e,"selectable"),activated:r,selected:D,selectedValues:Se(()=>{const $=[];for(const[W,q]of D.value.entries())q==="on"&&$.push(W);return $}),register:($,W,q)=>{W&&$!==W&&c.value.set($,W),q&&o.value.set($,[]),W!=null&&o.value.set(W,[...o.value.get(W)||[],$])},unregister:$=>{if(t)return;o.value.delete($);const W=c.value.get($);if(W){const q=o.value.get(W)??[];o.value.set(W,q.filter(ne=>ne!==$))}c.value.delete($)},open:($,W,q)=>{B.emit("click:open",{id:$,value:W,path:L($),event:q});const ne=T.value.open({id:$,value:W,opened:new Set(d.value),children:o.value,parents:c.value,event:q});ne&&(d.value=ne)},openOnSelect:($,W,q)=>{const ne=T.value.select({id:$,value:W,selected:new Map(D.value),opened:new Set(d.value),children:o.value,parents:c.value,event:q});ne&&(d.value=ne)},select:($,W,q)=>{B.emit("click:select",{id:$,value:W,path:L($),event:q});const ne=y.value.select({id:$,value:W,selected:new Map(D.value),children:o.value,parents:c.value,event:q});ne&&(D.value=ne),U.root.openOnSelect($,W,q)},activate:($,W,q)=>{if(!e.activatable)return U.root.select($,!0,q);B.emit("click:activate",{id:$,value:W,path:L($),event:q});const ne=v.value.activate({id:$,value:W,activated:new Set(r.value),children:o.value,parents:c.value,event:q});ne&&(r.value=ne)},children:o,parents:c}};return Vr(c_,U),U.root},Bz=(e,t)=>{const o=Mi(c_,zz),c=Symbol(Es()),d=Se(()=>e.value!==void 0?e.value:c),v={...o,id:d,open:(y,T)=>o.root.open(ui(d.value),y,T),openOnSelect:(y,T)=>o.root.openOnSelect(d.value,y,T),isOpen:Se(()=>o.root.opened.value.has(ui(d.value))),parent:Se(()=>o.root.parents.value.get(d.value)),activate:(y,T)=>o.root.activate(d.value,y,T),isActivated:Se(()=>o.root.activated.value.has(ui(d.value))),select:(y,T)=>o.root.select(d.value,y,T),isSelected:Se(()=>o.root.selected.value.get(ui(d.value))==="on"),isIndeterminate:Se(()=>o.root.selected.value.get(d.value)==="indeterminate"),isLeaf:Se(()=>!o.root.children.value.get(d.value)),isGroupActivator:o.isGroupActivator};return!o.isGroupActivator&&o.root.register(d.value,o.id.value,t),Ts(()=>{!o.isGroupActivator&&o.root.unregister(d.value)}),t&&Vr(c_,v),v},SZ=()=>{const e=Mi(c_,zz);Vr(c_,{...e,isGroupActivator:!0})},TZ=Ka({name:"VListGroupActivator",setup(e,t){let{slots:o}=t;return SZ(),()=>{var c;return(c=o.default)==null?void 0:c.call(o)}}}),EZ=At({activeColor:String,baseColor:String,color:String,collapseIcon:{type:mi,default:"$collapse"},expandIcon:{type:mi,default:"$expand"},prependIcon:mi,appendIcon:mi,fluid:Boolean,subgroup:Boolean,title:String,value:null,...Nn(),...Si()},"VListGroup"),$w=Jt()({name:"VListGroup",props:EZ(),setup(e,t){let{slots:o}=t;const{isOpen:c,open:d,id:v}=Bz(Ht(e,"value"),!0),y=Se(()=>`v-list-group--id-${String(v.value)}`),T=Rz(),{isBooted:r}=Ld();function D($){$.stopPropagation(),d(!c.value,$)}const L=Se(()=>({onClick:D,class:"v-list-group__header",id:y.value})),B=Se(()=>c.value?e.collapseIcon:e.expandIcon),U=Se(()=>({VListItem:{active:c.value,activeColor:e.activeColor,baseColor:e.baseColor,color:e.color,prependIcon:e.prependIcon||e.subgroup&&B.value,appendIcon:e.appendIcon||!e.subgroup&&B.value,title:e.title,value:e.value}}));return cn(()=>Z(e.tag,{class:["v-list-group",{"v-list-group--prepend":T==null?void 0:T.hasPrepend.value,"v-list-group--fluid":e.fluid,"v-list-group--subgroup":e.subgroup,"v-list-group--open":c.value},e.class],style:e.style},{default:()=>[o.activator&&Z(Li,{defaults:U.value},{default:()=>[Z(TZ,null,{default:()=>[o.activator({props:L.value,isOpen:c.value})]})]}),Z(Xs,{transition:{component:J0},disabled:!r.value},{default:()=>{var $;return[lr(Z("div",{class:"v-list-group__items",role:"group","aria-labelledby":y.value},[($=o.default)==null?void 0:$.call(o)]),[[Hl,c.value]])]}})]})),{isOpen:c}}}),IZ=At({opacity:[Number,String],...Nn(),...Si()},"VListItemSubtitle"),Fz=Jt()({name:"VListItemSubtitle",props:IZ(),setup(e,t){let{slots:o}=t;return cn(()=>Z(e.tag,{class:["v-list-item-subtitle",e.class],style:[{"--v-list-item-subtitle-opacity":e.opacity},e.style]},o)),{}}}),Vz=Tc("v-list-item-title"),CZ=At({active:{type:Boolean,default:void 0},activeClass:String,activeColor:String,appendAvatar:String,appendIcon:mi,baseColor:String,disabled:Boolean,lines:[Boolean,String],link:{type:Boolean,default:void 0},nav:Boolean,prependAvatar:String,prependIcon:mi,ripple:{type:[Boolean,Object],default:!0},slim:Boolean,subtitle:[String,Number],title:[String,Number],value:null,onClick:Ss(),onClickOnce:Ss(),...Na(),...Nn(),..._s(),...Ko(),...ls(),...co(),...P_(),...Si(),...Ji(),...vl({variant:"text"})},"VListItem"),tu=Jt()({name:"VListItem",directives:{Ripple:ru},props:CZ(),emits:{click:e=>!0},setup(e,t){let{attrs:o,slots:c,emit:d}=t;const v=A_(e,o),y=Se(()=>e.value===void 0?v.href.value:e.value),{activate:T,isActivated:r,select:D,isOpen:L,isSelected:B,isIndeterminate:U,isGroupActivator:$,root:W,parent:q,openOnSelect:ne}=Bz(y,!1),ce=Rz(),oe=Se(()=>{var mt;return e.active!==!1&&(e.active||((mt=v.isActive)==null?void 0:mt.value)||(W.activatable.value?r.value:B.value))}),fe=Se(()=>e.link!==!1&&v.isLink.value),be=Se(()=>!e.disabled&&e.link!==!1&&(e.link||v.isClickable.value||!!ce&&(W.selectable.value||W.activatable.value||e.value!=null))),ge=Se(()=>e.rounded||e.nav),Ee=Se(()=>e.color??e.activeColor),de=Se(()=>({color:oe.value?Ee.value??e.baseColor:e.baseColor,variant:e.variant}));On(()=>{var mt;return(mt=v.isActive)==null?void 0:mt.value},mt=>{mt&&q.value!=null&&W.open(q.value,!0),mt&&ne(mt)},{immediate:!0});const{themeClasses:re}=xr(e),{borderClasses:Y}=Qa(e),{colorClasses:ie,colorStyles:te,variantClasses:ae}=zd(de),{densityClasses:pe}=Js(e),{dimensionStyles:Le}=Jo(e),{elevationClasses:tt}=Is(e),{roundedClasses:Je}=So(ge),Mt=Se(()=>e.lines?`v-list-item--${e.lines}-line`:void 0),Lt=Se(()=>({isActive:oe.value,select:D,isOpen:L.value,isSelected:B.value,isIndeterminate:U.value}));function yt(mt){var Ft;d("click",mt),be.value&&((Ft=v.navigate)==null||Ft.call(v,mt),!$&&(W.activatable.value?T(!r.value,mt):(W.selectable.value||e.value!=null)&&D(!B.value,mt)))}function rt(mt){(mt.key==="Enter"||mt.key===" ")&&(mt.preventDefault(),yt(mt))}return cn(()=>{const mt=fe.value?"a":e.tag,Ft=c.title||e.title!=null,bn=c.subtitle||e.subtitle!=null,Bt=!!(e.appendAvatar||e.appendIcon),ht=!!(Bt||c.append),gt=!!(e.prependAvatar||e.prependIcon),et=!!(gt||c.prepend);return ce==null||ce.updateHasPrepend(et),e.activeColor&&Aq("active-color",["color","base-color"]),lr(Z(mt,{class:["v-list-item",{"v-list-item--active":oe.value,"v-list-item--disabled":e.disabled,"v-list-item--link":be.value,"v-list-item--nav":e.nav,"v-list-item--prepend":!et&&(ce==null?void 0:ce.hasPrepend.value),"v-list-item--slim":e.slim,[`${e.activeClass}`]:e.activeClass&&oe.value},re.value,Y.value,ie.value,pe.value,tt.value,Mt.value,Je.value,ae.value,e.class],style:[te.value,Le.value,e.style],href:v.href.value,tabindex:be.value?ce?-2:0:void 0,onClick:yt,onKeydown:be.value&&!fe.value&&rt},{default:()=>{var Nt;return[mh(be.value||oe.value,"v-list-item"),et&&Z("div",{key:"prepend",class:"v-list-item__prepend"},[c.prepend?Z(Li,{key:"prepend-defaults",disabled:!gt,defaults:{VAvatar:{density:e.density,image:e.prependAvatar},VIcon:{density:e.density,icon:e.prependIcon},VListItemAction:{start:!0}}},{default:()=>{var St;return[(St=c.prepend)==null?void 0:St.call(c,Lt.value)]}}):Z(Gn,null,[e.prependAvatar&&Z(ml,{key:"prepend-avatar",density:e.density,image:e.prependAvatar},null),e.prependIcon&&Z(br,{key:"prepend-icon",density:e.density,icon:e.prependIcon},null)]),Z("div",{class:"v-list-item__spacer"},null)]),Z("div",{class:"v-list-item__content","data-no-activator":""},[Ft&&Z(Vz,{key:"title"},{default:()=>{var St;return[((St=c.title)==null?void 0:St.call(c,{title:e.title}))??e.title]}}),bn&&Z(Fz,{key:"subtitle"},{default:()=>{var St;return[((St=c.subtitle)==null?void 0:St.call(c,{subtitle:e.subtitle}))??e.subtitle]}}),(Nt=c.default)==null?void 0:Nt.call(c,Lt.value)]),ht&&Z("div",{key:"append",class:"v-list-item__append"},[c.append?Z(Li,{key:"append-defaults",disabled:!Bt,defaults:{VAvatar:{density:e.density,image:e.appendAvatar},VIcon:{density:e.density,icon:e.appendIcon},VListItemAction:{end:!0}}},{default:()=>{var St;return[(St=c.append)==null?void 0:St.call(c,Lt.value)]}}):Z(Gn,null,[e.appendIcon&&Z(br,{key:"append-icon",density:e.density,icon:e.appendIcon},null),e.appendAvatar&&Z(ml,{key:"append-avatar",density:e.density,image:e.appendAvatar},null)]),Z("div",{class:"v-list-item__spacer"},null)])]}}),[[Ya("ripple"),be.value&&e.ripple]])}),{activate:T,isActivated:r,isGroupActivator:$,isSelected:B,list:ce,select:D}}}),AZ=At({color:String,inset:Boolean,sticky:Boolean,title:String,...Nn(),...Si()},"VListSubheader"),Nz=Jt()({name:"VListSubheader",props:AZ(),setup(e,t){let{slots:o}=t;const{textColorClasses:c,textColorStyles:d}=Fs(Ht(e,"color"));return cn(()=>{const v=!!(o.default||e.title);return Z(e.tag,{class:["v-list-subheader",{"v-list-subheader--inset":e.inset,"v-list-subheader--sticky":e.sticky},c.value,e.class],style:[{textColorStyles:d},e.style]},{default:()=>{var y;return[v&&Z("div",{class:"v-list-subheader__text"},[((y=o.default)==null?void 0:y.call(o))??e.title])]}})}),{}}}),PZ=At({color:String,inset:Boolean,length:[Number,String],opacity:[Number,String],thickness:[Number,String],vertical:Boolean,...Nn(),...Ji()},"VDivider"),k_=Jt()({name:"VDivider",props:PZ(),setup(e,t){let{attrs:o,slots:c}=t;const{themeClasses:d}=xr(e),{textColorClasses:v,textColorStyles:y}=Fs(Ht(e,"color")),T=Se(()=>{const r={};return e.length&&(r[e.vertical?"height":"width"]=Bn(e.length)),e.thickness&&(r[e.vertical?"borderRightWidth":"borderTopWidth"]=Bn(e.thickness)),r});return cn(()=>{const r=Z("hr",{class:[{"v-divider":!0,"v-divider--inset":e.inset,"v-divider--vertical":e.vertical},d.value,v.value,e.class],style:[T.value,y.value,{"--v-border-opacity":e.opacity},e.style],"aria-orientation":!o.role||o.role==="separator"?e.vertical?"vertical":"horizontal":void 0,role:`${o.role||"separator"}`},null);return c.default?Z("div",{class:["v-divider__wrapper",{"v-divider__wrapper--vertical":e.vertical,"v-divider__wrapper--inset":e.inset}]},[r,Z("div",{class:"v-divider__content"},[c.default()]),r]):r}),{}}}),MZ=At({items:Array,returnObject:Boolean},"VListChildren"),Uz=Jt()({name:"VListChildren",props:MZ(),setup(e,t){let{slots:o}=t;return kz(),()=>{var c,d;return((c=o.default)==null?void 0:c.call(o))??((d=e.items)==null?void 0:d.map(v=>{var U,$;let{children:y,props:T,type:r,raw:D}=v;if(r==="divider")return((U=o.divider)==null?void 0:U.call(o,{props:T}))??Z(k_,T,null);if(r==="subheader")return(($=o.subheader)==null?void 0:$.call(o,{props:T}))??Z(Nz,T,null);const L={subtitle:o.subtitle?W=>{var q;return(q=o.subtitle)==null?void 0:q.call(o,{...W,item:D})}:void 0,prepend:o.prepend?W=>{var q;return(q=o.prepend)==null?void 0:q.call(o,{...W,item:D})}:void 0,append:o.append?W=>{var q;return(q=o.append)==null?void 0:q.call(o,{...W,item:D})}:void 0,title:o.title?W=>{var q;return(q=o.title)==null?void 0:q.call(o,{...W,item:D})}:void 0},B=$w.filterProps(T);return y?Z($w,fn({value:T==null?void 0:T.value},B),{activator:W=>{let{props:q}=W;const ne={...T,...q,value:e.returnObject?D:T.value};return o.header?o.header({props:ne}):Z(tu,ne,L)},default:()=>Z(Uz,{items:y,returnObject:e.returnObject},o)}):o.item?o.item({props:T}):Z(tu,fn(T,{value:e.returnObject?D:T.value}),L)}))}}}),jz=At({items:{type:Array,default:()=>[]},itemTitle:{type:[String,Array,Function],default:"title"},itemValue:{type:[String,Array,Function],default:"value"},itemChildren:{type:[Boolean,String,Array,Function],default:"children"},itemProps:{type:[Boolean,String,Array,Function],default:"props"},returnObject:Boolean,valueComparator:{type:Function,default:wc}},"list-items");function eh(e,t){const o=as(t,e.itemTitle,t),c=as(t,e.itemValue,o),d=as(t,e.itemChildren),v=e.itemProps===!0?typeof t=="object"&&t!=null&&!Array.isArray(t)?"children"in t?Yo(t,["children"]):t:void 0:as(t,e.itemProps),y={title:o,value:c,...v};return{title:String(y.title??""),value:y.value,props:y,children:Array.isArray(d)?$z(e,d):void 0,raw:t}}function $z(e,t){const o=[];for(const c of t)o.push(eh(e,c));return o}function LT(e){const t=Se(()=>$z(e,e.items)),o=Se(()=>t.value.some(v=>v.value===null));function c(v){return o.value||(v=v.filter(y=>y!==null)),v.map(y=>e.returnObject&&typeof y=="string"?eh(e,y):t.value.find(T=>e.valueComparator(y,T.value))||eh(e,y))}function d(v){return e.returnObject?v.map(y=>{let{raw:T}=y;return T}):v.map(y=>{let{value:T}=y;return T})}return{items:t,transformIn:c,transformOut:d}}function kZ(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"}function RZ(e,t){const o=as(t,e.itemType,"item"),c=kZ(t)?t:as(t,e.itemTitle),d=as(t,e.itemValue,void 0),v=as(t,e.itemChildren),y=e.itemProps===!0?Yo(t,["children"]):as(t,e.itemProps),T={title:c,value:d,...y};return{type:o,title:T.title,value:T.value,props:T,children:o==="item"&&v?Gz(e,v):void 0,raw:t}}function Gz(e,t){const o=[];for(const c of t)o.push(RZ(e,c));return o}function DZ(e){return{items:Se(()=>Gz(e,e.items))}}const OZ=At({baseColor:String,activeColor:String,activeClass:String,bgColor:String,disabled:Boolean,expandIcon:String,collapseIcon:String,lines:{type:[Boolean,String],default:"one"},slim:Boolean,nav:Boolean,"onClick:open":Ss(),"onClick:select":Ss(),"onUpdate:opened":Ss(),...xZ({selectStrategy:"single-leaf",openStrategy:"list"}),...Na(),...Nn(),..._s(),...Ko(),...ls(),itemType:{type:String,default:"type"},...jz(),...co(),...Si(),...Ji(),...vl({variant:"text"})},"VList"),ob=Jt()({name:"VList",props:OZ(),emits:{"update:selected":e=>!0,"update:activated":e=>!0,"update:opened":e=>!0,"click:open":e=>!0,"click:activate":e=>!0,"click:select":e=>!0},setup(e,t){let{slots:o}=t;const{items:c}=DZ(e),{themeClasses:d}=xr(e),{backgroundColorClasses:v,backgroundColorStyles:y}=Nr(Ht(e,"bgColor")),{borderClasses:T}=Qa(e),{densityClasses:r}=Js(e),{dimensionStyles:D}=Jo(e),{elevationClasses:L}=Is(e),{roundedClasses:B}=So(e),{children:U,open:$,parents:W,select:q}=wZ(e),ne=Se(()=>e.lines?`v-list--${e.lines}-line`:void 0),ce=Ht(e,"activeColor"),oe=Ht(e,"baseColor"),fe=Ht(e,"color");kz(),wo({VListGroup:{activeColor:ce,baseColor:oe,color:fe,expandIcon:Ht(e,"expandIcon"),collapseIcon:Ht(e,"collapseIcon")},VListItem:{activeClass:Ht(e,"activeClass"),activeColor:ce,baseColor:oe,color:fe,density:Ht(e,"density"),disabled:Ht(e,"disabled"),lines:Ht(e,"lines"),nav:Ht(e,"nav"),slim:Ht(e,"slim"),variant:Ht(e,"variant")}});const be=kn(!1),ge=rn();function Ee(ae){be.value=!0}function de(ae){be.value=!1}function re(ae){var pe;!be.value&&!(ae.relatedTarget&&((pe=ge.value)!=null&&pe.contains(ae.relatedTarget)))&&te()}function Y(ae){const pe=ae.target;if(!(!ge.value||["INPUT","TEXTAREA"].includes(pe.tagName))){if(ae.key==="ArrowDown")te("next");else if(ae.key==="ArrowUp")te("prev");else if(ae.key==="Home")te("first");else if(ae.key==="End")te("last");else return;ae.preventDefault()}}function ie(ae){be.value=!0}function te(ae){if(ge.value)return Mp(ge.value,ae)}return cn(()=>Z(e.tag,{ref:ge,class:["v-list",{"v-list--disabled":e.disabled,"v-list--nav":e.nav,"v-list--slim":e.slim},d.value,v.value,T.value,r.value,L.value,ne.value,B.value,e.class],style:[y.value,D.value,e.style],tabindex:e.disabled||be.value?-1:0,role:"listbox","aria-activedescendant":void 0,onFocusin:Ee,onFocusout:de,onFocus:re,onKeydown:Y,onMousedown:ie},{default:()=>[Z(Uz,{items:c.value,returnObject:e.returnObject},o)]})),{open:$,select:q,focus:te,children:U,parents:W}}}),LZ=Tc("v-list-img"),zZ=At({start:Boolean,end:Boolean,...Nn(),...Si()},"VListItemAction"),BZ=Jt()({name:"VListItemAction",props:zZ(),setup(e,t){let{slots:o}=t;return cn(()=>Z(e.tag,{class:["v-list-item-action",{"v-list-item-action--start":e.start,"v-list-item-action--end":e.end},e.class],style:e.style},o)),{}}}),FZ=At({start:Boolean,end:Boolean,...Nn(),...Si()},"VListItemMedia"),VZ=Jt()({name:"VListItemMedia",props:FZ(),setup(e,t){let{slots:o}=t;return cn(()=>Z(e.tag,{class:["v-list-item-media",{"v-list-item-media--start":e.start,"v-list-item-media--end":e.end},e.class],style:e.style},o)),{}}});function $1(e,t){return{x:e.x+t.x,y:e.y+t.y}}function NZ(e,t){return{x:e.x-t.x,y:e.y-t.y}}function gk(e,t){if(e.side==="top"||e.side==="bottom"){const{side:o,align:c}=e,d=c==="left"?0:c==="center"?t.width/2:c==="right"?t.width:c,v=o==="top"?0:o==="bottom"?t.height:o;return $1({x:d,y:v},t)}else if(e.side==="left"||e.side==="right"){const{side:o,align:c}=e,d=o==="left"?0:o==="right"?t.width:o,v=c==="top"?0:c==="center"?t.height/2:c==="bottom"?t.height:c;return $1({x:d,y:v},t)}return $1({x:t.width/2,y:t.height/2},t)}const Hz={static:$Z,connected:HZ},UZ=At({locationStrategy:{type:[String,Function],default:"static",validator:e=>typeof e=="function"||e in Hz},location:{type:String,default:"bottom"},origin:{type:String,default:"auto"},offset:[Number,String,Array]},"VOverlay-location-strategies");function jZ(e,t){const o=rn({}),c=rn();Ar&&za(()=>!!(t.isActive.value&&e.locationStrategy),v=>{var y,T;On(()=>e.locationStrategy,v),Ys(()=>{window.removeEventListener("resize",d),c.value=void 0}),window.addEventListener("resize",d,{passive:!0}),typeof e.locationStrategy=="function"?c.value=(y=e.locationStrategy(t,e,o))==null?void 0:y.updateLocation:c.value=(T=Hz[e.locationStrategy](t,e,o))==null?void 0:T.updateLocation});function d(v){var y;(y=c.value)==null||y.call(c,v)}return{contentStyles:o,updateLocation:c}}function $Z(){}function GZ(e,t){const o=gT(e);return t?o.x+=parseFloat(e.style.right||0):o.x-=parseFloat(e.style.left||0),o.y-=parseFloat(e.style.top||0),o}function HZ(e,t,o){(Array.isArray(e.target.value)||Xq(e.target.value))&&Object.assign(o.value,{position:"fixed",top:0,[e.isRtl.value?"right":"left"]:0});const{preferredAnchor:d,preferredOrigin:v}=pT(()=>{const W=Pw(t.location,e.isRtl.value),q=t.origin==="overlap"?W:t.origin==="auto"?F1(W):Pw(t.origin,e.isRtl.value);return W.side===q.side&&W.align===V1(q).align?{preferredAnchor:BM(W),preferredOrigin:BM(q)}:{preferredAnchor:W,preferredOrigin:q}}),[y,T,r,D]=["minWidth","minHeight","maxWidth","maxHeight"].map(W=>Se(()=>{const q=parseFloat(t[W]);return isNaN(q)?1/0:q})),L=Se(()=>{if(Array.isArray(t.offset))return t.offset;if(typeof t.offset=="string"){const W=t.offset.split(" ").map(parseFloat);return W.length<2&&W.push(0),W}return typeof t.offset=="number"?[t.offset,0]:[0,0]});let B=!1;const U=new ResizeObserver(()=>{B&&$()});On([e.target,e.contentEl],(W,q)=>{let[ne,ce]=W,[oe,fe]=q;oe&&!Array.isArray(oe)&&U.unobserve(oe),ne&&!Array.isArray(ne)&&U.observe(ne),fe&&U.unobserve(fe),ce&&U.observe(ce)},{immediate:!0}),Ys(()=>{U.disconnect()});function $(){if(B=!1,requestAnimationFrame(()=>B=!0),!e.target.value||!e.contentEl.value)return;const W=TL(e.target.value),q=GZ(e.contentEl.value,e.isRtl.value),ne=y0(e.contentEl.value),ce=12;ne.length||(ne.push(document.documentElement),e.contentEl.value.style.top&&e.contentEl.value.style.left||(q.x-=parseFloat(document.documentElement.style.getPropertyValue("--v-body-scroll-x")||0),q.y-=parseFloat(document.documentElement.style.getPropertyValue("--v-body-scroll-y")||0)));const oe=ne.reduce((te,ae)=>{const pe=ae.getBoundingClientRect(),Le=new fd({x:ae===document.documentElement?0:pe.x,y:ae===document.documentElement?0:pe.y,width:ae.clientWidth,height:ae.clientHeight});return te?new fd({x:Math.max(te.left,Le.left),y:Math.max(te.top,Le.top),width:Math.min(te.right,Le.right)-Math.max(te.left,Le.left),height:Math.min(te.bottom,Le.bottom)-Math.max(te.top,Le.top)}):Le},void 0);oe.x+=ce,oe.y+=ce,oe.width-=ce*2,oe.height-=ce*2;let fe={anchor:d.value,origin:v.value};function be(te){const ae=new fd(q),pe=gk(te.anchor,W),Le=gk(te.origin,ae);let{x:tt,y:Je}=NZ(pe,Le);switch(te.anchor.side){case"top":Je-=L.value[0];break;case"bottom":Je+=L.value[0];break;case"left":tt-=L.value[0];break;case"right":tt+=L.value[0];break}switch(te.anchor.align){case"top":Je-=L.value[1];break;case"bottom":Je+=L.value[1];break;case"left":tt-=L.value[1];break;case"right":tt+=L.value[1];break}return ae.x+=tt,ae.y+=Je,ae.width=Math.min(ae.width,r.value),ae.height=Math.min(ae.height,D.value),{overflows:VM(ae,oe),x:tt,y:Je}}let ge=0,Ee=0;const de={x:0,y:0},re={x:!1,y:!1};let Y=-1;for(;!(Y++>10);){const{x:te,y:ae,overflows:pe}=be(fe);ge+=te,Ee+=ae,q.x+=te,q.y+=ae;{const Le=FM(fe.anchor),tt=pe.x.before||pe.x.after,Je=pe.y.before||pe.y.after;let Mt=!1;if(["x","y"].forEach(Lt=>{if(Lt==="x"&&tt&&!re.x||Lt==="y"&&Je&&!re.y){const yt={anchor:{...fe.anchor},origin:{...fe.origin}},rt=Lt==="x"?Le==="y"?V1:F1:Le==="y"?F1:V1;yt.anchor=rt(yt.anchor),yt.origin=rt(yt.origin);const{overflows:mt}=be(yt);(mt[Lt].before<=pe[Lt].before&&mt[Lt].after<=pe[Lt].after||mt[Lt].before+mt[Lt].after<(pe[Lt].before+pe[Lt].after)/2)&&(fe=yt,Mt=re[Lt]=!0)}}),Mt)continue}pe.x.before&&(ge+=pe.x.before,q.x+=pe.x.before),pe.x.after&&(ge-=pe.x.after,q.x-=pe.x.after),pe.y.before&&(Ee+=pe.y.before,q.y+=pe.y.before),pe.y.after&&(Ee-=pe.y.after,q.y-=pe.y.after);{const Le=VM(q,oe);de.x=oe.width-Le.x.before-Le.x.after,de.y=oe.height-Le.y.before-Le.y.after,ge+=Le.x.before,q.x+=Le.x.before,Ee+=Le.y.before,q.y+=Le.y.before}break}const ie=FM(fe.anchor);return Object.assign(o.value,{"--v-overlay-anchor-origin":`${fe.anchor.side} ${fe.anchor.align}`,transformOrigin:`${fe.origin.side} ${fe.origin.align}`,top:Bn(G1(Ee)),left:e.isRtl.value?void 0:Bn(G1(ge)),right:e.isRtl.value?Bn(G1(-ge)):void 0,minWidth:Bn(ie==="y"?Math.min(y.value,W.width):y.value),maxWidth:Bn(_k(Go(de.x,y.value===1/0?0:y.value,r.value))),maxHeight:Bn(_k(Go(de.y,T.value===1/0?0:T.value,D.value)))}),{available:de,contentBox:q}}return On(()=>[d.value,v.value,t.offset,t.minWidth,t.minHeight,t.maxWidth,t.maxHeight],()=>$()),Ki(()=>{const W=$();if(!W)return;const{available:q,contentBox:ne}=W;ne.height>q.y&&requestAnimationFrame(()=>{$(),requestAnimationFrame(()=>{$()})})}),{updateLocation:$}}function G1(e){return Math.round(e*devicePixelRatio)/devicePixelRatio}function _k(e){return Math.ceil(e*devicePixelRatio)/devicePixelRatio}let Gw=!0;const w0=[];function qZ(e){!Gw||w0.length?(w0.push(e),Hw()):(Gw=!1,e(),Hw())}let vk=-1;function Hw(){cancelAnimationFrame(vk),vk=requestAnimationFrame(()=>{const e=w0.shift();e&&e(),w0.length?Hw():Gw=!0})}const Hy={none:null,close:XZ,block:YZ,reposition:KZ},WZ=At({scrollStrategy:{type:[String,Function],default:"block",validator:e=>typeof e=="function"||e in Hy}},"VOverlay-scroll-strategies");function ZZ(e,t){if(!Ar)return;let o;Oo(async()=>{o==null||o.stop(),t.isActive.value&&e.scrollStrategy&&(o=A0(),await new Promise(c=>setTimeout(c)),o.active&&o.run(()=>{var c;typeof e.scrollStrategy=="function"?e.scrollStrategy(t,e,o):(c=Hy[e.scrollStrategy])==null||c.call(Hy,t,e,o)}))}),Ys(()=>{o==null||o.stop()})}function XZ(e){function t(o){e.isActive.value=!1}qz(e.targetEl.value??e.contentEl.value,t)}function YZ(e,t){var y;const o=(y=e.root.value)==null?void 0:y.offsetParent,c=[...new Set([...y0(e.targetEl.value,t.contained?o:void 0),...y0(e.contentEl.value,t.contained?o:void 0)])].filter(T=>!T.classList.contains("v-overlay-scroll-blocked")),d=window.innerWidth-document.documentElement.offsetWidth,v=(T=>xT(T)&&T)(o||document.documentElement);v&&e.root.value.classList.add("v-overlay--scroll-blocked"),c.forEach((T,r)=>{T.style.setProperty("--v-body-scroll-x",Bn(-T.scrollLeft)),T.style.setProperty("--v-body-scroll-y",Bn(-T.scrollTop)),T!==document.documentElement&&T.style.setProperty("--v-scrollbar-offset",Bn(d)),T.classList.add("v-overlay-scroll-blocked")}),Ys(()=>{c.forEach((T,r)=>{const D=parseFloat(T.style.getPropertyValue("--v-body-scroll-x")),L=parseFloat(T.style.getPropertyValue("--v-body-scroll-y")),B=T.style.scrollBehavior;T.style.scrollBehavior="auto",T.style.removeProperty("--v-body-scroll-x"),T.style.removeProperty("--v-body-scroll-y"),T.style.removeProperty("--v-scrollbar-offset"),T.classList.remove("v-overlay-scroll-blocked"),T.scrollLeft=-D,T.scrollTop=-L,T.style.scrollBehavior=B}),v&&e.root.value.classList.remove("v-overlay--scroll-blocked")})}function KZ(e,t,o){let c=!1,d=-1,v=-1;function y(T){qZ(()=>{var L,B;const r=performance.now();(B=(L=e.updateLocation).value)==null||B.call(L,T),c=(performance.now()-r)/(1e3/60)>2})}v=(typeof requestIdleCallback>"u"?T=>T():requestIdleCallback)(()=>{o.run(()=>{qz(e.targetEl.value??e.contentEl.value,T=>{c?(cancelAnimationFrame(d),d=requestAnimationFrame(()=>{d=requestAnimationFrame(()=>{y(T)})})):y(T)})})}),Ys(()=>{typeof cancelIdleCallback<"u"&&cancelIdleCallback(v),cancelAnimationFrame(d)})}function qz(e,t){const o=[document,...y0(e)];o.forEach(c=>{c.addEventListener("scroll",t,{passive:!0})}),Ys(()=>{o.forEach(c=>{c.removeEventListener("scroll",t)})})}const qw=Symbol.for("vuetify:v-menu"),zT=At({closeDelay:[Number,String],openDelay:[Number,String]},"delay");function BT(e,t){let o=()=>{};function c(y){o==null||o();const T=Number(y?e.openDelay:e.closeDelay);return new Promise(r=>{o=gq(T,()=>{t==null||t(y),r(y)})})}function d(){return c(!0)}function v(){return c(!1)}return{clearDelay:o,runOpenDelay:d,runCloseDelay:v}}const JZ=At({target:[String,Object],activator:[String,Object],activatorProps:{type:Object,default:()=>({})},openOnClick:{type:Boolean,default:void 0},openOnHover:Boolean,openOnFocus:{type:Boolean,default:void 0},closeOnContentClick:Boolean,...zT()},"VOverlay-activator");function QZ(e,t){let{isActive:o,isTop:c}=t;const d=Lo("useActivator"),v=rn();let y=!1,T=!1,r=!0;const D=Se(()=>e.openOnFocus||e.openOnFocus==null&&e.openOnHover),L=Se(()=>e.openOnClick||e.openOnClick==null&&!e.openOnHover&&!D.value),{runOpenDelay:B,runCloseDelay:U}=BT(e,de=>{de===(e.openOnHover&&y||D.value&&T)&&!(e.openOnHover&&o.value&&!c.value)&&(o.value!==de&&(r=!0),o.value=de)}),$=rn(),W={onClick:de=>{de.stopPropagation(),v.value=de.currentTarget||de.target,o.value||($.value=[de.clientX,de.clientY]),o.value=!o.value},onMouseenter:de=>{var re;(re=de.sourceCapabilities)!=null&&re.firesTouchEvents||(y=!0,v.value=de.currentTarget||de.target,B())},onMouseleave:de=>{y=!1,U()},onFocus:de=>{kp(de.target,":focus-visible")!==!1&&(T=!0,de.stopPropagation(),v.value=de.currentTarget||de.target,B())},onBlur:de=>{T=!1,de.stopPropagation(),U()}},q=Se(()=>{const de={};return L.value&&(de.onClick=W.onClick),e.openOnHover&&(de.onMouseenter=W.onMouseenter,de.onMouseleave=W.onMouseleave),D.value&&(de.onFocus=W.onFocus,de.onBlur=W.onBlur),de}),ne=Se(()=>{const de={};if(e.openOnHover&&(de.onMouseenter=()=>{y=!0,B()},de.onMouseleave=()=>{y=!1,U()}),D.value&&(de.onFocusin=()=>{T=!0,B()},de.onFocusout=()=>{T=!1,U()}),e.closeOnContentClick){const re=Mi(qw,null);de.onClick=()=>{o.value=!1,re==null||re.closeParents()}}return de}),ce=Se(()=>{const de={};return e.openOnHover&&(de.onMouseenter=()=>{r&&(y=!0,r=!1,B())},de.onMouseleave=()=>{y=!1,U()}),de});On(c,de=>{de&&(e.openOnHover&&!y&&(!D.value||!T)||D.value&&!T&&(!e.openOnHover||!y))&&(o.value=!1)}),On(o,de=>{de||setTimeout(()=>{$.value=void 0})},{flush:"post"});const oe=g0();Oo(()=>{oe.value&&Ki(()=>{v.value=oe.el})});const fe=g0(),be=Se(()=>e.target==="cursor"&&$.value?$.value:fe.value?fe.el:Wz(e.target,d)||v.value),ge=Se(()=>Array.isArray(be.value)?void 0:be.value);let Ee;return On(()=>!!e.activator,de=>{de&&Ar?(Ee=A0(),Ee.run(()=>{eX(e,d,{activatorEl:v,activatorEvents:q})})):Ee&&Ee.stop()},{flush:"post",immediate:!0}),Ys(()=>{Ee==null||Ee.stop()}),{activatorEl:v,activatorRef:oe,target:be,targetEl:ge,targetRef:fe,activatorEvents:q,contentEvents:ne,scrimEvents:ce}}function eX(e,t,o){let{activatorEl:c,activatorEvents:d}=o;On(()=>e.activator,(r,D)=>{if(D&&r!==D){const L=T(D);L&&y(L)}r&&Ki(()=>v())},{immediate:!0}),On(()=>e.activatorProps,()=>{v()}),Ys(()=>{y()});function v(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:T(),D=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e.activatorProps;r&&yq(r,fn(d.value,D))}function y(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:T(),D=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e.activatorProps;r&&bq(r,fn(d.value,D))}function T(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.activator;const D=Wz(r,t);return c.value=(D==null?void 0:D.nodeType)===Node.ELEMENT_NODE?D:void 0,c.value}}function Wz(e,t){var c,d;if(!e)return;let o;if(e==="parent"){let v=(d=(c=t==null?void 0:t.proxy)==null?void 0:c.$el)==null?void 0:d.parentNode;for(;v!=null&&v.hasAttribute("data-no-activator");)v=v.parentNode;o=v}else typeof e=="string"?o=document.querySelector(e):"$el"in e?o=e.$el:o=e;return o}function Zz(){if(!Ar)return kn(!1);const{ssr:e}=_l();if(e){const t=kn(!1);return ms(()=>{t.value=!0}),t}else return kn(!0)}const FT=At({eager:Boolean},"lazy");function VT(e,t){const o=kn(!1),c=Se(()=>o.value||e.eager||t.value);On(t,()=>o.value=!0);function d(){e.eager||(o.value=!1)}return{isBooted:o,hasContent:c,onAfterLeave:d}}function Ud(){const t=Lo("useScopeId").vnode.scopeId;return{scopeId:t?{[t]:""}:void 0}}const yk=Symbol.for("vuetify:stack"),Eg=Ls([]);function tX(e,t,o){const c=Lo("useStack"),d=!o,v=Mi(yk,void 0),y=Ls({activeChildren:new Set});Vr(yk,y);const T=kn(+t.value);za(e,()=>{var B;const L=(B=Eg.at(-1))==null?void 0:B[1];T.value=L?L+10:+t.value,d&&Eg.push([c.uid,T.value]),v==null||v.activeChildren.add(c.uid),Ys(()=>{if(d){const U=ui(Eg).findIndex($=>$[0]===c.uid);Eg.splice(U,1)}v==null||v.activeChildren.delete(c.uid)})});const r=kn(!0);d&&Oo(()=>{var B;const L=((B=Eg.at(-1))==null?void 0:B[0])===c.uid;setTimeout(()=>r.value=L)});const D=Se(()=>!y.activeChildren.size);return{globalTop:zp(r),localTop:D,stackStyles:Se(()=>({zIndex:T.value}))}}function nX(e){return{teleportTarget:Se(()=>{const o=e();if(o===!0||!Ar)return;const c=o===!1?document.body:typeof o=="string"?document.querySelector(o):o;if(c==null)return;let d=c.querySelector(":scope > .v-overlay-container");return d||(d=document.createElement("div"),d.className="v-overlay-container",c.appendChild(d)),d})}}function iX(){return!0}function Xz(e,t,o){if(!e||Yz(e,o)===!1)return!1;const c=BL(t);if(typeof ShadowRoot<"u"&&c instanceof ShadowRoot&&c.host===e.target)return!1;const d=(typeof o.value=="object"&&o.value.include||(()=>[]))();return d.push(t),!d.some(v=>v==null?void 0:v.contains(e.target))}function Yz(e,t){return(typeof t.value=="object"&&t.value.closeConditional||iX)(e)}function rX(e,t,o){const c=typeof o.value=="function"?o.value:o.value.handler;t._clickOutside.lastMousedownWasOutside&&Xz(e,t,o)&&setTimeout(()=>{Yz(e,o)&&c&&c(e)},0)}function bk(e,t){const o=BL(e);t(document),typeof ShadowRoot<"u"&&o instanceof ShadowRoot&&t(o)}const Kz={mounted(e,t){const o=d=>rX(d,e,t),c=d=>{e._clickOutside.lastMousedownWasOutside=Xz(d,e,t)};bk(e,d=>{d.addEventListener("click",o,!0),d.addEventListener("mousedown",c,!0)}),e._clickOutside||(e._clickOutside={lastMousedownWasOutside:!1}),e._clickOutside[t.instance.$.uid]={onClick:o,onMousedown:c}},unmounted(e,t){e._clickOutside&&(bk(e,o=>{var v;if(!o||!((v=e._clickOutside)!=null&&v[t.instance.$.uid]))return;const{onClick:c,onMousedown:d}=e._clickOutside[t.instance.$.uid];o.removeEventListener("click",c,!0),o.removeEventListener("mousedown",d,!0)}),delete e._clickOutside[t.instance.$.uid])}};function oX(e){const{modelValue:t,color:o,...c}=e;return Z(Nl,{name:"fade-transition",appear:!0},{default:()=>[e.modelValue&&Z("div",fn({class:["v-overlay__scrim",e.color.backgroundColorClasses.value],style:e.color.backgroundColorStyles.value},c),null)]})}const R_=At({absolute:Boolean,attach:[Boolean,String,Object],closeOnBack:{type:Boolean,default:!0},contained:Boolean,contentClass:null,contentProps:null,disabled:Boolean,opacity:[Number,String],noClickAnimation:Boolean,modelValue:Boolean,persistent:Boolean,scrim:{type:[Boolean,String],default:!0},zIndex:{type:[Number,String],default:2e3},...JZ(),...Nn(),...Ko(),...FT(),...UZ(),...WZ(),...Ji(),...Wl()},"VOverlay"),vc=Jt()({name:"VOverlay",directives:{ClickOutside:Kz},inheritAttrs:!1,props:{_disableGlobalStack:Boolean,...R_()},emits:{"click:outside":e=>!0,"update:modelValue":e=>!0,afterEnter:()=>!0,afterLeave:()=>!0},setup(e,t){let{slots:o,attrs:c,emit:d}=t;const v=ei(e,"modelValue"),y=Se({get:()=>v.value,set:ht=>{ht&&e.disabled||(v.value=ht)}}),{themeClasses:T}=xr(e),{rtlClasses:r,isRtl:D}=gs(),{hasContent:L,onAfterLeave:B}=VT(e,y),U=Nr(Se(()=>typeof e.scrim=="string"?e.scrim:null)),{globalTop:$,localTop:W,stackStyles:q}=tX(y,Ht(e,"zIndex"),e._disableGlobalStack),{activatorEl:ne,activatorRef:ce,target:oe,targetEl:fe,targetRef:be,activatorEvents:ge,contentEvents:Ee,scrimEvents:de}=QZ(e,{isActive:y,isTop:W}),{teleportTarget:re}=nX(()=>{var et;const ht=e.attach||e.contained;if(ht)return ht;const gt=(et=ne==null?void 0:ne.value)==null?void 0:et.getRootNode();return gt instanceof ShadowRoot?gt:!1}),{dimensionStyles:Y}=Jo(e),ie=Zz(),{scopeId:te}=Ud();On(()=>e.disabled,ht=>{ht&&(y.value=!1)});const ae=rn(),pe=rn(),Le=rn(),{contentStyles:tt,updateLocation:Je}=jZ(e,{isRtl:D,contentEl:Le,target:oe,isActive:y});ZZ(e,{root:ae,contentEl:Le,targetEl:fe,isActive:y,updateLocation:Je});function Mt(ht){d("click:outside",ht),e.persistent?Ft():y.value=!1}function Lt(ht){return y.value&&$.value&&(!e.scrim||ht.target===pe.value)}Ar&&On(y,ht=>{ht?window.addEventListener("keydown",yt):window.removeEventListener("keydown",yt)},{immediate:!0}),Ts(()=>{Ar&&window.removeEventListener("keydown",yt)});function yt(ht){var gt,et;ht.key==="Escape"&&$.value&&(e.persistent?Ft():(y.value=!1,(gt=Le.value)!=null&&gt.contains(document.activeElement)&&((et=ne.value)==null||et.focus())))}const rt=cz();za(()=>e.closeOnBack,()=>{NW(rt,ht=>{$.value&&y.value?(ht(!1),e.persistent?Ft():y.value=!1):ht()})});const mt=rn();On(()=>y.value&&(e.absolute||e.contained)&&re.value==null,ht=>{if(ht){const gt=bT(ae.value);gt&&gt!==document.scrollingElement&&(mt.value=gt.scrollTop)}});function Ft(){e.noClickAnimation||Le.value&&ud(Le.value,[{transformOrigin:"center"},{transform:"scale(1.03)"},{transformOrigin:"center"}],{duration:150,easing:t_})}function bn(){d("afterEnter")}function Bt(){B(),d("afterLeave")}return cn(()=>{var ht;return Z(Gn,null,[(ht=o.activator)==null?void 0:ht.call(o,{isActive:y.value,targetRef:be,props:fn({ref:ce},ge.value,e.activatorProps)}),ie.value&&L.value&&Z(ZN,{disabled:!re.value,to:re.value},{default:()=>[Z("div",fn({class:["v-overlay",{"v-overlay--absolute":e.absolute||e.contained,"v-overlay--active":y.value,"v-overlay--contained":e.contained},T.value,r.value,e.class],style:[q.value,{"--v-overlay-opacity":e.opacity,top:Bn(mt.value)},e.style],ref:ae},te,c),[Z(oX,fn({color:U,modelValue:y.value&&!!e.scrim,ref:pe},de.value),null),Z(Xs,{appear:!0,persisted:!0,transition:e.transition,target:oe.value,onAfterEnter:bn,onAfterLeave:Bt},{default:()=>{var gt;return[lr(Z("div",fn({ref:Le,class:["v-overlay__content",e.contentClass],style:[Y.value,tt.value]},Ee.value,e.contentProps),[(gt=o.default)==null?void 0:gt.call(o,{isActive:y})]),[[Hl,y.value],[Ya("click-outside"),{handler:Mt,closeConditional:Lt,include:()=>[ne.value]}]])]}})])]})])}),{activatorEl:ne,scrimEl:pe,target:oe,animateClick:Ft,contentEl:Le,globalTop:$,localTop:W,updateLocation:Je}}}),H1=Symbol("Forwarded refs");function q1(e,t){let o=e;for(;o;){const c=Reflect.getOwnPropertyDescriptor(o,t);if(c)return c;o=Object.getPrototypeOf(o)}}function yl(e){for(var t=arguments.length,o=new Array(t>1?t-1:0),c=1;c<t;c++)o[c-1]=arguments[c];return e[H1]=o,new Proxy(e,{get(d,v){if(Reflect.has(d,v))return Reflect.get(d,v);if(!(typeof v=="symbol"||v.startsWith("$")||v.startsWith("__"))){for(const y of o)if(y.value&&Reflect.has(y.value,v)){const T=Reflect.get(y.value,v);return typeof T=="function"?T.bind(y.value):T}}},has(d,v){if(Reflect.has(d,v))return!0;if(typeof v=="symbol"||v.startsWith("$")||v.startsWith("__"))return!1;for(const y of o)if(y.value&&Reflect.has(y.value,v))return!0;return!1},set(d,v,y){if(Reflect.has(d,v))return Reflect.set(d,v,y);if(typeof v=="symbol"||v.startsWith("$")||v.startsWith("__"))return!1;for(const T of o)if(T.value&&Reflect.has(T.value,v))return Reflect.set(T.value,v,y);return!1},getOwnPropertyDescriptor(d,v){var T;const y=Reflect.getOwnPropertyDescriptor(d,v);if(y)return y;if(!(typeof v=="symbol"||v.startsWith("$")||v.startsWith("__"))){for(const r of o){if(!r.value)continue;const D=q1(r.value,v)??("_"in r.value?q1((T=r.value._)==null?void 0:T.setupState,v):void 0);if(D)return D}for(const r of o){const D=r.value&&r.value[H1];if(!D)continue;const L=D.slice();for(;L.length;){const B=L.shift(),U=q1(B.value,v);if(U)return U;const $=B.value&&B.value[H1];$&&L.push(...$)}}}}})}const Jz=At({id:String,...Yo(R_({closeDelay:250,closeOnContentClick:!0,locationStrategy:"connected",openDelay:300,scrim:!1,scrollStrategy:"reposition",transition:{component:K0}}),["absolute"])},"VMenu"),Lp=Jt()({name:"VMenu",props:Jz(),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:o}=t;const c=ei(e,"modelValue"),{scopeId:d}=Ud(),v=Es(),y=Se(()=>e.id||`v-menu-${v}`),T=rn(),r=Mi(qw,null),D=kn(new Set);Vr(qw,{register(){D.value.add(v)},unregister(){D.value.delete(v)},closeParents(q){setTimeout(()=>{!D.value.size&&!e.persistent&&(q==null||q&&!_q(q,T.value.contentEl))&&(c.value=!1,r==null||r.closeParents())},40)}}),Ts(()=>r==null?void 0:r.unregister()),SS(()=>c.value=!1);async function L(q){var oe,fe,be;const ne=q.relatedTarget,ce=q.target;await Ki(),c.value&&ne!==ce&&((oe=T.value)!=null&&oe.contentEl)&&((fe=T.value)!=null&&fe.globalTop)&&![document,T.value.contentEl].includes(ce)&&!T.value.contentEl.contains(ce)&&((be=e_(T.value.contentEl)[0])==null||be.focus())}On(c,q=>{q?(r==null||r.register(),document.addEventListener("focusin",L,{once:!0})):(r==null||r.unregister(),document.removeEventListener("focusin",L))});function B(q){r==null||r.closeParents(q)}function U(q){var ne,ce,oe;if(!e.disabled)if(q.key==="Tab"||q.key==="Enter"&&!e.closeOnContentClick){if(q.key==="Enter"&&(q.target instanceof HTMLTextAreaElement||q.target instanceof HTMLInputElement&&q.target.closest("form")))return;q.key==="Enter"&&q.preventDefault(),xL(e_((ne=T.value)==null?void 0:ne.contentEl,!1),q.shiftKey?"prev":"next",be=>be.tabIndex>=0)||(c.value=!1,(oe=(ce=T.value)==null?void 0:ce.activatorEl)==null||oe.focus())}else["Enter"," "].includes(q.key)&&e.closeOnContentClick&&(c.value=!1,r==null||r.closeParents())}function $(q){var ce;if(e.disabled)return;const ne=(ce=T.value)==null?void 0:ce.contentEl;ne&&c.value?q.key==="ArrowDown"?(q.preventDefault(),Mp(ne,"next")):q.key==="ArrowUp"&&(q.preventDefault(),Mp(ne,"prev")):["ArrowDown","ArrowUp"].includes(q.key)&&(c.value=!0,q.preventDefault(),setTimeout(()=>setTimeout(()=>$(q))))}const W=Se(()=>fn({"aria-haspopup":"menu","aria-expanded":String(c.value),"aria-owns":y.value,onKeydown:$},e.activatorProps));return cn(()=>{const q=vc.filterProps(e);return Z(vc,fn({ref:T,id:y.value,class:["v-menu",e.class],style:e.style},q,{modelValue:c.value,"onUpdate:modelValue":ne=>c.value=ne,absolute:!0,activatorProps:W.value,"onClick:outside":B,onKeydown:U},d),{activator:o.activator,default:function(){for(var ne=arguments.length,ce=new Array(ne),oe=0;oe<ne;oe++)ce[oe]=arguments[oe];return Z(Li,{root:"VMenu"},{default:()=>{var fe;return[(fe=o.default)==null?void 0:fe.call(o,...ce)]}})}})}),yl({id:y,openChildren:D},T)}}),sX=At({active:Boolean,disabled:Boolean,max:[Number,String],value:{type:[Number,String],default:0},...Nn(),...Wl({transition:{component:CT}})},"VCounter"),sb=Jt()({name:"VCounter",functional:!0,props:sX(),setup(e,t){let{slots:o}=t;const c=Se(()=>e.max?`${e.value} / ${e.max}`:String(e.value));return cn(()=>Z(Xs,{transition:e.transition},{default:()=>[lr(Z("div",{class:["v-counter",{"text-error":e.max&&!e.disabled&&parseFloat(e.value)>parseFloat(e.max)},e.class],style:e.style},[o.default?o.default({counter:c.value,max:e.max,value:e.value}):c.value]),[[Hl,e.active]])]})),{}}}),aX=At({floating:Boolean,...Nn()},"VFieldLabel"),Pg=Jt()({name:"VFieldLabel",props:aX(),setup(e,t){let{slots:o}=t;return cn(()=>Z(Gp,{class:["v-field-label",{"v-field-label--floating":e.floating},e.class],style:e.style,"aria-hidden":e.floating||void 0},o)),{}}}),lX=["underlined","outlined","filled","solo","solo-inverted","solo-filled","plain"],D_=At({appendInnerIcon:mi,bgColor:String,clearable:Boolean,clearIcon:{type:mi,default:"$clear"},active:Boolean,centerAffix:{type:Boolean,default:void 0},color:String,baseColor:String,dirty:Boolean,disabled:{type:Boolean,default:null},error:Boolean,flat:Boolean,label:String,persistentClear:Boolean,prependInnerIcon:mi,reverse:Boolean,singleLine:Boolean,variant:{type:String,default:"filled",validator:e=>lX.includes(e)},"onClick:clear":Ss(),"onClick:appendInner":Ss(),"onClick:prependInner":Ss(),...Nn(),...tb(),...co(),...Ji()},"VField"),qp=Jt()({name:"VField",inheritAttrs:!1,props:{id:String,...M_(),...D_()},emits:{"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,t){let{attrs:o,emit:c,slots:d}=t;const{themeClasses:v}=xr(e),{loaderClasses:y}=I_(e),{focusClasses:T,isFocused:r,focus:D,blur:L}=ou(e),{InputIcon:B}=wz(e),{roundedClasses:U}=So(e),{rtlClasses:$}=gs(),W=Se(()=>e.dirty||e.active),q=Se(()=>!e.singleLine&&!!(e.label||d.label)),ne=Es(),ce=Se(()=>e.id||`input-${ne}`),oe=Se(()=>`${ce.value}-messages`),fe=rn(),be=rn(),ge=rn(),Ee=Se(()=>["plain","underlined"].includes(e.variant)),{backgroundColorClasses:de,backgroundColorStyles:re}=Nr(Ht(e,"bgColor")),{textColorClasses:Y,textColorStyles:ie}=Fs(Se(()=>e.error||e.disabled?void 0:W.value&&r.value?e.color:e.baseColor));On(W,Le=>{if(q.value){const tt=fe.value.$el,Je=be.value.$el;requestAnimationFrame(()=>{const Mt=gT(tt),Lt=Je.getBoundingClientRect(),yt=Lt.x-Mt.x,rt=Lt.y-Mt.y-(Mt.height/2-Lt.height/2),mt=Lt.width/.75,Ft=Math.abs(mt-Mt.width)>1?{maxWidth:Bn(mt)}:void 0,bn=getComputedStyle(tt),Bt=getComputedStyle(Je),ht=parseFloat(bn.transitionDuration)*1e3||150,gt=parseFloat(Bt.getPropertyValue("--v-field-label-scale")),et=Bt.getPropertyValue("color");tt.style.visibility="visible",Je.style.visibility="hidden",ud(tt,{transform:`translate(${yt}px, ${rt}px) scale(${gt})`,color:et,...Ft},{duration:ht,easing:t_,direction:Le?"normal":"reverse"}).finished.then(()=>{tt.style.removeProperty("visibility"),Je.style.removeProperty("visibility")})})}},{flush:"post"});const te=Se(()=>({isActive:W,isFocused:r,controlRef:ge,blur:L,focus:D}));function ae(Le){Le.target!==document.activeElement&&Le.preventDefault()}function pe(Le){var tt;Le.key!=="Enter"&&Le.key!==" "||(Le.preventDefault(),Le.stopPropagation(),(tt=e["onClick:clear"])==null||tt.call(e,new MouseEvent("click")))}return cn(()=>{var yt,rt,mt;const Le=e.variant==="outlined",tt=!!(d["prepend-inner"]||e.prependInnerIcon),Je=!!(e.clearable||d.clear),Mt=!!(d["append-inner"]||e.appendInnerIcon||Je),Lt=()=>d.label?d.label({...te.value,label:e.label,props:{for:ce.value}}):e.label;return Z("div",fn({class:["v-field",{"v-field--active":W.value,"v-field--appended":Mt,"v-field--center-affix":e.centerAffix??!Ee.value,"v-field--disabled":e.disabled,"v-field--dirty":e.dirty,"v-field--error":e.error,"v-field--flat":e.flat,"v-field--has-background":!!e.bgColor,"v-field--persistent-clear":e.persistentClear,"v-field--prepended":tt,"v-field--reverse":e.reverse,"v-field--single-line":e.singleLine,"v-field--no-label":!Lt(),[`v-field--variant-${e.variant}`]:!0},v.value,de.value,T.value,y.value,U.value,$.value,e.class],style:[re.value,e.style],onClick:ae},o),[Z("div",{class:"v-field__overlay"},null),Z(C_,{name:"v-field",active:!!e.loading,color:e.error?"error":typeof e.loading=="string"?e.loading:e.color},{default:d.loader}),tt&&Z("div",{key:"prepend",class:"v-field__prepend-inner"},[e.prependInnerIcon&&Z(B,{key:"prepend-icon",name:"prependInner"},null),(yt=d["prepend-inner"])==null?void 0:yt.call(d,te.value)]),Z("div",{class:"v-field__field","data-no-activator":""},[["filled","solo","solo-inverted","solo-filled"].includes(e.variant)&&q.value&&Z(Pg,{key:"floating-label",ref:be,class:[Y.value],floating:!0,for:ce.value,style:ie.value},{default:()=>[Lt()]}),Z(Pg,{ref:fe,for:ce.value},{default:()=>[Lt()]}),(rt=d.default)==null?void 0:rt.call(d,{...te.value,props:{id:ce.value,class:"v-field__input","aria-describedby":oe.value},focus:D,blur:L})]),Je&&Z(AT,{key:"clear"},{default:()=>[lr(Z("div",{class:"v-field__clearable",onMousedown:Ft=>{Ft.preventDefault(),Ft.stopPropagation()}},[Z(Li,{defaults:{VIcon:{icon:e.clearIcon}}},{default:()=>[d.clear?d.clear({...te.value,props:{onKeydown:pe,onFocus:D,onBlur:L,onClick:e["onClick:clear"]}}):Z(B,{name:"clear",onKeydown:pe,onFocus:D,onBlur:L},null)]})]),[[Hl,e.dirty]])]}),Mt&&Z("div",{key:"append",class:"v-field__append-inner"},[(mt=d["append-inner"])==null?void 0:mt.call(d,te.value),e.appendInnerIcon&&Z(B,{key:"append-icon",name:"appendInner"},null)]),Z("div",{class:["v-field__outline",Y.value],style:ie.value},[Le&&Z(Gn,null,[Z("div",{class:"v-field__outline__start"},null),q.value&&Z("div",{class:"v-field__outline__notch"},[Z(Pg,{ref:be,floating:!0,for:ce.value},{default:()=>[Lt()]})]),Z("div",{class:"v-field__outline__end"},null)]),Ee.value&&q.value&&Z(Pg,{ref:be,floating:!0,for:ce.value},{default:()=>[Lt()]})])])}),{controlRef:ge}}});function NT(e){const t=Object.keys(qp.props).filter(o=>!H0(o)&&o!=="class"&&o!=="style");return fT(e,t)}const cX=["color","file","time","date","datetime-local","week","month"],ab=At({autofocus:Boolean,counter:[Boolean,Number,String],counterValue:[Number,Function],prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,suffix:String,role:String,type:{type:String,default:"text"},modelModifiers:Object,...su(),...D_()},"VTextField"),xd=Jt()({name:"VTextField",directives:{Intersect:E_},inheritAttrs:!1,props:ab(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,t){let{attrs:o,emit:c,slots:d}=t;const v=ei(e,"modelValue"),{isFocused:y,focus:T,blur:r}=ou(e),D=Se(()=>typeof e.counterValue=="function"?e.counterValue(v.value):typeof e.counterValue=="number"?e.counterValue:(v.value??"").toString().length),L=Se(()=>{if(o.maxlength)return o.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter}),B=Se(()=>["plain","underlined"].includes(e.variant));function U(Ee,de){var re,Y;!e.autofocus||!Ee||(Y=(re=de[0].target)==null?void 0:re.focus)==null||Y.call(re)}const $=rn(),W=rn(),q=rn(),ne=Se(()=>cX.includes(e.type)||e.persistentPlaceholder||y.value||e.active);function ce(){var Ee;q.value!==document.activeElement&&((Ee=q.value)==null||Ee.focus()),y.value||T()}function oe(Ee){c("mousedown:control",Ee),Ee.target!==q.value&&(ce(),Ee.preventDefault())}function fe(Ee){ce(),c("click:control",Ee)}function be(Ee){Ee.stopPropagation(),ce(),Ki(()=>{v.value=null,mT(e["onClick:clear"],Ee)})}function ge(Ee){var re;const de=Ee.target;if(v.value=de.value,(re=e.modelModifiers)!=null&&re.trim&&["text","search","password","tel","url"].includes(e.type)){const Y=[de.selectionStart,de.selectionEnd];Ki(()=>{de.selectionStart=Y[0],de.selectionEnd=Y[1]})}}return cn(()=>{const Ee=!!(d.counter||e.counter!==!1&&e.counter!=null),de=!!(Ee||d.details),[re,Y]=ph(o),{modelValue:ie,...te}=Vs.filterProps(e),ae=NT(e);return Z(Vs,fn({ref:$,modelValue:v.value,"onUpdate:modelValue":pe=>v.value=pe,class:["v-text-field",{"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-input--plain-underlined":B.value},e.class],style:e.style},re,te,{centerAffix:!B.value,focused:y.value}),{...d,default:pe=>{let{id:Le,isDisabled:tt,isDirty:Je,isReadonly:Mt,isValid:Lt}=pe;return Z(qp,fn({ref:W,onMousedown:oe,onClick:fe,"onClick:clear":be,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"],role:e.role},ae,{id:Le.value,active:ne.value||Je.value,dirty:Je.value||e.dirty,disabled:tt.value,focused:y.value,error:Lt.value===!1}),{...d,default:yt=>{let{props:{class:rt,...mt}}=yt;const Ft=lr(Z("input",fn({ref:q,value:v.value,onInput:ge,autofocus:e.autofocus,readonly:Mt.value,disabled:tt.value,name:e.name,placeholder:e.placeholder,size:1,type:e.type,onFocus:ce,onBlur:r},mt,Y),null),[[Ya("intersect"),{handler:U},null,{once:!0}]]);return Z(Gn,null,[e.prefix&&Z("span",{class:"v-text-field__prefix"},[Z("span",{class:"v-text-field__prefix__text"},[e.prefix])]),d.default?Z("div",{class:rt,"data-no-activator":""},[d.default(),Ft]):Xc(Ft,{class:rt}),e.suffix&&Z("span",{class:"v-text-field__suffix"},[Z("span",{class:"v-text-field__suffix__text"},[e.suffix])])])}})},details:de?pe=>{var Le;return Z(Gn,null,[(Le=d.details)==null?void 0:Le.call(d,pe),Ee&&Z(Gn,null,[Z("span",null,null),Z(sb,{active:e.persistentCounter||y.value,value:D.value,max:L.value,disabled:e.disabled},d.counter)])])}:void 0})}),yl({},$,W,q)}}),uX=At({renderless:Boolean,...Nn()},"VVirtualScrollItem"),Qz=Jt()({name:"VVirtualScrollItem",inheritAttrs:!1,props:uX(),emits:{"update:height":e=>!0},setup(e,t){let{attrs:o,emit:c,slots:d}=t;const{resizeRef:v,contentRect:y}=$l(void 0,"border");On(()=>{var T;return(T=y.value)==null?void 0:T.height},T=>{T!=null&&c("update:height",T)}),cn(()=>{var T,r;return e.renderless?Z(Gn,null,[(T=d.default)==null?void 0:T.call(d,{itemRef:v})]):Z("div",fn({ref:v,class:["v-virtual-scroll__item",e.class],style:e.style},o),[(r=d.default)==null?void 0:r.call(d)])})}}),hX=-1,dX=1,W1=100,eB=At({itemHeight:{type:[Number,String],default:null},height:[Number,String]},"virtual");function tB(e,t){const o=_l(),c=kn(0);Oo(()=>{c.value=parseFloat(e.itemHeight||0)});const d=kn(0),v=kn(Math.ceil((parseInt(e.height)||o.height.value)/(c.value||16))||1),y=kn(0),T=kn(0),r=rn(),D=rn();let L=0;const{resizeRef:B,contentRect:U}=$l();Oo(()=>{B.value=r.value});const $=Se(()=>{var yt;return r.value===document.documentElement?o.height.value:((yt=U.value)==null?void 0:yt.height)||parseInt(e.height)||0}),W=Se(()=>!!(r.value&&D.value&&$.value&&c.value));let q=Array.from({length:t.value.length}),ne=Array.from({length:t.value.length});const ce=kn(0);let oe=-1;function fe(yt){return q[yt]||c.value}const be=dq(()=>{const yt=performance.now();ne[0]=0;const rt=t.value.length;for(let mt=1;mt<=rt-1;mt++)ne[mt]=(ne[mt-1]||0)+fe(mt-1);ce.value=Math.max(ce.value,performance.now()-yt)},ce),ge=On(W,yt=>{yt&&(ge(),L=D.value.offsetTop,be.immediate(),tt(),~oe&&Ki(()=>{Ar&&window.requestAnimationFrame(()=>{Mt(oe),oe=-1})}))});Ys(()=>{be.clear()});function Ee(yt,rt){const mt=q[yt],Ft=c.value;c.value=Ft?Math.min(c.value,rt):rt,(mt!==rt||Ft!==c.value)&&(q[yt]=rt,be())}function de(yt){return yt=Go(yt,0,t.value.length-1),ne[yt]||0}function re(yt){return fX(ne,yt)}let Y=0,ie=0,te=0;On($,(yt,rt)=>{rt&&(tt(),yt<rt&&requestAnimationFrame(()=>{ie=0,tt()}))});function ae(){if(!r.value||!D.value)return;const yt=r.value.scrollTop,rt=performance.now();rt-te>500?(ie=Math.sign(yt-Y),L=D.value.offsetTop):ie=yt-Y,Y=yt,te=rt,tt()}function pe(){!r.value||!D.value||(ie=0,te=0,tt())}let Le=-1;function tt(){cancelAnimationFrame(Le),Le=requestAnimationFrame(Je)}function Je(){if(!r.value||!$.value)return;const yt=Y-L,rt=Math.sign(ie),mt=Math.max(0,yt-W1),Ft=Go(re(mt),0,t.value.length),bn=yt+$.value+W1,Bt=Go(re(bn)+1,Ft+1,t.value.length);if((rt!==hX||Ft<d.value)&&(rt!==dX||Bt>v.value)){const ht=de(d.value)-de(Ft),gt=de(Bt)-de(v.value);Math.max(ht,gt)>W1?(d.value=Ft,v.value=Bt):(Ft<=0&&(d.value=Ft),Bt>=t.value.length&&(v.value=Bt))}y.value=de(d.value),T.value=de(t.value.length)-de(v.value)}function Mt(yt){const rt=de(yt);!r.value||yt&&!rt?oe=yt:r.value.scrollTop=rt}const Lt=Se(()=>t.value.slice(d.value,v.value).map((yt,rt)=>({raw:yt,index:rt+d.value})));return On(t,()=>{q=Array.from({length:t.value.length}),ne=Array.from({length:t.value.length}),be.immediate(),tt()},{deep:!0}),{calculateVisibleItems:tt,containerRef:r,markerRef:D,computedItems:Lt,paddingTop:y,paddingBottom:T,scrollToIndex:Mt,handleScroll:ae,handleScrollend:pe,handleItemResize:Ee}}function fX(e,t){let o=e.length-1,c=0,d=0,v=null,y=-1;if(e[o]<t)return o;for(;c<=o;)if(d=c+o>>1,v=e[d],v>t)o=d-1;else if(v<t)y=d,c=d+1;else return v===t?d:c;return y}const pX=At({items:{type:Array,default:()=>[]},renderless:Boolean,...eB(),...Nn(),...Ko()},"VVirtualScroll"),lb=Jt()({name:"VVirtualScroll",props:pX(),setup(e,t){let{slots:o}=t;const c=Lo("VVirtualScroll"),{dimensionStyles:d}=Jo(e),{calculateVisibleItems:v,containerRef:y,markerRef:T,handleScroll:r,handleScrollend:D,handleItemResize:L,scrollToIndex:B,paddingTop:U,paddingBottom:$,computedItems:W}=tB(e,Ht(e,"items"));return za(()=>e.renderless,()=>{function q(){var oe,fe;const ce=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1)?"addEventListener":"removeEventListener";y.value===document.documentElement?(document[ce]("scroll",r,{passive:!0}),document[ce]("scrollend",D)):((oe=y.value)==null||oe[ce]("scroll",r,{passive:!0}),(fe=y.value)==null||fe[ce]("scrollend",D))}ms(()=>{y.value=bT(c.vnode.el,!0),q(!0)}),Ys(q)}),cn(()=>{const q=W.value.map(ne=>Z(Qz,{key:ne.index,renderless:e.renderless,"onUpdate:height":ce=>L(ne.index,ce)},{default:ce=>{var oe;return(oe=o.default)==null?void 0:oe.call(o,{item:ne.raw,index:ne.index,...ce})}}));return e.renderless?Z(Gn,null,[Z("div",{ref:T,class:"v-virtual-scroll__spacer",style:{paddingTop:Bn(U.value)}},null),q,Z("div",{class:"v-virtual-scroll__spacer",style:{paddingBottom:Bn($.value)}},null)]):Z("div",{ref:y,class:["v-virtual-scroll",e.class],onScrollPassive:r,onScrollend:D,style:[d.value,e.style]},[Z("div",{ref:T,class:"v-virtual-scroll__container",style:{paddingTop:Bn(U.value),paddingBottom:Bn($.value)}},[q])])}),{calculateVisibleItems:v,scrollToIndex:B}}});function UT(e,t){const o=kn(!1);let c;function d(T){cancelAnimationFrame(c),o.value=!0,c=requestAnimationFrame(()=>{c=requestAnimationFrame(()=>{o.value=!1})})}async function v(){await new Promise(T=>requestAnimationFrame(T)),await new Promise(T=>requestAnimationFrame(T)),await new Promise(T=>requestAnimationFrame(T)),await new Promise(T=>{if(o.value){const r=On(o,()=>{r(),T()})}else T()})}async function y(T){var L,B;if(T.key==="Tab"&&((L=t.value)==null||L.focus()),!["PageDown","PageUp","Home","End"].includes(T.key))return;const r=(B=e.value)==null?void 0:B.$el;if(!r)return;(T.key==="Home"||T.key==="End")&&r.scrollTo({top:T.key==="Home"?0:r.scrollHeight,behavior:"smooth"}),await v();const D=r.querySelectorAll(":scope > :not(.v-virtual-scroll__spacer)");if(T.key==="PageDown"||T.key==="Home"){const U=r.getBoundingClientRect().top;for(const $ of D)if($.getBoundingClientRect().top>=U){$.focus();break}}else{const U=r.getBoundingClientRect().bottom;for(const $ of[...D].reverse())if($.getBoundingClientRect().bottom<=U){$.focus();break}}}return{onScrollPassive:d,onKeydown:y}}const jT=At({chips:Boolean,closableChips:Boolean,closeText:{type:String,default:"$vuetify.close"},openText:{type:String,default:"$vuetify.open"},eager:Boolean,hideNoData:Boolean,hideSelected:Boolean,listProps:{type:Object},menu:Boolean,menuIcon:{type:mi,default:"$dropdown"},menuProps:{type:Object},multiple:Boolean,noDataText:{type:String,default:"$vuetify.noDataText"},openOnClear:Boolean,itemColor:String,...jz({itemChildren:!1})},"Select"),mX=At({...jT(),...Yo(ab({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...Wl({transition:{component:K0}})},"VSelect"),$T=Jt()({name:"VSelect",props:mX(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,t){let{slots:o}=t;const{t:c}=zo(),d=rn(),v=rn(),y=rn(),T=ei(e,"menu"),r=Se({get:()=>T.value,set:yt=>{var rt;T.value&&!yt&&((rt=v.value)!=null&&rt.openChildren.size)||(T.value=yt)}}),{items:D,transformIn:L,transformOut:B}=LT(e),U=ei(e,"modelValue",[],yt=>L(yt===null?[null]:go(yt)),yt=>{const rt=B(yt);return e.multiple?rt:rt[0]??null}),$=Se(()=>typeof e.counterValue=="function"?e.counterValue(U.value):typeof e.counterValue=="number"?e.counterValue:U.value.length),W=rb(),q=Se(()=>U.value.map(yt=>yt.value)),ne=kn(!1),ce=Se(()=>r.value?e.closeText:e.openText);let oe="",fe;const be=Se(()=>e.hideSelected?D.value.filter(yt=>!U.value.some(rt=>e.valueComparator(rt,yt))):D.value),ge=Se(()=>e.hideNoData&&!be.value.length||e.readonly||(W==null?void 0:W.isReadonly.value)),Ee=Se(()=>{var yt;return{...e.menuProps,activatorProps:{...((yt=e.menuProps)==null?void 0:yt.activatorProps)||{},"aria-haspopup":"listbox"}}}),de=rn(),re=UT(de,d);function Y(yt){e.openOnClear&&(r.value=!0)}function ie(){ge.value||(r.value=!r.value)}function te(yt){_0(yt)&&ae(yt)}function ae(yt){var bn,Bt;if(!yt.key||e.readonly||W!=null&&W.isReadonly.value)return;["Enter"," ","ArrowDown","ArrowUp","Home","End"].includes(yt.key)&&yt.preventDefault(),["Enter","ArrowDown"," "].includes(yt.key)&&(r.value=!0),["Escape","Tab"].includes(yt.key)&&(r.value=!1),yt.key==="Home"?(bn=de.value)==null||bn.focus("first"):yt.key==="End"&&((Bt=de.value)==null||Bt.focus("last"));const rt=1e3;if(e.multiple||!_0(yt))return;const mt=performance.now();mt-fe>rt&&(oe=""),oe+=yt.key.toLowerCase(),fe=mt;const Ft=D.value.find(ht=>ht.title.toLowerCase().startsWith(oe));if(Ft!==void 0){U.value=[Ft];const ht=be.value.indexOf(Ft);Ar&&window.requestAnimationFrame(()=>{var gt;ht>=0&&((gt=y.value)==null||gt.scrollToIndex(ht))})}}function pe(yt){let rt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!yt.props.disabled)if(e.multiple){const mt=U.value.findIndex(bn=>e.valueComparator(bn.value,yt.value)),Ft=rt??!~mt;if(~mt){const bn=Ft?[...U.value,yt]:[...U.value];bn.splice(mt,1),U.value=bn}else Ft&&(U.value=[...U.value,yt])}else{const mt=rt!==!1;U.value=mt?[yt]:[],Ki(()=>{r.value=!1})}}function Le(yt){var rt;(rt=de.value)!=null&&rt.$el.contains(yt.relatedTarget)||(r.value=!1)}function tt(){var yt;e.eager&&((yt=y.value)==null||yt.calculateVisibleItems())}function Je(){var yt;ne.value&&((yt=d.value)==null||yt.focus())}function Mt(yt){ne.value=!0}function Lt(yt){if(yt==null)U.value=[];else if(kp(d.value,":autofill")||kp(d.value,":-webkit-autofill")){const rt=D.value.find(mt=>mt.title===yt);rt&&pe(rt)}else d.value&&(d.value.value="")}return On(r,()=>{if(!e.hideSelected&&r.value&&U.value.length){const yt=be.value.findIndex(rt=>U.value.some(mt=>e.valueComparator(mt.value,rt.value)));Ar&&window.requestAnimationFrame(()=>{var rt;yt>=0&&((rt=y.value)==null||rt.scrollToIndex(yt))})}}),On(()=>e.items,(yt,rt)=>{r.value||ne.value&&!rt.length&&yt.length&&(r.value=!0)}),cn(()=>{const yt=!!(e.chips||o.chip),rt=!!(!e.hideNoData||be.value.length||o["prepend-item"]||o["append-item"]||o["no-data"]),mt=U.value.length>0,Ft=xd.filterProps(e),bn=mt||!ne.value&&e.label&&!e.persistentPlaceholder?void 0:e.placeholder;return Z(xd,fn({ref:d},Ft,{modelValue:U.value.map(Bt=>Bt.props.value).join(", "),"onUpdate:modelValue":Lt,focused:ne.value,"onUpdate:focused":Bt=>ne.value=Bt,validationValue:U.externalValue,counterValue:$.value,dirty:mt,class:["v-select",{"v-select--active-menu":r.value,"v-select--chips":!!e.chips,[`v-select--${e.multiple?"multiple":"single"}`]:!0,"v-select--selected":U.value.length,"v-select--selection-slot":!!o.selection},e.class],style:e.style,inputmode:"none",placeholder:bn,"onClick:clear":Y,"onMousedown:control":ie,onBlur:Le,onKeydown:ae,"aria-label":c(ce.value),title:c(ce.value)}),{...o,default:()=>Z(Gn,null,[Z(Lp,fn({ref:v,modelValue:r.value,"onUpdate:modelValue":Bt=>r.value=Bt,activator:"parent",contentClass:"v-select__content",disabled:ge.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterEnter:tt,onAfterLeave:Je},Ee.value),{default:()=>[rt&&Z(ob,fn({ref:de,selected:q.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:Bt=>Bt.preventDefault(),onKeydown:te,onFocusin:Mt,tabindex:"-1","aria-live":"polite",color:e.itemColor??e.color},re,e.listProps),{default:()=>{var Bt,ht,gt;return[(Bt=o["prepend-item"])==null?void 0:Bt.call(o),!be.value.length&&!e.hideNoData&&(((ht=o["no-data"])==null?void 0:ht.call(o))??Z(tu,{title:c(e.noDataText)},null)),Z(lb,{ref:y,renderless:!0,items:be.value},{default:et=>{var gn;let{item:Nt,index:St,itemRef:Xt}=et;const Ie=fn(Nt.props,{ref:Xt,key:St,onClick:()=>pe(Nt,null)});return((gn=o.item)==null?void 0:gn.call(o,{item:Nt,index:St,props:Ie}))??Z(tu,fn(Ie,{role:"option"}),{prepend:Ae=>{let{isSelected:Ne}=Ae;return Z(Gn,null,[e.multiple&&!e.hideSelected?Z(eu,{key:Nt.value,modelValue:Ne,ripple:!1,tabindex:"-1"},null):void 0,Nt.props.prependAvatar&&Z(ml,{image:Nt.props.prependAvatar},null),Nt.props.prependIcon&&Z(br,{icon:Nt.props.prependIcon},null)])}})}}),(gt=o["append-item"])==null?void 0:gt.call(o)]}})]}),U.value.map((Bt,ht)=>{function gt(Xt){Xt.stopPropagation(),Xt.preventDefault(),pe(Bt,!1)}const et={"onClick:close":gt,onKeydown(Xt){Xt.key!=="Enter"&&Xt.key!==" "||(Xt.preventDefault(),Xt.stopPropagation(),gt(Xt))},onMousedown(Xt){Xt.preventDefault(),Xt.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},Nt=yt?!!o.chip:!!o.selection,St=Nt?q0(yt?o.chip({item:Bt,index:ht,props:et}):o.selection({item:Bt,index:ht})):void 0;if(!(Nt&&!St))return Z("div",{key:Bt.value,class:"v-select__selection"},[yt?o.chip?Z(Li,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:Bt.title}}},{default:()=>[St]}):Z(Hp,fn({key:"chip",closable:e.closableChips,size:"small",text:Bt.title,disabled:Bt.props.disabled},et),null):St??Z("span",{class:"v-select__selection-text"},[Bt.title,e.multiple&&ht<U.value.length-1&&Z("span",{class:"v-select__selection-comma"},[$o(",")])])])})]),"append-inner":function(){var et;for(var Bt=arguments.length,ht=new Array(Bt),gt=0;gt<Bt;gt++)ht[gt]=arguments[gt];return Z(Gn,null,[(et=o["append-inner"])==null?void 0:et.call(o,...ht),e.menuIcon?Z(br,{class:"v-select__menu-icon",icon:e.menuIcon},null):void 0])}})}),yl({isFocused:ne,menu:r,select:pe},d)}}),gX=(e,t,o)=>e==null||t==null?-1:e.toString().toLocaleLowerCase().indexOf(t.toString().toLocaleLowerCase()),O_=At({customFilter:Function,customKeyFilter:Object,filterKeys:[Array,String],filterMode:{type:String,default:"intersection"},noFilter:Boolean},"filter");function _X(e,t,o){var T;const c=[],d=(o==null?void 0:o.default)??gX,v=o!=null&&o.filterKeys?go(o.filterKeys):!1,y=Object.keys((o==null?void 0:o.customKeyFilter)??{}).length;if(!(e!=null&&e.length))return c;e:for(let r=0;r<e.length;r++){const[D,L=D]=go(e[r]),B={},U={};let $=-1;if((t||y>0)&&!(o!=null&&o.noFilter)){if(typeof D=="object"){const ne=v||Object.keys(L);for(const ce of ne){const oe=as(L,ce),fe=(T=o==null?void 0:o.customKeyFilter)==null?void 0:T[ce];if($=fe?fe(oe,t,D):d(oe,t,D),$!==-1&&$!==!1)fe?B[ce]=$:U[ce]=$;else if((o==null?void 0:o.filterMode)==="every")continue e}}else $=d(D,t,D),$!==-1&&$!==!1&&(U.title=$);const W=Object.keys(U).length,q=Object.keys(B).length;if(!W&&!q||(o==null?void 0:o.filterMode)==="union"&&q!==y&&!W||(o==null?void 0:o.filterMode)==="intersection"&&(q!==y||!W))continue}c.push({index:r,matches:{...U,...B}})}return c}function L_(e,t,o,c){const d=rn([]),v=rn(new Map),y=Se(()=>c!=null&&c.transform?Zo(t).map(r=>[r,c.transform(r)]):Zo(t));Oo(()=>{const r=typeof o=="function"?o():Zo(o),D=typeof r!="string"&&typeof r!="number"?"":String(r),L=_X(y.value,D,{customKeyFilter:{...e.customKeyFilter,...Zo(c==null?void 0:c.customKeyFilter)},default:e.customFilter,filterKeys:e.filterKeys,filterMode:e.filterMode,noFilter:e.noFilter}),B=Zo(t),U=[],$=new Map;L.forEach(W=>{let{index:q,matches:ne}=W;const ce=B[q];U.push(ce),$.set(ce.value,ne)}),d.value=U,v.value=$});function T(r){return v.value.get(r.value)}return{filteredItems:d,filteredMatches:v,getMatches:T}}function vX(e,t,o){if(t==null)return e;if(Array.isArray(t))throw new Error("Multiple matches is not implemented");return typeof t=="number"&&~t?Z(Gn,null,[Z("span",{class:"v-autocomplete__unmask"},[e.substr(0,t)]),Z("span",{class:"v-autocomplete__mask"},[e.substr(t,o)]),Z("span",{class:"v-autocomplete__unmask"},[e.substr(t+o)])]):e}const yX=At({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:Boolean,search:String,...O_({filterKeys:["title"]}),...jT(),...Yo(ab({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...Wl({transition:!1})},"VAutocomplete"),bX=Jt()({name:"VAutocomplete",props:yX(),emits:{"update:focused":e=>!0,"update:search":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,t){let{slots:o}=t;const{t:c}=zo(),d=rn(),v=kn(!1),y=kn(!0),T=kn(!1),r=rn(),D=rn(),L=ei(e,"menu"),B=Se({get:()=>L.value,set:Ie=>{var gn;L.value&&!Ie&&((gn=r.value)!=null&&gn.openChildren.size)||(L.value=Ie)}}),U=kn(-1),$=Se(()=>{var Ie;return(Ie=d.value)==null?void 0:Ie.color}),W=Se(()=>B.value?e.closeText:e.openText),{items:q,transformIn:ne,transformOut:ce}=LT(e),{textColorClasses:oe,textColorStyles:fe}=Fs($),be=ei(e,"search",""),ge=ei(e,"modelValue",[],Ie=>ne(Ie===null?[null]:go(Ie)),Ie=>{const gn=ce(Ie);return e.multiple?gn:gn[0]??null}),Ee=Se(()=>typeof e.counterValue=="function"?e.counterValue(ge.value):typeof e.counterValue=="number"?e.counterValue:ge.value.length),de=rb(),{filteredItems:re,getMatches:Y}=L_(e,q,()=>y.value?"":be.value),ie=Se(()=>e.hideSelected?re.value.filter(Ie=>!ge.value.some(gn=>gn.value===Ie.value)):re.value),te=Se(()=>!!(e.chips||o.chip)),ae=Se(()=>te.value||!!o.selection),pe=Se(()=>ge.value.map(Ie=>Ie.props.value)),Le=Se(()=>{var gn;return(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&be.value===((gn=ie.value[0])==null?void 0:gn.title))&&ie.value.length>0&&!y.value&&!T.value}),tt=Se(()=>e.hideNoData&&!ie.value.length||e.readonly||(de==null?void 0:de.isReadonly.value)),Je=rn(),Mt=UT(Je,d);function Lt(Ie){e.openOnClear&&(B.value=!0),be.value=""}function yt(){tt.value||(B.value=!0)}function rt(Ie){tt.value||(v.value&&(Ie.preventDefault(),Ie.stopPropagation()),B.value=!B.value)}function mt(Ie){var gn;_0(Ie)&&((gn=d.value)==null||gn.focus())}function Ft(Ie){var Ne,Ue,Et;if(e.readonly||de!=null&&de.isReadonly.value)return;const gn=d.value.selectionStart,Ae=ge.value.length;if((U.value>-1||["Enter","ArrowDown","ArrowUp"].includes(Ie.key))&&Ie.preventDefault(),["Enter","ArrowDown"].includes(Ie.key)&&(B.value=!0),["Escape"].includes(Ie.key)&&(B.value=!1),Le.value&&["Enter","Tab"].includes(Ie.key)&&!ge.value.some(Ct=>{let{value:Qt}=Ct;return Qt===ie.value[0].value})&&Xt(ie.value[0]),Ie.key==="ArrowDown"&&Le.value&&((Ne=Je.value)==null||Ne.focus("next")),["Backspace","Delete"].includes(Ie.key)){if(!e.multiple&&ae.value&&ge.value.length>0&&!be.value)return Xt(ge.value[0],!1);if(~U.value){const Ct=U.value;Xt(ge.value[U.value],!1),U.value=Ct>=Ae-1?Ae-2:Ct}else Ie.key==="Backspace"&&!be.value&&(U.value=Ae-1)}if(e.multiple){if(Ie.key==="ArrowLeft"){if(U.value<0&&gn>0)return;const Ct=U.value>-1?U.value-1:Ae-1;ge.value[Ct]?U.value=Ct:(U.value=-1,d.value.setSelectionRange((Ue=be.value)==null?void 0:Ue.length,(Et=be.value)==null?void 0:Et.length))}if(Ie.key==="ArrowRight"){if(U.value<0)return;const Ct=U.value+1;ge.value[Ct]?U.value=Ct:(U.value=-1,d.value.setSelectionRange(0,0))}}}function bn(Ie){if(kp(d.value,":autofill")||kp(d.value,":-webkit-autofill")){const gn=q.value.find(Ae=>Ae.title===Ie.target.value);gn&&Xt(gn)}}function Bt(){var Ie;e.eager&&((Ie=D.value)==null||Ie.calculateVisibleItems())}function ht(){var Ie;v.value&&(y.value=!0,(Ie=d.value)==null||Ie.focus())}function gt(Ie){v.value=!0,setTimeout(()=>{T.value=!0})}function et(Ie){T.value=!1}function Nt(Ie){(Ie==null||Ie===""&&!e.multiple&&!ae.value)&&(ge.value=[])}const St=kn(!1);function Xt(Ie){let gn=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!Ie||Ie.props.disabled))if(e.multiple){const Ae=ge.value.findIndex(Ue=>e.valueComparator(Ue.value,Ie.value)),Ne=gn??!~Ae;if(~Ae){const Ue=Ne?[...ge.value,Ie]:[...ge.value];Ue.splice(Ae,1),ge.value=Ue}else Ne&&(ge.value=[...ge.value,Ie]);e.clearOnSelect&&(be.value="")}else{const Ae=gn!==!1;ge.value=Ae?[Ie]:[],be.value=Ae&&!ae.value?Ie.title:"",Ki(()=>{B.value=!1,y.value=!0})}}return On(v,(Ie,gn)=>{var Ae;Ie!==gn&&(Ie?(St.value=!0,be.value=e.multiple||ae.value?"":String(((Ae=ge.value.at(-1))==null?void 0:Ae.props.title)??""),y.value=!0,Ki(()=>St.value=!1)):(!e.multiple&&be.value==null&&(ge.value=[]),B.value=!1,ge.value.some(Ne=>{let{title:Ue}=Ne;return Ue===be.value})||(be.value=""),U.value=-1))}),On(be,Ie=>{!v.value||St.value||(Ie&&(B.value=!0),y.value=!Ie)}),On(B,()=>{if(!e.hideSelected&&B.value&&ge.value.length){const Ie=ie.value.findIndex(gn=>ge.value.some(Ae=>gn.value===Ae.value));Ar&&window.requestAnimationFrame(()=>{var gn;Ie>=0&&((gn=D.value)==null||gn.scrollToIndex(Ie))})}}),On(()=>e.items,(Ie,gn)=>{B.value||v.value&&!gn.length&&Ie.length&&(B.value=!0)}),cn(()=>{const Ie=!!(!e.hideNoData||ie.value.length||o["prepend-item"]||o["append-item"]||o["no-data"]),gn=ge.value.length>0,Ae=xd.filterProps(e);return Z(xd,fn({ref:d},Ae,{modelValue:be.value,"onUpdate:modelValue":[Ne=>be.value=Ne,Nt],focused:v.value,"onUpdate:focused":Ne=>v.value=Ne,validationValue:ge.externalValue,counterValue:Ee.value,dirty:gn,onChange:bn,class:["v-autocomplete",`v-autocomplete--${e.multiple?"multiple":"single"}`,{"v-autocomplete--active-menu":B.value,"v-autocomplete--chips":!!e.chips,"v-autocomplete--selection-slot":!!ae.value,"v-autocomplete--selecting-index":U.value>-1},e.class],style:e.style,readonly:e.readonly,placeholder:gn?void 0:e.placeholder,"onClick:clear":Lt,"onMousedown:control":yt,onKeydown:Ft}),{...o,default:()=>Z(Gn,null,[Z(Lp,fn({ref:r,modelValue:B.value,"onUpdate:modelValue":Ne=>B.value=Ne,activator:"parent",contentClass:"v-autocomplete__content",disabled:tt.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterEnter:Bt,onAfterLeave:ht},e.menuProps),{default:()=>[Ie&&Z(ob,fn({ref:Je,selected:pe.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:Ne=>Ne.preventDefault(),onKeydown:mt,onFocusin:gt,onFocusout:et,tabindex:"-1","aria-live":"polite",color:e.itemColor??e.color},Mt,e.listProps),{default:()=>{var Ne,Ue,Et;return[(Ne=o["prepend-item"])==null?void 0:Ne.call(o),!ie.value.length&&!e.hideNoData&&(((Ue=o["no-data"])==null?void 0:Ue.call(o))??Z(tu,{title:c(e.noDataText)},null)),Z(lb,{ref:D,renderless:!0,items:ie.value},{default:Ct=>{var dn;let{item:Qt,index:Gt,itemRef:Yt}=Ct;const vn=fn(Qt.props,{ref:Yt,key:Gt,active:Le.value&&Gt===0?!0:void 0,onClick:()=>Xt(Qt,null)});return((dn=o.item)==null?void 0:dn.call(o,{item:Qt,index:Gt,props:vn}))??Z(tu,fn(vn,{role:"option"}),{prepend:Wn=>{let{isSelected:Rn}=Wn;return Z(Gn,null,[e.multiple&&!e.hideSelected?Z(eu,{key:Qt.value,modelValue:Rn,ripple:!1,tabindex:"-1"},null):void 0,Qt.props.prependAvatar&&Z(ml,{image:Qt.props.prependAvatar},null),Qt.props.prependIcon&&Z(br,{icon:Qt.props.prependIcon},null)])},title:()=>{var Wn,Rn;return y.value?Qt.title:vX(Qt.title,(Wn=Y(Qt))==null?void 0:Wn.title,((Rn=be.value)==null?void 0:Rn.length)??0)}})}}),(Et=o["append-item"])==null?void 0:Et.call(o)]}})]}),ge.value.map((Ne,Ue)=>{function Et(Yt){Yt.stopPropagation(),Yt.preventDefault(),Xt(Ne,!1)}const Ct={"onClick:close":Et,onKeydown(Yt){Yt.key!=="Enter"&&Yt.key!==" "||(Yt.preventDefault(),Yt.stopPropagation(),Et(Yt))},onMousedown(Yt){Yt.preventDefault(),Yt.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},Qt=te.value?!!o.chip:!!o.selection,Gt=Qt?q0(te.value?o.chip({item:Ne,index:Ue,props:Ct}):o.selection({item:Ne,index:Ue})):void 0;if(!(Qt&&!Gt))return Z("div",{key:Ne.value,class:["v-autocomplete__selection",Ue===U.value&&["v-autocomplete__selection--selected",oe.value]],style:Ue===U.value?fe.value:{}},[te.value?o.chip?Z(Li,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:Ne.title}}},{default:()=>[Gt]}):Z(Hp,fn({key:"chip",closable:e.closableChips,size:"small",text:Ne.title,disabled:Ne.props.disabled},Ct),null):Gt??Z("span",{class:"v-autocomplete__selection-text"},[Ne.title,e.multiple&&Ue<ge.value.length-1&&Z("span",{class:"v-autocomplete__selection-comma"},[$o(",")])])])})]),"append-inner":function(){var Ct;for(var Ne=arguments.length,Ue=new Array(Ne),Et=0;Et<Ne;Et++)Ue[Et]=arguments[Et];return Z(Gn,null,[(Ct=o["append-inner"])==null?void 0:Ct.call(o,...Ue),e.menuIcon?Z(br,{class:"v-autocomplete__menu-icon",icon:e.menuIcon,onMousedown:rt,onClick:wL,"aria-label":c(W.value),title:c(W.value),tabindex:"-1"},null):void 0])}})}),yl({isFocused:v,isPristine:y,menu:B,search:be,filteredItems:re,select:Xt},d)}}),xX=At({bordered:Boolean,color:String,content:[Number,String],dot:Boolean,floating:Boolean,icon:mi,inline:Boolean,label:{type:String,default:"$vuetify.badge"},max:[Number,String],modelValue:{type:Boolean,default:!0},offsetX:[Number,String],offsetY:[Number,String],textColor:String,...Nn(),...iu({location:"top end"}),...co(),...Si(),...Ji(),...Wl({transition:"scale-rotate-transition"})},"VBadge"),wX=Jt()({name:"VBadge",inheritAttrs:!1,props:xX(),setup(e,t){const{backgroundColorClasses:o,backgroundColorStyles:c}=Nr(Ht(e,"color")),{roundedClasses:d}=So(e),{t:v}=zo(),{textColorClasses:y,textColorStyles:T}=Fs(Ht(e,"textColor")),{themeClasses:r}=ZL(),{locationStyles:D}=Nd(e,!0,L=>(e.floating?e.dot?2:4:e.dot?8:12)+(["top","bottom"].includes(L)?+(e.offsetY??0):["left","right"].includes(L)?+(e.offsetX??0):0));return cn(()=>{const L=Number(e.content),B=!e.max||isNaN(L)?e.content:L<=+e.max?L:`${e.max}+`,[U,$]=Aw(t.attrs,["aria-atomic","aria-label","aria-live","role","title"]);return Z(e.tag,fn({class:["v-badge",{"v-badge--bordered":e.bordered,"v-badge--dot":e.dot,"v-badge--floating":e.floating,"v-badge--inline":e.inline},e.class]},$,{style:e.style}),{default:()=>{var W,q;return[Z("div",{class:"v-badge__wrapper"},[(q=(W=t.slots).default)==null?void 0:q.call(W),Z(Xs,{transition:e.transition},{default:()=>{var ne,ce;return[lr(Z("span",fn({class:["v-badge__badge",r.value,o.value,d.value,y.value],style:[c.value,T.value,e.inline?{}:D.value],"aria-atomic":"true","aria-label":v(e.label,L),"aria-live":"polite",role:"status"},U),[e.dot?void 0:t.slots.badge?(ce=(ne=t.slots).badge)==null?void 0:ce.call(ne):e.icon?Z(br,{icon:e.icon},null):B]),[[Hl,e.modelValue]])]}})])]}})}),{}}}),SX=At({color:String,density:String,...Nn()},"VBannerActions"),nB=Jt()({name:"VBannerActions",props:SX(),setup(e,t){let{slots:o}=t;return wo({VBtn:{color:e.color,density:e.density,slim:!0,variant:"text"}}),cn(()=>{var c;return Z("div",{class:["v-banner-actions",e.class],style:e.style},[(c=o.default)==null?void 0:c.call(o)])}),{}}}),iB=Tc("v-banner-text"),TX=At({avatar:String,bgColor:String,color:String,icon:mi,lines:String,stacked:Boolean,sticky:Boolean,text:String,...Na(),...Nn(),..._s(),...Ko(),...Rd({mobile:null}),...ls(),...iu(),...jp(),...co(),...Si(),...Ji()},"VBanner"),EX=Jt()({name:"VBanner",props:TX(),setup(e,t){let{slots:o}=t;const{backgroundColorClasses:c,backgroundColorStyles:d}=Nr(e,"bgColor"),{borderClasses:v}=Qa(e),{densityClasses:y}=Js(e),{displayClasses:T,mobile:r}=_l(e),{dimensionStyles:D}=Jo(e),{elevationClasses:L}=Is(e),{locationStyles:B}=Nd(e),{positionClasses:U}=$p(e),{roundedClasses:$}=So(e),{themeClasses:W}=xr(e),q=Ht(e,"color"),ne=Ht(e,"density");wo({VBannerActions:{color:q,density:ne}}),cn(()=>{const ce=!!(e.text||o.text),oe=!!(e.avatar||e.icon),fe=!!(oe||o.prepend);return Z(e.tag,{class:["v-banner",{"v-banner--stacked":e.stacked||r.value,"v-banner--sticky":e.sticky,[`v-banner--${e.lines}-line`]:!!e.lines},W.value,c.value,v.value,y.value,T.value,L.value,U.value,$.value,e.class],style:[d.value,D.value,B.value,e.style],role:"banner"},{default:()=>{var be;return[fe&&Z("div",{key:"prepend",class:"v-banner__prepend"},[o.prepend?Z(Li,{key:"prepend-defaults",disabled:!oe,defaults:{VAvatar:{color:q.value,density:ne.value,icon:e.icon,image:e.avatar}}},o.prepend):Z(ml,{key:"prepend-avatar",color:q.value,density:ne.value,icon:e.icon,image:e.avatar},null)]),Z("div",{class:"v-banner__content"},[ce&&Z(iB,{key:"text"},{default:()=>{var ge;return[((ge=o.text)==null?void 0:ge.call(o))??e.text]}}),(be=o.default)==null?void 0:be.call(o)]),o.actions&&Z(nB,{key:"actions"},o.actions)]}})})}}),IX=At({baseColor:String,bgColor:String,color:String,grow:Boolean,mode:{type:String,validator:e=>!e||["horizontal","shift"].includes(e)},height:{type:[Number,String],default:56},active:{type:Boolean,default:!0},...Na(),...Nn(),..._s(),...ls(),...co(),...Dd({name:"bottom-navigation"}),...Si({tag:"header"}),...Bd({selectedClass:"v-btn--selected"}),...Ji()},"VBottomNavigation"),CX=Jt()({name:"VBottomNavigation",props:IX(),emits:{"update:active":e=>!0,"update:modelValue":e=>!0},setup(e,t){let{slots:o}=t;const{themeClasses:c}=ZL(),{borderClasses:d}=Qa(e),{backgroundColorClasses:v,backgroundColorStyles:y}=Nr(Ht(e,"bgColor")),{densityClasses:T}=Js(e),{elevationClasses:r}=Is(e),{roundedClasses:D}=So(e),{ssrBootStyles:L}=Ld(),B=Se(()=>Number(e.height)-(e.density==="comfortable"?8:0)-(e.density==="compact"?16:0)),U=ei(e,"active",e.active),{layoutItemStyles:$,layoutIsReady:W}=Od({id:e.name,order:Se(()=>parseInt(e.order,10)),position:Se(()=>"bottom"),layoutSize:Se(()=>U.value?B.value:0),elementSize:B,active:U,absolute:Ht(e,"absolute")});return gh(e,MT),wo({VBtn:{baseColor:Ht(e,"baseColor"),color:Ht(e,"color"),density:Ht(e,"density"),stacked:Se(()=>e.mode!=="horizontal"),variant:"text"}},{scoped:!0}),cn(()=>Z(e.tag,{class:["v-bottom-navigation",{"v-bottom-navigation--active":U.value,"v-bottom-navigation--grow":e.grow,"v-bottom-navigation--shift":e.mode==="shift"},c.value,v.value,d.value,T.value,r.value,D.value,e.class],style:[y.value,$.value,{height:Bn(B.value)},L.value,e.style]},{default:()=>[o.default&&Z("div",{class:"v-bottom-navigation__content"},[o.default()])]})),W}}),rB=At({fullscreen:Boolean,retainFocus:{type:Boolean,default:!0},scrollable:Boolean,...R_({origin:"center center",scrollStrategy:"block",transition:{component:K0},zIndex:2400})},"VDialog"),Ww=Jt()({name:"VDialog",props:rB(),emits:{"update:modelValue":e=>!0,afterLeave:()=>!0},setup(e,t){let{emit:o,slots:c}=t;const d=ei(e,"modelValue"),{scopeId:v}=Ud(),y=rn();function T(L){var $,W;const B=L.relatedTarget,U=L.target;if(B!==U&&(($=y.value)!=null&&$.contentEl)&&((W=y.value)!=null&&W.globalTop)&&![document,y.value.contentEl].includes(U)&&!y.value.contentEl.contains(U)){const q=e_(y.value.contentEl);if(!q.length)return;const ne=q[0],ce=q[q.length-1];B===ne?ce.focus():ne.focus()}}Ar&&On(()=>d.value&&e.retainFocus,L=>{L?document.addEventListener("focusin",T):document.removeEventListener("focusin",T)},{immediate:!0});function r(){var L;(L=y.value)!=null&&L.contentEl&&!y.value.contentEl.contains(document.activeElement)&&y.value.contentEl.focus({preventScroll:!0})}function D(){o("afterLeave")}return On(d,async L=>{var B;L||(await Ki(),(B=y.value.activatorEl)==null||B.focus({preventScroll:!0}))}),cn(()=>{const L=vc.filterProps(e),B=fn({"aria-haspopup":"dialog","aria-expanded":String(d.value)},e.activatorProps),U=fn({tabindex:-1},e.contentProps);return Z(vc,fn({ref:y,class:["v-dialog",{"v-dialog--fullscreen":e.fullscreen,"v-dialog--scrollable":e.scrollable},e.class],style:e.style},L,{modelValue:d.value,"onUpdate:modelValue":$=>d.value=$,"aria-modal":"true",activatorProps:B,contentProps:U,role:"dialog",onAfterEnter:r,onAfterLeave:D},v),{activator:c.activator,default:function(){for(var $=arguments.length,W=new Array($),q=0;q<$;q++)W[q]=arguments[q];return Z(Li,{root:"VDialog"},{default:()=>{var ne;return[(ne=c.default)==null?void 0:ne.call(c,...W)]}})}})}),yl({},y)}}),AX=At({inset:Boolean,...rB({transition:"bottom-sheet-transition"})},"VBottomSheet"),PX=Jt()({name:"VBottomSheet",props:AX(),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:o}=t;const c=ei(e,"modelValue");return cn(()=>{const d=Ww.filterProps(e);return Z(Ww,fn(d,{contentClass:["v-bottom-sheet__content",e.contentClass],modelValue:c.value,"onUpdate:modelValue":v=>c.value=v,class:["v-bottom-sheet",{"v-bottom-sheet--inset":e.inset},e.class],style:e.style}),o)}),{}}}),MX=At({divider:[Number,String],...Nn()},"VBreadcrumbsDivider"),oB=Jt()({name:"VBreadcrumbsDivider",props:MX(),setup(e,t){let{slots:o}=t;return cn(()=>{var c;return Z("li",{class:["v-breadcrumbs-divider",e.class],style:e.style},[((c=o==null?void 0:o.default)==null?void 0:c.call(o))??e.divider])}),{}}}),kX=At({active:Boolean,activeClass:String,activeColor:String,color:String,disabled:Boolean,title:String,...Nn(),...P_(),...Si({tag:"li"})},"VBreadcrumbsItem"),sB=Jt()({name:"VBreadcrumbsItem",props:kX(),setup(e,t){let{slots:o,attrs:c}=t;const d=A_(e,c),v=Se(()=>{var D;return e.active||((D=d.isActive)==null?void 0:D.value)}),y=Se(()=>v.value?e.activeColor:e.color),{textColorClasses:T,textColorStyles:r}=Fs(y);return cn(()=>Z(e.tag,{class:["v-breadcrumbs-item",{"v-breadcrumbs-item--active":v.value,"v-breadcrumbs-item--disabled":e.disabled,[`${e.activeClass}`]:v.value&&e.activeClass},T.value,e.class],style:[r.value,e.style],"aria-current":v.value?"page":void 0},{default:()=>{var D,L;return[d.isLink.value?Z("a",{class:"v-breadcrumbs-item--link",href:d.href.value,"aria-current":v.value?"page":void 0,onClick:d.navigate},[((L=o.default)==null?void 0:L.call(o))??e.title]):((D=o.default)==null?void 0:D.call(o))??e.title]}})),{}}}),RX=At({activeClass:String,activeColor:String,bgColor:String,color:String,disabled:Boolean,divider:{type:String,default:"/"},icon:mi,items:{type:Array,default:()=>[]},...Nn(),..._s(),...co(),...Si({tag:"ul"})},"VBreadcrumbs"),DX=Jt()({name:"VBreadcrumbs",props:RX(),setup(e,t){let{slots:o}=t;const{backgroundColorClasses:c,backgroundColorStyles:d}=Nr(Ht(e,"bgColor")),{densityClasses:v}=Js(e),{roundedClasses:y}=So(e);wo({VBreadcrumbsDivider:{divider:Ht(e,"divider")},VBreadcrumbsItem:{activeClass:Ht(e,"activeClass"),activeColor:Ht(e,"activeColor"),color:Ht(e,"color"),disabled:Ht(e,"disabled")}});const T=Se(()=>e.items.map(r=>typeof r=="string"?{item:{title:r},raw:r}:{item:r,raw:r}));return cn(()=>{const r=!!(o.prepend||e.icon);return Z(e.tag,{class:["v-breadcrumbs",c.value,v.value,y.value,e.class],style:[d.value,e.style]},{default:()=>{var D;return[r&&Z("li",{key:"prepend",class:"v-breadcrumbs__prepend"},[o.prepend?Z(Li,{key:"prepend-defaults",disabled:!e.icon,defaults:{VIcon:{icon:e.icon,start:!0}}},o.prepend):Z(br,{key:"prepend-icon",start:!0,icon:e.icon},null)]),T.value.map((L,B,U)=>{var q;let{item:$,raw:W}=L;return Z(Gn,null,[((q=o.item)==null?void 0:q.call(o,{item:$,index:B}))??Z(sB,fn({key:B,disabled:B>=U.length-1},typeof $=="string"?{title:$}:$),{default:o.title?()=>{var ne;return(ne=o.title)==null?void 0:ne.call(o,{item:$,index:B})}:void 0}),B<U.length-1&&Z(oB,null,{default:o.divider?()=>{var ne;return(ne=o.divider)==null?void 0:ne.call(o,{item:W,index:B})}:void 0})])}),(D=o.default)==null?void 0:D.call(o)]}})}),{}}}),aB=Jt()({name:"VCardActions",props:Nn(),setup(e,t){let{slots:o}=t;return wo({VBtn:{slim:!0,variant:"text"}}),cn(()=>{var c;return Z("div",{class:["v-card-actions",e.class],style:e.style},[(c=o.default)==null?void 0:c.call(o)])}),{}}}),OX=At({opacity:[Number,String],...Nn(),...Si()},"VCardSubtitle"),lB=Jt()({name:"VCardSubtitle",props:OX(),setup(e,t){let{slots:o}=t;return cn(()=>Z(e.tag,{class:["v-card-subtitle",e.class],style:[{"--v-card-subtitle-opacity":e.opacity},e.style]},o)),{}}}),cB=Tc("v-card-title"),LX=At({appendAvatar:String,appendIcon:mi,prependAvatar:String,prependIcon:mi,subtitle:[String,Number],title:[String,Number],...Nn(),..._s()},"VCardItem"),uB=Jt()({name:"VCardItem",props:LX(),setup(e,t){let{slots:o}=t;return cn(()=>{var D;const c=!!(e.prependAvatar||e.prependIcon),d=!!(c||o.prepend),v=!!(e.appendAvatar||e.appendIcon),y=!!(v||o.append),T=!!(e.title!=null||o.title),r=!!(e.subtitle!=null||o.subtitle);return Z("div",{class:["v-card-item",e.class],style:e.style},[d&&Z("div",{key:"prepend",class:"v-card-item__prepend"},[o.prepend?Z(Li,{key:"prepend-defaults",disabled:!c,defaults:{VAvatar:{density:e.density,image:e.prependAvatar},VIcon:{density:e.density,icon:e.prependIcon}}},o.prepend):Z(Gn,null,[e.prependAvatar&&Z(ml,{key:"prepend-avatar",density:e.density,image:e.prependAvatar},null),e.prependIcon&&Z(br,{key:"prepend-icon",density:e.density,icon:e.prependIcon},null)])]),Z("div",{class:"v-card-item__content"},[T&&Z(cB,{key:"title"},{default:()=>{var L;return[((L=o.title)==null?void 0:L.call(o))??e.title]}}),r&&Z(lB,{key:"subtitle"},{default:()=>{var L;return[((L=o.subtitle)==null?void 0:L.call(o))??e.subtitle]}}),(D=o.default)==null?void 0:D.call(o)]),y&&Z("div",{key:"append",class:"v-card-item__append"},[o.append?Z(Li,{key:"append-defaults",disabled:!v,defaults:{VAvatar:{density:e.density,image:e.appendAvatar},VIcon:{density:e.density,icon:e.appendIcon}}},o.append):Z(Gn,null,[e.appendIcon&&Z(br,{key:"append-icon",density:e.density,icon:e.appendIcon},null),e.appendAvatar&&Z(ml,{key:"append-avatar",density:e.density,image:e.appendAvatar},null)])])])}),{}}}),zX=At({opacity:[Number,String],...Nn(),...Si()},"VCardText"),hB=Jt()({name:"VCardText",props:zX(),setup(e,t){let{slots:o}=t;return cn(()=>Z(e.tag,{class:["v-card-text",e.class],style:[{"--v-card-text-opacity":e.opacity},e.style]},o)),{}}}),BX=At({appendAvatar:String,appendIcon:mi,disabled:Boolean,flat:Boolean,hover:Boolean,image:String,link:{type:Boolean,default:void 0},prependAvatar:String,prependIcon:mi,ripple:{type:[Boolean,Object],default:!0},subtitle:[String,Number],text:[String,Number],title:[String,Number],...Na(),...Nn(),..._s(),...Ko(),...ls(),...tb(),...iu(),...jp(),...co(),...P_(),...Si(),...Ji(),...vl({variant:"elevated"})},"VCard"),FX=Jt()({name:"VCard",directives:{Ripple:ru},props:BX(),setup(e,t){let{attrs:o,slots:c}=t;const{themeClasses:d}=xr(e),{borderClasses:v}=Qa(e),{colorClasses:y,colorStyles:T,variantClasses:r}=zd(e),{densityClasses:D}=Js(e),{dimensionStyles:L}=Jo(e),{elevationClasses:B}=Is(e),{loaderClasses:U}=I_(e),{locationStyles:$}=Nd(e),{positionClasses:W}=$p(e),{roundedClasses:q}=So(e),ne=A_(e,o),ce=Se(()=>e.link!==!1&&ne.isLink.value),oe=Se(()=>!e.disabled&&e.link!==!1&&(e.link||ne.isClickable.value));return cn(()=>{const fe=ce.value?"a":e.tag,be=!!(c.title||e.title!=null),ge=!!(c.subtitle||e.subtitle!=null),Ee=be||ge,de=!!(c.append||e.appendAvatar||e.appendIcon),re=!!(c.prepend||e.prependAvatar||e.prependIcon),Y=!!(c.image||e.image),ie=Ee||re||de,te=!!(c.text||e.text!=null);return lr(Z(fe,{class:["v-card",{"v-card--disabled":e.disabled,"v-card--flat":e.flat,"v-card--hover":e.hover&&!(e.disabled||e.flat),"v-card--link":oe.value},d.value,v.value,y.value,D.value,B.value,U.value,W.value,q.value,r.value,e.class],style:[T.value,L.value,$.value,e.style],href:ne.href.value,onClick:oe.value&&ne.navigate,tabindex:e.disabled?-1:void 0},{default:()=>{var ae;return[Y&&Z("div",{key:"image",class:"v-card__image"},[c.image?Z(Li,{key:"image-defaults",disabled:!e.image,defaults:{VImg:{cover:!0,src:e.image}}},c.image):Z(Qc,{key:"image-img",cover:!0,src:e.image},null)]),Z(C_,{name:"v-card",active:!!e.loading,color:typeof e.loading=="boolean"?void 0:e.loading},{default:c.loader}),ie&&Z(uB,{key:"item",prependAvatar:e.prependAvatar,prependIcon:e.prependIcon,title:e.title,subtitle:e.subtitle,appendAvatar:e.appendAvatar,appendIcon:e.appendIcon},{default:c.item,prepend:c.prepend,title:c.title,subtitle:c.subtitle,append:c.append}),te&&Z(hB,{key:"text"},{default:()=>{var pe;return[((pe=c.text)==null?void 0:pe.call(c))??e.text]}}),(ae=c.default)==null?void 0:ae.call(c),c.actions&&Z(aB,null,{default:c.actions}),mh(oe.value,"v-card")]}}),[[Ya("ripple"),oe.value&&e.ripple]])}),{}}}),VX=e=>{const{touchstartX:t,touchendX:o,touchstartY:c,touchendY:d}=e,v=.5,y=16;e.offsetX=o-t,e.offsetY=d-c,Math.abs(e.offsetY)<v*Math.abs(e.offsetX)&&(e.left&&o<t-y&&e.left(e),e.right&&o>t+y&&e.right(e)),Math.abs(e.offsetX)<v*Math.abs(e.offsetY)&&(e.up&&d<c-y&&e.up(e),e.down&&d>c+y&&e.down(e))};function NX(e,t){var c;const o=e.changedTouches[0];t.touchstartX=o.clientX,t.touchstartY=o.clientY,(c=t.start)==null||c.call(t,{originalEvent:e,...t})}function UX(e,t){var c;const o=e.changedTouches[0];t.touchendX=o.clientX,t.touchendY=o.clientY,(c=t.end)==null||c.call(t,{originalEvent:e,...t}),VX(t)}function jX(e,t){var c;const o=e.changedTouches[0];t.touchmoveX=o.clientX,t.touchmoveY=o.clientY,(c=t.move)==null||c.call(t,{originalEvent:e,...t})}function $X(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t={touchstartX:0,touchstartY:0,touchendX:0,touchendY:0,touchmoveX:0,touchmoveY:0,offsetX:0,offsetY:0,left:e.left,right:e.right,up:e.up,down:e.down,start:e.start,move:e.move,end:e.end};return{touchstart:o=>NX(o,t),touchend:o=>UX(o,t),touchmove:o=>jX(o,t)}}function GX(e,t){var T;const o=t.value,c=o!=null&&o.parent?e.parentElement:e,d=(o==null?void 0:o.options)??{passive:!0},v=(T=t.instance)==null?void 0:T.$.uid;if(!c||!v)return;const y=$X(t.value);c._touchHandlers=c._touchHandlers??Object.create(null),c._touchHandlers[v]=y,_L(y).forEach(r=>{c.addEventListener(r,y[r],d)})}function HX(e,t){var v,y;const o=(v=t.value)!=null&&v.parent?e.parentElement:e,c=(y=t.instance)==null?void 0:y.$.uid;if(!(o!=null&&o._touchHandlers)||!c)return;const d=o._touchHandlers[c];_L(d).forEach(T=>{o.removeEventListener(T,d[T])}),delete o._touchHandlers[c]}const GT={mounted:GX,unmounted:HX},dB=Symbol.for("vuetify:v-window"),fB=Symbol.for("vuetify:v-window-group"),cb=At({continuous:Boolean,nextIcon:{type:[Boolean,String,Function,Object],default:"$next"},prevIcon:{type:[Boolean,String,Function,Object],default:"$prev"},reverse:Boolean,showArrows:{type:[Boolean,String],validator:e=>typeof e=="boolean"||e==="hover"},touch:{type:[Object,Boolean],default:void 0},direction:{type:String,default:"horizontal"},modelValue:null,disabled:Boolean,selectedClass:{type:String,default:"v-window-item--active"},mandatory:{type:[Boolean,String],default:"force"},...Nn(),...Si(),...Ji()},"VWindow"),wd=Jt()({name:"VWindow",directives:{Touch:GT},props:cb(),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:o}=t;const{themeClasses:c}=xr(e),{isRtl:d}=gs(),{t:v}=zo(),y=gh(e,fB),T=rn(),r=Se(()=>d.value?!e.reverse:e.reverse),D=kn(!1),L=Se(()=>{const be=e.direction==="vertical"?"y":"x",Ee=(r.value?!D.value:D.value)?"-reverse":"";return`v-window-${be}${Ee}-transition`}),B=kn(0),U=rn(void 0),$=Se(()=>y.items.value.findIndex(be=>y.selected.value.includes(be.id)));On($,(be,ge)=>{const Ee=y.items.value.length,de=Ee-1;Ee<=2?D.value=be<ge:be===de&&ge===0?D.value=!0:be===0&&ge===de?D.value=!1:D.value=be<ge}),Vr(dB,{transition:L,isReversed:D,transitionCount:B,transitionHeight:U,rootRef:T});const W=Se(()=>e.continuous||$.value!==0),q=Se(()=>e.continuous||$.value!==y.items.value.length-1);function ne(){W.value&&y.prev()}function ce(){q.value&&y.next()}const oe=Se(()=>{const be=[],ge={icon:d.value?e.nextIcon:e.prevIcon,class:`v-window__${r.value?"right":"left"}`,onClick:y.prev,"aria-label":v("$vuetify.carousel.prev")};be.push(W.value?o.prev?o.prev({props:ge}):Z(yr,ge,null):Z("div",null,null));const Ee={icon:d.value?e.prevIcon:e.nextIcon,class:`v-window__${r.value?"left":"right"}`,onClick:y.next,"aria-label":v("$vuetify.carousel.next")};return be.push(q.value?o.next?o.next({props:Ee}):Z(yr,Ee,null):Z("div",null,null)),be}),fe=Se(()=>e.touch===!1?e.touch:{...{left:()=>{r.value?ne():ce()},right:()=>{r.value?ce():ne()},start:ge=>{let{originalEvent:Ee}=ge;Ee.stopPropagation()}},...e.touch===!0?{}:e.touch});return cn(()=>lr(Z(e.tag,{ref:T,class:["v-window",{"v-window--show-arrows-on-hover":e.showArrows==="hover"},c.value,e.class],style:e.style},{default:()=>{var be,ge;return[Z("div",{class:"v-window__container",style:{height:U.value}},[(be=o.default)==null?void 0:be.call(o,{group:y}),e.showArrows!==!1&&Z("div",{class:"v-window__controls"},[oe.value])]),(ge=o.additional)==null?void 0:ge.call(o,{group:y})]}}),[[Ya("touch"),fe.value]])),{group:y}}}),qX=At({color:String,cycle:Boolean,delimiterIcon:{type:mi,default:"$delimiter"},height:{type:[Number,String],default:500},hideDelimiters:Boolean,hideDelimiterBackground:Boolean,interval:{type:[Number,String],default:6e3,validator:e=>Number(e)>0},progress:[Boolean,String],verticalDelimiters:[Boolean,String],...cb({continuous:!0,mandatory:"force",showArrows:!0})},"VCarousel"),WX=Jt()({name:"VCarousel",props:qX(),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:o}=t;const c=ei(e,"modelValue"),{t:d}=zo(),v=rn();let y=-1;On(c,r),On(()=>e.interval,r),On(()=>e.cycle,D=>{D?r():window.clearTimeout(y)}),ms(T);function T(){!e.cycle||!v.value||(y=window.setTimeout(v.value.group.next,+e.interval>0?+e.interval:6e3))}function r(){window.clearTimeout(y),window.requestAnimationFrame(T)}return cn(()=>{const D=wd.filterProps(e);return Z(wd,fn({ref:v},D,{modelValue:c.value,"onUpdate:modelValue":L=>c.value=L,class:["v-carousel",{"v-carousel--hide-delimiter-background":e.hideDelimiterBackground,"v-carousel--vertical-delimiters":e.verticalDelimiters},e.class],style:[{height:Bn(e.height)},e.style]}),{default:o.default,additional:L=>{let{group:B}=L;return Z(Gn,null,[!e.hideDelimiters&&Z("div",{class:"v-carousel__controls",style:{left:e.verticalDelimiters==="left"&&e.verticalDelimiters?0:"auto",right:e.verticalDelimiters==="right"?0:"auto"}},[B.items.value.length>0&&Z(Li,{defaults:{VBtn:{color:e.color,icon:e.delimiterIcon,size:"x-small",variant:"text"}},scoped:!0},{default:()=>[B.items.value.map((U,$)=>{const W={id:`carousel-item-${U.id}`,"aria-label":d("$vuetify.carousel.ariaLabel.delimiter",$+1,B.items.value.length),class:["v-carousel__controls__item",B.isSelected(U.id)&&"v-btn--active"],onClick:()=>B.select(U.id,!0)};return o.item?o.item({props:W,item:U}):Z(yr,fn(U,W),null)})]})]),e.progress&&Z(eb,{class:"v-carousel__progress",color:typeof e.progress=="string"?e.progress:void 0,modelValue:(B.getItemIndex(c.value)+1)/B.items.value.length*100},null)])},prev:o.prev,next:o.next})}),{}}}),ub=At({reverseTransition:{type:[Boolean,String],default:void 0},transition:{type:[Boolean,String],default:void 0},...Nn(),...Fd(),...FT()},"VWindowItem"),Sd=Jt()({name:"VWindowItem",directives:{Touch:GT},props:ub(),emits:{"group:selected":e=>!0},setup(e,t){let{slots:o}=t;const c=Mi(dB),d=Vd(e,fB),{isBooted:v}=Ld();if(!c||!d)throw new Error("[Vuetify] VWindowItem must be used inside VWindow");const y=kn(!1),T=Se(()=>v.value&&(c.isReversed.value?e.reverseTransition!==!1:e.transition!==!1));function r(){!y.value||!c||(y.value=!1,c.transitionCount.value>0&&(c.transitionCount.value-=1,c.transitionCount.value===0&&(c.transitionHeight.value=void 0)))}function D(){var W;y.value||!c||(y.value=!0,c.transitionCount.value===0&&(c.transitionHeight.value=Bn((W=c.rootRef.value)==null?void 0:W.clientHeight)),c.transitionCount.value+=1)}function L(){r()}function B(W){y.value&&Ki(()=>{!T.value||!y.value||!c||(c.transitionHeight.value=Bn(W.clientHeight))})}const U=Se(()=>{const W=c.isReversed.value?e.reverseTransition:e.transition;return T.value?{name:typeof W!="string"?c.transition.value:W,onBeforeEnter:D,onAfterEnter:r,onEnterCancelled:L,onBeforeLeave:D,onAfterLeave:r,onLeaveCancelled:L,onEnter:B}:!1}),{hasContent:$}=VT(e,d.isSelected);return cn(()=>Z(Xs,{transition:U.value,disabled:!v.value},{default:()=>{var W;return[lr(Z("div",{class:["v-window-item",d.selectedClass.value,e.class],style:e.style},[$.value&&((W=o.default)==null?void 0:W.call(o))]),[[Hl,d.isSelected.value]])]}})),{groupItem:d}}}),ZX=At({...oz(),...ub()},"VCarouselItem"),XX=Jt()({name:"VCarouselItem",inheritAttrs:!1,props:ZX(),setup(e,t){let{slots:o,attrs:c}=t;cn(()=>{const d=Qc.filterProps(e),v=Sd.filterProps(e);return Z(Sd,fn({class:["v-carousel-item",e.class]},v),{default:()=>[Z(Qc,fn(c,d),o)]})})}}),YX=Tc("v-code"),KX=At({color:{type:Object},disabled:Boolean,dotSize:{type:[Number,String],default:10},height:{type:[Number,String],default:150},width:{type:[Number,String],default:300},...Nn()},"VColorPickerCanvas"),JX=Ka({name:"VColorPickerCanvas",props:KX(),emits:{"update:color":e=>!0,"update:position":e=>!0},setup(e,t){let{emit:o}=t;const c=kn(!1),d=rn(),v=kn(parseFloat(e.width)),y=kn(parseFloat(e.height)),T=rn({x:0,y:0}),r=Se({get:()=>T.value,set(ne){var fe,be;if(!d.value)return;const{x:ce,y:oe}=ne;T.value=ne,o("update:color",{h:((fe=e.color)==null?void 0:fe.h)??0,s:Go(ce,0,v.value)/v.value,v:1-Go(oe,0,y.value)/y.value,a:((be=e.color)==null?void 0:be.a)??1})}}),D=Se(()=>{const{x:ne,y:ce}=r.value,oe=parseInt(e.dotSize,10)/2;return{width:Bn(e.dotSize),height:Bn(e.dotSize),transform:`translate(${Bn(ne-oe)}, ${Bn(ce-oe)})`}}),{resizeRef:L}=$l(ne=>{var fe;if(!((fe=L.el)!=null&&fe.offsetParent))return;const{width:ce,height:oe}=ne[0].contentRect;v.value=ce,y.value=oe});function B(ne,ce,oe){const{left:fe,top:be,width:ge,height:Ee}=oe;r.value={x:Go(ne-fe,0,ge),y:Go(ce-be,0,Ee)}}function U(ne){ne.type==="mousedown"&&ne.preventDefault(),!e.disabled&&($(ne),window.addEventListener("mousemove",$),window.addEventListener("mouseup",W),window.addEventListener("touchmove",$),window.addEventListener("touchend",W))}function $(ne){if(e.disabled||!d.value)return;c.value=!0;const ce=mq(ne);B(ce.clientX,ce.clientY,d.value.getBoundingClientRect())}function W(){window.removeEventListener("mousemove",$),window.removeEventListener("mouseup",W),window.removeEventListener("touchmove",$),window.removeEventListener("touchend",W)}function q(){var be;if(!d.value)return;const ne=d.value,ce=ne.getContext("2d");if(!ce)return;const oe=ce.createLinearGradient(0,0,ne.width,0);oe.addColorStop(0,"hsla(0, 0%, 100%, 1)"),oe.addColorStop(1,`hsla(${((be=e.color)==null?void 0:be.h)??0}, 100%, 50%, 1)`),ce.fillStyle=oe,ce.fillRect(0,0,ne.width,ne.height);const fe=ce.createLinearGradient(0,0,0,ne.height);fe.addColorStop(0,"hsla(0, 0%, 0%, 0)"),fe.addColorStop(1,"hsla(0, 0%, 0%, 1)"),ce.fillStyle=fe,ce.fillRect(0,0,ne.width,ne.height)}return On(()=>{var ne;return(ne=e.color)==null?void 0:ne.h},q,{immediate:!0}),On(()=>[v.value,y.value],(ne,ce)=>{q(),T.value={x:r.value.x*ne[0]/ce[0],y:r.value.y*ne[1]/ce[1]}},{flush:"post"}),On(()=>e.color,()=>{if(c.value){c.value=!1;return}T.value=e.color?{x:e.color.s*v.value,y:(1-e.color.v)*y.value}:{x:0,y:0}},{deep:!0,immediate:!0}),ms(()=>q()),cn(()=>Z("div",{ref:L,class:["v-color-picker-canvas",e.class],style:e.style,onMousedown:U,onTouchstartPassive:U},[Z("canvas",{ref:d,width:v.value,height:y.value},null),e.color&&Z("div",{class:["v-color-picker-canvas__dot",{"v-color-picker-canvas__dot--disabled":e.disabled}],style:D.value},null)])),{}}});function QX(e,t){if(t){const{a:o,...c}=e;return c}return e}function eY(e,t){if(t==null||typeof t=="string"){const o=OL(e);return e.a===1?o.slice(0,7):o}if(typeof t=="object"){let o;return cd(t,["r","g","b"])?o=Jc(e):cd(t,["h","s","l"])?o=AL(e):cd(t,["h","s","v"])&&(o=e),QX(o,!cd(t,["a"])&&e.a===1)}return e}const up={h:0,s:0,v:0,a:1},Zw={inputProps:{type:"number",min:0},inputs:[{label:"R",max:255,step:1,getValue:e=>Math.round(e.r),getColor:(e,t)=>({...e,r:Number(t)})},{label:"G",max:255,step:1,getValue:e=>Math.round(e.g),getColor:(e,t)=>({...e,g:Number(t)})},{label:"B",max:255,step:1,getValue:e=>Math.round(e.b),getColor:(e,t)=>({...e,b:Number(t)})},{label:"A",max:1,step:.01,getValue:e=>{let{a:t}=e;return t!=null?Math.round(t*100)/100:1},getColor:(e,t)=>({...e,a:Number(t)})}],to:Jc,from:W0};var Dk;const tY={...Zw,inputs:(Dk=Zw.inputs)==null?void 0:Dk.slice(0,3)},Xw={inputProps:{type:"number",min:0},inputs:[{label:"H",max:360,step:1,getValue:e=>Math.round(e.h),getColor:(e,t)=>({...e,h:Number(t)})},{label:"S",max:1,step:.01,getValue:e=>Math.round(e.s*100)/100,getColor:(e,t)=>({...e,s:Number(t)})},{label:"L",max:1,step:.01,getValue:e=>Math.round(e.l*100)/100,getColor:(e,t)=>({...e,l:Number(t)})},{label:"A",max:1,step:.01,getValue:e=>{let{a:t}=e;return t!=null?Math.round(t*100)/100:1},getColor:(e,t)=>({...e,a:Number(t)})}],to:AL,from:vT},nY={...Xw,inputs:Xw.inputs.slice(0,3)},pB={inputProps:{type:"text"},inputs:[{label:"HEXA",getValue:e=>e,getColor:(e,t)=>t}],to:OL,from:DL},iY={...pB,inputs:[{label:"HEX",getValue:e=>e.slice(0,7),getColor:(e,t)=>t}]},pd={rgb:tY,rgba:Zw,hsl:nY,hsla:Xw,hex:iY,hexa:pB},rY=e=>{let{label:t,...o}=e;return Z("div",{class:"v-color-picker-edit__input"},[Z("input",o,null),Z("span",null,[t])])},oY=At({color:Object,disabled:Boolean,mode:{type:String,default:"rgba",validator:e=>Object.keys(pd).includes(e)},modes:{type:Array,default:()=>Object.keys(pd),validator:e=>Array.isArray(e)&&e.every(t=>Object.keys(pd).includes(t))},...Nn()},"VColorPickerEdit"),sY=Ka({name:"VColorPickerEdit",props:oY(),emits:{"update:color":e=>!0,"update:mode":e=>!0},setup(e,t){let{emit:o}=t;const c=Se(()=>e.modes.map(v=>({...pd[v],name:v}))),d=Se(()=>{var T;const v=c.value.find(r=>r.name===e.mode);if(!v)return[];const y=e.color?v.to(e.color):null;return(T=v.inputs)==null?void 0:T.map(r=>{let{getValue:D,getColor:L,...B}=r;return{...v.inputProps,...B,disabled:e.disabled,value:y&&D(y),onChange:U=>{const $=U.target;$&&o("update:color",v.from(L(y??v.to(up),$.value)))}}})});return cn(()=>{var v;return Z("div",{class:["v-color-picker-edit",e.class],style:e.style},[(v=d.value)==null?void 0:v.map(y=>Z(rY,y,null)),c.value.length>1&&Z(yr,{icon:"$unfold",size:"x-small",variant:"plain",onClick:()=>{const y=c.value.findIndex(T=>T.name===e.mode);o("update:mode",c.value[(y+1)%c.value.length].name)}},null)])}),{}}}),HT=Symbol.for("vuetify:v-slider");function Yw(e,t,o){const c=o==="vertical",d=t.getBoundingClientRect(),v="touches"in e?e.touches[0]:e;return c?v.clientY-(d.top+d.height/2):v.clientX-(d.left+d.width/2)}function aY(e,t){return"touches"in e&&e.touches.length?e.touches[0][t]:"changedTouches"in e&&e.changedTouches.length?e.changedTouches[0][t]:e[t]}const mB=At({disabled:{type:Boolean,default:null},error:Boolean,readonly:{type:Boolean,default:null},max:{type:[Number,String],default:100},min:{type:[Number,String],default:0},step:{type:[Number,String],default:0},thumbColor:String,thumbLabel:{type:[Boolean,String],default:void 0,validator:e=>typeof e=="boolean"||e==="always"},thumbSize:{type:[Number,String],default:20},showTicks:{type:[Boolean,String],default:!1,validator:e=>typeof e=="boolean"||e==="always"},ticks:{type:[Array,Object]},tickSize:{type:[Number,String],default:2},color:String,trackColor:String,trackFillColor:String,trackSize:{type:[Number,String],default:4},direction:{type:String,default:"horizontal",validator:e=>["vertical","horizontal"].includes(e)},reverse:Boolean,...co(),...ls({elevation:2}),ripple:{type:Boolean,default:!0}},"Slider"),gB=e=>{const t=Se(()=>parseFloat(e.min)),o=Se(()=>parseFloat(e.max)),c=Se(()=>+e.step>0?parseFloat(e.step):0),d=Se(()=>Math.max(kM(c.value),kM(t.value)));function v(y){if(y=parseFloat(y),c.value<=0)return y;const T=Go(y,t.value,o.value),r=t.value%c.value,D=Math.round((T-r)/c.value)*c.value+r;return parseFloat(Math.min(D,o.value).toFixed(d.value))}return{min:t,max:o,step:c,decimals:d,roundValue:v}},_B=e=>{let{props:t,steps:o,onSliderStart:c,onSliderMove:d,onSliderEnd:v,getActiveThumb:y}=e;const{isRtl:T}=gs(),r=Ht(t,"reverse"),D=Se(()=>t.direction==="vertical"),L=Se(()=>D.value!==r.value),{min:B,max:U,step:$,decimals:W,roundValue:q}=o,ne=Se(()=>parseInt(t.thumbSize,10)),ce=Se(()=>parseInt(t.tickSize,10)),oe=Se(()=>parseInt(t.trackSize,10)),fe=Se(()=>(U.value-B.value)/$.value),be=Ht(t,"disabled"),ge=Se(()=>t.error||t.disabled?void 0:t.thumbColor??t.color),Ee=Se(()=>t.error||t.disabled?void 0:t.trackColor??t.color),de=Se(()=>t.error||t.disabled?void 0:t.trackFillColor??t.color),re=kn(!1),Y=kn(0),ie=rn(),te=rn();function ae(gt){var Ue;const et=t.direction==="vertical",Nt=et?"top":"left",St=et?"height":"width",Xt=et?"clientY":"clientX",{[Nt]:Ie,[St]:gn}=(Ue=ie.value)==null?void 0:Ue.$el.getBoundingClientRect(),Ae=aY(gt,Xt);let Ne=Math.min(Math.max((Ae-Ie-Y.value)/gn,0),1)||0;return(et?L.value:L.value!==T.value)&&(Ne=1-Ne),q(B.value+Ne*(U.value-B.value))}const pe=gt=>{v({value:ae(gt)}),re.value=!1,Y.value=0},Le=gt=>{te.value=y(gt),te.value&&(te.value.focus(),re.value=!0,te.value.contains(gt.target)?Y.value=Yw(gt,te.value,t.direction):(Y.value=0,d({value:ae(gt)})),c({value:ae(gt)}))},tt={passive:!0,capture:!0};function Je(gt){d({value:ae(gt)})}function Mt(gt){gt.stopPropagation(),gt.preventDefault(),pe(gt),window.removeEventListener("mousemove",Je,tt),window.removeEventListener("mouseup",Mt)}function Lt(gt){var et;pe(gt),window.removeEventListener("touchmove",Je,tt),(et=gt.target)==null||et.removeEventListener("touchend",Lt)}function yt(gt){var et;Le(gt),window.addEventListener("touchmove",Je,tt),(et=gt.target)==null||et.addEventListener("touchend",Lt,{passive:!1})}function rt(gt){gt.preventDefault(),Le(gt),window.addEventListener("mousemove",Je,tt),window.addEventListener("mouseup",Mt,{passive:!1})}const mt=gt=>{const et=(gt-B.value)/(U.value-B.value)*100;return Go(isNaN(et)?0:et,0,100)},Ft=Ht(t,"showTicks"),bn=Se(()=>Ft.value?t.ticks?Array.isArray(t.ticks)?t.ticks.map(gt=>({value:gt,position:mt(gt),label:gt.toString()})):Object.keys(t.ticks).map(gt=>({value:parseFloat(gt),position:mt(parseFloat(gt)),label:t.ticks[gt]})):fe.value!==1/0?dc(fe.value+1).map(gt=>{const et=B.value+gt*$.value;return{value:et,position:mt(et)}}):[]:[]),Bt=Se(()=>bn.value.some(gt=>{let{label:et}=gt;return!!et})),ht={activeThumbRef:te,color:Ht(t,"color"),decimals:W,disabled:be,direction:Ht(t,"direction"),elevation:Ht(t,"elevation"),hasLabels:Bt,isReversed:r,indexFromEnd:L,min:B,max:U,mousePressed:re,numTicks:fe,onSliderMousedown:rt,onSliderTouchstart:yt,parsedTicks:bn,parseMouseMove:ae,position:mt,readonly:Ht(t,"readonly"),rounded:Ht(t,"rounded"),roundValue:q,showTicks:Ft,startOffset:Y,step:$,thumbSize:ne,thumbColor:ge,thumbLabel:Ht(t,"thumbLabel"),ticks:Ht(t,"ticks"),tickSize:ce,trackColor:Ee,trackContainerRef:ie,trackFillColor:de,trackSize:oe,vertical:D};return Vr(HT,ht),ht},lY=At({focused:Boolean,max:{type:Number,required:!0},min:{type:Number,required:!0},modelValue:{type:Number,required:!0},position:{type:Number,required:!0},ripple:{type:[Boolean,Object],default:!0},name:String,...Nn()},"VSliderThumb"),Kw=Jt()({name:"VSliderThumb",directives:{Ripple:ru},props:lY(),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:o,emit:c}=t;const d=Mi(HT),{isRtl:v,rtlClasses:y}=gs();if(!d)throw new Error("[Vuetify] v-slider-thumb must be used inside v-slider or v-range-slider");const{thumbColor:T,step:r,disabled:D,thumbSize:L,thumbLabel:B,direction:U,isReversed:$,vertical:W,readonly:q,elevation:ne,mousePressed:ce,decimals:oe,indexFromEnd:fe}=d,be=Se(()=>D.value?void 0:ne.value),{elevationClasses:ge}=Is(be),{textColorClasses:Ee,textColorStyles:de}=Fs(T),{pageup:re,pagedown:Y,end:ie,home:te,left:ae,right:pe,down:Le,up:tt}=Cw,Je=[re,Y,ie,te,ae,pe,Le,tt],Mt=Se(()=>r.value?[1,2,3]:[1,5,10]);function Lt(rt,mt){if(!Je.includes(rt.key))return;rt.preventDefault();const Ft=r.value||.1,bn=(e.max-e.min)/Ft;if([ae,pe,Le,tt].includes(rt.key)){const ht=(W.value?[v.value?ae:pe,$.value?Le:tt]:fe.value!==v.value?[ae,tt]:[pe,tt]).includes(rt.key)?1:-1,gt=rt.shiftKey?2:rt.ctrlKey?1:0;mt=mt+ht*Ft*Mt.value[gt]}else if(rt.key===te)mt=e.min;else if(rt.key===ie)mt=e.max;else{const Bt=rt.key===Y?1:-1;mt=mt-Bt*Ft*(bn>100?bn/10:10)}return Math.max(e.min,Math.min(e.max,mt))}function yt(rt){const mt=Lt(rt,e.modelValue);mt!=null&&c("update:modelValue",mt)}return cn(()=>{const rt=Bn(fe.value?100-e.position:e.position,"%");return Z("div",{class:["v-slider-thumb",{"v-slider-thumb--focused":e.focused,"v-slider-thumb--pressed":e.focused&&ce.value},e.class,y.value],style:[{"--v-slider-thumb-position":rt,"--v-slider-thumb-size":Bn(L.value)},e.style],role:"slider",tabindex:D.value?-1:0,"aria-label":e.name,"aria-valuemin":e.min,"aria-valuemax":e.max,"aria-valuenow":e.modelValue,"aria-readonly":!!q.value,"aria-orientation":U.value,onKeydown:q.value?void 0:yt},[Z("div",{class:["v-slider-thumb__surface",Ee.value,ge.value],style:{...de.value}},null),lr(Z("div",{class:["v-slider-thumb__ripple",Ee.value],style:de.value},null),[[Ya("ripple"),e.ripple,null,{circle:!0,center:!0}]]),Z(IT,{origin:"bottom center"},{default:()=>{var mt;return[lr(Z("div",{class:"v-slider-thumb__label-container"},[Z("div",{class:["v-slider-thumb__label"]},[Z("div",null,[((mt=o["thumb-label"])==null?void 0:mt.call(o,{modelValue:e.modelValue}))??e.modelValue.toFixed(r.value?oe.value:1)])])]),[[Hl,B.value&&e.focused||B.value==="always"]])]}})])}),{}}}),cY=At({start:{type:Number,required:!0},stop:{type:Number,required:!0},...Nn()},"VSliderTrack"),vB=Jt()({name:"VSliderTrack",props:cY(),emits:{},setup(e,t){let{slots:o}=t;const c=Mi(HT);if(!c)throw new Error("[Vuetify] v-slider-track must be inside v-slider or v-range-slider");const{color:d,parsedTicks:v,rounded:y,showTicks:T,tickSize:r,trackColor:D,trackFillColor:L,trackSize:B,vertical:U,min:$,max:W,indexFromEnd:q}=c,{roundedClasses:ne}=So(y),{backgroundColorClasses:ce,backgroundColorStyles:oe}=Nr(L),{backgroundColorClasses:fe,backgroundColorStyles:be}=Nr(D),ge=Se(()=>`inset-${U.value?"block":"inline"}-${q.value?"end":"start"}`),Ee=Se(()=>U.value?"height":"width"),de=Se(()=>({[ge.value]:"0%",[Ee.value]:"100%"})),re=Se(()=>e.stop-e.start),Y=Se(()=>({[ge.value]:Bn(e.start,"%"),[Ee.value]:Bn(re.value,"%")})),ie=Se(()=>T.value?(U.value?v.value.slice().reverse():v.value).map((ae,pe)=>{var tt;const Le=ae.value!==$.value&&ae.value!==W.value?Bn(ae.position,"%"):void 0;return Z("div",{key:ae.value,class:["v-slider-track__tick",{"v-slider-track__tick--filled":ae.position>=e.start&&ae.position<=e.stop,"v-slider-track__tick--first":ae.value===$.value,"v-slider-track__tick--last":ae.value===W.value}],style:{[ge.value]:Le}},[(ae.label||o["tick-label"])&&Z("div",{class:"v-slider-track__tick-label"},[((tt=o["tick-label"])==null?void 0:tt.call(o,{tick:ae,index:pe}))??ae.label])])}):[]);return cn(()=>Z("div",{class:["v-slider-track",ne.value,e.class],style:[{"--v-slider-track-size":Bn(B.value),"--v-slider-tick-size":Bn(r.value)},e.style]},[Z("div",{class:["v-slider-track__background",fe.value,{"v-slider-track__background--opacity":!!d.value||!L.value}],style:{...de.value,...be.value}},null),Z("div",{class:["v-slider-track__fill",ce.value],style:{...Y.value,...oe.value}},null),T.value&&Z("div",{class:["v-slider-track__ticks",{"v-slider-track__ticks--always-show":T.value==="always"}]},[ie.value])])),{}}}),uY=At({...M_(),...mB(),...su(),modelValue:{type:[Number,String],default:0}},"VSlider"),Jw=Jt()({name:"VSlider",props:uY(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,start:e=>!0,end:e=>!0},setup(e,t){let{slots:o,emit:c}=t;const d=rn(),{rtlClasses:v}=gs(),y=gB(e),T=ei(e,"modelValue",void 0,Ee=>y.roundValue(Ee??y.min.value)),{min:r,max:D,mousePressed:L,roundValue:B,onSliderMousedown:U,onSliderTouchstart:$,trackContainerRef:W,position:q,hasLabels:ne,readonly:ce}=_B({props:e,steps:y,onSliderStart:()=>{c("start",T.value)},onSliderEnd:Ee=>{let{value:de}=Ee;const re=B(de);T.value=re,c("end",re)},onSliderMove:Ee=>{let{value:de}=Ee;return T.value=B(de)},getActiveThumb:()=>{var Ee;return(Ee=d.value)==null?void 0:Ee.$el}}),{isFocused:oe,focus:fe,blur:be}=ou(e),ge=Se(()=>q(T.value));return cn(()=>{const Ee=Vs.filterProps(e),de=!!(e.label||o.label||o.prepend);return Z(Vs,fn({class:["v-slider",{"v-slider--has-labels":!!o["tick-label"]||ne.value,"v-slider--focused":oe.value,"v-slider--pressed":L.value,"v-slider--disabled":e.disabled},v.value,e.class],style:e.style},Ee,{focused:oe.value}),{...o,prepend:de?re=>{var Y,ie;return Z(Gn,null,[((Y=o.label)==null?void 0:Y.call(o,re))??(e.label?Z(Gp,{id:re.id.value,class:"v-slider__label",text:e.label},null):void 0),(ie=o.prepend)==null?void 0:ie.call(o,re)])}:void 0,default:re=>{let{id:Y,messagesId:ie}=re;return Z("div",{class:"v-slider__container",onMousedown:ce.value?void 0:U,onTouchstartPassive:ce.value?void 0:$},[Z("input",{id:Y.value,name:e.name||Y.value,disabled:!!e.disabled,readonly:!!e.readonly,tabindex:"-1",value:T.value},null),Z(vB,{ref:W,start:0,stop:ge.value},{"tick-label":o["tick-label"]}),Z(Kw,{ref:d,"aria-describedby":ie.value,focused:oe.value,min:r.value,max:D.value,modelValue:T.value,"onUpdate:modelValue":te=>T.value=te,position:ge.value,elevation:e.elevation,onFocus:fe,onBlur:be,ripple:e.ripple,name:e.name},{"thumb-label":o["thumb-label"]})])}})}),{}}}),hY=At({color:{type:Object},disabled:Boolean,hideAlpha:Boolean,...Nn()},"VColorPickerPreview"),dY=Ka({name:"VColorPickerPreview",props:hY(),emits:{"update:color":e=>!0},setup(e,t){let{emit:o}=t;const c=new AbortController;IS(()=>c.abort());async function d(){if(!AM)return;const v=new window.EyeDropper;try{const y=await v.open({signal:c.signal}),T=DL(y.sRGBHex);o("update:color",{...e.color??up,...T})}catch{}}return cn(()=>{var v,y;return Z("div",{class:["v-color-picker-preview",{"v-color-picker-preview--hide-alpha":e.hideAlpha},e.class],style:e.style},[AM&&Z("div",{class:"v-color-picker-preview__eye-dropper",key:"eyeDropper"},[Z(yr,{onClick:d,icon:"$eyeDropper",variant:"plain",density:"comfortable"},null)]),Z("div",{class:"v-color-picker-preview__dot"},[Z("div",{style:{background:ML(e.color??up)}},null)]),Z("div",{class:"v-color-picker-preview__sliders"},[Z(Jw,{class:"v-color-picker-preview__track v-color-picker-preview__hue",modelValue:(v=e.color)==null?void 0:v.h,"onUpdate:modelValue":T=>o("update:color",{...e.color??up,h:T}),step:0,min:0,max:360,disabled:e.disabled,thumbSize:14,trackSize:8,trackFillColor:"white",hideDetails:!0},null),!e.hideAlpha&&Z(Jw,{class:"v-color-picker-preview__track v-color-picker-preview__alpha",modelValue:((y=e.color)==null?void 0:y.a)??1,"onUpdate:modelValue":T=>o("update:color",{...e.color??up,a:T}),step:1/256,min:0,max:1,disabled:e.disabled,thumbSize:14,trackSize:8,trackFillColor:"white",hideDetails:!0},null)])])}),{}}}),fY={base:"#f44336",lighten5:"#ffebee",lighten4:"#ffcdd2",lighten3:"#ef9a9a",lighten2:"#e57373",lighten1:"#ef5350",darken1:"#e53935",darken2:"#d32f2f",darken3:"#c62828",darken4:"#b71c1c",accent1:"#ff8a80",accent2:"#ff5252",accent3:"#ff1744",accent4:"#d50000"},pY={base:"#e91e63",lighten5:"#fce4ec",lighten4:"#f8bbd0",lighten3:"#f48fb1",lighten2:"#f06292",lighten1:"#ec407a",darken1:"#d81b60",darken2:"#c2185b",darken3:"#ad1457",darken4:"#880e4f",accent1:"#ff80ab",accent2:"#ff4081",accent3:"#f50057",accent4:"#c51162"},mY={base:"#9c27b0",lighten5:"#f3e5f5",lighten4:"#e1bee7",lighten3:"#ce93d8",lighten2:"#ba68c8",lighten1:"#ab47bc",darken1:"#8e24aa",darken2:"#7b1fa2",darken3:"#6a1b9a",darken4:"#4a148c",accent1:"#ea80fc",accent2:"#e040fb",accent3:"#d500f9",accent4:"#aa00ff"},gY={base:"#673ab7",lighten5:"#ede7f6",lighten4:"#d1c4e9",lighten3:"#b39ddb",lighten2:"#9575cd",lighten1:"#7e57c2",darken1:"#5e35b1",darken2:"#512da8",darken3:"#4527a0",darken4:"#311b92",accent1:"#b388ff",accent2:"#7c4dff",accent3:"#651fff",accent4:"#6200ea"},_Y={base:"#3f51b5",lighten5:"#e8eaf6",lighten4:"#c5cae9",lighten3:"#9fa8da",lighten2:"#7986cb",lighten1:"#5c6bc0",darken1:"#3949ab",darken2:"#303f9f",darken3:"#283593",darken4:"#1a237e",accent1:"#8c9eff",accent2:"#536dfe",accent3:"#3d5afe",accent4:"#304ffe"},vY={base:"#2196f3",lighten5:"#e3f2fd",lighten4:"#bbdefb",lighten3:"#90caf9",lighten2:"#64b5f6",lighten1:"#42a5f5",darken1:"#1e88e5",darken2:"#1976d2",darken3:"#1565c0",darken4:"#0d47a1",accent1:"#82b1ff",accent2:"#448aff",accent3:"#2979ff",accent4:"#2962ff"},yY={base:"#03a9f4",lighten5:"#e1f5fe",lighten4:"#b3e5fc",lighten3:"#81d4fa",lighten2:"#4fc3f7",lighten1:"#29b6f6",darken1:"#039be5",darken2:"#0288d1",darken3:"#0277bd",darken4:"#01579b",accent1:"#80d8ff",accent2:"#40c4ff",accent3:"#00b0ff",accent4:"#0091ea"},bY={base:"#00bcd4",lighten5:"#e0f7fa",lighten4:"#b2ebf2",lighten3:"#80deea",lighten2:"#4dd0e1",lighten1:"#26c6da",darken1:"#00acc1",darken2:"#0097a7",darken3:"#00838f",darken4:"#006064",accent1:"#84ffff",accent2:"#18ffff",accent3:"#00e5ff",accent4:"#00b8d4"},xY={base:"#009688",lighten5:"#e0f2f1",lighten4:"#b2dfdb",lighten3:"#80cbc4",lighten2:"#4db6ac",lighten1:"#26a69a",darken1:"#00897b",darken2:"#00796b",darken3:"#00695c",darken4:"#004d40",accent1:"#a7ffeb",accent2:"#64ffda",accent3:"#1de9b6",accent4:"#00bfa5"},wY={base:"#4caf50",lighten5:"#e8f5e9",lighten4:"#c8e6c9",lighten3:"#a5d6a7",lighten2:"#81c784",lighten1:"#66bb6a",darken1:"#43a047",darken2:"#388e3c",darken3:"#2e7d32",darken4:"#1b5e20",accent1:"#b9f6ca",accent2:"#69f0ae",accent3:"#00e676",accent4:"#00c853"},SY={base:"#8bc34a",lighten5:"#f1f8e9",lighten4:"#dcedc8",lighten3:"#c5e1a5",lighten2:"#aed581",lighten1:"#9ccc65",darken1:"#7cb342",darken2:"#689f38",darken3:"#558b2f",darken4:"#33691e",accent1:"#ccff90",accent2:"#b2ff59",accent3:"#76ff03",accent4:"#64dd17"},TY={base:"#cddc39",lighten5:"#f9fbe7",lighten4:"#f0f4c3",lighten3:"#e6ee9c",lighten2:"#dce775",lighten1:"#d4e157",darken1:"#c0ca33",darken2:"#afb42b",darken3:"#9e9d24",darken4:"#827717",accent1:"#f4ff81",accent2:"#eeff41",accent3:"#c6ff00",accent4:"#aeea00"},EY={base:"#ffeb3b",lighten5:"#fffde7",lighten4:"#fff9c4",lighten3:"#fff59d",lighten2:"#fff176",lighten1:"#ffee58",darken1:"#fdd835",darken2:"#fbc02d",darken3:"#f9a825",darken4:"#f57f17",accent1:"#ffff8d",accent2:"#ffff00",accent3:"#ffea00",accent4:"#ffd600"},IY={base:"#ffc107",lighten5:"#fff8e1",lighten4:"#ffecb3",lighten3:"#ffe082",lighten2:"#ffd54f",lighten1:"#ffca28",darken1:"#ffb300",darken2:"#ffa000",darken3:"#ff8f00",darken4:"#ff6f00",accent1:"#ffe57f",accent2:"#ffd740",accent3:"#ffc400",accent4:"#ffab00"},CY={base:"#ff9800",lighten5:"#fff3e0",lighten4:"#ffe0b2",lighten3:"#ffcc80",lighten2:"#ffb74d",lighten1:"#ffa726",darken1:"#fb8c00",darken2:"#f57c00",darken3:"#ef6c00",darken4:"#e65100",accent1:"#ffd180",accent2:"#ffab40",accent3:"#ff9100",accent4:"#ff6d00"},AY={base:"#ff5722",lighten5:"#fbe9e7",lighten4:"#ffccbc",lighten3:"#ffab91",lighten2:"#ff8a65",lighten1:"#ff7043",darken1:"#f4511e",darken2:"#e64a19",darken3:"#d84315",darken4:"#bf360c",accent1:"#ff9e80",accent2:"#ff6e40",accent3:"#ff3d00",accent4:"#dd2c00"},PY={base:"#795548",lighten5:"#efebe9",lighten4:"#d7ccc8",lighten3:"#bcaaa4",lighten2:"#a1887f",lighten1:"#8d6e63",darken1:"#6d4c41",darken2:"#5d4037",darken3:"#4e342e",darken4:"#3e2723"},MY={base:"#607d8b",lighten5:"#eceff1",lighten4:"#cfd8dc",lighten3:"#b0bec5",lighten2:"#90a4ae",lighten1:"#78909c",darken1:"#546e7a",darken2:"#455a64",darken3:"#37474f",darken4:"#263238"},kY={base:"#9e9e9e",lighten5:"#fafafa",lighten4:"#f5f5f5",lighten3:"#eeeeee",lighten2:"#e0e0e0",lighten1:"#bdbdbd",darken1:"#757575",darken2:"#616161",darken3:"#424242",darken4:"#212121"},RY={black:"#000000",white:"#ffffff",transparent:"#ffffff00"},DY={red:fY,pink:pY,purple:mY,deepPurple:gY,indigo:_Y,blue:vY,lightBlue:yY,cyan:bY,teal:xY,green:wY,lightGreen:SY,lime:TY,yellow:EY,amber:IY,orange:CY,deepOrange:AY,brown:PY,blueGrey:MY,grey:kY,shades:RY},OY=At({swatches:{type:Array,default:()=>LY(DY)},disabled:Boolean,color:Object,maxHeight:[Number,String],...Nn()},"VColorPickerSwatches");function LY(e){return Object.keys(e).map(t=>{const o=e[t];return o.base?[o.base,o.darken4,o.darken3,o.darken2,o.darken1,o.lighten1,o.lighten2,o.lighten3,o.lighten4,o.lighten5]:[o.black,o.white,o.transparent]})}const zY=Ka({name:"VColorPickerSwatches",props:OY(),emits:{"update:color":e=>!0},setup(e,t){let{emit:o}=t;return cn(()=>Z("div",{class:["v-color-picker-swatches",e.class],style:[{maxHeight:Bn(e.maxHeight)},e.style]},[Z("div",null,[e.swatches.map(c=>Z("div",{class:"v-color-picker-swatches__swatch"},[c.map(d=>{const v=dl(d),y=W0(v),T=PL(v);return Z("div",{class:"v-color-picker-swatches__color",onClick:()=>y&&o("update:color",y)},[Z("div",{style:{background:T}},[e.color&&wc(e.color,y)?Z(br,{size:"x-small",icon:"$success",color:Nq(d,"#FFFFFF")>2?"white":"black"},null):void 0])])})]))])])),{}}}),hb=At({color:String,...Na(),...Nn(),...Ko(),...ls(),...iu(),...jp(),...co(),...Si(),...Ji()},"VSheet"),Td=Jt()({name:"VSheet",props:hb(),setup(e,t){let{slots:o}=t;const{themeClasses:c}=xr(e),{backgroundColorClasses:d,backgroundColorStyles:v}=Nr(Ht(e,"color")),{borderClasses:y}=Qa(e),{dimensionStyles:T}=Jo(e),{elevationClasses:r}=Is(e),{locationStyles:D}=Nd(e),{positionClasses:L}=$p(e),{roundedClasses:B}=So(e);return cn(()=>Z(e.tag,{class:["v-sheet",c.value,d.value,y.value,r.value,L.value,B.value,e.class],style:[v.value,T.value,D.value,e.style]},o)),{}}}),BY=At({canvasHeight:{type:[String,Number],default:150},disabled:Boolean,dotSize:{type:[Number,String],default:10},hideCanvas:Boolean,hideSliders:Boolean,hideInputs:Boolean,mode:{type:String,default:"rgba",validator:e=>Object.keys(pd).includes(e)},modes:{type:Array,default:()=>Object.keys(pd),validator:e=>Array.isArray(e)&&e.every(t=>Object.keys(pd).includes(t))},showSwatches:Boolean,swatches:Array,swatchesMaxHeight:{type:[Number,String],default:150},modelValue:{type:[Object,String]},...Yo(hb({width:300}),["height","location","minHeight","maxHeight","minWidth","maxWidth"])},"VColorPicker"),FY=Ka({name:"VColorPicker",props:BY(),emits:{"update:modelValue":e=>!0,"update:mode":e=>!0},setup(e){const t=ei(e,"mode"),o=rn(null),c=ei(e,"modelValue",void 0,r=>{if(r==null||r==="")return null;let D;try{D=W0(dl(r))}catch{return null}return D},r=>r?eY(r,e.modelValue):null),d=Se(()=>c.value?{...c.value,h:o.value??c.value.h}:null),{rtlClasses:v}=gs();let y=!0;On(c,r=>{if(!y){y=!0;return}r&&(o.value=r.h)},{immediate:!0});const T=r=>{y=!1,o.value=r.h,c.value=r};return ms(()=>{e.modes.includes(t.value)||(t.value=e.modes[0])}),wo({VSlider:{color:void 0,trackColor:void 0,trackFillColor:void 0}}),cn(()=>{const r=Td.filterProps(e);return Z(Td,fn({rounded:e.rounded,elevation:e.elevation,theme:e.theme,class:["v-color-picker",v.value,e.class],style:[{"--v-color-picker-color-hsv":ML({...d.value??up,a:1})},e.style]},r,{maxWidth:e.width}),{default:()=>[!e.hideCanvas&&Z(JX,{key:"canvas",color:d.value,"onUpdate:color":T,disabled:e.disabled,dotSize:e.dotSize,width:e.width,height:e.canvasHeight},null),(!e.hideSliders||!e.hideInputs)&&Z("div",{key:"controls",class:"v-color-picker__controls"},[!e.hideSliders&&Z(dY,{key:"preview",color:d.value,"onUpdate:color":T,hideAlpha:!t.value.endsWith("a"),disabled:e.disabled},null),!e.hideInputs&&Z(sY,{key:"edit",modes:e.modes,mode:t.value,"onUpdate:mode":D=>t.value=D,color:d.value,"onUpdate:color":T,disabled:e.disabled},null)]),e.showSwatches&&Z(zY,{key:"swatches",color:d.value,"onUpdate:color":T,maxHeight:e.swatchesMaxHeight,swatches:e.swatches,disabled:e.disabled},null)]})}),{}}});function VY(e,t,o){if(t==null)return e;if(Array.isArray(t))throw new Error("Multiple matches is not implemented");return typeof t=="number"&&~t?Z(Gn,null,[Z("span",{class:"v-combobox__unmask"},[e.substr(0,t)]),Z("span",{class:"v-combobox__mask"},[e.substr(t,o)]),Z("span",{class:"v-combobox__unmask"},[e.substr(t+o)])]):e}const NY=At({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...O_({filterKeys:["title"]}),...jT({hideNoData:!0,returnObject:!0}),...Yo(ab({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...Wl({transition:!1})},"VCombobox"),UY=Jt()({name:"VCombobox",props:NY(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:search":e=>!0,"update:menu":e=>!0},setup(e,t){var gn;let{emit:o,slots:c}=t;const{t:d}=zo(),v=rn(),y=kn(!1),T=kn(!0),r=kn(!1),D=rn(),L=rn(),B=ei(e,"menu"),U=Se({get:()=>B.value,set:Ae=>{var Ne;B.value&&!Ae&&((Ne=D.value)!=null&&Ne.openChildren.size)||(B.value=Ae)}}),$=kn(-1);let W=!1;const q=Se(()=>{var Ae;return(Ae=v.value)==null?void 0:Ae.color}),ne=Se(()=>U.value?e.closeText:e.openText),{items:ce,transformIn:oe,transformOut:fe}=LT(e),{textColorClasses:be,textColorStyles:ge}=Fs(q),Ee=ei(e,"modelValue",[],Ae=>oe(go(Ae)),Ae=>{const Ne=fe(Ae);return e.multiple?Ne:Ne[0]??null}),de=rb(),re=Se(()=>!!(e.chips||c.chip)),Y=Se(()=>re.value||!!c.selection),ie=kn(!e.multiple&&!Y.value?((gn=Ee.value[0])==null?void 0:gn.title)??"":""),te=Se({get:()=>ie.value,set:Ae=>{var Ne;if(ie.value=Ae??"",!e.multiple&&!Y.value&&(Ee.value=[eh(e,Ae)]),Ae&&e.multiple&&((Ne=e.delimiters)!=null&&Ne.length)){const Ue=Ae.split(new RegExp(`(?:${e.delimiters.join("|")})+`));Ue.length>1&&(Ue.forEach(Et=>{Et=Et.trim(),Et&&Nt(eh(e,Et))}),ie.value="")}Ae||($.value=-1),T.value=!Ae}}),ae=Se(()=>typeof e.counterValue=="function"?e.counterValue(Ee.value):typeof e.counterValue=="number"?e.counterValue:e.multiple?Ee.value.length:te.value.length);On(ie,Ae=>{W?Ki(()=>W=!1):y.value&&!U.value&&(U.value=!0),o("update:search",Ae)}),On(Ee,Ae=>{var Ne;!e.multiple&&!Y.value&&(ie.value=((Ne=Ae[0])==null?void 0:Ne.title)??"")});const{filteredItems:pe,getMatches:Le}=L_(e,ce,()=>T.value?"":te.value),tt=Se(()=>e.hideSelected?pe.value.filter(Ae=>!Ee.value.some(Ne=>Ne.value===Ae.value)):pe.value),Je=Se(()=>Ee.value.map(Ae=>Ae.value)),Mt=Se(()=>{var Ne;return(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&te.value===((Ne=tt.value[0])==null?void 0:Ne.title))&&tt.value.length>0&&!T.value&&!r.value}),Lt=Se(()=>e.hideNoData&&!tt.value.length||e.readonly||(de==null?void 0:de.isReadonly.value)),yt=rn(),rt=UT(yt,v);function mt(Ae){W=!0,e.openOnClear&&(U.value=!0)}function Ft(){Lt.value||(U.value=!0)}function bn(Ae){Lt.value||(y.value&&(Ae.preventDefault(),Ae.stopPropagation()),U.value=!U.value)}function Bt(Ae){var Ne;_0(Ae)&&((Ne=v.value)==null||Ne.focus())}function ht(Ae){var Et;if(hq(Ae)||e.readonly||de!=null&&de.isReadonly.value)return;const Ne=v.value.selectionStart,Ue=Ee.value.length;if(($.value>-1||["Enter","ArrowDown","ArrowUp"].includes(Ae.key))&&Ae.preventDefault(),["Enter","ArrowDown"].includes(Ae.key)&&(U.value=!0),["Escape"].includes(Ae.key)&&(U.value=!1),["Enter","Escape","Tab"].includes(Ae.key)&&(Mt.value&&["Enter","Tab"].includes(Ae.key)&&!Ee.value.some(Ct=>{let{value:Qt}=Ct;return Qt===tt.value[0].value})&&Nt(pe.value[0]),T.value=!0),Ae.key==="ArrowDown"&&Mt.value&&((Et=yt.value)==null||Et.focus("next")),Ae.key==="Enter"&&te.value&&(Nt(eh(e,te.value)),Y.value&&(ie.value="")),["Backspace","Delete"].includes(Ae.key)){if(!e.multiple&&Y.value&&Ee.value.length>0&&!te.value)return Nt(Ee.value[0],!1);if(~$.value){const Ct=$.value;Nt(Ee.value[$.value],!1),$.value=Ct>=Ue-1?Ue-2:Ct}else Ae.key==="Backspace"&&!te.value&&($.value=Ue-1)}if(e.multiple){if(Ae.key==="ArrowLeft"){if($.value<0&&Ne>0)return;const Ct=$.value>-1?$.value-1:Ue-1;Ee.value[Ct]?$.value=Ct:($.value=-1,v.value.setSelectionRange(te.value.length,te.value.length))}if(Ae.key==="ArrowRight"){if($.value<0)return;const Ct=$.value+1;Ee.value[Ct]?$.value=Ct:($.value=-1,v.value.setSelectionRange(0,0))}}}function gt(){var Ae;e.eager&&((Ae=L.value)==null||Ae.calculateVisibleItems())}function et(){var Ae;y.value&&(T.value=!0,(Ae=v.value)==null||Ae.focus())}function Nt(Ae){let Ne=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!Ae||Ae.props.disabled))if(e.multiple){const Ue=Ee.value.findIndex(Ct=>e.valueComparator(Ct.value,Ae.value)),Et=Ne??!~Ue;if(~Ue){const Ct=Et?[...Ee.value,Ae]:[...Ee.value];Ct.splice(Ue,1),Ee.value=Ct}else Et&&(Ee.value=[...Ee.value,Ae]);e.clearOnSelect&&(te.value="")}else{const Ue=Ne!==!1;Ee.value=Ue?[Ae]:[],ie.value=Ue&&!Y.value?Ae.title:"",Ki(()=>{U.value=!1,T.value=!0})}}function St(Ae){y.value=!0,setTimeout(()=>{r.value=!0})}function Xt(Ae){r.value=!1}function Ie(Ae){(Ae==null||Ae===""&&!e.multiple&&!Y.value)&&(Ee.value=[])}return On(y,(Ae,Ne)=>{if(!(Ae||Ae===Ne)&&($.value=-1,U.value=!1,te.value)){if(e.multiple){Nt(eh(e,te.value));return}if(!Y.value)return;Ee.value.some(Ue=>{let{title:Et}=Ue;return Et===te.value})?ie.value="":Nt(eh(e,te.value))}}),On(U,()=>{if(!e.hideSelected&&U.value&&Ee.value.length){const Ae=tt.value.findIndex(Ne=>Ee.value.some(Ue=>e.valueComparator(Ue.value,Ne.value)));Ar&&window.requestAnimationFrame(()=>{var Ne;Ae>=0&&((Ne=L.value)==null||Ne.scrollToIndex(Ae))})}}),On(()=>e.items,(Ae,Ne)=>{U.value||y.value&&!Ne.length&&Ae.length&&(U.value=!0)}),cn(()=>{const Ae=!!(!e.hideNoData||tt.value.length||c["prepend-item"]||c["append-item"]||c["no-data"]),Ne=Ee.value.length>0,Ue=xd.filterProps(e);return Z(xd,fn({ref:v},Ue,{modelValue:te.value,"onUpdate:modelValue":[Et=>te.value=Et,Ie],focused:y.value,"onUpdate:focused":Et=>y.value=Et,validationValue:Ee.externalValue,counterValue:ae.value,dirty:Ne,class:["v-combobox",{"v-combobox--active-menu":U.value,"v-combobox--chips":!!e.chips,"v-combobox--selection-slot":!!Y.value,"v-combobox--selecting-index":$.value>-1,[`v-combobox--${e.multiple?"multiple":"single"}`]:!0},e.class],style:e.style,readonly:e.readonly,placeholder:Ne?void 0:e.placeholder,"onClick:clear":mt,"onMousedown:control":Ft,onKeydown:ht}),{...c,default:()=>Z(Gn,null,[Z(Lp,fn({ref:D,modelValue:U.value,"onUpdate:modelValue":Et=>U.value=Et,activator:"parent",contentClass:"v-combobox__content",disabled:Lt.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterEnter:gt,onAfterLeave:et},e.menuProps),{default:()=>[Ae&&Z(ob,fn({ref:yt,selected:Je.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:Et=>Et.preventDefault(),onKeydown:Bt,onFocusin:St,onFocusout:Xt,tabindex:"-1","aria-live":"polite",color:e.itemColor??e.color},rt,e.listProps),{default:()=>{var Et,Ct,Qt;return[(Et=c["prepend-item"])==null?void 0:Et.call(c),!tt.value.length&&!e.hideNoData&&(((Ct=c["no-data"])==null?void 0:Ct.call(c))??Z(tu,{title:d(e.noDataText)},null)),Z(lb,{ref:L,renderless:!0,items:tt.value},{default:Gt=>{var Rn;let{item:Yt,index:vn,itemRef:dn}=Gt;const Wn=fn(Yt.props,{ref:dn,key:vn,active:Mt.value&&vn===0?!0:void 0,onClick:()=>Nt(Yt,null)});return((Rn=c.item)==null?void 0:Rn.call(c,{item:Yt,index:vn,props:Wn}))??Z(tu,fn(Wn,{role:"option"}),{prepend:hn=>{let{isSelected:jn}=hn;return Z(Gn,null,[e.multiple&&!e.hideSelected?Z(eu,{key:Yt.value,modelValue:jn,ripple:!1,tabindex:"-1"},null):void 0,Yt.props.prependAvatar&&Z(ml,{image:Yt.props.prependAvatar},null),Yt.props.prependIcon&&Z(br,{icon:Yt.props.prependIcon},null)])},title:()=>{var hn,jn;return T.value?Yt.title:VY(Yt.title,(hn=Le(Yt))==null?void 0:hn.title,((jn=te.value)==null?void 0:jn.length)??0)}})}}),(Qt=c["append-item"])==null?void 0:Qt.call(c)]}})]}),Ee.value.map((Et,Ct)=>{function Qt(dn){dn.stopPropagation(),dn.preventDefault(),Nt(Et,!1)}const Gt={"onClick:close":Qt,onKeydown(dn){dn.key!=="Enter"&&dn.key!==" "||(dn.preventDefault(),dn.stopPropagation(),Qt(dn))},onMousedown(dn){dn.preventDefault(),dn.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},Yt=re.value?!!c.chip:!!c.selection,vn=Yt?q0(re.value?c.chip({item:Et,index:Ct,props:Gt}):c.selection({item:Et,index:Ct})):void 0;if(!(Yt&&!vn))return Z("div",{key:Et.value,class:["v-combobox__selection",Ct===$.value&&["v-combobox__selection--selected",be.value]],style:Ct===$.value?ge.value:{}},[re.value?c.chip?Z(Li,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:Et.title}}},{default:()=>[vn]}):Z(Hp,fn({key:"chip",closable:e.closableChips,size:"small",text:Et.title,disabled:Et.props.disabled},Gt),null):vn??Z("span",{class:"v-combobox__selection-text"},[Et.title,e.multiple&&Ct<Ee.value.length-1&&Z("span",{class:"v-combobox__selection-comma"},[$o(",")])])])})]),"append-inner":function(){var Gt;for(var Et=arguments.length,Ct=new Array(Et),Qt=0;Qt<Et;Qt++)Ct[Qt]=arguments[Qt];return Z(Gn,null,[(Gt=c["append-inner"])==null?void 0:Gt.call(c,...Ct),(!e.hideNoData||e.items.length)&&e.menuIcon?Z(br,{class:"v-combobox__menu-icon",icon:e.menuIcon,onMousedown:bn,onClick:wL,"aria-label":d(ne.value),title:d(ne.value),tabindex:"-1"},null):void 0])}})}),yl({isFocused:y,isPristine:T,menu:U,search:te,selectionIndex:$,filteredItems:pe,select:Nt},v)}}),jY=At({modelValue:null,color:String,cancelText:{type:String,default:"$vuetify.confirmEdit.cancel"},okText:{type:String,default:"$vuetify.confirmEdit.ok"}},"VConfirmEdit"),$Y=Jt()({name:"VConfirmEdit",props:jY(),emits:{cancel:()=>!0,save:e=>!0,"update:modelValue":e=>!0},setup(e,t){let{emit:o,slots:c}=t;const d=ei(e,"modelValue"),v=rn();Oo(()=>{v.value=structuredClone(ui(d.value))});const{t:y}=zo(),T=Se(()=>wc(d.value,v.value));function r(){d.value=v.value,o("save",v.value)}function D(){v.value=structuredClone(ui(d.value)),o("cancel")}let L=!1;return cn(()=>{var U;const B=Z(Gn,null,[Z(yr,{disabled:T.value,variant:"text",color:e.color,onClick:D,text:y(e.cancelText)},null),Z(yr,{disabled:T.value,variant:"text",color:e.color,onClick:r,text:y(e.okText)},null)]);return Z(Gn,null,[(U=c.default)==null?void 0:U.call(c,{model:v,save:r,cancel:D,isPristine:T.value,get actions(){return L=!0,B}}),!L&&B])}),{save:r,cancel:D,isPristine:T}}}),yB=At({expandOnClick:Boolean,showExpand:Boolean,expanded:{type:Array,default:()=>[]}},"DataTable-expand"),bB=Symbol.for("vuetify:datatable:expanded");function db(e){const t=Ht(e,"expandOnClick"),o=ei(e,"expanded",e.expanded,T=>new Set(T),T=>[...T.values()]);function c(T,r){const D=new Set(o.value);r?D.add(T.value):D.delete(T.value),o.value=D}function d(T){return o.value.has(T.value)}function v(T){c(T,!d(T))}const y={expand:c,expanded:o,expandOnClick:t,isExpanded:d,toggleExpand:v};return Vr(bB,y),y}function xB(){const e=Mi(bB);if(!e)throw new Error("foo");return e}const qT=At({groupBy:{type:Array,default:()=>[]}},"DataTable-group"),wB=Symbol.for("vuetify:data-table-group");function WT(e){return{groupBy:ei(e,"groupBy")}}function fb(e){const{disableSort:t,groupBy:o,sortBy:c}=e,d=rn(new Set),v=Se(()=>o.value.map(L=>({...L,order:L.order??!1})).concat(t!=null&&t.value?[]:c.value));function y(L){return d.value.has(L.id)}function T(L){const B=new Set(d.value);y(L)?B.delete(L.id):B.add(L.id),d.value=B}function r(L){function B(U){const $=[];for(const W of U.items)"type"in W&&W.type==="group"?$.push(...B(W)):$.push(W);return $}return B({type:"group",items:L,id:"dummy",key:"dummy",value:"dummy",depth:0})}const D={sortByWithGroups:v,toggleGroup:T,opened:d,groupBy:o,extractRows:r,isGroupOpen:y};return Vr(wB,D),D}function SB(){const e=Mi(wB);if(!e)throw new Error("Missing group!");return e}function GY(e,t){if(!e.length)return[];const o=new Map;for(const c of e){const d=bd(c.raw,t);o.has(d)||o.set(d,[]),o.get(d).push(c)}return o}function TB(e,t){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,c=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"root";if(!t.length)return[];const d=GY(e,t[0]),v=[],y=t.slice(1);return d.forEach((T,r)=>{const D=t[0],L=`${c}_${D}_${r}`;v.push({depth:o,id:L,key:D,value:r,items:y.length?TB(T,y,o+1,L):T,type:"group"})}),v}function EB(e,t){const o=[];for(const c of e)"type"in c&&c.type==="group"?(c.value!=null&&o.push(c),(t.has(c.id)||c.value==null)&&o.push(...EB(c.items,t))):o.push(c);return o}function pb(e,t,o){return{flatItems:Se(()=>{if(!t.value.length)return e.value;const d=TB(e.value,t.value.map(v=>v.key));return EB(d,o.value)})}}function mb(e){let{page:t,itemsPerPage:o,sortBy:c,groupBy:d,search:v}=e;const y=Lo("VDataTable"),T=Se(()=>({page:t.value,itemsPerPage:o.value,sortBy:c.value,groupBy:d.value,search:v.value}));let r=null;On(T,()=>{wc(r,T.value)||(r&&r.search!==T.value.search&&(t.value=1),y.emit("update:options",T.value),r=T.value)},{deep:!0,immediate:!0})}const ZT=At({page:{type:[Number,String],default:1},itemsPerPage:{type:[Number,String],default:10}},"DataTable-paginate"),IB=Symbol.for("vuetify:data-table-pagination");function XT(e){const t=ei(e,"page",void 0,c=>+(c??1)),o=ei(e,"itemsPerPage",void 0,c=>+(c??10));return{page:t,itemsPerPage:o}}function YT(e){const{page:t,itemsPerPage:o,itemsLength:c}=e,d=Se(()=>o.value===-1?0:o.value*(t.value-1)),v=Se(()=>o.value===-1?c.value:Math.min(c.value,d.value+o.value)),y=Se(()=>o.value===-1||c.value===0?1:Math.ceil(c.value/o.value));Oo(()=>{t.value>y.value&&(t.value=y.value)});function T(U){o.value=U,t.value=1}function r(){t.value=Go(t.value+1,1,y.value)}function D(){t.value=Go(t.value-1,1,y.value)}function L(U){t.value=Go(U,1,y.value)}const B={page:t,itemsPerPage:o,startIndex:d,stopIndex:v,pageCount:y,itemsLength:c,nextPage:r,prevPage:D,setPage:L,setItemsPerPage:T};return Vr(IB,B),B}function HY(){const e=Mi(IB);if(!e)throw new Error("Missing pagination!");return e}function CB(e){const t=Lo("usePaginatedItems"),{items:o,startIndex:c,stopIndex:d,itemsPerPage:v}=e,y=Se(()=>v.value<=0?o.value:o.value.slice(c.value,d.value));return On(y,T=>{t.emit("update:currentItems",T)}),{paginatedItems:y}}const qY={showSelectAll:!1,allSelected:()=>[],select:e=>{var c;let{items:t,value:o}=e;return new Set(o?[(c=t[0])==null?void 0:c.value]:[])},selectAll:e=>{let{selected:t}=e;return t}},AB={showSelectAll:!0,allSelected:e=>{let{currentPage:t}=e;return t},select:e=>{let{items:t,value:o,selected:c}=e;for(const d of t)o?c.add(d.value):c.delete(d.value);return c},selectAll:e=>{let{value:t,currentPage:o,selected:c}=e;return AB.select({items:o,value:t,selected:c})}},PB={showSelectAll:!0,allSelected:e=>{let{allItems:t}=e;return t},select:e=>{let{items:t,value:o,selected:c}=e;for(const d of t)o?c.add(d.value):c.delete(d.value);return c},selectAll:e=>{let{value:t,allItems:o,selected:c}=e;return PB.select({items:o,value:t,selected:c})}},MB=At({showSelect:Boolean,selectStrategy:{type:[String,Object],default:"page"},modelValue:{type:Array,default:()=>[]},valueComparator:{type:Function,default:wc}},"DataTable-select"),kB=Symbol.for("vuetify:data-table-selection");function gb(e,t){let{allItems:o,currentPage:c}=t;const d=ei(e,"modelValue",e.modelValue,ce=>new Set(go(ce).map(oe=>{var fe;return((fe=o.value.find(be=>e.valueComparator(oe,be.value)))==null?void 0:fe.value)??oe})),ce=>[...ce.values()]),v=Se(()=>o.value.filter(ce=>ce.selectable)),y=Se(()=>c.value.filter(ce=>ce.selectable)),T=Se(()=>{if(typeof e.selectStrategy=="object")return e.selectStrategy;switch(e.selectStrategy){case"single":return qY;case"all":return PB;case"page":default:return AB}});function r(ce){return go(ce).every(oe=>d.value.has(oe.value))}function D(ce){return go(ce).some(oe=>d.value.has(oe.value))}function L(ce,oe){const fe=T.value.select({items:ce,value:oe,selected:new Set(d.value)});d.value=fe}function B(ce){L([ce],!r([ce]))}function U(ce){const oe=T.value.selectAll({value:ce,allItems:v.value,currentPage:y.value,selected:new Set(d.value)});d.value=oe}const $=Se(()=>d.value.size>0),W=Se(()=>{const ce=T.value.allSelected({allItems:v.value,currentPage:y.value});return!!ce.length&&r(ce)}),q=Se(()=>T.value.showSelectAll),ne={toggleSelect:B,select:L,selectAll:U,isSelected:r,isSomeSelected:D,someSelected:$,allSelected:W,showSelectAll:q};return Vr(kB,ne),ne}function _b(){const e=Mi(kB);if(!e)throw new Error("Missing selection!");return e}const RB=At({sortBy:{type:Array,default:()=>[]},customKeySort:Object,multiSort:Boolean,mustSort:Boolean},"DataTable-sort"),DB=Symbol.for("vuetify:data-table-sort");function vb(e){const t=ei(e,"sortBy"),o=Ht(e,"mustSort"),c=Ht(e,"multiSort");return{sortBy:t,mustSort:o,multiSort:c}}function yb(e){const{sortBy:t,mustSort:o,multiSort:c,page:d}=e,v=r=>{if(r.key==null)return;let D=t.value.map(B=>({...B}))??[];const L=D.find(B=>B.key===r.key);L?L.order==="desc"?o.value?L.order="asc":D=D.filter(B=>B.key!==r.key):L.order="desc":c.value?D=[...D,{key:r.key,order:"asc"}]:D=[{key:r.key,order:"asc"}],t.value=D,d&&(d.value=1)};function y(r){return!!t.value.find(D=>D.key===r.key)}const T={sortBy:t,toggleSort:v,isSorted:y};return Vr(DB,T),T}function OB(){const e=Mi(DB);if(!e)throw new Error("Missing sort!");return e}function KT(e,t,o,c){const d=zo();return{sortedItems:Se(()=>{var y,T;return o.value.length?WY(t.value,o.value,d.current.value,{transform:c==null?void 0:c.transform,sortFunctions:{...e.customKeySort,...(y=c==null?void 0:c.sortFunctions)==null?void 0:y.value},sortRawFunctions:(T=c==null?void 0:c.sortRawFunctions)==null?void 0:T.value}):t.value})}}function WY(e,t,o,c){const d=new Intl.Collator(o,{sensitivity:"accent",usage:"sort"});return e.map(y=>[y,c!=null&&c.transform?c.transform(y):y]).sort((y,T)=>{var r,D;for(let L=0;L<t.length;L++){let B=!1;const U=t[L].key,$=t[L].order??"asc";if($===!1)continue;let W=bd(y[1],U),q=bd(T[1],U),ne=y[0].raw,ce=T[0].raw;if($==="desc"&&([W,q]=[q,W],[ne,ce]=[ce,ne]),(r=c==null?void 0:c.sortRawFunctions)!=null&&r[U]){const oe=c.sortRawFunctions[U](ne,ce);if(oe==null)continue;if(B=!0,oe)return oe}if((D=c==null?void 0:c.sortFunctions)!=null&&D[U]){const oe=c.sortFunctions[U](W,q);if(oe==null)continue;if(B=!0,oe)return oe}if(!B){if(W instanceof Date&&q instanceof Date)return W.getTime()-q.getTime();if([W,q]=[W,q].map(oe=>oe!=null?oe.toString().toLocaleLowerCase():oe),W!==q)return Py(W)&&Py(q)?0:Py(W)?-1:Py(q)?1:!isNaN(W)&&!isNaN(q)?Number(W)-Number(q):d.compare(W,q)}}return 0}).map(y=>{let[T]=y;return T})}const ZY=At({items:{type:Array,default:()=>[]},itemValue:{type:[String,Array,Function],default:"id"},itemSelectable:{type:[String,Array,Function],default:null},returnObject:Boolean},"DataIterator-items");function XY(e,t){const o=e.returnObject?t:as(t,e.itemValue),c=as(t,e.itemSelectable,!0);return{type:"item",value:o,selectable:c,raw:t}}function YY(e,t){const o=[];for(const c of t)o.push(XY(e,c));return o}function KY(e){return{items:Se(()=>YY(e,e.items))}}const JY=At({search:String,loading:Boolean,...Nn(),...ZY(),...MB(),...RB(),...ZT({itemsPerPage:5}),...yB(),...qT(),...O_(),...Si(),...Wl({transition:{component:r_,hideOnLeave:!0}})},"VDataIterator"),QY=Jt()({name:"VDataIterator",props:JY(),emits:{"update:modelValue":e=>!0,"update:groupBy":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:currentItems":e=>!0},setup(e,t){let{slots:o}=t;const c=ei(e,"groupBy"),d=Ht(e,"search"),{items:v}=KY(e),{filteredItems:y}=L_(e,v,d,{transform:mt=>mt.raw}),{sortBy:T,multiSort:r,mustSort:D}=vb(e),{page:L,itemsPerPage:B}=XT(e),{toggleSort:U}=yb({sortBy:T,multiSort:r,mustSort:D,page:L}),{sortByWithGroups:$,opened:W,extractRows:q,isGroupOpen:ne,toggleGroup:ce}=fb({groupBy:c,sortBy:T}),{sortedItems:oe}=KT(e,y,$,{transform:mt=>mt.raw}),{flatItems:fe}=pb(oe,c,W),be=Se(()=>fe.value.length),{startIndex:ge,stopIndex:Ee,pageCount:de,prevPage:re,nextPage:Y,setItemsPerPage:ie,setPage:te}=YT({page:L,itemsPerPage:B,itemsLength:be}),{paginatedItems:ae}=CB({items:fe,startIndex:ge,stopIndex:Ee,itemsPerPage:B}),pe=Se(()=>q(ae.value)),{isSelected:Le,select:tt,selectAll:Je,toggleSelect:Mt}=gb(e,{allItems:v,currentPage:pe}),{isExpanded:Lt,toggleExpand:yt}=db(e);mb({page:L,itemsPerPage:B,sortBy:T,groupBy:c,search:d});const rt=Se(()=>({page:L.value,itemsPerPage:B.value,sortBy:T.value,pageCount:de.value,toggleSort:U,prevPage:re,nextPage:Y,setPage:te,setItemsPerPage:ie,isSelected:Le,select:tt,selectAll:Je,toggleSelect:Mt,isExpanded:Lt,toggleExpand:yt,isGroupOpen:ne,toggleGroup:ce,items:pe.value,groupedItems:ae.value}));return cn(()=>Z(e.tag,{class:["v-data-iterator",{"v-data-iterator--loading":e.loading},e.class],style:e.style},{default:()=>{var mt,Ft;return[(mt=o.header)==null?void 0:mt.call(o,rt.value),Z(Xs,{transition:e.transition},{default:()=>{var bn,Bt;return[e.loading?Z(C_,{key:"loader",name:"v-data-iterator",active:!0},{default:ht=>{var gt;return(gt=o.loader)==null?void 0:gt.call(o,ht)}}):Z("div",{key:"items"},[ae.value.length?(Bt=o.default)==null?void 0:Bt.call(o,rt.value):(bn=o["no-data"])==null?void 0:bn.call(o)])]}}),(Ft=o.footer)==null?void 0:Ft.call(o,rt.value)]}})),{}}});function eK(){const e=rn([]);ER(()=>e.value=[]);function t(o,c){e.value[c]=o}return{refs:e,updateRef:t}}const tK=At({activeColor:String,start:{type:[Number,String],default:1},modelValue:{type:Number,default:e=>e.start},disabled:Boolean,length:{type:[Number,String],default:1,validator:e=>e%1===0},totalVisible:[Number,String],firstIcon:{type:mi,default:"$first"},prevIcon:{type:mi,default:"$prev"},nextIcon:{type:mi,default:"$next"},lastIcon:{type:mi,default:"$last"},ariaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.root"},pageAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.page"},currentPageAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.currentPage"},firstAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.first"},previousAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.previous"},nextAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.next"},lastAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.last"},ellipsis:{type:String,default:"..."},showFirstLastPage:Boolean,...Na(),...Nn(),..._s(),...ls(),...co(),...Ec(),...Si({tag:"nav"}),...Ji(),...vl({variant:"text"})},"VPagination"),Qw=Jt()({name:"VPagination",props:tK(),emits:{"update:modelValue":e=>!0,first:e=>!0,prev:e=>!0,next:e=>!0,last:e=>!0},setup(e,t){let{slots:o,emit:c}=t;const d=ei(e,"modelValue"),{t:v,n:y}=zo(),{isRtl:T}=gs(),{themeClasses:r}=xr(e),{width:D}=_l(),L=kn(-1);wo(void 0,{scoped:!0});const{resizeRef:B}=$l(re=>{if(!re.length)return;const{target:Y,contentRect:ie}=re[0],te=Y.querySelector(".v-pagination__list > *");if(!te)return;const ae=ie.width,pe=te.offsetWidth+parseFloat(getComputedStyle(te).marginRight)*2;L.value=q(ae,pe)}),U=Se(()=>parseInt(e.length,10)),$=Se(()=>parseInt(e.start,10)),W=Se(()=>e.totalVisible!=null?parseInt(e.totalVisible,10):L.value>=0?L.value:q(D.value,58));function q(re,Y){const ie=e.showFirstLastPage?5:3;return Math.max(0,Math.floor(+((re-Y*ie)/Y).toFixed(2)))}const ne=Se(()=>{if(U.value<=0||isNaN(U.value)||U.value>Number.MAX_SAFE_INTEGER)return[];if(W.value<=0)return[];if(W.value===1)return[d.value];if(U.value<=W.value)return dc(U.value,$.value);const re=W.value%2===0,Y=re?W.value/2:Math.floor(W.value/2),ie=re?Y:Y+1,te=U.value-Y;if(ie-d.value>=0)return[...dc(Math.max(1,W.value-1),$.value),e.ellipsis,U.value];if(d.value-te>=(re?1:0)){const ae=W.value-1,pe=U.value-ae+$.value;return[$.value,e.ellipsis,...dc(ae,pe)]}else{const ae=Math.max(1,W.value-3),pe=ae===1?d.value:d.value-Math.ceil(ae/2)+$.value;return[$.value,e.ellipsis,...dc(ae,pe),e.ellipsis,U.value]}});function ce(re,Y,ie){re.preventDefault(),d.value=Y,ie&&c(ie,Y)}const{refs:oe,updateRef:fe}=eK();wo({VPaginationBtn:{color:Ht(e,"color"),border:Ht(e,"border"),density:Ht(e,"density"),size:Ht(e,"size"),variant:Ht(e,"variant"),rounded:Ht(e,"rounded"),elevation:Ht(e,"elevation")}});const be=Se(()=>ne.value.map((re,Y)=>{const ie=te=>fe(te,Y);if(typeof re=="string")return{isActive:!1,key:`ellipsis-${Y}`,page:re,props:{ref:ie,ellipsis:!0,icon:!0,disabled:!0}};{const te=re===d.value;return{isActive:te,key:re,page:y(re),props:{ref:ie,ellipsis:!1,icon:!0,disabled:!!e.disabled||+e.length<2,color:te?e.activeColor:e.color,"aria-current":te,"aria-label":v(te?e.currentPageAriaLabel:e.pageAriaLabel,re),onClick:ae=>ce(ae,re)}}}})),ge=Se(()=>{const re=!!e.disabled||d.value<=$.value,Y=!!e.disabled||d.value>=$.value+U.value-1;return{first:e.showFirstLastPage?{icon:T.value?e.lastIcon:e.firstIcon,onClick:ie=>ce(ie,$.value,"first"),disabled:re,"aria-label":v(e.firstAriaLabel),"aria-disabled":re}:void 0,prev:{icon:T.value?e.nextIcon:e.prevIcon,onClick:ie=>ce(ie,d.value-1,"prev"),disabled:re,"aria-label":v(e.previousAriaLabel),"aria-disabled":re},next:{icon:T.value?e.prevIcon:e.nextIcon,onClick:ie=>ce(ie,d.value+1,"next"),disabled:Y,"aria-label":v(e.nextAriaLabel),"aria-disabled":Y},last:e.showFirstLastPage?{icon:T.value?e.firstIcon:e.lastIcon,onClick:ie=>ce(ie,$.value+U.value-1,"last"),disabled:Y,"aria-label":v(e.lastAriaLabel),"aria-disabled":Y}:void 0}});function Ee(){var Y;const re=d.value-$.value;(Y=oe.value[re])==null||Y.$el.focus()}function de(re){re.key===Cw.left&&!e.disabled&&d.value>+e.start?(d.value=d.value-1,Ki(Ee)):re.key===Cw.right&&!e.disabled&&d.value<$.value+U.value-1&&(d.value=d.value+1,Ki(Ee))}return cn(()=>Z(e.tag,{ref:B,class:["v-pagination",r.value,e.class],style:e.style,role:"navigation","aria-label":v(e.ariaLabel),onKeydown:de,"data-test":"v-pagination-root"},{default:()=>[Z("ul",{class:"v-pagination__list"},[e.showFirstLastPage&&Z("li",{key:"first",class:"v-pagination__first","data-test":"v-pagination-first"},[o.first?o.first(ge.value.first):Z(yr,fn({_as:"VPaginationBtn"},ge.value.first),null)]),Z("li",{key:"prev",class:"v-pagination__prev","data-test":"v-pagination-prev"},[o.prev?o.prev(ge.value.prev):Z(yr,fn({_as:"VPaginationBtn"},ge.value.prev),null)]),be.value.map((re,Y)=>Z("li",{key:re.key,class:["v-pagination__item",{"v-pagination__item--is-active":re.isActive}],"data-test":"v-pagination-item"},[o.item?o.item(re):Z(yr,fn({_as:"VPaginationBtn"},re.props),{default:()=>[re.page]})])),Z("li",{key:"next",class:"v-pagination__next","data-test":"v-pagination-next"},[o.next?o.next(ge.value.next):Z(yr,fn({_as:"VPaginationBtn"},ge.value.next),null)]),e.showFirstLastPage&&Z("li",{key:"last",class:"v-pagination__last","data-test":"v-pagination-last"},[o.last?o.last(ge.value.last):Z(yr,fn({_as:"VPaginationBtn"},ge.value.last),null)])])]})),{}}}),JT=At({prevIcon:{type:mi,default:"$prev"},nextIcon:{type:mi,default:"$next"},firstIcon:{type:mi,default:"$first"},lastIcon:{type:mi,default:"$last"},itemsPerPageText:{type:String,default:"$vuetify.dataFooter.itemsPerPageText"},pageText:{type:String,default:"$vuetify.dataFooter.pageText"},firstPageLabel:{type:String,default:"$vuetify.dataFooter.firstPage"},prevPageLabel:{type:String,default:"$vuetify.dataFooter.prevPage"},nextPageLabel:{type:String,default:"$vuetify.dataFooter.nextPage"},lastPageLabel:{type:String,default:"$vuetify.dataFooter.lastPage"},itemsPerPageOptions:{type:Array,default:()=>[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"},{value:-1,title:"$vuetify.dataFooter.itemsPerPageAll"}]},showCurrentPage:Boolean},"VDataTableFooter"),u_=Jt()({name:"VDataTableFooter",props:JT(),setup(e,t){let{slots:o}=t;const{t:c}=zo(),{page:d,pageCount:v,startIndex:y,stopIndex:T,itemsLength:r,itemsPerPage:D,setItemsPerPage:L}=HY(),B=Se(()=>e.itemsPerPageOptions.map(U=>typeof U=="number"?{value:U,title:U===-1?c("$vuetify.dataFooter.itemsPerPageAll"):String(U)}:{...U,title:isNaN(Number(U.title))?c(U.title):U.title}));return cn(()=>{var $;const U=Qw.filterProps(e);return Z("div",{class:"v-data-table-footer"},[($=o.prepend)==null?void 0:$.call(o),Z("div",{class:"v-data-table-footer__items-per-page"},[Z("span",null,[c(e.itemsPerPageText)]),Z($T,{items:B.value,modelValue:D.value,"onUpdate:modelValue":W=>L(Number(W)),density:"compact",variant:"outlined","hide-details":!0},null)]),Z("div",{class:"v-data-table-footer__info"},[Z("div",null,[c(e.pageText,r.value?y.value+1:0,T.value,r.value)])]),Z("div",{class:"v-data-table-footer__pagination"},[Z(Qw,fn({modelValue:d.value,"onUpdate:modelValue":W=>d.value=W,density:"comfortable","first-aria-label":e.firstPageLabel,"last-aria-label":e.lastPageLabel,length:v.value,"next-aria-label":e.nextPageLabel,"previous-aria-label":e.prevPageLabel,rounded:!0,"show-first-last-page":!0,"total-visible":e.showCurrentPage?1:0,variant:"plain"},U),null)])])}),{}}}),S0=Hq({align:{type:String,default:"start"},fixed:Boolean,fixedOffset:[Number,String],height:[Number,String],lastFixed:Boolean,noPadding:Boolean,tag:String,width:[Number,String],maxWidth:[Number,String],nowrap:Boolean},(e,t)=>{let{slots:o}=t;const c=e.tag??"td";return Z(c,{class:["v-data-table__td",{"v-data-table-column--fixed":e.fixed,"v-data-table-column--last-fixed":e.lastFixed,"v-data-table-column--no-padding":e.noPadding,"v-data-table-column--nowrap":e.nowrap},`v-data-table-column--align-${e.align}`],style:{height:Bn(e.height),width:Bn(e.width),maxWidth:Bn(e.maxWidth),left:Bn(e.fixedOffset||null)}},{default:()=>{var d;return[(d=o.default)==null?void 0:d.call(o)]}})}),nK=At({headers:Array},"DataTable-header"),LB=Symbol.for("vuetify:data-table-headers"),zB={title:"",sortable:!1},iK={...zB,width:48};function rK(){const t=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).map(o=>({element:o,priority:0}));return{enqueue:(o,c)=>{let d=!1;for(let v=0;v<t.length;v++)if(t[v].priority>c){t.splice(v,0,{element:o,priority:c}),d=!0;break}d||t.push({element:o,priority:c})},size:()=>t.length,count:()=>{let o=0;if(!t.length)return 0;const c=Math.floor(t[0].priority);for(let d=0;d<t.length;d++)Math.floor(t[d].priority)===c&&(o+=1);return o},dequeue:()=>t.shift()}}function eS(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];if(!e.children)t.push(e);else for(const o of e.children)eS(o,t);return t}function BB(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Set;for(const o of e)o.key&&t.add(o.key),o.children&&BB(o.children,t);return t}function oK(e){if(e.key){if(e.key==="data-table-group")return zB;if(["data-table-expand","data-table-select"].includes(e.key))return iK}}function QT(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return e.children?Math.max(t,...e.children.map(o=>QT(o,t+1))):t}function sK(e){let t=!1;function o(v){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(v)if(y&&(v.fixed=!0),v.fixed)if(v.children)for(let T=v.children.length-1;T>=0;T--)o(v.children[T],!0);else t?isNaN(+v.width)&&(`${v.key}`,void 0):v.lastFixed=!0,t=!0;else if(v.children)for(let T=v.children.length-1;T>=0;T--)o(v.children[T]);else t=!1}for(let v=e.length-1;v>=0;v--)o(e[v]);function c(v){let y=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!v)return y;if(v.children){v.fixedOffset=y;for(const T of v.children)y=c(T,y)}else v.fixed&&(v.fixedOffset=y,y+=parseFloat(v.width||"0")||0);return y}let d=0;for(const v of e)d=c(v,d)}function aK(e,t){const o=[];let c=0;const d=rK(e);for(;d.size()>0;){let y=d.count();const T=[];let r=1;for(;y>0;){const{element:D,priority:L}=d.dequeue(),B=t-c-QT(D);if(T.push({...D,rowspan:B??1,colspan:D.children?eS(D).length:1}),D.children)for(const U of D.children){const $=L%1+r/Math.pow(10,c+2);d.enqueue(U,c+B+$)}r+=1,y-=1}c+=1,o.push(T)}return{columns:e.map(y=>eS(y)).flat(),headers:o}}function FB(e){const t=[];for(const o of e){const c={...oK(o),...o},d=c.key??(typeof c.value=="string"?c.value:null),v=c.value??d??null,y={...c,key:d,value:v,sortable:c.sortable??(c.key!=null||!!c.sort),children:c.children?FB(c.children):void 0};t.push(y)}return t}function eE(e,t){const o=rn([]),c=rn([]),d=rn({}),v=rn({}),y=rn({});Oo(()=>{var q,ne,ce;const D=(e.headers||Object.keys(e.items[0]??{}).map(oe=>({key:oe,title:yc(oe)}))).slice(),L=BB(D);(q=t==null?void 0:t.groupBy)!=null&&q.value.length&&!L.has("data-table-group")&&D.unshift({key:"data-table-group",title:"Group"}),(ne=t==null?void 0:t.showSelect)!=null&&ne.value&&!L.has("data-table-select")&&D.unshift({key:"data-table-select"}),(ce=t==null?void 0:t.showExpand)!=null&&ce.value&&!L.has("data-table-expand")&&D.push({key:"data-table-expand"});const B=FB(D);sK(B);const U=Math.max(...B.map(oe=>QT(oe)))+1,$=aK(B,U);o.value=$.headers,c.value=$.columns;const W=$.headers.flat(1);for(const oe of W)oe.key&&(oe.sortable&&(oe.sort&&(d.value[oe.key]=oe.sort),oe.sortRaw&&(v.value[oe.key]=oe.sortRaw)),oe.filter&&(y.value[oe.key]=oe.filter))});const T={headers:o,columns:c,sortFunctions:d,sortRawFunctions:v,filterFunctions:y};return Vr(LB,T),T}function bb(){const e=Mi(LB);if(!e)throw new Error("Missing headers!");return e}const VB=At({color:String,sticky:Boolean,disableSort:Boolean,multiSort:Boolean,sortAscIcon:{type:mi,default:"$sortAsc"},sortDescIcon:{type:mi,default:"$sortDesc"},headerProps:{type:Object},...Rd(),...tb()},"VDataTableHeaders"),Ed=Jt()({name:"VDataTableHeaders",props:VB(),setup(e,t){let{slots:o}=t;const{t:c}=zo(),{toggleSort:d,sortBy:v,isSorted:y}=OB(),{someSelected:T,allSelected:r,selectAll:D,showSelectAll:L}=_b(),{columns:B,headers:U}=bb(),{loaderClasses:$}=I_(e);function W(re,Y){if(!(!e.sticky&&!re.fixed))return{position:"sticky",left:re.fixed?Bn(re.fixedOffset):void 0,top:e.sticky?`calc(var(--v-table-header-height) * ${Y})`:void 0}}function q(re){const Y=v.value.find(ie=>ie.key===re.key);return Y?Y.order==="asc"?e.sortAscIcon:e.sortDescIcon:e.sortAscIcon}const{backgroundColorClasses:ne,backgroundColorStyles:ce}=Nr(e,"color"),{displayClasses:oe,mobile:fe}=_l(e),be=Se(()=>({headers:U.value,columns:B.value,toggleSort:d,isSorted:y,sortBy:v.value,someSelected:T.value,allSelected:r.value,selectAll:D,getSortIcon:q})),ge=Se(()=>["v-data-table__th",{"v-data-table__th--sticky":e.sticky},oe.value,$.value]),Ee=re=>{let{column:Y,x:ie,y:te}=re;const ae=Y.key==="data-table-select"||Y.key==="data-table-expand",pe=fn(e.headerProps??{},Y.headerProps??{});return Z(S0,fn({tag:"th",align:Y.align,class:[{"v-data-table__th--sortable":Y.sortable&&!e.disableSort,"v-data-table__th--sorted":y(Y),"v-data-table__th--fixed":Y.fixed},...ge.value],style:{width:Bn(Y.width),minWidth:Bn(Y.minWidth),maxWidth:Bn(Y.maxWidth),...W(Y,te)},colspan:Y.colspan,rowspan:Y.rowspan,onClick:Y.sortable?()=>d(Y):void 0,fixed:Y.fixed,nowrap:Y.nowrap,lastFixed:Y.lastFixed,noPadding:ae},pe),{default:()=>{var Je;const Le=`header.${Y.key}`,tt={column:Y,selectAll:D,isSorted:y,toggleSort:d,sortBy:v.value,someSelected:T.value,allSelected:r.value,getSortIcon:q};return o[Le]?o[Le](tt):Y.key==="data-table-select"?((Je=o["header.data-table-select"])==null?void 0:Je.call(o,tt))??(L.value&&Z(eu,{modelValue:r.value,indeterminate:T.value&&!r.value,"onUpdate:modelValue":D},null)):Z("div",{class:"v-data-table-header__content"},[Z("span",null,[Y.title]),Y.sortable&&!e.disableSort&&Z(br,{key:"icon",class:"v-data-table-header__sort-icon",icon:q(Y)},null),e.multiSort&&y(Y)&&Z("div",{key:"badge",class:["v-data-table-header__sort-badge",...ne.value],style:ce.value},[v.value.findIndex(Mt=>Mt.key===Y.key)+1])])}})},de=()=>{const re=fn(e.headerProps??{}??{}),Y=Se(()=>B.value.filter(te=>(te==null?void 0:te.sortable)&&!e.disableSort)),ie=Se(()=>{if(B.value.find(ae=>ae.key==="data-table-select")!=null)return r.value?"$checkboxOn":T.value?"$checkboxIndeterminate":"$checkboxOff"});return Z(S0,fn({tag:"th",class:[...ge.value],colspan:U.value.length+1},re),{default:()=>[Z("div",{class:"v-data-table-header__content"},[Z($T,{chips:!0,class:"v-data-table__td-sort-select",clearable:!0,density:"default",items:Y.value,label:c("$vuetify.dataTable.sortBy"),multiple:e.multiSort,variant:"underlined","onClick:clear":()=>v.value=[],appendIcon:ie.value,"onClick:append":()=>D(!r.value)},{...o,chip:te=>{var ae;return Z(Hp,{onClick:(ae=te.item.raw)!=null&&ae.sortable?()=>d(te.item.raw):void 0,onMousedown:pe=>{pe.preventDefault(),pe.stopPropagation()}},{default:()=>[te.item.title,Z(br,{class:["v-data-table__td-sort-icon",y(te.item.raw)&&"v-data-table__td-sort-icon-active"],icon:q(te.item.raw),size:"small"},null)]})}})])]})};cn(()=>fe.value?Z("tr",null,[Z(de,null,null)]):Z(Gn,null,[o.headers?o.headers(be.value):U.value.map((re,Y)=>Z("tr",null,[re.map((ie,te)=>Z(Ee,{column:ie,x:te,y:Y},null))])),e.loading&&Z("tr",{class:"v-data-table-progress"},[Z("th",{colspan:B.value.length},[Z(C_,{name:"v-data-table-progress",absolute:!0,active:!0,color:typeof e.loading=="boolean"?void 0:e.loading,indeterminate:!0},{default:o.loader})])])]))}}),lK=At({item:{type:Object,required:!0}},"VDataTableGroupHeaderRow"),cK=Jt()({name:"VDataTableGroupHeaderRow",props:lK(),setup(e,t){let{slots:o}=t;const{isGroupOpen:c,toggleGroup:d,extractRows:v}=SB(),{isSelected:y,isSomeSelected:T,select:r}=_b(),{columns:D}=bb(),L=Se(()=>v([e.item]));return()=>Z("tr",{class:"v-data-table-group-header-row",style:{"--v-data-table-group-header-row-depth":e.item.depth}},[D.value.map(B=>{var U,$;if(B.key==="data-table-group"){const W=c(e.item)?"$expand":"$next",q=()=>d(e.item);return((U=o["data-table-group"])==null?void 0:U.call(o,{item:e.item,count:L.value.length,props:{icon:W,onClick:q}}))??Z(S0,{class:"v-data-table-group-header-row__column"},{default:()=>[Z(yr,{size:"small",variant:"text",icon:W,onClick:q},null),Z("span",null,[e.item.value]),Z("span",null,[$o("("),L.value.length,$o(")")])]})}if(B.key==="data-table-select"){const W=y(L.value),q=T(L.value)&&!W,ne=ce=>r(L.value,ce);return(($=o["data-table-select"])==null?void 0:$.call(o,{props:{modelValue:W,indeterminate:q,"onUpdate:modelValue":ne}}))??Z("td",null,[Z(eu,{modelValue:W,indeterminate:q,"onUpdate:modelValue":ne},null)])}return Z("td",null,null)})])}}),uK=At({index:Number,item:Object,cellProps:[Object,Function],onClick:Ss(),onContextmenu:Ss(),onDblclick:Ss(),...Rd()},"VDataTableRow"),tE=Jt()({name:"VDataTableRow",props:uK(),setup(e,t){let{slots:o}=t;const{displayClasses:c,mobile:d}=_l(e,"v-data-table__tr"),{isSelected:v,toggleSelect:y,someSelected:T,allSelected:r,selectAll:D}=_b(),{isExpanded:L,toggleExpand:B}=xB(),{toggleSort:U,sortBy:$,isSorted:W}=OB(),{columns:q}=bb();cn(()=>Z("tr",{class:["v-data-table__tr",{"v-data-table__tr--clickable":!!(e.onClick||e.onContextmenu||e.onDblclick)},c.value],onClick:e.onClick,onContextmenu:e.onContextmenu,onDblclick:e.onDblclick},[e.item&&q.value.map((ne,ce)=>{const oe=e.item,fe=`item.${ne.key}`,be=`header.${ne.key}`,ge={index:e.index,item:oe.raw,internalItem:oe,value:bd(oe.columns,ne.key),column:ne,isSelected:v,toggleSelect:y,isExpanded:L,toggleExpand:B},Ee={column:ne,selectAll:D,isSorted:W,toggleSort:U,sortBy:$.value,someSelected:T.value,allSelected:r.value,getSortIcon:()=>""},de=typeof e.cellProps=="function"?e.cellProps({index:ge.index,item:ge.item,internalItem:ge.internalItem,value:ge.value,column:ne}):e.cellProps,re=typeof ne.cellProps=="function"?ne.cellProps({index:ge.index,item:ge.item,internalItem:ge.internalItem,value:ge.value}):ne.cellProps;return Z(S0,fn({align:ne.align,class:{"v-data-table__td--expanded-row":ne.key==="data-table-expand","v-data-table__td--select-row":ne.key==="data-table-select"},fixed:ne.fixed,fixedOffset:ne.fixedOffset,lastFixed:ne.lastFixed,maxWidth:d.value?void 0:ne.maxWidth,noPadding:ne.key==="data-table-select"||ne.key==="data-table-expand",nowrap:ne.nowrap,width:d.value?void 0:ne.width},de,re),{default:()=>{var ie,te,ae,pe,Le;if(o[fe]&&!d.value)return(ie=o[fe])==null?void 0:ie.call(o,ge);if(ne.key==="data-table-select")return((te=o["item.data-table-select"])==null?void 0:te.call(o,ge))??Z(eu,{disabled:!oe.selectable,modelValue:v([oe]),onClick:nh(()=>y(oe),["stop"])},null);if(ne.key==="data-table-expand")return((ae=o["item.data-table-expand"])==null?void 0:ae.call(o,ge))??Z(yr,{icon:L(oe)?"$collapse":"$expand",size:"small",variant:"text",onClick:nh(()=>B(oe),["stop"])},null);const Y=_c(ge.value);return d.value?Z(Gn,null,[Z("div",{class:"v-data-table__td-title"},[((pe=o[be])==null?void 0:pe.call(o,Ee))??ne.title]),Z("div",{class:"v-data-table__td-value"},[((Le=o[fe])==null?void 0:Le.call(o,ge))??Y])]):Y}})})]))}}),NB=At({loading:[Boolean,String],loadingText:{type:String,default:"$vuetify.dataIterator.loadingText"},hideNoData:Boolean,items:{type:Array,default:()=>[]},noDataText:{type:String,default:"$vuetify.noDataText"},rowProps:[Object,Function],cellProps:[Object,Function],...Rd()},"VDataTableRows"),Id=Jt()({name:"VDataTableRows",inheritAttrs:!1,props:NB(),setup(e,t){let{attrs:o,slots:c}=t;const{columns:d}=bb(),{expandOnClick:v,toggleExpand:y,isExpanded:T}=xB(),{isSelected:r,toggleSelect:D}=_b(),{toggleGroup:L,isGroupOpen:B}=SB(),{t:U}=zo(),{mobile:$}=_l(e);return cn(()=>{var W,q;return e.loading&&(!e.items.length||c.loading)?Z("tr",{class:"v-data-table-rows-loading",key:"loading"},[Z("td",{colspan:d.value.length},[((W=c.loading)==null?void 0:W.call(c))??U(e.loadingText)])]):!e.loading&&!e.items.length&&!e.hideNoData?Z("tr",{class:"v-data-table-rows-no-data",key:"no-data"},[Z("td",{colspan:d.value.length},[((q=c["no-data"])==null?void 0:q.call(c))??U(e.noDataText)])]):Z(Gn,null,[e.items.map((ne,ce)=>{var be;if(ne.type==="group"){const ge={index:ce,item:ne,columns:d.value,isExpanded:T,toggleExpand:y,isSelected:r,toggleSelect:D,toggleGroup:L,isGroupOpen:B};return c["group-header"]?c["group-header"](ge):Z(cK,fn({key:`group-header_${ne.id}`,item:ne},YM(o,":group-header",()=>ge)),c)}const oe={index:ce,item:ne.raw,internalItem:ne,columns:d.value,isExpanded:T,toggleExpand:y,isSelected:r,toggleSelect:D},fe={...oe,props:fn({key:`item_${ne.key??ne.index}`,onClick:v.value?()=>{y(ne)}:void 0,index:ce,item:ne,cellProps:e.cellProps,mobile:$.value},YM(o,":row",()=>oe),typeof e.rowProps=="function"?e.rowProps({item:oe.item,index:oe.index,internalItem:oe.internalItem}):e.rowProps)};return Z(Gn,{key:fe.props.key},[c.item?c.item(fe):Z(tE,fe.props,c),T(ne)&&((be=c["expanded-row"])==null?void 0:be.call(c,oe))])})])}),{}}}),UB=At({fixedHeader:Boolean,fixedFooter:Boolean,height:[Number,String],hover:Boolean,...Nn(),..._s(),...Si(),...Ji()},"VTable"),Cd=Jt()({name:"VTable",props:UB(),setup(e,t){let{slots:o,emit:c}=t;const{themeClasses:d}=xr(e),{densityClasses:v}=Js(e);return cn(()=>Z(e.tag,{class:["v-table",{"v-table--fixed-height":!!e.height,"v-table--fixed-header":e.fixedHeader,"v-table--fixed-footer":e.fixedFooter,"v-table--has-top":!!o.top,"v-table--has-bottom":!!o.bottom,"v-table--hover":e.hover},d.value,v.value,e.class],style:e.style},{default:()=>{var y,T,r;return[(y=o.top)==null?void 0:y.call(o),o.default?Z("div",{class:"v-table__wrapper",style:{height:Bn(e.height)}},[Z("table",null,[o.default()])]):(T=o.wrapper)==null?void 0:T.call(o),(r=o.bottom)==null?void 0:r.call(o)]}})),{}}}),hK=At({items:{type:Array,default:()=>[]},itemValue:{type:[String,Array,Function],default:"id"},itemSelectable:{type:[String,Array,Function],default:null},rowProps:[Object,Function],cellProps:[Object,Function],returnObject:Boolean},"DataTable-items");function dK(e,t,o,c){const d=e.returnObject?t:as(t,e.itemValue),v=as(t,e.itemSelectable,!0),y=c.reduce((T,r)=>(r.key!=null&&(T[r.key]=as(t,r.value)),T),{});return{type:"item",key:e.returnObject?as(t,e.itemValue):d,index:o,value:d,selectable:v,columns:y,raw:t}}function fK(e,t,o){return t.map((c,d)=>dK(e,c,d,o))}function nE(e,t){return{items:Se(()=>fK(e,e.items,t.value))}}const iE=At({...NB(),hideDefaultBody:Boolean,hideDefaultFooter:Boolean,hideDefaultHeader:Boolean,width:[String,Number],search:String,...yB(),...qT(),...nK(),...hK(),...MB(),...RB(),...VB(),...UB()},"DataTable"),pK=At({...ZT(),...iE(),...O_(),...JT()},"VDataTable"),mK=Jt()({name:"VDataTable",props:pK(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:groupBy":e=>!0,"update:expanded":e=>!0,"update:currentItems":e=>!0},setup(e,t){let{attrs:o,slots:c}=t;const{groupBy:d}=WT(e),{sortBy:v,multiSort:y,mustSort:T}=vb(e),{page:r,itemsPerPage:D}=XT(e),{disableSort:L}=Pd(e),{columns:B,headers:U,sortFunctions:$,sortRawFunctions:W,filterFunctions:q}=eE(e,{groupBy:d,showSelect:Ht(e,"showSelect"),showExpand:Ht(e,"showExpand")}),{items:ne}=nE(e,B),ce=Ht(e,"search"),{filteredItems:oe}=L_(e,ne,ce,{transform:et=>et.columns,customKeyFilter:q}),{toggleSort:fe}=yb({sortBy:v,multiSort:y,mustSort:T,page:r}),{sortByWithGroups:be,opened:ge,extractRows:Ee,isGroupOpen:de,toggleGroup:re}=fb({groupBy:d,sortBy:v,disableSort:L}),{sortedItems:Y}=KT(e,oe,be,{transform:et=>({...et.raw,...et.columns}),sortFunctions:$,sortRawFunctions:W}),{flatItems:ie}=pb(Y,d,ge),te=Se(()=>ie.value.length),{startIndex:ae,stopIndex:pe,pageCount:Le,setItemsPerPage:tt}=YT({page:r,itemsPerPage:D,itemsLength:te}),{paginatedItems:Je}=CB({items:ie,startIndex:ae,stopIndex:pe,itemsPerPage:D}),Mt=Se(()=>Ee(Je.value)),{isSelected:Lt,select:yt,selectAll:rt,toggleSelect:mt,someSelected:Ft,allSelected:bn}=gb(e,{allItems:ne,currentPage:Mt}),{isExpanded:Bt,toggleExpand:ht}=db(e);mb({page:r,itemsPerPage:D,sortBy:v,groupBy:d,search:ce}),wo({VDataTableRows:{hideNoData:Ht(e,"hideNoData"),noDataText:Ht(e,"noDataText"),loading:Ht(e,"loading"),loadingText:Ht(e,"loadingText")}});const gt=Se(()=>({page:r.value,itemsPerPage:D.value,sortBy:v.value,pageCount:Le.value,toggleSort:fe,setItemsPerPage:tt,someSelected:Ft.value,allSelected:bn.value,isSelected:Lt,select:yt,selectAll:rt,toggleSelect:mt,isExpanded:Bt,toggleExpand:ht,isGroupOpen:de,toggleGroup:re,items:Mt.value.map(et=>et.raw),internalItems:Mt.value,groupedItems:Je.value,columns:B.value,headers:U.value}));return cn(()=>{const et=u_.filterProps(e),Nt=Ed.filterProps(e),St=Id.filterProps(e),Xt=Cd.filterProps(e);return Z(Cd,fn({class:["v-data-table",{"v-data-table--show-select":e.showSelect,"v-data-table--loading":e.loading},e.class],style:e.style},Xt),{top:()=>{var Ie;return(Ie=c.top)==null?void 0:Ie.call(c,gt.value)},default:()=>{var Ie,gn,Ae,Ne,Ue,Et;return c.default?c.default(gt.value):Z(Gn,null,[(Ie=c.colgroup)==null?void 0:Ie.call(c,gt.value),!e.hideDefaultHeader&&Z("thead",{key:"thead"},[Z(Ed,Nt,c)]),(gn=c.thead)==null?void 0:gn.call(c,gt.value),!e.hideDefaultBody&&Z("tbody",null,[(Ae=c["body.prepend"])==null?void 0:Ae.call(c,gt.value),c.body?c.body(gt.value):Z(Id,fn(o,St,{items:Je.value}),c),(Ne=c["body.append"])==null?void 0:Ne.call(c,gt.value)]),(Ue=c.tbody)==null?void 0:Ue.call(c,gt.value),(Et=c.tfoot)==null?void 0:Et.call(c,gt.value)])},bottom:()=>c.bottom?c.bottom(gt.value):!e.hideDefaultFooter&&Z(Gn,null,[Z(k_,null,null),Z(u_,et,{prepend:c["footer.prepend"]})])})}),{}}}),gK=At({...iE(),...qT(),...eB(),...O_()},"VDataTableVirtual"),_K=Jt()({name:"VDataTableVirtual",props:gK(),emits:{"update:modelValue":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:groupBy":e=>!0,"update:expanded":e=>!0},setup(e,t){let{attrs:o,slots:c}=t;const{groupBy:d}=WT(e),{sortBy:v,multiSort:y,mustSort:T}=vb(e),{disableSort:r}=Pd(e),{columns:D,headers:L,filterFunctions:B,sortFunctions:U,sortRawFunctions:$}=eE(e,{groupBy:d,showSelect:Ht(e,"showSelect"),showExpand:Ht(e,"showExpand")}),{items:W}=nE(e,D),q=Ht(e,"search"),{filteredItems:ne}=L_(e,W,q,{transform:Nt=>Nt.columns,customKeyFilter:B}),{toggleSort:ce}=yb({sortBy:v,multiSort:y,mustSort:T}),{sortByWithGroups:oe,opened:fe,extractRows:be,isGroupOpen:ge,toggleGroup:Ee}=fb({groupBy:d,sortBy:v,disableSort:r}),{sortedItems:de}=KT(e,ne,oe,{transform:Nt=>({...Nt.raw,...Nt.columns}),sortFunctions:U,sortRawFunctions:$}),{flatItems:re}=pb(de,d,fe),Y=Se(()=>be(re.value)),{isSelected:ie,select:te,selectAll:ae,toggleSelect:pe,someSelected:Le,allSelected:tt}=gb(e,{allItems:Y,currentPage:Y}),{isExpanded:Je,toggleExpand:Mt}=db(e),{containerRef:Lt,markerRef:yt,paddingTop:rt,paddingBottom:mt,computedItems:Ft,handleItemResize:bn,handleScroll:Bt,handleScrollend:ht}=tB(e,re),gt=Se(()=>Ft.value.map(Nt=>Nt.raw));mb({sortBy:v,page:kn(1),itemsPerPage:kn(-1),groupBy:d,search:q}),wo({VDataTableRows:{hideNoData:Ht(e,"hideNoData"),noDataText:Ht(e,"noDataText"),loading:Ht(e,"loading"),loadingText:Ht(e,"loadingText")}});const et=Se(()=>({sortBy:v.value,toggleSort:ce,someSelected:Le.value,allSelected:tt.value,isSelected:ie,select:te,selectAll:ae,toggleSelect:pe,isExpanded:Je,toggleExpand:Mt,isGroupOpen:ge,toggleGroup:Ee,items:Y.value.map(Nt=>Nt.raw),internalItems:Y.value,groupedItems:re.value,columns:D.value,headers:L.value}));cn(()=>{const Nt=Ed.filterProps(e),St=Id.filterProps(e),Xt=Cd.filterProps(e);return Z(Cd,fn({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},Xt),{top:()=>{var Ie;return(Ie=c.top)==null?void 0:Ie.call(c,et.value)},wrapper:()=>{var Ie,gn,Ae;return Z("div",{ref:Lt,onScrollPassive:Bt,onScrollend:ht,class:"v-table__wrapper",style:{height:Bn(e.height)}},[Z("table",null,[(Ie=c.colgroup)==null?void 0:Ie.call(c,et.value),!e.hideDefaultHeader&&Z("thead",{key:"thead"},[Z(Ed,fn(Nt,{sticky:e.fixedHeader}),c)]),!e.hideDefaultBody&&Z("tbody",null,[Z("tr",{ref:yt,style:{height:Bn(rt.value),border:0}},[Z("td",{colspan:D.value.length,style:{height:0,border:0}},null)]),(gn=c["body.prepend"])==null?void 0:gn.call(c,et.value),Z(Id,fn(o,St,{items:gt.value}),{...c,item:Ne=>Z(Qz,{key:Ne.internalItem.index,renderless:!0,"onUpdate:height":Ue=>bn(Ne.internalItem.index,Ue)},{default:Ue=>{var Ct;let{itemRef:Et}=Ue;return((Ct=c.item)==null?void 0:Ct.call(c,{...Ne,itemRef:Et}))??Z(tE,fn(Ne.props,{ref:Et,key:Ne.internalItem.index,index:Ne.internalItem.index}),c)}})}),(Ae=c["body.append"])==null?void 0:Ae.call(c,et.value),Z("tr",{style:{height:Bn(mt.value),border:0}},[Z("td",{colspan:D.value.length,style:{height:0,border:0}},null)])])])])},bottom:()=>{var Ie;return(Ie=c.bottom)==null?void 0:Ie.call(c,et.value)}})})}}),vK=At({itemsLength:{type:[Number,String],required:!0},...ZT(),...iE(),...JT()},"VDataTableServer"),yK=Jt()({name:"VDataTableServer",props:vK(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0},setup(e,t){let{attrs:o,slots:c}=t;const{groupBy:d}=WT(e),{sortBy:v,multiSort:y,mustSort:T}=vb(e),{page:r,itemsPerPage:D}=XT(e),{disableSort:L}=Pd(e),B=Se(()=>parseInt(e.itemsLength,10)),{columns:U,headers:$}=eE(e,{groupBy:d,showSelect:Ht(e,"showSelect"),showExpand:Ht(e,"showExpand")}),{items:W}=nE(e,U),{toggleSort:q}=yb({sortBy:v,multiSort:y,mustSort:T,page:r}),{opened:ne,isGroupOpen:ce,toggleGroup:oe,extractRows:fe}=fb({groupBy:d,sortBy:v,disableSort:L}),{pageCount:be,setItemsPerPage:ge}=YT({page:r,itemsPerPage:D,itemsLength:B}),{flatItems:Ee}=pb(W,d,ne),{isSelected:de,select:re,selectAll:Y,toggleSelect:ie,someSelected:te,allSelected:ae}=gb(e,{allItems:W,currentPage:W}),{isExpanded:pe,toggleExpand:Le}=db(e),tt=Se(()=>fe(W.value));mb({page:r,itemsPerPage:D,sortBy:v,groupBy:d,search:Ht(e,"search")}),Vr("v-data-table",{toggleSort:q,sortBy:v}),wo({VDataTableRows:{hideNoData:Ht(e,"hideNoData"),noDataText:Ht(e,"noDataText"),loading:Ht(e,"loading"),loadingText:Ht(e,"loadingText")}});const Je=Se(()=>({page:r.value,itemsPerPage:D.value,sortBy:v.value,pageCount:be.value,toggleSort:q,setItemsPerPage:ge,someSelected:te.value,allSelected:ae.value,isSelected:de,select:re,selectAll:Y,toggleSelect:ie,isExpanded:pe,toggleExpand:Le,isGroupOpen:ce,toggleGroup:oe,items:tt.value.map(Mt=>Mt.raw),internalItems:tt.value,groupedItems:Ee.value,columns:U.value,headers:$.value}));cn(()=>{const Mt=u_.filterProps(e),Lt=Ed.filterProps(e),yt=Id.filterProps(e),rt=Cd.filterProps(e);return Z(Cd,fn({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},rt),{top:()=>{var mt;return(mt=c.top)==null?void 0:mt.call(c,Je.value)},default:()=>{var mt,Ft,bn,Bt,ht,gt;return c.default?c.default(Je.value):Z(Gn,null,[(mt=c.colgroup)==null?void 0:mt.call(c,Je.value),!e.hideDefaultHeader&&Z("thead",{key:"thead",class:"v-data-table__thead",role:"rowgroup"},[Z(Ed,fn(Lt,{sticky:e.fixedHeader}),c)]),(Ft=c.thead)==null?void 0:Ft.call(c,Je.value),!e.hideDefaultBody&&Z("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[(bn=c["body.prepend"])==null?void 0:bn.call(c,Je.value),c.body?c.body(Je.value):Z(Id,fn(o,yt,{items:Ee.value}),c),(Bt=c["body.append"])==null?void 0:Bt.call(c,Je.value)]),(ht=c.tbody)==null?void 0:ht.call(c,Je.value),(gt=c.tfoot)==null?void 0:gt.call(c,Je.value)])},bottom:()=>c.bottom?c.bottom(Je.value):!e.hideDefaultFooter&&Z(Gn,null,[Z(k_,null,null),Z(u_,Mt,{prepend:c["footer.prepend"]})])})})}}),bK=At({fluid:{type:Boolean,default:!1},...Nn(),...Ko(),...Si()},"VContainer"),xK=Jt()({name:"VContainer",props:bK(),setup(e,t){let{slots:o}=t;const{rtlClasses:c}=gs(),{dimensionStyles:d}=Jo(e);return cn(()=>Z(e.tag,{class:["v-container",{"v-container--fluid":e.fluid},c.value,e.class],style:[d.value,e.style]},o)),{}}}),jB=X0.reduce((e,t)=>(e[t]={type:[Boolean,String,Number],default:!1},e),{}),$B=X0.reduce((e,t)=>{const o="offset"+yc(t);return e[o]={type:[String,Number],default:null},e},{}),GB=X0.reduce((e,t)=>{const o="order"+yc(t);return e[o]={type:[String,Number],default:null},e},{}),xk={col:Object.keys(jB),offset:Object.keys($B),order:Object.keys(GB)};function wK(e,t,o){let c=e;if(!(o==null||o===!1)){if(t){const d=t.replace(e,"");c+=`-${d}`}return e==="col"&&(c="v-"+c),e==="col"&&(o===""||o===!0)||(c+=`-${o}`),c.toLowerCase()}}const SK=["auto","start","end","center","baseline","stretch"],TK=At({cols:{type:[Boolean,String,Number],default:!1},...jB,offset:{type:[String,Number],default:null},...$B,order:{type:[String,Number],default:null},...GB,alignSelf:{type:String,default:null,validator:e=>SK.includes(e)},...Nn(),...Si()},"VCol"),EK=Jt()({name:"VCol",props:TK(),setup(e,t){let{slots:o}=t;const c=Se(()=>{const d=[];let v;for(v in xk)xk[v].forEach(T=>{const r=e[T],D=wK(v,T,r);D&&d.push(D)});const y=d.some(T=>T.startsWith("v-col-"));return d.push({"v-col":!y||!e.cols,[`v-col-${e.cols}`]:e.cols,[`offset-${e.offset}`]:e.offset,[`order-${e.order}`]:e.order,[`align-self-${e.alignSelf}`]:e.alignSelf}),d});return()=>{var d;return Gl(e.tag,{class:[c.value,e.class],style:e.style},(d=o.default)==null?void 0:d.call(o))}}}),rE=["start","end","center"],HB=["space-between","space-around","space-evenly"];function oE(e,t){return X0.reduce((o,c)=>{const d=e+yc(c);return o[d]=t(),o},{})}const IK=[...rE,"baseline","stretch"],qB=e=>IK.includes(e),WB=oE("align",()=>({type:String,default:null,validator:qB})),CK=[...rE,...HB],ZB=e=>CK.includes(e),XB=oE("justify",()=>({type:String,default:null,validator:ZB})),AK=[...rE,...HB,"stretch"],YB=e=>AK.includes(e),KB=oE("alignContent",()=>({type:String,default:null,validator:YB})),wk={align:Object.keys(WB),justify:Object.keys(XB),alignContent:Object.keys(KB)},PK={align:"align",justify:"justify",alignContent:"align-content"};function MK(e,t,o){let c=PK[e];if(o!=null){if(t){const d=t.replace(e,"");c+=`-${d}`}return c+=`-${o}`,c.toLowerCase()}}const kK=At({dense:Boolean,noGutters:Boolean,align:{type:String,default:null,validator:qB},...WB,justify:{type:String,default:null,validator:ZB},...XB,alignContent:{type:String,default:null,validator:YB},...KB,...Nn(),...Si()},"VRow"),RK=Jt()({name:"VRow",props:kK(),setup(e,t){let{slots:o}=t;const c=Se(()=>{const d=[];let v;for(v in wk)wk[v].forEach(y=>{const T=e[y],r=MK(v,y,T);r&&d.push(r)});return d.push({"v-row--no-gutters":e.noGutters,"v-row--dense":e.dense,[`align-${e.align}`]:e.align,[`justify-${e.justify}`]:e.justify,[`align-content-${e.alignContent}`]:e.alignContent}),d});return()=>{var d;return Gl(e.tag,{class:["v-row",c.value,e.class],style:e.style},(d=o.default)==null?void 0:d.call(o))}}}),JB=Tc("v-spacer","div","VSpacer"),QB=At({active:{type:[String,Array],default:void 0},disabled:{type:[Boolean,String,Array],default:!1},nextIcon:{type:mi,default:"$next"},prevIcon:{type:mi,default:"$prev"},modeIcon:{type:mi,default:"$subgroup"},text:String,viewMode:{type:String,default:"month"}},"VDatePickerControls"),tS=Jt()({name:"VDatePickerControls",props:QB(),emits:{"click:year":()=>!0,"click:month":()=>!0,"click:prev":()=>!0,"click:next":()=>!0,"click:text":()=>!0},setup(e,t){let{emit:o}=t;const c=Se(()=>Array.isArray(e.disabled)?e.disabled.includes("text"):!!e.disabled),d=Se(()=>Array.isArray(e.disabled)?e.disabled.includes("mode"):!!e.disabled),v=Se(()=>Array.isArray(e.disabled)?e.disabled.includes("prev"):!!e.disabled),y=Se(()=>Array.isArray(e.disabled)?e.disabled.includes("next"):!!e.disabled);function T(){o("click:prev")}function r(){o("click:next")}function D(){o("click:year")}function L(){o("click:month")}return cn(()=>Z("div",{class:["v-date-picker-controls"]},[Z(yr,{class:"v-date-picker-controls__month-btn",disabled:c.value,text:e.text,variant:"text",rounded:!0,onClick:L},null),Z(yr,{key:"mode-btn",class:"v-date-picker-controls__mode-btn",disabled:d.value,density:"comfortable",icon:e.modeIcon,variant:"text",onClick:D},null),Z(JB,{key:"mode-spacer"},null),Z("div",{key:"month-buttons",class:"v-date-picker-controls__month"},[Z(yr,{disabled:v.value,icon:e.prevIcon,variant:"text",onClick:T},null),Z(yr,{disabled:y.value,icon:e.nextIcon,variant:"text",onClick:r},null)])])),{}}}),DK=At({appendIcon:String,color:String,header:String,transition:String,onClick:Ss()},"VDatePickerHeader"),nS=Jt()({name:"VDatePickerHeader",props:DK(),emits:{click:()=>!0,"click:append":()=>!0},setup(e,t){let{emit:o,slots:c}=t;const{backgroundColorClasses:d,backgroundColorStyles:v}=Nr(e,"color");function y(){o("click")}function T(){o("click:append")}return cn(()=>{const r=!!(c.default||e.header),D=!!(c.append||e.appendIcon);return Z("div",{class:["v-date-picker-header",{"v-date-picker-header--clickable":!!e.onClick},d.value],style:v.value,onClick:y},[c.prepend&&Z("div",{key:"prepend",class:"v-date-picker-header__prepend"},[c.prepend()]),r&&Z(Xs,{key:"content",name:e.transition},{default:()=>{var L;return[Z("div",{key:e.header,class:"v-date-picker-header__content"},[((L=c.default)==null?void 0:L.call(c))??e.header])]}}),D&&Z("div",{class:"v-date-picker-header__append"},[c.append?Z(Li,{key:"append-defaults",disabled:!e.appendIcon,defaults:{VBtn:{icon:e.appendIcon,variant:"text"}}},{default:()=>{var L;return[(L=c.append)==null?void 0:L.call(c)]}}):Z(yr,{key:"append-btn",icon:e.appendIcon,variant:"text",onClick:T},null)])])}),{}}}),OK=At({allowedDates:[Array,Function],disabled:Boolean,displayValue:null,modelValue:Array,month:[Number,String],max:null,min:null,showAdjacentMonths:Boolean,year:[Number,String],weekdays:{type:Array,default:()=>[0,1,2,3,4,5,6]},weeksInMonth:{type:String,default:"dynamic"},firstDayOfWeek:[Number,String]},"calendar");function LK(e){const t=T_(),o=ei(e,"modelValue",[],$=>go($)),c=Se(()=>e.displayValue?t.date(e.displayValue):o.value.length>0?t.date(o.value[0]):e.min?t.date(e.min):Array.isArray(e.allowedDates)?t.date(e.allowedDates[0]):t.date()),d=ei(e,"year",void 0,$=>{const W=$!=null?Number($):t.getYear(c.value);return t.startOfYear(t.setYear(t.date(),W))},$=>t.getYear($)),v=ei(e,"month",void 0,$=>{const W=$!=null?Number($):t.getMonth(c.value),q=t.setYear(t.startOfMonth(t.date()),t.getYear(d.value));return t.setMonth(q,W)},$=>t.getMonth($)),y=Se(()=>{const $=Number(e.firstDayOfWeek??0);return e.weekdays.map(W=>(W+$)%7)}),T=Se(()=>{const $=t.getWeekArray(v.value,e.firstDayOfWeek),W=$.flat(),q=6*7;if(e.weeksInMonth==="static"&&W.length<q){const ne=W[W.length-1];let ce=[];for(let oe=1;oe<=q-W.length;oe++)ce.push(t.addDays(ne,oe)),oe%7===0&&($.push(ce),ce=[])}return $});function r($,W){return $.filter(q=>y.value.includes(t.toJsDate(q).getDay())).map((q,ne)=>{const ce=t.toISO(q),oe=!t.isSameMonth(q,v.value),fe=t.isSameDay(q,t.startOfMonth(v.value)),be=t.isSameDay(q,t.endOfMonth(v.value)),ge=t.isSameDay(q,v.value);return{date:q,isoDate:ce,formatted:t.format(q,"keyboardDate"),year:t.getYear(q),month:t.getMonth(q),isDisabled:U(q),isWeekStart:ne%7===0,isWeekEnd:ne%7===6,isToday:t.isSameDay(q,W),isAdjacent:oe,isHidden:oe&&!e.showAdjacentMonths,isStart:fe,isSelected:o.value.some(Ee=>t.isSameDay(q,Ee)),isEnd:be,isSame:ge,localized:t.format(q,"dayOfMonth")}})}const D=Se(()=>{const $=t.startOfWeek(c.value,e.firstDayOfWeek),W=[];for(let ne=0;ne<=6;ne++)W.push(t.addDays($,ne));const q=t.date();return r(W,q)}),L=Se(()=>{const $=T.value.flat(),W=t.date();return r($,W)}),B=Se(()=>T.value.map($=>$.length?$7(t,$[0]):null));function U($){if(e.disabled)return!0;const W=t.date($);return e.min&&t.isAfter(t.date(e.min),W)||e.max&&t.isAfter(W,t.date(e.max))?!0:Array.isArray(e.allowedDates)&&e.allowedDates.length>0?!e.allowedDates.some(q=>t.isSameDay(t.date(q),W)):typeof e.allowedDates=="function"?!e.allowedDates(W):!1}return{displayValue:c,daysInMonth:L,daysInWeek:D,genDays:r,model:o,weeksInMonth:T,weekDays:y,weekNumbers:B}}const e4=At({color:String,hideWeekdays:Boolean,multiple:[Boolean,Number,String],showWeek:Boolean,transition:{type:String,default:"picker-transition"},reverseTransition:{type:String,default:"picker-reverse-transition"},...OK()},"VDatePickerMonth"),iS=Jt()({name:"VDatePickerMonth",props:e4(),emits:{"update:modelValue":e=>!0,"update:month":e=>!0,"update:year":e=>!0},setup(e,t){let{emit:o,slots:c}=t;const d=rn(),{daysInMonth:v,model:y,weekNumbers:T}=LK(e),r=T_(),D=kn(),L=kn(),B=kn(!1),U=Se(()=>B.value?e.reverseTransition:e.transition);e.multiple==="range"&&y.value.length>0&&(D.value=y.value[0],y.value.length>1&&(L.value=y.value[y.value.length-1]));const $=Se(()=>{const ce=["number","string"].includes(typeof e.multiple)?Number(e.multiple):1/0;return y.value.length>=ce});On(v,(ce,oe)=>{oe&&(B.value=r.isBefore(ce[0].date,oe[0].date))});function W(ce){const oe=r.startOfDay(ce);if(y.value.length===0?D.value=void 0:y.value.length===1&&(D.value=y.value[0],L.value=void 0),!D.value)D.value=oe,y.value=[D.value];else if(L.value)D.value=ce,L.value=void 0,y.value=[D.value];else{if(r.isSameDay(oe,D.value)){D.value=void 0,y.value=[];return}else r.isBefore(oe,D.value)?(L.value=r.endOfDay(D.value),D.value=oe):L.value=r.endOfDay(oe);const fe=r.getDiff(L.value,D.value,"days"),be=[D.value];for(let ge=1;ge<fe;ge++){const Ee=r.addDays(D.value,ge);be.push(Ee)}be.push(L.value),y.value=be}}function q(ce){const oe=y.value.findIndex(fe=>r.isSameDay(fe,ce));if(oe===-1)y.value=[...y.value,ce];else{const fe=[...y.value];fe.splice(oe,1),y.value=fe}}function ne(ce){e.multiple==="range"?W(ce):e.multiple?q(ce):y.value=[ce]}return()=>Z("div",{class:"v-date-picker-month"},[e.showWeek&&Z("div",{key:"weeks",class:"v-date-picker-month__weeks"},[!e.hideWeekdays&&Z("div",{key:"hide-week-days",class:"v-date-picker-month__day"},[$o("")]),T.value.map(ce=>Z("div",{class:["v-date-picker-month__day","v-date-picker-month__day--adjacent"]},[ce]))]),Z(Xs,{name:U.value},{default:()=>{var ce;return[Z("div",{ref:d,key:(ce=v.value[0].date)==null?void 0:ce.toString(),class:"v-date-picker-month__days"},[!e.hideWeekdays&&r.getWeekdays(e.firstDayOfWeek).map(oe=>Z("div",{class:["v-date-picker-month__day","v-date-picker-month__weekday"]},[oe])),v.value.map((oe,fe)=>{const be={props:{onClick:()=>ne(oe.date)},item:oe,i:fe};return $.value&&!oe.isSelected&&(oe.isDisabled=!0),Z("div",{class:["v-date-picker-month__day",{"v-date-picker-month__day--adjacent":oe.isAdjacent,"v-date-picker-month__day--hide-adjacent":oe.isHidden,"v-date-picker-month__day--selected":oe.isSelected,"v-date-picker-month__day--week-end":oe.isWeekEnd,"v-date-picker-month__day--week-start":oe.isWeekStart}],"data-v-date":oe.isDisabled?void 0:oe.isoDate},[(e.showAdjacentMonths||!oe.isAdjacent)&&Z(Li,{defaults:{VBtn:{class:"v-date-picker-month__day-btn",color:(oe.isSelected||oe.isToday)&&!oe.isDisabled?e.color:void 0,disabled:oe.isDisabled,icon:!0,ripple:!1,text:oe.localized,variant:oe.isDisabled?oe.isToday?"outlined":"text":oe.isToday&&!oe.isSelected?"outlined":"flat",onClick:()=>ne(oe.date)}}},{default:()=>{var ge;return[((ge=c.day)==null?void 0:ge.call(c,be))??Z(yr,be.props,null)]}})])})])]}})])}}),t4=At({color:String,height:[String,Number],min:null,max:null,modelValue:Number,year:Number},"VDatePickerMonths"),rS=Jt()({name:"VDatePickerMonths",props:t4(),emits:{"update:modelValue":e=>!0},setup(e,t){let{emit:o,slots:c}=t;const d=T_(),v=ei(e,"modelValue"),y=Se(()=>{let T=d.startOfYear(d.date());return e.year&&(T=d.setYear(T,e.year)),dc(12).map(r=>{const D=d.format(T,"monthShort"),L=!!(e.min&&d.isAfter(d.startOfMonth(d.date(e.min)),T)||e.max&&d.isAfter(T,d.startOfMonth(d.date(e.max))));return T=d.getNextMonth(T),{isDisabled:L,text:D,value:r}})});return Oo(()=>{v.value=v.value??d.getMonth(d.date())}),cn(()=>Z("div",{class:"v-date-picker-months",style:{height:Bn(e.height)}},[Z("div",{class:"v-date-picker-months__content"},[y.value.map((T,r)=>{var B;const D={active:v.value===r,color:v.value===r?e.color:void 0,disabled:T.isDisabled,rounded:!0,text:T.text,variant:v.value===T.value?"flat":"text",onClick:()=>L(r)};function L(U){if(v.value===U){o("update:modelValue",v.value);return}v.value=U}return((B=c.month)==null?void 0:B.call(c,{month:T,i:r,props:D}))??Z(yr,fn({key:"month"},D),null)})])])),{}}}),n4=At({color:String,height:[String,Number],min:null,max:null,modelValue:Number},"VDatePickerYears"),oS=Jt()({name:"VDatePickerYears",props:n4(),emits:{"update:modelValue":e=>!0},setup(e,t){let{emit:o,slots:c}=t;const d=T_(),v=ei(e,"modelValue"),y=Se(()=>{const r=d.getYear(d.date());let D=r-100,L=r+52;e.min&&(D=d.getYear(d.date(e.min))),e.max&&(L=d.getYear(d.date(e.max)));let B=d.startOfYear(d.date());return B=d.setYear(B,D),dc(L-D+1,D).map(U=>{const $=d.format(B,"year");return B=d.setYear(B,d.getYear(B)+1),{text:$,value:U}})});Oo(()=>{v.value=v.value??d.getYear(d.date())});const T=g0();return ms(async()=>{var r;await Ki(),(r=T.el)==null||r.scrollIntoView({block:"center"})}),cn(()=>Z("div",{class:"v-date-picker-years",style:{height:Bn(e.height)}},[Z("div",{class:"v-date-picker-years__content"},[y.value.map((r,D)=>{var B;const L={ref:v.value===r.value?T:void 0,active:v.value===r.value,color:v.value===r.value?e.color:void 0,rounded:!0,text:r.text,variant:v.value===r.value?"flat":"text",onClick:()=>{if(v.value===r.value){o("update:modelValue",v.value);return}v.value=r.value}};return((B=c.year)==null?void 0:B.call(c,{year:r,i:D,props:L}))??Z(yr,fn({key:"month"},L),null)})])])),{}}}),zK=Tc("v-picker-title"),i4=At({bgColor:String,landscape:Boolean,title:String,hideHeader:Boolean,...hb()},"VPicker"),Sk=Jt()({name:"VPicker",props:i4(),setup(e,t){let{slots:o}=t;const{backgroundColorClasses:c,backgroundColorStyles:d}=Nr(Ht(e,"color"));return cn(()=>{const v=Td.filterProps(e),y=!!(e.title||o.title);return Z(Td,fn(v,{color:e.bgColor,class:["v-picker",{"v-picker--landscape":e.landscape,"v-picker--with-actions":!!o.actions},e.class],style:e.style}),{default:()=>{var T;return[!e.hideHeader&&Z("div",{key:"header",class:[c.value],style:[d.value]},[y&&Z(zK,{key:"picker-title"},{default:()=>{var r;return[((r=o.title)==null?void 0:r.call(o))??e.title]}}),o.header&&Z("div",{class:"v-picker__header"},[o.header()])]),Z("div",{class:"v-picker__body"},[(T=o.default)==null?void 0:T.call(o)]),o.actions&&Z(Li,{defaults:{VBtn:{slim:!0,variant:"text"}}},{default:()=>[Z("div",{class:"v-picker__actions"},[o.actions()])]})]}})}),{}}}),BK=At({header:{type:String,default:"$vuetify.datePicker.header"},...QB(),...e4({weeksInMonth:"static"}),...Yo(t4(),["modelValue"]),...Yo(n4(),["modelValue"]),...i4({title:"$vuetify.datePicker.title"}),modelValue:null},"VDatePicker"),FK=Jt()({name:"VDatePicker",props:BK(),emits:{"update:modelValue":e=>!0,"update:month":e=>!0,"update:year":e=>!0,"update:viewMode":e=>!0},setup(e,t){let{emit:o,slots:c}=t;const d=T_(),{t:v}=zo(),y=ei(e,"modelValue",void 0,Y=>go(Y),Y=>e.multiple?Y:Y[0]),T=ei(e,"viewMode"),r=Se(()=>{var ie;const Y=d.date((ie=y.value)==null?void 0:ie[0]);return Y&&d.isValid(Y)?Y:d.date()}),D=rn(Number(e.month??d.getMonth(d.startOfMonth(r.value)))),L=rn(Number(e.year??d.getYear(d.startOfYear(d.setMonth(r.value,D.value))))),B=kn(!1),U=Se(()=>e.multiple&&y.value.length>1?v("$vuetify.datePicker.itemsSelected",y.value.length):y.value[0]&&d.isValid(y.value[0])?d.format(d.date(y.value[0]),"normalDateWithWeekday"):v(e.header)),$=Se(()=>{let Y=d.date();return Y=d.setDate(Y,1),Y=d.setMonth(Y,D.value),Y=d.setYear(Y,L.value),d.format(Y,"monthAndYear")}),W=Se(()=>`date-picker-header${B.value?"-reverse":""}-transition`),q=Se(()=>{const Y=d.date(e.min);return e.min&&d.isValid(Y)?Y:null}),ne=Se(()=>{const Y=d.date(e.max);return e.max&&d.isValid(Y)?Y:null}),ce=Se(()=>{if(e.disabled)return!0;const Y=[];if(T.value!=="month")Y.push("prev","next");else{let ie=d.date();if(ie=d.setYear(ie,L.value),ie=d.setMonth(ie,D.value),q.value){const te=d.addDays(d.startOfMonth(ie),-1);d.isAfter(q.value,te)&&Y.push("prev")}if(ne.value){const te=d.addDays(d.endOfMonth(ie),1);d.isAfter(te,ne.value)&&Y.push("next")}}return Y});function oe(){D.value<11?D.value++:(L.value++,D.value=0,re(L.value)),de(D.value)}function fe(){D.value>0?D.value--:(L.value--,D.value=11,re(L.value)),de(D.value)}function be(){T.value="month"}function ge(){T.value=T.value==="months"?"month":"months"}function Ee(){T.value=T.value==="year"?"month":"year"}function de(Y){T.value==="months"&&ge(),o("update:month",Y)}function re(Y){T.value==="year"&&Ee(),o("update:year",Y)}return On(y,(Y,ie)=>{const te=go(ie),ae=go(Y);if(!ae.length)return;const pe=d.date(te[te.length-1]),Le=d.date(ae[ae.length-1]),tt=d.getMonth(Le),Je=d.getYear(Le);tt!==D.value&&(D.value=tt,de(D.value)),Je!==L.value&&(L.value=Je,re(L.value)),B.value=d.isBefore(pe,Le)}),cn(()=>{const Y=Sk.filterProps(e),ie=tS.filterProps(e),te=nS.filterProps(e),ae=iS.filterProps(e),pe=Yo(rS.filterProps(e),["modelValue"]),Le=Yo(oS.filterProps(e),["modelValue"]),tt={header:U.value,transition:W.value};return Z(Sk,fn(Y,{class:["v-date-picker",`v-date-picker--${T.value}`,{"v-date-picker--show-week":e.showWeek},e.class],style:e.style}),{title:()=>{var Je;return((Je=c.title)==null?void 0:Je.call(c))??Z("div",{class:"v-date-picker__title"},[v(e.title)])},header:()=>c.header?Z(Li,{defaults:{VDatePickerHeader:{...tt}}},{default:()=>{var Je;return[(Je=c.header)==null?void 0:Je.call(c,tt)]}}):Z(nS,fn({key:"header"},te,tt,{onClick:T.value!=="month"?be:void 0}),{...c,default:void 0}),default:()=>Z(Gn,null,[Z(tS,fn(ie,{disabled:ce.value,text:$.value,"onClick:next":oe,"onClick:prev":fe,"onClick:month":ge,"onClick:year":Ee}),null),Z(r_,{hideOnLeave:!0},{default:()=>[T.value==="months"?Z(rS,fn({key:"date-picker-months"},pe,{modelValue:D.value,"onUpdate:modelValue":[Je=>D.value=Je,de],min:q.value,max:ne.value,year:L.value}),null):T.value==="year"?Z(oS,fn({key:"date-picker-years"},Le,{modelValue:L.value,"onUpdate:modelValue":[Je=>L.value=Je,re],min:q.value,max:ne.value}),null):Z(iS,fn({key:"date-picker-month"},ae,{modelValue:y.value,"onUpdate:modelValue":Je=>y.value=Je,month:D.value,"onUpdate:month":[Je=>D.value=Je,de],year:L.value,"onUpdate:year":[Je=>L.value=Je,re],min:q.value,max:ne.value}),null)]})]),actions:c.actions})}),{}}}),VK=At({actionText:String,bgColor:String,color:String,icon:mi,image:String,justify:{type:String,default:"center"},headline:String,title:String,text:String,textWidth:{type:[Number,String],default:500},href:String,to:String,...Nn(),...Ko(),...Ec({size:void 0}),...Ji()},"VEmptyState"),NK=Jt()({name:"VEmptyState",props:VK(),emits:{"click:action":e=>!0},setup(e,t){let{emit:o,slots:c}=t;const{themeClasses:d}=xr(e),{backgroundColorClasses:v,backgroundColorStyles:y}=Nr(Ht(e,"bgColor")),{dimensionStyles:T}=Jo(e),{displayClasses:r}=_l();function D(L){o("click:action",L)}return cn(()=>{var ne,ce,oe;const L=!!(c.actions||e.actionText),B=!!(c.headline||e.headline),U=!!(c.title||e.title),$=!!(c.text||e.text),W=!!(c.media||e.image||e.icon),q=e.size||(e.image?200:96);return Z("div",{class:["v-empty-state",{[`v-empty-state--${e.justify}`]:!0},d.value,v.value,r.value,e.class],style:[y.value,T.value,e.style]},[W&&Z("div",{key:"media",class:"v-empty-state__media"},[c.media?Z(Li,{key:"media-defaults",defaults:{VImg:{src:e.image,height:q},VIcon:{size:q,icon:e.icon}}},{default:()=>[c.media()]}):Z(Gn,null,[e.image?Z(Qc,{key:"image",src:e.image,height:q},null):e.icon?Z(br,{key:"icon",color:e.color,size:q,icon:e.icon},null):void 0])]),B&&Z("div",{key:"headline",class:"v-empty-state__headline"},[((ne=c.headline)==null?void 0:ne.call(c))??e.headline]),U&&Z("div",{key:"title",class:"v-empty-state__title"},[((ce=c.title)==null?void 0:ce.call(c))??e.title]),$&&Z("div",{key:"text",class:"v-empty-state__text",style:{maxWidth:Bn(e.textWidth)}},[((oe=c.text)==null?void 0:oe.call(c))??e.text]),c.default&&Z("div",{key:"content",class:"v-empty-state__content"},[c.default()]),L&&Z("div",{key:"actions",class:"v-empty-state__actions"},[Z(Li,{defaults:{VBtn:{class:"v-empty-state__action-btn",color:e.color??"surface-variant",text:e.actionText}}},{default:()=>{var fe;return[((fe=c.actions)==null?void 0:fe.call(c,{props:{onClick:D}}))??Z(yr,{onClick:D},null)]}})])])}),{}}}),h_=Symbol.for("vuetify:v-expansion-panel"),r4=At({...Nn(),...FT()},"VExpansionPanelText"),sS=Jt()({name:"VExpansionPanelText",props:r4(),setup(e,t){let{slots:o}=t;const c=Mi(h_);if(!c)throw new Error("[Vuetify] v-expansion-panel-text needs to be placed inside v-expansion-panel");const{hasContent:d,onAfterLeave:v}=VT(e,c.isSelected);return cn(()=>Z(J0,{onAfterLeave:v},{default:()=>{var y;return[lr(Z("div",{class:["v-expansion-panel-text",e.class],style:e.style},[o.default&&d.value&&Z("div",{class:"v-expansion-panel-text__wrapper"},[(y=o.default)==null?void 0:y.call(o)])]),[[Hl,c.isSelected.value]])]}})),{}}}),o4=At({color:String,expandIcon:{type:mi,default:"$expand"},collapseIcon:{type:mi,default:"$collapse"},hideActions:Boolean,focusable:Boolean,static:Boolean,ripple:{type:[Boolean,Object],default:!1},readonly:Boolean,...Nn(),...Ko()},"VExpansionPanelTitle"),aS=Jt()({name:"VExpansionPanelTitle",directives:{Ripple:ru},props:o4(),setup(e,t){let{slots:o}=t;const c=Mi(h_);if(!c)throw new Error("[Vuetify] v-expansion-panel-title needs to be placed inside v-expansion-panel");const{backgroundColorClasses:d,backgroundColorStyles:v}=Nr(e,"color"),{dimensionStyles:y}=Jo(e),T=Se(()=>({collapseIcon:e.collapseIcon,disabled:c.disabled.value,expanded:c.isSelected.value,expandIcon:e.expandIcon,readonly:e.readonly})),r=Se(()=>c.isSelected.value?e.collapseIcon:e.expandIcon);return cn(()=>{var D;return lr(Z("button",{class:["v-expansion-panel-title",{"v-expansion-panel-title--active":c.isSelected.value,"v-expansion-panel-title--focusable":e.focusable,"v-expansion-panel-title--static":e.static},d.value,e.class],style:[v.value,y.value,e.style],type:"button",tabindex:c.disabled.value?-1:void 0,disabled:c.disabled.value,"aria-expanded":c.isSelected.value,onClick:e.readonly?void 0:c.toggle},[Z("span",{class:"v-expansion-panel-title__overlay"},null),(D=o.default)==null?void 0:D.call(o,T.value),!e.hideActions&&Z(Li,{defaults:{VIcon:{icon:r.value}}},{default:()=>{var L;return[Z("span",{class:"v-expansion-panel-title__icon"},[((L=o.actions)==null?void 0:L.call(o,T.value))??Z(br,null,null)])]}})]),[[Ya("ripple"),e.ripple]])}),{}}}),s4=At({title:String,text:String,bgColor:String,...ls(),...Fd(),...co(),...Si(),...o4(),...r4()},"VExpansionPanel"),UK=Jt()({name:"VExpansionPanel",props:s4(),emits:{"group:selected":e=>!0},setup(e,t){let{slots:o}=t;const c=Vd(e,h_),{backgroundColorClasses:d,backgroundColorStyles:v}=Nr(e,"bgColor"),{elevationClasses:y}=Is(e),{roundedClasses:T}=So(e),r=Se(()=>(c==null?void 0:c.disabled.value)||e.disabled),D=Se(()=>c.group.items.value.reduce((U,$,W)=>(c.group.selected.value.includes($.id)&&U.push(W),U),[])),L=Se(()=>{const U=c.group.items.value.findIndex($=>$.id===c.id);return!c.isSelected.value&&D.value.some($=>$-U===1)}),B=Se(()=>{const U=c.group.items.value.findIndex($=>$.id===c.id);return!c.isSelected.value&&D.value.some($=>$-U===-1)});return Vr(h_,c),cn(()=>{const U=!!(o.text||e.text),$=!!(o.title||e.title),W=aS.filterProps(e),q=sS.filterProps(e);return Z(e.tag,{class:["v-expansion-panel",{"v-expansion-panel--active":c.isSelected.value,"v-expansion-panel--before-active":L.value,"v-expansion-panel--after-active":B.value,"v-expansion-panel--disabled":r.value},T.value,d.value,e.class],style:[v.value,e.style]},{default:()=>[Z("div",{class:["v-expansion-panel__shadow",...y.value]},null),Z(Li,{defaults:{VExpansionPanelTitle:{...W},VExpansionPanelText:{...q}}},{default:()=>{var ne;return[$&&Z(aS,{key:"title"},{default:()=>[o.title?o.title():e.title]}),U&&Z(sS,{key:"text"},{default:()=>[o.text?o.text():e.text]}),(ne=o.default)==null?void 0:ne.call(o)]}})]})}),{groupItem:c}}}),jK=["default","accordion","inset","popout"],$K=At({flat:Boolean,...Bd(),...fT(s4(),["bgColor","collapseIcon","color","eager","elevation","expandIcon","focusable","hideActions","readonly","ripple","rounded","tile","static"]),...Ji(),...Nn(),...Si(),variant:{type:String,default:"default",validator:e=>jK.includes(e)}},"VExpansionPanels"),GK=Jt()({name:"VExpansionPanels",props:$K(),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:o}=t;const{next:c,prev:d}=gh(e,h_),{themeClasses:v}=xr(e),y=Se(()=>e.variant&&`v-expansion-panels--variant-${e.variant}`);return wo({VExpansionPanel:{bgColor:Ht(e,"bgColor"),collapseIcon:Ht(e,"collapseIcon"),color:Ht(e,"color"),eager:Ht(e,"eager"),elevation:Ht(e,"elevation"),expandIcon:Ht(e,"expandIcon"),focusable:Ht(e,"focusable"),hideActions:Ht(e,"hideActions"),readonly:Ht(e,"readonly"),ripple:Ht(e,"ripple"),rounded:Ht(e,"rounded"),static:Ht(e,"static")}}),cn(()=>Z(e.tag,{class:["v-expansion-panels",{"v-expansion-panels--flat":e.flat,"v-expansion-panels--tile":e.tile},v.value,y.value,e.class],style:e.style},{default:()=>{var T;return[(T=o.default)==null?void 0:T.call(o,{prev:d,next:c})]}})),{next:c,prev:d}}}),HK=At({app:Boolean,appear:Boolean,extended:Boolean,layout:Boolean,offset:Boolean,modelValue:{type:Boolean,default:!0},...Yo(nb({active:!0}),["location"]),...Dd(),...iu(),...Wl({transition:"fab-transition"})},"VFab"),qK=Jt()({name:"VFab",props:HK(),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:o}=t;const c=ei(e,"modelValue"),d=kn(56),v=rn(),{resizeRef:y}=$l(B=>{B.length&&(d.value=B[0].target.clientHeight)}),T=Se(()=>e.app||e.absolute),r=Se(()=>{var B;return T.value?((B=e.location)==null?void 0:B.split(" ").shift())??"bottom":!1}),D=Se(()=>{var B;return T.value?((B=e.location)==null?void 0:B.split(" ")[1])??"end":!1});za(()=>e.app,()=>{const B=Od({id:e.name,order:Se(()=>parseInt(e.order,10)),position:r,layoutSize:Se(()=>e.layout?d.value+24:0),elementSize:Se(()=>d.value+24),active:Se(()=>e.app&&c.value),absolute:Ht(e,"absolute")});Oo(()=>{v.value=B.layoutItemStyles.value})});const L=rn();return cn(()=>{const B=yr.filterProps(e);return Z("div",{ref:L,class:["v-fab",{"v-fab--absolute":e.absolute,"v-fab--app":!!e.app,"v-fab--extended":e.extended,"v-fab--offset":e.offset,[`v-fab--${r.value}`]:T.value,[`v-fab--${D.value}`]:T.value},e.class],style:[e.app?{...v.value}:{height:"inherit",width:void 0},e.style]},[Z("div",{class:"v-fab__container"},[Z(Xs,{appear:e.appear,transition:e.transition},{default:()=>[lr(Z(yr,fn({ref:y},B,{active:void 0,location:void 0}),o),[[Hl,e.active]])]})])])}),{}}}),WK=At({chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},hideInput:Boolean,multiple:Boolean,showSize:{type:[Boolean,Number,String],default:!1,validator:e=>typeof e=="boolean"||[1e3,1024].includes(Number(e))},...su({prependIcon:"$file"}),modelValue:{type:[Array,Object],default:e=>e.multiple?[]:null,validator:e=>go(e).every(t=>t!=null&&typeof t=="object")},...D_({clearable:!0})},"VFileInput"),ZK=Jt()({name:"VFileInput",inheritAttrs:!1,props:WK(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,t){let{attrs:o,emit:c,slots:d}=t;const{t:v}=zo(),y=ei(e,"modelValue",e.modelValue,Y=>go(Y),Y=>e.multiple||Array.isArray(e.modelValue)?Y:Y[0]??null),{isFocused:T,focus:r,blur:D}=ou(e),L=Se(()=>typeof e.showSize!="boolean"?e.showSize:void 0),B=Se(()=>(y.value??[]).reduce((Y,ie)=>{let{size:te=0}=ie;return Y+te},0)),U=Se(()=>OM(B.value,L.value)),$=Se(()=>(y.value??[]).map(Y=>{const{name:ie="",size:te=0}=Y;return e.showSize?`${ie} (${OM(te,L.value)})`:ie})),W=Se(()=>{var ie;const Y=((ie=y.value)==null?void 0:ie.length)??0;return e.showSize?v(e.counterSizeString,Y,U.value):v(e.counterString,Y)}),q=rn(),ne=rn(),ce=rn(),oe=Se(()=>T.value||e.active),fe=Se(()=>["plain","underlined"].includes(e.variant));function be(){var Y;ce.value!==document.activeElement&&((Y=ce.value)==null||Y.focus()),T.value||r()}function ge(Y){var ie;(ie=ce.value)==null||ie.click()}function Ee(Y){c("mousedown:control",Y)}function de(Y){var ie;(ie=ce.value)==null||ie.click(),c("click:control",Y)}function re(Y){Y.stopPropagation(),be(),Ki(()=>{y.value=[],mT(e["onClick:clear"],Y)})}return On(y,Y=>{(!Array.isArray(Y)||!Y.length)&&ce.value&&(ce.value.value="")}),cn(()=>{const Y=!!(d.counter||e.counter),ie=!!(Y||d.details),[te,ae]=ph(o),{modelValue:pe,...Le}=Vs.filterProps(e),tt=NT(e);return Z(Vs,fn({ref:q,modelValue:y.value,"onUpdate:modelValue":Je=>y.value=Je,class:["v-file-input",{"v-file-input--chips":!!e.chips,"v-file-input--hide":e.hideInput,"v-input--plain-underlined":fe.value},e.class],style:e.style,"onClick:prepend":ge},te,Le,{centerAffix:!fe.value,focused:T.value}),{...d,default:Je=>{let{id:Mt,isDisabled:Lt,isDirty:yt,isReadonly:rt,isValid:mt}=Je;return Z(qp,fn({ref:ne,"prepend-icon":e.prependIcon,onMousedown:Ee,onClick:de,"onClick:clear":re,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},tt,{id:Mt.value,active:oe.value||yt.value,dirty:yt.value||e.dirty,disabled:Lt.value,focused:T.value,error:mt.value===!1}),{...d,default:Ft=>{var ht;let{props:{class:bn,...Bt}}=Ft;return Z(Gn,null,[Z("input",fn({ref:ce,type:"file",readonly:rt.value,disabled:Lt.value,multiple:e.multiple,name:e.name,onClick:gt=>{gt.stopPropagation(),rt.value&&gt.preventDefault(),be()},onChange:gt=>{if(!gt.target)return;const et=gt.target;y.value=[...et.files??[]]},onFocus:be,onBlur:D},Bt,ae),null),Z("div",{class:bn},[!!((ht=y.value)!=null&&ht.length)&&!e.hideInput&&(d.selection?d.selection({fileNames:$.value,totalBytes:B.value,totalBytesReadable:U.value}):e.chips?$.value.map(gt=>Z(Hp,{key:gt,size:"small",text:gt},null)):$.value.join(", "))])])}})},details:ie?Je=>{var Mt,Lt;return Z(Gn,null,[(Mt=d.details)==null?void 0:Mt.call(d,Je),Y&&Z(Gn,null,[Z("span",null,null),Z(sb,{active:!!((Lt=y.value)!=null&&Lt.length),value:W.value,disabled:e.disabled},d.counter)])])}:void 0})}),yl({},q,ne,ce)}}),XK=At({app:Boolean,color:String,height:{type:[Number,String],default:"auto"},...Na(),...Nn(),...ls(),...Dd(),...co(),...Si({tag:"footer"}),...Ji()},"VFooter"),YK=Jt()({name:"VFooter",props:XK(),setup(e,t){let{slots:o}=t;const{themeClasses:c}=xr(e),{backgroundColorClasses:d,backgroundColorStyles:v}=Nr(Ht(e,"color")),{borderClasses:y}=Qa(e),{elevationClasses:T}=Is(e),{roundedClasses:r}=So(e),D=kn(32),{resizeRef:L}=$l(W=>{W.length&&(D.value=W[0].target.clientHeight)}),B=Se(()=>e.height==="auto"?D.value:parseInt(e.height,10)),{layoutItemStyles:U,layoutIsReady:$}=Od({id:e.name,order:Se(()=>parseInt(e.order,10)),position:Se(()=>"bottom"),layoutSize:B,elementSize:Se(()=>e.height==="auto"?void 0:B.value),active:Se(()=>e.app),absolute:Ht(e,"absolute")});return cn(()=>Z(e.tag,{ref:L,class:["v-footer",c.value,d.value,y.value,T.value,r.value,e.class],style:[v.value,e.app?U.value:{height:Bn(e.height)},e.style]},o)),e.app?$:{}}}),KK=At({...Nn(),...rZ()},"VForm"),JK=Jt()({name:"VForm",props:KK(),emits:{"update:modelValue":e=>!0,submit:e=>!0},setup(e,t){let{slots:o,emit:c}=t;const d=oZ(e),v=rn();function y(r){r.preventDefault(),d.reset()}function T(r){const D=r,L=d.validate();D.then=L.then.bind(L),D.catch=L.catch.bind(L),D.finally=L.finally.bind(L),c("submit",D),D.defaultPrevented||L.then(B=>{var $;let{valid:U}=B;U&&(($=v.value)==null||$.submit())}),D.preventDefault()}return cn(()=>{var r;return Z("form",{ref:v,class:["v-form",e.class],style:e.style,novalidate:!0,onReset:y,onSubmit:T},[(r=o.default)==null?void 0:r.call(o,d)])}),yl(d,v)}}),QK=At({disabled:Boolean,modelValue:{type:Boolean,default:null},...zT()},"VHover"),eJ=Jt()({name:"VHover",props:QK(),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:o}=t;const c=ei(e,"modelValue"),{runOpenDelay:d,runCloseDelay:v}=BT(e,y=>!e.disabled&&(c.value=y));return()=>{var y;return(y=o.default)==null?void 0:y.call(o,{isHovering:c.value,props:{onMouseenter:d,onMouseleave:v}})}}}),tJ=At({color:String,direction:{type:String,default:"vertical",validator:e=>["vertical","horizontal"].includes(e)},side:{type:String,default:"end",validator:e=>["start","end","both"].includes(e)},mode:{type:String,default:"intersect",validator:e=>["intersect","manual"].includes(e)},margin:[Number,String],loadMoreText:{type:String,default:"$vuetify.infiniteScroll.loadMore"},emptyText:{type:String,default:"$vuetify.infiniteScroll.empty"},...Ko(),...Si()},"VInfiniteScroll"),Tk=Ka({name:"VInfiniteScrollIntersect",props:{side:{type:String,required:!0},rootRef:null,rootMargin:String},emits:{intersect:(e,t)=>!0},setup(e,t){let{emit:o}=t;const{intersectionRef:c,isIntersecting:d}=Q0(v=>{},e.rootMargin?{rootMargin:e.rootMargin}:void 0);return On(d,async v=>{o("intersect",e.side,v)}),cn(()=>Z("div",{class:"v-infinite-scroll-intersect",ref:c},[$o("")])),{}}}),nJ=Jt()({name:"VInfiniteScroll",props:tJ(),emits:{load:e=>!0},setup(e,t){let{slots:o,emit:c}=t;const d=rn(),v=kn("ok"),y=kn("ok"),T=Se(()=>Bn(e.margin)),r=kn(!1);function D(ge){if(!d.value)return;const Ee=e.direction==="vertical"?"scrollTop":"scrollLeft";d.value[Ee]=ge}function L(){if(!d.value)return 0;const ge=e.direction==="vertical"?"scrollTop":"scrollLeft";return d.value[ge]}function B(){if(!d.value)return 0;const ge=e.direction==="vertical"?"scrollHeight":"scrollWidth";return d.value[ge]}function U(){if(!d.value)return 0;const ge=e.direction==="vertical"?"clientHeight":"clientWidth";return d.value[ge]}ms(()=>{d.value&&(e.side==="start"?D(B()):e.side==="both"&&D(B()/2-U()/2))});function $(ge,Ee){ge==="start"?v.value=Ee:ge==="end"&&(y.value=Ee)}function W(ge){return ge==="start"?v.value:y.value}let q=0;function ne(ge,Ee){r.value=Ee,r.value&&ce(ge)}function ce(ge){if(e.mode!=="manual"&&!r.value)return;const Ee=W(ge);if(!d.value||["empty","loading"].includes(Ee))return;q=B(),$(ge,"loading");function de(re){$(ge,re),Ki(()=>{re==="empty"||re==="error"||(re==="ok"&&ge==="start"&&D(B()-q+L()),e.mode!=="manual"&&Ki(()=>{window.requestAnimationFrame(()=>{window.requestAnimationFrame(()=>{window.requestAnimationFrame(()=>{ce(ge)})})})}))})}c("load",{side:ge,done:de})}const{t:oe}=zo();function fe(ge,Ee){var Y,ie,te,ae,pe;if(e.side!==ge&&e.side!=="both")return;const de=()=>ce(ge),re={side:ge,props:{onClick:de,color:e.color}};return Ee==="error"?(Y=o.error)==null?void 0:Y.call(o,re):Ee==="empty"?((ie=o.empty)==null?void 0:ie.call(o,re))??Z("div",null,[oe(e.emptyText)]):e.mode==="manual"?Ee==="loading"?((te=o.loading)==null?void 0:te.call(o,re))??Z(Op,{indeterminate:!0,color:e.color},null):((ae=o["load-more"])==null?void 0:ae.call(o,re))??Z(yr,{variant:"outlined",color:e.color,onClick:de},{default:()=>[oe(e.loadMoreText)]}):((pe=o.loading)==null?void 0:pe.call(o,re))??Z(Op,{indeterminate:!0,color:e.color},null)}const{dimensionStyles:be}=Jo(e);cn(()=>{const ge=e.tag,Ee=e.side==="start"||e.side==="both",de=e.side==="end"||e.side==="both",re=e.mode==="intersect";return Z(ge,{ref:d,class:["v-infinite-scroll",`v-infinite-scroll--${e.direction}`,{"v-infinite-scroll--start":Ee,"v-infinite-scroll--end":de}],style:be.value},{default:()=>{var Y;return[Z("div",{class:"v-infinite-scroll__side"},[fe("start",v.value)]),d.value&&Ee&&re&&Z(Tk,{key:"start",side:"start",onIntersect:ne,rootRef:d.value,rootMargin:T.value},null),(Y=o.default)==null?void 0:Y.call(o),d.value&&de&&re&&Z(Tk,{key:"end",side:"end",onIntersect:ne,rootRef:d.value,rootMargin:T.value},null),Z("div",{class:"v-infinite-scroll__side"},[fe("end",y.value)])]}})})}}),a4=Symbol.for("vuetify:v-item-group"),iJ=At({...Nn(),...Bd({selectedClass:"v-item--selected"}),...Si(),...Ji()},"VItemGroup"),rJ=Jt()({name:"VItemGroup",props:iJ(),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:o}=t;const{themeClasses:c}=xr(e),{isSelected:d,select:v,next:y,prev:T,selected:r}=gh(e,a4);return()=>Z(e.tag,{class:["v-item-group",c.value,e.class],style:e.style},{default:()=>{var D;return[(D=o.default)==null?void 0:D.call(o,{isSelected:d,select:v,next:y,prev:T,selected:r.value})]}})}}),oJ=Jt()({name:"VItem",props:Fd(),emits:{"group:selected":e=>!0},setup(e,t){let{slots:o}=t;const{isSelected:c,select:d,toggle:v,selectedClass:y,value:T,disabled:r}=Vd(e,a4);return()=>{var D;return(D=o.default)==null?void 0:D.call(o,{isSelected:c.value,selectedClass:y.value,select:d,toggle:v,value:T.value,disabled:r.value})}}}),sJ=Tc("v-kbd"),aJ=At({...Nn(),...Ko(),...YL()},"VLayout"),lJ=Jt()({name:"VLayout",props:aJ(),setup(e,t){let{slots:o}=t;const{layoutClasses:c,layoutStyles:d,getLayoutItem:v,items:y,layoutRef:T}=JL(e),{dimensionStyles:r}=Jo(e);return cn(()=>Z("div",{ref:T,class:[c.value,e.class],style:[r.value,d.value,e.style]},[Z(UR,null,{default:()=>{var D;return[Z(Gn,null,[(D=o.default)==null?void 0:D.call(o)])]}})])),{getLayoutItem:v,items:y}}}),cJ=At({position:{type:String,required:!0},size:{type:[Number,String],default:300},modelValue:Boolean,...Nn(),...Dd()},"VLayoutItem"),uJ=Jt()({name:"VLayoutItem",props:cJ(),setup(e,t){let{slots:o}=t;const{layoutItemStyles:c,layoutIsReady:d}=Od({id:e.name,order:Se(()=>parseInt(e.order,10)),position:Ht(e,"position"),elementSize:Ht(e,"size"),layoutSize:Ht(e,"size"),active:Ht(e,"modelValue"),absolute:Ht(e,"absolute")});return cn(()=>{var v;return Z("div",{class:["v-layout-item",e.class],style:[c.value,e.style]},[(v=o.default)==null?void 0:v.call(o)])}),d}}),hJ=At({modelValue:Boolean,options:{type:Object,default:()=>({root:void 0,rootMargin:void 0,threshold:void 0})},...Nn(),...Ko(),...Si(),...Wl({transition:"fade-transition"})},"VLazy"),dJ=Jt()({name:"VLazy",directives:{intersect:E_},props:hJ(),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:o}=t;const{dimensionStyles:c}=Jo(e),d=ei(e,"modelValue");function v(y){d.value||(d.value=y)}return cn(()=>lr(Z(e.tag,{class:["v-lazy",e.class],style:[c.value,e.style]},{default:()=>[d.value&&Z(Xs,{transition:e.transition,appear:!0},{default:()=>{var y;return[(y=o.default)==null?void 0:y.call(o)]}})]}),[[Ya("intersect"),{handler:v,options:e.options},null]])),{}}}),fJ=At({locale:String,fallbackLocale:String,messages:Object,rtl:{type:Boolean,default:void 0},...Nn()},"VLocaleProvider"),pJ=Jt()({name:"VLocaleProvider",props:fJ(),setup(e,t){let{slots:o}=t;const{rtlClasses:c}=e7(e);return cn(()=>{var d;return Z("div",{class:["v-locale-provider",c.value,e.class],style:e.style},[(d=o.default)==null?void 0:d.call(o)])}),{}}}),mJ=At({scrollable:Boolean,...Nn(),...Ko(),...Si({tag:"main"})},"VMain"),gJ=Jt()({name:"VMain",props:mJ(),setup(e,t){let{slots:o}=t;const{dimensionStyles:c}=Jo(e),{mainStyles:d,layoutIsReady:v}=KL(),{ssrBootStyles:y}=Ld();return cn(()=>Z(e.tag,{class:["v-main",{"v-main--scrollable":e.scrollable},e.class],style:[d.value,y.value,c.value,e.style]},{default:()=>{var T,r;return[e.scrollable?Z("div",{class:"v-main__scroller"},[(T=o.default)==null?void 0:T.call(o)]):(r=o.default)==null?void 0:r.call(o)]}})),v}});function _J(e){let{rootEl:t,isSticky:o,layoutItemStyles:c}=e;const d=kn(!1),v=kn(0),y=Se(()=>{const D=typeof d.value=="boolean"?"top":d.value;return[o.value?{top:"auto",bottom:"auto",height:void 0}:void 0,d.value?{[D]:Bn(v.value)}:{top:c.value.top}]});ms(()=>{On(o,D=>{D?window.addEventListener("scroll",r,{passive:!0}):window.removeEventListener("scroll",r)},{immediate:!0})}),Ts(()=>{window.removeEventListener("scroll",r)});let T=0;function r(){const D=T>window.scrollY?"up":"down",L=t.value.getBoundingClientRect(),B=parseFloat(c.value.top??0),U=window.scrollY-Math.max(0,v.value-B),$=L.height+Math.max(v.value,B)-window.scrollY-window.innerHeight,W=parseFloat(getComputedStyle(t.value).getPropertyValue("--v-body-scroll-y"))||0;L.height<window.innerHeight-B?(d.value="top",v.value=B):D==="up"&&d.value==="bottom"||D==="down"&&d.value==="top"?(v.value=window.scrollY+L.top-W,d.value=!0):D==="down"&&$<=0?(v.value=0,d.value="bottom"):D==="up"&&U<=0&&(W?d.value!=="top"&&(v.value=-U+W+B,d.value="top"):(v.value=L.top+U,d.value="top")),T=window.scrollY}return{isStuck:d,stickyStyles:y}}const vJ=100,yJ=20;function Ek(e){return(e<0?-1:1)*Math.sqrt(Math.abs(e))*1.41421356237}function Ik(e){if(e.length<2)return 0;if(e.length===2)return e[1].t===e[0].t?0:(e[1].d-e[0].d)/(e[1].t-e[0].t);let t=0;for(let o=e.length-1;o>0;o--){if(e[o].t===e[o-1].t)continue;const c=Ek(t),d=(e[o].d-e[o-1].d)/(e[o].t-e[o-1].t);t+=(d-c)*Math.abs(d),o===e.length-1&&(t*=.5)}return Ek(t)*1e3}function bJ(){const e={};function t(d){Array.from(d.changedTouches).forEach(v=>{(e[v.identifier]??(e[v.identifier]=new pq(yJ))).push([d.timeStamp,v])})}function o(d){Array.from(d.changedTouches).forEach(v=>{delete e[v.identifier]})}function c(d){var D;const v=(D=e[d])==null?void 0:D.values().reverse();if(!v)throw new Error(`No samples for touch id ${d}`);const y=v[0],T=[],r=[];for(const L of v){if(y[0]-L[0]>vJ)break;T.push({t:L[0],d:L[1].clientX}),r.push({t:L[0],d:L[1].clientY})}return{x:Ik(T),y:Ik(r),get direction(){const{x:L,y:B}=this,[U,$]=[Math.abs(L),Math.abs(B)];return U>$&&L>=0?"right":U>$&&L<=0?"left":$>U&&B>=0?"down":$>U&&B<=0?"up":xJ()}}}return{addMovement:t,endTouch:o,getVelocity:c}}function xJ(){throw new Error}function wJ(e){let{el:t,isActive:o,isTemporary:c,width:d,touchless:v,position:y}=e;ms(()=>{window.addEventListener("touchstart",oe,{passive:!0}),window.addEventListener("touchmove",fe,{passive:!1}),window.addEventListener("touchend",be,{passive:!0})}),Ts(()=>{window.removeEventListener("touchstart",oe),window.removeEventListener("touchmove",fe),window.removeEventListener("touchend",be)});const T=Se(()=>["left","right"].includes(y.value)),{addMovement:r,endTouch:D,getVelocity:L}=bJ();let B=!1;const U=kn(!1),$=kn(0),W=kn(0);let q;function ne(Ee,de){return(y.value==="left"?Ee:y.value==="right"?document.documentElement.clientWidth-Ee:y.value==="top"?Ee:y.value==="bottom"?document.documentElement.clientHeight-Ee:ip())-(de?d.value:0)}function ce(Ee){let de=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;const re=y.value==="left"?(Ee-W.value)/d.value:y.value==="right"?(document.documentElement.clientWidth-Ee-W.value)/d.value:y.value==="top"?(Ee-W.value)/d.value:y.value==="bottom"?(document.documentElement.clientHeight-Ee-W.value)/d.value:ip();return de?Math.max(0,Math.min(1,re)):re}function oe(Ee){if(v.value)return;const de=Ee.changedTouches[0].clientX,re=Ee.changedTouches[0].clientY,Y=25,ie=y.value==="left"?de<Y:y.value==="right"?de>document.documentElement.clientWidth-Y:y.value==="top"?re<Y:y.value==="bottom"?re>document.documentElement.clientHeight-Y:ip(),te=o.value&&(y.value==="left"?de<d.value:y.value==="right"?de>document.documentElement.clientWidth-d.value:y.value==="top"?re<d.value:y.value==="bottom"?re>document.documentElement.clientHeight-d.value:ip());(ie||te||o.value&&c.value)&&(q=[de,re],W.value=ne(T.value?de:re,o.value),$.value=ce(T.value?de:re),B=W.value>-20&&W.value<80,D(Ee),r(Ee))}function fe(Ee){const de=Ee.changedTouches[0].clientX,re=Ee.changedTouches[0].clientY;if(B){if(!Ee.cancelable){B=!1;return}const ie=Math.abs(de-q[0]),te=Math.abs(re-q[1]);(T.value?ie>te&&ie>3:te>ie&&te>3)?(U.value=!0,B=!1):(T.value?te:ie)>3&&(B=!1)}if(!U.value)return;Ee.preventDefault(),r(Ee);const Y=ce(T.value?de:re,!1);$.value=Math.max(0,Math.min(1,Y)),Y>1?W.value=ne(T.value?de:re,!0):Y<0&&(W.value=ne(T.value?de:re,!1))}function be(Ee){if(B=!1,!U.value)return;r(Ee),U.value=!1;const de=L(Ee.changedTouches[0].identifier),re=Math.abs(de.x),Y=Math.abs(de.y);(T.value?re>Y&&re>400:Y>re&&Y>3)?o.value=de.direction===({left:"right",right:"left",top:"down",bottom:"up"}[y.value]||ip()):o.value=$.value>.5}const ge=Se(()=>U.value?{transform:y.value==="left"?`translateX(calc(-100% + ${$.value*d.value}px))`:y.value==="right"?`translateX(calc(100% - ${$.value*d.value}px))`:y.value==="top"?`translateY(calc(-100% + ${$.value*d.value}px))`:y.value==="bottom"?`translateY(calc(100% - ${$.value*d.value}px))`:ip(),transition:"none"}:void 0);return za(U,()=>{var re,Y;const Ee=((re=t.value)==null?void 0:re.style.transform)??null,de=((Y=t.value)==null?void 0:Y.style.transition)??null;Oo(()=>{var ie,te,ae,pe;(te=t.value)==null||te.style.setProperty("transform",((ie=ge.value)==null?void 0:ie.transform)||"none"),(pe=t.value)==null||pe.style.setProperty("transition",((ae=ge.value)==null?void 0:ae.transition)||null)}),Ys(()=>{var ie,te;(ie=t.value)==null||ie.style.setProperty("transform",Ee),(te=t.value)==null||te.style.setProperty("transition",de)})}),{isDragging:U,dragProgress:$,dragStyles:ge}}function ip(){throw new Error}const SJ=["start","end","left","right","top","bottom"],TJ=At({color:String,disableResizeWatcher:Boolean,disableRouteWatcher:Boolean,expandOnHover:Boolean,floating:Boolean,modelValue:{type:Boolean,default:null},permanent:Boolean,rail:{type:Boolean,default:null},railWidth:{type:[Number,String],default:56},scrim:{type:[Boolean,String],default:!0},image:String,temporary:Boolean,persistent:Boolean,touchless:Boolean,width:{type:[Number,String],default:256},location:{type:String,default:"start",validator:e=>SJ.includes(e)},sticky:Boolean,...Na(),...Nn(),...zT(),...Rd({mobile:null}),...ls(),...Dd(),...co(),...Si({tag:"nav"}),...Ji()},"VNavigationDrawer"),EJ=Jt()({name:"VNavigationDrawer",props:TJ(),emits:{"update:modelValue":e=>!0,"update:rail":e=>!0},setup(e,t){let{attrs:o,emit:c,slots:d}=t;const{isRtl:v}=gs(),{themeClasses:y}=xr(e),{borderClasses:T}=Qa(e),{backgroundColorClasses:r,backgroundColorStyles:D}=Nr(Ht(e,"color")),{elevationClasses:L}=Is(e),{displayClasses:B,mobile:U}=_l(e),{roundedClasses:$}=So(e),W=cz(),q=ei(e,"modelValue",null,Ft=>!!Ft),{ssrBootStyles:ne}=Ld(),{scopeId:ce}=Ud(),oe=rn(),fe=kn(!1),{runOpenDelay:be,runCloseDelay:ge}=BT(e,Ft=>{fe.value=Ft}),Ee=Se(()=>e.rail&&e.expandOnHover&&fe.value?Number(e.width):Number(e.rail?e.railWidth:e.width)),de=Se(()=>Mw(e.location,v.value)),re=Se(()=>e.persistent),Y=Se(()=>!e.permanent&&(U.value||e.temporary)),ie=Se(()=>e.sticky&&!Y.value&&de.value!=="bottom");za(()=>e.expandOnHover&&e.rail!=null,()=>{On(fe,Ft=>c("update:rail",!Ft))}),za(()=>!e.disableResizeWatcher,()=>{On(Y,Ft=>!e.permanent&&Ki(()=>q.value=!Ft))}),za(()=>!e.disableRouteWatcher&&!!W,()=>{On(W.currentRoute,()=>Y.value&&(q.value=!1))}),On(()=>e.permanent,Ft=>{Ft&&(q.value=!0)}),e.modelValue==null&&!Y.value&&(q.value=e.permanent||!U.value);const{isDragging:te,dragProgress:ae}=wJ({el:oe,isActive:q,isTemporary:Y,width:Ee,touchless:Ht(e,"touchless"),position:de}),pe=Se(()=>{const Ft=Y.value?0:e.rail&&e.expandOnHover?Number(e.railWidth):Ee.value;return te.value?Ft*ae.value:Ft}),Le=Se(()=>["top","bottom"].includes(e.location)?0:Ee.value),{layoutItemStyles:tt,layoutItemScrimStyles:Je,layoutIsReady:Mt}=Od({id:e.name,order:Se(()=>parseInt(e.order,10)),position:de,layoutSize:pe,elementSize:Le,active:Se(()=>q.value||te.value),disableTransitions:Se(()=>te.value),absolute:Se(()=>e.absolute||ie.value&&typeof Lt.value!="string")}),{isStuck:Lt,stickyStyles:yt}=_J({rootEl:oe,isSticky:ie,layoutItemStyles:tt}),rt=Nr(Se(()=>typeof e.scrim=="string"?e.scrim:null)),mt=Se(()=>({...te.value?{opacity:ae.value*.2,transition:"none"}:void 0,...Je.value}));return wo({VList:{bgColor:"transparent"}}),cn(()=>{const Ft=d.image||e.image;return Z(Gn,null,[Z(e.tag,fn({ref:oe,onMouseenter:be,onMouseleave:ge,class:["v-navigation-drawer",`v-navigation-drawer--${de.value}`,{"v-navigation-drawer--expand-on-hover":e.expandOnHover,"v-navigation-drawer--floating":e.floating,"v-navigation-drawer--is-hovering":fe.value,"v-navigation-drawer--rail":e.rail,"v-navigation-drawer--temporary":Y.value,"v-navigation-drawer--persistent":re.value,"v-navigation-drawer--active":q.value,"v-navigation-drawer--sticky":ie.value},y.value,r.value,T.value,B.value,L.value,$.value,e.class],style:[D.value,tt.value,ne.value,yt.value,e.style,["top","bottom"].includes(de.value)?{height:"auto"}:{}]},ce,o),{default:()=>{var bn,Bt,ht;return[Ft&&Z("div",{key:"image",class:"v-navigation-drawer__img"},[d.image?Z(Li,{key:"image-defaults",disabled:!e.image,defaults:{VImg:{alt:"",cover:!0,height:"inherit",src:e.image}}},d.image):Z(Qc,{key:"image-img",alt:"",cover:!0,height:"inherit",src:e.image},null)]),d.prepend&&Z("div",{class:"v-navigation-drawer__prepend"},[(bn=d.prepend)==null?void 0:bn.call(d)]),Z("div",{class:"v-navigation-drawer__content"},[(Bt=d.default)==null?void 0:Bt.call(d)]),d.append&&Z("div",{class:"v-navigation-drawer__append"},[(ht=d.append)==null?void 0:ht.call(d)])]}}),Z(Nl,{name:"fade-transition"},{default:()=>[Y.value&&(te.value||q.value)&&!!e.scrim&&Z("div",fn({class:["v-navigation-drawer__scrim",rt.backgroundColorClasses.value],style:[mt.value,rt.backgroundColorStyles.value],onClick:()=>{re.value||(q.value=!1)}},ce),null)]})])}),Mt.then(()=>({isStuck:Lt}))}}),IJ=Ka({name:"VNoSsr",setup(e,t){let{slots:o}=t;const c=Zz();return()=>{var d;return c.value&&((d=o.default)==null?void 0:d.call(o))}}}),CJ=At({autofocus:Boolean,divider:String,focusAll:Boolean,label:{type:String,default:"$vuetify.input.otp"},length:{type:[Number,String],default:6},modelValue:{type:[Number,String],default:void 0},placeholder:String,type:{type:String,default:"number"},...Ko(),...M_(),...G0(D_({variant:"outlined"}),["baseColor","bgColor","class","color","disabled","error","loading","rounded","style","theme","variant"])},"VOtpInput"),AJ=Jt()({name:"VOtpInput",props:CJ(),emits:{finish:e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,t){let{attrs:o,emit:c,slots:d}=t;const{dimensionStyles:v}=Jo(e),{isFocused:y,focus:T,blur:r}=ou(e),D=ei(e,"modelValue","",re=>re==null?[]:String(re).split(""),re=>re.join("")),{t:L}=zo(),B=Se(()=>Number(e.length)),U=Se(()=>Array(B.value).fill(0)),$=rn(-1),W=rn(),q=rn([]),ne=Se(()=>q.value[$.value]);function ce(){if(de(ne.value.value)){ne.value.value="";return}const re=D.value.slice(),Y=ne.value.value;re[$.value]=Y;let ie=null;$.value>D.value.length?ie=D.value.length+1:$.value+1!==B.value&&(ie="next"),D.value=re,ie&&Mp(W.value,ie)}function oe(re){const Y=D.value.slice(),ie=$.value;let te=null;["ArrowLeft","ArrowRight","Backspace","Delete"].includes(re.key)&&(re.preventDefault(),re.key==="ArrowLeft"?te="prev":re.key==="ArrowRight"?te="next":["Backspace","Delete"].includes(re.key)&&(Y[$.value]="",D.value=Y,$.value>0&&re.key==="Backspace"?te="prev":requestAnimationFrame(()=>{var ae;(ae=q.value[ie])==null||ae.select()})),requestAnimationFrame(()=>{te!=null&&Mp(W.value,te)}))}function fe(re,Y){var te,ae;Y.preventDefault(),Y.stopPropagation();const ie=((te=Y==null?void 0:Y.clipboardData)==null?void 0:te.getData("Text").slice(0,B.value))??"";de(ie)||(D.value=ie.split(""),(ae=q.value)==null||ae[re].blur())}function be(){D.value=[]}function ge(re,Y){T(),$.value=Y}function Ee(){r(),$.value=-1}function de(re){return e.type==="number"&&/[^0-9]/g.test(re)}return wo({VField:{color:Se(()=>e.color),bgColor:Se(()=>e.color),baseColor:Se(()=>e.baseColor),disabled:Se(()=>e.disabled),error:Se(()=>e.error),variant:Se(()=>e.variant)}},{scoped:!0}),On(D,re=>{re.length===B.value&&c("finish",re.join(""))},{deep:!0}),On($,re=>{re<0||Ki(()=>{var Y;(Y=q.value[re])==null||Y.select()})}),cn(()=>{var ie;const[re,Y]=ph(o);return Z("div",fn({class:["v-otp-input",{"v-otp-input--divided":!!e.divider},e.class],style:[e.style]},re),[Z("div",{ref:W,class:"v-otp-input__content",style:[v.value]},[U.value.map((te,ae)=>Z(Gn,null,[e.divider&&ae!==0&&Z("span",{class:"v-otp-input__divider"},[e.divider]),Z(qp,{focused:y.value&&e.focusAll||$.value===ae,key:ae},{...d,loader:void 0,default:()=>Z("input",{ref:pe=>q.value[ae]=pe,"aria-label":L(e.label,ae+1),autofocus:ae===0&&e.autofocus,autocomplete:"one-time-code",class:["v-otp-input__field"],disabled:e.disabled,inputmode:e.type==="number"?"numeric":"text",min:e.type==="number"?0:void 0,maxlength:"1",placeholder:e.placeholder,type:e.type==="number"?"text":e.type,value:D.value[ae],onInput:ce,onFocus:pe=>ge(pe,ae),onBlur:Ee,onKeydown:oe,onPaste:pe=>fe(ae,pe)},null)})])),Z("input",fn({class:"v-otp-input-input",type:"hidden"},Y,{value:D.value.join("")}),null),Z(vc,{contained:!0,"content-class":"v-otp-input__loader","model-value":!!e.loading,persistent:!0},{default:()=>{var te;return[((te=d.loader)==null?void 0:te.call(d))??Z(Op,{color:typeof e.loading=="boolean"?void 0:e.loading,indeterminate:!0,size:"24",width:"2"},null)]}}),(ie=d.default)==null?void 0:ie.call(d)])])}),{blur:()=>{var re;(re=q.value)==null||re.some(Y=>Y.blur())},focus:()=>{var re;(re=q.value)==null||re[0].focus()},reset:be,isFocused:y}}});function PJ(e){return Math.floor(Math.abs(e))*Math.sign(e)}const MJ=At({scale:{type:[Number,String],default:.5},...Nn()},"VParallax"),kJ=Jt()({name:"VParallax",props:MJ(),setup(e,t){let{slots:o}=t;const{intersectionRef:c,isIntersecting:d}=Q0(),{resizeRef:v,contentRect:y}=$l(),{height:T}=_l(),r=rn();Oo(()=>{var $;c.value=v.value=($=r.value)==null?void 0:$.$el});let D;On(d,$=>{$?(D=bT(c.value),D=D===document.scrollingElement?document:D,D.addEventListener("scroll",U,{passive:!0}),U()):D.removeEventListener("scroll",U)}),Ts(()=>{D==null||D.removeEventListener("scroll",U)}),On(T,U),On(()=>{var $;return($=y.value)==null?void 0:$.height},U);const L=Se(()=>1-Go(+e.scale));let B=-1;function U(){d.value&&(cancelAnimationFrame(B),B=requestAnimationFrame(()=>{var ge;const $=((ge=r.value)==null?void 0:ge.$el).querySelector(".v-img__img");if(!$)return;const W=D instanceof Document?document.documentElement.clientHeight:D.clientHeight,q=D instanceof Document?window.scrollY:D.scrollTop,ne=c.value.getBoundingClientRect().top+q,ce=y.value.height,oe=ne+(ce-W)/2,fe=PJ((q-oe)*L.value),be=Math.max(1,(L.value*(W-ce)+ce)/ce);$.style.setProperty("transform",`translateY(${fe}px) scale(${be})`)}))}return cn(()=>Z(Qc,{class:["v-parallax",{"v-parallax--active":d.value},e.class],style:e.style,ref:r,cover:!0,onLoadstart:U,onLoad:U},o)),{}}}),RJ=At({...ib({falseIcon:"$radioOff",trueIcon:"$radioOn"})},"VRadio"),DJ=Jt()({name:"VRadio",props:RJ(),setup(e,t){let{slots:o}=t;return cn(()=>{const c=lh.filterProps(e);return Z(lh,fn(c,{class:["v-radio",e.class],style:e.style,type:"radio"}),o)}),{}}}),OJ=At({height:{type:[Number,String],default:"auto"},...su(),...Yo(kT(),["multiple"]),trueIcon:{type:mi,default:"$radioOn"},falseIcon:{type:mi,default:"$radioOff"},type:{type:String,default:"radio"}},"VRadioGroup"),LJ=Jt()({name:"VRadioGroup",inheritAttrs:!1,props:OJ(),emits:{"update:modelValue":e=>!0},setup(e,t){let{attrs:o,slots:c}=t;const d=Es(),v=Se(()=>e.id||`radio-group-${d}`),y=ei(e,"modelValue");return cn(()=>{const[T,r]=ph(o),D=Vs.filterProps(e),L=lh.filterProps(e),B=c.label?c.label({label:e.label,props:{for:v.value}}):e.label;return Z(Vs,fn({class:["v-radio-group",e.class],style:e.style},T,D,{modelValue:y.value,"onUpdate:modelValue":U=>y.value=U,id:v.value}),{...c,default:U=>{let{id:$,messagesId:W,isDisabled:q,isReadonly:ne}=U;return Z(Gn,null,[B&&Z(Gp,{id:$.value},{default:()=>[B]}),Z(bz,fn(L,{id:$.value,"aria-describedby":W.value,defaultsTarget:"VRadio",trueIcon:e.trueIcon,falseIcon:e.falseIcon,type:e.type,disabled:q.value,readonly:ne.value,"aria-labelledby":B?$.value:void 0,multiple:!1},r,{modelValue:y.value,"onUpdate:modelValue":ce=>y.value=ce}),c)])}})}),{}}}),zJ=At({...M_(),...su(),...mB(),strict:Boolean,modelValue:{type:Array,default:()=>[0,0]}},"VRangeSlider"),BJ=Jt()({name:"VRangeSlider",props:zJ(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,end:e=>!0,start:e=>!0},setup(e,t){let{slots:o,emit:c}=t;const d=rn(),v=rn(),y=rn(),{rtlClasses:T}=gs();function r(ie){if(!d.value||!v.value)return;const te=Yw(ie,d.value.$el,e.direction),ae=Yw(ie,v.value.$el,e.direction),pe=Math.abs(te),Le=Math.abs(ae);return pe<Le||pe===Le&&te<0?d.value.$el:v.value.$el}const D=gB(e),L=ei(e,"modelValue",void 0,ie=>ie!=null&&ie.length?ie.map(te=>D.roundValue(te)):[0,0]),{activeThumbRef:B,hasLabels:U,max:$,min:W,mousePressed:q,onSliderMousedown:ne,onSliderTouchstart:ce,position:oe,trackContainerRef:fe,readonly:be}=_B({props:e,steps:D,onSliderStart:()=>{c("start",L.value)},onSliderEnd:ie=>{var pe;let{value:te}=ie;const ae=B.value===((pe=d.value)==null?void 0:pe.$el)?[te,L.value[1]]:[L.value[0],te];!e.strict&&ae[0]<ae[1]&&(L.value=ae),c("end",L.value)},onSliderMove:ie=>{var Le,tt,Je,Mt;let{value:te}=ie;const[ae,pe]=L.value;!e.strict&&ae===pe&&ae!==W.value&&(B.value=te>ae?(Le=v.value)==null?void 0:Le.$el:(tt=d.value)==null?void 0:tt.$el,(Je=B.value)==null||Je.focus()),B.value===((Mt=d.value)==null?void 0:Mt.$el)?L.value=[Math.min(te,pe),pe]:L.value=[ae,Math.max(ae,te)]},getActiveThumb:r}),{isFocused:ge,focus:Ee,blur:de}=ou(e),re=Se(()=>oe(L.value[0])),Y=Se(()=>oe(L.value[1]));return cn(()=>{const ie=Vs.filterProps(e),te=!!(e.label||o.label||o.prepend);return Z(Vs,fn({class:["v-slider","v-range-slider",{"v-slider--has-labels":!!o["tick-label"]||U.value,"v-slider--focused":ge.value,"v-slider--pressed":q.value,"v-slider--disabled":e.disabled},T.value,e.class],style:e.style,ref:y},ie,{focused:ge.value}),{...o,prepend:te?ae=>{var pe,Le;return Z(Gn,null,[((pe=o.label)==null?void 0:pe.call(o,ae))??(e.label?Z(Gp,{class:"v-slider__label",text:e.label},null):void 0),(Le=o.prepend)==null?void 0:Le.call(o,ae)])}:void 0,default:ae=>{var tt,Je;let{id:pe,messagesId:Le}=ae;return Z("div",{class:"v-slider__container",onMousedown:be.value?void 0:ne,onTouchstartPassive:be.value?void 0:ce},[Z("input",{id:`${pe.value}_start`,name:e.name||pe.value,disabled:!!e.disabled,readonly:!!e.readonly,tabindex:"-1",value:L.value[0]},null),Z("input",{id:`${pe.value}_stop`,name:e.name||pe.value,disabled:!!e.disabled,readonly:!!e.readonly,tabindex:"-1",value:L.value[1]},null),Z(vB,{ref:fe,start:re.value,stop:Y.value},{"tick-label":o["tick-label"]}),Z(Kw,{ref:d,"aria-describedby":Le.value,focused:ge&&B.value===((tt=d.value)==null?void 0:tt.$el),modelValue:L.value[0],"onUpdate:modelValue":Mt=>L.value=[Mt,L.value[1]],onFocus:Mt=>{var Lt,yt,rt,mt;Ee(),B.value=(Lt=d.value)==null?void 0:Lt.$el,L.value[0]===L.value[1]&&L.value[1]===W.value&&Mt.relatedTarget!==((yt=v.value)==null?void 0:yt.$el)&&((rt=d.value)==null||rt.$el.blur(),(mt=v.value)==null||mt.$el.focus())},onBlur:()=>{de(),B.value=void 0},min:W.value,max:L.value[1],position:re.value,ripple:e.ripple},{"thumb-label":o["thumb-label"]}),Z(Kw,{ref:v,"aria-describedby":Le.value,focused:ge&&B.value===((Je=v.value)==null?void 0:Je.$el),modelValue:L.value[1],"onUpdate:modelValue":Mt=>L.value=[L.value[0],Mt],onFocus:Mt=>{var Lt,yt,rt,mt;Ee(),B.value=(Lt=v.value)==null?void 0:Lt.$el,L.value[0]===L.value[1]&&L.value[0]===$.value&&Mt.relatedTarget!==((yt=d.value)==null?void 0:yt.$el)&&((rt=v.value)==null||rt.$el.blur(),(mt=d.value)==null||mt.$el.focus())},onBlur:()=>{de(),B.value=void 0},min:L.value[0],max:$.value,position:Y.value,ripple:e.ripple},{"thumb-label":o["thumb-label"]})])}})}),{}}}),FJ=At({name:String,itemAriaLabel:{type:String,default:"$vuetify.rating.ariaLabel.item"},activeColor:String,color:String,clearable:Boolean,disabled:Boolean,emptyIcon:{type:mi,default:"$ratingEmpty"},fullIcon:{type:mi,default:"$ratingFull"},halfIncrements:Boolean,hover:Boolean,length:{type:[Number,String],default:5},readonly:Boolean,modelValue:{type:[Number,String],default:0},itemLabels:Array,itemLabelPosition:{type:String,default:"top",validator:e=>["top","bottom"].includes(e)},ripple:Boolean,...Nn(),..._s(),...Ec(),...Si(),...Ji()},"VRating"),VJ=Jt()({name:"VRating",props:FJ(),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:o}=t;const{t:c}=zo(),{themeClasses:d}=xr(e),v=ei(e,"modelValue"),y=Se(()=>Go(parseFloat(v.value),0,+e.length)),T=Se(()=>dc(Number(e.length),1)),r=Se(()=>T.value.flatMap(q=>e.halfIncrements?[q-.5,q]:[q])),D=kn(-1),L=Se(()=>r.value.map(q=>{const ne=e.hover&&D.value>-1,ce=y.value>=q,oe=D.value>=q,be=(ne?oe:ce)?e.fullIcon:e.emptyIcon,ge=e.activeColor??e.color,Ee=ce||oe?ge:e.color;return{isFilled:ce,isHovered:oe,icon:be,color:Ee}})),B=Se(()=>[0,...r.value].map(q=>{function ne(){D.value=q}function ce(){D.value=-1}function oe(){e.disabled||e.readonly||(v.value=y.value===q&&e.clearable?0:q)}return{onMouseenter:e.hover?ne:void 0,onMouseleave:e.hover?ce:void 0,onClick:oe}})),U=Se(()=>e.name??`v-rating-${Es()}`);function $(q){var re,Y;let{value:ne,index:ce,showStar:oe=!0}=q;const{onMouseenter:fe,onMouseleave:be,onClick:ge}=B.value[ce+1],Ee=`${U.value}-${String(ne).replace(".","-")}`,de={color:(re=L.value[ce])==null?void 0:re.color,density:e.density,disabled:e.disabled,icon:(Y=L.value[ce])==null?void 0:Y.icon,ripple:e.ripple,size:e.size,variant:"plain"};return Z(Gn,null,[Z("label",{for:Ee,class:{"v-rating__item--half":e.halfIncrements&&ne%1>0,"v-rating__item--full":e.halfIncrements&&ne%1===0},onMouseenter:fe,onMouseleave:be,onClick:ge},[Z("span",{class:"v-rating__hidden"},[c(e.itemAriaLabel,ne,e.length)]),oe?o.item?o.item({...L.value[ce],props:de,value:ne,index:ce,rating:y.value}):Z(yr,fn({"aria-label":c(e.itemAriaLabel,ne,e.length)},de),null):void 0]),Z("input",{class:"v-rating__hidden",name:U.value,id:Ee,type:"radio",value:ne,checked:y.value===ne,tabindex:-1,readonly:e.readonly,disabled:e.disabled},null)])}function W(q){return o["item-label"]?o["item-label"](q):q.label?Z("span",null,[q.label]):Z("span",null,[$o("")])}return cn(()=>{var ne;const q=!!((ne=e.itemLabels)!=null&&ne.length)||o["item-label"];return Z(e.tag,{class:["v-rating",{"v-rating--hover":e.hover,"v-rating--readonly":e.readonly},d.value,e.class],style:e.style},{default:()=>[Z($,{value:0,index:-1,showStar:!1},null),T.value.map((ce,oe)=>{var fe,be;return Z("div",{class:"v-rating__wrapper"},[q&&e.itemLabelPosition==="top"?W({value:ce,index:oe,label:(fe=e.itemLabels)==null?void 0:fe[oe]}):void 0,Z("div",{class:"v-rating__item"},[e.halfIncrements?Z(Gn,null,[Z($,{value:ce-.5,index:oe*2},null),Z($,{value:ce,index:oe*2+1},null)]):Z($,{value:ce,index:oe},null)]),q&&e.itemLabelPosition==="bottom"?W({value:ce,index:oe,label:(be=e.itemLabels)==null?void 0:be[oe]}):void 0])})]})}),{}}}),NJ={actions:"button@2",article:"heading, paragraph",avatar:"avatar",button:"button",card:"image, heading","card-avatar":"image, list-item-avatar",chip:"chip","date-picker":"list-item, heading, divider, date-picker-options, date-picker-days, actions","date-picker-options":"text, avatar@2","date-picker-days":"avatar@28",divider:"divider",heading:"heading",image:"image","list-item":"text","list-item-avatar":"avatar, text","list-item-two-line":"sentences","list-item-avatar-two-line":"avatar, sentences","list-item-three-line":"paragraph","list-item-avatar-three-line":"avatar, paragraph",ossein:"ossein",paragraph:"text@3",sentences:"text@2",subtitle:"text",table:"table-heading, table-thead, table-tbody, table-tfoot","table-heading":"chip, text","table-thead":"heading@6","table-tbody":"table-row-divider@6","table-row-divider":"table-row, divider","table-row":"text@6","table-tfoot":"text@2, avatar@2",text:"text"};function UJ(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return Z("div",{class:["v-skeleton-loader__bone",`v-skeleton-loader__${e}`]},[t])}function Ck(e){const[t,o]=e.split("@");return Array.from({length:o}).map(()=>xb(t))}function xb(e){let t=[];if(!e)return t;const o=NJ[e];if(e!==o){if(e.includes(","))return Ak(e);if(e.includes("@"))return Ck(e);o.includes(",")?t=Ak(o):o.includes("@")?t=Ck(o):o&&t.push(xb(o))}return[UJ(e,t)]}function Ak(e){return e.replace(/\s/g,"").split(",").map(xb)}const jJ=At({boilerplate:Boolean,color:String,loading:Boolean,loadingText:{type:String,default:"$vuetify.loading"},type:{type:[String,Array],default:"ossein"},...Ko(),...ls(),...Ji()},"VSkeletonLoader"),$J=Jt()({name:"VSkeletonLoader",props:jJ(),setup(e,t){let{slots:o}=t;const{backgroundColorClasses:c,backgroundColorStyles:d}=Nr(Ht(e,"color")),{dimensionStyles:v}=Jo(e),{elevationClasses:y}=Is(e),{themeClasses:T}=xr(e),{t:r}=zo(),D=Se(()=>xb(go(e.type).join(",")));return cn(()=>{var B;const L=!o.default||e.loading;return Z("div",{class:["v-skeleton-loader",{"v-skeleton-loader--boilerplate":e.boilerplate},T.value,c.value,y.value],style:[d.value,L?v.value:{}],"aria-busy":e.boilerplate?void 0:L,"aria-live":e.boilerplate?void 0:"polite","aria-label":e.boilerplate?void 0:r(e.loadingText),role:e.boilerplate?void 0:"alert"},[L?D.value:(B=o.default)==null?void 0:B.call(o)])}),{}}}),GJ=Jt()({name:"VSlideGroupItem",props:Fd(),emits:{"group:selected":e=>!0},setup(e,t){let{slots:o}=t;const c=Vd(e,Pz);return()=>{var d;return(d=o.default)==null?void 0:d.call(o,{isSelected:c.isSelected.value,select:c.select,toggle:c.toggle,selectedClass:c.selectedClass.value})}}});function HJ(e){const t=kn(e);let o=-1;function c(){clearInterval(o)}function d(){c(),Ki(()=>t.value=e)}function v(y){const T=y?getComputedStyle(y):{transitionDuration:.2},r=parseFloat(T.transitionDuration)*1e3||200;if(c(),t.value<=0)return;const D=performance.now();o=window.setInterval(()=>{const L=performance.now()-D+r;t.value=Math.max(e-L,0),t.value<=0&&c()},r)}return Ys(c),{clear:c,time:t,start:v,reset:d}}const qJ=At({multiLine:Boolean,text:String,timer:[Boolean,String],timeout:{type:[Number,String],default:5e3},vertical:Boolean,...iu({location:"bottom"}),...jp(),...co(),...vl(),...Ji(),...Yo(R_({transition:"v-snackbar-transition"}),["persistent","noClickAnimation","scrim","scrollStrategy"])},"VSnackbar"),WJ=Jt()({name:"VSnackbar",props:qJ(),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:o}=t;const c=ei(e,"modelValue"),{positionClasses:d}=$p(e),{scopeId:v}=Ud(),{themeClasses:y}=xr(e),{colorClasses:T,colorStyles:r,variantClasses:D}=zd(e),{roundedClasses:L}=So(e),B=HJ(Number(e.timeout)),U=rn(),$=rn(),W=kn(!1),q=kn(0),ne=rn(),ce=Mi(i_,void 0);za(()=>!!ce,()=>{const ie=KL();Oo(()=>{ne.value=ie.mainStyles.value})}),On(c,fe),On(()=>e.timeout,fe),ms(()=>{c.value&&fe()});let oe=-1;function fe(){B.reset(),window.clearTimeout(oe);const ie=Number(e.timeout);if(!c.value||ie===-1)return;const te=dT($.value);B.start(te),oe=window.setTimeout(()=>{c.value=!1},ie)}function be(){B.reset(),window.clearTimeout(oe)}function ge(){W.value=!0,be()}function Ee(){W.value=!1,fe()}function de(ie){q.value=ie.touches[0].clientY}function re(ie){Math.abs(q.value-ie.changedTouches[0].clientY)>50&&(c.value=!1)}const Y=Se(()=>e.location.split(" ").reduce((ie,te)=>(ie[`v-snackbar--${te}`]=!0,ie),{}));return cn(()=>{const ie=vc.filterProps(e),te=!!(o.default||o.text||e.text);return Z(vc,fn({ref:U,class:["v-snackbar",{"v-snackbar--active":c.value,"v-snackbar--multi-line":e.multiLine&&!e.vertical,"v-snackbar--timer":!!e.timer,"v-snackbar--vertical":e.vertical},Y.value,d.value,e.class],style:[ne.value,e.style]},ie,{modelValue:c.value,"onUpdate:modelValue":ae=>c.value=ae,contentProps:fn({class:["v-snackbar__wrapper",y.value,T.value,L.value,D.value],style:[r.value],onPointerenter:ge,onPointerleave:Ee},ie.contentProps),persistent:!0,noClickAnimation:!0,scrim:!1,scrollStrategy:"none",_disableGlobalStack:!0,onTouchstartPassive:de,onTouchend:re},v),{default:()=>{var ae,pe;return[mh(!1,"v-snackbar"),e.timer&&!W.value&&Z("div",{key:"timer",class:"v-snackbar__timer"},[Z(eb,{ref:$,color:typeof e.timer=="string"?e.timer:"info",max:e.timeout,"model-value":B.time.value},null)]),te&&Z("div",{key:"content",class:"v-snackbar__content",role:"status","aria-live":"polite"},[((ae=o.text)==null?void 0:ae.call(o))??e.text,(pe=o.default)==null?void 0:pe.call(o)]),o.actions&&Z(Li,{defaults:{VBtn:{variant:"text",ripple:!1,slim:!0}}},{default:()=>[Z("div",{class:"v-snackbar__actions"},[o.actions({isActive:c})])]})]},activator:o.activator})}),yl({},U)}}),l4=At({autoDraw:Boolean,autoDrawDuration:[Number,String],autoDrawEasing:{type:String,default:"ease"},color:String,gradient:{type:Array,default:()=>[]},gradientDirection:{type:String,validator:e=>["top","bottom","left","right"].includes(e),default:"top"},height:{type:[String,Number],default:75},labels:{type:Array,default:()=>[]},labelSize:{type:[Number,String],default:7},lineWidth:{type:[String,Number],default:4},id:String,itemValue:{type:String,default:"value"},modelValue:{type:Array,default:()=>[]},min:[String,Number],max:[String,Number],padding:{type:[String,Number],default:8},showLabels:Boolean,smooth:Boolean,width:{type:[Number,String],default:300}},"Line"),c4=At({autoLineWidth:Boolean,...l4()},"VBarline"),Pk=Jt()({name:"VBarline",props:c4(),setup(e,t){let{slots:o}=t;const c=Es(),d=Se(()=>e.id||`barline-${c}`),v=Se(()=>Number(e.autoDrawDuration)||500),y=Se(()=>!!(e.showLabels||e.labels.length>0||o!=null&&o.label)),T=Se(()=>parseFloat(e.lineWidth)||4),r=Se(()=>Math.max(e.modelValue.length*T.value,Number(e.width))),D=Se(()=>({minX:0,maxX:r.value,minY:0,maxY:parseInt(e.height,10)})),L=Se(()=>e.modelValue.map(q=>as(q,e.itemValue,q)));function B(q,ne){const{minX:ce,maxX:oe,minY:fe,maxY:be}=ne,ge=q.length;let Ee=e.max!=null?Number(e.max):Math.max(...q),de=e.min!=null?Number(e.min):Math.min(...q);de>0&&e.min==null&&(de=0),Ee<0&&e.max==null&&(Ee=0);const re=oe/ge,Y=(be-fe)/(Ee-de||1),ie=be-Math.abs(de*Y);return q.map((te,ae)=>{const pe=Math.abs(Y*te);return{x:ce+ae*re,y:ie-pe+ +(te<0)*pe,height:pe,value:te}})}const U=Se(()=>{const q=[],ne=B(L.value,D.value),ce=ne.length;for(let oe=0;q.length<ce;oe++){const fe=ne[oe];let be=e.labels[oe];be||(be=typeof fe=="object"?fe.value:fe),q.push({x:fe.x,value:String(be)})}return q}),$=Se(()=>B(L.value,D.value)),W=Se(()=>(Math.abs($.value[0].x-$.value[1].x)-T.value)/2);cn(()=>{const q=e.gradient.slice().length?e.gradient.slice().reverse():[""];return Z("svg",{display:"block"},[Z("defs",null,[Z("linearGradient",{id:d.value,gradientUnits:"userSpaceOnUse",x1:e.gradientDirection==="left"?"100%":"0",y1:e.gradientDirection==="top"?"100%":"0",x2:e.gradientDirection==="right"?"100%":"0",y2:e.gradientDirection==="bottom"?"100%":"0"},[q.map((ne,ce)=>Z("stop",{offset:ce/Math.max(q.length-1,1),"stop-color":ne||"currentColor"},null))])]),Z("clipPath",{id:`${d.value}-clip`},[$.value.map(ne=>Z("rect",{x:ne.x+W.value,y:ne.y,width:T.value,height:ne.height,rx:typeof e.smooth=="number"?e.smooth:e.smooth?2:0,ry:typeof e.smooth=="number"?e.smooth:e.smooth?2:0},[e.autoDraw&&Z(Gn,null,[Z("animate",{attributeName:"y",from:ne.y+ne.height,to:ne.y,dur:`${v.value}ms`,fill:"freeze"},null),Z("animate",{attributeName:"height",from:"0",to:ne.height,dur:`${v.value}ms`,fill:"freeze"},null)])]))]),y.value&&Z("g",{key:"labels",style:{textAnchor:"middle",dominantBaseline:"mathematical",fill:"currentColor"}},[U.value.map((ne,ce)=>{var oe;return Z("text",{x:ne.x+W.value+T.value/2,y:parseInt(e.height,10)-2+(parseInt(e.labelSize,10)||7*.75),"font-size":Number(e.labelSize)||7},[((oe=o.label)==null?void 0:oe.call(o,{index:ce,value:ne.value}))??ne.value])})]),Z("g",{"clip-path":`url(#${d.value}-clip)`,fill:`url(#${d.value})`},[Z("rect",{x:0,y:0,width:Math.max(e.modelValue.length*T.value,Number(e.width)),height:e.height},null)])])})}});function ZJ(e,t){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,c=arguments.length>3&&arguments[3]!==void 0?arguments[3]:75;if(e.length===0)return"";const d=e.shift(),v=e[e.length-1];return(o?`M${d.x} ${c-d.x+2} L${d.x} ${d.y}`:`M${d.x} ${d.y}`)+e.map((y,T)=>{const r=e[T+1],D=e[T-1]||d,L=r&&XJ(r,y,D);if(!r||L)return`L${y.x} ${y.y}`;const B=Math.min(Mk(D,y),Mk(r,y)),$=B/2<t?B/2:t,W=kk(D,y,$),q=kk(r,y,$);return`L${W.x} ${W.y}S${y.x} ${y.y} ${q.x} ${q.y}`}).join("")+(o?`L${v.x} ${c-d.x+2} Z`:"")}function Dy(e){return parseInt(e,10)}function XJ(e,t,o){return Dy(e.x+o.x)===Dy(2*t.x)&&Dy(e.y+o.y)===Dy(2*t.y)}function Mk(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function kk(e,t,o){const c={x:e.x-t.x,y:e.y-t.y},d=Math.sqrt(c.x*c.x+c.y*c.y),v={x:c.x/d,y:c.y/d};return{x:t.x+v.x*o,y:t.y+v.y*o}}const u4=At({fill:Boolean,...l4()},"VTrendline"),Rk=Jt()({name:"VTrendline",props:u4(),setup(e,t){let{slots:o}=t;const c=Es(),d=Se(()=>e.id||`trendline-${c}`),v=Se(()=>Number(e.autoDrawDuration)||(e.fill?500:2e3)),y=rn(0),T=rn(null);function r(ne,ce){const{minX:oe,maxX:fe,minY:be,maxY:ge}=ce,Ee=ne.length,de=e.max!=null?Number(e.max):Math.max(...ne),re=e.min!=null?Number(e.min):Math.min(...ne),Y=(fe-oe)/(Ee-1),ie=(ge-be)/(de-re||1);return ne.map((te,ae)=>({x:oe+ae*Y,y:ge-(te-re)*ie,value:te}))}const D=Se(()=>!!(e.showLabels||e.labels.length>0||o!=null&&o.label)),L=Se(()=>parseFloat(e.lineWidth)||4),B=Se(()=>Number(e.width)),U=Se(()=>{const ne=Number(e.padding);return{minX:ne,maxX:B.value-ne,minY:ne,maxY:parseInt(e.height,10)-ne}}),$=Se(()=>e.modelValue.map(ne=>as(ne,e.itemValue,ne))),W=Se(()=>{const ne=[],ce=r($.value,U.value),oe=ce.length;for(let fe=0;ne.length<oe;fe++){const be=ce[fe];let ge=e.labels[fe];ge||(ge=typeof be=="object"?be.value:be),ne.push({x:be.x,value:String(ge)})}return ne});On(()=>e.modelValue,async()=>{if(await Ki(),!e.autoDraw||!T.value)return;const ne=T.value,ce=ne.getTotalLength();e.fill?(ne.style.transformOrigin="bottom center",ne.style.transition="none",ne.style.transform="scaleY(0)",ne.getBoundingClientRect(),ne.style.transition=`transform ${v.value}ms ${e.autoDrawEasing}`,ne.style.transform="scaleY(1)"):(ne.style.strokeDasharray=`${ce}`,ne.style.strokeDashoffset=`${ce}`,ne.getBoundingClientRect(),ne.style.transition=`stroke-dashoffset ${v.value}ms ${e.autoDrawEasing}`,ne.style.strokeDashoffset="0"),y.value=ce},{immediate:!0});function q(ne){return ZJ(r($.value,U.value),e.smooth?8:Number(e.smooth),ne,parseInt(e.height,10))}cn(()=>{var ce;const ne=e.gradient.slice().length?e.gradient.slice().reverse():[""];return Z("svg",{display:"block","stroke-width":parseFloat(e.lineWidth)??4},[Z("defs",null,[Z("linearGradient",{id:d.value,gradientUnits:"userSpaceOnUse",x1:e.gradientDirection==="left"?"100%":"0",y1:e.gradientDirection==="top"?"100%":"0",x2:e.gradientDirection==="right"?"100%":"0",y2:e.gradientDirection==="bottom"?"100%":"0"},[ne.map((oe,fe)=>Z("stop",{offset:fe/Math.max(ne.length-1,1),"stop-color":oe||"currentColor"},null))])]),D.value&&Z("g",{key:"labels",style:{textAnchor:"middle",dominantBaseline:"mathematical",fill:"currentColor"}},[W.value.map((oe,fe)=>{var be;return Z("text",{x:oe.x+L.value/2+L.value/2,y:parseInt(e.height,10)-4+(parseInt(e.labelSize,10)||7*.75),"font-size":Number(e.labelSize)||7},[((be=o.label)==null?void 0:be.call(o,{index:fe,value:oe.value}))??oe.value])})]),Z("path",{ref:T,d:q(e.fill),fill:e.fill?`url(#${d.value})`:"none",stroke:e.fill?"none":`url(#${d.value})`},null),e.fill&&Z("path",{d:q(!1),fill:"none",stroke:e.color??((ce=e.gradient)==null?void 0:ce[0])},null)])})}}),YJ=At({type:{type:String,default:"trend"},...c4(),...u4()},"VSparkline"),KJ=Jt()({name:"VSparkline",props:YJ(),setup(e,t){let{slots:o}=t;const{textColorClasses:c,textColorStyles:d}=Fs(Ht(e,"color")),v=Se(()=>!!(e.showLabels||e.labels.length>0||o!=null&&o.label)),y=Se(()=>{let T=parseInt(e.height,10);return v.value&&(T+=parseInt(e.labelSize,10)*1.5),T});cn(()=>{const T=e.type==="trend"?Rk:Pk,r=e.type==="trend"?Rk.filterProps(e):Pk.filterProps(e);return Z(T,fn({key:e.type,class:c.value,style:d.value,viewBox:`0 0 ${e.width} ${parseInt(y.value,10)}`},r),o)})}}),JJ=At({...Nn(),...Jz({offset:8,minWidth:0,openDelay:0,closeDelay:100,location:"top center",transition:"scale-transition"})},"VSpeedDial"),QJ=Jt()({name:"VSpeedDial",props:JJ(),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:o}=t;const c=ei(e,"modelValue"),d=rn(),v=Se(()=>{const[T,r="center"]=e.location.split(" ");return`${T} ${r}`}),y=Se(()=>({[`v-speed-dial__content--${v.value.replace(" ","-")}`]:!0}));return cn(()=>{const T=Lp.filterProps(e);return Z(Lp,fn(T,{modelValue:c.value,"onUpdate:modelValue":r=>c.value=r,class:e.class,style:e.style,contentClass:["v-speed-dial__content",y.value],location:v.value,ref:d,transition:"fade-transition"}),{...o,default:r=>Z(Li,{defaults:{VBtn:{size:"small"}}},{default:()=>[Z(Xs,{appear:!0,group:!0,transition:e.transition},{default:()=>{var D;return[(D=o.default)==null?void 0:D.call(o,r)]}})]})})}),{}}}),sE=Symbol.for("vuetify:v-stepper"),h4=At({color:String,disabled:{type:[Boolean,String],default:!1},prevText:{type:String,default:"$vuetify.stepper.prev"},nextText:{type:String,default:"$vuetify.stepper.next"}},"VStepperActions"),d4=Jt()({name:"VStepperActions",props:h4(),emits:{"click:prev":()=>!0,"click:next":()=>!0},setup(e,t){let{emit:o,slots:c}=t;const{t:d}=zo();function v(){o("click:prev")}function y(){o("click:next")}return cn(()=>{const T={onClick:v},r={onClick:y};return Z("div",{class:"v-stepper-actions"},[Z(Li,{defaults:{VBtn:{disabled:["prev",!0].includes(e.disabled),text:d(e.prevText),variant:"text"}}},{default:()=>{var D;return[((D=c.prev)==null?void 0:D.call(c,{props:T}))??Z(yr,T,null)]}}),Z(Li,{defaults:{VBtn:{color:e.color,disabled:["next",!0].includes(e.disabled),text:d(e.nextText),variant:"tonal"}}},{default:()=>{var D;return[((D=c.next)==null?void 0:D.call(c,{props:r}))??Z(yr,r,null)]}})])}),{}}}),f4=Tc("v-stepper-header"),eQ=At({color:String,title:String,subtitle:String,complete:Boolean,completeIcon:{type:String,default:"$complete"},editable:Boolean,editIcon:{type:String,default:"$edit"},error:Boolean,errorIcon:{type:String,default:"$error"},icon:String,ripple:{type:[Boolean,Object],default:!0},rules:{type:Array,default:()=>[]}},"StepperItem"),tQ=At({...eQ(),...Fd()},"VStepperItem"),p4=Jt()({name:"VStepperItem",directives:{Ripple:ru},props:tQ(),emits:{"group:selected":e=>!0},setup(e,t){let{slots:o}=t;const c=Vd(e,sE,!0),d=Se(()=>(c==null?void 0:c.value.value)??e.value),v=Se(()=>e.rules.every(U=>U()===!0)),y=Se(()=>!e.disabled&&e.editable),T=Se(()=>!e.disabled&&e.editable),r=Se(()=>e.error||!v.value),D=Se(()=>e.complete||e.rules.length>0&&v.value),L=Se(()=>r.value?e.errorIcon:D.value?e.completeIcon:c.isSelected.value&&e.editable?e.editIcon:e.icon),B=Se(()=>({canEdit:T.value,hasError:r.value,hasCompleted:D.value,title:e.title,subtitle:e.subtitle,step:d.value,value:e.value}));return cn(()=>{var ne,ce,oe;const U=(!c||c.isSelected.value||D.value||T.value)&&!r.value&&!e.disabled,$=!!(e.title!=null||o.title),W=!!(e.subtitle!=null||o.subtitle);function q(){c==null||c.toggle()}return lr(Z("button",{class:["v-stepper-item",{"v-stepper-item--complete":D.value,"v-stepper-item--disabled":e.disabled,"v-stepper-item--error":r.value},c==null?void 0:c.selectedClass.value],disabled:!e.editable,onClick:q},[y.value&&mh(!0,"v-stepper-item"),Z(ml,{key:"stepper-avatar",class:"v-stepper-item__avatar",color:U?e.color:void 0,size:24},{default:()=>{var fe;return[((fe=o.icon)==null?void 0:fe.call(o,B.value))??(L.value?Z(br,{icon:L.value},null):d.value)]}}),Z("div",{class:"v-stepper-item__content"},[$&&Z("div",{key:"title",class:"v-stepper-item__title"},[((ne=o.title)==null?void 0:ne.call(o,B.value))??e.title]),W&&Z("div",{key:"subtitle",class:"v-stepper-item__subtitle"},[((ce=o.subtitle)==null?void 0:ce.call(o,B.value))??e.subtitle]),(oe=o.default)==null?void 0:oe.call(o,B.value)])]),[[Ya("ripple"),e.ripple&&e.editable,null]])}),{}}}),nQ=At({...Yo(cb(),["continuous","nextIcon","prevIcon","showArrows","touch","mandatory"])},"VStepperWindow"),m4=Jt()({name:"VStepperWindow",props:nQ(),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:o}=t;const c=Mi(sE,null),d=ei(e,"modelValue"),v=Se({get(){var y;return d.value!=null||!c?d.value:(y=c.items.value.find(T=>c.selected.value.includes(T.id)))==null?void 0:y.value},set(y){d.value=y}});return cn(()=>{const y=wd.filterProps(e);return Z(wd,fn({_as:"VStepperWindow"},y,{modelValue:v.value,"onUpdate:modelValue":T=>v.value=T,class:["v-stepper-window",e.class],style:e.style,mandatory:!1,touch:!1}),o)}),{}}}),iQ=At({...ub()},"VStepperWindowItem"),g4=Jt()({name:"VStepperWindowItem",props:iQ(),setup(e,t){let{slots:o}=t;return cn(()=>{const c=Sd.filterProps(e);return Z(Sd,fn({_as:"VStepperWindowItem"},c,{class:["v-stepper-window-item",e.class],style:e.style}),o)}),{}}}),rQ=At({altLabels:Boolean,bgColor:String,completeIcon:String,editIcon:String,editable:Boolean,errorIcon:String,hideActions:Boolean,items:{type:Array,default:()=>[]},itemTitle:{type:String,default:"title"},itemValue:{type:String,default:"value"},nonLinear:Boolean,flat:Boolean,...Rd()},"Stepper"),oQ=At({...rQ(),...Bd({mandatory:"force",selectedClass:"v-stepper-item--selected"}),...hb(),...G0(h4(),["prevText","nextText"])},"VStepper"),sQ=Jt()({name:"VStepper",props:oQ(),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:o}=t;const{items:c,next:d,prev:v,selected:y}=gh(e,sE),{displayClasses:T,mobile:r}=_l(e),{completeIcon:D,editIcon:L,errorIcon:B,color:U,editable:$,prevText:W,nextText:q}=Pd(e),ne=Se(()=>e.items.map((fe,be)=>{const ge=as(fe,e.itemTitle,fe),Ee=as(fe,e.itemValue,be+1);return{title:ge,value:Ee,raw:fe}})),ce=Se(()=>c.value.findIndex(fe=>y.value.includes(fe.id))),oe=Se(()=>e.disabled?e.disabled:ce.value===0?"prev":ce.value===c.value.length-1?"next":!1);return wo({VStepperItem:{editable:$,errorIcon:B,completeIcon:D,editIcon:L,prevText:W,nextText:q},VStepperActions:{color:U,disabled:oe,prevText:W,nextText:q}}),cn(()=>{const fe=Td.filterProps(e),be=!!(o.header||e.items.length),ge=e.items.length>0,Ee=!e.hideActions&&!!(ge||o.actions);return Z(Td,fn(fe,{color:e.bgColor,class:["v-stepper",{"v-stepper--alt-labels":e.altLabels,"v-stepper--flat":e.flat,"v-stepper--non-linear":e.nonLinear,"v-stepper--mobile":r.value},T.value,e.class],style:e.style}),{default:()=>{var de,re;return[be&&Z(f4,{key:"stepper-header"},{default:()=>[ne.value.map((Y,ie)=>{let{raw:te,...ae}=Y;return Z(Gn,null,[!!ie&&Z(k_,null,null),Z(p4,ae,{default:o[`header-item.${ae.value}`]??o.header,icon:o.icon,title:o.title,subtitle:o.subtitle})])})]}),ge&&Z(m4,{key:"stepper-window"},{default:()=>[ne.value.map(Y=>Z(g4,{value:Y.value},{default:()=>{var ie,te;return((ie=o[`item.${Y.value}`])==null?void 0:ie.call(o,Y))??((te=o.item)==null?void 0:te.call(o,Y))}}))]}),(de=o.default)==null?void 0:de.call(o,{prev:v,next:d}),Ee&&(((re=o.actions)==null?void 0:re.call(o,{next:d,prev:v}))??Z(d4,{key:"stepper-actions","onClick:prev":v,"onClick:next":d},o))]}})}),{prev:v,next:d}}}),aQ=At({indeterminate:Boolean,inset:Boolean,flat:Boolean,loading:{type:[Boolean,String],default:!1},...su(),...ib()},"VSwitch"),lQ=Jt()({name:"VSwitch",inheritAttrs:!1,props:aQ(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:indeterminate":e=>!0},setup(e,t){let{attrs:o,slots:c}=t;const d=ei(e,"indeterminate"),v=ei(e,"modelValue"),{loaderClasses:y}=I_(e),{isFocused:T,focus:r,blur:D}=ou(e),L=rn(),B=Ar&&window.matchMedia("(forced-colors: active)").matches,U=Se(()=>typeof e.loading=="string"&&e.loading!==""?e.loading:e.color),$=Es(),W=Se(()=>e.id||`switch-${$}`);function q(){d.value&&(d.value=!1)}function ne(ce){var oe,fe;ce.stopPropagation(),ce.preventDefault(),(fe=(oe=L.value)==null?void 0:oe.input)==null||fe.click()}return cn(()=>{const[ce,oe]=ph(o),fe=Vs.filterProps(e),be=lh.filterProps(e);return Z(Vs,fn({class:["v-switch",{"v-switch--flat":e.flat},{"v-switch--inset":e.inset},{"v-switch--indeterminate":d.value},y.value,e.class]},ce,fe,{modelValue:v.value,"onUpdate:modelValue":ge=>v.value=ge,id:W.value,focused:T.value,style:e.style}),{...c,default:ge=>{let{id:Ee,messagesId:de,isDisabled:re,isReadonly:Y,isValid:ie}=ge;const te={model:v,isValid:ie};return Z(lh,fn({ref:L},be,{modelValue:v.value,"onUpdate:modelValue":[ae=>v.value=ae,q],id:Ee.value,"aria-describedby":de.value,type:"checkbox","aria-checked":d.value?"mixed":void 0,disabled:re.value,readonly:Y.value,onFocus:r,onBlur:D},oe),{...c,default:ae=>{let{backgroundColorClasses:pe,backgroundColorStyles:Le}=ae;return Z("div",{class:["v-switch__track",B?void 0:pe.value],style:Le.value,onClick:ne},[c["track-true"]&&Z("div",{key:"prepend",class:"v-switch__track-true"},[c["track-true"](te)]),c["track-false"]&&Z("div",{key:"append",class:"v-switch__track-false"},[c["track-false"](te)])])},input:ae=>{let{inputNode:pe,icon:Le,backgroundColorClasses:tt,backgroundColorStyles:Je}=ae;return Z(Gn,null,[pe,Z("div",{class:["v-switch__thumb",{"v-switch__thumb--filled":Le||e.loading},e.inset||B?void 0:tt.value],style:e.inset?void 0:Je.value},[c.thumb?Z(Li,{defaults:{VIcon:{icon:Le,size:"x-small"}}},{default:()=>[c.thumb({...te,icon:Le})]}):Z(IT,null,{default:()=>[e.loading?Z(C_,{name:"v-switch",active:!0,color:ie.value===!1?void 0:U.value},{default:Mt=>c.loader?c.loader(Mt):Z(Op,{active:Mt.isActive,color:Mt.color,indeterminate:!0,size:"16",width:"2"},null)}):Le&&Z(br,{key:String(Le),icon:Le,size:"x-small"},null)]})])])}})}})}),{}}}),cQ=At({color:String,height:[Number,String],window:Boolean,...Nn(),...ls(),...Dd(),...co(),...Si(),...Ji()},"VSystemBar"),uQ=Jt()({name:"VSystemBar",props:cQ(),setup(e,t){let{slots:o}=t;const{themeClasses:c}=xr(e),{backgroundColorClasses:d,backgroundColorStyles:v}=Nr(Ht(e,"color")),{elevationClasses:y}=Is(e),{roundedClasses:T}=So(e),{ssrBootStyles:r}=Ld(),D=Se(()=>e.height??(e.window?32:24)),{layoutItemStyles:L}=Od({id:e.name,order:Se(()=>parseInt(e.order,10)),position:kn("top"),layoutSize:D,elementSize:D,active:Se(()=>!0),absolute:Ht(e,"absolute")});return cn(()=>Z(e.tag,{class:["v-system-bar",{"v-system-bar--window":e.window},c.value,d.value,y.value,T.value,e.class],style:[v.value,L.value,r.value,e.style]},o)),{}}}),aE=Symbol.for("vuetify:v-tabs"),hQ=At({fixed:Boolean,sliderColor:String,hideSlider:Boolean,direction:{type:String,default:"horizontal"},...Yo(nb({selectedClass:"v-tab--selected",variant:"text"}),["active","block","flat","location","position","symbol"])},"VTab"),_4=Jt()({name:"VTab",props:hQ(),setup(e,t){let{slots:o,attrs:c}=t;const{textColorClasses:d,textColorStyles:v}=Fs(e,"sliderColor"),y=rn(),T=rn(),r=Se(()=>e.direction==="horizontal"),D=Se(()=>{var B,U;return((U=(B=y.value)==null?void 0:B.group)==null?void 0:U.isSelected.value)??!1});function L(B){var $,W;let{value:U}=B;if(U){const q=(W=($=y.value)==null?void 0:$.$el.parentElement)==null?void 0:W.querySelector(".v-tab--selected .v-tab__slider"),ne=T.value;if(!q||!ne)return;const ce=getComputedStyle(q).color,oe=q.getBoundingClientRect(),fe=ne.getBoundingClientRect(),be=r.value?"x":"y",ge=r.value?"X":"Y",Ee=r.value?"right":"bottom",de=r.value?"width":"height",re=oe[be],Y=fe[be],ie=re>Y?oe[Ee]-fe[Ee]:oe[be]-fe[be],te=Math.sign(ie)>0?r.value?"right":"bottom":Math.sign(ie)<0?r.value?"left":"top":"center",pe=(Math.abs(ie)+(Math.sign(ie)<0?oe[de]:fe[de]))/Math.max(oe[de],fe[de])||0,Le=oe[de]/fe[de]||0,tt=1.5;ud(ne,{backgroundColor:[ce,"currentcolor"],transform:[`translate${ge}(${ie}px) scale${ge}(${Le})`,`translate${ge}(${ie/tt}px) scale${ge}(${(pe-1)/tt+1})`,"none"],transformOrigin:Array(3).fill(te)},{duration:225,easing:t_})}}return cn(()=>{const B=yr.filterProps(e);return Z(yr,fn({symbol:aE,ref:y,class:["v-tab",e.class],style:e.style,tabindex:D.value?0:-1,role:"tab","aria-selected":String(D.value),active:!1},B,c,{block:e.fixed,maxWidth:e.fixed?300:void 0,"onGroup:selected":L}),{...o,default:()=>{var U;return Z(Gn,null,[((U=o.default)==null?void 0:U.call(o))??e.text,!e.hideSlider&&Z("div",{ref:T,class:["v-tab__slider",d.value],style:v.value},null)])}})}),yl({},y)}}),dQ=At({...Yo(cb(),["continuous","nextIcon","prevIcon","showArrows","touch","mandatory"])},"VTabsWindow"),v4=Jt()({name:"VTabsWindow",props:dQ(),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:o}=t;const c=Mi(aE,null),d=ei(e,"modelValue"),v=Se({get(){var y;return d.value!=null||!c?d.value:(y=c.items.value.find(T=>c.selected.value.includes(T.id)))==null?void 0:y.value},set(y){d.value=y}});return cn(()=>{const y=wd.filterProps(e);return Z(wd,fn({_as:"VTabsWindow"},y,{modelValue:v.value,"onUpdate:modelValue":T=>v.value=T,class:["v-tabs-window",e.class],style:e.style,mandatory:!1,touch:!1}),o)}),{}}}),fQ=At({...ub()},"VTabsWindowItem"),y4=Jt()({name:"VTabsWindowItem",props:fQ(),setup(e,t){let{slots:o}=t;return cn(()=>{const c=Sd.filterProps(e);return Z(Sd,fn({_as:"VTabsWindowItem"},c,{class:["v-tabs-window-item",e.class],style:e.style}),o)}),{}}});function pQ(e){return e?e.map(t=>Qg(t)?t:{text:t,value:t}):[]}const mQ=At({alignTabs:{type:String,default:"start"},color:String,fixedTabs:Boolean,items:{type:Array,default:()=>[]},stacked:Boolean,bgColor:String,grow:Boolean,height:{type:[Number,String],default:void 0},hideSlider:Boolean,sliderColor:String,...RT({mandatory:"force",selectedClass:"v-tab-item--selected"}),..._s(),...Si()},"VTabs"),gQ=Jt()({name:"VTabs",props:mQ(),emits:{"update:modelValue":e=>!0},setup(e,t){let{attrs:o,slots:c}=t;const d=ei(e,"modelValue"),v=Se(()=>pQ(e.items)),{densityClasses:y}=Js(e),{backgroundColorClasses:T,backgroundColorStyles:r}=Nr(Ht(e,"bgColor")),{scopeId:D}=Ud();return wo({VTab:{color:Ht(e,"color"),direction:Ht(e,"direction"),stacked:Ht(e,"stacked"),fixed:Ht(e,"fixedTabs"),sliderColor:Ht(e,"sliderColor"),hideSlider:Ht(e,"hideSlider")}}),cn(()=>{const L=l_.filterProps(e),B=!!(c.window||e.items.length>0);return Z(Gn,null,[Z(l_,fn(L,{modelValue:d.value,"onUpdate:modelValue":U=>d.value=U,class:["v-tabs",`v-tabs--${e.direction}`,`v-tabs--align-tabs-${e.alignTabs}`,{"v-tabs--fixed-tabs":e.fixedTabs,"v-tabs--grow":e.grow,"v-tabs--stacked":e.stacked},y.value,T.value,e.class],style:[{"--v-tabs-height":Bn(e.height)},r.value,e.style],role:"tablist",symbol:aE},D,o),{default:()=>{var U;return[((U=c.default)==null?void 0:U.call(c))??v.value.map($=>{var W;return((W=c.tab)==null?void 0:W.call(c,{item:$}))??Z(_4,fn($,{key:$.text,value:$.value}),{default:c[`tab.${$.value}`]?()=>{var q;return(q=c[`tab.${$.value}`])==null?void 0:q.call(c,{item:$})}:void 0})})]}}),B&&Z(v4,fn({modelValue:d.value,"onUpdate:modelValue":U=>d.value=U,key:"tabs-window"},D),{default:()=>{var U;return[v.value.map($=>{var W;return((W=c.item)==null?void 0:W.call(c,{item:$}))??Z(y4,{value:$.value},{default:()=>{var q;return(q=c[`item.${$.value}`])==null?void 0:q.call(c,{item:$})}})}),(U=c.window)==null?void 0:U.call(c)]}})])}),{}}}),_Q=At({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...su(),...D_()},"VTextarea"),vQ=Jt()({name:"VTextarea",directives:{Intersect:E_},inheritAttrs:!1,props:_Q(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,t){let{attrs:o,emit:c,slots:d}=t;const v=ei(e,"modelValue"),{isFocused:y,focus:T,blur:r}=ou(e),D=Se(()=>typeof e.counterValue=="function"?e.counterValue(v.value):(v.value||"").toString().length),L=Se(()=>{if(o.maxlength)return o.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function B(te,ae){var pe,Le;!e.autofocus||!te||(Le=(pe=ae[0].target)==null?void 0:pe.focus)==null||Le.call(pe)}const U=rn(),$=rn(),W=kn(""),q=rn(),ne=Se(()=>e.persistentPlaceholder||y.value||e.active);function ce(){var te;q.value!==document.activeElement&&((te=q.value)==null||te.focus()),y.value||T()}function oe(te){ce(),c("click:control",te)}function fe(te){c("mousedown:control",te)}function be(te){te.stopPropagation(),ce(),Ki(()=>{v.value="",mT(e["onClick:clear"],te)})}function ge(te){var pe;const ae=te.target;if(v.value=ae.value,(pe=e.modelModifiers)!=null&&pe.trim){const Le=[ae.selectionStart,ae.selectionEnd];Ki(()=>{ae.selectionStart=Le[0],ae.selectionEnd=Le[1]})}}const Ee=rn(),de=rn(+e.rows),re=Se(()=>["plain","underlined"].includes(e.variant));Oo(()=>{e.autoGrow||(de.value=+e.rows)});function Y(){e.autoGrow&&Ki(()=>{if(!Ee.value||!$.value)return;const te=getComputedStyle(Ee.value),ae=getComputedStyle($.value.$el),pe=parseFloat(te.getPropertyValue("--v-field-padding-top"))+parseFloat(te.getPropertyValue("--v-input-padding-top"))+parseFloat(te.getPropertyValue("--v-field-padding-bottom")),Le=Ee.value.scrollHeight,tt=parseFloat(te.lineHeight),Je=Math.max(parseFloat(e.rows)*tt+pe,parseFloat(ae.getPropertyValue("--v-input-control-height"))),Mt=parseFloat(e.maxRows)*tt+pe||1/0,Lt=Go(Le??0,Je,Mt);de.value=Math.floor((Lt-pe)/tt),W.value=Bn(Lt)})}ms(Y),On(v,Y),On(()=>e.rows,Y),On(()=>e.maxRows,Y),On(()=>e.density,Y);let ie;return On(Ee,te=>{te?(ie=new ResizeObserver(Y),ie.observe(Ee.value)):ie==null||ie.disconnect()}),Ts(()=>{ie==null||ie.disconnect()}),cn(()=>{const te=!!(d.counter||e.counter||e.counterValue),ae=!!(te||d.details),[pe,Le]=ph(o),{modelValue:tt,...Je}=Vs.filterProps(e),Mt=NT(e);return Z(Vs,fn({ref:U,modelValue:v.value,"onUpdate:modelValue":Lt=>v.value=Lt,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":re.value},e.class],style:e.style},pe,Je,{centerAffix:de.value===1&&!re.value,focused:y.value}),{...d,default:Lt=>{let{id:yt,isDisabled:rt,isDirty:mt,isReadonly:Ft,isValid:bn}=Lt;return Z(qp,fn({ref:$,style:{"--v-textarea-control-height":W.value},onClick:oe,onMousedown:fe,"onClick:clear":be,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},Mt,{id:yt.value,active:ne.value||mt.value,centerAffix:de.value===1&&!re.value,dirty:mt.value||e.dirty,disabled:rt.value,focused:y.value,error:bn.value===!1}),{...d,default:Bt=>{let{props:{class:ht,...gt}}=Bt;return Z(Gn,null,[e.prefix&&Z("span",{class:"v-text-field__prefix"},[e.prefix]),lr(Z("textarea",fn({ref:q,class:ht,value:v.value,onInput:ge,autofocus:e.autofocus,readonly:Ft.value,disabled:rt.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:ce,onBlur:r},gt,Le),null),[[Ya("intersect"),{handler:B},null,{once:!0}]]),e.autoGrow&&lr(Z("textarea",{class:[ht,"v-textarea__sizer"],id:`${gt.id}-sizer`,"onUpdate:modelValue":et=>v.value=et,ref:Ee,readonly:!0,"aria-hidden":"true"},null),[[pl,v.value]]),e.suffix&&Z("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:ae?Lt=>{var yt;return Z(Gn,null,[(yt=d.details)==null?void 0:yt.call(d,Lt),te&&Z(Gn,null,[Z("span",null,null),Z(sb,{active:e.persistentCounter||y.value,value:D.value,max:L.value,disabled:e.disabled},d.counter)])])}:void 0})}),yl({},U,$,q)}}),yQ=At({withBackground:Boolean,...Nn(),...Ji(),...Si()},"VThemeProvider"),bQ=Jt()({name:"VThemeProvider",props:yQ(),setup(e,t){let{slots:o}=t;const{themeClasses:c}=xr(e);return()=>{var d;return e.withBackground?Z(e.tag,{class:["v-theme-provider",c.value,e.class],style:e.style},{default:()=>{var v;return[(v=o.default)==null?void 0:v.call(o)]}}):(d=o.default)==null?void 0:d.call(o)}}}),xQ=At({dotColor:String,fillDot:Boolean,hideDot:Boolean,icon:mi,iconColor:String,lineColor:String,...Nn(),...co(),...Ec(),...ls()},"VTimelineDivider"),wQ=Jt()({name:"VTimelineDivider",props:xQ(),setup(e,t){let{slots:o}=t;const{sizeClasses:c,sizeStyles:d}=Up(e,"v-timeline-divider__dot"),{backgroundColorStyles:v,backgroundColorClasses:y}=Nr(Ht(e,"dotColor")),{roundedClasses:T}=So(e,"v-timeline-divider__dot"),{elevationClasses:r}=Is(e),{backgroundColorClasses:D,backgroundColorStyles:L}=Nr(Ht(e,"lineColor"));return cn(()=>Z("div",{class:["v-timeline-divider",{"v-timeline-divider--fill-dot":e.fillDot},e.class],style:e.style},[Z("div",{class:["v-timeline-divider__before",D.value],style:L.value},null),!e.hideDot&&Z("div",{key:"dot",class:["v-timeline-divider__dot",r.value,T.value,c.value],style:d.value},[Z("div",{class:["v-timeline-divider__inner-dot",y.value,T.value],style:v.value},[o.default?Z(Li,{key:"icon-defaults",disabled:!e.icon,defaults:{VIcon:{color:e.iconColor,icon:e.icon,size:e.size}}},o.default):Z(br,{key:"icon",color:e.iconColor,icon:e.icon,size:e.size},null)])]),Z("div",{class:["v-timeline-divider__after",D.value],style:L.value},null)])),{}}}),b4=At({density:String,dotColor:String,fillDot:Boolean,hideDot:Boolean,hideOpposite:{type:Boolean,default:void 0},icon:mi,iconColor:String,lineInset:[Number,String],...Nn(),...Ko(),...ls(),...co(),...Ec(),...Si()},"VTimelineItem"),SQ=Jt()({name:"VTimelineItem",props:b4(),setup(e,t){let{slots:o}=t;const{dimensionStyles:c}=Jo(e),d=kn(0),v=rn();return On(v,y=>{var T;y&&(d.value=((T=y.$el.querySelector(".v-timeline-divider__dot"))==null?void 0:T.getBoundingClientRect().width)??0)},{flush:"post"}),cn(()=>{var y,T;return Z("div",{class:["v-timeline-item",{"v-timeline-item--fill-dot":e.fillDot},e.class],style:[{"--v-timeline-dot-size":Bn(d.value),"--v-timeline-line-inset":e.lineInset?`calc(var(--v-timeline-dot-size) / 2 + ${Bn(e.lineInset)})`:Bn(0)},e.style]},[Z("div",{class:"v-timeline-item__body",style:c.value},[(y=o.default)==null?void 0:y.call(o)]),Z(wQ,{ref:v,hideDot:e.hideDot,icon:e.icon,iconColor:e.iconColor,size:e.size,elevation:e.elevation,dotColor:e.dotColor,fillDot:e.fillDot,rounded:e.rounded},{default:o.icon}),e.density!=="compact"&&Z("div",{class:"v-timeline-item__opposite"},[!e.hideOpposite&&((T=o.opposite)==null?void 0:T.call(o))])])}),{}}}),TQ=At({align:{type:String,default:"center",validator:e=>["center","start"].includes(e)},direction:{type:String,default:"vertical",validator:e=>["vertical","horizontal"].includes(e)},justify:{type:String,default:"auto",validator:e=>["auto","center"].includes(e)},side:{type:String,validator:e=>e==null||["start","end"].includes(e)},lineThickness:{type:[String,Number],default:2},lineColor:String,truncateLine:{type:String,validator:e=>["start","end","both"].includes(e)},...G0(b4({lineInset:0}),["dotColor","fillDot","hideOpposite","iconColor","lineInset","size"]),...Nn(),..._s(),...Si(),...Ji()},"VTimeline"),EQ=Jt()({name:"VTimeline",props:TQ(),setup(e,t){let{slots:o}=t;const{themeClasses:c}=xr(e),{densityClasses:d}=Js(e),{rtlClasses:v}=gs();wo({VTimelineDivider:{lineColor:Ht(e,"lineColor")},VTimelineItem:{density:Ht(e,"density"),dotColor:Ht(e,"dotColor"),fillDot:Ht(e,"fillDot"),hideOpposite:Ht(e,"hideOpposite"),iconColor:Ht(e,"iconColor"),lineColor:Ht(e,"lineColor"),lineInset:Ht(e,"lineInset"),size:Ht(e,"size")}});const y=Se(()=>{const r=e.side?e.side:e.density!=="default"?"end":null;return r&&`v-timeline--side-${r}`}),T=Se(()=>{const r=["v-timeline--truncate-line-start","v-timeline--truncate-line-end"];switch(e.truncateLine){case"both":return r;case"start":return r[0];case"end":return r[1];default:return null}});return cn(()=>Z(e.tag,{class:["v-timeline",`v-timeline--${e.direction}`,`v-timeline--align-${e.align}`,`v-timeline--justify-${e.justify}`,T.value,{"v-timeline--inset-line":!!e.lineInset},c.value,d.value,y.value,v.value,e.class],style:[{"--v-timeline-line-thickness":Bn(e.lineThickness)},e.style]},o)),{}}}),IQ=At({...Nn(),...vl({variant:"text"})},"VToolbarItems"),CQ=Jt()({name:"VToolbarItems",props:IQ(),setup(e,t){let{slots:o}=t;return wo({VBtn:{color:Ht(e,"color"),height:"inherit",variant:Ht(e,"variant")}}),cn(()=>{var c;return Z("div",{class:["v-toolbar-items",e.class],style:e.style},[(c=o.default)==null?void 0:c.call(o)])}),{}}}),AQ=At({id:String,text:String,...Yo(R_({closeOnBack:!1,location:"end",locationStrategy:"connected",eager:!0,minWidth:0,offset:10,openOnClick:!1,openOnHover:!0,origin:"auto",scrim:!1,scrollStrategy:"reposition",transition:!1}),["absolute","persistent"])},"VTooltip"),x4=Jt()({name:"VTooltip",props:AQ(),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:o}=t;const c=ei(e,"modelValue"),{scopeId:d}=Ud(),v=Es(),y=Se(()=>e.id||`v-tooltip-${v}`),T=rn(),r=Se(()=>e.location.split(" ").length>1?e.location:e.location+" center"),D=Se(()=>e.origin==="auto"||e.origin==="overlap"||e.origin.split(" ").length>1||e.location.split(" ").length>1?e.origin:e.origin+" center"),L=Se(()=>e.transition?e.transition:c.value?"scale-transition":"fade-transition"),B=Se(()=>fn({"aria-describedby":y.value},e.activatorProps));return cn(()=>{const U=vc.filterProps(e);return Z(vc,fn({ref:T,class:["v-tooltip",e.class],style:e.style,id:y.value},U,{modelValue:c.value,"onUpdate:modelValue":$=>c.value=$,transition:L.value,absolute:!0,location:r.value,origin:D.value,persistent:!0,role:"tooltip",activatorProps:B.value,_disableGlobalStack:!0},d),{activator:o.activator,default:function(){var ne;for(var $=arguments.length,W=new Array($),q=0;q<$;q++)W[q]=arguments[q];return((ne=o.default)==null?void 0:ne.call(o,...W))??e.text}})}),yl({},T)}}),PQ=Jt()({name:"VValidation",props:Ez(),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:o}=t;const c=Iz(e,"validation");return()=>{var d;return(d=o.default)==null?void 0:d.call(o,c)}}}),MQ=Object.freeze(Object.defineProperty({__proto__:null,VAlert:JW,VAlertTitle:vz,VApp:aW,VAppBar:CW,VAppBarNavIcon:ZW,VAppBarTitle:XW,VAutocomplete:bX,VAvatar:ml,VBadge:wX,VBanner:EX,VBannerActions:nB,VBannerText:iB,VBottomNavigation:CX,VBottomSheet:PX,VBreadcrumbs:DX,VBreadcrumbsDivider:oB,VBreadcrumbsItem:sB,VBtn:yr,VBtnGroup:Vw,VBtnToggle:DW,VCard:FX,VCardActions:aB,VCardItem:uB,VCardSubtitle:lB,VCardText:hB,VCardTitle:cB,VCarousel:WX,VCarouselItem:XX,VCheckbox:aZ,VCheckboxBtn:eu,VChip:Hp,VChipGroup:dZ,VClassIcon:TT,VCode:YX,VCol:EK,VColorPicker:FY,VCombobox:UY,VComponentIcon:zw,VConfirmEdit:$Y,VContainer:xK,VCounter:sb,VDataIterator:QY,VDataTable:mK,VDataTableFooter:u_,VDataTableHeaders:Ed,VDataTableRow:tE,VDataTableRows:Id,VDataTableServer:yK,VDataTableVirtual:_K,VDatePicker:FK,VDatePickerControls:tS,VDatePickerHeader:nS,VDatePickerMonth:iS,VDatePickerMonths:rS,VDatePickerYears:oS,VDefaultsProvider:Li,VDialog:Ww,VDialogBottomTransition:hW,VDialogTopTransition:dW,VDialogTransition:K0,VDivider:k_,VEmptyState:NK,VExpandTransition:J0,VExpandXTransition:AT,VExpansionPanel:UK,VExpansionPanelText:sS,VExpansionPanelTitle:aS,VExpansionPanels:GK,VFab:qK,VFabTransition:uW,VFadeTransition:r_,VField:qp,VFieldLabel:Pg,VFileInput:ZK,VFooter:YK,VForm:JK,VHover:eJ,VIcon:br,VImg:Qc,VInfiniteScroll:nJ,VInput:Vs,VItem:oJ,VItemGroup:rJ,VKbd:sJ,VLabel:Gp,VLayout:lJ,VLayoutItem:uJ,VLazy:dJ,VLigatureIcon:J7,VList:ob,VListGroup:$w,VListImg:LZ,VListItem:tu,VListItemAction:BZ,VListItemMedia:VZ,VListItemSubtitle:Fz,VListItemTitle:Vz,VListSubheader:Nz,VLocaleProvider:pJ,VMain:gJ,VMenu:Lp,VMessages:Sz,VNavigationDrawer:EJ,VNoSsr:IJ,VOtpInput:AJ,VOverlay:vc,VPagination:Qw,VParallax:kJ,VProgressCircular:Op,VProgressLinear:eb,VRadio:DJ,VRadioGroup:LJ,VRangeSlider:BJ,VRating:VJ,VResponsive:Bw,VRow:RK,VScaleTransition:IT,VScrollXReverseTransition:pW,VScrollXTransition:fW,VScrollYReverseTransition:gW,VScrollYTransition:mW,VSelect:$T,VSelectionControl:lh,VSelectionControlGroup:bz,VSheet:Td,VSkeletonLoader:$J,VSlideGroup:l_,VSlideGroupItem:GJ,VSlideXReverseTransition:vW,VSlideXTransition:_W,VSlideYReverseTransition:yW,VSlideYTransition:CT,VSlider:Jw,VSnackbar:WJ,VSpacer:JB,VSparkline:KJ,VSpeedDial:QJ,VStepper:sQ,VStepperActions:d4,VStepperHeader:f4,VStepperItem:p4,VStepperWindow:m4,VStepperWindowItem:g4,VSvgIcon:ST,VSwitch:lQ,VSystemBar:uQ,VTab:_4,VTable:Cd,VTabs:gQ,VTabsWindow:v4,VTabsWindowItem:y4,VTextField:xd,VTextarea:vQ,VThemeProvider:bQ,VTimeline:EQ,VTimelineItem:SQ,VToolbar:Fw,VToolbarItems:CQ,VToolbarTitle:ET,VTooltip:x4,VValidation:PQ,VVirtualScroll:lb,VWindow:wd,VWindowItem:Sd},Symbol.toStringTag,{value:"Module"}));function kQ(e,t){const o=t.modifiers||{},c=t.value,{once:d,immediate:v,...y}=o,T=!Object.keys(y).length,{handler:r,options:D}=typeof c=="object"?c:{handler:c,options:{attributes:(y==null?void 0:y.attr)??T,characterData:(y==null?void 0:y.char)??T,childList:(y==null?void 0:y.child)??T,subtree:(y==null?void 0:y.sub)??T}},L=new MutationObserver(function(){let B=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],U=arguments.length>1?arguments[1]:void 0;r==null||r(B,U),d&&w4(e,t)});v&&(r==null||r([],L)),e._mutate=Object(e._mutate),e._mutate[t.instance.$.uid]={observer:L},L.observe(e,D)}function w4(e,t){var o;(o=e._mutate)!=null&&o[t.instance.$.uid]&&(e._mutate[t.instance.$.uid].observer.disconnect(),delete e._mutate[t.instance.$.uid])}const RQ={mounted:kQ,unmounted:w4};function DQ(e,t){var d,v;const o=t.value,c={passive:!((d=t.modifiers)!=null&&d.active)};window.addEventListener("resize",o,c),e._onResize=Object(e._onResize),e._onResize[t.instance.$.uid]={handler:o,options:c},(v=t.modifiers)!=null&&v.quiet||o()}function OQ(e,t){var d;if(!((d=e._onResize)!=null&&d[t.instance.$.uid]))return;const{handler:o,options:c}=e._onResize[t.instance.$.uid];window.removeEventListener("resize",o,c),delete e._onResize[t.instance.$.uid]}const LQ={mounted:DQ,unmounted:OQ};function S4(e,t){const{self:o=!1}=t.modifiers??{},c=t.value,d=typeof c=="object"&&c.options||{passive:!0},v=typeof c=="function"||"handleEvent"in c?c:c.handler,y=o?e:t.arg?document.querySelector(t.arg):window;y&&(y.addEventListener("scroll",v,d),e._onScroll=Object(e._onScroll),e._onScroll[t.instance.$.uid]={handler:v,options:d,target:o?void 0:y})}function T4(e,t){var v;if(!((v=e._onScroll)!=null&&v[t.instance.$.uid]))return;const{handler:o,options:c,target:d=e}=e._onScroll[t.instance.$.uid];d.removeEventListener("scroll",o,c),delete e._onScroll[t.instance.$.uid]}function zQ(e,t){t.value!==t.oldValue&&(T4(e,t),S4(e,t))}const BQ={mounted:S4,unmounted:T4,updated:zQ};function FQ(e,t){const o=typeof e=="string"?cc(e):e,c=VQ(o,t);return{mounted:c,updated:c,unmounted(d){oD(null,d)}}}function VQ(e,t){return function(o,c,d){var B,U,$;const v=typeof t=="function"?t(c):t,y=((B=c.value)==null?void 0:B.text)??c.value??(v==null?void 0:v.text),T=Qg(c.value)?c.value:{},r=()=>y??o.innerHTML,D=(d.ctx===c.instance.$?(U=NQ(d,c.instance.$))==null?void 0:U.provides:($=d.ctx)==null?void 0:$.provides)??c.instance.$.provides,L=Gl(e,fn(v,T),r);L.appContext=Object.assign(Object.create(null),c.instance.$.appContext,{provides:D}),oD(L,o)}}function NQ(e,t){const o=new Set,c=v=>{var y,T;for(const r of v){if(!r)continue;if(r===e)return!0;o.add(r);let D;if(r.suspense?D=c([r.ssContent]):Array.isArray(r.children)?D=c(r.children):(y=r.component)!=null&&y.vnode&&(D=c([(T=r.component)==null?void 0:T.subTree])),D)return D;o.delete(r)}return!1};if(!c([t.subTree]))throw new Error("Could not find original vnode");const d=Array.from(o).reverse();for(const v of d)if(v.component)return v.component;return t}const UQ=FQ(x4,e=>{var t;return{activator:"parent",location:((t=e.arg)==null?void 0:t.replace("-"," "))??"top",text:typeof e.value=="boolean"?void 0:e.value}}),jQ=Object.freeze(Object.defineProperty({__proto__:null,ClickOutside:Kz,Intersect:E_,Mutate:RQ,Resize:LQ,Ripple:ru,Scroll:BQ,Tooltip:UQ,Touch:GT},Symbol.toStringTag,{value:"Module"})),wb=C2(_3);wb.use(oL);wb.use(oq);const $Q=QL({components:MQ,directives:jQ});wb.use($Q);wb.mount("#app");
